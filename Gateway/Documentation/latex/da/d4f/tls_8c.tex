\hypertarget{tls_8c}{}\section{cyclone\+\_\+ssl/tls.c File Reference}
\label{tls_8c}\index{cyclone\+\_\+ssl/tls.\+c@{cyclone\+\_\+ssl/tls.\+c}}


T\+LS (Transport Layer Security)  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+handshake.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+certificate.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+transcript\+\_\+hash.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls13\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dtls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/pem\+\_\+import.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+cert\+\_\+parse.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tls_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$ \hyperlink{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}{tls\+Init} (void)
\begin{DoxyCompactList}\small\item\em T\+LS context initialization. \end{DoxyCompactList}\item 
\hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4d}{Tls\+State} \hyperlink{tls_8c_aba532715c51af332afc462db43935941}{tls\+Get\+State} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Retrieve current state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a8d7b1f8f12e60a17d619e765a301f549}{tls\+Set\+Socket\+Callbacks} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a2d3369746cfcc1ff0830302cecea54ce}{Tls\+Socket\+Send\+Callback} socket\+Send\+Callback, \hyperlink{tls_8h_a4588e69c3d9708c560b24ea04afa6a9c}{Tls\+Socket\+Receive\+Callback} socket\+Receive\+Callback, \hyperlink{tls_8h_a55c0b32d3441cc70d62c51951ccaaa4e}{Tls\+Socket\+Handle} handle)
\begin{DoxyCompactList}\small\item\em Set socket send and receive callbacks. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a82ab46316bb6ca47f9781f2e5d349e20}{tls\+Set\+Version} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} version\+Min, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} version\+Max)
\begin{DoxyCompactList}\small\item\em Set minimum and maximum versions permitted. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_af956e21be810af37839b46b5d9470817}{tls\+Set\+Transport\+Protocol} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89f}{Tls\+Transport\+Protocol} transport\+Protocol)
\begin{DoxyCompactList}\small\item\em Set the transport protocol to be used. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a8713543db673ee5a36b2fda92e082c6b}{tls\+Set\+Connection\+End} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End} entity)
\begin{DoxyCompactList}\small\item\em Set operation mode (client or server) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a46c2f7356836d7b28fde1a1eebf8c9b8}{tls\+Set\+Prng} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context)
\begin{DoxyCompactList}\small\item\em Set the pseudo-\/random number generator to be used. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ab1b11bd61e4213b74fbd5bb6a9568795}{tls\+Set\+Server\+Name} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$server\+Name)
\begin{DoxyCompactList}\small\item\em Set the server name. \end{DoxyCompactList}\item 
const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$ \hyperlink{tls_8c_a8d694f2a530511ccb99d358c0f24631f}{tls\+Get\+Server\+Name} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Get the server name. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ae84c8a86b42f4ac64b499c95acfcee7c}{tls\+Set\+Cache} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{structTlsCache}{Tls\+Cache} $\ast$cache)
\begin{DoxyCompactList}\small\item\em Set session cache. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ae54f98cd8c0ec0c2f59a8a059f25ba2e}{tls\+Set\+Client\+Auth\+Mode} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a657708ec632fe90da5a94cf667118527}{Tls\+Client\+Auth\+Mode} \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode})
\begin{DoxyCompactList}\small\item\em Set client authentication mode (for servers only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}{tls\+Set\+Buffer\+Size} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, size\+\_\+t tx\+Buffer\+Size, size\+\_\+t rx\+Buffer\+Size)
\begin{DoxyCompactList}\small\item\em Set T\+LS buffer size. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a8a6e12f6dcd37d688cef179d03df30fe}{tls\+Set\+Max\+Fragment\+Length} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, size\+\_\+t max\+Frag\+Len)
\begin{DoxyCompactList}\small\item\em Set maximum fragment length. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ae15fab3d6c6b185bc7ccb1207c2b73cf}{tls\+Set\+Cipher\+Suites} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$cipher\+Suites, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Specify the list of allowed cipher suites. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a3f8105a2c084f10e82dba26e25cde3a7}{tls\+Set\+Supported\+Groups} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$groups, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Specify the list of allowed E\+C\+D\+HE and F\+F\+D\+HE groups. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ac2692a338adfed355dfd82ea3ea4b497}{tls\+Set\+Preferred\+Group} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{tls13__misc_8h_accac7d4e29fafd4cff0799a0ef7902c7}{group})
\begin{DoxyCompactList}\small\item\em Specify the preferred E\+C\+D\+HE or F\+F\+D\+HE group. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a970ba4db0f95d0764c9c24b488e10b33}{tls\+Set\+Dh\+Parameters} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$params, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Import Diffie-\/\+Hellman parameters. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a2393e1468449569ce84c7d40db999ca2}{tls\+Set\+Ecdh\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_ad0cd644ab2e901c494d04e42bcc832d0}{Tls\+Ecdh\+Callback} ecdh\+Callback)
\begin{DoxyCompactList}\small\item\em Register E\+C\+DH key agreement callback function. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a032b79859552948f39875b0d1560c2fd}{tls\+Set\+Ecdsa\+Sign\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a6f737cb17e8452166e73c85b7d5a9256}{Tls\+Ecdsa\+Sign\+Callback} ecdsa\+Sign\+Callback)
\begin{DoxyCompactList}\small\item\em E\+C\+D\+SA signature generation callback function. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aad3f807b39648ba221d85f9dbbaf83d1}{tls\+Set\+Ecdsa\+Verify\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a1d84397a61d8222779e78997e5fdfa53}{Tls\+Ecdsa\+Verify\+Callback} ecdsa\+Verify\+Callback)
\begin{DoxyCompactList}\small\item\em Register E\+C\+D\+SA signature verification callback function. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a4f0aeb38ece2faf93030ba76b9eb539a}{tls\+Set\+Key\+Log\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a562fd539fc11782835f2692e3dcaf5b1}{Tls\+Key\+Log\+Callback} key\+Log\+Callback)
\begin{DoxyCompactList}\small\item\em Register key logging callback function (for debugging purpose only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a6dc0a98f29cb319bce59f72702a2c1ac}{tls\+Allow\+Unknown\+Alpn\+Protocols} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} allowed)
\begin{DoxyCompactList}\small\item\em Allow unknown A\+L\+PN protocols. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_af49cf6564348288916f822239b6ebe06}{tls\+Set\+Alpn\+Protocol\+List} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$protocol\+List)
\begin{DoxyCompactList}\small\item\em Set the list of supported A\+L\+PN protocols. \end{DoxyCompactList}\item 
const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$ \hyperlink{tls_8c_a9f3330ef6c90be90a640d84ca90a9673}{tls\+Get\+Alpn\+Protocol} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Get the name of the selected A\+L\+PN protocol. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a96d2fb0552236b74ee1fddc4a2d00d6d}{tls\+Set\+Psk} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$psk, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Set the pre-\/shared key to be used. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a045a9bf6e6d97e64d9f454d73690979b}{tls\+Set\+Psk\+Identity} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$psk\+Identity)
\begin{DoxyCompactList}\small\item\em Set the P\+SK identity to be used by the client. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a7c793df4875fa1b3ce5be75192f9dbeb}{tls\+Set\+Psk\+Identity\+Hint} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$psk\+Identity\+Hint)
\begin{DoxyCompactList}\small\item\em Set the P\+SK identity hint to be used by the server. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_af57c96be78b1896eab4a261dd9ebd4c8}{tls\+Set\+Psk\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a389807e343d8c65f8080ec9bd71fa91d}{Tls\+Psk\+Callback} psk\+Callback)
\begin{DoxyCompactList}\small\item\em Register the P\+SK callback function. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a67e86a6526e02a0c82e7abfded91c311}{tls\+Set\+Rpk\+Verify\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_ab1f0e6b85cdc60baae331dee4c1ec77b}{Tls\+Rpk\+Verify\+Callback} rpk\+Verify\+Callback)
\begin{DoxyCompactList}\small\item\em Register the raw public key verification callback function. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aaca40b2296ddc4adf5835f4ebcf04af2}{tls\+Set\+Trusted\+Ca\+List} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_a52d999bffef4c5d89345bd0ce7d91042}{trusted\+Ca\+List}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Import a trusted CA list. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a261d36062c7fa6578fa237c47d78cdd5}{tls\+Add\+Certificate} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$cert\+Chain, size\+\_\+t cert\+Chain\+Len, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$private\+Key, size\+\_\+t private\+Key\+Len)
\begin{DoxyCompactList}\small\item\em Import a certificate and the corresponding private key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a4a11f8e1d2d43b173021a912b1772bde}{tls\+Set\+Certificate\+Verify\+Callback} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a1d220d8b5abc08e3ce8a1278d2aeac5e}{Tls\+Cert\+Verify\+Callback} cert\+Verify\+Callback, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Set certificate verification callback. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a8392f5c53ca60bb23e0ca6cb21dcf20a}{tls\+Enable\+Secure\+Renegotiation} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} enabled)
\begin{DoxyCompactList}\small\item\em Enable secure renegotiation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aa9898e66fe3ee38dbe6d827f17307169}{tls\+Enable\+Fallback\+Scsv} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} enabled)
\begin{DoxyCompactList}\small\item\em Perform fallback retry (for clients only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a07aa42467b2c7ab9dadd717506a991f1}{tls\+Set\+Ticket\+Callbacks} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a285a972f2c50b94aad3c1315595538ed}{Tls\+Ticket\+Encrypt\+Callback} ticket\+Encrypt\+Callback, \hyperlink{tls_8h_aaa1312868adabe84a91c54f830669789}{Tls\+Ticket\+Decrypt\+Callback} ticket\+Decrypt\+Callback, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Set ticket encryption/decryption callbacks. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aa16cfbb47616a1d4ce4fb89c73b0e5be}{tls\+Set\+Pmtu} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, size\+\_\+t pmtu)
\begin{DoxyCompactList}\small\item\em Set P\+M\+TU value (for D\+T\+LS only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_af1d43e09beb55392462a4aa0268d802b}{tls\+Set\+Timeout} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} timeout)
\begin{DoxyCompactList}\small\item\em Set timeout for blocking calls (for D\+T\+LS only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ac710383726f5885fa045004947ea9349}{tls\+Set\+Cookie\+Callbacks} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{dtls__misc_8h_a26c71101670183fb3f3a89aa3084800d}{Dtls\+Cookie\+Generate\+Callback} cookie\+Generate\+Callback, \hyperlink{dtls__misc_8h_ad815ff6a1d5fa9f07fde4475168c6538}{Dtls\+Cookie\+Verify\+Callback} cookie\+Verify\+Callback, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Set cookie generation/verification callbacks (for D\+T\+LS only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a39e816e84df86da3c93b076e907a699d}{tls\+Enable\+Replay\+Detection} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} enabled)
\begin{DoxyCompactList}\small\item\em Enable anti-\/replay mechanism (for D\+T\+LS only) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_af54f39c0dccdef05ab98c58b60548ff6}{tls\+Set\+Max\+Early\+Data\+Size} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, size\+\_\+t max\+Early\+Data\+Size)
\begin{DoxyCompactList}\small\item\em Send the maximum amount of 0-\/\+R\+TT data the server can accept. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ac0777366c6b183672702b6aaac008e7c}{tls\+Write\+Early\+Data} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send early data to the remote T\+LS server. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tls\+Connect} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Initiate the T\+LS handshake. \end{DoxyCompactList}\item 
\hyperlink{tls_8h_a304427de7b46d3f389ec07ddb0996cc1}{Tls\+Early\+Data\+Status} \hyperlink{tls_8c_a129e503890f0ea9433e0650710960706}{tls\+Get\+Early\+Data\+Status} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Check whether the server has accepted or rejected the early data. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a1b4b22502217a601f7f094403e700b4b}{tls\+Write} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send application data to the remote host using T\+LS. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}{tls\+Read} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Receive application data from a the remote host using T\+LS. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{tls_8c_a54064670848f38f025bc40d612179890}{tls\+Is\+Tx\+Ready} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Check whether some data is ready for transmission. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{tls_8c_ae3de9c47e92455f6dd4739d54bc6981c}{tls\+Is\+Rx\+Ready} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Check whether some data is available in the receive buffer. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_ae6a631703510008537d2cd97ab3425ef}{tls\+Shutdown} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Gracefully close T\+LS session. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aa88b81232b387245ab5c945050bc0d29}{tls\+Shutdown\+Ex} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} wait\+For\+Close\+Notify)
\begin{DoxyCompactList}\small\item\em Gracefully close T\+LS session. \end{DoxyCompactList}\item 
void \hyperlink{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}{tls\+Free} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Release T\+LS context. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_aea7b98b4b876fe45322df04583f7c1b4}{tls\+Init\+Session\+State} (\hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$session)
\begin{DoxyCompactList}\small\item\em Initialize session state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}{tls\+Save\+Session\+State} (const \hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$session)
\begin{DoxyCompactList}\small\item\em Save T\+LS session. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls_8c_a04094e358f18adc2d7ad8686e3258b93}{tls\+Restore\+Session\+State} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$session)
\begin{DoxyCompactList}\small\item\em Restore T\+LS session. \end{DoxyCompactList}\item 
void \hyperlink{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}{tls\+Free\+Session\+State} (\hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$session)
\begin{DoxyCompactList}\small\item\em Properly dispose a session state. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
T\+LS (Transport Layer Security) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
The T\+LS protocol provides communications security over the Internet. The protocol allows client/server applications to communicate in a way that is designed to prevent eavesdropping, tampering, or message forgery

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{tls_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{tls_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{tls.\+c@{tls.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 38 of file tls.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{tls_8c_a261d36062c7fa6578fa237c47d78cdd5}\label{tls_8c_a261d36062c7fa6578fa237c47d78cdd5}} 
\index{tls.\+c@{tls.\+c}!tls\+Add\+Certificate@{tls\+Add\+Certificate}}
\index{tls\+Add\+Certificate@{tls\+Add\+Certificate}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Add\+Certificate()}{tlsAddCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Add\+Certificate (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{cert\+Chain,  }\item[{size\+\_\+t}]{cert\+Chain\+Len,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{private\+Key,  }\item[{size\+\_\+t}]{private\+Key\+Len }\end{DoxyParamCaption})}



Import a certificate and the corresponding private key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cert\+Chain} & Certificate chain (P\+EM format) \\
\hline
\mbox{\tt in}  & {\em cert\+Chain\+Len} & Total length of the certificate chain \\
\hline
\mbox{\tt in}  & {\em private\+Key} & Private key (P\+EM format) \\
\hline
\mbox{\tt in}  & {\em private\+Key\+Len} & Total length of the private key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1126 of file tls.\+c.


\begin{DoxyCode}
1128 \{
1129    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1130    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *derCert;
1131    \textcolor{keywordtype}{size\_t} derCertLen;
1132    \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *certInfo;
1133    \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffd}{TlsCertificateType} certType;
1134    \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223}{TlsSignatureAlgo} certSignAlgo;
1135    \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156d}{TlsHashAlgo} certHashAlgo;
1136    \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{TlsNamedGroup} namedCurve;
1137 
1138    \textcolor{comment}{//Invalid TLS context?}
1139    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1140       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1141 
1142    \textcolor{comment}{//Check whether the certificate chain is valid}
1143    \textcolor{keywordflow}{if}(certChain == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || certChainLen == 0)
1144       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1145 
1146    \textcolor{comment}{//The private key is optional}
1147    \textcolor{keywordflow}{if}(privateKey == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && privateKeyLen != 0)
1148       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1149 
1150    \textcolor{comment}{//Make sure there is enough room to add the certificate}
1151    \textcolor{keywordflow}{if}(context->numCerts >= \hyperlink{tls_8h_a23af217ea8d64e790e6e1e4bca07e2c5}{TLS\_MAX\_CERTIFICATES})
1152       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
1153 
1154    \textcolor{comment}{//Initialize variables}
1155    derCert = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1156    certInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1157 
1158    \textcolor{comment}{//Start of exception handling block}
1159    \textcolor{keywordflow}{do}
1160    \{
1161       \textcolor{comment}{//The first pass calculates the length of the DER-encoded certificate}
1162       error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &derCertLen,
1163          \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1164       \textcolor{comment}{//Any error to report?}
1165       \textcolor{keywordflow}{if}(error)
1166          \textcolor{keywordflow}{break};
1167 
1168       \textcolor{comment}{//Allocate a memory buffer to hold the DER-encoded certificate}
1169       derCert = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(derCertLen);
1170       \textcolor{comment}{//Failed to allocate memory?}
1171       \textcolor{keywordflow}{if}(derCert == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1172       \{
1173          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1174          \textcolor{keywordflow}{break};
1175       \}
1176 
1177       \textcolor{comment}{//The second pass decodes the PEM certificate}
1178       error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen, derCert,
1179          &derCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1180       \textcolor{comment}{//Any error to report?}
1181       \textcolor{keywordflow}{if}(error)
1182          \textcolor{keywordflow}{break};
1183 
1184       \textcolor{comment}{//Allocate a memory buffer to store X.509 certificate info}
1185       certInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
1186       \textcolor{comment}{//Failed to allocate memory?}
1187       \textcolor{keywordflow}{if}(certInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1188       \{
1189          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1190          \textcolor{keywordflow}{break};
1191       \}
1192 
1193       \textcolor{comment}{//Parse X.509 certificate}
1194       error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(derCert, derCertLen, certInfo);
1195       \textcolor{comment}{//Failed to parse the X.509 certificate?}
1196       \textcolor{keywordflow}{if}(error)
1197          \textcolor{keywordflow}{break};
1198 
1199       \textcolor{comment}{//Retrieve the signature algorithm that has been used to sign the}
1200       \textcolor{comment}{//certificate}
1201       error = \hyperlink{tls__certificate_8c_a87df47b3fef52984054b8e49a72d2224}{tlsGetCertificateType}(certInfo, &certType, &certSignAlgo,
1202          &certHashAlgo, &namedCurve);
1203       \textcolor{comment}{//The specified signature algorithm is not supported?}
1204       \textcolor{keywordflow}{if}(error)
1205          \textcolor{keywordflow}{break};
1206 
1207       \textcolor{comment}{//End of exception handling block}
1208    \} \textcolor{keywordflow}{while}(0);
1209 
1210    \textcolor{comment}{//Valid certificate?}
1211    \textcolor{keywordflow}{if}(!error)
1212    \{
1213       \textcolor{comment}{//Point to the structure that describes the certificate}
1214       \hyperlink{structTlsCertDesc}{TlsCertDesc} *cert = &context->certs[context->numCerts];
1215 
1216       \textcolor{comment}{//Save the certificate chain and the corresponding private key}
1217       cert->\hyperlink{structTlsCertDesc_ae944e03a44368e92bb4955f890381d3d}{certChain} = certChain;
1218       cert->\hyperlink{structTlsCertDesc_a3b679e405c99f9989713292148f36149}{certChainLen} = certChainLen;
1219       cert->\hyperlink{structTlsCertDesc_a3ae3164c84e83982d57e805167860459}{privateKey} = privateKey;
1220       cert->\hyperlink{structTlsCertDesc_a9e7c26f2f43e5192fd69b0d48f3558bd}{privateKeyLen} = privateKeyLen;
1221       cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} = certType;
1222       cert->\hyperlink{structTlsCertDesc_a6859e171d20df5e0c0ec12b940d90822}{signAlgo} = certSignAlgo;
1223       cert->\hyperlink{structTlsCertDesc_ad579e322e6688389f98141972794e243}{hashAlgo} = certHashAlgo;
1224       cert->\hyperlink{structTlsCertDesc_a8b80a193be9a9d1064b2226ce1dce6bd}{namedCurve} = namedCurve;
1225 
1226       \textcolor{comment}{//Update the number of certificates}
1227       context->numCerts++;
1228    \}
1229 
1230    \textcolor{comment}{//Release previously allocated memory}
1231    \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(derCert);
1232    \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(certInfo);
1233 
1234    \textcolor{comment}{//Return status code}
1235    \textcolor{keywordflow}{return} error;
1236 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a6dc0a98f29cb319bce59f72702a2c1ac}\label{tls_8c_a6dc0a98f29cb319bce59f72702a2c1ac}} 
\index{tls.\+c@{tls.\+c}!tls\+Allow\+Unknown\+Alpn\+Protocols@{tls\+Allow\+Unknown\+Alpn\+Protocols}}
\index{tls\+Allow\+Unknown\+Alpn\+Protocols@{tls\+Allow\+Unknown\+Alpn\+Protocols}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Allow\+Unknown\+Alpn\+Protocols()}{tlsAllowUnknownAlpnProtocols()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Allow\+Unknown\+Alpn\+Protocols (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{allowed }\end{DoxyParamCaption})}



Allow unknown A\+L\+PN protocols. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em allowed} & Specifies whether unknown A\+L\+PN protocols are allowed \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 781 of file tls.\+c.


\begin{DoxyCode}
782 \{
783 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
784    \textcolor{comment}{//Invalid TLS context?}
785    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
786       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
787 
788    \textcolor{comment}{//Allow or disallow unknown ALPN protocols}
789    context->unknownProtocolsAllowed = allowed;
790 
791    \textcolor{comment}{//Successful processing}
792    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
793 \textcolor{preprocessor}{#else}
794    \textcolor{comment}{//ALPN is not implemented}
795    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
796 \textcolor{preprocessor}{#endif}
797 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a09ea66af9332cc10296020164428224e}\label{tls_8c_a09ea66af9332cc10296020164428224e}} 
\index{tls.\+c@{tls.\+c}!tls\+Connect@{tls\+Connect}}
\index{tls\+Connect@{tls\+Connect}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Connect()}{tlsConnect()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Connect (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Initiate the T\+LS handshake. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1572 of file tls.\+c.


\begin{DoxyCode}
1573 \{
1574    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1575 
1576    \textcolor{comment}{//Invalid TLS context?}
1577    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1578       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1579 
1580    \textcolor{comment}{//Ensure the send/receive functions are properly registered}
1581    \textcolor{keywordflow}{if}(context->socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->socketReceiveCallback == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1582       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1583 
1584    \textcolor{comment}{//Verify that the PRNG is properly set}
1585    \textcolor{keywordflow}{if}(context->prngAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->prngContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1586       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1587 
1588 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1589    \textcolor{comment}{//Save current time}
1590    context->startTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1591 \textcolor{preprocessor}{#endif}
1592 
1593 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3 && \(\backslash\)}
1594 \textcolor{preprocessor}{   TLS\_CLIENT\_SUPPORT == ENABLED && TLS13\_EARLY\_DATA\_SUPPORT == ENABLED)}
1595    \textcolor{comment}{//Any 0-RTT data sent by the client?}
1596    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT} &&
1597       context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da734ccfc206c92d1b27197ed50a205fc7}{TLS\_STATE\_EARLY\_DATA})
1598    \{
1599       \textcolor{comment}{//Save current sequence number}
1600       context->earlyDataSeqNum = context->encryptionEngine.seqNum;
1601       \textcolor{comment}{//Wait for a ServerHello message}
1602       context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dac2a251e510ed5a202b13f7fe615767cc}{TLS\_STATE\_SERVER\_HELLO\_3};
1603    \}
1604 \textcolor{preprocessor}{#endif}
1605 
1606    \textcolor{comment}{//Perform TLS handshake}
1607    error = \hyperlink{tls__handshake_8c_a8cb9f40f473b24c28c2168772da3b26d}{tlsPerformHandshake}(context);
1608    \textcolor{comment}{//Return status code}
1609    \textcolor{keywordflow}{return} error;
1610 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aa9898e66fe3ee38dbe6d827f17307169}\label{tls_8c_aa9898e66fe3ee38dbe6d827f17307169}} 
\index{tls.\+c@{tls.\+c}!tls\+Enable\+Fallback\+Scsv@{tls\+Enable\+Fallback\+Scsv}}
\index{tls\+Enable\+Fallback\+Scsv@{tls\+Enable\+Fallback\+Scsv}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Enable\+Fallback\+Scsv()}{tlsEnableFallbackScsv()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Enable\+Fallback\+Scsv (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{enabled }\end{DoxyParamCaption})}



Perform fallback retry (for clients only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em enabled} & Specifies whether F\+A\+L\+L\+B\+A\+C\+K\+\_\+\+S\+C\+SV is enabled \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1298 of file tls.\+c.


\begin{DoxyCode}
1299 \{
1300 \textcolor{preprocessor}{#if (TLS\_FALLBACK\_SCSV\_SUPPORT == ENABLED)}
1301    \textcolor{comment}{//Invalid TLS context?}
1302    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1303       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1304 
1305    \textcolor{comment}{//Enable or disable support for FALLBACK\_SCSV}
1306    context->fallbackScsvEnabled = enabled;
1307 
1308    \textcolor{comment}{//Successful processing}
1309    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1310 \textcolor{preprocessor}{#else}
1311    \textcolor{comment}{//Not implemented}
1312    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1313 \textcolor{preprocessor}{#endif}
1314 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a39e816e84df86da3c93b076e907a699d}\label{tls_8c_a39e816e84df86da3c93b076e907a699d}} 
\index{tls.\+c@{tls.\+c}!tls\+Enable\+Replay\+Detection@{tls\+Enable\+Replay\+Detection}}
\index{tls\+Enable\+Replay\+Detection@{tls\+Enable\+Replay\+Detection}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Enable\+Replay\+Detection()}{tlsEnableReplayDetection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Enable\+Replay\+Detection (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{enabled }\end{DoxyParamCaption})}



Enable anti-\/replay mechanism (for D\+T\+LS only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em enabled} & Specifies whether anti-\/replay protection is enabled \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1452 of file tls.\+c.


\begin{DoxyCode}
1453 \{
1454 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED && DTLS\_REPLAY\_DETECTION\_SUPPORT == ENABLED)}
1455    \textcolor{comment}{//Invalid TLS context?}
1456    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1457       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1458 
1459    \textcolor{comment}{//Enable or disable anti-replay mechanism}
1460    context->replayDetectionEnabled = enabled;
1461 
1462    \textcolor{comment}{//Successful processing}
1463    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1464 \textcolor{preprocessor}{#else}
1465    \textcolor{comment}{//Anti-replay mechanism is not implemented}
1466    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1467 \textcolor{preprocessor}{#endif}
1468 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a8392f5c53ca60bb23e0ca6cb21dcf20a}\label{tls_8c_a8392f5c53ca60bb23e0ca6cb21dcf20a}} 
\index{tls.\+c@{tls.\+c}!tls\+Enable\+Secure\+Renegotiation@{tls\+Enable\+Secure\+Renegotiation}}
\index{tls\+Enable\+Secure\+Renegotiation@{tls\+Enable\+Secure\+Renegotiation}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Enable\+Secure\+Renegotiation()}{tlsEnableSecureRenegotiation()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Enable\+Secure\+Renegotiation (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{enabled }\end{DoxyParamCaption})}



Enable secure renegotiation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em enabled} & Specifies whether secure renegotiation is allowed \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1272 of file tls.\+c.


\begin{DoxyCode}
1273 \{
1274 \textcolor{preprocessor}{#if (TLS\_SECURE\_RENEGOTIATION\_SUPPORT == ENABLED)}
1275    \textcolor{comment}{//Invalid TLS context?}
1276    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1277       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1278 
1279    \textcolor{comment}{//Enable or disable secure renegotiation}
1280    context->secureRenegoEnabled = enabled;
1281 
1282    \textcolor{comment}{//Successful processing}
1283    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1284 \textcolor{preprocessor}{#else}
1285    \textcolor{comment}{//Secure renegotiation is not implemented}
1286    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1287 \textcolor{preprocessor}{#endif}
1288 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}\label{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}} 
\index{tls.\+c@{tls.\+c}!tls\+Free@{tls\+Free}}
\index{tls\+Free@{tls\+Free}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Free()}{tlsFree()}}
{\footnotesize\ttfamily void tls\+Free (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Release T\+LS context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}


Definition at line 2272 of file tls.\+c.


\begin{DoxyCode}
2273 \{
2274    \textcolor{comment}{//Valid TLS context?}
2275    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2276    \{
2277       \textcolor{comment}{//Release server name}
2278       \textcolor{keywordflow}{if}(context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2279       \{
2280          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->serverName);
2281       \}
2282 
2283       \textcolor{comment}{//Release cookie}
2284       \textcolor{keywordflow}{if}(context->cookie != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2285       \{
2286          memset(context->cookie, 0, context->cookieLen);
2287          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->cookie);
2288       \}
2289 
2290       \textcolor{comment}{//Release send buffer}
2291       \textcolor{keywordflow}{if}(context->txBuffer != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2292       \{
2293          memset(context->txBuffer, 0, context->txBufferSize);
2294          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->txBuffer);
2295       \}
2296 
2297       \textcolor{comment}{//Release receive buffer}
2298       \textcolor{keywordflow}{if}(context->rxBuffer != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2299       \{
2300          memset(context->rxBuffer, 0, context->rxBufferSize);
2301          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->rxBuffer);
2302       \}
2303 
2304       \textcolor{comment}{//Release transcript hash context}
2305       \hyperlink{tls__transcript__hash_8c_a31d3870ea2bdcaee1ca450c11db2cc94}{tlsFreeTranscriptHash}(context);
2306 
2307 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
2308       \textcolor{comment}{//Release session ticket (TLS 1.3)}
2309       \textcolor{keywordflow}{if}(context->ticket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2310       \{
2311          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->ticket);
2312       \}
2313 
2314       \textcolor{comment}{//Release the ALPN protocol associated with the ticket}
2315       \textcolor{keywordflow}{if}(context->ticketAlpn != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2316       \{
2317          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->ticketAlpn);
2318       \}
2319 \textcolor{preprocessor}{#endif}
2320 
2321 \textcolor{preprocessor}{#if (TLS\_DH\_SUPPORT == ENABLED)}
2322       \textcolor{comment}{//Release Diffie-Hellman context}
2323       \hyperlink{dh_8c_adc8a5f548564e8dd2add9f7592d8df6b}{dhFree}(&context->dhContext);
2324 \textcolor{preprocessor}{#endif}
2325 
2326 \textcolor{preprocessor}{#if (TLS\_ECDH\_SUPPORT == ENABLED)}
2327       \textcolor{comment}{//Release ECDH context}
2328       \hyperlink{ecdh_8c_a6691dcfa7a6fc9d143579ce2455699c7}{ecdhFree}(&context->ecdhContext);
2329 \textcolor{preprocessor}{#endif}
2330 
2331 \textcolor{preprocessor}{#if (TLS\_RSA\_SUPPORT == ENABLED)}
2332       \textcolor{comment}{//Release peer's RSA public key}
2333       \hyperlink{rsa_8c_a6dc1711d56454b2a6e565199509d884e}{rsaFreePublicKey}(&context->peerRsaPublicKey);
2334 \textcolor{preprocessor}{#endif}
2335 
2336 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
2337       \textcolor{comment}{//Release peer's DSA public key}
2338       \hyperlink{dsa_8c_aecb06a7f6d0f7df028b6a30284fa0016}{dsaFreePublicKey}(&context->peerDsaPublicKey);
2339 \textcolor{preprocessor}{#endif}
2340 
2341 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED || TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
2342       \textcolor{comment}{//Release peer's EC domain parameters}
2343       \hyperlink{ec_8c_a256993c154cf87c3d9d18138a1365eca}{ecFreeDomainParameters}(&context->peerEcParams);
2344       \textcolor{comment}{//Release peer's EC public key}
2345       \hyperlink{ec_8c_ae4a9276eac491f8acbb6d0916287411b}{ecFree}(&context->peerEcPublicKey);
2346 \textcolor{preprocessor}{#endif}
2347 
2348 \textcolor{preprocessor}{#if (TLS\_PSK\_SUPPORT == ENABLED)}
2349       \textcolor{comment}{//Release the pre-shared key}
2350       \textcolor{keywordflow}{if}(context->psk != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2351       \{
2352          memset(context->psk, 0, context->pskLen);
2353          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->psk);
2354       \}
2355 
2356       \textcolor{comment}{//Release the PSK identity}
2357       \textcolor{keywordflow}{if}(context->pskIdentity != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2358       \{
2359          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->pskIdentity);
2360       \}
2361 
2362       \textcolor{comment}{//Release the PSK identity hint}
2363       \textcolor{keywordflow}{if}(context->pskIdentityHint != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2364       \{
2365          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->pskIdentityHint);
2366       \}
2367 \textcolor{preprocessor}{#endif}
2368 
2369 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
2370       \textcolor{comment}{//Release the list of supported ALPN protocols}
2371       \textcolor{keywordflow}{if}(context->protocolList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2372       \{
2373          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->protocolList);
2374       \}
2375 
2376       \textcolor{comment}{//Release the selected ALPN protocol}
2377       \textcolor{keywordflow}{if}(context->selectedProtocol != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2378       \{
2379          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->selectedProtocol);
2380       \}
2381 \textcolor{preprocessor}{#endif}
2382 
2383       \textcolor{comment}{//Release encryption engine}
2384       \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->encryptionEngine);
2385       \textcolor{comment}{//Release decryption engine}
2386       \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->decryptionEngine);
2387 
2388 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
2389       \textcolor{comment}{//Release previous encryption engine}
2390       \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->prevEncryptionEngine);
2391 \textcolor{preprocessor}{#endif}
2392 
2393       \textcolor{comment}{//Clear the TLS context before freeing memory}
2394       memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{TlsContext}));
2395       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context);
2396    \}
2397 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}\label{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}} 
\index{tls.\+c@{tls.\+c}!tls\+Free\+Session\+State@{tls\+Free\+Session\+State}}
\index{tls\+Free\+Session\+State@{tls\+Free\+Session\+State}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Free\+Session\+State()}{tlsFreeSessionState()}}
{\footnotesize\ttfamily void tls\+Free\+Session\+State (\begin{DoxyParamCaption}\item[{\hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$}]{session }\end{DoxyParamCaption})}



Properly dispose a session state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em session} & Pointer to the session state to be released \\
\hline
\end{DoxyParams}


Definition at line 2711 of file tls.\+c.


\begin{DoxyCode}
2712 \{
2713    \textcolor{comment}{//Make sure the session state is valid}
2714    \textcolor{keywordflow}{if}(session != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2715    \{
2716 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
2717       \textcolor{comment}{//Release session ticket}
2718       \textcolor{keywordflow}{if}(session->ticket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2719       \{
2720          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(session->ticket);
2721       \}
2722 
2723       \textcolor{comment}{//Release the ALPN protocol associated with the ticket}
2724       \textcolor{keywordflow}{if}(session->ticketAlpn != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2725       \{
2726          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(session->ticketAlpn);
2727       \}
2728 \textcolor{preprocessor}{#endif}
2729 
2730 \textcolor{preprocessor}{#if (TLS\_SNI\_SUPPORT == ENABLED)}
2731       \textcolor{comment}{//Release server name}
2732       \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a9e4b28fa363d10a42e24879e0ba57813}{serverName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2733       \{
2734          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(session->\hyperlink{structTlsSessionState_a9e4b28fa363d10a42e24879e0ba57813}{serverName});
2735       \}
2736 \textcolor{preprocessor}{#endif}
2737 
2738       \textcolor{comment}{//Erase session state}
2739       memset(session, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTlsSessionState}{TlsSessionState}));
2740    \}
2741 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a9f3330ef6c90be90a640d84ca90a9673}\label{tls_8c_a9f3330ef6c90be90a640d84ca90a9673}} 
\index{tls.\+c@{tls.\+c}!tls\+Get\+Alpn\+Protocol@{tls\+Get\+Alpn\+Protocol}}
\index{tls\+Get\+Alpn\+Protocol@{tls\+Get\+Alpn\+Protocol}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Get\+Alpn\+Protocol()}{tlsGetAlpnProtocol()}}
{\footnotesize\ttfamily const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t}$\ast$ tls\+Get\+Alpn\+Protocol (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Get the name of the selected A\+L\+PN protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the protocol name 
\end{DoxyReturn}


Definition at line 855 of file tls.\+c.


\begin{DoxyCode}
856 \{
857    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} defaultProtocolName[] = \textcolor{stringliteral}{""};
858 
859 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
860    \textcolor{comment}{//Valid protocol name?}
861    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->selectedProtocol != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
862    \{
863       \textcolor{comment}{//Return the name of the selected protocol}
864       \textcolor{keywordflow}{return} context->selectedProtocol;
865    \}
866    \textcolor{keywordflow}{else}
867 \textcolor{preprocessor}{#endif}
868    \{
869       \textcolor{comment}{//Return an empty string}
870       \textcolor{keywordflow}{return} defaultProtocolName;
871    \}
872 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a129e503890f0ea9433e0650710960706}\label{tls_8c_a129e503890f0ea9433e0650710960706}} 
\index{tls.\+c@{tls.\+c}!tls\+Get\+Early\+Data\+Status@{tls\+Get\+Early\+Data\+Status}}
\index{tls\+Get\+Early\+Data\+Status@{tls\+Get\+Early\+Data\+Status}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Get\+Early\+Data\+Status()}{tlsGetEarlyDataStatus()}}
{\footnotesize\ttfamily \hyperlink{tls_8h_a304427de7b46d3f389ec07ddb0996cc1}{Tls\+Early\+Data\+Status} tls\+Get\+Early\+Data\+Status (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Check whether the server has accepted or rejected the early data. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+L\+S\+\_\+\+E\+A\+R\+L\+Y\+\_\+\+D\+A\+T\+A\+\_\+\+A\+C\+C\+E\+P\+T\+ED if the early data was accepted, else T\+L\+S\+\_\+\+E\+A\+R\+L\+Y\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+J\+E\+CT if the early data was rejected 
\end{DoxyReturn}


Definition at line 1620 of file tls.\+c.


\begin{DoxyCode}
1621 \{
1622    \hyperlink{tls_8h_a304427de7b46d3f389ec07ddb0996cc1}{TlsEarlyDataStatus} status;
1623 
1624    \textcolor{comment}{//Initialize early data status}
1625    status = \hyperlink{tls_8h_a304427de7b46d3f389ec07ddb0996cc1ab1d5c837526c7a08a2606a5353fcbb73}{TLS\_EARLY\_DATA\_REJECTED};
1626 
1627 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3 && \(\backslash\)}
1628 \textcolor{preprocessor}{   TLS\_CLIENT\_SUPPORT == ENABLED && TLS13\_EARLY\_DATA\_SUPPORT == ENABLED)}
1629    \textcolor{comment}{//Make sure the TLS context is valid}
1630    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1631    \{
1632       \textcolor{comment}{//Client mode?}
1633       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1634       \{
1635          \textcolor{comment}{//Any 0-RTT data sent by the client?}
1636          \textcolor{keywordflow}{if}(context->earlyDataEnabled)
1637          \{
1638             \textcolor{comment}{//Check whether the server has accepted or rejected the early data}
1639             \textcolor{keywordflow}{if}(context->earlyDataExtReceived && !context->earlyDataRejected)
1640             \{
1641                status = \hyperlink{tls_8h_a304427de7b46d3f389ec07ddb0996cc1adbfd77f76b4db1d6ac0a6e6a30a9e199}{TLS\_EARLY\_DATA\_ACCEPTED};
1642             \}
1643          \}
1644       \}
1645    \}
1646 \textcolor{preprocessor}{#endif}
1647 
1648    \textcolor{comment}{//Return early data status}
1649    \textcolor{keywordflow}{return} status;
1650 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a8d694f2a530511ccb99d358c0f24631f}\label{tls_8c_a8d694f2a530511ccb99d358c0f24631f}} 
\index{tls.\+c@{tls.\+c}!tls\+Get\+Server\+Name@{tls\+Get\+Server\+Name}}
\index{tls\+Get\+Server\+Name@{tls\+Get\+Server\+Name}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Get\+Server\+Name()}{tlsGetServerName()}}
{\footnotesize\ttfamily const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t}$\ast$ tls\+Get\+Server\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Get the server name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Fully qualified domain name of the server 
\end{DoxyReturn}


Definition at line 413 of file tls.\+c.


\begin{DoxyCode}
414 \{
415    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} defaultServerName[] = \textcolor{stringliteral}{""};
416 
417    \textcolor{comment}{//Valid protocol name?}
418    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
419    \{
420       \textcolor{comment}{//Return the fully qualified domain name of the server}
421       \textcolor{keywordflow}{return} context->serverName;
422    \}
423    \textcolor{keywordflow}{else}
424    \{
425       \textcolor{comment}{//Return an empty string}
426       \textcolor{keywordflow}{return} defaultServerName;
427    \}
428 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aba532715c51af332afc462db43935941}\label{tls_8c_aba532715c51af332afc462db43935941}} 
\index{tls.\+c@{tls.\+c}!tls\+Get\+State@{tls\+Get\+State}}
\index{tls\+Get\+State@{tls\+Get\+State}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Get\+State()}{tlsGetState()}}
{\footnotesize\ttfamily \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4d}{Tls\+State} tls\+Get\+State (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Retrieve current state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Current T\+LS state 
\end{DoxyReturn}


Definition at line 193 of file tls.\+c.


\begin{DoxyCode}
194 \{
195    \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4d}{TlsState} state;
196 
197    \textcolor{comment}{//Valid TLS context?}
198    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
199       state = context->state;
200    \textcolor{keywordflow}{else}
201       state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da91123cf9d82ef3aac68e9e091ef5c9f9}{TLS\_STATE\_INIT};
202 
203    \textcolor{comment}{//Return current state}
204    \textcolor{keywordflow}{return} state;
205 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}\label{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}} 
\index{tls.\+c@{tls.\+c}!tls\+Init@{tls\+Init}}
\index{tls\+Init@{tls\+Init}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Init()}{tlsInit()}}
{\footnotesize\ttfamily \hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context}$\ast$ tls\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



T\+LS context initialization. 

\begin{DoxyReturn}{Returns}
Handle referencing the fully initialized T\+LS context 
\end{DoxyReturn}


Definition at line 65 of file tls.\+c.


\begin{DoxyCode}
66 \{
67    \hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{TlsContext} *context;
68 
69    \textcolor{comment}{//Allocate a memory buffer to hold the TLS context}
70    context = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{TlsContext}));
71 
72    \textcolor{comment}{//Successful memory allocation?}
73    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
74    \{
75       \textcolor{comment}{//Clear TLS context}
76       memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{TlsContext}));
77 
78       \textcolor{comment}{//Default state}
79       context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da91123cf9d82ef3aac68e9e091ef5c9f9}{TLS\_STATE\_INIT};
80       \textcolor{comment}{//Default transport protocol}
81       context->transportProtocol = \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM};
82       \textcolor{comment}{//Default operation mode}
83       context->entity = \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT};
84       \textcolor{comment}{//Default client authentication mode}
85       context->clientAuthMode = \hyperlink{tls_8h_a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d}{TLS\_CLIENT\_AUTH\_NONE};
86 
87       \textcolor{comment}{//Minimum and maximum versions accepted by the implementation}
88       context->versionMin = \hyperlink{tls_8h_a92b5ddd6c7286598ce5790f6f10807c6}{TLS\_MIN\_VERSION};
89       context->versionMax = \hyperlink{tls_8h_a6c4deefe3b88839c2f519ab6d0e8a80b}{TLS\_MAX\_VERSION};
90 
91       \textcolor{comment}{//Default record layer version number}
92       context->version = \hyperlink{tls_8h_a92b5ddd6c7286598ce5790f6f10807c6}{TLS\_MIN\_VERSION};
93       context->encryptionEngine.version = \hyperlink{tls_8h_a92b5ddd6c7286598ce5790f6f10807c6}{TLS\_MIN\_VERSION};
94 
95 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
96       \textcolor{comment}{//Select default named group}
97       \textcolor{keywordflow}{if}(\hyperlink{tls13__misc_8h_aa4457d2345eac08691ecbd4514d79004}{tls13IsGroupSupported}(context, 
      \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51ad4a4ff2936f581ed7959e911941efd22}{TLS\_GROUP\_ECDH\_X25519}))
98       \{
99          context->preferredGroup = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51ad4a4ff2936f581ed7959e911941efd22}{TLS\_GROUP\_ECDH\_X25519};
100       \}
101       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{tls13__misc_8h_aa4457d2345eac08691ecbd4514d79004}{tls13IsGroupSupported}(context, 
      \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a754392bfe03e9ee5988cebb5c8466df2}{TLS\_GROUP\_SECP256R1}))
102       \{
103          context->preferredGroup = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a754392bfe03e9ee5988cebb5c8466df2}{TLS\_GROUP\_SECP256R1};
104       \}
105       \textcolor{keywordflow}{else}
106       \{
107          context->preferredGroup = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
108       \}
109 \textcolor{preprocessor}{#endif}
110 
111 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
112       \textcolor{comment}{//Default PMTU}
113       context->pmtu = \hyperlink{dtls__misc_8h_abba2f3582e8e91f0374d1629c44860fd}{DTLS\_DEFAULT\_PMTU};
114       \textcolor{comment}{//Default timeout}
115       context->timeout = \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY};
116 \textcolor{preprocessor}{#endif}
117 
118 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED && DTLS\_REPLAY\_DETECTION\_SUPPORT == ENABLED)}
119       \textcolor{comment}{//Anti-replay mechanism is enabled by default}
120       context->replayDetectionEnabled = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
121 \textcolor{preprocessor}{#endif}
122 
123 \textcolor{preprocessor}{#if (TLS\_DH\_SUPPORT == ENABLED)}
124       \textcolor{comment}{//Initialize Diffie-Hellman context}
125       \hyperlink{dh_8c_a526697a93bd78c2fe11d1f3963f17f3d}{dhInit}(&context->dhContext);
126 \textcolor{preprocessor}{#endif}
127 
128 \textcolor{preprocessor}{#if (TLS\_ECDH\_SUPPORT == ENABLED)}
129       \textcolor{comment}{//Initialize ECDH context}
130       \hyperlink{ecdh_8c_adec624dbfb95d70bb35295938575141a}{ecdhInit}(&context->ecdhContext);
131 \textcolor{preprocessor}{#endif}
132 
133 \textcolor{preprocessor}{#if (TLS\_RSA\_SUPPORT == ENABLED)}
134       \textcolor{comment}{//Initialize peer's RSA public key}
135       \hyperlink{rsa_8c_af3d3a1f0ce23e006da06325cc37c4063}{rsaInitPublicKey}(&context->peerRsaPublicKey);
136 \textcolor{preprocessor}{#endif}
137 
138 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
139       \textcolor{comment}{//Initialize peer's DSA public key}
140       \hyperlink{dsa_8c_ab058852057768fc18904ba5796f5af4d}{dsaInitPublicKey}(&context->peerDsaPublicKey);
141 \textcolor{preprocessor}{#endif}
142 
143 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED || TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
144       \textcolor{comment}{//Initialize peer's EC domain parameters}
145       \hyperlink{ec_8c_a5b5132fb8adf668ffa74ec10e7e63441}{ecInitDomainParameters}(&context->peerEcParams);
146       \textcolor{comment}{//Initialize peer's EC public key}
147       \hyperlink{ec_8c_ac038e67dcc04d6d94bb930f9475f3ff8}{ecInit}(&context->peerEcPublicKey);
148 \textcolor{preprocessor}{#endif}
149 
150       \textcolor{comment}{//Maximum number of plaintext data the TX and RX buffers can hold}
151       context->txBufferMaxLen = \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH};
152       context->rxBufferMaxLen = \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH};
153 
154 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
155       \textcolor{comment}{//Maximum fragment length}
156       context->maxFragLen = \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH};
157 \textcolor{preprocessor}{#endif}
158 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
159       \textcolor{comment}{//Maximum record size the peer is willing to receive}
160       context->recordSizeLimit = \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH};
161 \textcolor{preprocessor}{#endif}
162 
163 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
164       \textcolor{comment}{//Calculate the required size for the TX buffer}
165       context->txBufferSize = context->txBufferMaxLen + \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord}) +
166          \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
167 
168       \textcolor{comment}{//Calculate the required size for the RX buffer}
169       context->rxBufferSize = context->rxBufferMaxLen + \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord}) +
170          \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
171 \textcolor{preprocessor}{#else}
172       \textcolor{comment}{//Calculate the required size for the TX buffer}
173       context->txBufferSize = context->txBufferMaxLen + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord}) +
174          \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
175 
176       \textcolor{comment}{//Calculate the required size for the RX buffer}
177       context->rxBufferSize = context->rxBufferMaxLen + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord}) +
178          \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
179 \textcolor{preprocessor}{#endif}
180    \}
181 
182    \textcolor{comment}{//Return a pointer to the freshly created TLS context}
183    \textcolor{keywordflow}{return} context;
184 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aea7b98b4b876fe45322df04583f7c1b4}\label{tls_8c_aea7b98b4b876fe45322df04583f7c1b4}} 
\index{tls.\+c@{tls.\+c}!tls\+Init\+Session\+State@{tls\+Init\+Session\+State}}
\index{tls\+Init\+Session\+State@{tls\+Init\+Session\+State}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Init\+Session\+State()}{tlsInitSessionState()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Init\+Session\+State (\begin{DoxyParamCaption}\item[{\hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$}]{session }\end{DoxyParamCaption})}



Initialize session state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em session} & Pointer to the session state \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2406 of file tls.\+c.


\begin{DoxyCode}
2407 \{
2408    \textcolor{comment}{//Make sure the session state is valid}
2409    \textcolor{keywordflow}{if}(session == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2410       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2411 
2412    \textcolor{comment}{//Erase session state}
2413    memset(session, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTlsSessionState}{TlsSessionState}));
2414 
2415    \textcolor{comment}{//Sucessful initialization}
2416    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2417 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ae3de9c47e92455f6dd4739d54bc6981c}\label{tls_8c_ae3de9c47e92455f6dd4739d54bc6981c}} 
\index{tls.\+c@{tls.\+c}!tls\+Is\+Rx\+Ready@{tls\+Is\+Rx\+Ready}}
\index{tls\+Is\+Rx\+Ready@{tls\+Is\+Rx\+Ready}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Is\+Rx\+Ready()}{tlsIsRxReady()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} tls\+Is\+Rx\+Ready (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Check whether some data is available in the receive buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns T\+R\+UE if some data is pending and can be read immediately without blocking. Otherwise, F\+A\+L\+SE is returned 
\end{DoxyReturn}


Definition at line 2067 of file tls.\+c.


\begin{DoxyCode}
2068 \{
2069    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} ready;
2070 
2071    \textcolor{comment}{//Initialize flag}
2072    ready = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2073 
2074    \textcolor{comment}{//Make sure the TLS context is valid}
2075    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2076    \{
2077 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
2078       \textcolor{comment}{//DTLS protocol?}
2079       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
2080       \{
2081          \textcolor{comment}{//Check whether a datagram is pending in the receive buffer}
2082          \textcolor{keywordflow}{if}(context->rxBufferLen > 0 ||
2083             context->rxRecordLen > 0 ||
2084             context->rxDatagramLen > 0)
2085          \{
2086             ready = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2087          \}
2088       \}
2089       \textcolor{keywordflow}{else}
2090 \textcolor{preprocessor}{#endif}
2091       \textcolor{comment}{//TLS protocol?}
2092       \{
2093          \textcolor{comment}{//Check whether some data is pending in the receive buffer}
2094          \textcolor{keywordflow}{if}(context->rxBufferLen > 0)
2095          \{
2096             ready = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2097          \}
2098       \}
2099    \}
2100 
2101    \textcolor{comment}{//The function returns TRUE if some data can be read immediately}
2102    \textcolor{comment}{//without blocking}
2103    \textcolor{keywordflow}{return} ready;
2104 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a54064670848f38f025bc40d612179890}\label{tls_8c_a54064670848f38f025bc40d612179890}} 
\index{tls.\+c@{tls.\+c}!tls\+Is\+Tx\+Ready@{tls\+Is\+Tx\+Ready}}
\index{tls\+Is\+Tx\+Ready@{tls\+Is\+Tx\+Ready}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Is\+Tx\+Ready()}{tlsIsTxReady()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} tls\+Is\+Tx\+Ready (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Check whether some data is ready for transmission. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns T\+R\+UE if some data is ready for transmission. Otherwise, F\+A\+L\+SE is returned 
\end{DoxyReturn}


Definition at line 2034 of file tls.\+c.


\begin{DoxyCode}
2035 \{
2036    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} ready;
2037 
2038    \textcolor{comment}{//Initialize flag}
2039    ready = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2040 
2041    \textcolor{comment}{//Make sure the TLS context is valid}
2042    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2043    \{
2044       \textcolor{comment}{//TLS protocol?}
2045       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM})
2046       \{
2047          \textcolor{comment}{//Check whether some data is pending in the transmit buffer}
2048          \textcolor{keywordflow}{if}(context->txBufferPos < context->txBufferLen)
2049          \{
2050             ready = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2051          \}
2052       \}
2053    \}
2054 
2055    \textcolor{comment}{//The function returns TRUE if some data is ready for transmission}
2056    \textcolor{keywordflow}{return} ready;
2057 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}\label{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}} 
\index{tls.\+c@{tls.\+c}!tls\+Read@{tls\+Read}}
\index{tls\+Read@{tls\+Read}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Read()}{tlsRead()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Read (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Receive application data from a the remote host using T\+LS. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em received} & Number of bytes that have been received \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1798 of file tls.\+c.


\begin{DoxyCode}
1800 \{
1801    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1802    \textcolor{keywordtype}{size\_t} i;
1803    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1804    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1805    \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896c}{TlsContentType} contentType;
1806 
1807    \textcolor{comment}{//Invalid TLS context?}
1808    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1809       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1810 
1811    \textcolor{comment}{//Check parameters}
1812    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || received == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1813       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1814 
1815    \textcolor{comment}{//Ensure the send/receive functions are properly registered}
1816    \textcolor{keywordflow}{if}(context->socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->socketReceiveCallback == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1817       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1818 
1819 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1820    \textcolor{comment}{//Save current time}
1821    context->startTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1822 \textcolor{preprocessor}{#endif}
1823 
1824    \textcolor{comment}{//Initialize status code}
1825    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1826 
1827    \textcolor{comment}{//No data has been read yet}
1828    *received = 0;
1829 
1830    \textcolor{comment}{//Read as much data as possible}
1831    \textcolor{keywordflow}{while}(*received < size)
1832    \{
1833       \textcolor{comment}{//Check current state}
1834       \textcolor{keywordflow}{if}(context->state < \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
1835       \{
1836          \textcolor{comment}{//Perform TLS handshake}
1837          error = \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(context);
1838       \}
1839       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
1840       \{
1841 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1842          \textcolor{comment}{//DTLS protocol?}
1843          \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
1844          \{
1845             \textcolor{comment}{//Receive a datagram}
1846             error = \hyperlink{dtls__record_8c_acdb1074243776f124182a136435bab6c}{dtlsReadProtocolData}(context, &p, &n, &contentType);
1847          \}
1848          \textcolor{keywordflow}{else}
1849 \textcolor{preprocessor}{#endif}
1850          \textcolor{comment}{//TLS protocol?}
1851          \{
1852             \textcolor{comment}{//The record layer receives uninterpreted data from higher layers}
1853             error = \hyperlink{tls__record_8c_a801443c458f35a2640ec508b1ec1ecf6}{tlsReadProtocolData}(context, &p, &n, &contentType);
1854          \}
1855 
1856          \textcolor{comment}{//Check status code}
1857          \textcolor{keywordflow}{if}(!error)
1858          \{
1859             \textcolor{comment}{//Application data received?}
1860             \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896caa8233b89b5c8f35ce7fcd1f644cbc0fc}{TLS\_TYPE\_APPLICATION\_DATA})
1861             \{
1862 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1863                \textcolor{comment}{//DTLS protocol?}
1864                \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM}
      )
1865                \{
1866                   \textcolor{comment}{//Make sure the user buffer is large enough to hold the whole}
1867                   \textcolor{comment}{//datagram}
1868                   \textcolor{keywordflow}{if}(n > size)
1869                   \{
1870                      \textcolor{comment}{//Report an error}
1871                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
1872                   \}
1873                   \textcolor{keywordflow}{else}
1874                   \{
1875                      \textcolor{comment}{//Copy data to user buffer}
1876                      memcpy(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, p, n);
1877                      \textcolor{comment}{//Total number of data that have been read}
1878                      *received = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1879                   \}
1880 
1881                   \textcolor{comment}{//If the TLS\_FLAG\_PEEK flag is set, the data is copied into}
1882                   \textcolor{comment}{//the buffer but is not removed from the receive queue}
1883                   \textcolor{keywordflow}{if}(!(\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags} & \hyperlink{tls_8h_ab19c109b076beba1926aee7e06cd72dbaacec6d3929dbf0b71ae09cf12474a679}{TLS\_FLAG\_PEEK}))
1884                   \{
1885                      \textcolor{comment}{//Flush receive buffer}
1886                      context->rxBufferPos = 0;
1887                      context->rxBufferLen = 0;
1888                   \}
1889 
1890                   \textcolor{comment}{//We are done}
1891                   \textcolor{keywordflow}{break};
1892                \}
1893                \textcolor{keywordflow}{else}
1894 \textcolor{preprocessor}{#endif}
1895                \textcolor{comment}{//TLS protocol?}
1896                \{
1897                   \textcolor{comment}{//Limit the number of bytes to read at a time}
1898                   n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, size - *received);
1899 
1900                   \textcolor{comment}{//The TLS\_FLAG\_BREAK\_CHAR flag causes the function to stop reading}
1901                   \textcolor{comment}{//data as soon as the specified break character is encountered}
1902                   \textcolor{keywordflow}{if}(\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags} & \hyperlink{tls_8h_ab19c109b076beba1926aee7e06cd72dbae47c982c2f9a9ef6232d1dccf37267a6}{TLS\_FLAG\_BREAK\_CHAR})
1903                   \{
1904                      \textcolor{comment}{//Retrieve the break character code}
1905                      \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} = \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
1906 
1907                      \textcolor{comment}{//Search for the specified break character}
1908                      \textcolor{keywordflow}{for}(i = 0; i < n && p[i] != \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}; i++);
1909                      \textcolor{comment}{//Adjust the number of data to read}
1910                      n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, i + 1);
1911 
1912                      \textcolor{comment}{//Copy data to user buffer}
1913                      memcpy(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, p, n);
1914                      \textcolor{comment}{//Total number of data that have been read}
1915                      *received += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1916 
1917                      \textcolor{comment}{//Advance data pointer}
1918                      context->rxBufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1919                      \textcolor{comment}{//Number of bytes still pending in the receive buffer}
1920                      context->rxBufferLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1921 
1922                      \textcolor{comment}{//Check whether a break character has been found}
1923                      \textcolor{keywordflow}{if}(n > 0 && p[n - 1] == c)
1924                         \textcolor{keywordflow}{break};
1925                   \}
1926                   \textcolor{keywordflow}{else}
1927                   \{
1928                      \textcolor{comment}{//Copy data to user buffer}
1929                      memcpy(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, p, n);
1930                      \textcolor{comment}{//Total number of data that have been read}
1931                      *received += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1932 
1933                      \textcolor{comment}{//Advance data pointer}
1934                      context->rxBufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1935                      \textcolor{comment}{//Number of bytes still pending in the receive buffer}
1936                      context->rxBufferLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1937 
1938                      \textcolor{comment}{//The TLS\_FLAG\_WAIT\_ALL flag causes the function to return}
1939                      \textcolor{comment}{//only when the requested number of bytes have been read}
1940                      \textcolor{keywordflow}{if}(!(\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags} & \hyperlink{tls_8h_ab19c109b076beba1926aee7e06cd72dba33b50796ba15b3e5faab13ec256b1417}{TLS\_FLAG\_WAIT\_ALL}))
1941                         \textcolor{keywordflow}{break};
1942                   \}
1943 
1944                   \textcolor{comment}{//Advance data pointer}
1945                   \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + n;
1946                \}
1947             \}
1948             \textcolor{comment}{//Handshake message received?}
1949             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca72077515f40a300c29899b5a3ba48682}{TLS\_TYPE\_HANDSHAKE})
1950             \{
1951                \textcolor{comment}{//Advance data pointer}
1952                context->rxBufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1953                \textcolor{comment}{//Number of bytes still pending in the receive buffer}
1954                context->rxBufferLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1955 
1956                \textcolor{comment}{//Parse handshake message}
1957                error = \hyperlink{tls__handshake_8c_ad8c84ebcfdd55f293c7b605273e750c2}{tlsParseHandshakeMessage}(context, p, n);
1958             \}
1959             \textcolor{comment}{//Alert message received?}
1960             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896cac576c866dc3772236d51f16226adfbd9}{TLS\_TYPE\_ALERT})
1961             \{
1962                \textcolor{comment}{//Advance data pointer}
1963                context->rxBufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1964                \textcolor{comment}{//Number of bytes still pending in the receive buffer}
1965                context->rxBufferLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1966 
1967                \textcolor{comment}{//Parse Alert message}
1968                error = \hyperlink{tls__common_8c_abd3d66a2f80b812ee5db99a78191b795}{tlsParseAlert}(context, (\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert} *) p, n);
1969             \}
1970             \textcolor{comment}{//An inappropriate message was received?}
1971             \textcolor{keywordflow}{else}
1972             \{
1973                \textcolor{comment}{//Report an error}
1974                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1975             \}
1976          \}
1977 
1978          \textcolor{comment}{//Any error to report?}
1979          \textcolor{keywordflow}{if}(error)
1980          \{
1981             \textcolor{comment}{//Send an alert message to the peer, if applicable}
1982             \hyperlink{tls__misc_8c_ae43b7ef806126baf125c46cdb9424e87}{tlsProcessError}(context, error);
1983          \}
1984       \}
1985       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING} ||
1986          context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED})
1987       \{
1988          \textcolor{comment}{//Check whether a fatal alert message has been sent or received}
1989          \textcolor{keywordflow}{if}(context->fatalAlertSent || context->fatalAlertReceived)
1990          \{
1991             \textcolor{comment}{//Alert messages with a level of fatal result in the immediate}
1992             \textcolor{comment}{//termination of the connection}
1993             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1994          \}
1995          \textcolor{keywordflow}{else}
1996          \{
1997             \textcolor{comment}{//The user must be satisfied with data already on hand}
1998             \textcolor{keywordflow}{if}(*received > 0)
1999             \{
2000                \textcolor{comment}{//Some data are pending in the receive buffer}
2001                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2002                \textcolor{keywordflow}{break};
2003             \}
2004             \textcolor{keywordflow}{else}
2005             \{
2006                \textcolor{comment}{//The receive buffer is empty}
2007                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8b7223773301a4f3dd811f1d35e13ce4}{ERROR\_END\_OF\_STREAM};
2008             \}
2009          \}
2010       \}
2011       \textcolor{keywordflow}{else}
2012       \{
2013          \textcolor{comment}{//The connection has not yet been established}
2014          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8cf62de6117b9a4c1537d1ce96c219a8}{ERROR\_NOT\_CONNECTED};
2015       \}
2016 
2017       \textcolor{comment}{//Any error to report?}
2018       \textcolor{keywordflow}{if}(error)
2019          \textcolor{keywordflow}{break};
2020    \}
2021 
2022    \textcolor{comment}{//Return status code}
2023    \textcolor{keywordflow}{return} error;
2024 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a04094e358f18adc2d7ad8686e3258b93}\label{tls_8c_a04094e358f18adc2d7ad8686e3258b93}} 
\index{tls.\+c@{tls.\+c}!tls\+Restore\+Session\+State@{tls\+Restore\+Session\+State}}
\index{tls\+Restore\+Session\+State@{tls\+Restore\+Session\+State}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Restore\+Session\+State()}{tlsRestoreSessionState()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Restore\+Session\+State (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$}]{session }\end{DoxyParamCaption})}



Restore T\+LS session. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em session} & Pointer to the session state to be restored \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2585 of file tls.\+c.


\begin{DoxyCode}
2587 \{
2588    \textcolor{comment}{//Check parameters}
2589    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || session == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2590       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2591 
2592 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
2593    \textcolor{comment}{//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?}
2594    \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version} >= \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0} && session->
      \hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version} <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
2595    \{
2596       \textcolor{comment}{//Valid session state?}
2597       \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite} != 0 && session->\hyperlink{structTlsSessionState_a679cbf66e41da3f5e6ae7d25c8ef363e}{sessionIdLen} > 0)
2598       \{
2599          \textcolor{comment}{//Restore session parameters}
2600          context->version = session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version};
2601          context->cipherSuite.identifier = session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite};
2602 
2603          \textcolor{comment}{//Restore session identifier}
2604          memcpy(context->sessionId, session->\hyperlink{structTlsSessionState_a784cd9c073b07b51f1cf315e9fb19768}{sessionId}, session->
      \hyperlink{structTlsSessionState_a679cbf66e41da3f5e6ae7d25c8ef363e}{sessionIdLen});
2605          context->sessionIdLen = session->\hyperlink{structTlsSessionState_a679cbf66e41da3f5e6ae7d25c8ef363e}{sessionIdLen};
2606 
2607          \textcolor{comment}{//Restore master secret}
2608          memcpy(context->masterSecret, session->\hyperlink{structTlsSessionState_af48b2d61b9483b6f1bb698c719c5bd3f}{secret}, 
      \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE});
2609 
2610 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
2611          \textcolor{comment}{//Extended master secret computation}
2612          context->extendedMasterSecretExtReceived = session->
      \hyperlink{structTlsSessionState_a1345e3eac1e2a0fb86af8e0f0c7b123a}{extendedMasterSecret};
2613 \textcolor{preprocessor}{#endif}
2614       \}
2615    \}
2616    \textcolor{keywordflow}{else}
2617 \textcolor{preprocessor}{#endif}
2618 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
2619    \textcolor{comment}{//TLS 1.3 currently selected?}
2620    \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version} == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
2621    \{
2622       \textcolor{comment}{//Valid ticket?}
2623       \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite} != 0 && session->ticketLen > 0)
2624       \{
2625          \textcolor{comment}{//Restore session parameters}
2626          context->version = session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version};
2627          context->ticketCipherSuite = session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite};
2628          context->ticketHashAlgo = session->ticketHashAlgo;
2629          context->ticketTimestamp = session->ticketTimestamp;
2630          context->ticketLifetime = session->ticketLifetime;
2631          context->ticketAgeAdd = session->ticketAgeAdd;
2632          context->maxEarlyDataSize = session->maxEarlyDataSize;
2633          context->\hyperlink{structTlsSessionState_a679cbf66e41da3f5e6ae7d25c8ef363e}{sessionIdLen} = 0;
2634 
2635          \textcolor{comment}{//Release existing session ticket, if any}
2636          \textcolor{keywordflow}{if}(context->ticket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2637          \{
2638             memset(context->ticket, 0, context->ticketLen);
2639             \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->ticket);
2640             context->ticket = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
2641             context->ticketLen = 0;
2642          \}
2643 
2644          \textcolor{comment}{//Allocate a memory block to hold the ticket}
2645          context->ticket = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(session->ticketLen);
2646          \textcolor{comment}{//Failed to allocate memory?}
2647          \textcolor{keywordflow}{if}(context->ticket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2648             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
2649 
2650          \textcolor{comment}{//Copy session ticket}
2651          memcpy(context->ticket, session->ticket, session->ticketLen);
2652          context->ticketLen = session->ticketLen;
2653 
2654          \textcolor{comment}{//Each PSK established via the ticket mechanism is associated with}
2655          \textcolor{comment}{//a single hash algorithm}
2656          \textcolor{keywordflow}{if}(session->ticketHashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256})
2657             context->ticketPskLen = \hyperlink{sha256_8h_a81efbc0fc101b06a914f7ff9e2fbc0e9}{SHA256\_DIGEST\_SIZE};
2658          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(session->ticketHashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384})
2659             context->ticketPskLen = \hyperlink{sha384_8h_afb6d310df497c25c1e85af07f71ee2b3}{SHA384\_DIGEST\_SIZE};
2660          \textcolor{keywordflow}{else}
2661             context->ticketPskLen = 0;
2662 
2663          \textcolor{comment}{//Copy ticket PSK}
2664          memcpy(context->ticketPsk, session->\hyperlink{structTlsSessionState_af48b2d61b9483b6f1bb698c719c5bd3f}{secret}, context->ticketPskLen);
2665 
2666 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
2667          \textcolor{comment}{//Release ALPN protocol, if any}
2668          \textcolor{keywordflow}{if}(context->ticketAlpn != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2669          \{
2670             \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->ticketAlpn);
2671             context->ticketAlpn = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
2672          \}
2673 
2674          \textcolor{comment}{//Valid ALPN protocol?}
2675          \textcolor{keywordflow}{if}(session->ticketAlpn != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2676          \{
2677             \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2678 
2679             \textcolor{comment}{//Retrieve the length of the ALPN protocol}
2680             n = strlen(session->ticketAlpn);
2681 
2682             \textcolor{comment}{//Allocate a memory block to hold the ALPN protocol}
2683             context->ticketAlpn = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(n + 1);
2684             \textcolor{comment}{//Failed to allocate memory?}
2685             \textcolor{keywordflow}{if}(context->ticketAlpn == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2686                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
2687 
2688             \textcolor{comment}{//Copy the ALPN protocol associated with the ticket}
2689             strcpy(context->ticketAlpn, session->ticketAlpn);
2690          \}
2691 \textcolor{preprocessor}{#endif}
2692       \}
2693    \}
2694    \textcolor{keywordflow}{else}
2695 \textcolor{preprocessor}{#endif}
2696    \textcolor{comment}{//Invalid TLS version?}
2697    \{
2698       \textcolor{comment}{//Do not restore session state}
2699    \}
2700 
2701    \textcolor{comment}{//Successful processing}
2702    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2703 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}\label{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}} 
\index{tls.\+c@{tls.\+c}!tls\+Save\+Session\+State@{tls\+Save\+Session\+State}}
\index{tls\+Save\+Session\+State@{tls\+Save\+Session\+State}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Save\+Session\+State()}{tlsSaveSessionState()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Save\+Session\+State (\begin{DoxyParamCaption}\item[{const \hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{structTlsSessionState}{Tls\+Session\+State} $\ast$}]{session }\end{DoxyParamCaption})}



Save T\+LS session. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em session} & Pointer to the session state \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2427 of file tls.\+c.


\begin{DoxyCode}
2429 \{
2430    \textcolor{comment}{//Check parameters}
2431    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || session == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2432       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2433 
2434    \textcolor{comment}{//Release previous session state}
2435    \hyperlink{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}{tlsFreeSessionState}(session);
2436 
2437 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
2438    \textcolor{comment}{//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?}
2439    \textcolor{keywordflow}{if}(context->version >= \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0} && context->version <= 
      \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
2440    \{
2441       \textcolor{comment}{//Valid session parameters?}
2442       \textcolor{keywordflow}{if}(context->cipherSuite.identifier != 0 &&
2443          context->sessionIdLen > 0)
2444       \{
2445          \textcolor{comment}{//Get current time}
2446          session->\hyperlink{structTlsSessionState_a6923caefbda8f5283ff9920459485f0b}{timestamp} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
2447 
2448          \textcolor{comment}{//Save session parameters}
2449          session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version} = context->version;
2450          session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite} = context->cipherSuite.identifier;
2451 
2452          \textcolor{comment}{//Save session identifier}
2453          memcpy(session->\hyperlink{structTlsSessionState_a784cd9c073b07b51f1cf315e9fb19768}{sessionId}, context->sessionId, context->sessionIdLen);
2454          session->\hyperlink{structTlsSessionState_a679cbf66e41da3f5e6ae7d25c8ef363e}{sessionIdLen} = context->sessionIdLen;
2455 
2456          \textcolor{comment}{//Save master secret}
2457          memcpy(session->\hyperlink{structTlsSessionState_af48b2d61b9483b6f1bb698c719c5bd3f}{secret}, context->masterSecret, 
      \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE});
2458 
2459 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
2460          \textcolor{comment}{//Extended master secret computation}
2461          session->\hyperlink{structTlsSessionState_a1345e3eac1e2a0fb86af8e0f0c7b123a}{extendedMasterSecret} = context->extendedMasterSecretExtReceived;
2462 \textcolor{preprocessor}{#endif}
2463 
2464 \textcolor{preprocessor}{#if (TLS\_SNI\_SUPPORT == ENABLED)}
2465          \textcolor{comment}{//Any ServerName extension received by the server?}
2466          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER} &&
2467             context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2468          \{
2469             \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2470 
2471             \textcolor{comment}{//Retrieve the length of the server name}
2472             n = strlen(context->serverName);
2473 
2474             \textcolor{comment}{//Allocate a memory block to hold the server name}
2475             session->\hyperlink{structTlsSessionState_a9e4b28fa363d10a42e24879e0ba57813}{serverName} = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(n + 1);
2476             \textcolor{comment}{//Failed to allocate memory?}
2477             \textcolor{keywordflow}{if}(session->\hyperlink{structTlsSessionState_a9e4b28fa363d10a42e24879e0ba57813}{serverName} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2478             \{
2479                \textcolor{comment}{//Clean up side effects}
2480                \hyperlink{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}{tlsFreeSessionState}(session);
2481                \textcolor{comment}{//Report an error}
2482                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
2483             \}
2484 
2485             \textcolor{comment}{//Copy the server name}
2486             strcpy(session->\hyperlink{structTlsSessionState_a9e4b28fa363d10a42e24879e0ba57813}{serverName}, context->serverName);
2487          \}
2488 \textcolor{preprocessor}{#endif}
2489       \}
2490    \}
2491    \textcolor{keywordflow}{else}
2492 \textcolor{preprocessor}{#endif}
2493 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
2494    \textcolor{comment}{//TLS 1.3 currently selected?}
2495    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
2496    \{
2497       \textcolor{comment}{//Valid session parameters?}
2498       \textcolor{keywordflow}{if}(context->cipherSuite.identifier != 0 &&
2499          context->cipherSuite.prfHashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} &&
2500          context->ticketLen > 0)
2501       \{
2502          \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
2503 
2504          \textcolor{comment}{//Point to the cipher suite hash algorithm}
2505          hashAlgo = context->cipherSuite.prfHashAlgo;
2506 
2507          \textcolor{comment}{//Allocate a memory block to hold the ticket}
2508          session->ticket = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(context->ticketLen);
2509          \textcolor{comment}{//Failed to allocate memory?}
2510          \textcolor{keywordflow}{if}(session->ticket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2511             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
2512 
2513          \textcolor{comment}{//Get current time}
2514          session->\hyperlink{structTlsSessionState_a6923caefbda8f5283ff9920459485f0b}{timestamp} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
2515 
2516          \textcolor{comment}{//Save session parameters}
2517          session->\hyperlink{structTlsSessionState_a174320f3867df007a4315bfa7a84e42c}{version} = context->version;
2518          session->\hyperlink{structTlsSessionState_a645a198fee226b387ad71fa2df860bd2}{cipherSuite} = context->cipherSuite.identifier;
2519          session->ticketTimestamp = context->ticketTimestamp;
2520          session->ticketLifetime = context->ticketLifetime;
2521          session->ticketAgeAdd = context->ticketAgeAdd;
2522          session->maxEarlyDataSize = context->maxEarlyDataSize;
2523 
2524          \textcolor{comment}{//Copy session ticket}
2525          memcpy(session->ticket, context->ticket, context->ticketLen);
2526          session->ticketLen = context->ticketLen;
2527 
2528          \textcolor{comment}{//Each PSK established via the ticket mechanism is associated with}
2529          \textcolor{comment}{//a single hash algorithm}
2530          \textcolor{keywordflow}{if}(hashAlgo == \hyperlink{tls__misc_8c_a0540f6f41d033803f8c6b9f5efe391e8}{tlsGetHashAlgo}(\hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256}))
2531             session->ticketHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
2532          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(hashAlgo == \hyperlink{tls__misc_8c_a0540f6f41d033803f8c6b9f5efe391e8}{tlsGetHashAlgo}(\hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384}))
2533             session->ticketHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
2534          \textcolor{keywordflow}{else}
2535             session->ticketHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da5f0d1790061632495ba22e58486033a3}{TLS\_HASH\_ALGO\_NONE};
2536 
2537          \textcolor{comment}{//Copy ticket PSK}
2538          memcpy(session->\hyperlink{structTlsSessionState_af48b2d61b9483b6f1bb698c719c5bd3f}{secret}, context->ticketPsk, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize});
2539 
2540 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
2541          \textcolor{comment}{//Valid ALPN protocol?}
2542          \textcolor{keywordflow}{if}(context->selectedProtocol != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2543          \{
2544             \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2545 
2546             \textcolor{comment}{//Retrieve the length of the ALPN protocol}
2547             n = strlen(context->selectedProtocol);
2548 
2549             \textcolor{comment}{//Allocate a memory block to hold the ALPN protocol}
2550             session->ticketAlpn = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(n + 1);
2551             \textcolor{comment}{//Failed to allocate memory?}
2552             \textcolor{keywordflow}{if}(session->ticketAlpn == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2553             \{
2554                \textcolor{comment}{//Clean up side effects}
2555                \hyperlink{tls_8c_a6e78d966a9bcd9eb6210c996389f6551}{tlsFreeSessionState}(session);
2556                \textcolor{comment}{//Report an error}
2557                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
2558             \}
2559 
2560             \textcolor{comment}{//Copy the ALPN protocol associated with the ticket}
2561             strcpy(session->ticketAlpn, context->selectedProtocol);
2562          \}
2563 \textcolor{preprocessor}{#endif}
2564       \}
2565    \}
2566    \textcolor{keywordflow}{else}
2567 \textcolor{preprocessor}{#endif}
2568    \textcolor{comment}{//Invalid TLS version?}
2569    \{
2570       \textcolor{comment}{//Do not save session state}
2571    \}
2572 
2573    \textcolor{comment}{//Successful processing}
2574    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2575 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_af49cf6564348288916f822239b6ebe06}\label{tls_8c_af49cf6564348288916f822239b6ebe06}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Alpn\+Protocol\+List@{tls\+Set\+Alpn\+Protocol\+List}}
\index{tls\+Set\+Alpn\+Protocol\+List@{tls\+Set\+Alpn\+Protocol\+List}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Alpn\+Protocol\+List()}{tlsSetAlpnProtocolList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Alpn\+Protocol\+List (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{protocol\+List }\end{DoxyParamCaption})}



Set the list of supported A\+L\+PN protocols. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em protocol\+List} & Comma-\/delimited list of supported protocols \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 807 of file tls.\+c.


\begin{DoxyCode}
808 \{
809 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
810    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
811 
812    \textcolor{comment}{//Check parameters}
813    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || protocolList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
814       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
815 
816    \textcolor{comment}{//Retrieve the length of the list}
817    length = strlen(protocolList);
818 
819    \textcolor{comment}{//Check whether the list of supported protocols has already been configured}
820    \textcolor{keywordflow}{if}(context->protocolList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
821    \{
822       \textcolor{comment}{//Release memory}
823       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->protocolList);
824       context->protocolList = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
825    \}
826 
827    \textcolor{comment}{//Check whether the list of protocols is valid}
828    \textcolor{keywordflow}{if}(length > 0)
829    \{
830       \textcolor{comment}{//Allocate a memory block to hold the list}
831       context->protocolList = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(length + 1);
832       \textcolor{comment}{//Failed to allocate memory?}
833       \textcolor{keywordflow}{if}(context->protocolList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
834          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
835 
836       \textcolor{comment}{//Save the list of supported protocols}
837       strcpy(context->protocolList, protocolList);
838    \}
839 
840    \textcolor{comment}{//Successful processing}
841    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
842 \textcolor{preprocessor}{#else}
843    \textcolor{comment}{//ALPN is not implemented}
844    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
845 \textcolor{preprocessor}{#endif}
846 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}\label{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Buffer\+Size@{tls\+Set\+Buffer\+Size}}
\index{tls\+Set\+Buffer\+Size@{tls\+Set\+Buffer\+Size}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Buffer\+Size()}{tlsSetBufferSize()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Buffer\+Size (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{size\+\_\+t}]{tx\+Buffer\+Size,  }\item[{size\+\_\+t}]{rx\+Buffer\+Size }\end{DoxyParamCaption})}



Set T\+LS buffer size. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em tx\+Buffer\+Size} & TX buffer size \\
\hline
\mbox{\tt in}  & {\em rx\+Buffer\+Size} & RX buffer size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 481 of file tls.\+c.


\begin{DoxyCode}
483 \{
484    \textcolor{comment}{//Invalid TLS context?}
485    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
486       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
487 
488    \textcolor{comment}{//Check parameters}
489    \textcolor{keywordflow}{if}(txBufferSize < \hyperlink{tls_8h_ae0049a9930e368217be256828ec9adbc}{TLS\_MIN\_RECORD\_LENGTH} ||
490       rxBufferSize < \hyperlink{tls_8h_ae0049a9930e368217be256828ec9adbc}{TLS\_MIN\_RECORD\_LENGTH})
491    \{
492       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
493    \}
494 
495    \textcolor{comment}{//Maximum number of plaintext data the TX and RX buffers can hold}
496    context->txBufferMaxLen = txBufferSize;
497    context->rxBufferMaxLen = rxBufferSize;
498 
499 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
500    \textcolor{comment}{//Calculate the required size for the TX buffer}
501    context->txBufferSize = txBufferSize + \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord}) +
502       \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
503 
504    \textcolor{comment}{//Calculate the required size for the RX buffer}
505    context->rxBufferSize = rxBufferSize + \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord}) +
506       \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
507 \textcolor{preprocessor}{#else}
508    \textcolor{comment}{//Calculate the required size for the TX buffer}
509    context->txBufferSize = txBufferSize + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord}) +
510       \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
511 
512    \textcolor{comment}{//Calculate the required size for the RX buffer}
513    context->rxBufferSize = rxBufferSize + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord}) +
514       \hyperlink{tls_8h_aac714d79ab3c96326a6b5adfd67873aa}{TLS\_MAX\_RECORD\_OVERHEAD};
515 \textcolor{preprocessor}{#endif}
516 
517    \textcolor{comment}{//Successful processing}
518    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
519 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ae84c8a86b42f4ac64b499c95acfcee7c}\label{tls_8c_ae84c8a86b42f4ac64b499c95acfcee7c}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Cache@{tls\+Set\+Cache}}
\index{tls\+Set\+Cache@{tls\+Set\+Cache}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Cache()}{tlsSetCache()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Cache (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{structTlsCache}{Tls\+Cache} $\ast$}]{cache }\end{DoxyParamCaption})}



Set session cache. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cache} & Session cache that will be used to save/resume T\+LS sessions \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 438 of file tls.\+c.


\begin{DoxyCode}
439 \{
440    \textcolor{comment}{//Check parameters}
441    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
442       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
443 
444    \textcolor{comment}{//The cache will be used to save/resume TLS sessions}
445    context->cache = cache;
446 
447    \textcolor{comment}{//Successful processing}
448    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
449 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a4a11f8e1d2d43b173021a912b1772bde}\label{tls_8c_a4a11f8e1d2d43b173021a912b1772bde}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Certificate\+Verify\+Callback@{tls\+Set\+Certificate\+Verify\+Callback}}
\index{tls\+Set\+Certificate\+Verify\+Callback@{tls\+Set\+Certificate\+Verify\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Certificate\+Verify\+Callback()}{tlsSetCertificateVerifyCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Certificate\+Verify\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a1d220d8b5abc08e3ce8a1278d2aeac5e}{Tls\+Cert\+Verify\+Callback}}]{cert\+Verify\+Callback,  }\item[{void $\ast$}]{param }\end{DoxyParamCaption})}



Set certificate verification callback. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cert\+Verify\+Callback} & Certificate verification callback \\
\hline
\mbox{\tt in}  & {\em param} & An opaque pointer passed to the callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1247 of file tls.\+c.


\begin{DoxyCode}
1249 \{
1250    \textcolor{comment}{//Invalid TLS context?}
1251    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1252       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1253 
1254    \textcolor{comment}{//Save certificate verification callback}
1255    context->certVerifyCallback = certVerifyCallback;
1256 
1257    \textcolor{comment}{//This opaque pointer will be directly passed to the callback function}
1258    context->certVerifyParam = param;
1259 
1260    \textcolor{comment}{//Successful processing}
1261    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1262 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ae15fab3d6c6b185bc7ccb1207c2b73cf}\label{tls_8c_ae15fab3d6c6b185bc7ccb1207c2b73cf}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Cipher\+Suites@{tls\+Set\+Cipher\+Suites}}
\index{tls\+Set\+Cipher\+Suites@{tls\+Set\+Cipher\+Suites}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Cipher\+Suites()}{tlsSetCipherSuites()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Cipher\+Suites (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$}]{cipher\+Suites,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{length }\end{DoxyParamCaption})}



Specify the list of allowed cipher suites. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cipher\+Suites} & List of allowed cipher suites (most preferred first) \\
\hline
\mbox{\tt in}  & {\em length} & Number of cipher suites in the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 564 of file tls.\+c.


\begin{DoxyCode}
566 \{
567    \textcolor{comment}{//Invalid TLS context?}
568    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
569       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
570 
571    \textcolor{comment}{//Check parameters}
572    \textcolor{keywordflow}{if}(cipherSuites == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
573       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
574 
575    \textcolor{comment}{//Restrict the cipher suites that can be used}
576    context->cipherSuites = cipherSuites;
577    context->numCipherSuites = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
578 
579    \textcolor{comment}{//Successful processing}
580    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
581 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ae54f98cd8c0ec0c2f59a8a059f25ba2e}\label{tls_8c_ae54f98cd8c0ec0c2f59a8a059f25ba2e}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Client\+Auth\+Mode@{tls\+Set\+Client\+Auth\+Mode}}
\index{tls\+Set\+Client\+Auth\+Mode@{tls\+Set\+Client\+Auth\+Mode}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Client\+Auth\+Mode()}{tlsSetClientAuthMode()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Client\+Auth\+Mode (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a657708ec632fe90da5a94cf667118527}{Tls\+Client\+Auth\+Mode}}]{mode }\end{DoxyParamCaption})}



Set client authentication mode (for servers only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em mode} & Client authentication mode \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 459 of file tls.\+c.


\begin{DoxyCode}
460 \{
461    \textcolor{comment}{//Invalid TLS context?}
462    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
463       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
464 
465    \textcolor{comment}{//Save client authentication mode}
466    context->clientAuthMode = \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode};
467 
468    \textcolor{comment}{//Successful processing}
469    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
470 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a8713543db673ee5a36b2fda92e082c6b}\label{tls_8c_a8713543db673ee5a36b2fda92e082c6b}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Connection\+End@{tls\+Set\+Connection\+End}}
\index{tls\+Set\+Connection\+End@{tls\+Set\+Connection\+End}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Connection\+End()}{tlsSetConnectionEnd()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Connection\+End (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End}}]{entity }\end{DoxyParamCaption})}



Set operation mode (client or server) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em entity} & Specifies whether this entity is considered a client or a server \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 312 of file tls.\+c.


\begin{DoxyCode}
313 \{
314    \textcolor{comment}{//Invalid TLS context?}
315    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
316       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
317 
318    \textcolor{comment}{//Check parameters}
319    \textcolor{keywordflow}{if}(entity != \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT} && entity != 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
320       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
321 
322    \textcolor{comment}{//Check whether TLS operates as a client or a server}
323    context->entity = entity;
324 
325    \textcolor{comment}{//Successful processing}
326    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
327 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ac710383726f5885fa045004947ea9349}\label{tls_8c_ac710383726f5885fa045004947ea9349}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Cookie\+Callbacks@{tls\+Set\+Cookie\+Callbacks}}
\index{tls\+Set\+Cookie\+Callbacks@{tls\+Set\+Cookie\+Callbacks}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Cookie\+Callbacks()}{tlsSetCookieCallbacks()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Cookie\+Callbacks (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{dtls__misc_8h_a26c71101670183fb3f3a89aa3084800d}{Dtls\+Cookie\+Generate\+Callback}}]{cookie\+Generate\+Callback,  }\item[{\hyperlink{dtls__misc_8h_ad815ff6a1d5fa9f07fde4475168c6538}{Dtls\+Cookie\+Verify\+Callback}}]{cookie\+Verify\+Callback,  }\item[{void $\ast$}]{param }\end{DoxyParamCaption})}



Set cookie generation/verification callbacks (for D\+T\+LS only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cookie\+Generate\+Callback} & Cookie generation callback function \\
\hline
\mbox{\tt in}  & {\em cookie\+Verify\+Callback} & Cookie verification callback function \\
\hline
\mbox{\tt in}  & {\em param} & An opaque pointer passed to the callback functions \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1416 of file tls.\+c.


\begin{DoxyCode}
1419 \{
1420 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1421    \textcolor{comment}{//Invalid TLS context?}
1422    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1423       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1424 
1425    \textcolor{comment}{//Check parameters}
1426    \textcolor{keywordflow}{if}(cookieGenerateCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || cookieVerifyCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1427       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1428 
1429    \textcolor{comment}{//Save cookie generation/verification callback functions}
1430    context->cookieGenerateCallback = cookieGenerateCallback;
1431    context->cookieVerifyCallback = cookieVerifyCallback;
1432 
1433    \textcolor{comment}{//This opaque pointer will be directly passed to the callback functions}
1434    context->cookieParam = param;
1435 
1436    \textcolor{comment}{//Successful processing}
1437    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1438 \textcolor{preprocessor}{#else}
1439    \textcolor{comment}{//DTLS is not implemented}
1440    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1441 \textcolor{preprocessor}{#endif}
1442 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a970ba4db0f95d0764c9c24b488e10b33}\label{tls_8c_a970ba4db0f95d0764c9c24b488e10b33}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Dh\+Parameters@{tls\+Set\+Dh\+Parameters}}
\index{tls\+Set\+Dh\+Parameters@{tls\+Set\+Dh\+Parameters}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Dh\+Parameters()}{tlsSetDhParameters()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Dh\+Parameters (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{params,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Import Diffie-\/\+Hellman parameters. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em params} & P\+EM structure that holds Diffie-\/\+Hellman parameters \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the D\+ER structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 646 of file tls.\+c.


\begin{DoxyCode}
648 \{
649 \textcolor{preprocessor}{#if (TLS\_DH\_SUPPORT == ENABLED)}
650    \textcolor{comment}{//Invalid TLS context?}
651    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
652       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
653 
654    \textcolor{comment}{//Check parameters}
655    \textcolor{keywordflow}{if}(params == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
656       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
657 
658    \textcolor{comment}{//Decode the PEM structure that holds Diffie-Hellman parameters}
659    \textcolor{keywordflow}{return} \hyperlink{certificate_2pem__import_8c_a0afa6464bcb0c1a2e17488fef1d3c3a8}{pemImportDhParameters}(params, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &context->dhContext.params);
660 \textcolor{preprocessor}{#else}
661    \textcolor{comment}{//Diffie-Hellman is not implemented}
662    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
663 \textcolor{preprocessor}{#endif}
664 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a2393e1468449569ce84c7d40db999ca2}\label{tls_8c_a2393e1468449569ce84c7d40db999ca2}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Ecdh\+Callback@{tls\+Set\+Ecdh\+Callback}}
\index{tls\+Set\+Ecdh\+Callback@{tls\+Set\+Ecdh\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Ecdh\+Callback()}{tlsSetEcdhCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Ecdh\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_ad0cd644ab2e901c494d04e42bcc832d0}{Tls\+Ecdh\+Callback}}]{ecdh\+Callback }\end{DoxyParamCaption})}



Register E\+C\+DH key agreement callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em ecdh\+Callback} & E\+C\+DH callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 674 of file tls.\+c.


\begin{DoxyCode}
675 \{
676 \textcolor{preprocessor}{#if (TLS\_ECC\_CALLBACK\_SUPPORT == ENABLED)}
677    \textcolor{comment}{//Check parameters}
678    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || ecdhCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
679       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
680 
681    \textcolor{comment}{//Save the ECDH key agreement callback function}
682    context->ecdhCallback = ecdhCallback;
683 
684    \textcolor{comment}{//Successful processing}
685    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
686 \textcolor{preprocessor}{#else}
687    \textcolor{comment}{//PSK key exchange is not implemented}
688    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
689 \textcolor{preprocessor}{#endif}
690 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a032b79859552948f39875b0d1560c2fd}\label{tls_8c_a032b79859552948f39875b0d1560c2fd}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Ecdsa\+Sign\+Callback@{tls\+Set\+Ecdsa\+Sign\+Callback}}
\index{tls\+Set\+Ecdsa\+Sign\+Callback@{tls\+Set\+Ecdsa\+Sign\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Ecdsa\+Sign\+Callback()}{tlsSetEcdsaSignCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Ecdsa\+Sign\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a6f737cb17e8452166e73c85b7d5a9256}{Tls\+Ecdsa\+Sign\+Callback}}]{ecdsa\+Sign\+Callback }\end{DoxyParamCaption})}



E\+C\+D\+SA signature generation callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em ecdsa\+Sign\+Callback} & E\+C\+D\+SA signature generation callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 700 of file tls.\+c.


\begin{DoxyCode}
702 \{
703 \textcolor{preprocessor}{#if (TLS\_ECC\_CALLBACK\_SUPPORT == ENABLED)}
704    \textcolor{comment}{//Check parameters}
705    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || ecdsaSignCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
706       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
707 
708    \textcolor{comment}{//Save the ECDSA signature generation callback function}
709    context->ecdsaSignCallback = ecdsaSignCallback;
710 
711    \textcolor{comment}{//Successful processing}
712    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
713 \textcolor{preprocessor}{#else}
714    \textcolor{comment}{//PSK key exchange is not implemented}
715    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
716 \textcolor{preprocessor}{#endif}
717 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aad3f807b39648ba221d85f9dbbaf83d1}\label{tls_8c_aad3f807b39648ba221d85f9dbbaf83d1}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Ecdsa\+Verify\+Callback@{tls\+Set\+Ecdsa\+Verify\+Callback}}
\index{tls\+Set\+Ecdsa\+Verify\+Callback@{tls\+Set\+Ecdsa\+Verify\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Ecdsa\+Verify\+Callback()}{tlsSetEcdsaVerifyCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Ecdsa\+Verify\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a1d84397a61d8222779e78997e5fdfa53}{Tls\+Ecdsa\+Verify\+Callback}}]{ecdsa\+Verify\+Callback }\end{DoxyParamCaption})}



Register E\+C\+D\+SA signature verification callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em ecdsa\+Verify\+Callback} & E\+C\+D\+SA signature verification callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 727 of file tls.\+c.


\begin{DoxyCode}
729 \{
730 \textcolor{preprocessor}{#if (TLS\_ECC\_CALLBACK\_SUPPORT == ENABLED)}
731    \textcolor{comment}{//Check parameters}
732    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || ecdsaVerifyCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
733       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
734 
735    \textcolor{comment}{//Save the ECDSA signature verification callback function}
736    context->ecdsaVerifyCallback = ecdsaVerifyCallback;
737 
738    \textcolor{comment}{//Successful processing}
739    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
740 \textcolor{preprocessor}{#else}
741    \textcolor{comment}{//PSK key exchange is not implemented}
742    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
743 \textcolor{preprocessor}{#endif}
744 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a4f0aeb38ece2faf93030ba76b9eb539a}\label{tls_8c_a4f0aeb38ece2faf93030ba76b9eb539a}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Key\+Log\+Callback@{tls\+Set\+Key\+Log\+Callback}}
\index{tls\+Set\+Key\+Log\+Callback@{tls\+Set\+Key\+Log\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Key\+Log\+Callback()}{tlsSetKeyLogCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Key\+Log\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a562fd539fc11782835f2692e3dcaf5b1}{Tls\+Key\+Log\+Callback}}]{key\+Log\+Callback }\end{DoxyParamCaption})}



Register key logging callback function (for debugging purpose only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em key\+Log\+Callback} & Key logging callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 754 of file tls.\+c.


\begin{DoxyCode}
756 \{
757 \textcolor{preprocessor}{#if (TLS\_KEY\_LOG\_SUPPORT == ENABLED)}
758    \textcolor{comment}{//Check parameters}
759    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || keyLogCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
760       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
761 
762    \textcolor{comment}{//Save the key logging callback function}
763    context->keyLogCallback = keyLogCallback;
764 
765    \textcolor{comment}{//Successful processing}
766    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
767 \textcolor{preprocessor}{#else}
768    \textcolor{comment}{//Key logging is not implemented}
769    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
770 \textcolor{preprocessor}{#endif}
771 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_af54f39c0dccdef05ab98c58b60548ff6}\label{tls_8c_af54f39c0dccdef05ab98c58b60548ff6}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Max\+Early\+Data\+Size@{tls\+Set\+Max\+Early\+Data\+Size}}
\index{tls\+Set\+Max\+Early\+Data\+Size@{tls\+Set\+Max\+Early\+Data\+Size}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Max\+Early\+Data\+Size()}{tlsSetMaxEarlyDataSize()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Max\+Early\+Data\+Size (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{size\+\_\+t}]{max\+Early\+Data\+Size }\end{DoxyParamCaption})}



Send the maximum amount of 0-\/\+R\+TT data the server can accept. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em max\+Early\+Data\+Size} & Maximum amount of 0-\/\+R\+TT data that the client is allowed to send \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1480 of file tls.\+c.


\begin{DoxyCode}
1481 \{
1482 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
1483    \textcolor{comment}{//Invalid TLS context?}
1484    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1485       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1486 
1487    \textcolor{comment}{//Save the maximum amount of 0-RTT data that the client is allowed to send}
1488    context->maxEarlyDataSize = maxEarlyDataSize;
1489 
1490    \textcolor{comment}{//Successful processing}
1491    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1492 \textcolor{preprocessor}{#else}
1493    \textcolor{comment}{//Not implemented}
1494    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1495 \textcolor{preprocessor}{#endif}
1496 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a8a6e12f6dcd37d688cef179d03df30fe}\label{tls_8c_a8a6e12f6dcd37d688cef179d03df30fe}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Max\+Fragment\+Length@{tls\+Set\+Max\+Fragment\+Length}}
\index{tls\+Set\+Max\+Fragment\+Length@{tls\+Set\+Max\+Fragment\+Length}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Max\+Fragment\+Length()}{tlsSetMaxFragmentLength()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Max\+Fragment\+Length (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{size\+\_\+t}]{max\+Frag\+Len }\end{DoxyParamCaption})}



Set maximum fragment length. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em max\+Frag\+Len} & Maximum fragment length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 529 of file tls.\+c.


\begin{DoxyCode}
530 \{
531 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
532    \textcolor{comment}{//Invalid TLS context?}
533    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
534       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
535 
536    \textcolor{comment}{//Make sure the specified value is acceptable (ref to RFC 6066, section 4)}
537    \textcolor{keywordflow}{if}(maxFragLen != 512 && maxFragLen != 1024 &&
538       maxFragLen != 2048 && maxFragLen != 4096 &&
539       maxFragLen != 16384)
540    \{
541       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
542    \}
543 
544    \textcolor{comment}{//Set maximum fragment length}
545    context->maxFragLen = maxFragLen;
546 
547    \textcolor{comment}{//Successful processing}
548    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
549 \textcolor{preprocessor}{#else}
550    \textcolor{comment}{//Not implemented}
551    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
552 \textcolor{preprocessor}{#endif}
553 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aa16cfbb47616a1d4ce4fb89c73b0e5be}\label{tls_8c_aa16cfbb47616a1d4ce4fb89c73b0e5be}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Pmtu@{tls\+Set\+Pmtu}}
\index{tls\+Set\+Pmtu@{tls\+Set\+Pmtu}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Pmtu()}{tlsSetPmtu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Pmtu (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{size\+\_\+t}]{pmtu }\end{DoxyParamCaption})}



Set P\+M\+TU value (for D\+T\+LS only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em pmtu} & P\+M\+TU value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1358 of file tls.\+c.


\begin{DoxyCode}
1359 \{
1360 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1361    \textcolor{comment}{//Invalid TLS context?}
1362    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1363       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1364 
1365    \textcolor{comment}{//Make sure the PMTU value is acceptable}
1366    \textcolor{keywordflow}{if}(pmtu < \hyperlink{dtls__misc_8h_a6e7d2c344c14c4cdfc0cab99f5f19bb1}{DTLS\_MIN\_PMTU})
1367       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1368 
1369    \textcolor{comment}{//Save PMTU value}
1370    context->pmtu = pmtu;
1371 
1372    \textcolor{comment}{//Successful processing}
1373    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1374 \textcolor{preprocessor}{#else}
1375    \textcolor{comment}{//DTLS is not implemented}
1376    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1377 \textcolor{preprocessor}{#endif}
1378 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ac2692a338adfed355dfd82ea3ea4b497}\label{tls_8c_ac2692a338adfed355dfd82ea3ea4b497}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Preferred\+Group@{tls\+Set\+Preferred\+Group}}
\index{tls\+Set\+Preferred\+Group@{tls\+Set\+Preferred\+Group}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Preferred\+Group()}{tlsSetPreferredGroup()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Preferred\+Group (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{group }\end{DoxyParamCaption})}



Specify the preferred E\+C\+D\+HE or F\+F\+D\+HE group. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em group} & Preferred E\+C\+D\+HE or F\+F\+D\+HE named group \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 619 of file tls.\+c.


\begin{DoxyCode}
620 \{
621 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
622    \textcolor{comment}{//Invalid TLS context?}
623    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
624       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
625 
626    \textcolor{comment}{//Save the preferred named group}
627    context->preferredGroup = \hyperlink{tls13__misc_8h_accac7d4e29fafd4cff0799a0ef7902c7}{group};
628 
629    \textcolor{comment}{//Successful processing}
630    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
631 \textcolor{preprocessor}{#else}
632    \textcolor{comment}{//Not implemented}
633    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
634 \textcolor{preprocessor}{#endif}
635 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a46c2f7356836d7b28fde1a1eebf8c9b8}\label{tls_8c_a46c2f7356836d7b28fde1a1eebf8c9b8}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Prng@{tls\+Set\+Prng}}
\index{tls\+Set\+Prng@{tls\+Set\+Prng}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Prng()}{tlsSetPrng()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Prng (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context }\end{DoxyParamCaption})}



Set the pseudo-\/random number generator to be used. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 338 of file tls.\+c.


\begin{DoxyCode}
339 \{
340    \textcolor{comment}{//Invalid TLS context?}
341    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
342       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
343 
344    \textcolor{comment}{//Check parameters}
345    \textcolor{keywordflow}{if}(prngAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || prngContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
346       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
347 
348    \textcolor{comment}{//PRNG algorithm that will be used to generate random numbers}
349    context->prngAlgo = prngAlgo;
350    \textcolor{comment}{//PRNG context}
351    context->prngContext = prngContext;
352 
353    \textcolor{comment}{//Successful processing}
354    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
355 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a96d2fb0552236b74ee1fddc4a2d00d6d}\label{tls_8c_a96d2fb0552236b74ee1fddc4a2d00d6d}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Psk@{tls\+Set\+Psk}}
\index{tls\+Set\+Psk@{tls\+Set\+Psk}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Psk()}{tlsSetPsk()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Psk (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{psk,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Set the pre-\/shared key to be used. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em psk} & Pointer to the pre-\/shared key \\
\hline
\mbox{\tt in}  & {\em length} & Length of the pre-\/shared key, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 883 of file tls.\+c.


\begin{DoxyCode}
884 \{
885 \textcolor{preprocessor}{#if (TLS\_PSK\_SUPPORT == ENABLED)}
886    \textcolor{comment}{//Invalid TLS context?}
887    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
888       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
889 
890    \textcolor{comment}{//Check parameters}
891    \textcolor{keywordflow}{if}(psk == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
892       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
893 
894    \textcolor{comment}{//Check whether the pre-shared key has already been configured}
895    \textcolor{keywordflow}{if}(context->psk != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
896    \{
897       \textcolor{comment}{//Release memory}
898       memset(context->psk, 0, context->pskLen);
899       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->psk);
900       context->psk = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
901       context->pskLen = 0;
902    \}
903 
904    \textcolor{comment}{//Valid PSK?}
905    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
906    \{
907       \textcolor{comment}{//Allocate a memory block to hold the pre-shared key}
908       context->psk = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
909       \textcolor{comment}{//Failed to allocate memory?}
910       \textcolor{keywordflow}{if}(context->psk == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
911          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
912 
913       \textcolor{comment}{//Save the pre-shared key}
914       memcpy(context->psk, psk, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
915       \textcolor{comment}{//Save the length of the key}
916       context->pskLen = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
917    \}
918 
919 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
920    \textcolor{comment}{//For externally established PSKs, the hash algorithm must be set when the}
921    \textcolor{comment}{//PSK is established, or default to SHA-256 if no such algorithm is defined}
922    context->pskHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
923 
924    \textcolor{comment}{//The cipher suite must be provisioned along with the key}
925    context->pskCipherSuite = 0;
926 \textcolor{preprocessor}{#endif}
927 
928    \textcolor{comment}{//Successful processing}
929    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
930 \textcolor{preprocessor}{#else}
931    \textcolor{comment}{//PSK key exchange is not implemented}
932    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
933 \textcolor{preprocessor}{#endif}
934 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_af57c96be78b1896eab4a261dd9ebd4c8}\label{tls_8c_af57c96be78b1896eab4a261dd9ebd4c8}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Psk\+Callback@{tls\+Set\+Psk\+Callback}}
\index{tls\+Set\+Psk\+Callback@{tls\+Set\+Psk\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Psk\+Callback()}{tlsSetPskCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Psk\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a389807e343d8c65f8080ec9bd71fa91d}{Tls\+Psk\+Callback}}]{psk\+Callback }\end{DoxyParamCaption})}



Register the P\+SK callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em psk\+Callback} & P\+SK callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1042 of file tls.\+c.


\begin{DoxyCode}
1043 \{
1044 \textcolor{preprocessor}{#if (TLS\_PSK\_SUPPORT == ENABLED)}
1045    \textcolor{comment}{//Check parameters}
1046    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || pskCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1047       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1048 
1049    \textcolor{comment}{//Save the PSK callback function}
1050    context->pskCallback = pskCallback;
1051 
1052    \textcolor{comment}{//Successful processing}
1053    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1054 \textcolor{preprocessor}{#else}
1055    \textcolor{comment}{//PSK key exchange is not implemented}
1056    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1057 \textcolor{preprocessor}{#endif}
1058 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a045a9bf6e6d97e64d9f454d73690979b}\label{tls_8c_a045a9bf6e6d97e64d9f454d73690979b}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Psk\+Identity@{tls\+Set\+Psk\+Identity}}
\index{tls\+Set\+Psk\+Identity@{tls\+Set\+Psk\+Identity}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Psk\+Identity()}{tlsSetPskIdentity()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Psk\+Identity (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{psk\+Identity }\end{DoxyParamCaption})}



Set the P\+SK identity to be used by the client. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em psk\+Identity} & N\+U\+L\+L-\/terminated string that contains the P\+SK identity \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 944 of file tls.\+c.


\begin{DoxyCode}
945 \{
946 \textcolor{preprocessor}{#if (TLS\_PSK\_SUPPORT == ENABLED)}
947    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
948 
949    \textcolor{comment}{//Check parameters}
950    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || pskIdentity == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
951       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
952 
953    \textcolor{comment}{//Retrieve the length of the PSK identity}
954    length = strlen(pskIdentity);
955 
956    \textcolor{comment}{//Check whether the PSK identity has already been configured}
957    \textcolor{keywordflow}{if}(context->pskIdentity != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
958    \{
959       \textcolor{comment}{//Release memory}
960       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->pskIdentity);
961       context->pskIdentity = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
962    \}
963 
964    \textcolor{comment}{//Valid PSK identity?}
965    \textcolor{keywordflow}{if}(length > 0)
966    \{
967       \textcolor{comment}{//Allocate a memory block to hold the PSK identity}
968       context->pskIdentity = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(length + 1);
969       \textcolor{comment}{//Failed to allocate memory?}
970       \textcolor{keywordflow}{if}(context->pskIdentity == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
971          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
972 
973       \textcolor{comment}{//Save the PSK identity}
974       strcpy(context->pskIdentity, pskIdentity);
975    \}
976 
977    \textcolor{comment}{//Successful processing}
978    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
979 \textcolor{preprocessor}{#else}
980    \textcolor{comment}{//PSK key exchange is not implemented}
981    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
982 \textcolor{preprocessor}{#endif}
983 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a7c793df4875fa1b3ce5be75192f9dbeb}\label{tls_8c_a7c793df4875fa1b3ce5be75192f9dbeb}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Psk\+Identity\+Hint@{tls\+Set\+Psk\+Identity\+Hint}}
\index{tls\+Set\+Psk\+Identity\+Hint@{tls\+Set\+Psk\+Identity\+Hint}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Psk\+Identity\+Hint()}{tlsSetPskIdentityHint()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Psk\+Identity\+Hint (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{psk\+Identity\+Hint }\end{DoxyParamCaption})}



Set the P\+SK identity hint to be used by the server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em psk\+Identity\+Hint} & N\+U\+L\+L-\/terminated string that contains the P\+SK identity hint \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 993 of file tls.\+c.


\begin{DoxyCode}
994 \{
995 \textcolor{preprocessor}{#if (TLS\_PSK\_SUPPORT == ENABLED)}
996    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
997 
998    \textcolor{comment}{//Check parameters}
999    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || pskIdentityHint == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1000       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1001 
1002    \textcolor{comment}{//Retrieve the length of the PSK identity hint}
1003    length = strlen(pskIdentityHint);
1004 
1005    \textcolor{comment}{//Check whether the PSK identity hint has already been configured}
1006    \textcolor{keywordflow}{if}(context->pskIdentityHint != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1007    \{
1008       \textcolor{comment}{//Release memory}
1009       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->pskIdentityHint);
1010       context->pskIdentityHint = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1011    \}
1012 
1013    \textcolor{comment}{//Valid PSK identity hint?}
1014    \textcolor{keywordflow}{if}(length > 0)
1015    \{
1016       \textcolor{comment}{//Allocate a memory block to hold the PSK identity hint}
1017       context->pskIdentityHint = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(length + 1);
1018       \textcolor{comment}{//Failed to allocate memory?}
1019       \textcolor{keywordflow}{if}(context->pskIdentityHint == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1020          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1021 
1022       \textcolor{comment}{//Save the PSK identity hint}
1023       strcpy(context->pskIdentityHint, pskIdentityHint);
1024    \}
1025 
1026    \textcolor{comment}{//Successful processing}
1027    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1028 \textcolor{preprocessor}{#else}
1029    \textcolor{comment}{//PSK key exchange is not implemented}
1030    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1031 \textcolor{preprocessor}{#endif}
1032 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a67e86a6526e02a0c82e7abfded91c311}\label{tls_8c_a67e86a6526e02a0c82e7abfded91c311}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Rpk\+Verify\+Callback@{tls\+Set\+Rpk\+Verify\+Callback}}
\index{tls\+Set\+Rpk\+Verify\+Callback@{tls\+Set\+Rpk\+Verify\+Callback}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Rpk\+Verify\+Callback()}{tlsSetRpkVerifyCallback()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Rpk\+Verify\+Callback (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_ab1f0e6b85cdc60baae331dee4c1ec77b}{Tls\+Rpk\+Verify\+Callback}}]{rpk\+Verify\+Callback }\end{DoxyParamCaption})}



Register the raw public key verification callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em rpk\+Verify\+Callback} & R\+PK verification callback function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1068 of file tls.\+c.


\begin{DoxyCode}
1070 \{
1071 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
1072    \textcolor{comment}{//Check parameters}
1073    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || rpkVerifyCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1074       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1075 
1076    \textcolor{comment}{//Save the raw public key verification callback function}
1077    context->rpkVerifyCallback = rpkVerifyCallback;
1078 
1079    \textcolor{comment}{//Successful processing}
1080    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1081 \textcolor{preprocessor}{#else}
1082    \textcolor{comment}{//Raw public keys are not implemented}
1083    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1084 \textcolor{preprocessor}{#endif}
1085 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ab1b11bd61e4213b74fbd5bb6a9568795}\label{tls_8c_ab1b11bd61e4213b74fbd5bb6a9568795}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Server\+Name@{tls\+Set\+Server\+Name}}
\index{tls\+Set\+Server\+Name@{tls\+Set\+Server\+Name}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Server\+Name()}{tlsSetServerName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Server\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{server\+Name }\end{DoxyParamCaption})}



Set the server name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em server\+Name} & Fully qualified domain name of the server \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 365 of file tls.\+c.


\begin{DoxyCode}
366 \{
367    \textcolor{keywordtype}{size\_t} i;
368    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
369 
370    \textcolor{comment}{//Check parameters}
371    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || serverName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
372       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
373 
374    \textcolor{comment}{//Retrieve the length of the server name}
375    length = strlen(serverName);
376 
377    \textcolor{comment}{//Check whether the server name has already been configured}
378    \textcolor{keywordflow}{if}(context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
379    \{
380       \textcolor{comment}{//Release memory}
381       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->serverName);
382       context->serverName = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
383    \}
384 
385    \textcolor{comment}{//Valid server name?}
386    \textcolor{keywordflow}{if}(length > 0)
387    \{
388       \textcolor{comment}{//Allocate a memory block to hold the hostname}
389       context->serverName = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(length + 1);
390       \textcolor{comment}{//Failed to allocate memory?}
391       \textcolor{keywordflow}{if}(context->serverName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
392          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
393 
394       \textcolor{comment}{//Convert the hostname into lowercase}
395       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i++)
396          context->serverName[i] = tolower((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) serverName[i]);
397 
398       \textcolor{comment}{//Properly terminate the string with a NULL character}
399       context->serverName[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}] = \textcolor{charliteral}{'\(\backslash\)0'};
400    \}
401 
402    \textcolor{comment}{//Successful processing}
403    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
404 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a8d7b1f8f12e60a17d619e765a301f549}\label{tls_8c_a8d7b1f8f12e60a17d619e765a301f549}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Socket\+Callbacks@{tls\+Set\+Socket\+Callbacks}}
\index{tls\+Set\+Socket\+Callbacks@{tls\+Set\+Socket\+Callbacks}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Socket\+Callbacks()}{tlsSetSocketCallbacks()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Socket\+Callbacks (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a2d3369746cfcc1ff0830302cecea54ce}{Tls\+Socket\+Send\+Callback}}]{socket\+Send\+Callback,  }\item[{\hyperlink{tls_8h_a4588e69c3d9708c560b24ea04afa6a9c}{Tls\+Socket\+Receive\+Callback}}]{socket\+Receive\+Callback,  }\item[{\hyperlink{tls_8h_a55c0b32d3441cc70d62c51951ccaaa4e}{Tls\+Socket\+Handle}}]{handle }\end{DoxyParamCaption})}



Set socket send and receive callbacks. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em socket\+Send\+Callback} & Send callback function \\
\hline
\mbox{\tt in}  & {\em socket\+Receive\+Callback} & Receive callback function \\
\hline
\mbox{\tt in}  & {\em handle} & Socket handle \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 217 of file tls.\+c.


\begin{DoxyCode}
220 \{
221    \textcolor{comment}{//Invalid TLS context?}
222    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
223       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
224 
225    \textcolor{comment}{//Check parameters}
226    \textcolor{keywordflow}{if}(socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || socketReceiveCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
227       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
228 
229    \textcolor{comment}{//Save send and receive callback functions}
230    context->socketSendCallback = socketSendCallback;
231    context->socketReceiveCallback = socketReceiveCallback;
232 
233    \textcolor{comment}{//This socket handle will be directly passed to the callback functions}
234    context->socketHandle = handle;
235 
236    \textcolor{comment}{//Successful processing}
237    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
238 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a3f8105a2c084f10e82dba26e25cde3a7}\label{tls_8c_a3f8105a2c084f10e82dba26e25cde3a7}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Supported\+Groups@{tls\+Set\+Supported\+Groups}}
\index{tls\+Set\+Supported\+Groups@{tls\+Set\+Supported\+Groups}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Supported\+Groups()}{tlsSetSupportedGroups()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Supported\+Groups (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$}]{groups,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{length }\end{DoxyParamCaption})}



Specify the list of allowed E\+C\+D\+HE and F\+F\+D\+HE groups. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em groups} & List of named groups \\
\hline
\mbox{\tt in}  & {\em length} & Number of named groups in the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 592 of file tls.\+c.


\begin{DoxyCode}
594 \{
595    \textcolor{comment}{//Invalid TLS context?}
596    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
597       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
598 
599    \textcolor{comment}{//Check parameters}
600    \textcolor{keywordflow}{if}(groups == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
601       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
602 
603    \textcolor{comment}{//Restrict the named groups that can be used}
604    context->supportedGroups = groups;
605    context->numSupportedGroups = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
606 
607    \textcolor{comment}{//Successful processing}
608    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
609 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a07aa42467b2c7ab9dadd717506a991f1}\label{tls_8c_a07aa42467b2c7ab9dadd717506a991f1}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Ticket\+Callbacks@{tls\+Set\+Ticket\+Callbacks}}
\index{tls\+Set\+Ticket\+Callbacks@{tls\+Set\+Ticket\+Callbacks}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Ticket\+Callbacks()}{tlsSetTicketCallbacks()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Ticket\+Callbacks (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a285a972f2c50b94aad3c1315595538ed}{Tls\+Ticket\+Encrypt\+Callback}}]{ticket\+Encrypt\+Callback,  }\item[{\hyperlink{tls_8h_aaa1312868adabe84a91c54f830669789}{Tls\+Ticket\+Decrypt\+Callback}}]{ticket\+Decrypt\+Callback,  }\item[{void $\ast$}]{param }\end{DoxyParamCaption})}



Set ticket encryption/decryption callbacks. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em ticket\+Encrypt\+Callback} & Ticket encryption callback function \\
\hline
\mbox{\tt in}  & {\em ticket\+Decrypt\+Callback} & Ticket decryption callback function \\
\hline
\mbox{\tt in}  & {\em param} & An opaque pointer passed to the callback functions \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1326 of file tls.\+c.


\begin{DoxyCode}
1329 \{
1330 \textcolor{preprocessor}{#if (TLS\_TICKET\_SUPPORT == ENABLED)}
1331    \textcolor{comment}{//Invalid TLS context?}
1332    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1333       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1334 
1335    \textcolor{comment}{//Save ticket encryption/decryption callback functions}
1336    context->ticketEncryptCallback = ticketEncryptCallback;
1337    context->ticketDecryptCallback = ticketDecryptCallback;
1338 
1339    \textcolor{comment}{//This opaque pointer will be directly passed to the callback functions}
1340    context->ticketParam = param;
1341 
1342    \textcolor{comment}{//Successful processing}
1343    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1344 \textcolor{preprocessor}{#else}
1345    \textcolor{comment}{//Session ticket mechanism is not implemented}
1346    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1347 \textcolor{preprocessor}{#endif}
1348 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_af1d43e09beb55392462a4aa0268d802b}\label{tls_8c_af1d43e09beb55392462a4aa0268d802b}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Timeout@{tls\+Set\+Timeout}}
\index{tls\+Set\+Timeout@{tls\+Set\+Timeout}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Timeout()}{tlsSetTimeout()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{timeout }\end{DoxyParamCaption})}



Set timeout for blocking calls (for D\+T\+LS only) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em timeout} & Maximum time to wait \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1388 of file tls.\+c.


\begin{DoxyCode}
1389 \{
1390 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1391    \textcolor{comment}{//Invalid TLS context?}
1392    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1393       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1394 
1395    \textcolor{comment}{//Save timeout value}
1396    context->timeout = timeout;
1397 
1398    \textcolor{comment}{//Successful processing}
1399    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1400 \textcolor{preprocessor}{#else}
1401    \textcolor{comment}{//DTLS is not implemented}
1402    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1403 \textcolor{preprocessor}{#endif}
1404 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_af956e21be810af37839b46b5d9470817}\label{tls_8c_af956e21be810af37839b46b5d9470817}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Transport\+Protocol@{tls\+Set\+Transport\+Protocol}}
\index{tls\+Set\+Transport\+Protocol@{tls\+Set\+Transport\+Protocol}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Transport\+Protocol()}{tlsSetTransportProtocol()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Transport\+Protocol (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89f}{Tls\+Transport\+Protocol}}]{transport\+Protocol }\end{DoxyParamCaption})}



Set the transport protocol to be used. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em transport\+Protocol} & Transport protocol to be used \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 283 of file tls.\+c.


\begin{DoxyCode}
285 \{
286    \textcolor{comment}{//Invalid TLS context?}
287    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
288       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
289 
290    \textcolor{comment}{//Check parameters}
291    \textcolor{keywordflow}{if}(transportProtocol != \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM} &&
292       transportProtocol != \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
293    \{
294       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
295    \}
296 
297    \textcolor{comment}{//Set transport protocol}
298    context->transportProtocol = transportProtocol;
299 
300    \textcolor{comment}{//Successful processing}
301    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
302 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aaca40b2296ddc4adf5835f4ebcf04af2}\label{tls_8c_aaca40b2296ddc4adf5835f4ebcf04af2}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Trusted\+Ca\+List@{tls\+Set\+Trusted\+Ca\+List}}
\index{tls\+Set\+Trusted\+Ca\+List@{tls\+Set\+Trusted\+Ca\+List}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Trusted\+Ca\+List()}{tlsSetTrustedCaList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Trusted\+Ca\+List (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{trusted\+Ca\+List,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Import a trusted CA list. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em trusted\+Ca\+List} & List of trusted CA (P\+EM format) \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1096 of file tls.\+c.


\begin{DoxyCode}
1098 \{
1099    \textcolor{comment}{//Invalid TLS context?}
1100    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1101       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1102 
1103    \textcolor{comment}{//Check parameters}
1104    \textcolor{keywordflow}{if}(\hyperlink{demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_a52d999bffef4c5d89345bd0ce7d91042}{trustedCaList} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
1105       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1106 
1107    \textcolor{comment}{//Save the list of trusted CA}
1108    context->trustedCaList = \hyperlink{demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_a52d999bffef4c5d89345bd0ce7d91042}{trustedCaList};
1109    context->trustedCaListLen = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1110 
1111    \textcolor{comment}{//Successful processing}
1112    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1113 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a82ab46316bb6ca47f9781f2e5d349e20}\label{tls_8c_a82ab46316bb6ca47f9781f2e5d349e20}} 
\index{tls.\+c@{tls.\+c}!tls\+Set\+Version@{tls\+Set\+Version}}
\index{tls\+Set\+Version@{tls\+Set\+Version}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Set\+Version()}{tlsSetVersion()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Set\+Version (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{version\+Min,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{version\+Max }\end{DoxyParamCaption})}



Set minimum and maximum versions permitted. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em version\+Min} & Minimum version accepted by the T\+LS implementation \\
\hline
\mbox{\tt in}  & {\em version\+Max} & Maximum version accepted by the T\+LS implementation \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 249 of file tls.\+c.


\begin{DoxyCode}
251 \{
252    \textcolor{comment}{//Invalid TLS context?}
253    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
254       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
255 
256    \textcolor{comment}{//Check parameters}
257    \textcolor{keywordflow}{if}(versionMin < TLS\_MIN\_VERSION || versionMax > \hyperlink{tls_8h_a6c4deefe3b88839c2f519ab6d0e8a80b}{TLS\_MAX\_VERSION})
258       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
259    \textcolor{keywordflow}{if}(versionMin > versionMax)
260       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
261 
262    \textcolor{comment}{//Minimum version accepted by the implementation}
263    context->versionMin = versionMin;
264    \textcolor{comment}{//Maximum version accepted by the implementation}
265    context->versionMax = versionMax;
266 
267    \textcolor{comment}{//Default record layer version number}
268    context->version = context->versionMin;
269    context->encryptionEngine.version = context->versionMin;
270 
271    \textcolor{comment}{//Successful processing}
272    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
273 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ae6a631703510008537d2cd97ab3425ef}\label{tls_8c_ae6a631703510008537d2cd97ab3425ef}} 
\index{tls.\+c@{tls.\+c}!tls\+Shutdown@{tls\+Shutdown}}
\index{tls\+Shutdown@{tls\+Shutdown}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Shutdown()}{tlsShutdown()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Shutdown (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Gracefully close T\+LS session. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}


Definition at line 2112 of file tls.\+c.


\begin{DoxyCode}
2113 \{
2114    \textcolor{comment}{//Either party may initiate a close by sending a close\_notify alert}
2115    \textcolor{keywordflow}{return} \hyperlink{tls_8c_aa88b81232b387245ab5c945050bc0d29}{tlsShutdownEx}(context, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
2116 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_aa88b81232b387245ab5c945050bc0d29}\label{tls_8c_aa88b81232b387245ab5c945050bc0d29}} 
\index{tls.\+c@{tls.\+c}!tls\+Shutdown\+Ex@{tls\+Shutdown\+Ex}}
\index{tls\+Shutdown\+Ex@{tls\+Shutdown\+Ex}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Shutdown\+Ex()}{tlsShutdownEx()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Shutdown\+Ex (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{wait\+For\+Close\+Notify }\end{DoxyParamCaption})}



Gracefully close T\+LS session. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em wait\+For\+Close\+Notify} & Wait for the close notify alert from the peer \\
\hline
\end{DoxyParams}


Definition at line 2125 of file tls.\+c.


\begin{DoxyCode}
2126 \{
2127    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2128    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2129    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
2130    \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896c}{TlsContentType} contentType;
2131 
2132    \textcolor{comment}{//Invalid TLS context?}
2133    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2134       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2135 
2136    \textcolor{comment}{//Ensure the send/receive functions are properly registered}
2137    \textcolor{keywordflow}{if}(context->socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->socketReceiveCallback == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2138       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
2139 
2140 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
2141    \textcolor{comment}{//Save current time}
2142    context->startTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
2143 \textcolor{preprocessor}{#endif}
2144 
2145    \textcolor{comment}{//Initialize status code}
2146    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2147 
2148    \textcolor{comment}{//Wait for the TLS session to be closed}
2149    \textcolor{keywordflow}{while}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED})
2150    \{
2151       \textcolor{comment}{//Check current state}
2152       \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
2153       \{
2154          \textcolor{comment}{//TLS protocol?}
2155          \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM})
2156          \{
2157             \textcolor{comment}{//Flush send buffer}
2158             error = \hyperlink{tls__record_8c_ae8f8c035d23eb99d1d5642d4ce644715}{tlsWriteProtocolData}(context, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 
      \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca86bbddd09b8894c9f1bcf5c721b0d412}{TLS\_TYPE\_NONE});
2159          \}
2160 
2161          \textcolor{comment}{//Check status code}
2162          \textcolor{keywordflow}{if}(!error)
2163          \{
2164             \textcolor{comment}{//Either party may initiate a close by sending a close\_notify alert}
2165             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING};
2166          \}
2167       \}
2168       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING})
2169       \{
2170          \textcolor{comment}{//TLS protocol?}
2171          \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM})
2172          \{
2173             \textcolor{comment}{//Flush send buffer}
2174             error = \hyperlink{tls__record_8c_ae8f8c035d23eb99d1d5642d4ce644715}{tlsWriteProtocolData}(context, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 
      \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca86bbddd09b8894c9f1bcf5c721b0d412}{TLS\_TYPE\_NONE});
2175          \}
2176 
2177          \textcolor{comment}{//Check status code}
2178          \textcolor{keywordflow}{if}(!error)
2179          \{
2180             \textcolor{comment}{//Unless some other fatal alert has been transmitted, each party}
2181             \textcolor{comment}{//is required to send a close\_notify alert before closing the}
2182             \textcolor{comment}{//write side of the connection}
2183             \textcolor{keywordflow}{if}(context->fatalAlertSent || context->fatalAlertReceived)
2184             \{
2185                \textcolor{comment}{//Close the connection immediately}
2186                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED};
2187             \}
2188             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!context->closeNotifySent)
2189             \{
2190                \textcolor{comment}{//Notifies the recipient that the sender will not send any}
2191                \textcolor{comment}{//more messages on this connection}
2192                error = \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202a0fac70d0bd6a19666d5b2f13c71cddf7}{TLS\_ALERT\_LEVEL\_WARNING},
2193                   \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba73d804f6b3c2241690af4f53d621c0d1}{TLS\_ALERT\_CLOSE\_NOTIFY});
2194             \}
2195             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!context->closeNotifyReceived && waitForCloseNotify)
2196             \{
2197 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
2198                \textcolor{comment}{//DTLS protocol?}
2199                \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM}
      )
2200                \{
2201                   \textcolor{comment}{//Wait for the responding close\_notify alert}
2202                   error = \hyperlink{dtls__record_8c_acdb1074243776f124182a136435bab6c}{dtlsReadProtocolData}(context, &p, &n, &contentType);
2203                \}
2204                \textcolor{keywordflow}{else}
2205 \textcolor{preprocessor}{#endif}
2206                \textcolor{comment}{//TLS protocol?}
2207                \{
2208                   \textcolor{comment}{//Wait for the responding close\_notify alert}
2209                   error = \hyperlink{tls__record_8c_a801443c458f35a2640ec508b1ec1ecf6}{tlsReadProtocolData}(context, &p, &n, &contentType);
2210                \}
2211 
2212                \textcolor{comment}{//Check status code}
2213                \textcolor{keywordflow}{if}(!error)
2214                \{
2215                   \textcolor{comment}{//Advance data pointer}
2216                   context->rxBufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2217                   \textcolor{comment}{//Number of bytes still pending in the receive buffer}
2218                   context->rxBufferLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2219 
2220                   \textcolor{comment}{//Application data received?}
2221                   \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896caa8233b89b5c8f35ce7fcd1f644cbc0fc}{TLS\_TYPE\_APPLICATION\_DATA})
2222                   \{
2223                      \textcolor{comment}{//Discard application data}
2224                   \}
2225                   \textcolor{comment}{//Alert message received?}
2226                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896cac576c866dc3772236d51f16226adfbd9}{TLS\_TYPE\_ALERT})
2227                   \{
2228                      \textcolor{comment}{//Parse Alert message}
2229                      error = \hyperlink{tls__common_8c_abd3d66a2f80b812ee5db99a78191b795}{tlsParseAlert}(context, (\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert} *) p, n);
2230                   \}
2231                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(contentType == \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca72077515f40a300c29899b5a3ba48682}{TLS\_TYPE\_HANDSHAKE})
2232                   \{
2233                      \textcolor{comment}{//Parse handshake message}
2234                      error = \hyperlink{tls__handshake_8c_ad8c84ebcfdd55f293c7b605273e750c2}{tlsParseHandshakeMessage}(context, p, n);
2235                   \}
2236                   \textcolor{comment}{//An inappropriate message was received?}
2237                   \textcolor{keywordflow}{else}
2238                   \{
2239                      \textcolor{comment}{//Report an error}
2240                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
2241                   \}
2242                \}
2243             \}
2244             \textcolor{keywordflow}{else}
2245             \{
2246                \textcolor{comment}{//The connection is closed}
2247                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED};
2248             \}
2249          \}
2250       \}
2251       \textcolor{keywordflow}{else}
2252       \{
2253          \textcolor{comment}{//Report an error}
2254          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8cf62de6117b9a4c1537d1ce96c219a8}{ERROR\_NOT\_CONNECTED};
2255       \}
2256 
2257       \textcolor{comment}{//Any error to report?}
2258       \textcolor{keywordflow}{if}(error)
2259          \textcolor{keywordflow}{break};
2260    \}
2261 
2262    \textcolor{comment}{//Return status code}
2263    \textcolor{keywordflow}{return} error;
2264 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_a1b4b22502217a601f7f094403e700b4b}\label{tls_8c_a1b4b22502217a601f7f094403e700b4b}} 
\index{tls.\+c@{tls.\+c}!tls\+Write@{tls\+Write}}
\index{tls\+Write@{tls\+Write}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Write()}{tlsWrite()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Write (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send application data to the remote host using T\+LS. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1663 of file tls.\+c.


\begin{DoxyCode}
1665 \{
1666    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1667    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1668    \textcolor{keywordtype}{size\_t} totalLength;
1669 
1670    \textcolor{comment}{//Invalid TLS context?}
1671    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1672       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1673 
1674    \textcolor{comment}{//Check parameters}
1675    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
1676       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1677 
1678    \textcolor{comment}{//Ensure the send/receive functions are properly registered}
1679    \textcolor{keywordflow}{if}(context->socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->socketReceiveCallback == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1680       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1681 
1682 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1683    \textcolor{comment}{//Save current time}
1684    context->startTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1685 \textcolor{preprocessor}{#endif}
1686 
1687    \textcolor{comment}{//Initialize status code}
1688    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1689 
1690    \textcolor{comment}{//Actual number of bytes written}
1691    totalLength = 0;
1692 
1693    \textcolor{comment}{//Send as much data as possible}
1694    \textcolor{keywordflow}{while}(totalLength < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
1695    \{
1696       \textcolor{comment}{//Check current state}
1697       \textcolor{keywordflow}{if}(context->state < \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
1698       \{
1699          \textcolor{comment}{//Perform TLS handshake}
1700          error = \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(context);
1701       \}
1702       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
1703       \{
1704 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1705          \textcolor{comment}{//DTLS protocol?}
1706          \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
1707          \{
1708             \textcolor{comment}{//Length of the payload data}
1709             n = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1710 
1711             \textcolor{comment}{//Send a datagram}
1712             error = \hyperlink{dtls__record_8c_ab15a3a01b2765ebf23f0fc72f1405f92}{dtlsWriteProtocolData}(context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, n,
1713                \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896caa8233b89b5c8f35ce7fcd1f644cbc0fc}{TLS\_TYPE\_APPLICATION\_DATA});
1714          \}
1715          \textcolor{keywordflow}{else}
1716 \textcolor{preprocessor}{#endif}
1717          \textcolor{comment}{//TLS protocol?}
1718          \{
1719             \textcolor{comment}{//Calculate the number of bytes to write at a time}
1720             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - totalLength, context->txBufferMaxLen);
1721             \textcolor{comment}{//The record length must not exceed 16384 bytes}
1722             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH});
1723 
1724 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
1725             \textcolor{comment}{//Do not exceed the negotiated maximum fragment length}
1726             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, context->maxFragLen);
1727 \textcolor{preprocessor}{#endif}
1728 
1729 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
1730             \textcolor{comment}{//Maximum record size the peer is willing to receive}
1731             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, context->recordSizeLimit);
1732 \textcolor{preprocessor}{#endif}
1733 
1734 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_0)}
1735             \textcolor{comment}{//The 1/n-1 record splitting technique is a workaround for the}
1736             \textcolor{comment}{//BEAST attack}
1737             \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_adcc8f4321c8f3b847fbea16ca0ff337e}{TLS\_VERSION\_1\_0} &&
1738                context->cipherSuite.cipherMode == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a7c82e8aeb1e9badb0c083823b5b14eaa}{CIPHER\_MODE\_CBC} &&
1739                context->txLastRecordLen != 1 &&
1740                totalLength == 0)
1741             \{
1742                n = 1;
1743             \}
1744 \textcolor{preprocessor}{#endif}
1745             \textcolor{comment}{//Send application data}
1746             error = \hyperlink{tls__record_8c_ae8f8c035d23eb99d1d5642d4ce644715}{tlsWriteProtocolData}(context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, n,
1747                \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896caa8233b89b5c8f35ce7fcd1f644cbc0fc}{TLS\_TYPE\_APPLICATION\_DATA});
1748          \}
1749 
1750          \textcolor{comment}{//Check status code}
1751          \textcolor{keywordflow}{if}(!error)
1752          \{
1753 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_0)}
1754             \textcolor{comment}{//Save the length of the TLS record}
1755             context->txLastRecordLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1756 \textcolor{preprocessor}{#endif}
1757             \textcolor{comment}{//Advance data pointer}
1758             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + n;
1759             \textcolor{comment}{//Update byte counter}
1760             totalLength += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1761          \}
1762          \textcolor{keywordflow}{else}
1763          \{
1764             \textcolor{comment}{//Send an alert message to the peer, if applicable}
1765             \hyperlink{tls__misc_8c_ae43b7ef806126baf125c46cdb9424e87}{tlsProcessError}(context, error);
1766          \}
1767       \}
1768       \textcolor{keywordflow}{else}
1769       \{
1770          \textcolor{comment}{//The connection has not yet been established}
1771          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8cf62de6117b9a4c1537d1ce96c219a8}{ERROR\_NOT\_CONNECTED};
1772       \}
1773 
1774       \textcolor{comment}{//Any error to report?}
1775       \textcolor{keywordflow}{if}(error)
1776          \textcolor{keywordflow}{break};
1777    \}
1778 
1779    \textcolor{comment}{//Total number of data that have been written}
1780    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1781       *written = totalLength;
1782 
1783    \textcolor{comment}{//Return status code}
1784    \textcolor{keywordflow}{return} error;
1785 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls_8c_ac0777366c6b183672702b6aaac008e7c}\label{tls_8c_ac0777366c6b183672702b6aaac008e7c}} 
\index{tls.\+c@{tls.\+c}!tls\+Write\+Early\+Data@{tls\+Write\+Early\+Data}}
\index{tls\+Write\+Early\+Data@{tls\+Write\+Early\+Data}!tls.\+c@{tls.\+c}}
\subsubsection{\texorpdfstring{tls\+Write\+Early\+Data()}{tlsWriteEarlyData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Write\+Early\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send early data to the remote T\+LS server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1509 of file tls.\+c.


\begin{DoxyCode}
1511 \{
1512 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3 && \(\backslash\)}
1513 \textcolor{preprocessor}{   TLS\_CLIENT\_SUPPORT == ENABLED && TLS13\_EARLY\_DATA\_SUPPORT == ENABLED)}
1514    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1515    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1516 
1517    \textcolor{comment}{//Invalid TLS context?}
1518    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1519       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1520 
1521    \textcolor{comment}{//Check parameters}
1522    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
1523       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1524 
1525    \textcolor{comment}{//Check operation mode}
1526    \textcolor{keywordflow}{if}(context->entity != \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1527       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1528 
1529    \textcolor{comment}{//Make sure TLS 1.3 is supported by the client}
1530    \textcolor{keywordflow}{if}(context->versionMax < \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
1531       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1532 
1533    \textcolor{comment}{//Check transport protocol}
1534    \textcolor{keywordflow}{if}(context->transportProtocol != \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa2fbbbd6c318570d570225144f3c6c244}{TLS\_TRANSPORT\_PROTOCOL\_STREAM})
1535       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1536 
1537    \textcolor{comment}{//Ensure the send/receive functions are properly registered}
1538    \textcolor{keywordflow}{if}(context->socketSendCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->socketReceiveCallback == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1539       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1540 
1541    \textcolor{comment}{//Verify that the PRNG is properly set}
1542    \textcolor{keywordflow}{if}(context->prngAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || context->prngContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1543       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
1544 
1545 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1546    \textcolor{comment}{//Save current time}
1547    context->startTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1548 \textcolor{preprocessor}{#endif}
1549 
1550    \textcolor{comment}{//Send 0-RTT data}
1551    error = \hyperlink{tls13__client__misc_8h_a14ca74d42c22d603139aa056ecac86fd}{tls13SendEarlyData}(context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &n);
1552 
1553    \textcolor{comment}{//Total number of data that have been written}
1554    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1555       *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1556 
1557    \textcolor{comment}{//Return status code}
1558    \textcolor{keywordflow}{return} error;
1559 \textcolor{preprocessor}{#else}
1560    \textcolor{comment}{//Not implemented}
1561    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1562 \textcolor{preprocessor}{#endif}
1563 \}
\end{DoxyCode}
