\hypertarget{web__socket__transport_8c}{}\section{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+transport.c File Reference}
\label{web__socket__transport_8c}\index{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+transport.\+c@{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+transport.\+c}}


Web\+Socket transport layer.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}web\+\_\+socket/web\+\_\+socket.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}web\+\_\+socket/web\+\_\+socket\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{web__socket__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a726918867be6caec18d98f3fc26813f9}{W\+E\+B\+\_\+\+S\+O\+C\+K\+E\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__transport_8c_a5b9a0007642ec4f35d3817d9e7055644}{web\+Socket\+Open\+Connection} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket)
\begin{DoxyCompactList}\small\item\em Open network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__transport_8c_a6380e8c6557f050fb13d0b5b0aa5112c}{web\+Socket\+Establish\+Connection} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$server\+Ip\+Addr, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} server\+Port)
\begin{DoxyCompactList}\small\item\em Establish network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__transport_8c_a0d897cb29993628ebd61695b089f7d5d}{web\+Socket\+Shutdown\+Connection} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket)
\begin{DoxyCompactList}\small\item\em Shutdown network connection. \end{DoxyCompactList}\item 
void \hyperlink{web__socket__transport_8c_a66153cc13b2f563fbdfd27eb4c0b7afa}{web\+Socket\+Close\+Connection} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket)
\begin{DoxyCompactList}\small\item\em Close network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__transport_8c_a8569db2a11a8adecaa48dd7ffa12b2fe}{web\+Socket\+Send\+Data} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send data using the relevant transport protocol. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__transport_8c_a18b5d001e9fd3caae71c20355695e2c4}{web\+Socket\+Receive\+Data} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Receive data using the relevant transport protocol. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Web\+Socket transport layer. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{web__socket__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{web__socket__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a726918867be6caec18d98f3fc26813f9}{W\+E\+B\+\_\+\+S\+O\+C\+K\+E\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file web\+\_\+socket\+\_\+transport.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{web__socket__transport_8c_a66153cc13b2f563fbdfd27eb4c0b7afa}\label{web__socket__transport_8c_a66153cc13b2f563fbdfd27eb4c0b7afa}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Close\+Connection@{web\+Socket\+Close\+Connection}}
\index{web\+Socket\+Close\+Connection@{web\+Socket\+Close\+Connection}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Close\+Connection()}{webSocketCloseConnection()}}
{\footnotesize\ttfamily void web\+Socket\+Close\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket }\end{DoxyParamCaption})}



Close network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\end{DoxyParams}


Definition at line 216 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
217 \{
218 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
219    \textcolor{comment}{//Check whether a secure connection is being used}
220    \textcolor{keywordflow}{if}(webSocket->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
221    \{
222       \textcolor{comment}{//Save TLS session}
223       \hyperlink{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}{tlsSaveSessionState}(webSocket->tlsContext, &webSocket->tlsSession);
224 
225       \textcolor{comment}{//Release TLS context}
226       \hyperlink{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}{tlsFree}(webSocket->tlsContext);
227       webSocket->tlsContext = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
228    \}
229 \textcolor{preprocessor}{#endif}
230 
231    \textcolor{comment}{//Close TCP connection}
232    \textcolor{keywordflow}{if}(webSocket->socket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
233    \{
234       \hyperlink{socket_8c_ac5012e9f71c97e2ea0410f2c5baccb0e}{socketClose}(webSocket->socket);
235       webSocket->socket = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
236    \}
237 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__transport_8c_a6380e8c6557f050fb13d0b5b0aa5112c}\label{web__socket__transport_8c_a6380e8c6557f050fb13d0b5b0aa5112c}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Establish\+Connection@{web\+Socket\+Establish\+Connection}}
\index{web\+Socket\+Establish\+Connection@{web\+Socket\+Establish\+Connection}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Establish\+Connection()}{webSocketEstablishConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Establish\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{server\+Ip\+Addr,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{server\+Port }\end{DoxyParamCaption})}



Establish network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\mbox{\tt in}  & {\em server\+Ip\+Addr} & IP address of the Web\+Socket server to connect to \\
\hline
\mbox{\tt in}  & {\em server\+Port} & T\+CP port number that will be used to establish the connection \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 138 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
140 \{
141    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
142 
143    \textcolor{comment}{//Connect to WebSocket server}
144    error = \hyperlink{socket_8c_aff3e3c0abc332f42189fce8f362fbd63}{socketConnect}(webSocket->socket, serverIpAddr, serverPort);
145 
146 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
147    \textcolor{comment}{//TLS-secured connection?}
148    \textcolor{keywordflow}{if}(webSocket->tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
149    \{
150       \textcolor{comment}{//Check status code}
151       \textcolor{keywordflow}{if}(!error)
152       \{
153          \textcolor{comment}{//Establish TLS connection}
154          error = \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(webSocket->tlsContext);
155       \}
156    \}
157 \textcolor{preprocessor}{#endif}
158 
159    \textcolor{comment}{//Return status code}
160    \textcolor{keywordflow}{return} error;
161 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__transport_8c_a5b9a0007642ec4f35d3817d9e7055644}\label{web__socket__transport_8c_a5b9a0007642ec4f35d3817d9e7055644}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Open\+Connection@{web\+Socket\+Open\+Connection}}
\index{web\+Socket\+Open\+Connection@{web\+Socket\+Open\+Connection}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Open\+Connection()}{webSocketOpenConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Open\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket }\end{DoxyParamCaption})}



Open network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 50 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
51 \{
52    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
53 
54    \textcolor{comment}{//Invalid socket handle?}
55    \textcolor{keywordflow}{if}(webSocket->socket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
56    \{
57       \textcolor{comment}{//Open a TCP socket}
58       webSocket->socket = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a9dab003c4dc9f7279e806241534d4859}{SOCKET\_TYPE\_STREAM}, 
      \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969ae0f38a6f025bce7700b3cf0ddd04bb2a}{SOCKET\_IP\_PROTO\_TCP});
59       \textcolor{comment}{//Failed to open socket?}
60       \textcolor{keywordflow}{if}(webSocket->socket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
61          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
62 
63       \textcolor{comment}{//Associate the WebSocket with the relevant interface}
64       error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(webSocket->socket, webSocket->interface);
65       \textcolor{comment}{//Any error to report?}
66       \textcolor{keywordflow}{if}(error)
67          \textcolor{keywordflow}{return} error;
68    \}
69 
70    \textcolor{comment}{//Set timeout}
71    error = \hyperlink{socket_8c_abdd29ac0ba4a644c726f5b1280680099}{socketSetTimeout}(webSocket->socket, webSocket->timeout);
72    \textcolor{comment}{//Any error to report?}
73    \textcolor{keywordflow}{if}(error)
74       \textcolor{keywordflow}{return} error;
75 
76 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
77       \textcolor{comment}{//TLS-secured connection?}
78       \textcolor{keywordflow}{if}(webSocket->tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
79       \{
80          \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{TlsConnectionEnd} connectionEnd;
81 
82          \textcolor{comment}{//Allocate TLS context}
83          webSocket->tlsContext = \hyperlink{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}{tlsInit}();
84          \textcolor{comment}{//Failed to allocate TLS context?}
85          \textcolor{keywordflow}{if}(webSocket->tlsContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
86             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
87 
88          \textcolor{comment}{//Client or server operation?}
89          \textcolor{keywordflow}{if}(webSocket->endpoint == \hyperlink{web__socket_8h_ae7d51561abe243c4f263d6c7d50699a9aa78fcf3108fe2e0b57f32684e9c76076}{WS\_ENDPOINT\_CLIENT})
90             connectionEnd = \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT};
91          \textcolor{keywordflow}{else}
92             connectionEnd = \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER};
93 
94          \textcolor{comment}{//Select the relevant operation mode}
95          error = \hyperlink{tls_8c_a8713543db673ee5a36b2fda92e082c6b}{tlsSetConnectionEnd}(webSocket->tlsContext, connectionEnd);
96          \textcolor{comment}{//Any error to report?}
97          \textcolor{keywordflow}{if}(error)
98             \textcolor{keywordflow}{return} error;
99 
100          \textcolor{comment}{//Bind TLS to the relevant socket}
101          error = \hyperlink{tls_8h_af918bec8cc034c91ae7cb14a4ab24103}{tlsSetSocket}(webSocket->tlsContext, webSocket->socket);
102          \textcolor{comment}{//Any error to report?}
103          \textcolor{keywordflow}{if}(error)
104             \textcolor{keywordflow}{return} error;
105 
106          \textcolor{comment}{//Restore TLS session, if any}
107          error = \hyperlink{tls_8c_a04094e358f18adc2d7ad8686e3258b93}{tlsRestoreSessionState}(webSocket->tlsContext, &webSocket->tlsSession
      );
108          \textcolor{comment}{//Any error to report?}
109          \textcolor{keywordflow}{if}(error)
110             \textcolor{keywordflow}{return} error;
111 
112          \textcolor{comment}{//Invoke user-defined callback, if any}
113          \textcolor{keywordflow}{if}(webSocket->tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
114          \{
115             \textcolor{comment}{//Perform TLS related initialization}
116             error = webSocket->tlsInitCallback(webSocket, webSocket->tlsContext);
117             \textcolor{comment}{//Any error to report?}
118             \textcolor{keywordflow}{if}(error)
119                \textcolor{keywordflow}{return} error;
120          \}
121       \}
122 \textcolor{preprocessor}{#endif}
123 
124    \textcolor{comment}{//Successful initialization}
125    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
126 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__transport_8c_a18b5d001e9fd3caae71c20355695e2c4}\label{web__socket__transport_8c_a18b5d001e9fd3caae71c20355695e2c4}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Receive\+Data@{web\+Socket\+Receive\+Data}}
\index{web\+Socket\+Receive\+Data@{web\+Socket\+Receive\+Data}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Receive\+Data()}{webSocketReceiveData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Receive\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Receive data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em received} & Number of bytes that have been received \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 284 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
286 \{
287    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
288 
289 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
290    \textcolor{comment}{//Check whether a secure connection is being used}
291    \textcolor{keywordflow}{if}(webSocket->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
292    \{
293       \textcolor{comment}{//Use TLS to receive data}
294       error = \hyperlink{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}{tlsRead}(webSocket->tlsContext, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
295    \}
296    \textcolor{keywordflow}{else}
297 \textcolor{preprocessor}{#endif}
298    \{
299       \textcolor{comment}{//Receive data}
300       error = \hyperlink{socket_8c_a894c7bf0bfd4e3886fc584ed7ebbb087}{socketReceive}(webSocket->socket, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
301    \}
302 
303    \textcolor{comment}{//Return status code}
304    \textcolor{keywordflow}{return} error;
305 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__transport_8c_a8569db2a11a8adecaa48dd7ffa12b2fe}\label{web__socket__transport_8c_a8569db2a11a8adecaa48dd7ffa12b2fe}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Send\+Data@{web\+Socket\+Send\+Data}}
\index{web\+Socket\+Send\+Data@{web\+Socket\+Send\+Data}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Send\+Data()}{webSocketSendData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Send\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 250 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
252 \{
253    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
254 
255 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
256    \textcolor{comment}{//Check whether a secure connection is being used}
257    \textcolor{keywordflow}{if}(webSocket->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
258    \{
259       \textcolor{comment}{//Use TLS to transmit data}
260       error = \hyperlink{tls_8c_a1b4b22502217a601f7f094403e700b4b}{tlsWrite}(webSocket->tlsContext, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
261    \}
262    \textcolor{keywordflow}{else}
263 \textcolor{preprocessor}{#endif}
264    \{
265       \textcolor{comment}{//Transmit data}
266       error = \hyperlink{socket_8c_aa4eeb3a3294d14d681675ba9f0d3e568}{socketSend}(webSocket->socket, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
267    \}
268 
269    \textcolor{comment}{//Return status code}
270    \textcolor{keywordflow}{return} error;
271 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__transport_8c_a0d897cb29993628ebd61695b089f7d5d}\label{web__socket__transport_8c_a0d897cb29993628ebd61695b089f7d5d}} 
\index{web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}!web\+Socket\+Shutdown\+Connection@{web\+Socket\+Shutdown\+Connection}}
\index{web\+Socket\+Shutdown\+Connection@{web\+Socket\+Shutdown\+Connection}!web\+\_\+socket\+\_\+transport.\+c@{web\+\_\+socket\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Shutdown\+Connection()}{webSocketShutdownConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Shutdown\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket }\end{DoxyParamCaption})}



Shutdown network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 170 of file web\+\_\+socket\+\_\+transport.\+c.


\begin{DoxyCode}
171 \{
172    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
173    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
174 
175    \textcolor{comment}{//Initialize status code}
176    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
177 
178 \textcolor{preprocessor}{#if (WEB\_SOCKET\_TLS\_SUPPORT == ENABLED)}
179    \textcolor{comment}{//Check whether a secure connection is being used}
180    \textcolor{keywordflow}{if}(webSocket->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
181    \{
182       \textcolor{comment}{//Shutdown TLS connection}
183       error = \hyperlink{tls_8c_ae6a631703510008537d2cd97ab3425ef}{tlsShutdown}(webSocket->tlsContext);
184    \}
185 \textcolor{preprocessor}{#endif}
186 
187    \textcolor{comment}{//Check status code}
188    \textcolor{keywordflow}{if}(!error)
189    \{
190       \textcolor{comment}{//Further transmissions are disallowed}
191       error = \hyperlink{socket_8c_acc736b53dba4a0d3b11b63f75cdcfffb}{socketShutdown}(webSocket->socket, \hyperlink{socket_8h_a36ee33c18de64f549a6336d1aa7333b7a535dc5f70a642b86e56e6e83ce2a3378}{SOCKET\_SD\_SEND});
192    \}
193 
194    \textcolor{comment}{//Receive data until until the peer has also performed an orderly shutdown}
195    \textcolor{keywordflow}{while}(!error)
196    \{
197       \textcolor{comment}{//Discard data}
198       error = \hyperlink{socket_8c_a894c7bf0bfd4e3886fc584ed7ebbb087}{socketReceive}(webSocket->socket, webSocket->rxContext.buffer,
199          \hyperlink{web__socket_8h_a4e6ed74586f83eedc4eae5a079f41050}{WEB\_SOCKET\_BUFFER\_SIZE}, &n, 0);
200    \}
201 
202    \textcolor{comment}{//Check whether the connection has been properly closed}
203    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8b7223773301a4f3dd811f1d35e13ce4}{ERROR\_END\_OF\_STREAM})
204       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
205 
206    \textcolor{comment}{//Return status code}
207    \textcolor{keywordflow}{return} error;
208 \}
\end{DoxyCode}
