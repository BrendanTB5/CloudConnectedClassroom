\hypertarget{ctr_8c}{}\section{cyclone\+\_\+crypto/cipher\+\_\+mode/ctr.c File Reference}
\label{ctr_8c}\index{cyclone\+\_\+crypto/cipher\+\_\+mode/ctr.\+c@{cyclone\+\_\+crypto/cipher\+\_\+mode/ctr.\+c}}


Counter(\+C\+T\+R) mode.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cipher\+\_\+mode/ctr.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ctr_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ctr_8c_a47bd47c0734925605d9ac8eed1bf008a}{ctr\+Encrypt} (const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, void $\ast$context, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em C\+TR encryption. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ctr_8c_ae4c8a77275138cb5a5c7fbd0a64d1f59}{ctr\+Decrypt} (const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, void $\ast$context, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em C\+TR decryption. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Counter(\+C\+T\+R) mode. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
The Counter (C\+TR) mode is a confidentiality mode that features the application of the forward cipher to a set of input blocks, called counters, to produce a sequence of output blocks that are exclusive-\/\+O\+Red with the plaintext to produce the ciphertext, and vice versa. Refer to SP 800-\/38A for more details

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ctr_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ctr_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ctr.\+c@{ctr.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ctr.\+c@{ctr.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 39 of file ctr.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ctr_8c_ae4c8a77275138cb5a5c7fbd0a64d1f59}\label{ctr_8c_ae4c8a77275138cb5a5c7fbd0a64d1f59}} 
\index{ctr.\+c@{ctr.\+c}!ctr\+Decrypt@{ctr\+Decrypt}}
\index{ctr\+Decrypt@{ctr\+Decrypt}!ctr.\+c@{ctr.\+c}}
\subsubsection{\texorpdfstring{ctr\+Decrypt()}{ctrDecrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ctr\+Decrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{void $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{m,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



C\+TR decryption. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cipher} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em context} & Cipher algorithm context \\
\hline
\mbox{\tt in}  & {\em m} & Size in bits of the specific part of the block to be incremented \\
\hline
\mbox{\tt in,out}  & {\em t} & Initial counter block \\
\hline
\mbox{\tt in}  & {\em c} & Ciphertext to be decrypted \\
\hline
\mbox{\tt out}  & {\em p} & Plaintext resulting from the decryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be decrypted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 127 of file ctr.\+c.


\begin{DoxyCode}
129 \{
130    \textcolor{keywordtype}{size\_t} i;
131    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
132    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dhcpv6__common_8h_a69c4569269da7faedfa431b065370468}{o}[16];
133 
134    \textcolor{comment}{//The parameter must be a multiple of 8}
135    \textcolor{keywordflow}{if}((\hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} % 8) != 0)
136       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
137 
138    \textcolor{comment}{//Determine the size, in bytes, of the specific part of}
139    \textcolor{comment}{//the block to be incremented}
140    \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} = \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} / 8;
141 
142    \textcolor{comment}{//Check the resulting value}
143    \textcolor{keywordflow}{if}(\hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} > cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize})
144       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
145 
146    \textcolor{comment}{//Process ciphertext}
147    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
148    \{
149       \textcolor{comment}{//CTR mode operates in a block-by-block fashion}
150       n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
151 
152       \textcolor{comment}{//Compute O(j) = CIPH(T(j))}
153       cipher->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context, \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, o);
154 
155       \textcolor{comment}{//Compute P(j) = C(j) XOR T(j)}
156       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
157       \{
158          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}[i] = \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}[i] ^ o[i];
159       \}
160 
161       \textcolor{comment}{//Standard incrementing function}
162       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}; i++)
163       \{
164          \textcolor{comment}{//Increment the current byte and propagate the carry if necessary}
165          \textcolor{keywordflow}{if}(++(\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} - 1 - i]) != 0)
166             \textcolor{keywordflow}{break};
167       \}
168 
169       \textcolor{comment}{//Next block}
170       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
171       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
172       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
173    \}
174 
175    \textcolor{comment}{//Successful encryption}
176    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
177 \}
\end{DoxyCode}
\mbox{\Hypertarget{ctr_8c_a47bd47c0734925605d9ac8eed1bf008a}\label{ctr_8c_a47bd47c0734925605d9ac8eed1bf008a}} 
\index{ctr.\+c@{ctr.\+c}!ctr\+Encrypt@{ctr\+Encrypt}}
\index{ctr\+Encrypt@{ctr\+Encrypt}!ctr.\+c@{ctr.\+c}}
\subsubsection{\texorpdfstring{ctr\+Encrypt()}{ctrEncrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ctr\+Encrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{void $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{m,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



C\+TR encryption. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cipher} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em context} & Cipher algorithm context \\
\hline
\mbox{\tt in}  & {\em m} & Size in bits of the specific part of the block to be incremented \\
\hline
\mbox{\tt in,out}  & {\em t} & Initial counter block \\
\hline
\mbox{\tt in}  & {\em p} & Plaintext to be encrypted \\
\hline
\mbox{\tt out}  & {\em c} & Ciphertext resulting from the encryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be encrypted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 62 of file ctr.\+c.


\begin{DoxyCode}
64 \{
65    \textcolor{keywordtype}{size\_t} i;
66    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
67    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dhcpv6__common_8h_a69c4569269da7faedfa431b065370468}{o}[16];
68 
69    \textcolor{comment}{//The parameter must be a multiple of 8}
70    \textcolor{keywordflow}{if}((\hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} % 8) != 0)
71       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
72 
73    \textcolor{comment}{//Determine the size, in bytes, of the specific part of}
74    \textcolor{comment}{//the block to be incremented}
75    \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} = \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} / 8;
76 
77    \textcolor{comment}{//Check the resulting value}
78    \textcolor{keywordflow}{if}(\hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m} > cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize})
79       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
80 
81    \textcolor{comment}{//Process plaintext}
82    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
83    \{
84       \textcolor{comment}{//CTR mode operates in a block-by-block fashion}
85       n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
86 
87       \textcolor{comment}{//Compute O(j) = CIPH(T(j))}
88       cipher->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context, \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, o);
89 
90       \textcolor{comment}{//Compute C(j) = P(j) XOR T(j)}
91       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
92       \{
93          \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}[i] = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}[i] ^ o[i];
94       \}
95 
96       \textcolor{comment}{//Standard incrementing function}
97       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}; i++)
98       \{
99          \textcolor{comment}{//Increment the current byte and propagate the carry if necessary}
100          \textcolor{keywordflow}{if}(++(\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} - 1 - i]) != 0)
101             \textcolor{keywordflow}{break};
102       \}
103 
104       \textcolor{comment}{//Next block}
105       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
106       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
107       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
108    \}
109 
110    \textcolor{comment}{//Successful encryption}
111    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
112 \}
\end{DoxyCode}
