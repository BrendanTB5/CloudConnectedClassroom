\hypertarget{tls__transcript__hash_8h}{}\section{cyclone\+\_\+ssl/tls\+\_\+transcript\+\_\+hash.h File Reference}
\label{tls__transcript__hash_8h}\index{cyclone\+\_\+ssl/tls\+\_\+transcript\+\_\+hash.\+h@{cyclone\+\_\+ssl/tls\+\_\+transcript\+\_\+hash.\+h}}


Transcript hash calculation.  


{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__transcript__hash_8h_a96f18526c55951964667477c4134f092}{tls\+Init\+Transcript\+Hash} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Initialize handshake message hashing. \end{DoxyCompactList}\item 
void \hyperlink{tls__transcript__hash_8h_a8d1850c2779ca34d9ec197014384be77}{tls\+Update\+Transcript\+Hash} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Update hash value with a handshake message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__transcript__hash_8h_a177688a47fa85bb7fbe3f3ef755f493b}{tls\+Finalize\+Transcript\+Hash} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structHashAlgo}{Hash\+Algo} $\ast$\hyperlink{tls_8h_a17d89840e7296c323504b31fc6359606}{hash}, const void $\ast$hash\+Context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$label, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output)
\begin{DoxyCompactList}\small\item\em Finalize hash calculation from previous handshake messages. \end{DoxyCompactList}\item 
void \hyperlink{tls__transcript__hash_8h_a31d3870ea2bdcaee1ca450c11db2cc94}{tls\+Free\+Transcript\+Hash} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Release transcript hash context. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__transcript__hash_8h_a2cbaa8d948e71f9a3ec07a3a78cff0a9}{tls\+Compute\+Verify\+Data} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End} entity, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$verify\+Data, size\+\_\+t $\ast$verify\+Data\+Len)
\begin{DoxyCompactList}\small\item\em Compute verify data from previous handshake messages. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Transcript hash calculation. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{tls__transcript__hash_8h_a2cbaa8d948e71f9a3ec07a3a78cff0a9}\label{tls__transcript__hash_8h_a2cbaa8d948e71f9a3ec07a3a78cff0a9}} 
\index{tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}!tls\+Compute\+Verify\+Data@{tls\+Compute\+Verify\+Data}}
\index{tls\+Compute\+Verify\+Data@{tls\+Compute\+Verify\+Data}!tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}}
\subsubsection{\texorpdfstring{tls\+Compute\+Verify\+Data()}{tlsComputeVerifyData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Compute\+Verify\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End}}]{entity,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{verify\+Data,  }\item[{size\+\_\+t $\ast$}]{verify\+Data\+Len }\end{DoxyParamCaption})}



Compute verify data from previous handshake messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em entity} & Specifies whether the computation is performed at client or server side \\
\hline
\mbox{\tt out}  & {\em verify\+Data} & Pointer to the buffer where to store the verify data \\
\hline
\mbox{\tt out}  & {\em verify\+Data\+Len} & Length of the verify data \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 385 of file tls\+\_\+transcript\+\_\+hash.\+c.


\begin{DoxyCode}
387 \{
388    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
389 
390 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= SSL\_VERSION\_3\_0)}
391    \textcolor{comment}{//SSL 3.0 currently selected?}
392    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
393    \{
394       \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *label;
395 
396       \textcolor{comment}{//Check whether the computation is performed at client or server side}
397       \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
398          label = \textcolor{stringliteral}{"CLNT"};
399       \textcolor{keywordflow}{else}
400          label = \textcolor{stringliteral}{"SRVR"};
401 
402       \textcolor{comment}{//Compute MD5(masterSecret + pad2 + MD5(handshakeMessages + label +}
403       \textcolor{comment}{//masterSecret + pad1))}
404       error = \hyperlink{tls__transcript__hash_8c_a177688a47fa85bb7fbe3f3ef755f493b}{tlsFinalizeTranscriptHash}(context, 
      \hyperlink{md5_8h_adcb5ecbd7a360856b056f053b0d8343d}{MD5\_HASH\_ALGO},
405          context->transcriptMd5Context, label, verifyData);
406 
407       \textcolor{comment}{//Check status code}
408       \textcolor{keywordflow}{if}(!error)
409       \{
410          \textcolor{comment}{//Compute SHA(masterSecret + pad2 + SHA(handshakeMessages + label +}
411          \textcolor{comment}{//masterSecret + pad1))}
412          error = \hyperlink{tls__transcript__hash_8c_a177688a47fa85bb7fbe3f3ef755f493b}{tlsFinalizeTranscriptHash}(context, 
      \hyperlink{sha1_8h_a2529d805a2d0a0ca32114c810cc6cb1b}{SHA1\_HASH\_ALGO},
413             context->transcriptSha1Context, label, verifyData + \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE});
414       \}
415    \}
416    \textcolor{keywordflow}{else}
417 \textcolor{preprocessor}{#endif}
418 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
419    \textcolor{comment}{//TLS 1.0 or 1.1 currently selected?}
420    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_adcc8f4321c8f3b847fbea16ca0ff337e}{TLS\_VERSION\_1\_0} || context->version == 
      \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
421    \{
422       \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *label;
423       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} digest[\hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE} + \hyperlink{sha1_8h_a3ba9296b223f1b3c710d6b812fd860e8}{SHA1\_DIGEST\_SIZE}];
424 
425       \textcolor{comment}{//Finalize MD5 hash computation}
426       error = \hyperlink{tls__transcript__hash_8c_a177688a47fa85bb7fbe3f3ef755f493b}{tlsFinalizeTranscriptHash}(context, 
      \hyperlink{md5_8h_adcb5ecbd7a360856b056f053b0d8343d}{MD5\_HASH\_ALGO},
427          context->transcriptMd5Context, \textcolor{stringliteral}{""}, digest);
428 
429       \textcolor{comment}{//Check status code}
430       \textcolor{keywordflow}{if}(!error)
431       \{
432          \textcolor{comment}{//Finalize SHA-1 hash computation}
433          error = \hyperlink{tls__transcript__hash_8c_a177688a47fa85bb7fbe3f3ef755f493b}{tlsFinalizeTranscriptHash}(context, 
      \hyperlink{sha1_8h_a2529d805a2d0a0ca32114c810cc6cb1b}{SHA1\_HASH\_ALGO},
434             context->transcriptSha1Context, \textcolor{stringliteral}{""}, digest + \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE});
435       \}
436 
437       \textcolor{comment}{//Check status code}
438       \textcolor{keywordflow}{if}(!error)
439       \{
440          \textcolor{comment}{//Check whether the computation is performed at client or server side}
441          \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
442             label = \textcolor{stringliteral}{"client finished"};
443          \textcolor{keywordflow}{else}
444             label = \textcolor{stringliteral}{"server finished"};
445 
446          \textcolor{comment}{//The verify data is always 12-byte long for TLS 1.0 and 1.1}
447          error = \hyperlink{tls__key__material_8c_a8c9381141cf271397b82f7bf53afdcb8}{tlsPrf}(context->masterSecret, \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE},
448             label, digest, \textcolor{keyword}{sizeof}(digest), verifyData, 12);
449       \}
450    \}
451    \textcolor{keywordflow}{else}
452 \textcolor{preprocessor}{#endif}
453 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
454    \textcolor{comment}{//TLS 1.2 currently selected?}
455    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
456    \{
457       \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *label;
458       \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
459       \hyperlink{structHashContext}{HashContext} *hashContext;
460 
461       \textcolor{comment}{//Point to the hash algorithm to be used}
462       hashAlgo = context->cipherSuite.prfHashAlgo;
463 
464       \textcolor{comment}{//Valid hash algorithm?}
465       \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->transcriptHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
466       \{
467          \textcolor{comment}{//Allocate hash algorithm context}
468          hashContext = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(hashAlgo->\hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
469 
470          \textcolor{comment}{//Successful memory allocation?}
471          \textcolor{keywordflow}{if}(hashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
472          \{
473             \textcolor{comment}{//The original hash context must be preserved}
474             memcpy(hashContext, context->transcriptHashContext,
475                hashAlgo->\hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
476 
477             \textcolor{comment}{//Finalize hash computation}
478             hashAlgo->\hyperlink{structHashAlgo_a8a1972d608540bbf31e1932f5403f51d}{final}(hashContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
479 
480             \textcolor{comment}{//Check whether the computation is performed at client or server side}
481             \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
482                label = \textcolor{stringliteral}{"client finished"};
483             \textcolor{keywordflow}{else}
484                label = \textcolor{stringliteral}{"server finished"};
485 
486             \textcolor{comment}{//Compute the verify data}
487             error = \hyperlink{tls__key__material_8c_a3db35a37ab7a36a93b4f33df4600178b}{tls12Prf}(hashAlgo, context->masterSecret, 
      \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE},
488                label, hashContext->\hyperlink{structHashContext_a846e5b08172b00162569c343caa0eae1}{digest}, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
489                verifyData, context->cipherSuite.verifyDataLen);
490 
491             \textcolor{comment}{//Release previously allocated memory}
492             \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(hashContext);
493          \}
494          \textcolor{keywordflow}{else}
495          \{
496             \textcolor{comment}{//Failed to allocate memory}
497             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
498          \}
499       \}
500       \textcolor{keywordflow}{else}
501       \{
502          \textcolor{comment}{//Invalid hash algorithm}
503          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
504       \}
505    \}
506    \textcolor{keywordflow}{else}
507 \textcolor{preprocessor}{#endif}
508 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
509    \textcolor{comment}{//TLS 1.3 currently selected?}
510    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
511    \{
512       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *baseKey;
513       \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
514       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} digest[\hyperlink{tls_8h_a968ff3e9076117070c5003c2e950c74c}{TLS\_MAX\_HKDF\_DIGEST\_SIZE}];
515       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} finishedKey[\hyperlink{tls_8h_a968ff3e9076117070c5003c2e950c74c}{TLS\_MAX\_HKDF\_DIGEST\_SIZE}];
516 
517       \textcolor{comment}{//The hash function used by HKDF is the cipher suite hash algorithm}
518       hashAlgo = context->cipherSuite.prfHashAlgo;
519 
520       \textcolor{comment}{//Valid hash algorithm?}
521       \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->transcriptHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
522       \{
523          \textcolor{comment}{//Check whether the computation is performed at client or server side}
524          \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
525             baseKey = context->clientHsTrafficSecret;
526          \textcolor{keywordflow}{else}
527             baseKey = context->serverHsTrafficSecret;
528 
529          \textcolor{comment}{//The key used to compute the Finished message is computed from the}
530          \textcolor{comment}{//base key using HKDF}
531          error = \hyperlink{tls13__key__material_8h_ae6c9a07034fb5ca2dcaaef6ac2aa88e9}{tls13HkdfExpandLabel}(hashAlgo, baseKey, hashAlgo->
      \hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
532             \textcolor{stringliteral}{"finished"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, finishedKey, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize});
533 
534          \textcolor{comment}{//Check status code}
535          \textcolor{keywordflow}{if}(!error)
536          \{
537             \textcolor{comment}{//Compute the transcript hash}
538             error = \hyperlink{tls__transcript__hash_8c_a177688a47fa85bb7fbe3f3ef755f493b}{tlsFinalizeTranscriptHash}(context, hashAlgo,
539                context->transcriptHashContext, \textcolor{stringliteral}{""}, digest);
540          \}
541 
542          \textcolor{comment}{//Check status code}
543          \textcolor{keywordflow}{if}(!error)
544          \{
545             \textcolor{comment}{//Compute the verify data}
546             error = \hyperlink{hmac_8c_a2c250d9716561ce1aadb4a514b76a799}{hmacCompute}(hashAlgo, finishedKey, hashAlgo->
      \hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
547                digest, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, verifyData);
548          \}
549       \}
550       \textcolor{keywordflow}{else}
551       \{
552          \textcolor{comment}{//Invalid hash algorithm}
553          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
554       \}
555    \}
556    \textcolor{keywordflow}{else}
557 \textcolor{preprocessor}{#endif}
558    \textcolor{comment}{//Invalid TLS version?}
559    \{
560       \textcolor{comment}{//Report an error}
561       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
562    \}
563 
564    \textcolor{comment}{//Check status code}
565    \textcolor{keywordflow}{if}(!error)
566    \{
567       \textcolor{comment}{//Save the length of the verify data}
568       *verifyDataLen = context->cipherSuite.verifyDataLen;
569 
570       \textcolor{comment}{//Debug message}
571       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"Verify data:\(\backslash\)r\(\backslash\)n"});
572       \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, verifyData, *verifyDataLen);
573    \}
574 
575    \textcolor{comment}{//Return status code}
576    \textcolor{keywordflow}{return} error;
577 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__transcript__hash_8h_a177688a47fa85bb7fbe3f3ef755f493b}\label{tls__transcript__hash_8h_a177688a47fa85bb7fbe3f3ef755f493b}} 
\index{tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}!tls\+Finalize\+Transcript\+Hash@{tls\+Finalize\+Transcript\+Hash}}
\index{tls\+Finalize\+Transcript\+Hash@{tls\+Finalize\+Transcript\+Hash}!tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}}
\subsubsection{\texorpdfstring{tls\+Finalize\+Transcript\+Hash()}{tlsFinalizeTranscriptHash()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Finalize\+Transcript\+Hash (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structHashAlgo}{Hash\+Algo} $\ast$}]{hash,  }\item[{const void $\ast$}]{hash\+Context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{label,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output }\end{DoxyParamCaption})}



Finalize hash calculation from previous handshake messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em hash} & Hash function used to digest the handshake messages \\
\hline
\mbox{\tt in}  & {\em hash\+Context} & Pointer to the hash context \\
\hline
\mbox{\tt in}  & {\em label} & N\+U\+L\+L-\/terminated string \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to store the resulting hash value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 254 of file tls\+\_\+transcript\+\_\+hash.\+c.


\begin{DoxyCode}
256 \{
257    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
258    \hyperlink{structHashContext}{HashContext} *tempHashContext;
259 
260    \textcolor{comment}{//Make sure the hash context is valid}
261    \textcolor{keywordflow}{if}(hash == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || hashContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
262       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
263 
264    \textcolor{comment}{//Allocate a temporary hash context}
265    tempHashContext = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(hash->\hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
266 
267    \textcolor{comment}{//Successful memory allocation?}
268    \textcolor{keywordflow}{if}(tempHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
269    \{
270       \textcolor{comment}{//The original hash context must be preserved}
271       memcpy(tempHashContext, hashContext, hash->\hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
272 
273 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= SSL\_VERSION\_3\_0)}
274       \textcolor{comment}{//SSL 3.0 currently selected?}
275       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
276       \{
277          \textcolor{keywordtype}{size\_t} labelLen;
278          \textcolor{keywordtype}{size\_t} padLen;
279 
280          \textcolor{comment}{//Retrieve the length of the label}
281          labelLen = strlen(label);
282 
283          \textcolor{comment}{//The pad character is repeated 48 times for MD5 or 40 times for SHA-1}
284          padLen = (hash == \hyperlink{md5_8h_adcb5ecbd7a360856b056f053b0d8343d}{MD5\_HASH\_ALGO}) ? 48 : 40;
285 
286          \textcolor{comment}{//hash(handshakeMessages + label + masterSecret + pad1)}
287          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, label, labelLen);
288          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, context->masterSecret, 
      \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE});
289          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, \hyperlink{ssl__misc_8h_a3a4be9490ed9f1407d98af02dfdc1073}{sslPad1}, padLen);
290          hash->\hyperlink{structHashAlgo_a8a1972d608540bbf31e1932f5403f51d}{final}(tempHashContext, output);
291 
292          \textcolor{comment}{//hash(masterSecret + pad2 + hash(handshakeMessages + label +}
293          \textcolor{comment}{//masterSecret + pad1))}
294          hash->\hyperlink{structHashAlgo_a77dcebcb5fd49cd6672ad6c97b55fdee}{init}(tempHashContext);
295          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, context->masterSecret, 
      \hyperlink{tls_8h_ae3ac5e6ccd1e8295f15951175e3b7e2b}{TLS\_MASTER\_SECRET\_SIZE});
296          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, \hyperlink{ssl__misc_8h_a047be8ca6e9b00e0fae38ee88e03d27a}{sslPad2}, padLen);
297          hash->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(tempHashContext, output, hash->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize});
298          hash->\hyperlink{structHashAlgo_a8a1972d608540bbf31e1932f5403f51d}{final}(tempHashContext, output);
299 
300          \textcolor{comment}{//Successful processing}
301          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
302       \}
303       \textcolor{keywordflow}{else}
304 \textcolor{preprocessor}{#endif}
305 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
306       \textcolor{comment}{//TLS 1.0, TLS 1.1, TLS 1.2 or TLS 1.3 currently selected?}
307       \textcolor{keywordflow}{if}(context->version >= \hyperlink{tls_8h_adcc8f4321c8f3b847fbea16ca0ff337e}{TLS\_VERSION\_1\_0} && context->version <= 
      \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
308       \{
309          \textcolor{comment}{//Compute hash(handshakeMessages)}
310          hash->\hyperlink{structHashAlgo_a8a1972d608540bbf31e1932f5403f51d}{final}(tempHashContext, output);
311          \textcolor{comment}{//Successful processing}
312          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
313       \}
314       \textcolor{keywordflow}{else}
315 \textcolor{preprocessor}{#endif}
316       \textcolor{comment}{//Invalid TLS version?}
317       \{
318          \textcolor{comment}{//Report an error}
319          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
320       \}
321 
322       \textcolor{comment}{//Release previously allocated resources}
323       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(tempHashContext);
324    \}
325    \textcolor{keywordflow}{else}
326    \{
327       \textcolor{comment}{//Failed to allocate memory}
328       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
329    \}
330 
331    \textcolor{comment}{//Return status code}
332    \textcolor{keywordflow}{return} error;
333 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__transcript__hash_8h_a31d3870ea2bdcaee1ca450c11db2cc94}\label{tls__transcript__hash_8h_a31d3870ea2bdcaee1ca450c11db2cc94}} 
\index{tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}!tls\+Free\+Transcript\+Hash@{tls\+Free\+Transcript\+Hash}}
\index{tls\+Free\+Transcript\+Hash@{tls\+Free\+Transcript\+Hash}!tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}}
\subsubsection{\texorpdfstring{tls\+Free\+Transcript\+Hash()}{tlsFreeTranscriptHash()}}
{\footnotesize\ttfamily void tls\+Free\+Transcript\+Hash (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Release transcript hash context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 342 of file tls\+\_\+transcript\+\_\+hash.\+c.


\begin{DoxyCode}
343 \{
344 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
345    \textcolor{comment}{//Release MD5 hash context}
346    \textcolor{keywordflow}{if}(context->transcriptMd5Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
347    \{
348       memset(context->transcriptMd5Context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structMd5Context}{Md5Context}));
349       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptMd5Context);
350       context->transcriptMd5Context = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
351    \}
352 \textcolor{preprocessor}{#endif}
353 
354 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
355    \textcolor{comment}{//Release SHA-1 hash context}
356    \textcolor{keywordflow}{if}(context->transcriptSha1Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
357    \{
358       memset(context->transcriptSha1Context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSha1Context}{Sha1Context}));
359       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptSha1Context);
360       context->transcriptSha1Context = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
361    \}
362 \textcolor{preprocessor}{#endif}
363 
364 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
365    \textcolor{comment}{//Release transcript hash context}
366    \textcolor{keywordflow}{if}(context->transcriptHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
367    \{
368       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptHashContext);
369       context->transcriptHashContext = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
370    \}
371 \textcolor{preprocessor}{#endif}
372 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__transcript__hash_8h_a96f18526c55951964667477c4134f092}\label{tls__transcript__hash_8h_a96f18526c55951964667477c4134f092}} 
\index{tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}!tls\+Init\+Transcript\+Hash@{tls\+Init\+Transcript\+Hash}}
\index{tls\+Init\+Transcript\+Hash@{tls\+Init\+Transcript\+Hash}!tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}}
\subsubsection{\texorpdfstring{tls\+Init\+Transcript\+Hash()}{tlsInitTranscriptHash()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Init\+Transcript\+Hash (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Initialize handshake message hashing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 54 of file tls\+\_\+transcript\+\_\+hash.\+c.


\begin{DoxyCode}
55 \{
56 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
57    \textcolor{comment}{//MD5 context already instantiated?}
58    \textcolor{keywordflow}{if}(context->transcriptMd5Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
59    \{
60       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptMd5Context);
61       context->transcriptMd5Context = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
62    \}
63 \textcolor{preprocessor}{#endif}
64 
65 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
66    \textcolor{comment}{//SHA-1 context already instantiated?}
67    \textcolor{keywordflow}{if}(context->transcriptSha1Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
68    \{
69       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptSha1Context);
70       context->transcriptSha1Context = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
71    \}
72 \textcolor{preprocessor}{#endif}
73 
74 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
75    \textcolor{comment}{//Hash algorithm context already instantiated?}
76    \textcolor{keywordflow}{if}(context->transcriptHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
77    \{
78       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->transcriptHashContext);
79       context->transcriptHashContext = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
80    \}
81 \textcolor{preprocessor}{#endif}
82 
83 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
84    \textcolor{comment}{//SSL 3.0, TLS 1.0 or TLS 1.1 currently selected?}
85    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
86    \{
87       \textcolor{comment}{//Allocate MD5 context}
88       context->transcriptMd5Context = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structMd5Context}{Md5Context}));
89       \textcolor{comment}{//Failed to allocate memory?}
90       \textcolor{keywordflow}{if}(context->transcriptMd5Context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
91          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
92 
93       \textcolor{comment}{//Initialize MD5 context}
94       \hyperlink{md5_8c_acc37d4333236797f144067f5c39f345e}{md5Init}(context->transcriptMd5Context);
95    \}
96 \textcolor{preprocessor}{#endif}
97 
98 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
99    \textcolor{comment}{//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?}
100    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
101    \{
102       \textcolor{comment}{//Allocate SHA-1 context}
103       context->transcriptSha1Context = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structSha1Context}{Sha1Context}));
104       \textcolor{comment}{//Failed to allocate memory?}
105       \textcolor{keywordflow}{if}(context->transcriptSha1Context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
106          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
107 
108       \textcolor{comment}{//Initialize SHA-1 context}
109       \hyperlink{sha1_8c_ab734cb0e0b67798f5cce1f34419982a3}{sha1Init}(context->transcriptSha1Context);
110    \}
111 \textcolor{preprocessor}{#endif}
112 
113 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
114    \textcolor{comment}{//TLS 1.2 or 1.3 currently selected?}
115    \textcolor{keywordflow}{if}(context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
116    \{
117       \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
118 
119       \textcolor{comment}{//Point to the hash algorithm to be used}
120       hashAlgo = context->cipherSuite.prfHashAlgo;
121       \textcolor{comment}{//Make sure the hash algorithm is valid}
122       \textcolor{keywordflow}{if}(hashAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
123          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
124 
125       \textcolor{comment}{//Allocate hash algorithm context}
126       context->transcriptHashContext = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(hashAlgo->
      \hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
127       \textcolor{comment}{//Failed to allocate memory?}
128       \textcolor{keywordflow}{if}(context->transcriptHashContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
129          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
130 
131       \textcolor{comment}{//Initialize the hash algorithm context}
132       hashAlgo->\hyperlink{structHashAlgo_a77dcebcb5fd49cd6672ad6c97b55fdee}{init}(context->transcriptHashContext);
133    \}
134 \textcolor{preprocessor}{#endif}
135 
136 \textcolor{preprocessor}{#if (TLS\_CLIENT\_SUPPORT == ENABLED)}
137    \textcolor{comment}{//Client mode?}
138    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
139    \{
140 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
141       \textcolor{comment}{//DTLS protocol?}
142       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
143       \{
144          \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
145          \hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord} *record;
146 
147          \textcolor{comment}{//Point to the DTLS record that holds the ClientHello message}
148          record = (\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord} *) context->txBuffer;
149 
150          \textcolor{comment}{//Sanity check}
151          \textcolor{keywordflow}{if}(context->txBufferLen > \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord}))
152          \{
153             \textcolor{comment}{//Retrieve the length of the handshake message}
154             length = context->txBufferLen - \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_aa040fe65c76996b53784c307b96cf95e}{DtlsRecord});
155 
156             \textcolor{comment}{//Update the hash value with the ClientHello message}
157             \hyperlink{tls__transcript__hash_8c_a8d1850c2779ca34d9ec197014384be77}{tlsUpdateTranscriptHash}(context, record->data, length);
158          \}
159       \}
160       \textcolor{keywordflow}{else}
161 \textcolor{preprocessor}{#endif}
162       \textcolor{comment}{//TLS protocol?}
163       \{
164          \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
165          \hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord} *record;
166 
167          \textcolor{comment}{//Point to the TLS record that holds the ClientHello message}
168          record = (\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord} *) context->txBuffer;
169 
170          \textcolor{comment}{//Retrieve the length of the handshake message}
171          length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->length);
172 
173          \textcolor{comment}{//Sanity check}
174          \textcolor{keywordflow}{if}((length + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a788513974142abbff8a56fe1cd783afb}{TlsRecord})) <= context->txBufferSize)
175          \{
176             \textcolor{comment}{//Update the hash value with the ClientHello message}
177             \hyperlink{tls__transcript__hash_8c_a8d1850c2779ca34d9ec197014384be77}{tlsUpdateTranscriptHash}(context, record->data, length);
178          \}
179       \}
180    \}
181 \textcolor{preprocessor}{#endif}
182 
183    \textcolor{comment}{//Successful initialization}
184    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
185 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__transcript__hash_8h_a8d1850c2779ca34d9ec197014384be77}\label{tls__transcript__hash_8h_a8d1850c2779ca34d9ec197014384be77}} 
\index{tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}!tls\+Update\+Transcript\+Hash@{tls\+Update\+Transcript\+Hash}}
\index{tls\+Update\+Transcript\+Hash@{tls\+Update\+Transcript\+Hash}!tls\+\_\+transcript\+\_\+hash.\+h@{tls\+\_\+transcript\+\_\+hash.\+h}}
\subsubsection{\texorpdfstring{tls\+Update\+Transcript\+Hash()}{tlsUpdateTranscriptHash()}}
{\footnotesize\ttfamily void tls\+Update\+Transcript\+Hash (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Update hash value with a handshake message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to the handshake message being hashed \\
\hline
\mbox{\tt in}  & {\em length} & Length of the message \\
\hline
\end{DoxyParams}


Definition at line 195 of file tls\+\_\+transcript\+\_\+hash.\+c.


\begin{DoxyCode}
197 \{
198 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
199    \textcolor{comment}{//SSL 3.0, TLS 1.0 or TLS 1.1 currently selected?}
200    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
201    \{
202       \textcolor{comment}{//Valid MD5 context?}
203       \textcolor{keywordflow}{if}(context->transcriptMd5Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
204       \{
205          \textcolor{comment}{//Update MD5 hash value with message contents}
206          \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(context->transcriptMd5Context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
207       \}
208    \}
209 \textcolor{preprocessor}{#endif}
210 
211 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
212    \textcolor{comment}{//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?}
213    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
214    \{
215       \textcolor{comment}{//Valid SHA-1 context?}
216       \textcolor{keywordflow}{if}(context->transcriptSha1Context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
217       \{
218          \textcolor{comment}{//Update SHA-1 hash value with message contents}
219          \hyperlink{sha1_8c_a910571a0170efa26560fe6300a9b87d9}{sha1Update}(context->transcriptSha1Context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
220       \}
221    \}
222 \textcolor{preprocessor}{#endif}
223 
224 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
225    \textcolor{comment}{//TLS 1.2 or TLS 1.3 currently selected?}
226    \textcolor{keywordflow}{if}(context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
227    \{
228       \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
229 
230       \textcolor{comment}{//Point to the PRF hash algorithm to be used}
231       hashAlgo = context->cipherSuite.prfHashAlgo;
232 
233       \textcolor{comment}{//Valid hash algorithm?}
234       \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->transcriptHashContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
235       \{
236          \textcolor{comment}{//Update hash value with message contents}
237          hashAlgo->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(context->transcriptHashContext, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
238       \}
239    \}
240 \textcolor{preprocessor}{#endif}
241 \}
\end{DoxyCode}
