\hypertarget{xts_8c}{}\section{cyclone\+\_\+crypto/cipher\+\_\+mode/xts.c File Reference}
\label{xts_8c}\index{cyclone\+\_\+crypto/cipher\+\_\+mode/xts.\+c@{cyclone\+\_\+crypto/cipher\+\_\+mode/xts.\+c}}


X\+E\+X-\/based tweaked-\/codebook mode with ciphertext stealing (X\+TS)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cipher\+\_\+mode/xts.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{xts_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{xts_8c_ab5be3000b170a6310dd832aa4cab5ad7}{xts\+Init} (\hyperlink{structXtsContext}{Xts\+Context} $\ast$context, const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher\+Algo, const void $\ast$key, size\+\_\+t key\+Len)
\begin{DoxyCompactList}\small\item\em Initialize X\+TS context. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{xts_8c_a9f742fbe89ffc6aebe3da2e94d42ed79}{xts\+Encrypt} (\hyperlink{structXtsContext}{Xts\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$i, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Encrypt a data unit using X\+TS. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{xts_8c_a0eceb5b93c8cbad6b05f7208f7939567}{xts\+Decrypt} (\hyperlink{structXtsContext}{Xts\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$i, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Decrypt a data unit using X\+TS. \end{DoxyCompactList}\item 
void \hyperlink{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}{xts\+Mul} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a})
\begin{DoxyCompactList}\small\item\em Multiplication by x in G\+F(2$^\wedge$128) \end{DoxyCompactList}\item 
void \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xts\+Xor\+Block} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b})
\begin{DoxyCompactList}\small\item\em X\+OR operation. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
X\+E\+X-\/based tweaked-\/codebook mode with ciphertext stealing (X\+TS) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
X\+TS is a tweakable block cipher designed for encryption of sector-\/based storage. Refer to I\+E\+EE Std 1619 and SP 800-\/38E for more details

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{xts_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{xts_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{xts.\+c@{xts.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 37 of file xts.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{xts_8c_a0eceb5b93c8cbad6b05f7208f7939567}\label{xts_8c_a0eceb5b93c8cbad6b05f7208f7939567}} 
\index{xts.\+c@{xts.\+c}!xts\+Decrypt@{xts\+Decrypt}}
\index{xts\+Decrypt@{xts\+Decrypt}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{xts\+Decrypt()}{xtsDecrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} xts\+Decrypt (\begin{DoxyParamCaption}\item[{\hyperlink{structXtsContext}{Xts\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{i,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Decrypt a data unit using X\+TS. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the X\+TS context \\
\hline
\mbox{\tt in}  & {\em i} & Value of the 128-\/bit tweak \\
\hline
\mbox{\tt in}  & {\em c} & Pointer to the data unit to be decrypted (ciphertext) \\
\hline
\mbox{\tt out}  & {\em p} & Pointer to the resulting data unit (plaintext) \\
\hline
\mbox{\tt in}  & {\em length} & Length of the data unit, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 171 of file xts.\+c.


\begin{DoxyCode}
173 \{
174    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[16];
175    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} x[16];
176 
177    \textcolor{comment}{//The data unit size shall be at least 128 bits}
178    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < 16)
179       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
180 
181    \textcolor{comment}{//Encrypt the tweak using K2}
182    context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structXtsContext_afb74d825b35a35c34eff9ecbab9b49c4}{cipherContext2}, i, t);
183 
184    \textcolor{comment}{//XTS mode operates in a block-by-block fashion}
185    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= 32)
186    \{
187       \textcolor{comment}{//Merge the tweak into the input block}
188       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(x, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, t);
189       \textcolor{comment}{//Decrypt the block using K1}
190       context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a3023886b85aca88688456ed460a8576d}{decryptBlock}(context->
      \hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, x, x);
191       \textcolor{comment}{//Merge the tweak into the output block}
192       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, x, t);
193 
194       \textcolor{comment}{//Multiply T by x in GF(2^128)}
195       \hyperlink{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}{xtsMul}(t, t);
196 
197       \textcolor{comment}{//Next block}
198       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += 16;
199       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += 16;
200       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 16;
201    \}
202 
203    \textcolor{comment}{//Any partial block?}
204    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 16)
205    \{
206       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} tt[16];
207 
208       \textcolor{comment}{//Multiply T by x in GF(2^128)}
209       \hyperlink{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}{xtsMul}(tt, t);
210 
211       \textcolor{comment}{//Merge the tweak into the input block}
212       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(x, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, tt);
213       \textcolor{comment}{//Decrypt the next-to-last block using K1}
214       context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a3023886b85aca88688456ed460a8576d}{decryptBlock}(context->
      \hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, x, x);
215       \textcolor{comment}{//Merge the tweak into the output block}
216       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, x, tt);
217 
218       \textcolor{comment}{//Retrieve the length of the final block}
219       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 16;
220 
221       \textcolor{comment}{//Copy the final plaintext bytes}
222       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} + 16, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
223       \textcolor{comment}{//Copy the final ciphertext bytes}
224       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} + 16, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
225       \textcolor{comment}{//Steal ciphertext to complete the block}
226       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 16 - \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
227    \}
228    \textcolor{keywordflow}{else}
229    \{
230       \textcolor{comment}{//The last block contains exactly 128 bits}
231       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, 16);
232    \}
233 
234    \textcolor{comment}{//Merge the tweak into the input block}
235    \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(x, x, t);
236    \textcolor{comment}{//Decrypt the final block using K1}
237    context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a3023886b85aca88688456ed460a8576d}{decryptBlock}(context->
      \hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, x, x);
238    \textcolor{comment}{//Merge the tweak into the output block}
239    \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, x, t);
240 
241    \textcolor{comment}{//Successful processing}
242    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
243 \}
\end{DoxyCode}
\mbox{\Hypertarget{xts_8c_a9f742fbe89ffc6aebe3da2e94d42ed79}\label{xts_8c_a9f742fbe89ffc6aebe3da2e94d42ed79}} 
\index{xts.\+c@{xts.\+c}!xts\+Encrypt@{xts\+Encrypt}}
\index{xts\+Encrypt@{xts\+Encrypt}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{xts\+Encrypt()}{xtsEncrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} xts\+Encrypt (\begin{DoxyParamCaption}\item[{\hyperlink{structXtsContext}{Xts\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{i,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Encrypt a data unit using X\+TS. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the X\+TS context \\
\hline
\mbox{\tt in}  & {\em i} & Value of the 128-\/bit tweak \\
\hline
\mbox{\tt in}  & {\em p} & Pointer to the data unit to be encrypted (plaintext) \\
\hline
\mbox{\tt out}  & {\em c} & Pointer to the resulting data unit (ciphertext) \\
\hline
\mbox{\tt in}  & {\em length} & Length of the data unit, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 106 of file xts.\+c.


\begin{DoxyCode}
108 \{
109    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[16];
110    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} x[16];
111 
112    \textcolor{comment}{//The data unit size shall be at least 128 bits}
113    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < 16)
114       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
115 
116    \textcolor{comment}{//Encrypt the tweak using K2}
117    context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structXtsContext_afb74d825b35a35c34eff9ecbab9b49c4}{cipherContext2}, i, t);
118 
119    \textcolor{comment}{//XTS mode operates in a block-by-block fashion}
120    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= 16)
121    \{
122       \textcolor{comment}{//Merge the tweak into the input block}
123       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(x, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, t);
124       \textcolor{comment}{//Encrypt the block using K1}
125       context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, x, x);
126       \textcolor{comment}{//Merge the tweak into the output block}
127       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, x, t);
128 
129       \textcolor{comment}{//Multiply T by x in GF(2^128)}
130       \hyperlink{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}{xtsMul}(t, t);
131 
132       \textcolor{comment}{//Next block}
133       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += 16;
134       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += 16;
135       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 16;
136    \}
137 
138    \textcolor{comment}{//Any partial block?}
139    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
140    \{
141       \textcolor{comment}{//Copy the final ciphertext bytes}
142       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} - 16, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
143       \textcolor{comment}{//Copy the final plaintext bytes}
144       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
145       \textcolor{comment}{//Steal ciphertext to complete the block}
146       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 16, 16 - 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
147 
148       \textcolor{comment}{//Merge the tweak into the input block}
149       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(x, x, t);
150       \textcolor{comment}{//Encrypt the final block using K1}
151       context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, x, x);
152       \textcolor{comment}{//Merge the tweak into the output block}
153       \hyperlink{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}{xtsXorBlock}(\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} - 16, x, t);
154    \}
155 
156    \textcolor{comment}{//Successful processing}
157    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
158 \}
\end{DoxyCode}
\mbox{\Hypertarget{xts_8c_ab5be3000b170a6310dd832aa4cab5ad7}\label{xts_8c_ab5be3000b170a6310dd832aa4cab5ad7}} 
\index{xts.\+c@{xts.\+c}!xts\+Init@{xts\+Init}}
\index{xts\+Init@{xts\+Init}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{xts\+Init()}{xtsInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} xts\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structXtsContext}{Xts\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher\+Algo,  }\item[{const void $\ast$}]{key,  }\item[{size\+\_\+t}]{key\+Len }\end{DoxyParamCaption})}



Initialize X\+TS context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the X\+TS context \\
\hline
\mbox{\tt in}  & {\em cipher\+Algo} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em key} & Pointer to the key \\
\hline
\mbox{\tt in}  & {\em key\+Len} & Length of the key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 57 of file xts.\+c.


\begin{DoxyCode}
59 \{
60    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
61    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{pic32mx_2isr__support_8h_acd74e3bc3febb3d053f79a5fa02a92d1}{k1};
62    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *k2;
63 
64    \textcolor{comment}{//XTS supports only symmetric block ciphers whose block size is 128 bits}
65    \textcolor{keywordflow}{if}(cipherAlgo->\hyperlink{structCipherAlgo_a840c614fa1ae0f98a9350bc4f040dc7a}{type} != \hyperlink{cyclone__crypto_2core_2crypto_8h_ae03a6c8f32ed798857924d908aacc49bac347f6aa82618d4d57fe85cba6520ce9}{CIPHER\_ALGO\_TYPE\_BLOCK} || cipherAlgo->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} != 16)
66       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
67 
68    \textcolor{comment}{//Invalid key length?}
69    \textcolor{keywordflow}{if}(keyLen != 32 && keyLen != 64)
70       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
71 
72    \textcolor{comment}{//Cipher algorithm used to perform XTS encryption/decryption}
73    context->\hyperlink{structXtsContext_a4cb31e6e5e5b201f619cd276dd08e95b}{cipherAlgo} = cipherAlgo;
74 
75    \textcolor{comment}{//The key is parsed as a concatenation of 2 fields of equal size called K1 and K2}
76    k1 = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) key;
77    k2 = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) key + (keyLen / 2);
78 
79    \textcolor{comment}{//Initialize first cipher context using K1}
80    error = cipherAlgo->\hyperlink{structCipherAlgo_a5c1fa3eb89f3d31f01c2c501b94fdd79}{init}(context->\hyperlink{structXtsContext_a64bb7668459fbcd40d7f7915e9a79a97}{cipherContext1}, k1, keyLen / 2);
81    \textcolor{comment}{//Any error to report?}
82    \textcolor{keywordflow}{if}(error)
83       \textcolor{keywordflow}{return} error;
84 
85    \textcolor{comment}{//Initialize second cipher context using K2}
86    error = cipherAlgo->\hyperlink{structCipherAlgo_a5c1fa3eb89f3d31f01c2c501b94fdd79}{init}(context->\hyperlink{structXtsContext_afb74d825b35a35c34eff9ecbab9b49c4}{cipherContext2}, k2, keyLen / 2);
87    \textcolor{comment}{//Any error to report?}
88    \textcolor{keywordflow}{if}(error)
89       \textcolor{keywordflow}{return} error;
90 
91    \textcolor{comment}{//Successful initialization}
92    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
93 \}
\end{DoxyCode}
\mbox{\Hypertarget{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}\label{xts_8c_abd261623a198e5bdfcbb88a1d860f2a4}} 
\index{xts.\+c@{xts.\+c}!xts\+Mul@{xts\+Mul}}
\index{xts\+Mul@{xts\+Mul}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{xts\+Mul()}{xtsMul()}}
{\footnotesize\ttfamily void xts\+Mul (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a }\end{DoxyParamCaption})}



Multiplication by x in G\+F(2$^\wedge$128) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em x} & Pointer to the output block \\
\hline
\mbox{\tt out}  & {\em a} & Pointer to the input block \\
\hline
\end{DoxyParams}


Definition at line 252 of file xts.\+c.


\begin{DoxyCode}
253 \{
254    \textcolor{keywordtype}{size\_t} i;
255    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
256 
257    \textcolor{comment}{//Save the value of the most significant bit}
258    c = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[15] >> 7;
259 
260    \textcolor{comment}{//The multiplication of a polynomial by x in GF(2^128) corresponds to a}
261    \textcolor{comment}{//shift of indices}
262    \textcolor{keywordflow}{for}(i = 15; i > 0; i--)
263    \{
264       x[i] = (\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i] << 1) | (\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i - 1] >> 7);
265    \}
266 
267    \textcolor{comment}{//Shift the first byte of the block}
268    x[0] = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[0] << 1;
269 
270    \textcolor{comment}{//If the highest term of the result is equal to one, then perform reduction}
271    x[0] ^= 0x87 & ~(c - 1);
272 \}
\end{DoxyCode}
\mbox{\Hypertarget{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}\label{xts_8c_a5d76afcfdf2b3942245ca2f4105c0d8d}} 
\index{xts.\+c@{xts.\+c}!xts\+Xor\+Block@{xts\+Xor\+Block}}
\index{xts\+Xor\+Block@{xts\+Xor\+Block}!xts.\+c@{xts.\+c}}
\subsubsection{\texorpdfstring{xts\+Xor\+Block()}{xtsXorBlock()}}
{\footnotesize\ttfamily void xts\+Xor\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b }\end{DoxyParamCaption})}



X\+OR operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em x} & Block resulting from the X\+OR operation \\
\hline
\mbox{\tt in}  & {\em a} & First input block \\
\hline
\mbox{\tt in}  & {\em b} & Second input block \\
\hline
\end{DoxyParams}


Definition at line 282 of file xts.\+c.


\begin{DoxyCode}
283 \{
284    \textcolor{keywordtype}{size\_t} i;
285 
286    \textcolor{comment}{//Perform XOR operation}
287    \textcolor{keywordflow}{for}(i = 0; i < 16; i++)
288    \{
289       x[i] = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i] ^ \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[i];
290    \}
291 \}
\end{DoxyCode}
