\hypertarget{mqtt__client__misc_8c}{}\section{cyclone\+\_\+tcp/mqtt/mqtt\+\_\+client\+\_\+misc.c File Reference}
\label{mqtt__client__misc_8c}\index{cyclone\+\_\+tcp/mqtt/mqtt\+\_\+client\+\_\+misc.\+c@{cyclone\+\_\+tcp/mqtt/mqtt\+\_\+client\+\_\+misc.\+c}}


Helper functions for M\+Q\+TT client.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mqtt/mqtt\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mqtt/mqtt\+\_\+client\+\_\+packet.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mqtt/mqtt\+\_\+client\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mqtt/mqtt\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{mqtt__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_aa3a1432707eaba04c3ba082436b7a767}{M\+Q\+T\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqtt\+Client\+Change\+State} (\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$context, \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00}{Mqtt\+Client\+State} new\+State)
\begin{DoxyCompactList}\small\item\em Update M\+Q\+TT client state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_aefad7cd8e496ef1d9e60b56178a40699}{mqtt\+Client\+Process\+Events} (\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} timeout)
\begin{DoxyCompactList}\small\item\em Process M\+Q\+TT client events. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_af8e0a56ac0332d8051c50fc2a55cf118}{mqtt\+Client\+Check\+Keep\+Alive} (\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Check keep-\/alive time interval. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_aaf7ce18e001d1e585d3d82ae35951eaa}{mqtt\+Serialize\+Header} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t $\ast$pos, \hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796}{Mqtt\+Packet\+Type} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{mqtt__sn__common_8h_a4e198deb57c49dad652a61d21ad478e6}{dup}, \hyperlink{mqtt__common_8h_a79ec1e304b7f2ed51b12f489f642f0bb}{Mqtt\+Qos\+Level} \hyperlink{mqtt__sn__common_8h_a65ee2b4b16f25052c441ff9959dcc7e7}{qos}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{mqtt__sn__common_8h_ae25d47ab22bd975ad97012eddb6bbfce}{retain}, size\+\_\+t remaining\+Len)
\begin{DoxyCompactList}\small\item\em Serialize fixed header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_ad20ce540ff897e5aa78a58820bd60f6d}{mqtt\+Serialize\+Byte} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Write a 8-\/bit integer to the output buffer. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_abfb1aa77533be466e3082ae817ccdde6}{mqtt\+Serialize\+Short} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Write a 16-\/bit integer to the output buffer. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_a7cdabc6df81fb790ef977d811bf6c8a6}{mqtt\+Serialize\+String} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, const void $\ast$string, size\+\_\+t string\+Len)
\begin{DoxyCompactList}\small\item\em Serialize string. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_a6c69ea12b178140e3323e9711ec8728a}{mqtt\+Serialize\+Data} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t data\+Len)
\begin{DoxyCompactList}\small\item\em Serialize raw data. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_a3588be0ed9b0709cfbaa0956cb006c5c}{mqtt\+Deserialize\+Header} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796}{Mqtt\+Packet\+Type} $\ast$\hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$\hyperlink{mqtt__sn__common_8h_a4e198deb57c49dad652a61d21ad478e6}{dup}, \hyperlink{mqtt__common_8h_a79ec1e304b7f2ed51b12f489f642f0bb}{Mqtt\+Qos\+Level} $\ast$\hyperlink{mqtt__sn__common_8h_a65ee2b4b16f25052c441ff9959dcc7e7}{qos}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$\hyperlink{mqtt__sn__common_8h_ae25d47ab22bd975ad97012eddb6bbfce}{retain}, size\+\_\+t $\ast$remaining\+Len)
\begin{DoxyCompactList}\small\item\em Deserialize fixed header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_a65ea81722d769423b6bb3d74a5a7c984}{mqtt\+Deserialize\+Byte} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Read a 8-\/bit integer from the input buffer. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_aad98e4b63b2676bc9b0db9b093c50792}{mqtt\+Deserialize\+Short} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Read a 16-\/bit integer from the input buffer. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mqtt__client__misc_8c_ac49cf0f6db605fc125fada9b529c4dc4}{mqtt\+Deserialize\+String} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$buffer, size\+\_\+t buffer\+Len, size\+\_\+t $\ast$pos, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$$\ast$string, size\+\_\+t $\ast$string\+Len)
\begin{DoxyCompactList}\small\item\em Deserialize string. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Helper functions for M\+Q\+TT client. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{mqtt__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{mqtt__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_aa3a1432707eaba04c3ba082436b7a767}{M\+Q\+T\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file mqtt\+\_\+client\+\_\+misc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}\label{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Client\+Change\+State@{mqtt\+Client\+Change\+State}}
\index{mqtt\+Client\+Change\+State@{mqtt\+Client\+Change\+State}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Client\+Change\+State()}{mqttClientChangeState()}}
{\footnotesize\ttfamily void mqtt\+Client\+Change\+State (\begin{DoxyParamCaption}\item[{\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00}{Mqtt\+Client\+State}}]{new\+State }\end{DoxyParamCaption})}



Update M\+Q\+TT client state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the M\+Q\+TT client context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\end{DoxyParams}


Definition at line 52 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
53 \{
54    \textcolor{comment}{//Switch to the new state}
55    context->state = newState;
56 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_af8e0a56ac0332d8051c50fc2a55cf118}\label{mqtt__client__misc_8c_af8e0a56ac0332d8051c50fc2a55cf118}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Client\+Check\+Keep\+Alive@{mqtt\+Client\+Check\+Keep\+Alive}}
\index{mqtt\+Client\+Check\+Keep\+Alive@{mqtt\+Client\+Check\+Keep\+Alive}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Client\+Check\+Keep\+Alive()}{mqttClientCheckKeepAlive()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Client\+Check\+Keep\+Alive (\begin{DoxyParamCaption}\item[{\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Check keep-\/alive time interval. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the M\+Q\+TT client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 156 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
157 \{
158    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
159    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
160    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} keepAlive;
161 
162    \textcolor{comment}{//Initialize status code}
163    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
164 
165    \textcolor{comment}{//In the absence of sending any other control packets, the client must}
166    \textcolor{comment}{//send a PINGREQ packet}
167    \textcolor{keywordflow}{if}(context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00aad8e4a28cbf24a479a4b5dd05cbb64d6}{MQTT\_CLIENT\_STATE\_IDLE} ||
168       context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00ac50e87d5b3d709d78a627a69c29dc3da}{MQTT\_CLIENT\_STATE\_PACKET\_SENT})
169    \{
170       \textcolor{comment}{//A keep-alive value of zero has the effect of turning off the keep}
171       \textcolor{comment}{//alive mechanism}
172       \textcolor{keywordflow}{if}(context->settings.keepAlive != 0)
173       \{
174          \textcolor{comment}{//Get current time}
175          time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
176 
177          \textcolor{comment}{//Convert the keep-alive value to milliseconds}
178          keepAlive = context->settings.keepAlive * 1000;
179 
180          \textcolor{comment}{//It is the responsibility of the client to ensure that the interval}
181          \textcolor{comment}{//between control packets being sent does not exceed the keep-alive value}
182          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->keepAliveTimestamp + keepAlive) >= 0)
183          \{
184             \textcolor{comment}{//Format PINGREQ packet}
185             error = \hyperlink{mqtt__client__packet_8c_a59b464bad1251d6a85127beb462e0e73}{mqttClientFormatPingReq}(context);
186 
187             \textcolor{comment}{//Check status code}
188             \textcolor{keywordflow}{if}(!error)
189             \{
190                \textcolor{comment}{//Debug message}
191                \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"MQTT: Sending PINGREQ packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      context->packetLen);
192                \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->packet, context->packetLen);
193 
194                \textcolor{comment}{//Point to the beginning of the packet}
195                context->packetPos = 0;
196 
197                \textcolor{comment}{//Send PINGREQ packet}
198                \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00adf1e9ea5fb931a6b0fac4c40b39064ce}{MQTT\_CLIENT\_STATE\_SENDING\_PACKET});
199             \}
200          \}
201       \}
202    \}
203 
204    \textcolor{comment}{//Return status code}
205    \textcolor{keywordflow}{return} error;
206 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_aefad7cd8e496ef1d9e60b56178a40699}\label{mqtt__client__misc_8c_aefad7cd8e496ef1d9e60b56178a40699}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Client\+Process\+Events@{mqtt\+Client\+Process\+Events}}
\index{mqtt\+Client\+Process\+Events@{mqtt\+Client\+Process\+Events}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Client\+Process\+Events()}{mqttClientProcessEvents()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Client\+Process\+Events (\begin{DoxyParamCaption}\item[{\hyperlink{mqtt__client_8h_ac90ac46c748d19a3d358acc142237f2e}{Mqtt\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{timeout }\end{DoxyParamCaption})}



Process M\+Q\+TT client events. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the M\+Q\+TT client context \\
\hline
\mbox{\tt in}  & {\em timeout} & Maximum time to wait before returning \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 66 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
67 \{
68    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
69    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
70 
71    \textcolor{comment}{//It is the responsibility of the client to ensure that the interval}
72    \textcolor{comment}{//between control packets being sent does not exceed the keep-alive value}
73    error = \hyperlink{mqtt__client__misc_8c_af8e0a56ac0332d8051c50fc2a55cf118}{mqttClientCheckKeepAlive}(context);
74 
75    \textcolor{comment}{//Check status code}
76    \textcolor{keywordflow}{if}(!error)
77    \{
78       \textcolor{comment}{//Check current state}
79       \textcolor{keywordflow}{if}(context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00aad8e4a28cbf24a479a4b5dd05cbb64d6}{MQTT\_CLIENT\_STATE\_IDLE} ||
80          context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00ac50e87d5b3d709d78a627a69c29dc3da}{MQTT\_CLIENT\_STATE\_PACKET\_SENT})
81       \{
82          \textcolor{comment}{//Wait for incoming data}
83          error = \hyperlink{mqtt__client__transport_8c_aac52321d3f941565861a56f33c95f226}{mqttClientWaitForData}(context, timeout);
84 
85          \textcolor{comment}{//Check status code}
86          \textcolor{keywordflow}{if}(!error)
87          \{
88             \textcolor{comment}{//Initialize context}
89             context->packet = context->buffer;
90             context->packetPos = 0;
91             context->packetLen = 0;
92             context->remainingLen = 0;
93 
94             \textcolor{comment}{//Start receiving the packet}
95             \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00a95900b52f31e176a1b8fd8ca6c178c7e}{MQTT\_CLIENT\_STATE\_RECEIVING\_PACKET});
96          \}
97       \}
98       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00a95900b52f31e176a1b8fd8ca6c178c7e}{MQTT\_CLIENT\_STATE\_RECEIVING\_PACKET})
99       \{
100          \textcolor{comment}{//Receive the incoming packet}
101          error = \hyperlink{mqtt__client__packet_8c_af4078e92d28f721d3bcbab8ab50eef61}{mqttClientReceivePacket}(context);
102 
103          \textcolor{comment}{//Check status code}
104          \textcolor{keywordflow}{if}(!error)
105          \{
106             \textcolor{comment}{//Process MQTT control packet}
107             error = \hyperlink{mqtt__client__packet_8c_a5d0906bb4b0c38feb6aa4b0ba80387e5}{mqttClientProcessPacket}(context);
108 
109             \textcolor{comment}{//Update MQTT client state}
110             \textcolor{keywordflow}{if}(context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00a95900b52f31e176a1b8fd8ca6c178c7e}{MQTT\_CLIENT\_STATE\_RECEIVING\_PACKET})
111             \{
112                \textcolor{keywordflow}{if}(context->packetType == \hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796a99027cf1e61a75bf1cd8f00fcb748d0e}{MQTT\_PACKET\_TYPE\_INVALID})
113                   \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00aad8e4a28cbf24a479a4b5dd05cbb64d6}{MQTT\_CLIENT\_STATE\_IDLE});
114                \textcolor{keywordflow}{else}
115                   \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00ac50e87d5b3d709d78a627a69c29dc3da}{MQTT\_CLIENT\_STATE\_PACKET\_SENT});
116             \}
117          \}
118       \}
119       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00adf1e9ea5fb931a6b0fac4c40b39064ce}{MQTT\_CLIENT\_STATE\_SENDING\_PACKET})
120       \{
121          \textcolor{comment}{//Any remaining data to be sent?}
122          \textcolor{keywordflow}{if}(context->packetPos < context->packetLen)
123          \{
124             \textcolor{comment}{//Send more data}
125             error = \hyperlink{mqtt__client__transport_8c_a9a6d5926aa48cea90da4b9451e863a37}{mqttClientSendData}(context, context->packet + context->packetPos,
126                context->packetLen - context->packetPos, &n, 0);
127 
128             \textcolor{comment}{//Advance data pointer}
129             context->packetPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
130          \}
131          \textcolor{keywordflow}{else}
132          \{
133             \textcolor{comment}{//Save the time at which the message was sent}
134             context->keepAliveTimestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
135 
136             \textcolor{comment}{//Update MQTT client state}
137             \textcolor{keywordflow}{if}(context->packetType == \hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796a99027cf1e61a75bf1cd8f00fcb748d0e}{MQTT\_PACKET\_TYPE\_INVALID})
138                \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00aad8e4a28cbf24a479a4b5dd05cbb64d6}{MQTT\_CLIENT\_STATE\_IDLE});
139             \textcolor{keywordflow}{else}
140                \hyperlink{mqtt__client__misc_8c_af0194dc61b64f3b8990bcf0e412c932d}{mqttClientChangeState}(context, 
      \hyperlink{mqtt__client_8h_a4962cf68fc8b67cdc2fdd8d5be59ff00ac50e87d5b3d709d78a627a69c29dc3da}{MQTT\_CLIENT\_STATE\_PACKET\_SENT});
141          \}
142       \}
143    \}
144 
145    \textcolor{comment}{//Return status code}
146    \textcolor{keywordflow}{return} error;
147 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_a65ea81722d769423b6bb3d74a5a7c984}\label{mqtt__client__misc_8c_a65ea81722d769423b6bb3d74a5a7c984}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Deserialize\+Byte@{mqtt\+Deserialize\+Byte}}
\index{mqtt\+Deserialize\+Byte@{mqtt\+Deserialize\+Byte}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Deserialize\+Byte()}{mqttDeserializeByte()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Deserialize\+Byte (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Read a 8-\/bit integer from the input buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the input buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Length of the input buffer \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt out}  & {\em value} & Value of the 8-\/bit integer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 507 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
509 \{
510    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
511 
512    \textcolor{comment}{//Point to the current position}
513    n = *pos;
514 
515    \textcolor{comment}{//Make sure the input buffer is large enough}
516    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t})) > bufferLen)
517       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
518 
519    \textcolor{comment}{//Read the short integer from the input buffer}
520    *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} = buffer[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}];
521 
522    \textcolor{comment}{//Advance current position}
523    *pos = n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t});
524 
525    \textcolor{comment}{//Successful processing}
526    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
527 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_a3588be0ed9b0709cfbaa0956cb006c5c}\label{mqtt__client__misc_8c_a3588be0ed9b0709cfbaa0956cb006c5c}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Deserialize\+Header@{mqtt\+Deserialize\+Header}}
\index{mqtt\+Deserialize\+Header@{mqtt\+Deserialize\+Header}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Deserialize\+Header()}{mqttDeserializeHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Deserialize\+Header (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796}{Mqtt\+Packet\+Type} $\ast$}]{type,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$}]{dup,  }\item[{\hyperlink{mqtt__common_8h_a79ec1e304b7f2ed51b12f489f642f0bb}{Mqtt\+Qos\+Level} $\ast$}]{qos,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$}]{retain,  }\item[{size\+\_\+t $\ast$}]{remaining\+Len }\end{DoxyParamCaption})}



Deserialize fixed header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the input buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Length of the input buffer \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt out}  & {\em type} & M\+Q\+TT control packet type \\
\hline
\mbox{\tt out}  & {\em dup} & D\+UP flag from the fixed header \\
\hline
\mbox{\tt out}  & {\em qos} & QoS field from the fixed header \\
\hline
\mbox{\tt out}  & {\em retain} & R\+E\+T\+A\+IN flag from the fixed header \\
\hline
\mbox{\tt out}  & {\em remaining\+Len} & Length of the variable header and the payload \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 429 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
431 \{
432    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
433    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
434    \hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader} *header;
435 
436    \textcolor{comment}{//Point to the current position}
437    n = *pos;
438 
439    \textcolor{comment}{//Make sure the input buffer is large enough}
440    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader})) > bufferLen)
441       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
442 
443    \textcolor{comment}{//Point to the MQTT packet header}
444    header = (\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader} *) (buffer + n);
445 
446    \textcolor{comment}{//Save MQTT control packet type}
447    *\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} = (\hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796}{MqttPacketType}) header->type;
448 
449    \textcolor{comment}{//Save flags}
450    *\hyperlink{mqtt__common_8h_a4e198deb57c49dad652a61d21ad478e6}{dup} = header->dup;
451    *\hyperlink{mqtt__common_8h_a65ee2b4b16f25052c441ff9959dcc7e7}{qos} = (\hyperlink{mqtt__common_8h_a79ec1e304b7f2ed51b12f489f642f0bb}{MqttQosLevel}) header->qos;
452    *\hyperlink{mqtt__common_8h_ae25d47ab22bd975ad97012eddb6bbfce}{retain} = header->retain;
453 
454    \textcolor{comment}{//Advance current position}
455    n += \textcolor{keyword}{sizeof}(\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader});
456 
457    \textcolor{comment}{//Prepare to decode the Remaining Length field}
458    *remainingLen = 0;
459 
460    \textcolor{comment}{//The Remaining Length is encoded using a variable length encoding scheme}
461    \textcolor{keywordflow}{for}(i = 0; i < 4; i++)
462    \{
463       \textcolor{comment}{//Sanity check}
464       \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t})) > bufferLen)
465          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
466 
467       \textcolor{comment}{//Advance current position}
468       n += \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t});
469 
470       \textcolor{comment}{//The most significant bit is used to indicate that there are}
471       \textcolor{comment}{//following bytes in the representation}
472       \textcolor{keywordflow}{if}(header->length[i] & 0x80)
473       \{
474          \textcolor{comment}{//Applications can send control packets of size up to 256 MB}
475          \textcolor{keywordflow}{if}(i == 3)
476             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
477 
478          \textcolor{comment}{//The least significant seven bits of each byte encode the data}
479          *remainingLen |= (header->length[i] & 0x7F) << (7 * i);
480       \}
481       \textcolor{keywordflow}{else}
482       \{
483          \textcolor{comment}{//The least significant seven bits of each byte encode the data}
484          *remainingLen |= header->length[i] << (7 * i);
485          \textcolor{comment}{//This is the last byte}
486          \textcolor{keywordflow}{break};
487       \}
488    \}
489 
490    \textcolor{comment}{//Return the current position}
491    *pos = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
492 
493    \textcolor{comment}{//Successful processing}
494    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
495 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_aad98e4b63b2676bc9b0db9b093c50792}\label{mqtt__client__misc_8c_aad98e4b63b2676bc9b0db9b093c50792}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Deserialize\+Short@{mqtt\+Deserialize\+Short}}
\index{mqtt\+Deserialize\+Short@{mqtt\+Deserialize\+Short}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Deserialize\+Short()}{mqttDeserializeShort()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Deserialize\+Short (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Read a 16-\/bit integer from the input buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the input buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Length of the input buffer \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt out}  & {\em value} & Value of the 16-\/bit integer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 539 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
541 \{
542    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
543 
544    \textcolor{comment}{//Point to the current position}
545    n = *pos;
546 
547    \textcolor{comment}{//Make sure the input buffer is large enough}
548    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t})) > bufferLen)
549       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
550 
551    \textcolor{comment}{//Read the short integer from the input buffer}
552    *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} = (buffer[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] << 8) | buffer[n + 1];
553 
554    \textcolor{comment}{//Advance current position}
555    *pos = n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t});
556 
557    \textcolor{comment}{//Successful processing}
558    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
559 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_ac49cf0f6db605fc125fada9b529c4dc4}\label{mqtt__client__misc_8c_ac49cf0f6db605fc125fada9b529c4dc4}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Deserialize\+String@{mqtt\+Deserialize\+String}}
\index{mqtt\+Deserialize\+String@{mqtt\+Deserialize\+String}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Deserialize\+String()}{mqttDeserializeString()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Deserialize\+String (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$$\ast$}]{string,  }\item[{size\+\_\+t $\ast$}]{string\+Len }\end{DoxyParamCaption})}



Deserialize string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the input buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Length of the input buffer \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt out}  & {\em string} & Pointer to the string \\
\hline
\mbox{\tt out}  & {\em string\+Len} & Length of the string, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 572 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
574 \{
575    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
576 
577    \textcolor{comment}{//Point to the current position}
578    n = *pos;
579 
580    \textcolor{comment}{//Make sure the input buffer is large enough}
581    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t})) > bufferLen)
582       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
583 
584    \textcolor{comment}{//Decode the length field}
585    *stringLen = (buffer[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] << 8) | buffer[n + 1];
586 
587    \textcolor{comment}{//Make sure the input buffer is large enough}
588    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}) + *stringLen) > bufferLen)
589       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
590 
591    \textcolor{comment}{//Read the string from the input buffer}
592    *\textcolor{keywordtype}{string} = (\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *) buffer + n + 2;
593 
594    \textcolor{comment}{//Advance current position}
595    *pos = n + 2 + *stringLen;
596 
597    \textcolor{comment}{//Successful processing}
598    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
599 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_ad20ce540ff897e5aa78a58820bd60f6d}\label{mqtt__client__misc_8c_ad20ce540ff897e5aa78a58820bd60f6d}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Serialize\+Byte@{mqtt\+Serialize\+Byte}}
\index{mqtt\+Serialize\+Byte@{mqtt\+Serialize\+Byte}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Serialize\+Byte()}{mqttSerializeByte()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Serialize\+Byte (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{value }\end{DoxyParamCaption})}



Write a 8-\/bit integer to the output buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the output buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Maximum number of bytes the output buffer can hold \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt in}  & {\em value} & 8-\/bit integer to be serialized \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 290 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
292 \{
293    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
294 
295    \textcolor{comment}{//Point to the current position}
296    n = *pos;
297 
298    \textcolor{comment}{//Make sure the output buffer is large enough}
299    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t})) > bufferLen)
300       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
301 
302    \textcolor{comment}{//Write the byte to the output buffer}
303    buffer[n++] = \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
304 
305    \textcolor{comment}{//Advance current position}
306    *pos = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
307 
308    \textcolor{comment}{//Successful processing}
309    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
310 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_a6c69ea12b178140e3323e9711ec8728a}\label{mqtt__client__misc_8c_a6c69ea12b178140e3323e9711ec8728a}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Serialize\+Data@{mqtt\+Serialize\+Data}}
\index{mqtt\+Serialize\+Data@{mqtt\+Serialize\+Data}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Serialize\+Data()}{mqttSerializeData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Serialize\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{data\+Len }\end{DoxyParamCaption})}



Serialize raw data. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the output buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Maximum number of bytes the output buffer can hold \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to the raw data to be serialized \\
\hline
\mbox{\tt in}  & {\em data\+Len} & Length of the raw data, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 393 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
395 \{
396    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
397 
398    \textcolor{comment}{//Point to the current position}
399    n = *pos;
400 
401    \textcolor{comment}{//Make sure the output buffer is large enough to hold the data}
402    \textcolor{keywordflow}{if}((n + dataLen) > bufferLen)
403       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
404 
405    \textcolor{comment}{//Write the data to the output buffer}
406    memcpy(buffer + n, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, dataLen);
407 
408    \textcolor{comment}{//Advance current position}
409    *pos = n + dataLen;
410 
411    \textcolor{comment}{//Successful processing}
412    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
413 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_aaf7ce18e001d1e585d3d82ae35951eaa}\label{mqtt__client__misc_8c_aaf7ce18e001d1e585d3d82ae35951eaa}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Serialize\+Header@{mqtt\+Serialize\+Header}}
\index{mqtt\+Serialize\+Header@{mqtt\+Serialize\+Header}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Serialize\+Header()}{mqttSerializeHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Serialize\+Header (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{mqtt__common_8h_af26b642b7ef813ac269f70aa245cc796}{Mqtt\+Packet\+Type}}]{type,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{dup,  }\item[{\hyperlink{mqtt__common_8h_a79ec1e304b7f2ed51b12f489f642f0bb}{Mqtt\+Qos\+Level}}]{qos,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{retain,  }\item[{size\+\_\+t}]{remaining\+Len }\end{DoxyParamCaption})}



Serialize fixed header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the output buffer \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt in}  & {\em type} & M\+Q\+TT control packet type \\
\hline
\mbox{\tt in}  & {\em dup} & D\+UP flag \\
\hline
\mbox{\tt in}  & {\em qos} & QoS field \\
\hline
\mbox{\tt in}  & {\em retain} & R\+E\+T\+A\+IN flag \\
\hline
\mbox{\tt in}  & {\em remaining\+Len} & Length of the variable header and the payload \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 221 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
223 \{
224    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
225    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
226    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
227    \hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader} *header;
228 
229    \textcolor{comment}{//Point to the current position}
230    n = *pos;
231 
232    \textcolor{comment}{//The Remaining Length is encoded using a variable length encoding scheme}
233    \textcolor{keywordflow}{if}(remainingLen < 128)
234       k = 1;
235    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(remainingLen < 16384)
236       k = 2;
237    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(remainingLen < 2097152)
238       k = 3;
239    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(remainingLen < 268435456)
240       k = 4;
241    \textcolor{keywordflow}{else}
242       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
243 
244    \textcolor{comment}{//Sanity check}
245    \textcolor{keywordflow}{if}(n < (\textcolor{keyword}{sizeof}(\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader}) + k))
246       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
247 
248    \textcolor{comment}{//Position where to format the header}
249    n -= \textcolor{keyword}{sizeof}(\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader}) + k;
250 
251    \textcolor{comment}{//Point to the MQTT packet header}
252    header = (\hyperlink{mqtt__common_8h_a57b4588d847159699b68059800e88236}{MqttPacketHeader} *) (buffer + n);
253 
254    \textcolor{comment}{//Encode the first byte of the header}
255    header->type = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
256    header->dup = \hyperlink{mqtt__common_8h_a4e198deb57c49dad652a61d21ad478e6}{dup};
257    header->qos = \hyperlink{mqtt__common_8h_a65ee2b4b16f25052c441ff9959dcc7e7}{qos};
258    header->retain = \hyperlink{mqtt__common_8h_ae25d47ab22bd975ad97012eddb6bbfce}{retain};
259 
260    \textcolor{comment}{//Encode the Remaining Length field}
261    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}; i++)
262    \{
263       \textcolor{comment}{//The least significant seven bits of each byte encode the data}
264       header->length[i] = remainingLen & 0xFF;
265       remainingLen >>= 7;
266 
267       \textcolor{comment}{//The most significant bit is used to indicate that there are}
268       \textcolor{comment}{//following bytes in the representation}
269       \textcolor{keywordflow}{if}(remainingLen > 0)
270          header->length[i] |= 0x80;
271    \}
272 
273    \textcolor{comment}{//Update current position}
274    *pos = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
275 
276    \textcolor{comment}{//Successful processing}
277    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
278 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_abfb1aa77533be466e3082ae817ccdde6}\label{mqtt__client__misc_8c_abfb1aa77533be466e3082ae817ccdde6}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Serialize\+Short@{mqtt\+Serialize\+Short}}
\index{mqtt\+Serialize\+Short@{mqtt\+Serialize\+Short}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Serialize\+Short()}{mqttSerializeShort()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Serialize\+Short (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{value }\end{DoxyParamCaption})}



Write a 16-\/bit integer to the output buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the output buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Maximum number of bytes the output buffer can hold \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt in}  & {\em value} & 16-\/bit integer to be serialized \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 322 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
324 \{
325    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
326 
327    \textcolor{comment}{//Point to the current position}
328    n = *pos;
329 
330    \textcolor{comment}{//Make sure the output buffer is large enough}
331    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t})) > bufferLen)
332       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
333 
334    \textcolor{comment}{//Write the short integer to the output buffer}
335    buffer[n++] = \hyperlink{os__port_8h_aeb61a4e8fff2f4624a632a3189cbd3a0}{MSB}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value});
336    buffer[n++] = \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value});
337 
338    \textcolor{comment}{//Advance current position}
339    *pos = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
340 
341    \textcolor{comment}{//Successful processing}
342    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
343 \}
\end{DoxyCode}
\mbox{\Hypertarget{mqtt__client__misc_8c_a7cdabc6df81fb790ef977d811bf6c8a6}\label{mqtt__client__misc_8c_a7cdabc6df81fb790ef977d811bf6c8a6}} 
\index{mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}!mqtt\+Serialize\+String@{mqtt\+Serialize\+String}}
\index{mqtt\+Serialize\+String@{mqtt\+Serialize\+String}!mqtt\+\_\+client\+\_\+misc.\+c@{mqtt\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{mqtt\+Serialize\+String()}{mqttSerializeString()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mqtt\+Serialize\+String (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{buffer\+Len,  }\item[{size\+\_\+t $\ast$}]{pos,  }\item[{const void $\ast$}]{string,  }\item[{size\+\_\+t}]{string\+Len }\end{DoxyParamCaption})}



Serialize string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the output buffer \\
\hline
\mbox{\tt in}  & {\em buffer\+Len} & Maximum number of bytes the output buffer can hold \\
\hline
\mbox{\tt in,out}  & {\em pos} & Current position \\
\hline
\mbox{\tt in}  & {\em string} & Pointer to the string to be serialized \\
\hline
\mbox{\tt in}  & {\em string\+Len} & Length of the string, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 356 of file mqtt\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
358 \{
359    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
360 
361    \textcolor{comment}{//Point to the current position}
362    n = *pos;
363 
364    \textcolor{comment}{//Make sure the output buffer is large enough to hold the string}
365    \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}) + stringLen) > bufferLen)
366       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
367 
368    \textcolor{comment}{//Encode the length field}
369    buffer[n++] = \hyperlink{os__port_8h_aeb61a4e8fff2f4624a632a3189cbd3a0}{MSB}(stringLen);
370    buffer[n++] = \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(stringLen);
371 
372    \textcolor{comment}{//Write the string to the output buffer}
373    memcpy(buffer + n, \textcolor{keywordtype}{string}, stringLen);
374 
375    \textcolor{comment}{//Advance current position}
376    *pos = n + stringLen;
377 
378    \textcolor{comment}{//Successful processing}
379    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
380 \}
\end{DoxyCode}
