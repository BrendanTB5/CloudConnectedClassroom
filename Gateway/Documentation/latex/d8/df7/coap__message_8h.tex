\hypertarget{coap__message_8h}{}\section{cyclone\+\_\+tcp/coap/coap\+\_\+message.h File Reference}
\label{coap__message_8h}\index{cyclone\+\_\+tcp/coap/coap\+\_\+message.\+h@{cyclone\+\_\+tcp/coap/coap\+\_\+message.\+h}}


Co\+AP message formatting and parsing.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+common.\+h\char`\"{}}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structCoapMessage}{Coap\+Message}
\begin{DoxyCompactList}\small\item\em Co\+AP message. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{coap__message_8h_a335f86dbb26e7c7c80679116ec6bb120}{C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE}~1024
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_af457aa2f3d1dc448a5a1718798ad9c23}{coap\+Parse\+Message} (const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message})
\begin{DoxyCompactList}\small\item\em Parse Co\+AP message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a2cc8b59729ae7fe5e0953dd1febc7f50}{coap\+Parse\+Message\+Header} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$consumed)
\begin{DoxyCompactList}\small\item\em Parse Co\+AP message header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_ac2aab3240be6d0cc2fe30d64ebcda9b3}{coap\+Set\+Type} (\hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669}{Coap\+Message\+Type} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Set message type. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a34da87b247ccd418e34f4564878ff17a}{coap\+Get\+Type} (const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669}{Coap\+Message\+Type} $\ast$\hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Get message type. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a92da8b5a44409340899d20eacba8482b}{coap\+Set\+Code} (\hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680e}{Coap\+Code} \hyperlink{ppp_8h_a966576744a473fafb7687f8e5649941f}{code})
\begin{DoxyCompactList}\small\item\em Set method or response code. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a51d7701608ddded3c2752c8fae1a6b07}{coap\+Get\+Code} (const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680e}{Coap\+Code} $\ast$\hyperlink{ppp_8h_a966576744a473fafb7687f8e5649941f}{code})
\begin{DoxyCompactList}\small\item\em Get method or response code. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_aa7c5a267b8c94edff87658d57e26014d}{coap\+Set\+Payload} (\hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, const void $\ast$payload, size\+\_\+t \hyperlink{web__socket_8h_ae4d38aba40b6dddf544612da0726cd7e}{payload\+Len})
\begin{DoxyCompactList}\small\item\em Set Co\+AP message payload. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_ad661d9c8e3a17902314fd75bc37f60b2}{coap\+Get\+Payload} (const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$payload, size\+\_\+t $\ast$\hyperlink{web__socket_8h_ae4d38aba40b6dddf544612da0726cd7e}{payload\+Len})
\begin{DoxyCompactList}\small\item\em Get Co\+AP message payload. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a690ac21f1db37ed8962766bf4555bd7c}{coap\+Write\+Payload} (\hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Write payload data. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__message_8h_a24aa797c63cb8b2add62f9a1cde7c98d}{coap\+Read\+Payload} (\hyperlink{structCoapMessage}{Coap\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Read payload data. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{coap__message_8h_a15da8ea4ced6ce70e3f398a640cc34b5}{coap\+Compare\+Token} (const \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$header1, const \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$header2)
\begin{DoxyCompactList}\small\item\em Token comparison. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Co\+AP message formatting and parsing. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{coap__message_8h_a335f86dbb26e7c7c80679116ec6bb120}\label{coap__message_8h_a335f86dbb26e7c7c80679116ec6bb120}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE@{C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE}}
\index{C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE@{C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE}{COAP\_MAX\_MSG\_SIZE}}
{\footnotesize\ttfamily \#define C\+O\+A\+P\+\_\+\+M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+S\+I\+ZE~1024}



Definition at line 40 of file coap\+\_\+message.\+h.



\subsection{Function Documentation}
\mbox{\Hypertarget{coap__message_8h_a15da8ea4ced6ce70e3f398a640cc34b5}\label{coap__message_8h_a15da8ea4ced6ce70e3f398a640cc34b5}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Compare\+Token@{coap\+Compare\+Token}}
\index{coap\+Compare\+Token@{coap\+Compare\+Token}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Compare\+Token()}{coapCompareToken()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} coap\+Compare\+Token (\begin{DoxyParamCaption}\item[{const \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$}]{header1,  }\item[{const \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$}]{header2 }\end{DoxyParamCaption})}



Token comparison. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em header1} & Pointer to the first Co\+AP message header \\
\hline
\mbox{\tt in}  & {\em header2} & Pointer to the second Co\+AP message header \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the tokens match, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 547 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
549 \{
550    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
551 
552    \textcolor{comment}{//Check token lengths}
553    \textcolor{keywordflow}{if}(header1->tokenLen == header2->tokenLen)
554    \{
555       \textcolor{comment}{//Compare tokens}
556       \textcolor{keywordflow}{if}(!memcmp(header1->token, header2->token, header1->tokenLen))
557       \{
558          \textcolor{comment}{//The tokens match}
559          res = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
560       \}
561    \}
562 
563    \textcolor{comment}{//Return comparison result}
564    \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
565 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a51d7701608ddded3c2752c8fae1a6b07}\label{coap__message_8h_a51d7701608ddded3c2752c8fae1a6b07}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Get\+Code@{coap\+Get\+Code}}
\index{coap\+Get\+Code@{coap\+Get\+Code}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Get\+Code()}{coapGetCode()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Get\+Code (\begin{DoxyParamCaption}\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{\hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680e}{Coap\+Code} $\ast$}]{code }\end{DoxyParamCaption})}



Get method or response code. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt out}  & {\em code} & Method or response code \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 226 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
227 \{
228    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
229 
230    \textcolor{comment}{//Malformed CoAP message?}
231    \textcolor{keywordflow}{if}(message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} < \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}))
232       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
233 
234    \textcolor{comment}{//Point to the CoAP message header}
235    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
236    \textcolor{comment}{//Retrieve method or response code}
237    *\hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code} = (\hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680e}{CoapCode}) header->code;
238 
239    \textcolor{comment}{//Successful processing}
240    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
241 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_ad661d9c8e3a17902314fd75bc37f60b2}\label{coap__message_8h_ad661d9c8e3a17902314fd75bc37f60b2}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Get\+Payload@{coap\+Get\+Payload}}
\index{coap\+Get\+Payload@{coap\+Get\+Payload}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Get\+Payload()}{coapGetPayload()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Get\+Payload (\begin{DoxyParamCaption}\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$}]{payload,  }\item[{size\+\_\+t $\ast$}]{payload\+Len }\end{DoxyParamCaption})}



Get Co\+AP message payload. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt out}  & {\em payload} & Pointer to the first byte of the payload \\
\hline
\mbox{\tt out}  & {\em payload\+Len} & Length of the payload, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 324 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
326 \{
327    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
328    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
329    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
330    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
331 
332    \textcolor{comment}{//Point to the first byte of the CoAP message}
333    p = message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
334    \textcolor{comment}{//Retrieve the length of the message}
335    length = message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length};
336 
337    \textcolor{comment}{//Parse message header}
338    error = \hyperlink{coap__message_8c_a2cc8b59729ae7fe5e0953dd1febc7f50}{coapParseMessageHeader}(p, length, &n);
339    \textcolor{comment}{//Any error to report?}
340    \textcolor{keywordflow}{if}(error)
341       \textcolor{keywordflow}{return} error;
342 
343    \textcolor{comment}{//Point to the first option of the message}
344    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
345    \textcolor{comment}{//Number of bytes left to process}
346    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
347 
348    \textcolor{comment}{//Parse the list of options}
349    error = \hyperlink{coap__option_8c_a2c821303d697ba7fb5ae13fe449ee1a2}{coapParseOptions}(p, length, &n);
350    \textcolor{comment}{//Any error to report?}
351    \textcolor{keywordflow}{if}(error)
352       \textcolor{keywordflow}{return} error;
353 
354    \textcolor{comment}{//Point to the payload}
355    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
356    \textcolor{comment}{//Number of bytes left to process}
357    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
358 
359    \textcolor{comment}{//The payload is optional}
360    \textcolor{keywordflow}{if}(length > 0)
361    \{
362       \textcolor{comment}{//The payload is prefixed by a fixed, one-byte payload marker}
363       p++;
364       \textcolor{comment}{//Retrieve the length of the payload}
365       length--;
366    \}
367 
368    \textcolor{comment}{//Point to the first byte of the payload, if any}
369    *payload = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
370    \textcolor{comment}{//Save the length of the payload}
371    *\hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
372 
373    \textcolor{comment}{//Successful processing}
374    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
375 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a34da87b247ccd418e34f4564878ff17a}\label{coap__message_8h_a34da87b247ccd418e34f4564878ff17a}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Get\+Type@{coap\+Get\+Type}}
\index{coap\+Get\+Type@{coap\+Get\+Type}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Get\+Type()}{coapGetType()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Get\+Type (\begin{DoxyParamCaption}\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{\hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669}{Coap\+Message\+Type} $\ast$}]{type }\end{DoxyParamCaption})}



Get message type. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt out}  & {\em type} & Message type \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 176 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
177 \{
178    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
179 
180    \textcolor{comment}{//Malformed CoAP message?}
181    \textcolor{keywordflow}{if}(message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} < \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}))
182       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
183 
184    \textcolor{comment}{//Point to the CoAP message header}
185    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
186    \textcolor{comment}{//Retrieve message type}
187    *\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} = (\hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669}{CoapMessageType}) header->type;
188 
189    \textcolor{comment}{//Successful processing}
190    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
191 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_af457aa2f3d1dc448a5a1718798ad9c23}\label{coap__message_8h_af457aa2f3d1dc448a5a1718798ad9c23}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Parse\+Message@{coap\+Parse\+Message}}
\index{coap\+Parse\+Message@{coap\+Parse\+Message}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Parse\+Message()}{coapParseMessage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Parse\+Message (\begin{DoxyParamCaption}\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message }\end{DoxyParamCaption})}



Parse Co\+AP message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 51 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
52 \{
53    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
54    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
55    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
56    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
57 
58    \textcolor{comment}{//Point to the first byte of the CoAP message}
59    p = message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
60    \textcolor{comment}{//Retrieve the length of the message}
61    length = message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length};
62 
63    \textcolor{comment}{//Parse message header}
64    error = \hyperlink{coap__message_8c_a2cc8b59729ae7fe5e0953dd1febc7f50}{coapParseMessageHeader}(p, length, &n);
65    \textcolor{comment}{//Any error to report?}
66    \textcolor{keywordflow}{if}(error)
67       \textcolor{keywordflow}{return} error;
68 
69    \textcolor{comment}{//Point to the first option of the message}
70    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
71    \textcolor{comment}{//Number of bytes left to process}
72    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
73 
74    \textcolor{comment}{//Parse the list of options}
75    error = \hyperlink{coap__option_8c_a2c821303d697ba7fb5ae13fe449ee1a2}{coapParseOptions}(p, length, &n);
76    \textcolor{comment}{//Any error to report?}
77    \textcolor{keywordflow}{if}(error)
78       \textcolor{keywordflow}{return} error;
79 
80    \textcolor{comment}{//Point to the payload}
81    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
82    \textcolor{comment}{//Number of bytes left to process}
83    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
84 
85    \textcolor{comment}{//The payload is optional}
86    \textcolor{keywordflow}{if}(length > 0)
87    \{
88       \textcolor{comment}{//The payload is prefixed by a fixed, one-byte payload marker}
89       p++;
90       \textcolor{comment}{//Retrieve the length of the payload}
91       length--;
92 
93       \textcolor{comment}{//The presence of a marker followed by a zero-length payload must be}
94       \textcolor{comment}{//processed as a message format error}
95       \textcolor{keywordflow}{if}(length == 0)
96          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
97    \}
98 
99    \textcolor{comment}{//Successful processing}
100    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
101 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a2cc8b59729ae7fe5e0953dd1febc7f50}\label{coap__message_8h_a2cc8b59729ae7fe5e0953dd1febc7f50}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Parse\+Message\+Header@{coap\+Parse\+Message\+Header}}
\index{coap\+Parse\+Message\+Header@{coap\+Parse\+Message\+Header}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Parse\+Message\+Header()}{coapParseMessageHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Parse\+Message\+Header (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{consumed }\end{DoxyParamCaption})}



Parse Co\+AP message header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em p} & Input stream where to read the Co\+AP message header \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em consumed} & Total number of bytes that have been consumed \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 112 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
114 \{
115    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
116 
117    \textcolor{comment}{//Malformed CoAP message?}
118    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}))
119       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
120 
121    \textcolor{comment}{//Point to the CoAP message header}
122    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
123 
124    \textcolor{comment}{//Check version field}
125    \textcolor{keywordflow}{if}(header->version != \hyperlink{coap__common_8h_a233dfcd021c7432eb74ee4c4245b2a1ba1b13f265da5288b4b1e92cb8d196562f}{COAP\_VERSION\_1})
126       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
127 
128    \textcolor{comment}{//The length of the Token field must 0-8 bytes}
129    \textcolor{keywordflow}{if}(header->tokenLen > \hyperlink{coap__common_8h_af8d60904caba59c879459011aa84e7ab}{COAP\_MAX\_TOKEN\_LEN})
130       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
131 
132    \textcolor{comment}{//Malformed CoAP message?}
133    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}) + header->tokenLen))
134       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
135 
136    \textcolor{comment}{//Total number of bytes that have been consumed}
137    *consumed = \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}) + header->tokenLen;
138 
139    \textcolor{comment}{//Successful processing}
140    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
141 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a24aa797c63cb8b2add62f9a1cde7c98d}\label{coap__message_8h_a24aa797c63cb8b2add62f9a1cde7c98d}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Read\+Payload@{coap\+Read\+Payload}}
\index{coap\+Read\+Payload@{coap\+Read\+Payload}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Read\+Payload()}{coapReadPayload()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Read\+Payload (\begin{DoxyParamCaption}\item[{\hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Read payload data. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em length} & Number of bytes that have been received \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 468 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
470 \{
471    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
472    \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
473    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
474    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
475 
476    \textcolor{comment}{//Point to the first byte of the CoAP message}
477    p = message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
478    \textcolor{comment}{//Retrieve the length of the message}
479    n = message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length};
480 
481    \textcolor{comment}{//Parse message header}
482    error = \hyperlink{coap__message_8c_a2cc8b59729ae7fe5e0953dd1febc7f50}{coapParseMessageHeader}(p, n, &k);
483    \textcolor{comment}{//Any error to report?}
484    \textcolor{keywordflow}{if}(error)
485       \textcolor{keywordflow}{return} error;
486 
487    \textcolor{comment}{//Point to the first option of the message}
488    p += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
489    \textcolor{comment}{//Number of bytes left to process}
490    n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
491 
492    \textcolor{comment}{//Parse the list of options}
493    error = \hyperlink{coap__option_8c_a2c821303d697ba7fb5ae13fe449ee1a2}{coapParseOptions}(p, n, &k);
494    \textcolor{comment}{//Any error to report?}
495    \textcolor{keywordflow}{if}(error)
496       \textcolor{keywordflow}{return} error;
497 
498    \textcolor{comment}{//Point to the payload}
499    p += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
500    \textcolor{comment}{//Number of bytes left to process}
501    n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
502 
503    \textcolor{comment}{//The payload is optional}
504    \textcolor{keywordflow}{if}(n > 0)
505    \{
506       \textcolor{comment}{//The payload is prefixed by a fixed, one-byte payload marker}
507       p++;
508       \textcolor{comment}{//Retrieve the length of the payload}
509       n--;
510    \}
511 
512    \textcolor{comment}{//Any data to be copied?}
513    \textcolor{keywordflow}{if}(message->\hyperlink{structCoapMessage_a8b472e6e9abab26da8f884f0eb3ce015}{pos} < n)
514    \{
515       \textcolor{comment}{//Limit the number of bytes to copy at a time}
516       n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n - message->\hyperlink{structCoapMessage_a8b472e6e9abab26da8f884f0eb3ce015}{pos}, size);
517 
518       \textcolor{comment}{//Copy data}
519       memcpy(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, p + message->\hyperlink{structCoapMessage_a8b472e6e9abab26da8f884f0eb3ce015}{pos}, n);
520 
521       \textcolor{comment}{//Advance current position}
522       message->\hyperlink{structCoapMessage_a8b472e6e9abab26da8f884f0eb3ce015}{pos} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
523        \textcolor{comment}{//Total number of data that have been read}
524       *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
525 
526       \textcolor{comment}{//Successful processing}
527       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
528    \}
529    \textcolor{keywordflow}{else}
530    \{
531       \textcolor{comment}{//No more data available}
532       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8b7223773301a4f3dd811f1d35e13ce4}{ERROR\_END\_OF\_STREAM};
533    \}
534 
535    \textcolor{comment}{//Return status code}
536    \textcolor{keywordflow}{return} error;
537 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a92da8b5a44409340899d20eacba8482b}\label{coap__message_8h_a92da8b5a44409340899d20eacba8482b}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Set\+Code@{coap\+Set\+Code}}
\index{coap\+Set\+Code@{coap\+Set\+Code}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Set\+Code()}{coapSetCode()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Set\+Code (\begin{DoxyParamCaption}\item[{\hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{\hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680e}{Coap\+Code}}]{code }\end{DoxyParamCaption})}



Set method or response code. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt in}  & {\em code} & Method or response code \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 201 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
202 \{
203    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
204 
205    \textcolor{comment}{//Malformed CoAP message?}
206    \textcolor{keywordflow}{if}(message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} < \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}))
207       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
208 
209    \textcolor{comment}{//Point to the CoAP message header}
210    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
211    \textcolor{comment}{//Set method or response code}
212    header->code = \hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code};
213 
214    \textcolor{comment}{//Successful processing}
215    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
216 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_aa7c5a267b8c94edff87658d57e26014d}\label{coap__message_8h_aa7c5a267b8c94edff87658d57e26014d}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Set\+Payload@{coap\+Set\+Payload}}
\index{coap\+Set\+Payload@{coap\+Set\+Payload}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Set\+Payload()}{coapSetPayload()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Set\+Payload (\begin{DoxyParamCaption}\item[{\hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{const void $\ast$}]{payload,  }\item[{size\+\_\+t}]{payload\+Len }\end{DoxyParamCaption})}



Set Co\+AP message payload. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt out}  & {\em payload} & Pointer to payload data \\
\hline
\mbox{\tt out}  & {\em payload\+Len} & Length of the payload, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 252 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
254 \{
255    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
256    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
257    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
258    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
259 
260    \textcolor{comment}{//Point to the first byte of the CoAP message}
261    p = message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
262    \textcolor{comment}{//Retrieve the length of the message}
263    length = message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length};
264 
265    \textcolor{comment}{//Parse message header}
266    error = \hyperlink{coap__message_8c_a2cc8b59729ae7fe5e0953dd1febc7f50}{coapParseMessageHeader}(p, length, &n);
267    \textcolor{comment}{//Any error to report?}
268    \textcolor{keywordflow}{if}(error)
269       \textcolor{keywordflow}{return} error;
270 
271    \textcolor{comment}{//Point to the first option of the message}
272    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
273    \textcolor{comment}{//Number of bytes left to process}
274    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
275 
276    \textcolor{comment}{//Parse the list of options}
277    error = \hyperlink{coap__option_8c_a2c821303d697ba7fb5ae13fe449ee1a2}{coapParseOptions}(p, length, &n);
278    \textcolor{comment}{//Any error to report?}
279    \textcolor{keywordflow}{if}(error)
280       \textcolor{keywordflow}{return} error;
281 
282    \textcolor{comment}{//Point to the payload}
283    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
284    \textcolor{comment}{//Number of bytes left to process}
285    length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
286 
287    \textcolor{comment}{//Trim the existing payload}
288    message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} -= \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
289 
290    \textcolor{comment}{//The payload is optional}
291    \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} > 0)
292    \{
293       \textcolor{comment}{//Make sure the output buffer is large enough to hold the payload}
294       \textcolor{keywordflow}{if}((message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} + \hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} + 1) > \hyperlink{coap__common_8h_a335f86dbb26e7c7c80679116ec6bb120}{COAP\_MAX\_MSG\_SIZE})
295          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
296 
297       \textcolor{comment}{//The payload is prefixed by a fixed, one-byte payload marker}
298       p[0] = \hyperlink{coap__common_8h_ab4e38910080deed0a5df4aec116d3999}{COAP\_PAYLOAD\_MARKER};
299 
300       \textcolor{comment}{//The payload data extends from after the marker to the end of the}
301       \textcolor{comment}{//UDP datagram}
302       memcpy(p + 1, payload, \hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen});
303 
304       \textcolor{comment}{//Terminate the payload with a NULL character}
305       p[\hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} + 1] = \textcolor{charliteral}{'\(\backslash\)0'};
306 
307       \textcolor{comment}{//Adjust the length of the CoAP message}
308       message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} += \hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} + 1;
309    \}
310 
311    \textcolor{comment}{//Successful processing}
312    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
313 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_ac2aab3240be6d0cc2fe30d64ebcda9b3}\label{coap__message_8h_ac2aab3240be6d0cc2fe30d64ebcda9b3}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Set\+Type@{coap\+Set\+Type}}
\index{coap\+Set\+Type@{coap\+Set\+Type}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Set\+Type()}{coapSetType()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Set\+Type (\begin{DoxyParamCaption}\item[{\hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{\hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669}{Coap\+Message\+Type}}]{type }\end{DoxyParamCaption})}



Set message type. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt in}  & {\em type} & Message type (Confirmable or Non-\/confirmable) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 151 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
152 \{
153    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
154 
155    \textcolor{comment}{//Malformed CoAP message?}
156    \textcolor{keywordflow}{if}(message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} < \textcolor{keyword}{sizeof}(\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader}))
157       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6b1c5652c82e48ada5b4348c0ebb95e6}{ERROR\_INVALID\_MESSAGE};
158 
159    \textcolor{comment}{//Point to the CoAP message header}
160    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
161    \textcolor{comment}{//Set message type}
162    header->type = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
163 
164    \textcolor{comment}{//Successful processing}
165    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
166 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__message_8h_a690ac21f1db37ed8962766bf4555bd7c}\label{coap__message_8h_a690ac21f1db37ed8962766bf4555bd7c}} 
\index{coap\+\_\+message.\+h@{coap\+\_\+message.\+h}!coap\+Write\+Payload@{coap\+Write\+Payload}}
\index{coap\+Write\+Payload@{coap\+Write\+Payload}!coap\+\_\+message.\+h@{coap\+\_\+message.\+h}}
\subsubsection{\texorpdfstring{coap\+Write\+Payload()}{coapWritePayload()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Write\+Payload (\begin{DoxyParamCaption}\item[{\hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{message,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Write payload data. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the Co\+AP message \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be written \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 386 of file coap\+\_\+message.\+c.


\begin{DoxyCode}
388 \{
389    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
390    \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
391    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
392    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
393 
394    \textcolor{comment}{//Point to the first byte of the CoAP message}
395    p = message->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
396    \textcolor{comment}{//Retrieve the length of the message}
397    n = message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length};
398 
399    \textcolor{comment}{//Parse message header}
400    error = \hyperlink{coap__message_8c_a2cc8b59729ae7fe5e0953dd1febc7f50}{coapParseMessageHeader}(p, n, &k);
401    \textcolor{comment}{//Any error to report?}
402    \textcolor{keywordflow}{if}(error)
403       \textcolor{keywordflow}{return} error;
404 
405    \textcolor{comment}{//Point to the first option of the message}
406    p += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
407    \textcolor{comment}{//Number of bytes left to process}
408    n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
409 
410    \textcolor{comment}{//Parse the list of options}
411    error = \hyperlink{coap__option_8c_a2c821303d697ba7fb5ae13fe449ee1a2}{coapParseOptions}(p, n, &k);
412    \textcolor{comment}{//Any error to report?}
413    \textcolor{keywordflow}{if}(error)
414       \textcolor{keywordflow}{return} error;
415 
416    \textcolor{comment}{//Point to the payload}
417    p += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
418    \textcolor{comment}{//Number of bytes left to process}
419    n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
420 
421    \textcolor{comment}{//Any data to write?}
422    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
423    \{
424       \textcolor{comment}{//The absence of the payload marker denotes a zero-length payload}
425       \textcolor{keywordflow}{if}(n == 0)
426       \{
427          \textcolor{comment}{//Make sure the output buffer is large enough to hold the payload}
428          \textcolor{keywordflow}{if}((message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} + 1) > \hyperlink{coap__common_8h_a335f86dbb26e7c7c80679116ec6bb120}{COAP\_MAX\_MSG\_SIZE})
429             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
430 
431          \textcolor{comment}{//The payload is prefixed by a fixed, one-byte payload marker}
432          p[n++] = \hyperlink{coap__common_8h_ab4e38910080deed0a5df4aec116d3999}{COAP\_PAYLOAD\_MARKER};
433 
434          \textcolor{comment}{//Adjust the length of the CoAP message}
435          message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length}++;
436       \}
437       \textcolor{keywordflow}{else}
438       \{
439          \textcolor{comment}{//Make sure the output buffer is large enough to hold the payload}
440          \textcolor{keywordflow}{if}((message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}) > \hyperlink{coap__common_8h_a335f86dbb26e7c7c80679116ec6bb120}{COAP\_MAX\_MSG\_SIZE})
441             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
442       \}
443 
444       \textcolor{comment}{//Copy data}
445       memcpy(p + n, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
446 
447       \textcolor{comment}{//Terminate the payload with a NULL character}
448       p[n + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}] = \textcolor{charliteral}{'\(\backslash\)0'};
449 
450       \textcolor{comment}{//Adjust the length of the CoAP message}
451       message->\hyperlink{structCoapMessage_a0b85357992e3b1941c8621058369b842}{length} += \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
452    \}
453 
454    \textcolor{comment}{//Successful processing}
455    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
456 \}
\end{DoxyCode}
