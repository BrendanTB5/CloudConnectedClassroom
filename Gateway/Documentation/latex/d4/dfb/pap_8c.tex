\hypertarget{pap_8c}{}\section{cyclone\+\_\+tcp/ppp/pap.c File Reference}
\label{pap_8c}\index{cyclone\+\_\+tcp/ppp/pap.\+c@{cyclone\+\_\+tcp/ppp/pap.\+c}}


P\+AP (Password Authentication Protocol)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/lcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipv6cp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/pap.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{pap_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_a6846ac6ad519d80910968129e3b384c2}{pap\+Start\+Auth} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Start P\+AP authentication. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_ad87d5b9ddd79993c637c460d49c1c803}{pap\+Abort\+Auth} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Abort P\+AP authentication. \end{DoxyCompactList}\item 
void \hyperlink{pap_8c_ab4891a99f146863f2ab0f60020f96566}{pap\+Tick} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em P\+AP timer handler. \end{DoxyCompactList}\item 
void \hyperlink{pap_8c_a86bcd6a8b9aac4e31febd023cae60ad0}{pap\+Process\+Packet} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{Ppp\+Packet} $\ast$packet, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process an incoming P\+AP packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_ae426ad371280492fb720d9b3aa511cee}{pap\+Process\+Auth\+Req} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{Pap\+Auth\+Req\+Packet} $\ast$auth\+Req\+Packet, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process Authenticate-\/\+Request packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_af3e0f3528bdc00c1c95b21ccb07f58a5}{pap\+Process\+Auth\+Ack} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{Pap\+Auth\+Ack\+Packet} $\ast$auth\+Ack\+Packet, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process Authenticate-\/\+Ack packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_a05ea697b6f1c51fb4122f5d94d7472b1}{pap\+Process\+Auth\+Nak} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{Pap\+Auth\+Nak\+Packet} $\ast$auth\+Nak\+Packet, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process Authenticate-\/\+Nak packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_a24b32b392fcf413a703d470c9e9b985a}{pap\+Send\+Auth\+Req} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send Authenticate-\/\+Request packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_a01716f309a3b3ce6273b40dc73db726c}{pap\+Send\+Auth\+Ack} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier})
\begin{DoxyCompactList}\small\item\em Send Authenticate-\/\+Ack packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pap_8c_a399d1bdef20b30ba2aef7263624f5207}{pap\+Send\+Auth\+Nak} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier})
\begin{DoxyCompactList}\small\item\em Send Authenticate-\/\+Nak packet. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{pap_8c_ab8ed6527ded0112f6a485159ee442e9a}{pap\+Check\+Password} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$password)
\begin{DoxyCompactList}\small\item\em Password verification. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
P\+AP (Password Authentication Protocol) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{pap_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{pap_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{pap.\+c@{pap.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}



Definition at line 32 of file pap.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{pap_8c_ad87d5b9ddd79993c637c460d49c1c803}\label{pap_8c_ad87d5b9ddd79993c637c460d49c1c803}} 
\index{pap.\+c@{pap.\+c}!pap\+Abort\+Auth@{pap\+Abort\+Auth}}
\index{pap\+Abort\+Auth@{pap\+Abort\+Auth}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Abort\+Auth()}{papAbortAuth()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Abort\+Auth (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Abort P\+AP authentication. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 87 of file pap.\+c.


\begin{DoxyCode}
88 \{
89    \textcolor{comment}{//Debug message}
90    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nAborting PAP authentication...\(\backslash\)r\(\backslash\)n"});
91 
92    \textcolor{comment}{//Abort PAP authentication process}
93    context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
94    context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
95 
96    \textcolor{comment}{//Successful processing}
97    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
98 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_ab8ed6527ded0112f6a485159ee442e9a}\label{pap_8c_ab8ed6527ded0112f6a485159ee442e9a}} 
\index{pap.\+c@{pap.\+c}!pap\+Check\+Password@{pap\+Check\+Password}}
\index{pap\+Check\+Password@{pap\+Check\+Password}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Check\+Password()}{papCheckPassword()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} pap\+Check\+Password (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{password }\end{DoxyParamCaption})}



Password verification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em password} & N\+U\+L\+L-\/terminated string containing the password to be checked \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the password is valid, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 602 of file pap.\+c.


\begin{DoxyCode}
603 \{
604    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
605    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} status;
606 
607    \textcolor{comment}{//This flag tells whether the password is valid}
608    status = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
609 
610    \textcolor{comment}{//Retrieve the length of the password}
611    n = strlen(password);
612 
613    \textcolor{comment}{//Compare the length of the password against the expected value}
614    \textcolor{keywordflow}{if}(n == context->papFsm.passwordLen)
615    \{
616       \textcolor{comment}{//Check whether the password is valid}
617       \textcolor{keywordflow}{if}(!memcmp(password, context->papFsm.password, n))
618          status = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
619    \}
620 
621    \textcolor{comment}{//Return TRUE is the password is valid, else FALSE}
622    \textcolor{keywordflow}{return} status;
623 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_af3e0f3528bdc00c1c95b21ccb07f58a5}\label{pap_8c_af3e0f3528bdc00c1c95b21ccb07f58a5}} 
\index{pap.\+c@{pap.\+c}!pap\+Process\+Auth\+Ack@{pap\+Process\+Auth\+Ack}}
\index{pap\+Process\+Auth\+Ack@{pap\+Process\+Auth\+Ack}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Process\+Auth\+Ack()}{papProcessAuthAck()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Process\+Auth\+Ack (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{Pap\+Auth\+Ack\+Packet} $\ast$}]{auth\+Ack\+Packet,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process Authenticate-\/\+Ack packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em auth\+Ack\+Packet} & Packet received from the peer \\
\hline
\mbox{\tt in}  & {\em length} & Length of the packet, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 330 of file pap.\+c.


\begin{DoxyCode}
332 \{
333    \textcolor{comment}{//Debug message}
334    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPAP Authenticate-Ack packet received\(\backslash\)r\(\backslash\)n"});
335 
336    \textcolor{comment}{//Make sure the Authenticate-Ack packet is acceptable}
337    \textcolor{keywordflow}{if}(context->peerConfig.authProtocol != \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
338       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
339 
340    \textcolor{comment}{//Check the length of the packet}
341    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{PapAuthAckPacket}))
342       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
343 
344    \textcolor{comment}{//When a packet is received with an invalid Identifier field, the}
345    \textcolor{comment}{//packet is silently discarded without affecting the automaton}
346    \textcolor{keywordflow}{if}(authAckPacket->identifier != context->papFsm.identifier)
347       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2bc2298123e24e3d82592b5c68c20612}{ERROR\_WRONG\_IDENTIFIER};
348 
349    \textcolor{comment}{//Switch to the Ack-Rcvd state}
350    context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a3dfaf53486dae5fc9c056aacf19d4267}{PAP\_STATE\_5\_ACK\_RCVD};
351    \textcolor{comment}{//The user name has been accepted by the authenticator}
352    context->peerAuthDone = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
353 
354    \textcolor{comment}{//Check whether PPP authentication is complete}
355    \textcolor{keywordflow}{if}(context->localAuthDone && context->peerAuthDone)
356    \{
357       \textcolor{comment}{//Check current PPP phase}
358       \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aab4c795f3f8509655c0e1eb0c3991104}{PPP\_PHASE\_AUTHENTICATE})
359       \{
360          \textcolor{comment}{//Advance to the Network phase}
361          context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29ab0d3380ae163bae2a13438207f8f6adf}{PPP\_PHASE\_NETWORK};
362 
363 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
364          \textcolor{comment}{//IPCP Open event}
365          \hyperlink{ipcp_8c_a964305681ae4db8b15a060834fc95967}{ipcpOpen}(context);
366 \textcolor{preprocessor}{#endif}
367 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
368          \textcolor{comment}{//IPV6CP Open event}
369          \hyperlink{ipv6cp_8c_a0bef2c07fcc5f6302075dde648aec215}{ipv6cpOpen}(context);
370 \textcolor{preprocessor}{#endif}
371       \}
372    \}
373 
374    \textcolor{comment}{//Successful processing}
375    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
376 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a05ea697b6f1c51fb4122f5d94d7472b1}\label{pap_8c_a05ea697b6f1c51fb4122f5d94d7472b1}} 
\index{pap.\+c@{pap.\+c}!pap\+Process\+Auth\+Nak@{pap\+Process\+Auth\+Nak}}
\index{pap\+Process\+Auth\+Nak@{pap\+Process\+Auth\+Nak}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Process\+Auth\+Nak()}{papProcessAuthNak()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Process\+Auth\+Nak (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{Pap\+Auth\+Nak\+Packet} $\ast$}]{auth\+Nak\+Packet,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process Authenticate-\/\+Nak packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em auth\+Nak\+Packet} & Packet received from the peer \\
\hline
\mbox{\tt in}  & {\em length} & Length of the packet, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 387 of file pap.\+c.


\begin{DoxyCode}
389 \{
390    \textcolor{comment}{//Debug message}
391    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPAP Authenticate-Nak packet received\(\backslash\)r\(\backslash\)n"});
392 
393    \textcolor{comment}{//Make sure the Authenticate-Nak packet is acceptable}
394    \textcolor{keywordflow}{if}(context->peerConfig.authProtocol != \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
395       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
396 
397    \textcolor{comment}{//Check the length of the packet}
398    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{PapAuthNakPacket}))
399       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
400 
401    \textcolor{comment}{//When a packet is received with an invalid Identifier field, the}
402    \textcolor{comment}{//packet is silently discarded without affecting the automaton}
403    \textcolor{keywordflow}{if}(authNakPacket->identifier != context->papFsm.identifier)
404       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2bc2298123e24e3d82592b5c68c20612}{ERROR\_WRONG\_IDENTIFIER};
405 
406    \textcolor{comment}{//Switch to the Nak-Rcvd state}
407    context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a06ff7dd4b6ffecb6cc2db7be8a6cd44d}{PAP\_STATE\_7\_NAK\_RCVD};
408    \textcolor{comment}{//Authentication failed}
409    \hyperlink{lcp_8c_a588713b9f40b510b652a2ef5fe564161}{lcpClose}(context);
410 
411    \textcolor{comment}{//Successful processing}
412    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
413 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_ae426ad371280492fb720d9b3aa511cee}\label{pap_8c_ae426ad371280492fb720d9b3aa511cee}} 
\index{pap.\+c@{pap.\+c}!pap\+Process\+Auth\+Req@{pap\+Process\+Auth\+Req}}
\index{pap\+Process\+Auth\+Req@{pap\+Process\+Auth\+Req}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Process\+Auth\+Req()}{papProcessAuthReq()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Process\+Auth\+Req (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{Pap\+Auth\+Req\+Packet} $\ast$}]{auth\+Req\+Packet,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process Authenticate-\/\+Request packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em auth\+Req\+Packet} & Packet received from the peer \\
\hline
\mbox{\tt in}  & {\em length} & Length of the packet, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 214 of file pap.\+c.


\begin{DoxyCode}
216 \{
217    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} status;
218    \textcolor{keywordtype}{size\_t} usernameLen;
219    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
220 
221    \textcolor{comment}{//Debug message}
222    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPAP Authenticate-Request packet received\(\backslash\)r\(\backslash\)n"});
223 
224    \textcolor{comment}{//Make sure the Authenticate-Request packet is acceptable}
225    \textcolor{keywordflow}{if}(context->localConfig.authProtocol != \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
226       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
227 
228    \textcolor{comment}{//Check the length of the packet}
229    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket}))
230       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
231 
232    \textcolor{comment}{//Retrieve the length of the Peer-ID field}
233    usernameLen = authReqPacket->peerIdLength;
234 
235    \textcolor{comment}{//Malformed Authenticate-Request packet?}
236    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket}) + 1 + usernameLen))
237       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
238 
239    \textcolor{comment}{//Limit the length of the string}
240    usernameLen = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(usernameLen, \hyperlink{ppp_8h_acafaf0139acdee8a293aa63cd32666b6}{PPP\_MAX\_USERNAME\_LEN});
241    \textcolor{comment}{//Copy the name of the peer to be identified}
242    memcpy(context->peerName, authReqPacket->peerId, usernameLen);
243    \textcolor{comment}{//Properly terminate the string with a NULL character}
244    context->peerName[usernameLen] = \textcolor{charliteral}{'\(\backslash\)0'};
245 
246    \textcolor{comment}{//Point to the Passwd-Length field}
247    p = authReqPacket->peerId + usernameLen;
248 
249    \textcolor{comment}{//Save the length of Password field}
250    context->papFsm.passwordLen = p[0];
251    \textcolor{comment}{//Point to the Password field}
252    context->papFsm.password = p + 1;
253 
254    \textcolor{comment}{//Malformed Authenticate-Request packet?}
255    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket}) + 1 + usernameLen + context->papFsm.
      passwordLen))
256       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
257 
258    \textcolor{comment}{//Invoke user-defined callback, if any}
259    \textcolor{keywordflow}{if}(context->settings.authCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
260    \{
261       \textcolor{comment}{//Perfom username and password verification}
262       status = context->settings.authCallback(context->interface,
263          context->peerName);
264    \}
265    \textcolor{keywordflow}{else}
266    \{
267       \textcolor{comment}{//Unable to perform authentication...}
268       status = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
269    \}
270 
271    \textcolor{comment}{//Successful authentication?}
272    \textcolor{keywordflow}{if}(status)
273    \{
274       \textcolor{comment}{//If the Peer-ID/Password pair received in the Authenticate-Request}
275       \textcolor{comment}{//is both recognizable and acceptable, then the authenticator must}
276       \textcolor{comment}{//transmit an Authenticate-Ack packet}
277       \hyperlink{pap_8c_a01716f309a3b3ce6273b40dc73db726c}{papSendAuthAck}(context, authReqPacket->identifier);
278 
279       \textcolor{comment}{//Switch to the Ack-Sent state}
280       context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a30f228155328beab28f64b5cae02547a}{PAP\_STATE\_4\_ACK\_SENT};
281       \textcolor{comment}{//The user has been successfully authenticated}
282       context->localAuthDone = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
283 
284       \textcolor{comment}{//Check whether PPP authentication is complete}
285       \textcolor{keywordflow}{if}(context->localAuthDone && context->peerAuthDone)
286       \{
287          \textcolor{comment}{//Check current PPP phase}
288          \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aab4c795f3f8509655c0e1eb0c3991104}{PPP\_PHASE\_AUTHENTICATE})
289          \{
290             \textcolor{comment}{//Advance to the Network phase}
291             context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29ab0d3380ae163bae2a13438207f8f6adf}{PPP\_PHASE\_NETWORK};
292 
293 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
294             \textcolor{comment}{//IPCP Open event}
295             \hyperlink{ipcp_8c_a964305681ae4db8b15a060834fc95967}{ipcpOpen}(context);
296 \textcolor{preprocessor}{#endif}
297 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
298             \textcolor{comment}{//IPV6CP Open event}
299             \hyperlink{ipv6cp_8c_a0bef2c07fcc5f6302075dde648aec215}{ipv6cpOpen}(context);
300 \textcolor{preprocessor}{#endif}
301          \}
302       \}
303    \}
304    \textcolor{keywordflow}{else}
305    \{
306       \textcolor{comment}{//If the Peer-ID/Password pair received in the Authenticate-Request}
307       \textcolor{comment}{//is not recognizable or acceptable, then the authenticator must}
308       \textcolor{comment}{//transmit an Authenticate-Nak packet}
309       \hyperlink{pap_8c_a399d1bdef20b30ba2aef7263624f5207}{papSendAuthNak}(context, authReqPacket->identifier);
310 
311       \textcolor{comment}{//Switch to the Nak-Sent state}
312       context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9ad0d3499e81c1c7c88de761cef6074cee}{PAP\_STATE\_6\_NAK\_SENT};
313       \textcolor{comment}{//The authenticator should take action to terminate the link}
314       \hyperlink{lcp_8c_a588713b9f40b510b652a2ef5fe564161}{lcpClose}(context);
315    \}
316 
317    \textcolor{comment}{//Successful processing}
318    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
319 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a86bcd6a8b9aac4e31febd023cae60ad0}\label{pap_8c_a86bcd6a8b9aac4e31febd023cae60ad0}} 
\index{pap.\+c@{pap.\+c}!pap\+Process\+Packet@{pap\+Process\+Packet}}
\index{pap\+Process\+Packet@{pap\+Process\+Packet}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Process\+Packet()}{papProcessPacket()}}
{\footnotesize\ttfamily void pap\+Process\+Packet (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{Ppp\+Packet} $\ast$}]{packet,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process an incoming P\+AP packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em packet} & P\+AP packet received from the peer \\
\hline
\mbox{\tt in}  & {\em length} & Length of the packet, in bytes \\
\hline
\end{DoxyParams}


Definition at line 149 of file pap.\+c.


\begin{DoxyCode}
151 \{
152    \textcolor{comment}{//Ensure the length of the incoming PAP packet is valid}
153    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket}))
154       \textcolor{keywordflow}{return};
155 
156    \textcolor{comment}{//Check the length field}
157    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(packet->length) > \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
158       \textcolor{keywordflow}{return};
159    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(packet->length) < \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket}))
160       \textcolor{keywordflow}{return};
161 
162    \textcolor{comment}{//Save the length of the PAP packet}
163    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(packet->length);
164 
165    \textcolor{comment}{//Debug message}
166    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"PAP packet received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
167    \textcolor{comment}{//Dump PAP packet contents for debugging purpose}
168    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}(packet, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
169 
170    \textcolor{comment}{//Because the Authenticate-Ack might be lost, the authenticator must}
171    \textcolor{comment}{//allow repeated Authenticate-Request packets after completing the}
172    \textcolor{comment}{//Authentication phase}
173    \textcolor{keywordflow}{if}(context->pppPhase != \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aab4c795f3f8509655c0e1eb0c3991104}{PPP\_PHASE\_AUTHENTICATE} &&
174       context->pppPhase != \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29ab0d3380ae163bae2a13438207f8f6adf}{PPP\_PHASE\_NETWORK})
175    \{
176       \textcolor{comment}{//Any packets received during any other phase must be silently discarded}
177       \textcolor{keywordflow}{return};
178    \}
179 
180    \textcolor{comment}{//Check PAP code field}
181    \textcolor{keywordflow}{switch}(packet->code)
182    \{
183    \textcolor{comment}{//Authenticate-Request packet?}
184    \textcolor{keywordflow}{case} \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023a31538f56c0b2888a031c38577ed69198}{PAP\_CODE\_AUTH\_REQ}:
185       \textcolor{comment}{//Process Authenticate-Request packet}
186       \hyperlink{pap_8c_ae426ad371280492fb720d9b3aa511cee}{papProcessAuthReq}(context, (\hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket} *) packet, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
187       \textcolor{keywordflow}{break};
188    \textcolor{comment}{//Authenticate-Ack packet?}
189    \textcolor{keywordflow}{case} \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023ac10bc7a277930e04c324a238ee12c52a}{PAP\_CODE\_AUTH\_ACK}:
190       \textcolor{comment}{//Process Authenticate-Ack packet}
191       \hyperlink{pap_8c_af3e0f3528bdc00c1c95b21ccb07f58a5}{papProcessAuthAck}(context, (\hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{PapAuthAckPacket} *) packet, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
192       \textcolor{keywordflow}{break};
193    \textcolor{comment}{//Authenticate-Nak packet?}
194    \textcolor{keywordflow}{case} \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023a86f72394d123bf3ed7c87443a4970ffd}{PAP\_CODE\_AUTH\_NAK}:
195       \textcolor{comment}{//Process Authenticate-Nak packet}
196       \hyperlink{pap_8c_a05ea697b6f1c51fb4122f5d94d7472b1}{papProcessAuthNak}(context, (\hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{PapAuthNakPacket} *) packet, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
197       \textcolor{keywordflow}{break};
198    \textcolor{comment}{//Unknown code field}
199    \textcolor{keywordflow}{default}:
200       \textcolor{comment}{//Silently drop the incoming packet}
201       \textcolor{keywordflow}{break};
202    \}
203 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a01716f309a3b3ce6273b40dc73db726c}\label{pap_8c_a01716f309a3b3ce6273b40dc73db726c}} 
\index{pap.\+c@{pap.\+c}!pap\+Send\+Auth\+Ack@{pap\+Send\+Auth\+Ack}}
\index{pap\+Send\+Auth\+Ack@{pap\+Send\+Auth\+Ack}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Send\+Auth\+Ack()}{papSendAuthAck()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Send\+Auth\+Ack (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier }\end{DoxyParamCaption})}



Send Authenticate-\/\+Ack packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 500 of file pap.\+c.


\begin{DoxyCode}
501 \{
502    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
503    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
504    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
505    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
506    \hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{PapAuthAckPacket} *authAckPacket;
507 
508    \textcolor{comment}{//Retrieve the length of the Authenticate-Ack packet}
509    length = \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a57e6f740c13c59f3ce639b0a3af6e19b}{PapAuthAckPacket});
510 
511    \textcolor{comment}{//Allocate a buffer memory to hold the Authenticate-Ack packet}
512    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
513    \textcolor{comment}{//Failed to allocate memory?}
514    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
515       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
516 
517    \textcolor{comment}{//Point to the Authenticate-Ack packet}
518    authAckPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
519 
520    \textcolor{comment}{//Format packet header}
521    authAckPacket->code = \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023ac10bc7a277930e04c324a238ee12c52a}{PAP\_CODE\_AUTH\_ACK};
522    authAckPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
523    authAckPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
524 
525    \textcolor{comment}{//The Message field is zero or more octets, and its contents are}
526    \textcolor{comment}{//implementation dependent}
527    authAckPacket->msgLength = 0;
528 
529    \textcolor{comment}{//Debug message}
530    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending PAP Authenticate-Ack packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length)
      ;
531    \textcolor{comment}{//Dump packet contents for debugging purpose}
532    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) authAckPacket, length, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
533 
534    \textcolor{comment}{//Send PPP frame}
535    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
536 
537    \textcolor{comment}{//Free previously allocated memory block}
538    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
539    \textcolor{comment}{//Return status code}
540    \textcolor{keywordflow}{return} error;
541 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a399d1bdef20b30ba2aef7263624f5207}\label{pap_8c_a399d1bdef20b30ba2aef7263624f5207}} 
\index{pap.\+c@{pap.\+c}!pap\+Send\+Auth\+Nak@{pap\+Send\+Auth\+Nak}}
\index{pap\+Send\+Auth\+Nak@{pap\+Send\+Auth\+Nak}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Send\+Auth\+Nak()}{papSendAuthNak()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Send\+Auth\+Nak (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier }\end{DoxyParamCaption})}



Send Authenticate-\/\+Nak packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 551 of file pap.\+c.


\begin{DoxyCode}
552 \{
553    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
554    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
555    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
556    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
557    \hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{PapAuthNakPacket} *authNakPacket;
558 
559    \textcolor{comment}{//Retrieve the length of the Authenticate-Nak packet}
560    length = \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_afd36e5bd77a802ce1c38d7609cdb6456}{PapAuthNakPacket});
561 
562    \textcolor{comment}{//Allocate a buffer memory to hold the Authenticate-Nak packet}
563    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
564    \textcolor{comment}{//Failed to allocate memory?}
565    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
566       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
567 
568    \textcolor{comment}{//Point to the Authenticate-Nak packet}
569    authNakPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
570 
571    \textcolor{comment}{//Format packet header}
572    authNakPacket->code = \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023a86f72394d123bf3ed7c87443a4970ffd}{PAP\_CODE\_AUTH\_NAK};
573    authNakPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
574    authNakPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
575 
576    \textcolor{comment}{//The Message field is zero or more octets, and its contents are}
577    \textcolor{comment}{//implementation dependent}
578    authNakPacket->msgLength = 0;
579 
580    \textcolor{comment}{//Debug message}
581    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending PAP Authenticate-Nak packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length)
      ;
582    \textcolor{comment}{//Dump packet contents for debugging purpose}
583    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) authNakPacket, length, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
584 
585    \textcolor{comment}{//Send PPP frame}
586    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
587 
588    \textcolor{comment}{//Free previously allocated memory block}
589    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
590    \textcolor{comment}{//Return status code}
591    \textcolor{keywordflow}{return} error;
592 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a24b32b392fcf413a703d470c9e9b985a}\label{pap_8c_a24b32b392fcf413a703d470c9e9b985a}} 
\index{pap.\+c@{pap.\+c}!pap\+Send\+Auth\+Req@{pap\+Send\+Auth\+Req}}
\index{pap\+Send\+Auth\+Req@{pap\+Send\+Auth\+Req}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Send\+Auth\+Req()}{papSendAuthReq()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Send\+Auth\+Req (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send Authenticate-\/\+Request packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 422 of file pap.\+c.


\begin{DoxyCode}
423 \{
424    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
425    \textcolor{keywordtype}{size\_t} usernameLen;
426    \textcolor{keywordtype}{size\_t} passwordLen;
427    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
428    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
429    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
430    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
431    \hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket} *authReqPacket;
432 
433    \textcolor{comment}{//Get the length of the user name}
434    usernameLen = strlen(context->username);
435    \textcolor{comment}{//Get the length of the password}
436    passwordLen = strlen(context->password);
437 
438    \textcolor{comment}{//Calculate the length of the Authenticate-Request packet}
439    length = \textcolor{keyword}{sizeof}(\hyperlink{pap_8h_a2d534564c63bb9810129941217e5b9e8}{PapAuthReqPacket}) + 1 + usernameLen + passwordLen;
440 
441    \textcolor{comment}{//Allocate a buffer memory to hold the packet}
442    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
443    \textcolor{comment}{//Failed to allocate memory?}
444    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
445       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
446 
447    \textcolor{comment}{//Point to the Authenticate-Request packet}
448    authReqPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
449 
450    \textcolor{comment}{//Format packet header}
451    authReqPacket->code = \hyperlink{pap_8h_a7266980582144d9130f5fb2217969023a31538f56c0b2888a031c38577ed69198}{PAP\_CODE\_AUTH\_REQ};
452    authReqPacket->identifier = ++context->papFsm.identifier;
453    authReqPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
454 
455    \textcolor{comment}{//The Peer-ID-Length field indicates the length of Peer-ID field}
456    authReqPacket->peerIdLength = usernameLen;
457    \textcolor{comment}{//Append Peer-ID}
458    memcpy(authReqPacket->peerId, context->username, usernameLen);
459 
460    \textcolor{comment}{//Point to the Passwd-Length field}
461    p = authReqPacket->peerId + usernameLen;
462    \textcolor{comment}{//The Passwd-Length field indicates the length of Password field}
463    p[0] = passwordLen;
464 
465    \textcolor{comment}{//Append Password}
466    memcpy(p + 1, context->password, passwordLen);
467 
468    \textcolor{comment}{//Adjust the length of the multi-part buffer}
469    \hyperlink{net__mem_8c_ac0a46f396754e069dd1ee65cdc559b28}{netBufferSetLength}(buffer, offset + length);
470 
471    \textcolor{comment}{//Debug message}
472    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending PAP Authenticate-Request packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      length);
473    \textcolor{comment}{//Dump packet contents for debugging purpose}
474    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) authReqPacket, length, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
475 
476    \textcolor{comment}{//Send PPP frame}
477    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP});
478 
479    \textcolor{comment}{//The restart counter is decremented each time a Authenticate-Request is sent}
480    \textcolor{keywordflow}{if}(context->papFsm.restartCounter > 0)
481       context->papFsm.restartCounter--;
482 
483    \textcolor{comment}{//Save the time at which the packet was sent}
484    context->papFsm.timestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
485 
486    \textcolor{comment}{//Free previously allocated memory block}
487    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
488    \textcolor{comment}{//Return status code}
489    \textcolor{keywordflow}{return} error;
490 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_a6846ac6ad519d80910968129e3b384c2}\label{pap_8c_a6846ac6ad519d80910968129e3b384c2}} 
\index{pap.\+c@{pap.\+c}!pap\+Start\+Auth@{pap\+Start\+Auth}}
\index{pap\+Start\+Auth@{pap\+Start\+Auth}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Start\+Auth()}{papStartAuth()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pap\+Start\+Auth (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Start P\+AP authentication. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 53 of file pap.\+c.


\begin{DoxyCode}
54 \{
55    \textcolor{comment}{//Debug message}
56    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nStarting PAP authentication...\(\backslash\)r\(\backslash\)n"});
57 
58    \textcolor{comment}{//Check whether the other end of the PPP link is being authenticated}
59    \textcolor{keywordflow}{if}(context->localConfig.authProtocol == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
60    \{
61       \textcolor{comment}{//Switch to the Started state}
62       context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a1afbd01a5c8c106c4fa2fc949de6feaa}{PAP\_STATE\_1\_STARTED};
63    \}
64 
65    \textcolor{comment}{//Check whether the other end of the PPP link is the authenticator}
66    \textcolor{keywordflow}{if}(context->peerConfig.authProtocol == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
67    \{
68       \textcolor{comment}{//Initialize restart counter}
69       context->papFsm.restartCounter = \hyperlink{pap_8h_a85e674be0a088f5312a9c8a811f1d9d8}{PAP\_MAX\_REQUESTS};
70       \textcolor{comment}{//Send Authenticate-Request packet}
71       \hyperlink{pap_8c_a24b32b392fcf413a703d470c9e9b985a}{papSendAuthReq}(context);
72       \textcolor{comment}{//Switch to the Req-Sent state}
73       context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9abd6f928f32449e074812664a8cea96df}{PAP\_STATE\_2\_REQ\_SENT};
74    \}
75 
76    \textcolor{comment}{//Successful processing}
77    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
78 \}
\end{DoxyCode}
\mbox{\Hypertarget{pap_8c_ab4891a99f146863f2ab0f60020f96566}\label{pap_8c_ab4891a99f146863f2ab0f60020f96566}} 
\index{pap.\+c@{pap.\+c}!pap\+Tick@{pap\+Tick}}
\index{pap\+Tick@{pap\+Tick}!pap.\+c@{pap.\+c}}
\subsubsection{\texorpdfstring{pap\+Tick()}{papTick()}}
{\footnotesize\ttfamily void pap\+Tick (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



P\+AP timer handler. 

This routine must be periodically called by the T\+C\+P/\+IP stack to manage retransmissions


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\end{DoxyParams}


Definition at line 110 of file pap.\+c.


\begin{DoxyCode}
111 \{
112    \textcolor{comment}{//Check whether the restart timer is running}
113    \textcolor{keywordflow}{if}(context->papFsm.peerState == \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9abd6f928f32449e074812664a8cea96df}{PAP\_STATE\_2\_REQ\_SENT})
114    \{
115       \textcolor{comment}{//Get current time}
116       \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
117 
118       \textcolor{comment}{//Check restart timer}
119       \textcolor{keywordflow}{if}((time - context->papFsm.timestamp) >= \hyperlink{pap_8h_aee493ffe030dd35baab1f4f5d4132e10}{PAP\_RESTART\_TIMER})
120       \{
121          \textcolor{comment}{//Debug message}
122          \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPAP Timeout event\(\backslash\)r\(\backslash\)n"});
123 
124          \textcolor{comment}{//Check whether the restart counter is greater than zero}
125          \textcolor{keywordflow}{if}(context->papFsm.restartCounter > 0)
126          \{
127             \textcolor{comment}{//Retransmit the Authenticate-Request packet}
128             \hyperlink{pap_8c_a24b32b392fcf413a703d470c9e9b985a}{papSendAuthReq}(context);
129          \}
130          \textcolor{keywordflow}{else}
131          \{
132             \textcolor{comment}{//Abort PAP authentication}
133             context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
134             \textcolor{comment}{//Authentication failed}
135             \hyperlink{lcp_8c_a588713b9f40b510b652a2ef5fe564161}{lcpClose}(context);
136          \}
137       \}
138    \}
139 \}
\end{DoxyCode}
