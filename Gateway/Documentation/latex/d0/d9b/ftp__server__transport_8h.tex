\hypertarget{ftp__server__transport_8h}{}\section{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+transport.h File Reference}
\label{ftp__server__transport_8h}\index{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+transport.\+h@{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+transport.\+h}}


Transport protocol abstraction layer.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+server.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__server__transport_8h_a5cfa9b56f98d969fcc0ac892122a691c}{ftp\+Server\+Open\+Secure\+Channel} (\hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{Ftp\+Server\+Context} $\ast$context, \hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$channel, size\+\_\+t tx\+Buffer\+Size, size\+\_\+t rx\+Buffer\+Size)
\begin{DoxyCompactList}\small\item\em Open secure connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__server__transport_8h_a4114584444ad6a12b534f163f350c4aa}{ftp\+Server\+Establish\+Secure\+Channel} (\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$channel)
\begin{DoxyCompactList}\small\item\em Establish secure connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__server__transport_8h_abce43a97874ed1e25273269c30b05b90}{ftp\+Server\+Write\+Channel} (\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$channel, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send data using the relevant transport protocol. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__server__transport_8h_a8daedd68f4993a0c999aca53bce4697d}{ftp\+Server\+Read\+Channel} (\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$channel, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Receive data using the relevant transport protocol. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Transport protocol abstraction layer. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{ftp__server__transport_8h_a4114584444ad6a12b534f163f350c4aa}\label{ftp__server__transport_8h_a4114584444ad6a12b534f163f350c4aa}} 
\index{ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}!ftp\+Server\+Establish\+Secure\+Channel@{ftp\+Server\+Establish\+Secure\+Channel}}
\index{ftp\+Server\+Establish\+Secure\+Channel@{ftp\+Server\+Establish\+Secure\+Channel}!ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{ftp\+Server\+Establish\+Secure\+Channel()}{ftpServerEstablishSecureChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Server\+Establish\+Secure\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$}]{channel }\end{DoxyParamCaption})}



Establish secure connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 118 of file ftp\+\_\+server\+\_\+transport.\+c.


\begin{DoxyCode}
119 \{
120 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
121    \textcolor{comment}{//Establish a TLS connection}
122    \textcolor{keywordflow}{return} \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext});
123 \textcolor{preprocessor}{#else}
124    \textcolor{comment}{//Not implemented}
125    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
126 \textcolor{preprocessor}{#endif}
127 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__transport_8h_a5cfa9b56f98d969fcc0ac892122a691c}\label{ftp__server__transport_8h_a5cfa9b56f98d969fcc0ac892122a691c}} 
\index{ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}!ftp\+Server\+Open\+Secure\+Channel@{ftp\+Server\+Open\+Secure\+Channel}}
\index{ftp\+Server\+Open\+Secure\+Channel@{ftp\+Server\+Open\+Secure\+Channel}!ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{ftp\+Server\+Open\+Secure\+Channel()}{ftpServerOpenSecureChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Server\+Open\+Secure\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{Ftp\+Server\+Context} $\ast$}]{context,  }\item[{\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$}]{channel,  }\item[{size\+\_\+t}]{tx\+Buffer\+Size,  }\item[{size\+\_\+t}]{rx\+Buffer\+Size }\end{DoxyParamCaption})}



Open secure connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the F\+TP server context \\
\hline
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt in}  & {\em tx\+Buffer\+Size} & TX buffer size \\
\hline
\mbox{\tt in}  & {\em rx\+Buffer\+Size} & RX buffer size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 53 of file ftp\+\_\+server\+\_\+transport.\+c.


\begin{DoxyCode}
55 \{
56 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
57    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
58 
59    \textcolor{comment}{//Allocate TLS context}
60    channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext} = \hyperlink{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}{tlsInit}();
61    \textcolor{comment}{//Failed to allocate TLS context?}
62    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
63       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
64 
65    \textcolor{comment}{//Select server operation mode}
66    error = \hyperlink{tls_8c_a8713543db673ee5a36b2fda92e082c6b}{tlsSetConnectionEnd}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER});
67    \textcolor{comment}{//Any error to report?}
68    \textcolor{keywordflow}{if}(error)
69       \textcolor{keywordflow}{return} error;
70 
71    \textcolor{comment}{//Bind TLS to the relevant socket}
72    error = \hyperlink{tls_8h_af918bec8cc034c91ae7cb14a4ab24103}{tlsSetSocket}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, channel->
      \hyperlink{structFtpServerChannel_a1647ab825265d382571d1d48d521d79f}{socket});
73    \textcolor{comment}{//Any error to report?}
74    \textcolor{keywordflow}{if}(error)
75       \textcolor{keywordflow}{return} error;
76 
77    \textcolor{comment}{//Set TX and RX buffer size}
78    error = \hyperlink{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}{tlsSetBufferSize}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, txBufferSize,
79       rxBufferSize);
80    \textcolor{comment}{//Any error to report?}
81    \textcolor{keywordflow}{if}(error)
82       \textcolor{keywordflow}{return} error;
83 
84 \textcolor{preprocessor}{#if (TLS\_TICKET\_SUPPORT == ENABLED)}
85    \textcolor{comment}{//Enable session ticket mechanism}
86    error = \hyperlink{tls_8c_a07aa42467b2c7ab9dadd717506a991f1}{tlsSetTicketCallbacks}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, 
      \hyperlink{tls__ticket_8c_a97a23fd779221231d59bfc050bcd0f95}{tlsEncryptTicket},
87       \hyperlink{tls__ticket_8c_ace306bc54547aba1c81d5a8f957fc1cd}{tlsDecryptTicket}, &context->tlsTicketContext);
88    \textcolor{comment}{//Any error to report?}
89    \textcolor{keywordflow}{if}(error)
90       \textcolor{keywordflow}{return} error;
91 \textcolor{preprocessor}{#endif}
92 
93    \textcolor{comment}{//Invoke user-defined callback, if any}
94    \textcolor{keywordflow}{if}(context->settings.tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
95    \{
96       \textcolor{comment}{//Perform TLS related initialization}
97       error = context->settings.tlsInitCallback(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext});
98       \textcolor{comment}{//Any error to report?}
99       \textcolor{keywordflow}{if}(error)
100          \textcolor{keywordflow}{return} error;
101    \}
102 
103    \textcolor{comment}{//Successful processing}
104    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
105 \textcolor{preprocessor}{#else}
106    \textcolor{comment}{//Not implemented}
107    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
108 \textcolor{preprocessor}{#endif}
109 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__transport_8h_a8daedd68f4993a0c999aca53bce4697d}\label{ftp__server__transport_8h_a8daedd68f4993a0c999aca53bce4697d}} 
\index{ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}!ftp\+Server\+Read\+Channel@{ftp\+Server\+Read\+Channel}}
\index{ftp\+Server\+Read\+Channel@{ftp\+Server\+Read\+Channel}!ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{ftp\+Server\+Read\+Channel()}{ftpServerReadChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Server\+Read\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$}]{channel,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Receive data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em received} & Number of bytes that have been received \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 177 of file ftp\+\_\+server\+\_\+transport.\+c.


\begin{DoxyCode}
179 \{
180    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
181 
182 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
183    \textcolor{comment}{//TLS-secured connection?}
184    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
185    \{
186       \textcolor{comment}{//Receive TLS-encrypted data}
187       error = \hyperlink{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}{tlsRead}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
188    \}
189    \textcolor{keywordflow}{else}
190 \textcolor{preprocessor}{#endif}
191    \{
192       \textcolor{comment}{//Receive data}
193       error = \hyperlink{socket_8c_a894c7bf0bfd4e3886fc584ed7ebbb087}{socketReceive}(channel->\hyperlink{structFtpServerChannel_a1647ab825265d382571d1d48d521d79f}{socket}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
194    \}
195 
196    \textcolor{comment}{//Return status code}
197    \textcolor{keywordflow}{return} error;
198 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__transport_8h_abce43a97874ed1e25273269c30b05b90}\label{ftp__server__transport_8h_abce43a97874ed1e25273269c30b05b90}} 
\index{ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}!ftp\+Server\+Write\+Channel@{ftp\+Server\+Write\+Channel}}
\index{ftp\+Server\+Write\+Channel@{ftp\+Server\+Write\+Channel}!ftp\+\_\+server\+\_\+transport.\+h@{ftp\+\_\+server\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{ftp\+Server\+Write\+Channel()}{ftpServerWriteChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Server\+Write\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpServerChannel}{Ftp\+Server\+Channel} $\ast$}]{channel,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 143 of file ftp\+\_\+server\+\_\+transport.\+c.


\begin{DoxyCode}
145 \{
146    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
147 
148 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
149    \textcolor{comment}{//TLS-secured connection?}
150    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
151    \{
152       \textcolor{comment}{//Send TLS-encrypted data}
153       error = \hyperlink{tls_8c_a1b4b22502217a601f7f094403e700b4b}{tlsWrite}(channel->\hyperlink{structFtpServerChannel_a065c9bc8a17772c4aaf652689a8a6d3a}{tlsContext}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
154    \}
155    \textcolor{keywordflow}{else}
156 \textcolor{preprocessor}{#endif}
157    \{
158       \textcolor{comment}{//Transmit data}
159       error = \hyperlink{socket_8c_aa4eeb3a3294d14d681675ba9f0d3e568}{socketSend}(channel->\hyperlink{structFtpServerChannel_a1647ab825265d382571d1d48d521d79f}{socket}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
160    \}
161 
162    \textcolor{comment}{//Return status code}
163    \textcolor{keywordflow}{return} error;
164 \}
\end{DoxyCode}
