\hypertarget{sntp__client_8c}{}\section{cyclone\+\_\+tcp/sntp/sntp\+\_\+client.c File Reference}
\label{sntp__client_8c}\index{cyclone\+\_\+tcp/sntp/sntp\+\_\+client.\+c@{cyclone\+\_\+tcp/sntp/sntp\+\_\+client.\+c}}


S\+N\+TP client (Simple Network Time Protocol)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sntp/sntp\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sntp/sntp\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{sntp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a17d00fe38ec2c4ff847a3d2365025b7e}{S\+N\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{sntp__client_8c_a83ada394f7028e6469d6aebeddafa6f6}{sntp\+Client\+Init} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Initialize S\+N\+TP client context. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{sntp__client_8c_aac476c8cc5a40969b0e1899a609680a1}{sntp\+Client\+Set\+Timeout} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} timeout)
\begin{DoxyCompactList}\small\item\em Set communication timeout. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{sntp__client_8c_a79b7f9aed0e4211a11daf3f556587209}{sntp\+Client\+Bind\+To\+Interface} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context, \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Bind the S\+N\+TP client to a particular network interface. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{sntp__client_8c_aba383e624ebca9fe3d08922e84af7b70}{sntp\+Client\+Set\+Server\+Addr} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$server\+Ip\+Addr, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} server\+Port)
\begin{DoxyCompactList}\small\item\em Specify the IP address of the N\+TP server. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{sntp__client_8c_ae573b8f823981d03e9e7ad4b76b2ffba}{sntp\+Client\+Get\+Timestamp} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context, \hyperlink{ntp__common_8h_a4b0bee470029fbe2a20b9d804bd15ab5}{Ntp\+Timestamp} $\ast$timestamp)
\begin{DoxyCompactList}\small\item\em Retrieve current time from N\+TP server. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{sntp__client_8c_a0d1789bca6470e62e7d1e48660b7bb8e}{sntp\+Client\+Get\+Kiss\+Code} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Retrieve the kiss code from a Kiss-\/of-\/\+Death message. \end{DoxyCompactList}\item 
void \hyperlink{sntp__client_8c_a64f73d6690da9d11ce230c04956a798e}{sntp\+Client\+Deinit} (\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Release S\+N\+TP client context. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+N\+TP client (Simple Network Time Protocol) 

Helper functions for S\+N\+TP client.\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
The Simple Network Time Protocol is used to synchronize computer clocks in the Internet. Refer to R\+FC 4330 for more details

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{sntp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{sntp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a17d00fe38ec2c4ff847a3d2365025b7e}{S\+N\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 37 of file sntp\+\_\+client.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{sntp__client_8c_a79b7f9aed0e4211a11daf3f556587209}\label{sntp__client_8c_a79b7f9aed0e4211a11daf3f556587209}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Bind\+To\+Interface@{sntp\+Client\+Bind\+To\+Interface}}
\index{sntp\+Client\+Bind\+To\+Interface@{sntp\+Client\+Bind\+To\+Interface}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Bind\+To\+Interface()}{sntpClientBindToInterface()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} sntp\+Client\+Bind\+To\+Interface (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Bind the S\+N\+TP client to a particular network interface. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\mbox{\tt in}  & {\em interface} & Network interface to be used \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 103 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
105 \{
106    \textcolor{comment}{//Make sure the SNTP client context is valid}
107    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
108       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
109 
110    \textcolor{comment}{//Explicitly associate the SNTP client with the specified interface}
111    context->\hyperlink{structSntpClientContext_a201932df4f0b97e8b837d05658fb1a48}{interface} = interface;
112 
113    \textcolor{comment}{//Successful processing}
114    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
115 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_a64f73d6690da9d11ce230c04956a798e}\label{sntp__client_8c_a64f73d6690da9d11ce230c04956a798e}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Deinit@{sntp\+Client\+Deinit}}
\index{sntp\+Client\+Deinit@{sntp\+Client\+Deinit}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Deinit()}{sntpClientDeinit()}}
{\footnotesize\ttfamily void sntp\+Client\+Deinit (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Release S\+N\+TP client context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\end{DoxyParams}


Definition at line 259 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
260 \{
261    \textcolor{comment}{//Make sure the SNTP client context is valid}
262    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
263    \{
264       \textcolor{comment}{//Close UDP socket}
265       \hyperlink{sntp__client__misc_8c_af495d67158e5920dd0b555f041c39edd}{sntpClientCloseConnection}(context);
266 
267       \textcolor{comment}{//Clear SNTP client context}
268       memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSntpClientContext}{SntpClientContext}));
269    \}
270 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_a0d1789bca6470e62e7d1e48660b7bb8e}\label{sntp__client_8c_a0d1789bca6470e62e7d1e48660b7bb8e}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Get\+Kiss\+Code@{sntp\+Client\+Get\+Kiss\+Code}}
\index{sntp\+Client\+Get\+Kiss\+Code@{sntp\+Client\+Get\+Kiss\+Code}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Get\+Kiss\+Code()}{sntpClientGetKissCode()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} sntp\+Client\+Get\+Kiss\+Code (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Retrieve the kiss code from a Kiss-\/of-\/\+Death message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Kiss code 
\end{DoxyReturn}


Definition at line 233 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
234 \{
235    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} kissCode;
236 
237    \textcolor{comment}{//Make sure the SNTP client context is valid}
238    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
239    \{
240       \textcolor{comment}{//Get kiss code}
241       kissCode = context->\hyperlink{structSntpClientContext_af69b89fcaec3ccf3949de106a1768c77}{kissCode};
242    \}
243    \textcolor{keywordflow}{else}
244    \{
245       \textcolor{comment}{//The SNTP client context is not valid}
246       kissCode = 0;
247    \}
248 
249    \textcolor{comment}{//Return kiss code}
250    \textcolor{keywordflow}{return} kissCode;
251 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_ae573b8f823981d03e9e7ad4b76b2ffba}\label{sntp__client_8c_ae573b8f823981d03e9e7ad4b76b2ffba}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Get\+Timestamp@{sntp\+Client\+Get\+Timestamp}}
\index{sntp\+Client\+Get\+Timestamp@{sntp\+Client\+Get\+Timestamp}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Get\+Timestamp()}{sntpClientGetTimestamp()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} sntp\+Client\+Get\+Timestamp (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{ntp__common_8h_a4b0bee470029fbe2a20b9d804bd15ab5}{Ntp\+Timestamp} $\ast$}]{timestamp }\end{DoxyParamCaption})}



Retrieve current time from N\+TP server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\mbox{\tt out}  & {\em timestamp} & Pointer to the N\+TP timestamp \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 154 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
156 \{
157    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
158 
159    \textcolor{comment}{//Check parameters}
160    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || timestamp == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
161       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
162 
163    \textcolor{comment}{//Initialize status code}
164    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
165 
166    \textcolor{comment}{//Send NTP request and wait for server's response}
167    \textcolor{keywordflow}{while}(!error)
168    \{
169       \textcolor{comment}{//Check current state}
170       \textcolor{keywordflow}{if}(context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} == \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadeaf66512e95acb1f896d3e35d5a9aa5}{SNTP\_CLIENT\_STATE\_INIT})
171       \{
172          \textcolor{comment}{//Open UDP socket}
173          error = \hyperlink{sntp__client__misc_8c_a73106b6ab0a614ff867c1d9c8b03f16a}{sntpClientOpenConnection}(context);
174 
175          \textcolor{comment}{//Check status code}
176          \textcolor{keywordflow}{if}(!error)
177          \{
178             \textcolor{comment}{//Save current time}
179             context->\hyperlink{structSntpClientContext_ae6aa657a6ac2d5a76fc8e026066fa77c}{startTime} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
180             \textcolor{comment}{//Initialize retransmission timeout}
181             context->\hyperlink{structSntpClientContext_a09a8ebb9934b44dfbcca76edab7ceb76}{retransmitTimeout} = 
      \hyperlink{sntp__client_8h_a28011e97877f721b80691cbcf2de2526}{SNTP\_CLIENT\_INIT\_RETRANSMIT\_TIMEOUT};
182 
183             \textcolor{comment}{//Send the request to the designated NTP server}
184             context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} = \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadf9aa7041528b41d59b6b8e3604a18a0}{SNTP\_CLIENT\_STATE\_SENDING};
185          \}
186       \}
187       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} == \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadf9aa7041528b41d59b6b8e3604a18a0}{SNTP\_CLIENT\_STATE\_SENDING})
188       \{
189          \textcolor{comment}{//Send the request to the designated NTP server}
190          error = \hyperlink{sntp__client__misc_8c_a6c9f4f0e97e4f052300b253bcb01dc0f}{sntpClientSendRequest}(context);
191       \}
192       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} == \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dae3843b94899523529e54c4ae1222353c}{SNTP\_CLIENT\_STATE\_RECEIVING})
193       \{
194          \textcolor{comment}{//Wait for server's response}
195          error = \hyperlink{sntp__client__misc_8c_a483ec1f91330a633b15832853c5416d6}{sntpClientReceiveResponse}(context);
196       \}
197       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} == \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136da6d083d60c47f1d0fadbb8db705aa8820}{SNTP\_CLIENT\_STATE\_COMPLETE})
198       \{
199          \textcolor{comment}{//Extract NTP timestamp from server's response}
200          error = \hyperlink{sntp__client__misc_8c_ae58e62ccf938f6dee79f204404d8a642}{sntpClientParseResponse}(context, timestamp);
201 
202          \textcolor{comment}{//Revert to default state}
203          context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} = \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadeaf66512e95acb1f896d3e35d5a9aa5}{SNTP\_CLIENT\_STATE\_INIT};
204          \textcolor{keywordflow}{break};
205       \}
206       \textcolor{keywordflow}{else}
207       \{
208          \textcolor{comment}{//Invalid state}
209          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac3190fa1f36c6acf147c7ce453a655e2}{ERROR\_WRONG\_STATE};
210       \}
211    \}
212 
213    \textcolor{comment}{//Check status code}
214    \textcolor{keywordflow}{if}(error != \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK})
215    \{
216       \textcolor{comment}{//Close UDP socket}
217       \hyperlink{sntp__client__misc_8c_af495d67158e5920dd0b555f041c39edd}{sntpClientCloseConnection}(context);
218       \textcolor{comment}{//Revert to default state}
219       context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} = \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadeaf66512e95acb1f896d3e35d5a9aa5}{SNTP\_CLIENT\_STATE\_INIT};
220    \}
221 
222    \textcolor{comment}{//Return status code}
223    \textcolor{keywordflow}{return} error;
224 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_a83ada394f7028e6469d6aebeddafa6f6}\label{sntp__client_8c_a83ada394f7028e6469d6aebeddafa6f6}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Init@{sntp\+Client\+Init}}
\index{sntp\+Client\+Init@{sntp\+Client\+Init}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Init()}{sntpClientInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} sntp\+Client\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Initialize S\+N\+TP client context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 55 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
56 \{
57    \textcolor{comment}{//Make sure the SNTP client context is valid}
58    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
59       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
60 
61    \textcolor{comment}{//Clear SNTP client context}
62    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSntpClientContext}{SntpClientContext}));
63 
64    \textcolor{comment}{//Initialize SNTP client state}
65    context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} = \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadeaf66512e95acb1f896d3e35d5a9aa5}{SNTP\_CLIENT\_STATE\_INIT};
66 
67    \textcolor{comment}{//Default timeout}
68    context->\hyperlink{structSntpClientContext_aeaec29fda82d9d620c9078d06a4d7b17}{timeout} = \hyperlink{sntp__client_8h_adb27f0db13fad7d60a47e6e980c3d833}{SNTP\_CLIENT\_DEFAULT\_TIMEOUT};
69 
70    \textcolor{comment}{//Successful initialization}
71    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
72 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_aba383e624ebca9fe3d08922e84af7b70}\label{sntp__client_8c_aba383e624ebca9fe3d08922e84af7b70}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Set\+Server\+Addr@{sntp\+Client\+Set\+Server\+Addr}}
\index{sntp\+Client\+Set\+Server\+Addr@{sntp\+Client\+Set\+Server\+Addr}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Set\+Server\+Addr()}{sntpClientSetServerAddr()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} sntp\+Client\+Set\+Server\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{server\+Ip\+Addr,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{server\+Port }\end{DoxyParamCaption})}



Specify the IP address of the N\+TP server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\mbox{\tt in}  & {\em server\+Ip\+Addr} & IP address of the N\+TP server \\
\hline
\mbox{\tt in}  & {\em server\+Port} & Port number \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 126 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
128 \{
129    \textcolor{comment}{//Check parameters}
130    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || serverIpAddr == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
131       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
132 
133    \textcolor{comment}{//Save the IP address and the port number of the NTP server}
134    context->\hyperlink{structSntpClientContext_a28000ab694ab2426a9cba5958e77cd2e}{serverIpAddr} = *serverIpAddr;
135    context->\hyperlink{structSntpClientContext_aea4ed19ae27784311580a393fe350705}{serverPort} = serverPort;
136 
137    \textcolor{comment}{//Close UDP socket}
138    \hyperlink{sntp__client__misc_8c_af495d67158e5920dd0b555f041c39edd}{sntpClientCloseConnection}(context);
139    \textcolor{comment}{//Revert to default state}
140    context->\hyperlink{structSntpClientContext_af141be1c1ac01635b9788482dc791184}{state} = \hyperlink{sntp__client_8h_aeca73741bdca77b9eb50411f0c77136dadeaf66512e95acb1f896d3e35d5a9aa5}{SNTP\_CLIENT\_STATE\_INIT};
141 
142    \textcolor{comment}{//Successful processing}
143    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
144 \}
\end{DoxyCode}
\mbox{\Hypertarget{sntp__client_8c_aac476c8cc5a40969b0e1899a609680a1}\label{sntp__client_8c_aac476c8cc5a40969b0e1899a609680a1}} 
\index{sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}!sntp\+Client\+Set\+Timeout@{sntp\+Client\+Set\+Timeout}}
\index{sntp\+Client\+Set\+Timeout@{sntp\+Client\+Set\+Timeout}!sntp\+\_\+client.\+c@{sntp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{sntp\+Client\+Set\+Timeout()}{sntpClientSetTimeout()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} sntp\+Client\+Set\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{structSntpClientContext}{Sntp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{timeout }\end{DoxyParamCaption})}



Set communication timeout. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+TP client context \\
\hline
\mbox{\tt in}  & {\em timeout} & Timeout value, in milliseconds \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 82 of file sntp\+\_\+client.\+c.


\begin{DoxyCode}
83 \{
84    \textcolor{comment}{//Make sure the SNTP client context is valid}
85    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
86       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
87 
88    \textcolor{comment}{//Save timeout value}
89    context->\hyperlink{structSntpClientContext_aeaec29fda82d9d620c9078d06a4d7b17}{timeout} = timeout;
90 
91    \textcolor{comment}{//Successful processing}
92    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
93 \}
\end{DoxyCode}
