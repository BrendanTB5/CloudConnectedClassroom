\hypertarget{http__client__misc_8c}{}\section{cyclone\+\_\+tcp/http/http\+\_\+client\+\_\+misc.c File Reference}
\label{http__client__misc_8c}\index{cyclone\+\_\+tcp/http/http\+\_\+client\+\_\+misc.\+c@{cyclone\+\_\+tcp/http/http\+\_\+client\+\_\+misc.\+c}}


Helper functions for H\+T\+TP client.  


{\ttfamily \#include $<$limits.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+client\+\_\+auth.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+client\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{http__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ace1dd0cc4628f20c72a1d8dc9612d2f1}{H\+T\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{http__client__misc_8c_a8bbfa406f6709331e632d23b37acfed8}{http\+Client\+Change\+State} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, \hyperlink{http__client_8h_a467beb99e0cff97a16b2ef23a0aaf8c5}{Http\+Client\+State} new\+State)
\begin{DoxyCompactList}\small\item\em Update H\+T\+TP client state. \end{DoxyCompactList}\item 
void \hyperlink{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}{http\+Client\+Change\+Request\+State} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671}{Http\+Request\+State} new\+State)
\begin{DoxyCompactList}\small\item\em Update H\+T\+TP request state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a4f91ec49f3492fdd4a25d60fbdd8ca7e}{http\+Client\+Format\+Request\+Header} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Format default H\+T\+TP request header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a6f213287a2c06305dbc6fb54a0499717}{http\+Client\+Format\+Chunk\+Size} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format chunk-\/size field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a94226ee3da9cacad849bf1c496f27b28}{http\+Client\+Parse\+Status\+Line} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$line, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse H\+T\+TP status line. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a210eb38eb3fc05a92e45cdce6c7e6bd8}{http\+Client\+Parse\+Header\+Field} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$line, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse H\+T\+TP response header field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a8b9e472b34f513a22786c41294e9bed2}{http\+Client\+Parse\+Connection\+Field} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Parse Connection header field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_adc1038f243e8d48570fe633f7098c4f8}{http\+Client\+Parse\+Transfer\+Encoding\+Field} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Parse Transfer-\/\+Encoding header field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_a3fafda6f1465f5e64086966e3dd20a65}{http\+Client\+Parse\+Content\+Length\+Field} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Parse Content-\/\+Length header field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_ac12d2dfafc67c9cb2251ce8d376730d3}{http\+Client\+Parse\+Chunk\+Size} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$line, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse chunk-\/size field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{http__client__misc_8c_aea8887260715dbe6c37a90576776fdfc}{http\+Client\+Check\+Timeout} (\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Determine whether a timeout error has occurred. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Helper functions for H\+T\+TP client. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{http__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{http__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ace1dd0cc4628f20c72a1d8dc9612d2f1}{H\+T\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file http\+\_\+client\+\_\+misc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}\label{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Change\+Request\+State@{http\+Client\+Change\+Request\+State}}
\index{http\+Client\+Change\+Request\+State@{http\+Client\+Change\+Request\+State}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Change\+Request\+State()}{httpClientChangeRequestState()}}
{\footnotesize\ttfamily void http\+Client\+Change\+Request\+State (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671}{Http\+Request\+State}}]{new\+State }\end{DoxyParamCaption})}



Update H\+T\+TP request state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\end{DoxyParams}


Definition at line 72 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
74 \{
75    \textcolor{comment}{//Update HTTP request state}
76    context->requestState = newState;
77 
78    \textcolor{comment}{//Save current time}
79    context->timestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
80 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a8bbfa406f6709331e632d23b37acfed8}\label{http__client__misc_8c_a8bbfa406f6709331e632d23b37acfed8}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Change\+State@{http\+Client\+Change\+State}}
\index{http\+Client\+Change\+State@{http\+Client\+Change\+State}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Change\+State()}{httpClientChangeState()}}
{\footnotesize\ttfamily void http\+Client\+Change\+State (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{http__client_8h_a467beb99e0cff97a16b2ef23a0aaf8c5}{Http\+Client\+State}}]{new\+State }\end{DoxyParamCaption})}



Update H\+T\+TP client state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\end{DoxyParams}


Definition at line 55 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
57 \{
58    \textcolor{comment}{//Update HTTP connnection state}
59    context->state = newState;
60 
61    \textcolor{comment}{//Save current time}
62    context->timestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
63 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_aea8887260715dbe6c37a90576776fdfc}\label{http__client__misc_8c_aea8887260715dbe6c37a90576776fdfc}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Check\+Timeout@{http\+Client\+Check\+Timeout}}
\index{http\+Client\+Check\+Timeout@{http\+Client\+Check\+Timeout}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Check\+Timeout()}{httpClientCheckTimeout()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Check\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Determine whether a timeout error has occurred. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 585 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
586 \{
587 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == DISABLED)}
588    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
589    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
590 
591    \textcolor{comment}{//Get current time}
592    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
593 
594    \textcolor{comment}{//Check whether the timeout has elapsed}
595    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
596    \{
597       \textcolor{comment}{//Report a timeout error}
598       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
599    \}
600    \textcolor{keywordflow}{else}
601    \{
602       \textcolor{comment}{//The operation would block}
603       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK};
604    \}
605 
606    \textcolor{comment}{//Return status code}
607    \textcolor{keywordflow}{return} error;
608 \textcolor{preprocessor}{#else}
609    \textcolor{comment}{//Report a timeout error}
610    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
611 \textcolor{preprocessor}{#endif}
612 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a6f213287a2c06305dbc6fb54a0499717}\label{http__client__misc_8c_a6f213287a2c06305dbc6fb54a0499717}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Format\+Chunk\+Size@{http\+Client\+Format\+Chunk\+Size}}
\index{http\+Client\+Format\+Chunk\+Size@{http\+Client\+Format\+Chunk\+Size}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Format\+Chunk\+Size()}{httpClientFormatChunkSize()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Format\+Chunk\+Size (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Format chunk-\/size field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em length} & Size of the chunk \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 155 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
156 \{
157    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
158 
159    \textcolor{comment}{//The chunked encoding modifies the body in order to transfer it as a}
160    \textcolor{comment}{//series of chunks, each with its own size indicator}
161    context->bodyLen = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
162    context->bodyPos = 0;
163 
164    \textcolor{comment}{//Check whether the chunk is the first one or not}
165    \textcolor{keywordflow}{if}(context->requestState == \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671ac9eaf361a36f169f32dcbcc4e6fceaa6}{HTTP\_REQ\_STATE\_SEND\_CHUNK\_DATA})
166    \{
167       \textcolor{comment}{//Terminate the data of the previous chunk with a CRLF sequence}
168       n += sprintf(context->buffer + n, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
169    \}
170 
171    \textcolor{comment}{//The chunk-size field is a string of hex digits indicating the size of the}
172    \textcolor{comment}{//chunk}
173    n += sprintf(context->buffer + n, \textcolor{stringliteral}{"%"} \hyperlink{compiler__port_8h_a385953a41ad62409d9edb642607e468f}{PRIXSIZE} \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
174 
175    \textcolor{comment}{//Check whether the chunk is the last one}
176    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == 0)
177    \{
178       \textcolor{comment}{//The trailer allows the sender to include additional HTTP header fields}
179       \textcolor{comment}{//at the end of the message. The trailer is terminated with a CRLF}
180       n += sprintf(context->buffer + n, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
181    \}
182 
183    \textcolor{comment}{//Set the length of the chunk-size field}
184    context->bufferLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
185    context->bufferPos = 0;
186 
187    \textcolor{comment}{//The chunked encoding is ended by any chunk whose size is zero}
188    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == 0)
189    \{
190       \textcolor{comment}{//The last chunk is followed by an optional trailer}
191       \hyperlink{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}{httpClientChangeRequestState}(context, 
      \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671a59a40d0faad7f72e050bfc3e638ab188}{HTTP\_REQ\_STATE\_FORMAT\_TRAILER});
192    \}
193    \textcolor{keywordflow}{else}
194    \{
195       \textcolor{comment}{//Send the chunk-size field}
196       \hyperlink{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}{httpClientChangeRequestState}(context, 
      \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671a1658572c4a34a7fe051e89d9fb6498ca}{HTTP\_REQ\_STATE\_SEND\_CHUNK\_SIZE});
197    \}
198 
199    \textcolor{comment}{//Successful processing}
200    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
201 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a4f91ec49f3492fdd4a25d60fbdd8ca7e}\label{http__client__misc_8c_a4f91ec49f3492fdd4a25d60fbdd8ca7e}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Format\+Request\+Header@{http\+Client\+Format\+Request\+Header}}
\index{http\+Client\+Format\+Request\+Header@{http\+Client\+Format\+Request\+Header}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Format\+Request\+Header()}{httpClientFormatRequestHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Format\+Request\+Header (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Format default H\+T\+TP request header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 89 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
90 \{
91    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
92    \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version};
93 
94    \textcolor{comment}{//Check HTTP version}
95    \textcolor{keywordflow}{if}(context->version == \hyperlink{http__common_8h_ac870fd261da652aee69937751c6f7e7fa3932308db22120ce049dd60f3430b814}{HTTP\_VERSION\_1\_0})
96    \{
97       \textcolor{comment}{//Select protocol version 1.0}
98       version = \textcolor{stringliteral}{"HTTP/1.0"};
99 
100       \textcolor{comment}{//Under HTTP/1.0, connections are not considered persistent unless a}
101       \textcolor{comment}{//keepalive header is included}
102       context->keepAlive = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
103 
104       \textcolor{comment}{//a persistent connection with an HTTP/1.0 client cannot make use of}
105       \textcolor{comment}{//the chunked transfer-coding, and therefore must use a Content-Length}
106       \textcolor{comment}{//for marking the ending boundary of each message (refer to RFC 2068,}
107       \textcolor{comment}{//section 19.7.1)}
108       context->chunkedEncoding = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
109    \}
110    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->version == \hyperlink{http__common_8h_ac870fd261da652aee69937751c6f7e7faf1a34119b438038bc609a273f9bc08c6}{HTTP\_VERSION\_1\_1})
111    \{
112       \textcolor{comment}{//Select protocol version 1.1}
113       version = \textcolor{stringliteral}{"HTTP/1.1"};
114 
115       \textcolor{comment}{//In HTTP/1.1, all connections are considered persistent unless declared}
116       \textcolor{comment}{//otherwise}
117       context->keepAlive = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
118 
119       \textcolor{comment}{//The chunked encoding modifies the body of a message in order to transfer}
120       \textcolor{comment}{//it as a series of chunks, each with its own size indicator}
121       context->chunkedEncoding = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
122    \}
123    \textcolor{keywordflow}{else}
124    \{
125       \textcolor{comment}{//Unknown HTTP version}
126       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
127    \}
128 
129    \textcolor{comment}{//Set default HTTP request method}
130    strcpy(context->method, \textcolor{stringliteral}{"GET"});
131 
132    \textcolor{comment}{//The Request-Line begins with a method token, followed by the Request-URI}
133    \textcolor{comment}{//and the protocol version, and ending with CRLF}
134    n = sprintf(context->buffer, \textcolor{stringliteral}{"GET / %s\(\backslash\)r\(\backslash\)n"}, version);
135 
136    \textcolor{comment}{//Terminate the HTTP request header with a CRLF sequence}
137    n += sprintf(context->buffer + n, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
138 
139    \textcolor{comment}{//Set the length of the request header}
140    context->bufferLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
141    context->bufferPos = 0;
142 
143    \textcolor{comment}{//Successful processing}
144    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
145 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_ac12d2dfafc67c9cb2251ce8d376730d3}\label{http__client__misc_8c_ac12d2dfafc67c9cb2251ce8d376730d3}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Chunk\+Size@{http\+Client\+Parse\+Chunk\+Size}}
\index{http\+Client\+Parse\+Chunk\+Size@{http\+Client\+Parse\+Chunk\+Size}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Chunk\+Size()}{httpClientParseChunkSize()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Chunk\+Size (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{line,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse chunk-\/size field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em line} & Pointer to the chunk-\/size field \\
\hline
\mbox{\tt in}  & {\em length} & Length of the chunk-\/size field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 538 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
540 \{
541    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
542 
543    \textcolor{comment}{//Properly terminate the string with a NULL character}
544    line[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}] = \textcolor{charliteral}{'\(\backslash\)0'};
545 
546    \textcolor{comment}{//Remove leading and trailing whitespace}
547    line = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(line);
548 
549    \textcolor{comment}{//The chunk-size field is a string of hex digits indicating the size}
550    \textcolor{comment}{//of the chunk}
551    context->bodyLen = strtoul(line, &p, 16);
552 
553    \textcolor{comment}{//Any parsing error?}
554    \textcolor{keywordflow}{if}(*p != \textcolor{charliteral}{'\(\backslash\)0'})
555       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
556 
557    \textcolor{comment}{//Flush receive buffer}
558    context->bufferLen = 0;
559    context->bufferPos = 0;
560    context->bodyPos = 0;
561 
562    \textcolor{comment}{//The chunked encoding is ended by any chunk whose size is zero}
563    \textcolor{keywordflow}{if}(context->bodyLen == 0)
564    \{
565       \textcolor{comment}{//The last chunk is followed by an optional trailer}
566       \hyperlink{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}{httpClientChangeRequestState}(context, 
      \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671abe0376963cfae76ec97eb7d9548db2a8}{HTTP\_REQ\_STATE\_RECEIVE\_TRAILER});
567    \}
568    \textcolor{keywordflow}{else}
569    \{
570       \textcolor{comment}{//Receive chunk data}
571       \hyperlink{http__client__misc_8c_ab939b547ad8d46c74d994acc2d0eae67}{httpClientChangeRequestState}(context, 
      \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671ac5f01fe75ddc6a2ddc4ec9e79e5a4cdd}{HTTP\_REQ\_STATE\_RECEIVE\_CHUNK\_DATA});
572    \}
573 
574    \textcolor{comment}{//Successful processing}
575    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
576 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a8b9e472b34f513a22786c41294e9bed2}\label{http__client__misc_8c_a8b9e472b34f513a22786c41294e9bed2}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Connection\+Field@{http\+Client\+Parse\+Connection\+Field}}
\index{http\+Client\+Parse\+Connection\+Field@{http\+Client\+Parse\+Connection\+Field}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Connection\+Field()}{httpClientParseConnectionField()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Connection\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Parse Connection header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em value} & N\+U\+L\+L-\/terminated string that contains the field value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 426 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
428 \{
429    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
430 
431    \textcolor{comment}{//Parse the comma-separated list}
432    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}[0] != \textcolor{charliteral}{'\(\backslash\)0'})
433    \{
434       \textcolor{comment}{//Get the length of the current token}
435       n = strcspn(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{", \(\backslash\)t"});
436 
437       \textcolor{comment}{//Check current value}
438       \textcolor{keywordflow}{if}(n == 10 && !\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{"keep-alive"}, 10))
439       \{
440          \textcolor{comment}{//Check HTTP request state}
441          \textcolor{keywordflow}{if}(context->requestState == \hyperlink{http__common_8h_a4fe74ac4ac2fba01b65f71b093977671a2db1c4a85881214f94b34ba8c9a69901}{HTTP\_REQ\_STATE\_FORMAT\_HEADER})
442          \{
443             \textcolor{comment}{//Make the connection persistent}
444             context->keepAlive = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
445          \}
446       \}
447       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n == 5 && !\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{"close"}, 5))
448       \{
449          \textcolor{comment}{//The connection will be closed after completion of the response}
450          context->keepAlive = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
451       \}
452       \textcolor{keywordflow}{else}
453       \{
454          \textcolor{comment}{//Just for sanity}
455       \}
456 
457       \textcolor{comment}{//Advance the pointer over the separator}
458       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}[n] != \textcolor{charliteral}{'\(\backslash\)0'})
459          n++;
460 
461       \textcolor{comment}{//Point to the next token}
462       \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
463    \}
464 
465    \textcolor{comment}{//Successful processing}
466    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
467 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a3fafda6f1465f5e64086966e3dd20a65}\label{http__client__misc_8c_a3fafda6f1465f5e64086966e3dd20a65}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Content\+Length\+Field@{http\+Client\+Parse\+Content\+Length\+Field}}
\index{http\+Client\+Parse\+Content\+Length\+Field@{http\+Client\+Parse\+Content\+Length\+Field}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Content\+Length\+Field()}{httpClientParseContentLengthField()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Content\+Length\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Parse Content-\/\+Length header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em value} & N\+U\+L\+L-\/terminated string that contains the field value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 507 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
509 \{
510    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
511 
512    \textcolor{comment}{//If a valid Content-Length header field is present without}
513    \textcolor{comment}{//Transfer-Encoding, its decimal value defines the expected message}
514    \textcolor{comment}{//body length in octets (refer to RFC 7230, section 3.3.3)}
515    \textcolor{keywordflow}{if}(!context->chunkedEncoding)
516    \{
517       \textcolor{comment}{//Retrieve the length of the body}
518       context->bodyLen = strtoul(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, &p, 10);
519 
520       \textcolor{comment}{//Any parsing error?}
521       \textcolor{keywordflow}{if}(*p != \textcolor{charliteral}{'\(\backslash\)0'})
522          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
523    \}
524 
525    \textcolor{comment}{//Successful processing}
526    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
527 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a210eb38eb3fc05a92e45cdce6c7e6bd8}\label{http__client__misc_8c_a210eb38eb3fc05a92e45cdce6c7e6bd8}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Header\+Field@{http\+Client\+Parse\+Header\+Field}}
\index{http\+Client\+Parse\+Header\+Field@{http\+Client\+Parse\+Header\+Field}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Header\+Field()}{httpClientParseHeaderField()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Header\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{line,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse H\+T\+TP response header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em line} & Pointer to the header field \\
\hline
\mbox{\tt in}  & {\em length} & Length of the header field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 296 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
298 \{
299    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
300    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name};
301    \textcolor{keywordtype}{size\_t} nameLen;
302    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
303    \textcolor{keywordtype}{size\_t} valueLen;
304    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *separator;
305 
306    \textcolor{comment}{//Properly terminate the string with a NULL character}
307    line[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}] = \textcolor{charliteral}{'\(\backslash\)0'};
308 
309    \textcolor{comment}{//Debug message}
310    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s\(\backslash\)r\(\backslash\)n"}, line);
311 
312    \textcolor{comment}{//The string must contains visible characters only}
313    error = \hyperlink{http__common_8c_a313bafa3f1b1282d9ea5840b9b92106d}{httpCheckCharset}(line, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{http__common_8h_abc57c1c7b98b6738bb22e7a6287d7974ac04511c564b94df9730470a462d86edc}{HTTP\_CHARSET\_TEXT});
314    \textcolor{comment}{//Any error to report?}
315    \textcolor{keywordflow}{if}(error)
316       \textcolor{keywordflow}{return} error;
317 
318    \textcolor{comment}{//Header field values can be folded onto multiple lines if the continuation}
319    \textcolor{comment}{//line begins with a space or horizontal tab}
320    \textcolor{keywordflow}{if}(line[0] == \textcolor{charliteral}{' '} || line[0] == \textcolor{charliteral}{'\(\backslash\)t'})
321    \{
322       \textcolor{comment}{//A continuation line cannot immediately follows the Status-Line}
323       \textcolor{keywordflow}{if}(context->bufferPos == 0)
324          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
325 
326       \textcolor{comment}{//Remove optional leading and trailing whitespace}
327       value = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(line);
328       \textcolor{comment}{//Retrieve the length of the resulting string}
329       valueLen = strlen(value);
330 
331       \textcolor{comment}{//Sanity check}
332       \textcolor{keywordflow}{if}(valueLen > 0)
333       \{
334          \textcolor{comment}{//The folding LWS is replaced with a single SP before interpretation}
335          \textcolor{comment}{//of the TEXT value (refer to RFC 2616, section 2.2)}
336          context->buffer[context->bufferPos - 1] = \textcolor{charliteral}{' '};
337 
338          \textcolor{comment}{//Save field value}
339          memmove(context->buffer + context->bufferPos, value, valueLen + 1);
340 
341          \textcolor{comment}{//Update the size of the hash table}
342          context->bufferLen = context->bufferPos + valueLen + 1;
343       \}
344    \}
345    \textcolor{keywordflow}{else}
346    \{
347       \textcolor{comment}{//Each header field consists of a case-insensitive field name followed}
348       \textcolor{comment}{//by a colon, optional leading whitespace, the field value, and optional}
349       \textcolor{comment}{//trailing whitespace (refer to RFC 7230, section 3.2)}
350       separator = strchr(line, \textcolor{charliteral}{':'});
351 
352       \textcolor{comment}{//Any parsing error?}
353       \textcolor{keywordflow}{if}(separator == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
354          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
355 
356       \textcolor{comment}{//Split the line}
357       *separator = \textcolor{charliteral}{'\(\backslash\)0'};
358 
359       \textcolor{comment}{//Remove optional leading and trailing whitespace}
360       name = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(line);
361       value = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(separator + 1);
362 
363       \textcolor{comment}{//Retrieve the length of the resulting strings}
364       nameLen = strlen(name);
365       valueLen = strlen(value);
366 
367       \textcolor{comment}{//The field name cannot be empty}
368       \textcolor{keywordflow}{if}(nameLen == 0)
369          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
370 
371       \textcolor{comment}{//Check header field name}
372       \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"Connection"}))
373       \{
374          \textcolor{comment}{//Parse Connection header field}
375          \hyperlink{http__client__misc_8c_a8b9e472b34f513a22786c41294e9bed2}{httpClientParseConnectionField}(context, value);
376       \}
377       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"Transfer-Encoding"}))
378       \{
379          \textcolor{comment}{//Parse Transfer-Encoding header field}
380          \hyperlink{http__client__misc_8c_adc1038f243e8d48570fe633f7098c4f8}{httpClientParseTransferEncodingField}(context, value);
381       \}
382       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"Content-Length"}))
383       \{
384          \textcolor{comment}{//Parse Content-Length header field}
385          \hyperlink{http__client__misc_8c_a3fafda6f1465f5e64086966e3dd20a65}{httpClientParseContentLengthField}(context, value);
386       \}
387 \textcolor{preprocessor}{#if (HTTP\_CLIENT\_AUTH\_SUPPORT == ENABLED)}
388       \textcolor{comment}{//WWW-Authenticate header field found?}
389       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"WWW-Authenticate"}))
390       \{
391          \textcolor{comment}{//Parse WWW-Authenticate header field}
392          \hyperlink{http__client__auth_8c_a7d7a46a9c5bfb55aebf9afd6124a12ee}{httpClientParseWwwAuthenticateField}(context, value);
393       \}
394 \textcolor{preprocessor}{#endif}
395       \textcolor{keywordflow}{else}
396       \{
397          \textcolor{comment}{//Discard unknown header fields}
398       \}
399 
400       \textcolor{comment}{//Save each header field into a hash table by field name}
401       memmove(context->buffer + context->bufferPos, name, nameLen + 1);
402 
403       \textcolor{comment}{//Save field value}
404       memmove(context->buffer + context->bufferPos + nameLen + 1, value,
405          valueLen + 1);
406 
407       \textcolor{comment}{//Update the size of the hash table}
408       context->bufferLen = context->bufferPos + nameLen + valueLen + 2;
409    \}
410 
411    \textcolor{comment}{//Decode the next header field}
412    context->bufferPos = context->bufferLen;
413 
414    \textcolor{comment}{//Successful processing}
415    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
416 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_a94226ee3da9cacad849bf1c496f27b28}\label{http__client__misc_8c_a94226ee3da9cacad849bf1c496f27b28}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Status\+Line@{http\+Client\+Parse\+Status\+Line}}
\index{http\+Client\+Parse\+Status\+Line@{http\+Client\+Parse\+Status\+Line}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Status\+Line()}{httpClientParseStatusLine()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Status\+Line (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{line,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse H\+T\+TP status line. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em line} & Pointer to the status line \\
\hline
\mbox{\tt in}  & {\em length} & Length of the status line \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 212 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
214 \{
215    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
216    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
217    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{coap__common_8h_aaa0137cdddb344591e20a2930a1ba54d}{token};
218 
219    \textcolor{comment}{//Properly terminate the string with a NULL character}
220    line[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}] = \textcolor{charliteral}{'\(\backslash\)0'};
221 
222    \textcolor{comment}{//Debug message}
223    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"HTTP response header:\(\backslash\)r\(\backslash\)n%s\(\backslash\)r\(\backslash\)n"}, line);
224 
225    \textcolor{comment}{//The string must contains visible characters only}
226    error = \hyperlink{http__common_8c_a313bafa3f1b1282d9ea5840b9b92106d}{httpCheckCharset}(line, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{http__common_8h_abc57c1c7b98b6738bb22e7a6287d7974ac04511c564b94df9730470a462d86edc}{HTTP\_CHARSET\_TEXT});
227    \textcolor{comment}{//Any error to report?}
228    \textcolor{keywordflow}{if}(error)
229       \textcolor{keywordflow}{return} error;
230 
231    \textcolor{comment}{//Parse HTTP-Version field}
232    token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(line, \textcolor{stringliteral}{" "}, &p);
233    \textcolor{comment}{//Any parsing error?}
234    \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
235       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
236 
237    \textcolor{comment}{//Check protocol version}
238    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"HTTP/1.0"}))
239    \{
240       \textcolor{comment}{//Under HTTP/1.0, connections are not considered persistent unless a}
241       \textcolor{comment}{//keepalive header is included}
242       context->keepAlive = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
243    \}
244    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"HTTP/1.1"}))
245    \{
246       \textcolor{comment}{//In HTTP/1.1, all connections are considered persistent unless declared}
247       \textcolor{comment}{//otherwise}
248       \textcolor{keywordflow}{if}(context->version != \hyperlink{http__common_8h_ac870fd261da652aee69937751c6f7e7faf1a34119b438038bc609a273f9bc08c6}{HTTP\_VERSION\_1\_1})
249          context->keepAlive = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
250    \}
251    \textcolor{keywordflow}{else}
252    \{
253       \textcolor{comment}{//Unknown HTTP version}
254       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
255    \}
256 
257    \textcolor{comment}{//Parse Status-Code field}
258    token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{" "}, &p);
259    \textcolor{comment}{//Any parsing error?}
260    \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
261       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
262 
263    \textcolor{comment}{//The Status-Code element is a 3-digit integer}
264    context->statusCode = strtoul(token, &p, 10);
265    \textcolor{comment}{//Any parsing error?}
266    \textcolor{keywordflow}{if}(*p != \textcolor{charliteral}{'\(\backslash\)0'})
267       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
268 
269    \textcolor{comment}{//The chunked encoding modifies the body of a message in order to transfer}
270    \textcolor{comment}{//it as a series of chunks, each with its own size indicator}
271    context->chunkedEncoding = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
272 
273    \textcolor{comment}{//For response message without a declared message body length, the message}
274    \textcolor{comment}{//body length is determined by the number of octets received prior to the}
275    \textcolor{comment}{//server closing the connection}
276    context->bodyLen = UINT\_MAX;
277 
278    \textcolor{comment}{//Flush receive buffer}
279    context->bufferLen = 0;
280    context->bufferPos = 0;
281    context->bodyPos = 0;
282 
283    \textcolor{comment}{//Successful processing}
284    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
285 \}
\end{DoxyCode}
\mbox{\Hypertarget{http__client__misc_8c_adc1038f243e8d48570fe633f7098c4f8}\label{http__client__misc_8c_adc1038f243e8d48570fe633f7098c4f8}} 
\index{http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}!http\+Client\+Parse\+Transfer\+Encoding\+Field@{http\+Client\+Parse\+Transfer\+Encoding\+Field}}
\index{http\+Client\+Parse\+Transfer\+Encoding\+Field@{http\+Client\+Parse\+Transfer\+Encoding\+Field}!http\+\_\+client\+\_\+misc.\+c@{http\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{http\+Client\+Parse\+Transfer\+Encoding\+Field()}{httpClientParseTransferEncodingField()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} http\+Client\+Parse\+Transfer\+Encoding\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{http__client_8h_a23a71e0fb25f8ecfe6a649b1375dd7ea}{Http\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Parse Transfer-\/\+Encoding header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the H\+T\+TP client context \\
\hline
\mbox{\tt in}  & {\em value} & N\+U\+L\+L-\/terminated string that contains the field value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 477 of file http\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
479 \{
480    \textcolor{comment}{//Check the value of the header field}
481    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{"chunked"}))
482    \{
483       \textcolor{comment}{//If a Transfer-Encoding header field is present and the chunked}
484       \textcolor{comment}{//transfer coding is the final encoding, the message body length}
485       \textcolor{comment}{//is determined by reading and decoding the chunked data until the}
486       \textcolor{comment}{//transfer coding indicates the data is complete}
487       context->chunkedEncoding = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
488 
489       \textcolor{comment}{//If a message is received with both a Transfer-Encoding and a}
490       \textcolor{comment}{//Content-Length header field, the Transfer-Encoding overrides}
491       \textcolor{comment}{//the Content-Length (refer to RFC 7230, section 3.3.3)}
492       context->bodyLen = 0;
493    \}
494 
495    \textcolor{comment}{//Successful processing}
496    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
497 \}
\end{DoxyCode}
