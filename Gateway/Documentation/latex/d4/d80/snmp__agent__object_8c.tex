\hypertarget{snmp__agent__object_8c}{}\section{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+object.c File Reference}
\label{snmp__agent__object_8c}\index{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+object.\+c@{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+object.\+c}}


M\+IB object access.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+object.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/asn1.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/oid.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{snmp__agent__object_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_af5cf34762d7114743a58dd8a05289bd9}{S\+N\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__object_8c_a7e9ab6bc8e4deb43d557591b0c4f987c}{snmp\+Set\+Object\+Value} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$var, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} commit)
\begin{DoxyCompactList}\small\item\em Assign object value. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmp\+Get\+Object\+Value} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$var)
\begin{DoxyCompactList}\small\item\em Retrieve object value. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__object_8c_a01bc5ecdf62fb0da7ef4fd888e87adb6}{snmp\+Get\+Next\+Object} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$var)
\begin{DoxyCompactList}\small\item\em Search M\+I\+Bs for the next object. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__object_8c_ad1873f721a1264eca1bd1f9fc6764f52}{snmp\+Find\+Mib\+Object} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, size\+\_\+t oid\+Len, const \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{Mib\+Object} $\ast$$\ast$object)
\begin{DoxyCompactList}\small\item\em Search M\+I\+Bs for the given object. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
M\+IB object access. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{snmp__agent__object_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{snmp__agent__object_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_af5cf34762d7114743a58dd8a05289bd9}{S\+N\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file snmp\+\_\+agent\+\_\+object.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{snmp__agent__object_8c_ad1873f721a1264eca1bd1f9fc6764f52}\label{snmp__agent__object_8c_ad1873f721a1264eca1bd1f9fc6764f52}} 
\index{snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}!snmp\+Find\+Mib\+Object@{snmp\+Find\+Mib\+Object}}
\index{snmp\+Find\+Mib\+Object@{snmp\+Find\+Mib\+Object}!snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}}
\subsubsection{\texorpdfstring{snmp\+Find\+Mib\+Object()}{snmpFindMibObject()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Find\+Mib\+Object (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{oid,  }\item[{size\+\_\+t}]{oid\+Len,  }\item[{const \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{Mib\+Object} $\ast$$\ast$}]{object }\end{DoxyParamCaption})}



Search M\+I\+Bs for the given object. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em oid} & Object identifier \\
\hline
\mbox{\tt in}  & {\em oid\+Len} & Length of the O\+ID \\
\hline
\mbox{\tt out}  & {\em object} & Pointer the M\+IB object descriptor \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 682 of file snmp\+\_\+agent\+\_\+object.\+c.


\begin{DoxyCode}
684 \{
685    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
686    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} left;
687    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} right;
688    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} \hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid};
689    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
690    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
691    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
692    \textcolor{keyword}{const} \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{MibObject} *objects;
693 
694    \textcolor{comment}{//Initialize comparison result}
695    res = -1;
696 
697    \textcolor{comment}{//Loop through MIBs}
698    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS} && res != 0; i++)
699    \{
700       \textcolor{comment}{//Valid MIB?}
701       \textcolor{keywordflow}{if}(context->mibTable[i] != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} &&
702          context->mibTable[i]->numObjects > 0)
703       \{
704          \textcolor{comment}{//Point to the list of objects}
705          objects = context->mibTable[i]->objects;
706 
707          \textcolor{comment}{//Index of the first item}
708          left = 0;
709          \textcolor{comment}{//Index of the last item}
710          right = context->mibTable[i]->numObjects - 1;
711 
712          \textcolor{comment}{//Discard instance sub-identifier}
713          n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(oidLen, objects[right].oidLen);
714 
715          \textcolor{comment}{//Check object identifier}
716          \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, oidLen, objects[left].\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, objects[left].oidLen) >= 0 &&
717             \hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, n, objects[right].oid, objects[right].oidLen) <= 0)
718          \{
719             \textcolor{comment}{//Binary search algorithm}
720             \textcolor{keywordflow}{while}(left <= right && res != 0)
721             \{
722                \textcolor{comment}{//Calculate the index of the middle item}
723                mid = left + (right - left) / 2;
724 
725                \textcolor{comment}{//Discard instance sub-identifier}
726                n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(oidLen, objects[mid].oidLen);
727 
728                \textcolor{comment}{//Perform lexicographic comparison}
729                res = \hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, n, objects[mid].oid, objects[mid].oidLen);
730 
731                \textcolor{comment}{//Check the result of the comparison}
732                \textcolor{keywordflow}{if}(res > 0)
733                   left = mid + 1;
734                \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(res < 0)
735                   right = mid - 1;
736             \}
737          \}
738       \}
739    \}
740 
741    \textcolor{comment}{//Object identifier found?}
742    \textcolor{keywordflow}{if}(res == 0)
743    \{
744       \textcolor{comment}{//Scalar object?}
745       \textcolor{keywordflow}{if}(objects[mid].getNext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
746       \{
747          \textcolor{comment}{//The instance sub-identifier shall be 0 for scalar objects}
748          \textcolor{keywordflow}{if}(oidLen == (objects[mid].oidLen + 1) && oid[oidLen - 1] == 0)
749          \{
750             \textcolor{comment}{//Return a pointer to the matching object}
751             *\textcolor{keywordtype}{object} = &objects[\hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid}];
752             \textcolor{comment}{//No error to report}
753             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
754          \}
755          \textcolor{keywordflow}{else}
756          \{
757             \textcolor{comment}{//No such instance...}
758             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND};
759          \}
760       \}
761       \textcolor{comment}{//Tabular object?}
762       \textcolor{keywordflow}{else}
763       \{
764          \textcolor{comment}{//Check the length of the OID}
765          \textcolor{keywordflow}{if}(oidLen > objects[mid].oidLen)
766          \{
767             \textcolor{comment}{//Return a pointer to the matching object}
768             *\textcolor{keywordtype}{object} = &objects[\hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid}];
769             \textcolor{comment}{//No error to report}
770             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
771          \}
772          \textcolor{keywordflow}{else}
773          \{
774             \textcolor{comment}{//No such instance...}
775             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND};
776          \}
777       \}
778    \}
779    \textcolor{keywordflow}{else}
780    \{
781       \textcolor{comment}{//No such object...}
782       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
783    \}
784 
785    \textcolor{comment}{//Return status code}
786    \textcolor{keywordflow}{return} error;
787 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__object_8c_a01bc5ecdf62fb0da7ef4fd888e87adb6}\label{snmp__agent__object_8c_a01bc5ecdf62fb0da7ef4fd888e87adb6}} 
\index{snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}!snmp\+Get\+Next\+Object@{snmp\+Get\+Next\+Object}}
\index{snmp\+Get\+Next\+Object@{snmp\+Get\+Next\+Object}!snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}}
\subsubsection{\texorpdfstring{snmp\+Get\+Next\+Object()}{snmpGetNextObject()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Get\+Next\+Object (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$}]{message,  }\item[{\hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$}]{var }\end{DoxyParamCaption})}



Search M\+I\+Bs for the next object. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the received S\+N\+MP message \\
\hline
\mbox{\tt in}  & {\em var} & Variable binding \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error pointer 
\end{DoxyReturn}


Definition at line 424 of file snmp\+\_\+agent\+\_\+object.\+c.


\begin{DoxyCode}
426 \{
427    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
428    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
429    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
430    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
431    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} numObjects;
432    \textcolor{keywordtype}{size\_t} bufferLen;
433    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *curOid;
434    \textcolor{keywordtype}{size\_t} curOidLen;
435    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *nextOid;
436    \textcolor{keywordtype}{size\_t} nextOidLen;
437    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *tempOid;
438    \textcolor{keywordtype}{size\_t} tempOidLen;
439    \textcolor{keyword}{const} \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{MibObject} *object;
440    \textcolor{keyword}{const} \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{MibObject} *nextObject;
441 
442    \textcolor{comment}{//Initialize status code}
443    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
444 
445    \textcolor{comment}{//Calculate the length of the buffer}
446    bufferLen = context->response.varBindListMaxLen -
447       context->response.varBindListLen;
448 
449    \textcolor{comment}{//Initialize pointer}
450    nextObject = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
451 
452    \textcolor{comment}{//Buffer where to store the resulting OID}
453    nextOid = context->response.varBindList + context->response.varBindListLen;
454    nextOidLen = 0;
455 
456    \textcolor{comment}{//Loop through MIBs}
457    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
458    \{
459       \textcolor{comment}{//Valid MIB?}
460       \textcolor{keywordflow}{if}(context->mibTable[i] != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} &&
461          context->mibTable[i]->numObjects > 0)
462       \{
463          \textcolor{comment}{//Get the total number of objects}
464          numObjects = context->mibTable[i]->numObjects;
465 
466          \textcolor{comment}{//Point to the last object of the MIB}
467          \textcolor{keywordtype}{object} = &context->mibTable[i]->objects[numObjects - 1];
468 
469          \textcolor{comment}{//Discard instance sub-identifier}
470          n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}, object->oidLen);
471 
472          \textcolor{comment}{//Perform lexicographical comparison}
473          \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, n, object->oid, object->oidLen) <= 0)
474          \{
475             \textcolor{comment}{//Sanity check}
476             \textcolor{keywordflow}{if}((nextOidLen + var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}) > bufferLen)
477             \{
478                \textcolor{comment}{//Report an error}
479                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
480                \textcolor{comment}{//Exit immediately}
481                \textcolor{keywordflow}{break};
482             \}
483 
484             \textcolor{comment}{//Copy the OID from the specified variable binding}
485             curOid = nextOid + nextOidLen;
486             curOidLen = var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen};
487             memcpy(curOid, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen});
488 
489             \textcolor{comment}{//Loop through objects}
490             \textcolor{keywordflow}{for}(j = 0; j < numObjects; )
491             \{
492                \textcolor{comment}{//Point to the current object}
493                \textcolor{keywordtype}{object} = &context->mibTable[i]->objects[j];
494 
495                \textcolor{comment}{//Buffer where to store the OID of the next object}
496                tempOid = curOid + curOidLen;
497 
498                \textcolor{comment}{//Make sure the current object is accessible}
499                \textcolor{keywordflow}{if}(object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a0ea41ab110a7e92da995f22b9b3755ed}{MIB\_ACCESS\_READ\_ONLY} ||
500                   object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a604c2aa798a86427cc36b7f9cfe36282}{MIB\_ACCESS\_READ\_WRITE} ||
501                   object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a2e8d53184c390f0c69521faef5af4253}{MIB\_ACCESS\_READ\_CREATE})
502                \{
503                   \textcolor{comment}{//Scalar or tabular object?}
504                   \textcolor{keywordflow}{if}(object->getNext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
505                   \{
506                      \textcolor{comment}{//Perform lexicographical comparison}
507                      \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(curOid, curOidLen, object->oid, object->oidLen) <= 0)
508                      \{
509                         \textcolor{comment}{//Take in account the instance sub-identifier to determine}
510                         \textcolor{comment}{//the length of the OID}
511                         tempOidLen = \textcolor{keywordtype}{object}->oidLen + 1;
512 
513                         \textcolor{comment}{//Make sure the buffer is large enough to hold the entire OID}
514                         \textcolor{keywordflow}{if}((nextOidLen + curOidLen + tempOidLen) <= bufferLen)
515                         \{
516                            \textcolor{comment}{//Copy object identifier}
517                            memcpy(tempOid, object->oid, object->oidLen);
518                            \textcolor{comment}{//Append instance sub-identifier}
519                            tempOid[tempOidLen - 1] = 0;
520 
521                            \textcolor{comment}{//Successful processing}
522                            error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
523                         \}
524                         \textcolor{keywordflow}{else}
525                         \{
526                            \textcolor{comment}{//Report an error}
527                            error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
528                         \}
529                      \}
530                      \textcolor{keywordflow}{else}
531                      \{
532                         \textcolor{comment}{//The specified OID does not lexicographically precede}
533                         \textcolor{comment}{//the name of the current object}
534                         error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
535                      \}
536                   \}
537                   \textcolor{keywordflow}{else}
538                   \{
539                      \textcolor{comment}{//Discard instance sub-identifier}
540                      n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(curOidLen, object->oidLen);
541 
542                      \textcolor{comment}{//Perform lexicographical comparison}
543                      \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(curOid, n, object->oid, object->oidLen) <= 0)
544                      \{
545                         \textcolor{comment}{//Maximum acceptable size of the OID}
546                         tempOidLen = bufferLen - nextOidLen - curOidLen;
547 
548                         \textcolor{comment}{//Search the MIB for the next object}
549                         error = \textcolor{keywordtype}{object}->getNext(\textcolor{keywordtype}{object}, curOid, curOidLen,
550                            tempOid, &tempOidLen);
551                      \}
552                      \textcolor{keywordflow}{else}
553                      \{
554                         \textcolor{comment}{//The specified OID does not lexicographically precede}
555                         \textcolor{comment}{//the name of the current object}
556                         error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
557                      \}
558                   \}
559 
560 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED)}
561                   \textcolor{comment}{//Check status code}
562                   \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
563                   \{
564                      \textcolor{comment}{//On receipt of an SNMPv1 GetNextRequest-PDU, any object}
565                      \textcolor{comment}{//instance which contains a syntax of Counter64 shall be}
566                      \textcolor{comment}{//skipped (refer to RFC 3584, section 4.2.2.1)}
567                      \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
568                      \{
569                         \textcolor{comment}{//Counter64 type?}
570                         \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION} &&
571                            object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa73cae682204a2b9ac9b9200d812c1406}{MIB\_TYPE\_COUNTER64})
572                         \{
573                            \textcolor{comment}{//Skip current object}
574                            error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
575                         \}
576                      \}
577                   \}
578 \textcolor{preprocessor}{#endif}
579 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
580                   \textcolor{comment}{//Check status code}
581                   \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
582                   \{
583                      \textcolor{comment}{//Access control verification}
584                      error = \hyperlink{snmp__agent__vacm_8c_a7fd7c986d68a6e1253878108397c78e8}{snmpIsAccessAllowed}(context, message, tempOid,
585                         tempOidLen);
586                   \}
587 \textcolor{preprocessor}{#endif}
588                   \textcolor{comment}{//Check status code}
589                   \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
590                   \{
591                      \textcolor{comment}{//Save the closest object identifier that follows the}
592                      \textcolor{comment}{//specified OID}
593                      \textcolor{keywordflow}{if}(nextObject == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
594                      \{
595                         nextObject = object;
596                         nextOidLen = tempOidLen;
597                         memmove(nextOid, tempOid, tempOidLen);
598                      \}
599                      \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(tempOid, tempOidLen, nextOid, nextOidLen) < 0)
600                      \{
601                         nextObject = object;
602                         nextOidLen = tempOidLen;
603                         memmove(nextOid, tempOid, tempOidLen);
604                      \}
605 
606                      \textcolor{comment}{//We are done}
607                      \textcolor{keywordflow}{break};
608                   \}
609                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND})
610                   \{
611                      \textcolor{comment}{//Catch exception}
612                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
613 
614                      \textcolor{comment}{//Jump to the next object in the MIB}
615                      j++;
616                   \}
617                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca487819dd3b521f88c597e47c4d6c1255}{ERROR\_UNKNOWN\_CONTEXT} ||
618                      error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caad7c52cd713fd33a26b64f01377927cf}{ERROR\_AUTHORIZATION\_FAILED})
619                   \{
620                      \textcolor{comment}{//Catch exception}
621                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
622 
623                      \textcolor{comment}{//Check the next instance of the same object}
624                      curOidLen = tempOidLen;
625                      memmove(curOid, tempOid, tempOidLen);
626                   \}
627                   \textcolor{keywordflow}{else}
628                   \{
629                      \textcolor{comment}{//Exit immediately}
630                      \textcolor{keywordflow}{break};
631                   \}
632                \}
633                \textcolor{keywordflow}{else}
634                \{
635                   \textcolor{comment}{//The current object is not accessible}
636                   j++;
637                \}
638             \}
639          \}
640       \}
641 
642       \textcolor{comment}{//Any error to report?}
643       \textcolor{keywordflow}{if}(error)
644          \textcolor{keywordflow}{break};
645    \}
646 
647    \textcolor{comment}{//Check status code}
648    \textcolor{keywordflow}{if}(!error)
649    \{
650       \textcolor{comment}{//Next object found?}
651       \textcolor{keywordflow}{if}(nextObject != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
652       \{
653          \textcolor{comment}{//Replace the original OID with the name of the next object}
654          var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = nextOid;
655          var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = nextOidLen;
656 
657          \textcolor{comment}{//Save the length of the OID}
658          context->response.oidLen = nextOidLen;
659       \}
660       \textcolor{keywordflow}{else}
661       \{
662          \textcolor{comment}{//The specified OID does not lexicographically precede the}
663          \textcolor{comment}{//name of some object}
664          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
665       \}
666    \}
667 
668    \textcolor{comment}{//Return status code}
669    \textcolor{keywordflow}{return} error;
670 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}\label{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}} 
\index{snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}!snmp\+Get\+Object\+Value@{snmp\+Get\+Object\+Value}}
\index{snmp\+Get\+Object\+Value@{snmp\+Get\+Object\+Value}!snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}}
\subsubsection{\texorpdfstring{snmp\+Get\+Object\+Value()}{snmpGetObjectValue()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Get\+Object\+Value (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$}]{message,  }\item[{\hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$}]{var }\end{DoxyParamCaption})}



Retrieve object value. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the received S\+N\+MP message \\
\hline
\mbox{\tt out}  & {\em var} & Variable binding \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 230 of file snmp\+\_\+agent\+\_\+object.\+c.


\begin{DoxyCode}
232 \{
233    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
234    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
235    \hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
236    \textcolor{keyword}{const} \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{MibObject} *object;
237 
238    \textcolor{comment}{//Search the MIB for the specified object}
239    error = \hyperlink{snmp__agent__object_8c_ad1873f721a1264eca1bd1f9fc6764f52}{snmpFindMibObject}(context, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}, &\textcolor{keywordtype}{object});
240    \textcolor{comment}{//Cannot found the specified object?}
241    \textcolor{keywordflow}{if}(error)
242       \textcolor{keywordflow}{return} error;
243 
244    \textcolor{comment}{//Debug message}
245    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  %s\(\backslash\)r\(\backslash\)n"}, object->name);
246 
247    \textcolor{comment}{//Check the maximal level of access for the specified object}
248    \textcolor{keywordflow}{if}(object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a0ea41ab110a7e92da995f22b9b3755ed}{MIB\_ACCESS\_READ\_ONLY} ||
249       object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a604c2aa798a86427cc36b7f9cfe36282}{MIB\_ACCESS\_READ\_WRITE} ||
250       object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a2e8d53184c390f0c69521faef5af4253}{MIB\_ACCESS\_READ\_CREATE})
251    \{
252       \textcolor{comment}{//The object is available for get operations}
253    \}
254    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->access == \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317ae9dd1d90dfe8cda39e821bf26163dadb}{MIB\_ACCESS\_FOR\_NOTIFY})
255    \{
256       \textcolor{comment}{//The object is accessible only via a notification}
257       \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a48ced2a20c11fcd5c72fa1c47d239343}{pduType} != \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa51084b3eb61f91ceedeb5e426c15ffe0}{SNMP\_PDU\_TRAP} &&
258          message->\hyperlink{structSnmpMessage_a48ced2a20c11fcd5c72fa1c47d239343}{pduType} != \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa194e27ffa1ad6456408b07aff153d6ff}{SNMP\_PDU\_TRAP\_V2} &&
259          message->\hyperlink{structSnmpMessage_a48ced2a20c11fcd5c72fa1c47d239343}{pduType} != \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa4060cecdb63948db5da6be30b623244b}{SNMP\_PDU\_INFORM\_REQUEST})
260       \{
261          \textcolor{comment}{//Report an error}
262          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED};
263       \}
264    \}
265    \textcolor{keywordflow}{else}
266    \{
267       \textcolor{comment}{//The object is not available for get operations}
268       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED};
269    \}
270 
271 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
272    \textcolor{comment}{//Access control verification}
273    error = \hyperlink{snmp__agent__vacm_8c_a7fd7c986d68a6e1253878108397c78e8}{snmpIsAccessAllowed}(context, message, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->
      \hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen});
274    \textcolor{comment}{//Access denied?}
275    \textcolor{keywordflow}{if}(error)
276       \textcolor{keywordflow}{return} error;
277 \textcolor{preprocessor}{#endif}
278 
279    \textcolor{comment}{//Buffer where to store the object value}
280    value = (\hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *) (context->response.varBindList +
281       context->response.varBindListLen + context->response.oidLen);
282 
283    \textcolor{comment}{//Number of bytes available in the buffer}
284    n = context->response.varBindListMaxLen -
285       (context->response.varBindListLen + context->response.oidLen);
286 
287    \textcolor{comment}{//Check object class}
288    \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL})
289    \{
290       \textcolor{comment}{//Check object type}
291       \textcolor{keywordflow}{if}(object->objType == \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER})
292       \{
293          \textcolor{comment}{//Make sure the buffer is large enough}
294          \textcolor{keywordflow}{if}(n < object->\hyperlink{chap_8h_aa343e790a9b98797f277ef50971e7687}{valueSize})
295             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
296 
297          \textcolor{comment}{//Integer objects have fixed size}
298          n = \textcolor{keywordtype}{object}->valueSize;
299       \}
300    \}
301    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION})
302    \{
303       \textcolor{comment}{//Check object type}
304       \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa86745373c87bb6b6902ab67fd6c63245}{MIB\_TYPE\_IP\_ADDRESS} ||
305          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa2cdb81533548328e7c049535c88425d6}{MIB\_TYPE\_COUNTER32} ||
306          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa8f1e985df4e3ef68e62821d98654bace}{MIB\_TYPE\_GAUGE32} ||
307          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa13fd57cc818acf51f5eabb5d0ad6c484}{MIB\_TYPE\_TIME\_TICKS} ||
308          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa73cae682204a2b9ac9b9200d812c1406}{MIB\_TYPE\_COUNTER64})
309       \{
310          \textcolor{comment}{//Make sure the buffer is large enough}
311          \textcolor{keywordflow}{if}(n < object->\hyperlink{chap_8h_aa343e790a9b98797f277ef50971e7687}{valueSize})
312             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
313 
314          \textcolor{comment}{//IpAddress, Counter32, Gauge32, TimeTicks and}
315          \textcolor{comment}{//Counter64 objects have fixed size}
316          n = \textcolor{keywordtype}{object}->valueSize;
317       \}
318    \}
319 
320    \textcolor{comment}{//Object value can be retrieved using a callback function}
321    \textcolor{keywordflow}{if}(object->getValue != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
322    \{
323       \textcolor{comment}{//Invoke callback function to retrieve object value}
324       error = \textcolor{keywordtype}{object}->getValue(\textcolor{keywordtype}{object}, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}, value, &n);
325    \}
326    \textcolor{comment}{//Simple scalar objects can also be attached to a variable}
327    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->value != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
328    \{
329       \textcolor{comment}{//Get the length of the object value}
330       \textcolor{keywordflow}{if}(object->valueLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
331          n = *\textcolor{keywordtype}{object}->valueLen;
332 
333       \textcolor{comment}{//Retrieve object value}
334       memcpy(value, object->value, n);
335       \textcolor{comment}{//Successful read operation}
336       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
337    \}
338    \textcolor{keywordflow}{else}
339    \{
340       \textcolor{comment}{//Report an error}
341       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacf545b4d693b270f9d01d54d86efedc2}{ERROR\_READ\_FAILED};
342    \}
343 
344    \textcolor{comment}{//Unable to retrieve object value?}
345    \textcolor{keywordflow}{if}(error)
346       \textcolor{keywordflow}{return} error;
347 
348    \textcolor{comment}{//Check object class}
349    \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL})
350    \{
351       \textcolor{comment}{//Check object type}
352       \textcolor{keywordflow}{if}(object->objType == \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER})
353       \{
354          \textcolor{comment}{//Encode Integer objects using ASN.1 rules}
355          error = \hyperlink{snmp__agent__message_8c_ad76ec89787d10854f6d306201edd3ed5}{snmpEncodeInt32}(value->integer, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) value, &n);
356       \}
357       \textcolor{keywordflow}{else}
358       \{
359          \textcolor{comment}{//No conversion required for OctetString and ObjectIdentifier objects}
360          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
361       \}
362    \}
363    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION})
364    \{
365       \textcolor{comment}{//Check object type}
366       \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa2cdb81533548328e7c049535c88425d6}{MIB\_TYPE\_COUNTER32} ||
367          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa8f1e985df4e3ef68e62821d98654bace}{MIB\_TYPE\_GAUGE32} ||
368          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa13fd57cc818acf51f5eabb5d0ad6c484}{MIB\_TYPE\_TIME\_TICKS})
369       \{
370          \textcolor{comment}{//Encode Counter32, Gauge32 and TimeTicks objects using ASN.1 rules}
371          error = \hyperlink{snmp__agent__message_8c_aac8a5ef4f5de9b431d0f768ab0973d8d}{snmpEncodeUnsignedInt32}(value->counter32, (
      \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) value, &n);
372       \}
373       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa73cae682204a2b9ac9b9200d812c1406}{MIB\_TYPE\_COUNTER64})
374       \{
375 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED)}
376          \textcolor{comment}{//On receipt of an SNMPv1 GetRequest-PDU containing a variable binding}
377          \textcolor{comment}{//whose name field points to an object instance of type Counter64, a}
378          \textcolor{comment}{//GetResponse-PDU SHALL be returned, with an error-status of noSuchName}
379          \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
380          \{
381             \textcolor{comment}{//Report an error}
382             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND};
383          \}
384          \textcolor{keywordflow}{else}
385 \textcolor{preprocessor}{#endif}
386          \{
387             \textcolor{comment}{//Encode Counter64 objects using ASN.1 rules}
388             error = \hyperlink{snmp__agent__message_8c_a82c5b0d3de226dbb6f580cd3ad50fb74}{snmpEncodeUnsignedInt64}(value->counter64,
389                (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) value, &n);
390          \}
391       \}
392       \textcolor{keywordflow}{else}
393       \{
394          \textcolor{comment}{//No conversion required for Opaque objects}
395          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
396       \}
397    \}
398 
399    \textcolor{comment}{//Check status code}
400    \textcolor{keywordflow}{if}(!error)
401    \{
402       \textcolor{comment}{//Save object class and type}
403       var->\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \textcolor{keywordtype}{object}->objClass;
404       var->\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \textcolor{keywordtype}{object}->objType;
405 
406       \textcolor{comment}{//Save object value}
407       var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) value;
408       var->\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
409    \}
410 
411    \textcolor{comment}{//Return status code}
412    \textcolor{keywordflow}{return} error;
413 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__object_8c_a7e9ab6bc8e4deb43d557591b0c4f987c}\label{snmp__agent__object_8c_a7e9ab6bc8e4deb43d557591b0c4f987c}} 
\index{snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}!snmp\+Set\+Object\+Value@{snmp\+Set\+Object\+Value}}
\index{snmp\+Set\+Object\+Value@{snmp\+Set\+Object\+Value}!snmp\+\_\+agent\+\_\+object.\+c@{snmp\+\_\+agent\+\_\+object.\+c}}
\subsubsection{\texorpdfstring{snmp\+Set\+Object\+Value()}{snmpSetObjectValue()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Set\+Object\+Value (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$}]{message,  }\item[{\hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$}]{var,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{commit }\end{DoxyParamCaption})}



Assign object value. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the received S\+N\+MP message \\
\hline
\mbox{\tt in}  & {\em var} & Variable binding \\
\hline
\mbox{\tt in}  & {\em commit} & This flag specifies whether the changes should be committed to the M\+IB base \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 57 of file snmp\+\_\+agent\+\_\+object.\+c.


\begin{DoxyCode}
59 \{
60    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
61    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
62    \hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
63    \textcolor{keyword}{const} \hyperlink{mib__common_8h_a2bc33cee6dd90a0ee8eeb92976a1c479}{MibObject} *object;
64 
65    \textcolor{comment}{//Search the MIB for the specified object}
66    error = \hyperlink{snmp__agent__object_8c_ad1873f721a1264eca1bd1f9fc6764f52}{snmpFindMibObject}(context, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}, &\textcolor{keywordtype}{object});
67    \textcolor{comment}{//Cannot found the specified object?}
68    \textcolor{keywordflow}{if}(error)
69       \textcolor{keywordflow}{return} error;
70 
71    \textcolor{comment}{//Debug message}
72    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  %s\(\backslash\)r\(\backslash\)n"}, object->name);
73 
74    \textcolor{comment}{//Make sure the specified object is available for set operations}
75    \textcolor{keywordflow}{if}(object->access != \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a01be1cac461dd8022c47fad9441e7b90}{MIB\_ACCESS\_WRITE\_ONLY} &&
76       object->access != \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a604c2aa798a86427cc36b7f9cfe36282}{MIB\_ACCESS\_READ\_WRITE} &&
77       object->access != \hyperlink{mib__common_8h_a801861d3d59b941b484ed18b4ea27317a2e8d53184c390f0c69521faef5af4253}{MIB\_ACCESS\_READ\_CREATE})
78    \{
79       \textcolor{comment}{//Report an error}
80       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa351a01311bd38606165023d2f01e5aa}{ERROR\_NOT\_WRITABLE};
81    \}
82 
83 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
84    \textcolor{comment}{//Access control verification}
85    error = \hyperlink{snmp__agent__vacm_8c_a7fd7c986d68a6e1253878108397c78e8}{snmpIsAccessAllowed}(context, message, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->
      \hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen});
86    \textcolor{comment}{//Access denied?}
87    \textcolor{keywordflow}{if}(error)
88       \textcolor{keywordflow}{return} error;
89 \textcolor{preprocessor}{#endif}
90 
91    \textcolor{comment}{//Check class}
92    \textcolor{keywordflow}{if}(var->\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} != object->objClass)
93       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca271f27d4fe36c93671fb83dcf2d3cf32}{ERROR\_WRONG\_TYPE};
94    \textcolor{comment}{//Check type}
95    \textcolor{keywordflow}{if}(var->\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} != object->objType)
96       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca271f27d4fe36c93671fb83dcf2d3cf32}{ERROR\_WRONG\_TYPE};
97 
98    \textcolor{comment}{//Point to the object value}
99    value = (\hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *) var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value};
100    \textcolor{comment}{//Get the length of the object value}
101    n = var->\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen};
102 
103    \textcolor{comment}{//Check object class}
104    \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL})
105    \{
106       \textcolor{comment}{//Check object type}
107       \textcolor{keywordflow}{if}(object->objType == \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER})
108       \{
109          \hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\_t} val;
110 
111          \textcolor{comment}{//Integer objects use ASN.1 encoding rules}
112          error = \hyperlink{snmp__agent__message_8c_a31bbd1ea85a71a71e20f31d86301938f}{snmpDecodeInt32}(var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value}, n, &val);
113          \textcolor{comment}{//Conversion failed?}
114          \textcolor{keywordflow}{if}(error)
115             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
116 
117          \textcolor{comment}{//Point to the scratch buffer}
118          value = (\hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *) context->response.buffer;
119          \textcolor{comment}{//Save resulting value}
120          value->integer = val;
121          \textcolor{comment}{//Integer size}
122          n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\_t});
123       \}
124    \}
125    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objClass == \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION})
126    \{
127       \textcolor{comment}{//Check object type}
128       \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa86745373c87bb6b6902ab67fd6c63245}{MIB\_TYPE\_IP\_ADDRESS})
129       \{
130          \textcolor{comment}{//IpAddress objects have fixed size}
131          \textcolor{keywordflow}{if}(n != object->valueSize)
132             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5040f7f12c5856b6fa69242813935bad}{ERROR\_WRONG\_LENGTH};
133       \}
134       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa2cdb81533548328e7c049535c88425d6}{MIB\_TYPE\_COUNTER32} ||
135          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa8f1e985df4e3ef68e62821d98654bace}{MIB\_TYPE\_GAUGE32} ||
136          object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa13fd57cc818acf51f5eabb5d0ad6c484}{MIB\_TYPE\_TIME\_TICKS})
137       \{
138          \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} val;
139 
140          \textcolor{comment}{//Counter32, Gauge32 and TimeTicks objects use ASN.1 encoding rules}
141          error = \hyperlink{snmp__agent__message_8c_a8c9d74480ba6bf5a0a9a033f3a25e0a7}{snmpDecodeUnsignedInt32}(var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value}, n, &val);
142          \textcolor{comment}{//Conversion failed?}
143          \textcolor{keywordflow}{if}(error)
144             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
145 
146          \textcolor{comment}{//Point to the scratch buffer}
147          value = (\hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *) context->response.buffer;
148          \textcolor{comment}{//Save resulting value}
149          value->counter32 = val;
150          \textcolor{comment}{//Integer size}
151          n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t});
152       \}
153       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->objType == \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa73cae682204a2b9ac9b9200d812c1406}{MIB\_TYPE\_COUNTER64})
154       \{
155          \hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t} val;
156 
157 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED)}
158          \textcolor{comment}{//Any SNMPv1 request which contains a variable binding with a}
159          \textcolor{comment}{//Counter64 value is ill-formed and shall be discarded (refer}
160          \textcolor{comment}{//to RFC 3584, section 4.2.2.1)}
161          \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
162             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
163 \textcolor{preprocessor}{#endif}
164          \textcolor{comment}{//Counter64 objects use ASN.1 encoding rules}
165          error = \hyperlink{snmp__agent__message_8c_af7552056f1143f7768639e0ade5ad868}{snmpDecodeUnsignedInt64}(var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value}, n, &val);
166          \textcolor{comment}{//Conversion failed?}
167          \textcolor{keywordflow}{if}(error)
168             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
169 
170          \textcolor{comment}{//Point to the scratch buffer}
171          value = (\hyperlink{mib__common_8h_a515b369f80863becb3a17870e6bb7a80}{MibVariant} *) context->response.buffer;
172          \textcolor{comment}{//Save resulting value}
173          value->counter64 = val;
174          \textcolor{comment}{//Integer size}
175          n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t});
176       \}
177    \}
178 
179    \textcolor{comment}{//Objects can be assigned a value using a callback function}
180    \textcolor{keywordflow}{if}(object->setValue != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
181    \{
182       \textcolor{comment}{//Invoke callback function to assign object value}
183       error = \textcolor{keywordtype}{object}->setValue(\textcolor{keywordtype}{object}, var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen}, value, n, commit);
184    \}
185    \textcolor{comment}{//Simple scalar objects can also be attached to a variable}
186    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(object->value != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
187    \{
188       \textcolor{comment}{//Check the length of the object}
189       \textcolor{keywordflow}{if}(n <= object->\hyperlink{chap_8h_aa343e790a9b98797f277ef50971e7687}{valueSize})
190       \{
191          \textcolor{comment}{//Check whether the changes shall be committed to the MIB base}
192          \textcolor{keywordflow}{if}(commit)
193          \{
194             \textcolor{comment}{//Record the length of the object value}
195             \textcolor{keywordflow}{if}(object->valueLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
196                *\textcolor{keywordtype}{object}->valueLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
197 
198             \textcolor{comment}{//Set object value}
199             memcpy(object->value, value, n);
200          \}
201 
202          \textcolor{comment}{//Successful write operation}
203          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
204       \}
205       \textcolor{keywordflow}{else}
206       \{
207          \textcolor{comment}{//Invalid length}
208          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5040f7f12c5856b6fa69242813935bad}{ERROR\_WRONG\_LENGTH};
209       \}
210    \}
211    \textcolor{keywordflow}{else}
212    \{
213       \textcolor{comment}{//Report an error}
214       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED};
215    \}
216 
217    \textcolor{comment}{//Return status code}
218    \textcolor{keywordflow}{return} error;
219 \}
\end{DoxyCode}
