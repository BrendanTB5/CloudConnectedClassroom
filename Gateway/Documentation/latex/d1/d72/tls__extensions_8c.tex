\hypertarget{tls__extensions_8c}{}\section{cyclone\+\_\+ssl/tls\+\_\+extensions.c File Reference}
\label{tls__extensions_8c}\index{cyclone\+\_\+ssl/tls\+\_\+extensions.\+c@{cyclone\+\_\+ssl/tls\+\_\+extensions.\+c}}


Parsing and checking of T\+LS extensions.  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+cipher\+\_\+suites.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+extensions.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+transcript\+\_\+hash.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dtls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tls__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__extensions_8c_a44cc44e114cbc3c28245bdfa6546cb5c}{tls\+Parse\+Hello\+Extensions} (\hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9b}{Tls\+Message\+Type} \hyperlink{mqtt__sn__common_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msg\+Type}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structTlsHelloExtensions}{Tls\+Hello\+Extensions} $\ast$\hyperlink{tls13__misc_8h_a7b8cc84c920376c616d85d575080d28e}{extensions})
\begin{DoxyCompactList}\small\item\em Parse Hello extensions. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__extensions_8c_a67e977c5311fc3d9b3503ca226f2ea7a}{tls\+Check\+Hello\+Extensions} (\hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9b}{Tls\+Message\+Type} \hyperlink{mqtt__sn__common_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msg\+Type}, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}, \hyperlink{structTlsHelloExtensions}{Tls\+Hello\+Extensions} $\ast$\hyperlink{tls13__misc_8h_a7b8cc84c920376c616d85d575080d28e}{extensions})
\begin{DoxyCompactList}\small\item\em Check Hello extensions. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__extensions_8c_af9ead181a4adec8f8c0cced6bd0b70e6}{tls\+Check\+Duplicate\+Extension} (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Check whether the specified extension type is a duplicate. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{tls__extensions_8c_a5b3ac44fd8575310d00ab10cbbd6dfdd}{tls\+Is\+Alpn\+Protocol\+Supported} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Check whether the specified A\+L\+PN protocol is supported. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Parsing and checking of T\+LS extensions. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{tls__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{tls__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file tls\+\_\+extensions.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{tls__extensions_8c_af9ead181a4adec8f8c0cced6bd0b70e6}\label{tls__extensions_8c_af9ead181a4adec8f8c0cced6bd0b70e6}} 
\index{tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}!tls\+Check\+Duplicate\+Extension@{tls\+Check\+Duplicate\+Extension}}
\index{tls\+Check\+Duplicate\+Extension@{tls\+Check\+Duplicate\+Extension}!tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Check\+Duplicate\+Extension()}{tlsCheckDuplicateExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Check\+Duplicate\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{type,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Check whether the specified extension type is a duplicate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em type} & Extension type \\
\hline
\mbox{\tt in}  & {\em p} & Input stream where to read the list of extensions \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 967 of file tls\+\_\+extensions.\+c.


\begin{DoxyCode}
969 \{
970    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
971    \textcolor{keyword}{const} \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
972 
973    \textcolor{comment}{//Parse the list of extensions offered by the peer}
974    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
975    \{
976       \textcolor{comment}{//Point to the current extension}
977       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
978 
979       \textcolor{comment}{//Check the length of the extension}
980       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}))
981          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
982       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->length)))
983          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
984 
985       \textcolor{comment}{//There must not be more than one extension of the same type (refer to}
986       \textcolor{comment}{//RFC 5246, section 7.4.1.4)}
987       \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->type) == \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type})
988       \{
989          \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} > \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a10b93b38aef9aea795816607063e5d98}{TLS\_EXT\_RENEGOTIATION\_INFO})
990             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
991          \textcolor{keywordflow}{else}
992             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
993       \}
994 
995       \textcolor{comment}{//Retrieve the length of the extension}
996       n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->length);
997 
998       \textcolor{comment}{//Jump to the next extension}
999       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + n;
1000       \textcolor{comment}{//Number of bytes left to process}
1001       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + n;
1002    \}
1003 
1004    \textcolor{comment}{//Successful verification}
1005    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1006 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__extensions_8c_a67e977c5311fc3d9b3503ca226f2ea7a}\label{tls__extensions_8c_a67e977c5311fc3d9b3503ca226f2ea7a}} 
\index{tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}!tls\+Check\+Hello\+Extensions@{tls\+Check\+Hello\+Extensions}}
\index{tls\+Check\+Hello\+Extensions@{tls\+Check\+Hello\+Extensions}!tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Check\+Hello\+Extensions()}{tlsCheckHelloExtensions()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Check\+Hello\+Extensions (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9b}{Tls\+Message\+Type}}]{msg\+Type,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{version,  }\item[{\hyperlink{structTlsHelloExtensions}{Tls\+Hello\+Extensions} $\ast$}]{extensions }\end{DoxyParamCaption})}



Check Hello extensions. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em msg\+Type} & Handshake message type \\
\hline
\mbox{\tt in}  & {\em version} & T\+LS version \\
\hline
\mbox{\tt in}  & {\em extensions} & List of Hello extensions offered by the peer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 663 of file tls\+\_\+extensions.\+c.


\begin{DoxyCode}
665 \{
666    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
667 
668    \textcolor{comment}{//Initialize status code}
669    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
670 
671 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED && TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
672    \textcolor{comment}{//A client must treat receipt of both MaxFragmentLength and RecordSizeLimit}
673    \textcolor{comment}{//extensions as a fatal error, and it should generate an illegal\_parameter}
674    \textcolor{comment}{//alert (refer to RFC 8449, section 5)}
675    \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a45f3337429c669574aaedfcc6a1a2d23}{maxFragLen} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && extensions->
      \hyperlink{structTlsHelloExtensions_a35167138c60de81d1635fc1d87fc3b8f}{recordSizeLimit} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
676    \{
677       \textcolor{comment}{//ServerHello or EncryptedExtensions message?}
678       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO} ||
679          \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
680       \{
681          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
682       \}
683    \}
684 \textcolor{preprocessor}{#endif}
685 
686 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
687    \textcolor{comment}{//If an implementation receives an extension which it recognizes and which}
688    \textcolor{comment}{//is not specified for the message in which it appears it must abort the}
689    \textcolor{comment}{//handshake with an illegal\_parameter alert (refer to RFC 8446, section 4.2)}
690    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
691    \{
692       \textcolor{comment}{//SupportedVersions extension found?}
693       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_ad2c1f8bd3e6432fe17b9ac339fc35a0b}{supportedVersionList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
694          extensions->\hyperlink{structTlsHelloExtensions_a3fcdd9177ae16d800a0c7de6a6a45786}{selectedVersion} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
695       \{
696          \textcolor{comment}{//The extension can only appear in CH, SH and HRR messages}
697          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
698             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO} &&
699             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST})
700          \{
701             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
702          \}
703       \}
704 
705       \textcolor{comment}{//ServerName extension found?}
706       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a53acaa1dcce86449741ea9a780331d46}{serverNameList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
707       \{
708          \textcolor{comment}{//The extension can only appear in CH and EE messages}
709          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
710             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
711          \{
712             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
713          \}
714       \}
715 
716       \textcolor{comment}{//SupportedGroups extension found?}
717       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_ae47ac6a93d2836418dc163d299e46cf7}{supportedGroupList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
718       \{
719          \textcolor{comment}{//The extension can only appear in CH and EE messages}
720          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
721             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
722          \{
723             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
724          \}
725       \}
726 
727       \textcolor{comment}{//EcPointFormats extension found?}
728       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_aeea7fd9313f97525e78c56a722b0dcfd}{ecPointFormatList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
729       \{
730          \textcolor{comment}{//The extension can only appear in CH}
731          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
732          \{
733             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
734          \}
735       \}
736 
737       \textcolor{comment}{//SignatureAlgorithms extension found?}
738       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a7903ad9cf319d5f27990432c4e719544}{signAlgoList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
739       \{
740          \textcolor{comment}{//The extension can only appear in CH and CR messages}
741          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
742             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9badf4f63379ab93eec891cdbae8f8a2717}{TLS\_TYPE\_CERTIFICATE\_REQUEST})
743          \{
744             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
745          \}
746       \}
747 
748       \textcolor{comment}{//SignatureAlgorithmsCert extension found?}
749       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a640637c05b8aec2ef15420d5005830cb}{certSignAlgoList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
750       \{
751          \textcolor{comment}{//The extension can only appear in CH and CR messages}
752          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
753             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9badf4f63379ab93eec891cdbae8f8a2717}{TLS\_TYPE\_CERTIFICATE\_REQUEST})
754          \{
755             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
756          \}
757       \}
758 
759 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
760       \textcolor{comment}{//MaxFragmentLength extension found?}
761       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a45f3337429c669574aaedfcc6a1a2d23}{maxFragLen} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
762       \{
763          \textcolor{comment}{//The extension can only appear in CH and EE messages}
764          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
765             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
766          \{
767             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
768          \}
769       \}
770 \textcolor{preprocessor}{#endif}
771 
772 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
773       \textcolor{comment}{//RecordSizeLimit extension found?}
774       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a35167138c60de81d1635fc1d87fc3b8f}{recordSizeLimit} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
775       \{
776          \textcolor{comment}{//The extension can only appear in CH and EE messages}
777          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
778             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
779          \{
780             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
781          \}
782       \}
783 \textcolor{preprocessor}{#endif}
784 
785 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
786       \textcolor{comment}{//ALPN extension found?}
787       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a0752d52c09a933f5b001385db60159b1}{protocolNameList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
788       \{
789          \textcolor{comment}{//The extension can only appear in CH and EE messages}
790          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
791             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
792          \{
793             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
794          \}
795       \}
796 \textcolor{preprocessor}{#endif}
797 
798 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
799       \textcolor{comment}{//ClientCertType extension found?}
800       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a3091449503c4dcce58f3e62d70c24cd0}{clientCertTypeList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
801          extensions->\hyperlink{structTlsHelloExtensions_a763ae23601c4eb7b1ec11230ef1f88ed}{clientCertType} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
802       \{
803          \textcolor{comment}{//The extension can only appear in CH and EE messages}
804          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
805             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
806          \{
807             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
808          \}
809       \}
810 
811       \textcolor{comment}{//ServerCertType extension found?}
812       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a7e4a609ad6013ea6bcab97286320cf16}{serverCertTypeList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
813          extensions->\hyperlink{structTlsHelloExtensions_a2a473c126ac51cf3dd2e999ee6881186}{serverCertType} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
814       \{
815          \textcolor{comment}{//The extension can only appear in CH and EE messages}
816          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
817             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
818          \{
819             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
820          \}
821       \}
822 \textcolor{preprocessor}{#endif}
823 
824 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
825       \textcolor{comment}{//ExtendedMasterSecret extension found?}
826       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a04cc0ffcf992700820ec12d6f43212bf}{extendedMasterSecret} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
827       \{
828          \textcolor{comment}{//The extension can only appear in CH}
829          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
830          \{
831             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
832          \}
833       \}
834 \textcolor{preprocessor}{#endif}
835 
836 \textcolor{preprocessor}{#if (TLS\_SECURE\_RENEGOTIATION\_SUPPORT == ENABLED)}
837       \textcolor{comment}{//RenegotiationInfo extension found?}
838       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_aecf5a78a44bd06ba8018bd5f4a5043de}{renegoInfo} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
839       \{
840          \textcolor{comment}{//The extension can only appear in CH}
841          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
842          \{
843             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
844          \}
845       \}
846 \textcolor{preprocessor}{#endif}
847 
848       \textcolor{comment}{//Cookie extension found?}
849       \textcolor{keywordflow}{if}(extensions->cookie != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
850       \{
851          \textcolor{comment}{//The extension can only appear in CH and HRR messages}
852          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
853             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST})
854          \{
855             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
856          \}
857       \}
858 
859       \textcolor{comment}{//KeyShare extension found?}
860       \textcolor{keywordflow}{if}(extensions->keyShareList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
861          extensions->serverShare != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
862          extensions->selectedGroup != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
863       \{
864          \textcolor{comment}{//The extension can only appear in CH, SH and HRR messages}
865          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
866             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO} &&
867             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST})
868          \{
869             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
870          \}
871       \}
872 
873       \textcolor{comment}{//PskKeyExchangeModes extension found?}
874       \textcolor{keywordflow}{if}(extensions->pskKeModeList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
875       \{
876          \textcolor{comment}{//The extension can only appear in CH message}
877          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
878          \{
879             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
880          \}
881       \}
882 
883       \textcolor{comment}{//PreSharedKey extension found?}
884       \textcolor{keywordflow}{if}(extensions->identityList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
885          extensions->binderList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
886          extensions->selectedIdentity != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
887       \{
888          \textcolor{comment}{//The extension can only appear in CH and SH messages}
889          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
890             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO})
891          \{
892             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
893          \}
894       \}
895 
896       \textcolor{comment}{//EarlyData extension found?}
897       \textcolor{keywordflow}{if}(extensions->earlyDataIndication != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
898       \{
899          \textcolor{comment}{//The extension can only appear in CH, EE and NST messages}
900          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} &&
901             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS} &&
902             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} != \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9badd2d0307b59249022f09225e97228e94}{TLS\_TYPE\_NEW\_SESSION\_TICKET})
903          \{
904             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
905          \}
906       \}
907    \}
908 
909    \textcolor{comment}{//Check mandatory-to-implement extensions}
910    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} && \hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == 
      \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
911    \{
912       \textcolor{comment}{//A client must provide a PskKeyExchangeModes extension if it offers a}
913       \textcolor{comment}{//PreSharedKey extension (refer to RFC 8446, section 4.2.9)}
914       \textcolor{keywordflow}{if}(extensions->identityList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || extensions->binderList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
915       \{
916          \textcolor{comment}{//If a client offers PreSharedKey without a PskKeyExchangeModes}
917          \textcolor{comment}{//extension, the servers must abort the handshake}
918          \textcolor{keywordflow}{if}(extensions->pskKeModeList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
919          \{
920             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2077bd85b4a42b704992210364bfb334}{ERROR\_MISSING\_EXTENSION};
921          \}
922       \}
923 
924       \textcolor{comment}{//If the ClientHello does not contain a PreSharedKey extension, it must}
925       \textcolor{comment}{//contain both a SignatureAlgorithms extension and a SupportedGroups}
926       \textcolor{comment}{//extension (refer to RFC 8446, section 9.2)}
927       \textcolor{keywordflow}{if}(extensions->identityList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || extensions->binderList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
928       \{
929          \textcolor{comment}{//Servers receiving a ClientHello which does not conform to these}
930          \textcolor{comment}{//requirements must abort the handshake with a missing\_extension}
931          \textcolor{comment}{//alert}
932          \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_a7903ad9cf319d5f27990432c4e719544}{signAlgoList} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
933             extensions->\hyperlink{structTlsHelloExtensions_ae47ac6a93d2836418dc163d299e46cf7}{supportedGroupList} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
934          \{
935             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2077bd85b4a42b704992210364bfb334}{ERROR\_MISSING\_EXTENSION};
936          \}
937       \}
938 
939       \textcolor{comment}{//If the ClientHello contains a SupportedGroups extension, it must also}
940       \textcolor{comment}{//contain a KeyShare extension, and vice versa}
941       \textcolor{keywordflow}{if}(extensions->\hyperlink{structTlsHelloExtensions_ae47ac6a93d2836418dc163d299e46cf7}{supportedGroupList} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} &&
942          extensions->keyShareList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
943       \{
944          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2077bd85b4a42b704992210364bfb334}{ERROR\_MISSING\_EXTENSION};
945       \}
946       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(extensions->keyShareList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} &&
947          extensions->\hyperlink{structTlsHelloExtensions_ae47ac6a93d2836418dc163d299e46cf7}{supportedGroupList} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
948       \{
949          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2077bd85b4a42b704992210364bfb334}{ERROR\_MISSING\_EXTENSION};
950       \}
951    \}
952 \textcolor{preprocessor}{#endif}
953 
954    \textcolor{comment}{//Return status code}
955    \textcolor{keywordflow}{return} error;
956 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__extensions_8c_a5b3ac44fd8575310d00ab10cbbd6dfdd}\label{tls__extensions_8c_a5b3ac44fd8575310d00ab10cbbd6dfdd}} 
\index{tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}!tls\+Is\+Alpn\+Protocol\+Supported@{tls\+Is\+Alpn\+Protocol\+Supported}}
\index{tls\+Is\+Alpn\+Protocol\+Supported@{tls\+Is\+Alpn\+Protocol\+Supported}!tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Is\+Alpn\+Protocol\+Supported()}{tlsIsAlpnProtocolSupported()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} tls\+Is\+Alpn\+Protocol\+Supported (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{protocol,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Check whether the specified A\+L\+PN protocol is supported. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em protocol} & Pointer to the protocol name \\
\hline
\mbox{\tt in}  & {\em length} & Length of the protocol name, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the specified protocol is supported, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 1017 of file tls\+\_\+extensions.\+c.


\begin{DoxyCode}
1019 \{
1020    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} supported;
1021 
1022    \textcolor{comment}{//Initialize flag}
1023    supported = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1024 
1025 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
1026    \textcolor{comment}{//Sanity check}
1027    \textcolor{keywordflow}{if}(context->protocolList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1028    \{
1029       \textcolor{keywordtype}{size\_t} i;
1030       \textcolor{keywordtype}{size\_t} j;
1031 
1032       \textcolor{comment}{//Move back to the beginning of the list}
1033       i = 0;
1034       j = 0;
1035 
1036       \textcolor{comment}{//Parse the list of supported protocols}
1037       \textcolor{keywordflow}{do}
1038       \{
1039          \textcolor{comment}{//Delimiter character found?}
1040          \textcolor{keywordflow}{if}(context->protocolList[i] == \textcolor{charliteral}{','} || context->protocolList[i] == \textcolor{charliteral}{'\(\backslash\)0'})
1041          \{
1042             \textcolor{comment}{//Check the length of the protocol name}
1043             \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == (i - j))
1044             \{
1045                \textcolor{comment}{//Compare protocol names}
1046                \textcolor{keywordflow}{if}(!memcmp(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol}, context->protocolList + j, i - j))
1047                \{
1048                   \textcolor{comment}{//The specified protocol is supported}
1049                   supported = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1050                   \textcolor{comment}{//We are done}
1051                   \textcolor{keywordflow}{break};
1052                \}
1053             \}
1054 
1055             \textcolor{comment}{//Move to the next token}
1056             j = i + 1;
1057          \}
1058 
1059          \textcolor{comment}{//Loop until the NULL character is reached}
1060       \} \textcolor{keywordflow}{while}(context->protocolList[i++] != \textcolor{charliteral}{'\(\backslash\)0'});
1061    \}
1062 \textcolor{preprocessor}{#endif}
1063 
1064    \textcolor{comment}{//Return TRUE if the specified protocol is supported}
1065    \textcolor{keywordflow}{return} supported;
1066 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__extensions_8c_a44cc44e114cbc3c28245bdfa6546cb5c}\label{tls__extensions_8c_a44cc44e114cbc3c28245bdfa6546cb5c}} 
\index{tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}!tls\+Parse\+Hello\+Extensions@{tls\+Parse\+Hello\+Extensions}}
\index{tls\+Parse\+Hello\+Extensions@{tls\+Parse\+Hello\+Extensions}!tls\+\_\+extensions.\+c@{tls\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Hello\+Extensions()}{tlsParseHelloExtensions()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Hello\+Extensions (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9b}{Tls\+Message\+Type}}]{msg\+Type,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structTlsHelloExtensions}{Tls\+Hello\+Extensions} $\ast$}]{extensions }\end{DoxyParamCaption})}



Parse Hello extensions. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em msg\+Type} & Handshake message type \\
\hline
\mbox{\tt in}  & {\em p} & Input stream where to read the list of extensions \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em extensions} & List of Hello extensions resulting from the parsing process \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 57 of file tls\+\_\+extensions.\+c.


\begin{DoxyCode}
59 \{
60    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
61    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
62    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
63    \textcolor{keyword}{const} \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
64    \textcolor{keyword}{const} \hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList} *extensionList;
65 
66    \textcolor{comment}{//Initialize TLS extensions}
67    memset(extensions, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTlsHelloExtensions}{TlsHelloExtensions}));
68 
69    \textcolor{comment}{//Check message type}
70    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} || \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == 
      \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO})
71    \{
72       \textcolor{comment}{//The implementation must accept messages both with and without the}
73       \textcolor{comment}{//extensions field}
74       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == 0)
75       \{
76          \textcolor{comment}{//The extensions field is not present}
77          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
78       \}
79    \}
80 
81    \textcolor{comment}{//Point to the list of extensions}
82    extensionList = (\hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
83 
84    \textcolor{comment}{//Malformed message?}
85    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList}))
86       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
87 
88    \textcolor{comment}{//If the amount of data in the message does not precisely match the format}
89    \textcolor{comment}{//of the message, then send a fatal alert}
90    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extensionList->length)))
91       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
92 
93    \textcolor{comment}{//Point to the first extension of the list}
94    \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList});
95    \textcolor{comment}{//Retrieve the length of the list}
96    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a7bbdd7bf690ae50dd1106ebc0bd92b0c}{TlsExtensionList});
97 
98    \textcolor{comment}{//Parse the list of extensions offered by the peer}
99    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
100    \{
101       \textcolor{comment}{//Point to the current extension}
102       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
103 
104       \textcolor{comment}{//Check the length of the extension}
105       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}))
106          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
107       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->length)))
108          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
109 
110       \textcolor{comment}{//Get extension type}
111       type = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->type);
112       \textcolor{comment}{//Retrieve the length of the extension}
113       n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(extension->length);
114 
115       \textcolor{comment}{//Jump to the next extension}
116       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + n;
117       \textcolor{comment}{//Number of bytes left to process}
118       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension}) + n;
119 
120       \textcolor{comment}{//Test if the current extension is a duplicate}
121       error = \hyperlink{tls__extensions_8c_af9ead181a4adec8f8c0cced6bd0b70e6}{tlsCheckDuplicateExtension}(type, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
122       \textcolor{comment}{//Duplicate extension found?}
123       \textcolor{keywordflow}{if}(error)
124          \textcolor{keywordflow}{return} error;
125 
126       \textcolor{comment}{//When multiple extensions of different types are present in the ClientHello}
127       \textcolor{comment}{//or ServerHello messages, the extensions may appear in any order}
128       \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a83028c78d0fca0376acb719c27fb1e6a}{TLS\_EXT\_SUPPORTED\_VERSIONS})
129       \{
130          \textcolor{comment}{//Check message type}
131          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
132          \{
133             \textcolor{keyword}{const} \hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{TlsSupportedVersionList} *supportedVersionList;
134 
135             \textcolor{comment}{//Point to the SupportedVersions extension}
136             supportedVersionList = (\hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{TlsSupportedVersionList} *) extension->value;
137 
138             \textcolor{comment}{//Malformed extension?}
139             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{TlsSupportedVersionList}))
140                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
141             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{TlsSupportedVersionList}) + supportedVersionList->length)
      )
142                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
143 
144             \textcolor{comment}{//Check the length of the list}
145             \textcolor{keywordflow}{if}(supportedVersionList->length == 0)
146                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
147             \textcolor{keywordflow}{if}((supportedVersionList->length % 2) != 0)
148                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
149 
150             \textcolor{comment}{//The SupportedVersions extension is valid}
151             extensions->\hyperlink{structTlsHelloExtensions_ad2c1f8bd3e6432fe17b9ac339fc35a0b}{supportedVersionList} = supportedVersionList;
152          \}
153          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO} ||
154             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST})
155          \{
156             \textcolor{comment}{//The extension contains the selected version value}
157             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}))
158                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
159 
160             \textcolor{comment}{//The SupportedVersions extension is valid}
161             extensions->\hyperlink{structTlsHelloExtensions_a3fcdd9177ae16d800a0c7de6a6a45786}{selectedVersion} = extension->value;
162          \}
163          \textcolor{keywordflow}{else}
164          \{
165             \textcolor{comment}{//The extension is not specified for the message in which it appears}
166             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
167          \}
168       \}
169       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7ad7a6fff7cdad82f0dd2601d0f3d0cd27}{TLS\_EXT\_SERVER\_NAME})
170       \{
171          \textcolor{keyword}{const} \hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{TlsServerNameList} *serverNameList;
172 
173          \textcolor{comment}{//Point to the ServerName extension}
174          serverNameList = (\hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{TlsServerNameList} *) extension->value;
175 
176          \textcolor{comment}{//Empty extension?}
177          \textcolor{keywordflow}{if}(n == 0)
178          \{
179             \textcolor{comment}{//When the server includes a ServerName extension, the data field}
180             \textcolor{comment}{//of this extension may be empty}
181             \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
182                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
183          \}
184          \textcolor{keywordflow}{else}
185          \{
186             \textcolor{comment}{//Malformed extension?}
187             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{TlsServerNameList}))
188                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
189             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{TlsServerNameList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverNameList->length)))
190                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
191 
192             \textcolor{comment}{//Check the length of the list}
193             \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverNameList->length) == 0)
194                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
195          \}
196 
197          \textcolor{comment}{//The ServerName extension is valid}
198          extensions->\hyperlink{structTlsHelloExtensions_a53acaa1dcce86449741ea9a780331d46}{serverNameList} = serverNameList;
199       \}
200       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7ac6f999fb6a46da62edab19585132600e}{TLS\_EXT\_SUPPORTED\_GROUPS})
201       \{
202          \textcolor{keyword}{const} \hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{TlsSupportedGroupList} *supportedGroupList;
203 
204          \textcolor{comment}{//Point to the SupportedGroups extension}
205          supportedGroupList = (\hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{TlsSupportedGroupList} *) extension->value;
206 
207          \textcolor{comment}{//Malformed extension?}
208          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{TlsSupportedGroupList}))
209             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
210          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{TlsSupportedGroupList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(supportedGroupList->
      length)))
211             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
212 
213          \textcolor{comment}{//Check the length of the list}
214          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(supportedGroupList->length) == 0)
215             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
216          \textcolor{keywordflow}{if}((\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(supportedGroupList->length) % 2) != 0)
217             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
218 
219          \textcolor{comment}{//The SupportedGroups extension is valid}
220          extensions->\hyperlink{structTlsHelloExtensions_ae47ac6a93d2836418dc163d299e46cf7}{supportedGroupList} = supportedGroupList;
221       \}
222       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a9a3f8f880b4549fc336d1938d3ac54c2}{TLS\_EXT\_EC\_POINT\_FORMATS})
223       \{
224          \textcolor{keyword}{const} \hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList} *ecPointFormatList;
225 
226          \textcolor{comment}{//Point to the EcPointFormats extension}
227          ecPointFormatList = (\hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList} *) extension->value;
228 
229          \textcolor{comment}{//Malformed extension?}
230          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList}))
231             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
232          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList}) + ecPointFormatList->length))
233             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
234 
235          \textcolor{comment}{//Check the length of the list}
236          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(ecPointFormatList->length) == 0)
237             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
238 
239          \textcolor{comment}{//The EcPointFormats extension is valid}
240          extensions->\hyperlink{structTlsHelloExtensions_aeea7fd9313f97525e78c56a722b0dcfd}{ecPointFormatList} = ecPointFormatList;
241       \}
242       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a7eb2061b5b5c2690b4458f1d162e5dac}{TLS\_EXT\_SIGNATURE\_ALGORITHMS})
243       \{
244          \textcolor{keyword}{const} \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *signAlgoList;
245 
246          \textcolor{comment}{//Point to the SignatureAlgorithms extension}
247          signAlgoList = (\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *) extension->value;
248 
249          \textcolor{comment}{//Malformed extension?}
250          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos}))
251             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
252          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signAlgoList->length)))
253             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
254 
255          \textcolor{comment}{//Check the length of the list}
256          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signAlgoList->length) == 0)
257             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
258          \textcolor{keywordflow}{if}((\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signAlgoList->length) % 2) != 0)
259             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
260 
261          \textcolor{comment}{//The SignatureAlgorithms extension is valid}
262          extensions->\hyperlink{structTlsHelloExtensions_a7903ad9cf319d5f27990432c4e719544}{signAlgoList} = signAlgoList;
263       \}
264       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a12873cfa8f4d5499d80bbb1abafb08a1}{TLS\_EXT\_SIGNATURE\_ALGORITHMS\_CERT})
265       \{
266          \textcolor{keyword}{const} \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *certSignAlgoList;
267 
268          \textcolor{comment}{//Point to the SignatureAlgorithmsCert extension}
269          certSignAlgoList = (\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *) extension->value;
270 
271          \textcolor{comment}{//Malformed extension?}
272          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos}))
273             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
274          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(certSignAlgoList->length)))
275             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
276 
277          \textcolor{comment}{//Check the length of the list}
278          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(certSignAlgoList->length) == 0)
279             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
280          \textcolor{keywordflow}{if}((\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(certSignAlgoList->length) % 2) != 0)
281             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
282 
283          \textcolor{comment}{//The SignatureAlgorithmsCert extension is valid}
284          extensions->\hyperlink{structTlsHelloExtensions_a640637c05b8aec2ef15420d5005830cb}{certSignAlgoList} = certSignAlgoList;
285       \}
286 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
287       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a4a4ee70b35190ddeacec1a6d68286dab}{TLS\_EXT\_MAX\_FRAGMENT\_LENGTH})
288       \{
289          \textcolor{comment}{//Malformed extension?}
290          \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}))
291             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
292 
293          \textcolor{comment}{//The MaxFragmentLength extension is valid}
294          extensions->\hyperlink{structTlsHelloExtensions_a45f3337429c669574aaedfcc6a1a2d23}{maxFragLen} = extension->value;
295       \}
296 \textcolor{preprocessor}{#endif}
297 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
298       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7aa248475139394e15aa9a3fab1feabc83}{TLS\_EXT\_RECORD\_SIZE\_LIMIT})
299       \{
300          \textcolor{comment}{//Malformed extension?}
301          \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}))
302             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
303 
304          \textcolor{comment}{//The RecordSizeLimit extension is valid}
305          extensions->\hyperlink{structTlsHelloExtensions_a35167138c60de81d1635fc1d87fc3b8f}{recordSizeLimit} = extension->value;
306       \}
307 \textcolor{preprocessor}{#endif}
308 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
309       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7acd549b6d27b86af438c5da5b481277a7}{TLS\_EXT\_ALPN})
310       \{
311          \textcolor{keyword}{const} \hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList} *protocolNameList;
312 
313          \textcolor{comment}{//Point to the ALPN extension}
314          protocolNameList = (\hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList} *) extension->value;
315 
316          \textcolor{comment}{//Malformed extension?}
317          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList}))
318             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
319          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(protocolNameList->length)))
320             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
321 
322          \textcolor{comment}{//The ALPN extension is valid}
323          extensions->\hyperlink{structTlsHelloExtensions_a0752d52c09a933f5b001385db60159b1}{protocolNameList} = protocolNameList;
324       \}
325 \textcolor{preprocessor}{#endif}
326 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
327       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a643926386cd2016b4832014c859b6e75}{TLS\_EXT\_CLIENT\_CERT\_TYPE})
328       \{
329          \textcolor{comment}{//Check message type}
330          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
331          \{
332             \textcolor{keyword}{const} \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList} *clientCertTypeList;
333 
334             \textcolor{comment}{//Point to the ClientCertType extension}
335             clientCertTypeList = (\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList} *) extension->value;
336 
337             \textcolor{comment}{//Malformed extension?}
338             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList}))
339                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
340             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList}) + clientCertTypeList->length))
341                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
342 
343             \textcolor{comment}{//The ClientCertType extension is valid}
344             extensions->\hyperlink{structTlsHelloExtensions_a3091449503c4dcce58f3e62d70c24cd0}{clientCertTypeList} = clientCertTypeList;
345          \}
346          \textcolor{keywordflow}{else}
347          \{
348             \textcolor{comment}{//Only a single value is permitted in the ClientCertType extension}
349             \textcolor{comment}{//when carried in the ServerHello}
350             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}))
351                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
352 
353             \textcolor{comment}{//The ClientCertType extension is valid}
354             extensions->\hyperlink{structTlsHelloExtensions_a763ae23601c4eb7b1ec11230ef1f88ed}{clientCertType} = extension->value;
355          \}
356       \}
357       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a5be7581b64f1ed6051200823629ca71b}{TLS\_EXT\_SERVER\_CERT\_TYPE})
358       \{
359          \textcolor{comment}{//Check message type}
360          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
361          \{
362             \textcolor{keyword}{const} \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList} *serverCertTypeList;
363 
364             \textcolor{comment}{//Point to the ServerCertType extension}
365             serverCertTypeList = (\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList} *) extension->value;
366 
367             \textcolor{comment}{//Malformed extension?}
368             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList}))
369                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
370             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{TlsCertTypeList}) + serverCertTypeList->length))
371                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
372 
373             \textcolor{comment}{//The ServerCertType extension is valid}
374             extensions->\hyperlink{structTlsHelloExtensions_a7e4a609ad6013ea6bcab97286320cf16}{serverCertTypeList} = serverCertTypeList;
375          \}
376          \textcolor{keywordflow}{else}
377          \{
378             \textcolor{comment}{//Only a single value is permitted in the ServerCertType extension}
379             \textcolor{comment}{//when carried in the ServerHello}
380             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}))
381                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
382 
383             \textcolor{comment}{//The ServerCertType extension is valid}
384             extensions->\hyperlink{structTlsHelloExtensions_a2a473c126ac51cf3dd2e999ee6881186}{serverCertType} = extension->value;
385          \}
386       \}
387 \textcolor{preprocessor}{#endif}
388 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
389       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7af66b97b46e6480db2e6b87ab700de152}{TLS\_EXT\_EXTENDED\_MASTER\_SECRET})
390       \{
391          \textcolor{comment}{//Malformed extension?}
392          \textcolor{keywordflow}{if}(n != 0)
393             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
394 
395          \textcolor{comment}{//The ExtendedMasterSecret extension is valid}
396          extensions->\hyperlink{structTlsHelloExtensions_a04cc0ffcf992700820ec12d6f43212bf}{extendedMasterSecret} = extension->value;
397       \}
398 \textcolor{preprocessor}{#endif}
399 \textcolor{preprocessor}{#if (TLS\_SECURE\_RENEGOTIATION\_SUPPORT == ENABLED)}
400       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a10b93b38aef9aea795816607063e5d98}{TLS\_EXT\_RENEGOTIATION\_INFO})
401       \{
402          \textcolor{keyword}{const} \hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo} *renegoInfo;
403 
404          \textcolor{comment}{//Point to the RenegotiationInfo extension}
405          renegoInfo = (\hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo} *) extension->value;
406 
407          \textcolor{comment}{//Malformed extension?}
408          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo}))
409             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
410          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo}) + renegoInfo->length))
411             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
412 
413          \textcolor{comment}{//The RenegotiationInfo extension is valid}
414          extensions->\hyperlink{structTlsHelloExtensions_aecf5a78a44bd06ba8018bd5f4a5043de}{renegoInfo} = renegoInfo;
415       \}
416 \textcolor{preprocessor}{#endif}
417 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
418       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7acce4c7a5b9ef5ebb4a57dbea5bad348f}{TLS\_EXT\_COOKIE})
419       \{
420          \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a4061a8890d8f77884fab3eab1a4df7c0}{Tls13Cookie} *\hyperlink{dtls__misc_8h_a126a9f1c8e75ec207f319533d142c88d}{cookie};
421 
422          \textcolor{comment}{//Point to the Cookie extension}
423          cookie = (\hyperlink{tls13__misc_8h_a4061a8890d8f77884fab3eab1a4df7c0}{Tls13Cookie} *) extension->value;
424 
425          \textcolor{comment}{//Malformed extension?}
426          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a4061a8890d8f77884fab3eab1a4df7c0}{Tls13Cookie}))
427             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
428          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a4061a8890d8f77884fab3eab1a4df7c0}{Tls13Cookie}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(cookie->length)))
429             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
430 
431          \textcolor{comment}{//Check the length of the cookie}
432          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(cookie->length) == 0)
433             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
434 
435          \textcolor{comment}{//The Cookie extension is valid}
436          extensions->cookie = \hyperlink{dtls__misc_8h_a126a9f1c8e75ec207f319533d142c88d}{cookie};
437       \}
438       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a65adf60815c7ea87db436dda6149a7bb}{TLS\_EXT\_KEY\_SHARE})
439       \{
440          \textcolor{comment}{//Check message type}
441          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
442          \{
443             \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
444             \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
445             \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a59848320843680d72a84bb380e59ea4b}{Tls13KeyShareList} *keyShareList;
446             \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry} *keyShareEntry;
447 
448             \textcolor{comment}{//The extension contains a list of offered KeyShareEntry values}
449             \textcolor{comment}{//in descending order of client preference}
450             keyShareList = (\hyperlink{tls13__misc_8h_a59848320843680d72a84bb380e59ea4b}{Tls13KeyShareList} *) extension->value;
451 
452             \textcolor{comment}{//Malformed extension?}
453             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a59848320843680d72a84bb380e59ea4b}{Tls13KeyShareList}))
454                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
455             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a59848320843680d72a84bb380e59ea4b}{Tls13KeyShareList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(keyShareList->length)))
456                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
457 
458             \textcolor{comment}{//Point to the first KeyShareEntry of the list}
459             \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} = keyShareList->value;
460             \textcolor{comment}{//Retrieve the length of the list}
461             m = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(keyShareList->length);
462 
463             \textcolor{comment}{//Parse the list of key share entries offered by the peer}
464             \textcolor{keywordflow}{while}(m > 0)
465             \{
466                \textcolor{comment}{//Malformed extension?}
467                \textcolor{keywordflow}{if}(m < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}))
468                   \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
469 
470                \textcolor{comment}{//Point to the current key share entry}
471                keyShareEntry = (\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
472                \textcolor{comment}{//Retrieve the length of the key\_exchange field}
473                k = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(keyShareEntry->length);
474 
475                \textcolor{comment}{//Malformed extension?}
476                \textcolor{keywordflow}{if}(m < (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}) + k))
477                   \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
478 
479                \textcolor{comment}{//Point to the next entry}
480                \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}) + k;
481                \textcolor{comment}{//Remaining bytes to process}
482                m -= \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}) + k;
483 
484                \textcolor{comment}{//Clients must not offer multiple KeyShareEntry values for the}
485                \textcolor{comment}{//same group. Servers may check for violations of this rule and}
486                \textcolor{comment}{//abort the handshake with an illegal\_parameter alert}
487                error = \hyperlink{tls13__misc_8h_ad4e80d5feac74a31dcad480164ad1f29}{tls13CheckDuplicateKeyShare}(
      \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(keyShareEntry->group),
488                   \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, m);
489                \textcolor{comment}{//Any error to report?}
490                \textcolor{keywordflow}{if}(error)
491                   \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
492             \}
493 
494             \textcolor{comment}{//The KeyShare extension is valid}
495             extensions->keyShareList = keyShareList;
496          \}
497          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST})
498          \{
499             \textcolor{comment}{//The extension contains the mutually supported group the server}
500             \textcolor{comment}{//intends to negotiate}
501             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}))
502                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
503 
504             \textcolor{comment}{//The KeyShare extension is valid}
505             extensions->selectedGroup = extension->value;
506          \}
507          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO})
508          \{
509             \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry} *serverShare;
510 
511             \textcolor{comment}{//The extension contains a single KeyShareEntry value that is in}
512             \textcolor{comment}{//the same group as one of the client's shares}
513             serverShare = (\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry} *) extension->value;
514 
515             \textcolor{comment}{//Malformed extension?}
516             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}))
517                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
518             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a6122636c0731df4f9dd513a7aed7d8ec}{Tls13KeyShareEntry}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverShare->length)))
519                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
520 
521             \textcolor{comment}{//The KeyShare extension is valid}
522             extensions->serverShare = serverShare;
523          \}
524          \textcolor{keywordflow}{else}
525          \{
526             \textcolor{comment}{//The extension is not specified for the message in which it appears}
527 \textcolor{preprocessor}{#if (TLS\_MAX\_EMPTY\_RECORDS > 0)}
528             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca0024b1359f3a168578a6cf9da0ca4564}{ERROR\_UNSUPPORTED\_EXTENSION};
529 \textcolor{preprocessor}{#else}
530             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
531 \textcolor{preprocessor}{#endif}
532          \}
533       \}
534       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7acd04a84ef7d95820b869faa685815149}{TLS\_EXT\_PSK\_KEY\_EXCHANGE\_MODES})
535       \{
536          \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_ab09e993b3f374156547ac9cf9d4f2cb4}{Tls13PskKeModeList} *pskKeModeList;
537 
538          \textcolor{comment}{//The extension contains the list of PSK key exchange modes that}
539          \textcolor{comment}{//are supported by the client}
540          pskKeModeList = (\hyperlink{tls13__misc_8h_ab09e993b3f374156547ac9cf9d4f2cb4}{Tls13PskKeModeList} *) extension->value;
541 
542          \textcolor{comment}{//Malformed extension?}
543          \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_ab09e993b3f374156547ac9cf9d4f2cb4}{Tls13PskKeModeList}))
544             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
545          \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_ab09e993b3f374156547ac9cf9d4f2cb4}{Tls13PskKeModeList}) + pskKeModeList->length))
546             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
547 
548          \textcolor{comment}{//The PskKeyExchangeModes extension is valid}
549          extensions->pskKeModeList = pskKeModeList;
550       \}
551       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a4a24a57e876e64ba5e54109dd128d980}{TLS\_EXT\_PRE\_SHARED\_KEY})
552       \{
553          \textcolor{comment}{//Check message type}
554          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO})
555          \{
556             \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList} *identityList;
557             \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_adfca71a634ceaf319dacca4f6283a252}{Tls13PskBinderList} *binderList;
558 
559             \textcolor{comment}{//The PreSharedKey extension must be the last extension in the}
560             \textcolor{comment}{//ClientHello. Servers must check that it is the last extension and}
561             \textcolor{comment}{//otherwise fail the handshake with an illegal\_parameter alert}
562             \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
563                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
564 
565             \textcolor{comment}{//The extension contains a list of the identities that the client}
566             \textcolor{comment}{//is willing to negotiate with the server}
567             identityList = (\hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList} *) extension->value;
568 
569             \textcolor{comment}{//Malformed extension?}
570             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList}))
571                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
572             \textcolor{keywordflow}{if}(n < (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(identityList->length)))
573                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
574 
575             \textcolor{comment}{//Remaining bytes to process}
576             n -= \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(identityList->length);
577 
578             \textcolor{comment}{//The extension also contains a series of HMAC values, one for each}
579             \textcolor{comment}{//PSK offered in the PreSharedKey extension and in the same order}
580             binderList = (\hyperlink{tls13__misc_8h_adfca71a634ceaf319dacca4f6283a252}{Tls13PskBinderList} *) (extension->value +
581                \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7db8d1dd46888d594a416a309fe019b4}{Tls13PskIdentityList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(identityList->length));
582 
583             \textcolor{comment}{//Malformed extension?}
584             \textcolor{keywordflow}{if}(n < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_adfca71a634ceaf319dacca4f6283a252}{Tls13PskBinderList}))
585                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
586             \textcolor{keywordflow}{if}(n != (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_adfca71a634ceaf319dacca4f6283a252}{Tls13PskBinderList}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(binderList->length)))
587                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
588 
589             \textcolor{comment}{//The PreSharedKey extension is valid}
590             extensions->identityList = identityList;
591             extensions->binderList = binderList;
592          \}
593          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO})
594          \{
595             \textcolor{comment}{//The extension contains the chosen identity expressed as a 0-based}
596             \textcolor{comment}{//index into the identities in the client's list}
597             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}))
598                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
599 
600             \textcolor{comment}{//The PreSharedKey extension is valid}
601             extensions->selectedIdentity = extension->value;
602          \}
603          \textcolor{keywordflow}{else}
604          \{
605             \textcolor{comment}{//The extension is not specified for the message in which it appears}
606             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
607          \}
608       \}
609       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a3267e170c7948a10bc895cddfa133cd0}{TLS\_EXT\_EARLY\_DATA})
610       \{
611          \textcolor{comment}{//Check message type}
612          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8}{TLS\_TYPE\_CLIENT\_HELLO} ||
613             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
614          \{
615             \textcolor{comment}{//The extension data field is empty}
616             \textcolor{keywordflow}{if}(n != 0)
617                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
618          \}
619          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9badd2d0307b59249022f09225e97228e94}{TLS\_TYPE\_NEW\_SESSION\_TICKET})
620          \{
621             \textcolor{comment}{//The extension data field contains an unsigned 32-bit integer}
622             \textcolor{keywordflow}{if}(n != \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}))
623                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
624          \}
625          \textcolor{keywordflow}{else}
626          \{
627             \textcolor{comment}{//The extension is not specified for the message in which it appears}
628             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
629          \}
630 
631          \textcolor{comment}{//The EarlyData extension is valid}
632          extensions->earlyDataIndication = extension->value;
633       \}
634 \textcolor{preprocessor}{#endif}
635       \textcolor{keywordflow}{else}
636       \{
637          \textcolor{comment}{//If a client receives an extension type in the ServerHello that it}
638          \textcolor{comment}{//did not request in the associated ClientHello, it must abort the}
639          \textcolor{comment}{//handshake with an unsupported\_extension fatal alert}
640          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac}{TLS\_TYPE\_SERVER\_HELLO} ||
641             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bafcc816b30d57023bd99b1ac1dec2a870}{TLS\_TYPE\_HELLO\_RETRY\_REQUEST} ||
642             \hyperlink{dtls__misc_8h_a9d7facd71a8c8355a77006f5a6dcd420}{msgType} == \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baca1f58dfb4bcf29b9b5097ddb72189d8}{TLS\_TYPE\_ENCRYPTED\_EXTENSIONS})
643          \{
644             \textcolor{comment}{//Report an error}
645             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca0024b1359f3a168578a6cf9da0ca4564}{ERROR\_UNSUPPORTED\_EXTENSION};
646          \}
647       \}
648    \}
649 
650    \textcolor{comment}{//Successful processing}
651    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
652 \}
\end{DoxyCode}
