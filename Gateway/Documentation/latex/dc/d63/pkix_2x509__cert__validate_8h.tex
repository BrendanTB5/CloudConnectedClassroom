\hypertarget{pkix_2x509__cert__validate_8h}{}\section{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+validate.h File Reference}
\label{pkix_2x509__cert__validate_8h}\index{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+validate.\+h@{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+validate.\+h}}
{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+common.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_a1d829c42c03a21d7d0325d214db51f0d}{x509\+Validate\+Certificate} (const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info, const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$issuer\+Cert\+Info, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} path\+Len)
\begin{DoxyCompactList}\small\item\em X.\+509 certificate validation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_ac72ef1917acb42ac1e984731723c7e57}{x509\+Check\+Subject\+Name} (const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$fqdn)
\begin{DoxyCompactList}\small\item\em Check whether the certificate matches the specified F\+Q\+DN. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_aba02729cea03e1500a1839c15d1f1149}{x509\+Check\+Name\+Constraints} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subject\+Name, const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info)
\begin{DoxyCompactList}\small\item\em Check name constraints. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_ac0134610dc71d5ff612ac1bc609b7981}{x509\+Compare\+Name} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$name1, size\+\_\+t name\+Len1, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$name2, size\+\_\+t name\+Len2)
\begin{DoxyCompactList}\small\item\em Compare distinguished names. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_a6f02ee13e1ab2c2e2bce2e1ce4ba732d}{x509\+Compare\+Subject\+Name} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subject\+Name, size\+\_\+t subject\+Name\+Len, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$fqdn)
\begin{DoxyCompactList}\small\item\em Check whether the subject name matches the specified F\+Q\+DN. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_a36490c38bb9d95c4959e422ccf8398f8}{x509\+Compare\+Subtree} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subject\+Name, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subtree, size\+\_\+t subtree\+Len)
\begin{DoxyCompactList}\small\item\em Compare a subject name against the specified subtree. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkix_2x509__cert__validate_8h_a1d8215100a2199ceac838bb36ad392bf}{x509\+Verify\+Signature} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$tbs\+Cert, size\+\_\+t tbs\+Cert\+Len, const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo\+Id, const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$public\+Key\+Info, const \hyperlink{structX509SignatureValue}{X509\+Signature\+Value} $\ast$signature\+Value)
\begin{DoxyCompactList}\small\item\em Certificate signature verification. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_aba02729cea03e1500a1839c15d1f1149}\label{pkix_2x509__cert__validate_8h_aba02729cea03e1500a1839c15d1f1149}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Check\+Name\+Constraints@{x509\+Check\+Name\+Constraints}}
\index{x509\+Check\+Name\+Constraints@{x509\+Check\+Name\+Constraints}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Check\+Name\+Constraints()}{x509CheckNameConstraints()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Check\+Name\+Constraints (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subject\+Name,  }\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info }\end{DoxyParamCaption})}



Check name constraints. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em subject\+Name} & Subject name to be verified \\
\hline
\mbox{\tt in}  & {\em cert\+Info} & Pointer to the CA certificate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 542 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
544 \{
545    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
546    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
547    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
548    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
549    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data};
550    \hyperlink{structX509GeneralName}{X509GeneralName} subtree;
551 
552    \textcolor{comment}{//Initialize error code}
553    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
554 
555    \textcolor{comment}{//Valid subject name provided?}
556    \textcolor{keywordflow}{if}(subjectName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
557    \{
558       \textcolor{comment}{//Point to the list of excluded name subtrees}
559       data = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a25c09f610754fe740c393867ee9950a9}{nameConstraints}.
      \hyperlink{structX509NameConstraints_a187e11b65d21e9eb4c9124c133c0fbbc}{excludedSubtrees};
560       length = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a25c09f610754fe740c393867ee9950a9}{nameConstraints}.
      \hyperlink{structX509NameConstraints_a5f03d1d2e8b8eddf4f1e99bbb61254af}{excludedSubtreesLen};
561 
562       \textcolor{comment}{//Loop through the names constraints}
563       \textcolor{keywordflow}{while}(length > 0)
564       \{
565          \textcolor{comment}{//Parse GeneralSubtree field}
566          error = \hyperlink{certificate_2x509__cert__parse_8c_a9195227eeefd0a4135989aae9be08082}{x509ParseGeneralSubtree}(data, length, &n, &subtree);
567          \textcolor{comment}{//Failed to decode ASN.1 tag?}
568          \textcolor{keywordflow}{if}(error)
569             \textcolor{keywordflow}{break};
570 
571          \textcolor{comment}{//DNS host name or DNS domain?}
572          \textcolor{keywordflow}{if}(subtree.\hyperlink{structX509GeneralName_a014e3358c1ab42d4da4cd2535d59f05f}{type} == \hyperlink{certificate_2x509__common_8h_a6a82f43a61ee7a3e18d71f986d7f9a59a003e302836639dc17ee9796f98700a24}{X509\_GENERAL\_NAME\_TYPE\_DNS})
573          \{
574             \textcolor{comment}{//Check whether the subject name matches the subtree}
575             res = \hyperlink{certificate_2x509__cert__validate_8c_a36490c38bb9d95c4959e422ccf8398f8}{x509CompareSubtree}(subjectName, subtree.
      \hyperlink{structX509GeneralName_a00814b3509e1b708f019a645511e3d3a}{value}, subtree.\hyperlink{structX509GeneralName_a2804f41c9ae3cf1fb375b1d222d4f3af}{length});
576             \textcolor{comment}{//Any match?}
577             \textcolor{keywordflow}{if}(res)
578             \{
579                \textcolor{comment}{//The subject name is not acceptable}
580                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae70a08cf0e3bf6240f67e1c63bcbda2c}{ERROR\_INVALID\_NAME};
581                \textcolor{keywordflow}{break};
582             \}
583          \}
584 
585          \textcolor{comment}{//Next item}
586          data += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
587          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
588       \}
589 
590       \textcolor{comment}{//Point to the list of permitted name subtrees}
591       data = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a25c09f610754fe740c393867ee9950a9}{nameConstraints}.
      \hyperlink{structX509NameConstraints_a156421797fb4821bee39cfc265a0c2da}{permittedSubtrees};
592       length = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a25c09f610754fe740c393867ee9950a9}{nameConstraints}.
      \hyperlink{structX509NameConstraints_aaada0ccb4f22f65db2b71493b14327c0}{permittedSubtreesLen};
593 
594       \textcolor{comment}{//Loop through the names constraints}
595       \textcolor{keywordflow}{while}(length > 0)
596       \{
597          \textcolor{comment}{//Parse GeneralSubtree field}
598          error = \hyperlink{certificate_2x509__cert__parse_8c_a9195227eeefd0a4135989aae9be08082}{x509ParseGeneralSubtree}(data, length, &n, &subtree);
599          \textcolor{comment}{//Failed to decode ASN.1 tag?}
600          \textcolor{keywordflow}{if}(error)
601             \textcolor{keywordflow}{break};
602 
603          \textcolor{comment}{//Assume an error}
604          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae70a08cf0e3bf6240f67e1c63bcbda2c}{ERROR\_INVALID\_NAME};
605 
606          \textcolor{comment}{//DNS host name or DNS domain?}
607          \textcolor{keywordflow}{if}(subtree.\hyperlink{structX509GeneralName_a014e3358c1ab42d4da4cd2535d59f05f}{type} == \hyperlink{certificate_2x509__common_8h_a6a82f43a61ee7a3e18d71f986d7f9a59a003e302836639dc17ee9796f98700a24}{X509\_GENERAL\_NAME\_TYPE\_DNS})
608          \{
609             \textcolor{comment}{//Check whether the subject name matches the subtree}
610             res = \hyperlink{certificate_2x509__cert__validate_8c_a36490c38bb9d95c4959e422ccf8398f8}{x509CompareSubtree}(subjectName, subtree.
      \hyperlink{structX509GeneralName_a00814b3509e1b708f019a645511e3d3a}{value}, subtree.\hyperlink{structX509GeneralName_a2804f41c9ae3cf1fb375b1d222d4f3af}{length});
611             \textcolor{comment}{//Any match?}
612             \textcolor{keywordflow}{if}(res)
613             \{
614                \textcolor{comment}{//The subject name is acceptable}
615                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
616                \textcolor{keywordflow}{break};
617             \}
618          \}
619 
620          \textcolor{comment}{//Next item}
621          data += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
622          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
623       \}
624    \}
625    \textcolor{keywordflow}{else}
626    \{
627       \textcolor{comment}{//If no valid subject name is provided, then the name constraints}
628       \textcolor{comment}{//are not verified}
629    \}
630 
631    \textcolor{comment}{//Return status code}
632    \textcolor{keywordflow}{return} error;
633 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_ac72ef1917acb42ac1e984731723c7e57}\label{pkix_2x509__cert__validate_8h_ac72ef1917acb42ac1e984731723c7e57}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Check\+Subject\+Name@{x509\+Check\+Subject\+Name}}
\index{x509\+Check\+Subject\+Name@{x509\+Check\+Subject\+Name}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Check\+Subject\+Name()}{x509CheckSubjectName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Check\+Subject\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{fqdn }\end{DoxyParamCaption})}



Check whether the certificate matches the specified F\+Q\+DN. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cert\+Info} & Pointer to the X.\+509 certificate \\
\hline
\mbox{\tt in}  & {\em fqdn} & N\+U\+L\+L-\/terminated string that contains the fully-\/qualified domain name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 450 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
452 \{
453    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
454    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
455    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
456    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
457    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
458    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data};
459    \hyperlink{structX509GeneralName}{X509GeneralName} generalName;
460 
461    \textcolor{comment}{//Valid FQDN name provided?}
462    \textcolor{keywordflow}{if}(fqdn != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
463    \{
464       \textcolor{comment}{//Initialize flag}
465       res = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
466 
467       \textcolor{comment}{//Total number of valid DNS names found in the SubjectAltName extension}
468       i = 0;
469 
470       \textcolor{comment}{//Valid SubjectAltName extension?}
471       \textcolor{keywordflow}{if}(certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a6a01ce6bc43517af604b8cf580ebd01d}{subjectAltName}.\hyperlink{structX509SubjectAltName_a87435ad32eda0d4b0a9229028521812b}{rawDataLen} > 0)
472       \{
473          \textcolor{comment}{//The subject alternative name extension allows identities to be bound}
474          \textcolor{comment}{//to the subject of the certificate. These identities may be included}
475          \textcolor{comment}{//in addition to or in place of the identity in the subject field of}
476          \textcolor{comment}{//the certificate}
477          data = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a6a01ce6bc43517af604b8cf580ebd01d}{subjectAltName}.
      \hyperlink{structX509SubjectAltName_a7d756442bef6565af58ede9410b2dc77}{rawData};
478          length = certInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_a6a01ce6bc43517af604b8cf580ebd01d}{subjectAltName}.
      \hyperlink{structX509SubjectAltName_a87435ad32eda0d4b0a9229028521812b}{rawDataLen};
479 
480          \textcolor{comment}{//Loop through the list of subject alternative names}
481          \textcolor{keywordflow}{while}(!res && length > 0)
482          \{
483             \textcolor{comment}{//Parse GeneralName field}
484             error = \hyperlink{certificate_2x509__cert__parse_8c_aa329c231ea14f7d8b61a64db46be87e1}{x509ParseGeneralName}(data, length, &n, &generalName);
485             \textcolor{comment}{//Failed to decode ASN.1 tag?}
486             \textcolor{keywordflow}{if}(error)
487                \textcolor{keywordflow}{return} error;
488 
489             \textcolor{comment}{//DNS name found?}
490             \textcolor{keywordflow}{if}(generalName.\hyperlink{structX509GeneralName_a014e3358c1ab42d4da4cd2535d59f05f}{type} == \hyperlink{certificate_2x509__common_8h_a6a82f43a61ee7a3e18d71f986d7f9a59a003e302836639dc17ee9796f98700a24}{X509\_GENERAL\_NAME\_TYPE\_DNS})
491             \{
492                \textcolor{comment}{//Check whether the alternative name matches the specified FQDN}
493                res = \hyperlink{certificate_2x509__cert__validate_8c_a6f02ee13e1ab2c2e2bce2e1ce4ba732d}{x509CompareSubjectName}(generalName.
      \hyperlink{structX509GeneralName_a00814b3509e1b708f019a645511e3d3a}{value},
494                   generalName.\hyperlink{structX509GeneralName_a2804f41c9ae3cf1fb375b1d222d4f3af}{length}, fqdn);
495 
496                \textcolor{comment}{//Increment counter}
497                i++;
498             \}
499 
500             \textcolor{comment}{//Next item}
501             data += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
502             length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
503          \}
504       \}
505 
506       \textcolor{comment}{//No match?}
507       \textcolor{keywordflow}{if}(!res)
508       \{
509          \textcolor{comment}{//The implementation must not seek a match for a reference identifier}
510          \textcolor{comment}{//of CN-ID if the presented identifiers include a DNS-ID, SRV-ID or}
511          \textcolor{comment}{//URI-ID (refer to RFC 6125, section 6.4.4)}
512          \textcolor{keywordflow}{if}(i == 0 && certInfo->\hyperlink{structX509CertificateInfo_adaf5e2c713f42a2ca307b2d4eed55a0e}{subject}.\hyperlink{structX509Name_a5c5af434bfa902d83cae8cec8af15581}{commonNameLen} > 0)
513          \{
514             \textcolor{comment}{//The implementation may as a last resort check the CN-ID for a match}
515             res = \hyperlink{certificate_2x509__cert__validate_8c_a6f02ee13e1ab2c2e2bce2e1ce4ba732d}{x509CompareSubjectName}(certInfo->\hyperlink{structX509CertificateInfo_adaf5e2c713f42a2ca307b2d4eed55a0e}{subject}.
      \hyperlink{structX509Name_a29948ef6424aa86551582e5bf7afa47a}{commonName},
516                certInfo->\hyperlink{structX509CertificateInfo_adaf5e2c713f42a2ca307b2d4eed55a0e}{subject}.\hyperlink{structX509Name_a5c5af434bfa902d83cae8cec8af15581}{commonNameLen}, fqdn);
517          \}
518       \}
519 
520       \textcolor{comment}{//Check whether the subject name matches the specified FQDN}
521       error = res ? \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} : \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae70a08cf0e3bf6240f67e1c63bcbda2c}{ERROR\_INVALID\_NAME};
522    \}
523    \textcolor{keywordflow}{else}
524    \{
525       \textcolor{comment}{//If no valid FQDN name is provided, then the subject name of the}
526       \textcolor{comment}{//certificate is not verified}
527       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
528    \}
529 
530    \textcolor{comment}{//Return status code}
531    \textcolor{keywordflow}{return} error;
532 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_ac0134610dc71d5ff612ac1bc609b7981}\label{pkix_2x509__cert__validate_8h_ac0134610dc71d5ff612ac1bc609b7981}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Compare\+Name@{x509\+Compare\+Name}}
\index{x509\+Compare\+Name@{x509\+Compare\+Name}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Compare\+Name()}{x509CompareName()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} x509\+Compare\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{name1,  }\item[{size\+\_\+t}]{name\+Len1,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{name2,  }\item[{size\+\_\+t}]{name\+Len2 }\end{DoxyParamCaption})}



Compare distinguished names. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em name1} & Pointer to the first distinguished name \\
\hline
\mbox{\tt in}  & {\em name\+Len1} & Length of the first distinguished name \\
\hline
\mbox{\tt in}  & {\em name2} & Pointer to the second distinguished name \\
\hline
\mbox{\tt in}  & {\em name\+Len2} & Length of the second distinguished name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Comparison result 
\end{DoxyReturn}


Definition at line 645 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
647 \{
648    \textcolor{comment}{//Compare the length of the distinguished names}
649    \textcolor{keywordflow}{if}(nameLen1 != nameLen2)
650       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
651 
652    \textcolor{comment}{//Compare the contents of the distinguished names}
653    \textcolor{keywordflow}{if}(\hyperlink{cyclone__crypto_2core_2crypto_8h_aad1b4995b60f205abd5d3f409e569a0c}{cryptoMemcmp}(name1, name2, nameLen1))
654       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
655 
656    \textcolor{comment}{//The distinguished names match}
657    \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
658 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_a6f02ee13e1ab2c2e2bce2e1ce4ba732d}\label{pkix_2x509__cert__validate_8h_a6f02ee13e1ab2c2e2bce2e1ce4ba732d}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Compare\+Subject\+Name@{x509\+Compare\+Subject\+Name}}
\index{x509\+Compare\+Subject\+Name@{x509\+Compare\+Subject\+Name}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Compare\+Subject\+Name()}{x509CompareSubjectName()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} x509\+Compare\+Subject\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subject\+Name,  }\item[{size\+\_\+t}]{subject\+Name\+Len,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{fqdn }\end{DoxyParamCaption})}



Check whether the subject name matches the specified F\+Q\+DN. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em subject\+Name} & Subject name \\
\hline
\mbox{\tt in}  & {\em subject\+Name\+Len} & Length of the subject name \\
\hline
\mbox{\tt in}  & {\em fqdn} & N\+U\+L\+L-\/terminated string that contains the fully-\/qualified domain name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the subject name matches the specified F\+Q\+DN, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 669 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
671 \{
672    \textcolor{keywordtype}{size\_t} i;
673    \textcolor{keywordtype}{size\_t} j;
674    \textcolor{keywordtype}{size\_t} fqdnLen;
675 
676    \textcolor{comment}{//Retrieve the length of the FQDN}
677    fqdnLen = \hyperlink{cyclone__crypto_2core_2crypto_8h_a60355e8a0b63bff69cedd877fc82c624}{cryptoStrlen}(fqdn);
678 
679    \textcolor{comment}{//Initialize variables}
680    i = 0;
681    j = 0;
682 
683    \textcolor{comment}{//Parse the subject name}
684    \textcolor{keywordflow}{while}(i < subjectNameLen && j < fqdnLen)
685    \{
686       \textcolor{comment}{//Wildcard name found?}
687       \textcolor{keywordflow}{if}(subjectName[i] == \textcolor{charliteral}{'*'})
688       \{
689          \textcolor{comment}{//The implementation should not attempt to match a presented}
690          \textcolor{comment}{//identifier in which the wildcard character comprises a label other}
691          \textcolor{comment}{//than the left-most label (refer to RFC 6125, section 6.4.3)}
692          \textcolor{keywordflow}{if}(i != 0)
693          \{
694             \textcolor{keywordflow}{break};
695          \}
696 
697          \textcolor{comment}{//The implementation should not compare against anything but the}
698          \textcolor{comment}{//left-most label of the reference identifier}
699          \textcolor{keywordflow}{if}(fqdn[j] == \textcolor{charliteral}{'.'})
700          \{
701             i++;
702          \}
703          \textcolor{keywordflow}{else}
704          \{
705             j++;
706          \}
707       \}
708       \textcolor{keywordflow}{else}
709       \{
710          \textcolor{comment}{//Perform case insensitive character comparison}
711          \textcolor{keywordflow}{if}(\hyperlink{cyclone__crypto_2core_2crypto_8h_a0b121504c7a981295bc221b2b9a4c03a}{cryptoTolower}(subjectName[i]) != fqdn[j])
712          \{
713             \textcolor{keywordflow}{break};
714          \}
715 
716          \textcolor{comment}{//Compare next characters}
717          i++;
718          j++;
719       \}
720    \}
721 
722    \textcolor{comment}{//Check whether the subject name matches the specified FQDN}
723    \textcolor{keywordflow}{if}(i == subjectNameLen && j == fqdnLen)
724       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
725    \textcolor{keywordflow}{else}
726       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
727 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_a36490c38bb9d95c4959e422ccf8398f8}\label{pkix_2x509__cert__validate_8h_a36490c38bb9d95c4959e422ccf8398f8}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Compare\+Subtree@{x509\+Compare\+Subtree}}
\index{x509\+Compare\+Subtree@{x509\+Compare\+Subtree}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Compare\+Subtree()}{x509CompareSubtree()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} x509\+Compare\+Subtree (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subject\+Name,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subtree,  }\item[{size\+\_\+t}]{subtree\+Len }\end{DoxyParamCaption})}



Compare a subject name against the specified subtree. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em subject\+Name} & N\+U\+L\+L-\/terminated string that contains the subject name \\
\hline
\mbox{\tt in}  & {\em subtree} & Pointer to the subtree \\
\hline
\mbox{\tt in}  & {\em subtree\+Len} & Length of the subtree \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Comparison result 
\end{DoxyReturn}


Definition at line 738 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
740 \{
741    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} i;
742    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} j;
743 
744    \textcolor{comment}{//Point to the last character of the subtree}
745    i = subtreeLen - 1;
746    \textcolor{comment}{//Point to the last character of the subject name}
747    j = \hyperlink{cyclone__crypto_2core_2crypto_8h_a60355e8a0b63bff69cedd877fc82c624}{cryptoStrlen}(subjectName) - 1;
748 
749    \textcolor{comment}{//Parse the subtree}
750    \textcolor{keywordflow}{while}(i >= 0 && j >= 0)
751    \{
752       \textcolor{comment}{//Perform case insensitive character comparison}
753       \textcolor{keywordflow}{if}(\hyperlink{cyclone__crypto_2core_2crypto_8h_a0b121504c7a981295bc221b2b9a4c03a}{cryptoTolower}(subtree[i]) != subjectName[j])
754       \{
755          \textcolor{keywordflow}{break};
756       \}
757 
758       \textcolor{comment}{//The constraint may specify a host or a domain}
759       \textcolor{keywordflow}{if}(subtree[i] == \textcolor{charliteral}{'.'} && i == 0)
760       \{
761          \textcolor{comment}{//When the constraint begins with a period, it may be expanded with}
762          \textcolor{comment}{//one or more labels (refer to RFC 5280, section 4.2.1.10)}
763          i = -1;
764          j = -1;
765       \}
766       \textcolor{keywordflow}{else}
767       \{
768          \textcolor{comment}{//Compare previous characters}
769          i--;
770          j--;
771       \}
772    \}
773 
774    \textcolor{comment}{//Check whether the subject name matches the specified subtree}
775    \textcolor{keywordflow}{if}(i < 0 && j < 0)
776       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
777    \textcolor{keywordflow}{else}
778       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
779 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_a1d829c42c03a21d7d0325d214db51f0d}\label{pkix_2x509__cert__validate_8h_a1d829c42c03a21d7d0325d214db51f0d}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Validate\+Certificate@{x509\+Validate\+Certificate}}
\index{x509\+Validate\+Certificate@{x509\+Validate\+Certificate}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Validate\+Certificate()}{x509ValidateCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Validate\+Certificate (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info,  }\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{issuer\+Cert\+Info,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{path\+Len }\end{DoxyParamCaption})}



X.\+509 certificate validation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cert\+Info} & X.\+509 certificate to be verified \\
\hline
\mbox{\tt in}  & {\em issuer\+Cert\+Info} & Issuer certificate \\
\hline
\mbox{\tt in}  & {\em path\+Len} & Certificate path length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 59 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
61 \{
62    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
63    time\_t currentTime;
64    \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078}{X509SignatureAlgo} signAlgo;
65    \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
66    \hyperlink{structHashContext}{HashContext} *hashContext;
67 
68    \textcolor{comment}{//Retrieve current time}
69    currentTime = \hyperlink{date__time_8c_a5ea5d60e1fafcd89917ee76d57981aae}{getCurrentUnixTime}();
70 
71    \textcolor{comment}{//Any real-time clock implemented?}
72    \textcolor{keywordflow}{if}(currentTime != 0)
73    \{
74       \hyperlink{structDateTime}{DateTime} currentDate;
75 
76       \textcolor{comment}{//Convert Unix timestamp to date}
77       \hyperlink{date__time_8c_adf6672c66ed1b93ea8bba616ae630a4b}{convertUnixTimeToDate}(currentTime, &currentDate);
78 
79       \textcolor{comment}{//Check the certificate validity period}
80       \textcolor{keywordflow}{if}(\hyperlink{date__time_8c_a2ed68acb2c0d1aa6d43a1f2ad835ee87}{compareDateTime}(&currentDate, &certInfo->\hyperlink{structX509CertificateInfo_aca3c2dbc54d2b8a711ed3b9c3c595fa8}{validity}.
      \hyperlink{structX509Validity_a54d94f88fced1072aaacb4824757aee0}{notBefore}) < 0 ||
81          \hyperlink{date__time_8c_a2ed68acb2c0d1aa6d43a1f2ad835ee87}{compareDateTime}(&currentDate, &certInfo->\hyperlink{structX509CertificateInfo_aca3c2dbc54d2b8a711ed3b9c3c595fa8}{validity}.
      \hyperlink{structX509Validity_a23debc3797b2921431fce9658ecc1b73}{notAfter}) > 0)
82       \{
83          \textcolor{comment}{//The certificate has expired or is not yet valid}
84          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa2946c553fc62b37757e42e1995d17e3}{ERROR\_CERTIFICATE\_EXPIRED};
85       \}
86    \}
87 
88    \textcolor{comment}{//Make sure that the subject and issuer names chain correctly}
89    \textcolor{keywordflow}{if}(!\hyperlink{certificate_2x509__cert__validate_8c_ac0134610dc71d5ff612ac1bc609b7981}{x509CompareName}(certInfo->\hyperlink{structX509CertificateInfo_a21948b3fc93a9d531e6855243c5681c7}{issuer}.\hyperlink{structX509Name_a16f889e11f79b38a1ade245692857253}{rawData}, certInfo->
      \hyperlink{structX509CertificateInfo_a21948b3fc93a9d531e6855243c5681c7}{issuer}.\hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen},
90       issuerCertInfo->\hyperlink{structX509CertificateInfo_adaf5e2c713f42a2ca307b2d4eed55a0e}{subject}.\hyperlink{structX509Name_a16f889e11f79b38a1ade245692857253}{rawData}, issuerCertInfo->\hyperlink{structX509CertificateInfo_adaf5e2c713f42a2ca307b2d4eed55a0e}{subject}.
      \hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen}))
91    \{
92       \textcolor{comment}{//Report an error}
93       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
94    \}
95 
96    \textcolor{comment}{//X.509 version 3 certificate?}
97    \textcolor{keywordflow}{if}(issuerCertInfo->\hyperlink{structX509CertificateInfo_a15902fd60ae1f744a24fed017535891f}{version} >= \hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26addaa01d4830baa29e7e19044f0a656eb}{X509\_VERSION\_3})
98    \{
99       \textcolor{comment}{//Ensure that the issuer certificate is a CA certificate}
100       \textcolor{keywordflow}{if}(!issuerCertInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_ab06800e3424608f8d652ff23c5a027a9}{basicConstraints}.
      \hyperlink{structX509BasicConstraints_afcfd439b65fdffa3e6fd07e6a46e9d7d}{cA})
101          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
102    \}
103 
104    \textcolor{comment}{//Where pathLenConstraint does not appear, no limit is imposed}
105    \textcolor{keywordflow}{if}(issuerCertInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_ab06800e3424608f8d652ff23c5a027a9}{basicConstraints}.
      \hyperlink{structX509BasicConstraints_a13c129a1b79a0a489604e28d69dd0950}{pathLenConstraint} >= 0)
106    \{
107       \textcolor{comment}{//The pathLenConstraint field gives the maximum number of non-self-issued}
108       \textcolor{comment}{//intermediate certificates that may follow this certificate in a valid}
109       \textcolor{comment}{//certification path}
110       \textcolor{keywordflow}{if}(pathLen > (\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t}) issuerCertInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.
      \hyperlink{structX509Extensions_ab06800e3424608f8d652ff23c5a027a9}{basicConstraints}.\hyperlink{structX509BasicConstraints_a13c129a1b79a0a489604e28d69dd0950}{pathLenConstraint})
111          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
112    \}
113 
114    \textcolor{comment}{//Check if the keyUsage extension is present}
115    \textcolor{keywordflow}{if}(issuerCertInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage} != 0)
116    \{
117       \textcolor{comment}{//If the keyUsage extension is present, then the subject public key must}
118       \textcolor{comment}{//not be used to verify signatures on certificates unless the keyCertSign}
119       \textcolor{comment}{//bit is set (refer to RFC 5280, section 4.2.1.3)}
120       \textcolor{keywordflow}{if}(!(issuerCertInfo->\hyperlink{structX509CertificateInfo_a6fbc847cf3a3459834fae3c4ece76297}{extensions}.\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage} & 
      \hyperlink{certificate_2x509__common_8h_a071feff2befadce3a4fe5b708cdb149ba2dc6d1748a2dd8a65a7ba5e521a1c054}{X509\_KEY\_USAGE\_KEY\_CERT\_SIGN}))
121          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
122    \}
123 
124    \textcolor{comment}{//Retrieve the signature algorithm that was used to sign the certificate}
125    error = \hyperlink{certificate_2x509__common_8c_ac397a84e21ec7d1d10607d48aa9fdf54}{x509GetSignHashAlgo}(&certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}, &signAlgo, &
      hashAlgo);
126    \textcolor{comment}{//Unsupported signature algorithm?}
127    \textcolor{keywordflow}{if}(error)
128       \textcolor{keywordflow}{return} error;
129 
130    \textcolor{comment}{//Ed25519 and Ed448 are used in PureEdDSA mode, without pre-hashing}
131    \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
132    \{
133       \textcolor{comment}{//Allocate a memory buffer to hold the hash context}
134       hashContext = \hyperlink{cyclone__crypto_2core_2crypto_8h_a48b53d16f66d31e5dcf82db3c1b882ba}{cryptoAllocMem}(hashAlgo->\hyperlink{structHashAlgo_ad087845190aa4163d8339cacd07fec3e}{contextSize});
135       \textcolor{comment}{//Failed to allocate memory?}
136       \textcolor{keywordflow}{if}(hashContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
137          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
138 
139       \textcolor{comment}{//Initialize hash computation}
140       hashAlgo->\hyperlink{structHashAlgo_a77dcebcb5fd49cd6672ad6c97b55fdee}{init}(hashContext);
141 
142       \textcolor{comment}{//Digest the TBSCertificate structure using the specified hash algorithm}
143       hashAlgo->\hyperlink{structHashAlgo_a83df6297595f1b9de65143df15fafda4}{update}(hashContext, certInfo->\hyperlink{structX509CertificateInfo_a6f0f56fdd661c01753b5408a831f3dcd}{tbsCertificate},
144          certInfo->\hyperlink{structX509CertificateInfo_a4db5f8e3cc589a8445eebf86863e205a}{tbsCertificateLen});
145 
146       \textcolor{comment}{//Finalize hash computation}
147       hashAlgo->\hyperlink{structHashAlgo_a8a1972d608540bbf31e1932f5403f51d}{final}(hashContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
148 
149 \textcolor{preprocessor}{#if (X509\_RSA\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
150       \textcolor{comment}{//RSA signature algorithm?}
151       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA})
152       \{
153          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
154          \hyperlink{structRsaPublicKey}{RsaPublicKey} publicKey;
155 
156          \textcolor{comment}{//Initialize RSA public key}
157          \hyperlink{rsa_8c_af3d3a1f0ce23e006da06325cc37c4063}{rsaInitPublicKey}(&publicKey);
158 
159          \textcolor{comment}{//Get the RSA public key}
160          error = \hyperlink{certificate_2x509__common_8c_ac47b550a8996222289c87e5aa12bc05d}{x509ReadRsaPublicKey}(&issuerCertInfo->
      \hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo},
161             &publicKey);
162 
163          \textcolor{comment}{//Check status code}
164          \textcolor{keywordflow}{if}(!error)
165          \{
166             \textcolor{comment}{//Get the length of the modulus, in bits}
167             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structRsaPublicKey_a51b3d236796d7d46c15d3e6bc7e5acb2}{n});
168 
169             \textcolor{comment}{//Make sure the modulus is acceptable}
170             \textcolor{keywordflow}{if}(k < X509\_MIN\_RSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a511b1a0e91b5d02cd509c45134828001}{X509\_MAX\_RSA\_MODULUS\_SIZE})
171             \{
172                \textcolor{comment}{//Report an error}
173                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
174             \}
175          \}
176 
177          \textcolor{comment}{//Check status code}
178          \textcolor{keywordflow}{if}(!error)
179          \{
180             \textcolor{comment}{//Verify RSA signature (RSASSA-PKCS1-v1\_5 signature scheme)}
181             error = \hyperlink{rsa_8c_ac8bc3701e41ec2201abf77a280dfbc01}{rsassaPkcs1v15Verify}(&publicKey, hashAlgo,
182                hashContext->\hyperlink{structHashContext_a846e5b08172b00162569c343caa0eae1}{digest}, certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.
      \hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
183                certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length});
184          \}
185 
186          \textcolor{comment}{//Release previously allocated resources}
187          \hyperlink{rsa_8c_a6dc1711d56454b2a6e565199509d884e}{rsaFreePublicKey}(&publicKey);
188       \}
189       \textcolor{keywordflow}{else}
190 \textcolor{preprocessor}{#endif}
191 \textcolor{preprocessor}{#if (X509\_RSA\_PSS\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
192       \textcolor{comment}{//RSA-PSS signature algorithm?}
193       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS})
194       \{
195          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
196          \hyperlink{structRsaPublicKey}{RsaPublicKey} publicKey;
197 
198          \textcolor{comment}{//Initialize RSA public key}
199          \hyperlink{rsa_8c_af3d3a1f0ce23e006da06325cc37c4063}{rsaInitPublicKey}(&publicKey);
200 
201          \textcolor{comment}{//Get the RSA public key}
202          error = \hyperlink{certificate_2x509__common_8c_ac47b550a8996222289c87e5aa12bc05d}{x509ReadRsaPublicKey}(&issuerCertInfo->
      \hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo},
203             &publicKey);
204 
205          \textcolor{comment}{//Check status code}
206          \textcolor{keywordflow}{if}(!error)
207          \{
208             \textcolor{comment}{//Get the length of the modulus, in bits}
209             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structRsaPublicKey_a51b3d236796d7d46c15d3e6bc7e5acb2}{n});
210 
211             \textcolor{comment}{//Make sure the modulus is acceptable}
212             \textcolor{keywordflow}{if}(k < X509\_MIN\_RSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a511b1a0e91b5d02cd509c45134828001}{X509\_MAX\_RSA\_MODULUS\_SIZE})
213             \{
214                \textcolor{comment}{//Report an error}
215                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
216             \}
217          \}
218 
219          \textcolor{comment}{//Check status code}
220          \textcolor{keywordflow}{if}(!error)
221          \{
222             \textcolor{comment}{//Retrieve the length of the salt}
223             k = certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}.\hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}.
      \hyperlink{structX509RsaPssParameters_a0472b015828361df56b2550e4c1ac220}{saltLen};
224 
225             \textcolor{comment}{//Verify RSA signature (RSASSA-PSS signature scheme)}
226             error = \hyperlink{rsa_8c_a353c0daced94ff0a95ec1067f6f9048c}{rsassaPssVerify}(&publicKey, hashAlgo, k,
227                hashContext->\hyperlink{structHashContext_a846e5b08172b00162569c343caa0eae1}{digest}, certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.
      \hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
228                certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length});
229          \}
230 
231          \textcolor{comment}{//Release previously allocated resources}
232          \hyperlink{rsa_8c_a6dc1711d56454b2a6e565199509d884e}{rsaFreePublicKey}(&publicKey);
233       \}
234       \textcolor{keywordflow}{else}
235 \textcolor{preprocessor}{#endif}
236 \textcolor{preprocessor}{#if (X509\_DSA\_SUPPORT == ENABLED && DSA\_SUPPORT == ENABLED)}
237       \textcolor{comment}{//DSA signature algorithm?}
238       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA})
239       \{
240          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
241          \hyperlink{structDsaPublicKey}{DsaPublicKey} publicKey;
242          \hyperlink{structDsaSignature}{DsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
243 
244          \textcolor{comment}{//Initialize DSA public key}
245          \hyperlink{dsa_8c_ab058852057768fc18904ba5796f5af4d}{dsaInitPublicKey}(&publicKey);
246          \textcolor{comment}{//Initialize DSA signature}
247          \hyperlink{dsa_8c_a6ebbad1e693d6967da33e2a1338912c7}{dsaInitSignature}(&signature);
248 
249          \textcolor{comment}{//Get the DSA public key}
250          error = \hyperlink{certificate_2x509__common_8c_a6457228176bb809a85f82bbc0d069fc6}{x509ReadDsaPublicKey}(&issuerCertInfo->
      \hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo},
251             &publicKey);
252 
253          \textcolor{comment}{//Check status code}
254          \textcolor{keywordflow}{if}(!error)
255          \{
256             \textcolor{comment}{//Get the length of the prime modulus, in bits}
257             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structDsaPublicKey_a273f5bed06a946fd672c94283f49fc3e}{p});
258 
259             \textcolor{comment}{//Make sure the prime modulus is acceptable}
260             \textcolor{keywordflow}{if}(k < X509\_MIN\_DSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a00cfe4510ccfcf3398b135cef8632ed4}{X509\_MAX\_DSA\_MODULUS\_SIZE})
261             \{
262                \textcolor{comment}{//Report an error}
263                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
264             \}
265          \}
266 
267          \textcolor{comment}{//Check status code}
268          \textcolor{keywordflow}{if}(!error)
269          \{
270             \textcolor{comment}{//Read the ASN.1 encoded signature}
271             error = \hyperlink{dsa_8c_a05526f7cfcf22483963264e0500bc724}{dsaReadSignature}(certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.
      \hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
272                certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length}, &signature);
273          \}
274 
275          \textcolor{comment}{//Check status code}
276          \textcolor{keywordflow}{if}(!error)
277          \{
278             \textcolor{comment}{//Verify DSA signature}
279             error = \hyperlink{dsa_8c_a551e9301249e713b9925e2a7f6d7ed79}{dsaVerifySignature}(&publicKey, hashContext->
      \hyperlink{structHashContext_a846e5b08172b00162569c343caa0eae1}{digest},
280                hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, &signature);
281          \}
282 
283          \textcolor{comment}{//Release previously allocated resources}
284          \hyperlink{dsa_8c_aecb06a7f6d0f7df028b6a30284fa0016}{dsaFreePublicKey}(&publicKey);
285          \hyperlink{dsa_8c_a78f8ff9636dd1677e22b637476c88e9d}{dsaFreeSignature}(&signature);
286       \}
287       \textcolor{keywordflow}{else}
288 \textcolor{preprocessor}{#endif}
289 \textcolor{preprocessor}{#if (X509\_ECDSA\_SUPPORT == ENABLED && ECDSA\_SUPPORT == ENABLED)}
290       \textcolor{comment}{//ECDSA signature algorithm?}
291       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA})
292       \{
293          \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
294          \hyperlink{structEcDomainParameters}{EcDomainParameters} params;
295          \hyperlink{structEcPoint}{EcPoint} publicKey;
296          \hyperlink{structEcdsaSignature}{EcdsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
297 
298          \textcolor{comment}{//Initialize EC domain parameters}
299          \hyperlink{ec_8c_a5b5132fb8adf668ffa74ec10e7e63441}{ecInitDomainParameters}(&params);
300          \textcolor{comment}{//Initialize ECDSA public key}
301          \hyperlink{ec_8c_ac038e67dcc04d6d94bb930f9475f3ff8}{ecInit}(&publicKey);
302          \textcolor{comment}{//Initialize ECDSA signature}
303          \hyperlink{ecdsa_8c_aef8cd9a530146f44fc0597eb67480133}{ecdsaInitSignature}(&signature);
304 
305          \textcolor{comment}{//Retrieve EC domain parameters}
306          curveInfo = \hyperlink{certificate_2x509__common_8c_a6f6416a69dd75fe6f18aab77a0f7205c}{x509GetCurveInfo}(
307             issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.
      \hyperlink{structX509EcParameters_a122c5387fb2f12374a905ecfd2ca4c86}{namedCurve},
308             issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.
      \hyperlink{structX509EcParameters_ac58081bd63ed68d0cb101ff7e65667ec}{namedCurveLen});
309 
310          \textcolor{comment}{//Make sure the specified elliptic curve is supported}
311          \textcolor{keywordflow}{if}(curveInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
312          \{
313             \textcolor{comment}{//Load EC domain parameters}
314             error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&params, curveInfo);
315          \}
316          \textcolor{keywordflow}{else}
317          \{
318             \textcolor{comment}{//Invalid EC domain parameters}
319             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
320          \}
321 
322          \textcolor{comment}{//Check status code}
323          \textcolor{keywordflow}{if}(!error)
324          \{
325             \textcolor{comment}{//Retrieve the EC public key}
326             error = \hyperlink{ec_8c_ae707a9a99979ce0b291ac6c0f8d380fd}{ecImport}(&params, &publicKey,
327                issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
328                issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen});
329          \}
330 
331          \textcolor{comment}{//Check status code}
332          \textcolor{keywordflow}{if}(!error)
333          \{
334             \textcolor{comment}{//Read the ASN.1 encoded signature}
335             error = \hyperlink{ecdsa_8c_a51f5efbd49199a8d8db36b694f0683ff}{ecdsaReadSignature}(certInfo->
      \hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
336                certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length}, &signature);
337          \}
338 
339          \textcolor{comment}{//Check status code}
340          \textcolor{keywordflow}{if}(!error)
341          \{
342             \textcolor{comment}{//Verify ECDSA signature}
343             error = \hyperlink{ecdsa_8c_a34b9fa4b6962c63ed4edf6f4ec1b6f6d}{ecdsaVerifySignature}(&params, &publicKey,
344                hashContext->\hyperlink{structHashContext_a846e5b08172b00162569c343caa0eae1}{digest}, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, &signature);
345          \}
346 
347          \textcolor{comment}{//Release previously allocated resources}
348          \hyperlink{ec_8c_a256993c154cf87c3d9d18138a1365eca}{ecFreeDomainParameters}(&params);
349          \hyperlink{ec_8c_ae4a9276eac491f8acbb6d0916287411b}{ecFree}(&publicKey);
350          \hyperlink{ecdsa_8c_a6f4daa07ea8815b8c67b47c4b089d157}{ecdsaFreeSignature}(&signature);
351       \}
352       \textcolor{keywordflow}{else}
353 \textcolor{preprocessor}{#endif}
354       \{
355          \textcolor{comment}{//The signature algorithm is not supported}
356          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
357       \}
358 
359       \textcolor{comment}{//Release hash algorithm context}
360       \hyperlink{cyclone__crypto_2core_2crypto_8h_ac8a223b176683db4e9eed4162774f870}{cryptoFreeMem}(hashContext);
361    \}
362    \textcolor{keywordflow}{else}
363    \{
364 \textcolor{preprocessor}{#if (X509\_ED25519\_SUPPORT == ENABLED && ED25519\_SUPPORT == ENABLED)}
365       \textcolor{comment}{//Ed25519 signature algorithm?}
366       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a34b6299ba091cde76553b23a7632da7f}{X509\_SIGN\_ALGO\_ED25519})
367       \{
368          \textcolor{keyword}{const} \hyperlink{structX509EcPublicKey}{X509EcPublicKey} *publicKey;
369 
370          \textcolor{comment}{//Point to the Ed25519 public key}
371          publicKey = &issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey};
372 
373          \textcolor{comment}{//Check the length of the public key}
374          \textcolor{keywordflow}{if}(publicKey->\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen} == \hyperlink{ed25519_8h_a5fdd1f73dec2be868a8ed5d2e129bb5e}{ED25519\_PUBLIC\_KEY\_LEN})
375          \{
376             \textcolor{comment}{//Check the length of the EdDSA signature}
377             \textcolor{keywordflow}{if}(certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length} == 
      \hyperlink{ed25519_8h_a6b45906484d3c938aef3a114e3d1a8ea}{ED25519\_SIGNATURE\_LEN})
378             \{
379                \textcolor{comment}{//Verify signature (PureEdDSA mode)}
380                error = \hyperlink{ed25519_8c_a5f517039b2a85e2dbdcf26791e7d1b2c}{ed25519VerifySignature}(publicKey->\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
381                   certInfo->\hyperlink{structX509CertificateInfo_a6f0f56fdd661c01753b5408a831f3dcd}{tbsCertificate}, certInfo->
      \hyperlink{structX509CertificateInfo_a4db5f8e3cc589a8445eebf86863e205a}{tbsCertificateLen},
382                   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data});
383             \}
384             \textcolor{keywordflow}{else}
385             \{
386                \textcolor{comment}{//The length of the EdDSA signature is not valid}
387                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
388             \}
389          \}
390          \textcolor{keywordflow}{else}
391          \{
392             \textcolor{comment}{//The length of the Ed25519 public key is not valid}
393             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
394          \}
395       \}
396       \textcolor{keywordflow}{else}
397 \textcolor{preprocessor}{#endif}
398 \textcolor{preprocessor}{#if (X509\_ED448\_SUPPORT == ENABLED && ED448\_SUPPORT == ENABLED)}
399       \textcolor{comment}{//Ed448 signature algorithm?}
400       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a258c2bcce0e685a5315ff975dc2f7c57}{X509\_SIGN\_ALGO\_ED448})
401       \{
402          \textcolor{keyword}{const} \hyperlink{structX509EcPublicKey}{X509EcPublicKey} *publicKey;
403 
404          \textcolor{comment}{//Point to the Ed448 public key}
405          publicKey = &issuerCertInfo->\hyperlink{structX509CertificateInfo_a1e15bfaddec61608bad974fa7385d225}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey};
406 
407          \textcolor{comment}{//Check the length of the public key}
408          \textcolor{keywordflow}{if}(publicKey->\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen} == \hyperlink{ed448_8h_a452cd73807c6a5607ede7ba57cbc3e6a}{ED448\_PUBLIC\_KEY\_LEN})
409          \{
410             \textcolor{comment}{//Check the length of the EdDSA signature}
411             \textcolor{keywordflow}{if}(certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length} == 
      \hyperlink{ed448_8h_a6faeb89fbb8744bcc8ec3333ec22b099}{ED448\_SIGNATURE\_LEN})
412             \{
413                \textcolor{comment}{//Verify signature (PureEdDSA mode)}
414                error = \hyperlink{ed448_8c_ab6f6de548796083dfc337efbc7542084}{ed448VerifySignature}(publicKey->\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
415                   certInfo->\hyperlink{structX509CertificateInfo_a6f0f56fdd661c01753b5408a831f3dcd}{tbsCertificate}, certInfo->
      \hyperlink{structX509CertificateInfo_a4db5f8e3cc589a8445eebf86863e205a}{tbsCertificateLen},
416                   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, certInfo->\hyperlink{structX509CertificateInfo_a14aae7b8131fdc0d1cae4ccc6be1f02d}{signatureValue}.\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data});
417             \}
418             \textcolor{keywordflow}{else}
419             \{
420                \textcolor{comment}{//The length of the EdDSA signature is not valid}
421                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
422             \}
423          \}
424          \textcolor{keywordflow}{else}
425          \{
426             \textcolor{comment}{//The length of the Ed448 public key is not valid}
427             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
428          \}
429       \}
430       \textcolor{keywordflow}{else}
431 \textcolor{preprocessor}{#endif}
432       \{
433          \textcolor{comment}{//The signature algorithm is not supported}
434          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
435       \}
436    \}
437 
438    \textcolor{comment}{//Return status code}
439    \textcolor{keywordflow}{return} error;
440 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkix_2x509__cert__validate_8h_a1d8215100a2199ceac838bb36ad392bf}\label{pkix_2x509__cert__validate_8h_a1d8215100a2199ceac838bb36ad392bf}} 
\index{pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}!x509\+Verify\+Signature@{x509\+Verify\+Signature}}
\index{x509\+Verify\+Signature@{x509\+Verify\+Signature}!pkix/x509\+\_\+cert\+\_\+validate.\+h@{pkix/x509\+\_\+cert\+\_\+validate.\+h}}
\subsubsection{\texorpdfstring{x509\+Verify\+Signature()}{x509VerifySignature()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Verify\+Signature (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{tbs\+Cert,  }\item[{size\+\_\+t}]{tbs\+Cert\+Len,  }\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo\+Id,  }\item[{const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$}]{public\+Key\+Info,  }\item[{const \hyperlink{structX509SignatureValue}{X509\+Signature\+Value} $\ast$}]{signature\+Value }\end{DoxyParamCaption})}



Certificate signature verification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em tbs\+Cert} & T\+B\+S\+Certificate whose signature is to be verified \\
\hline
\mbox{\tt in}  & {\em tbs\+Cert\+Len} & Length of the T\+B\+S\+Certificate, in bytes \\
\hline
\mbox{\tt in}  & {\em signature\+Algo\+Id} & Signature algorithm identifier \\
\hline
\mbox{\tt in}  & {\em public\+Key\+Info} & Issuer\textquotesingle{}s public key \\
\hline
\mbox{\tt in}  & {\em signature\+Value} & Signature to be verified \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 571 of file x509\+\_\+cert\+\_\+validate.\+c.


\begin{DoxyCode}
575 \{
576    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
577    \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078}{X509SignatureAlgo} signAlgo;
578    \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
579    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} digest[\hyperlink{pkix_2x509__common_8h_aaa7e393a09f334c6e3d573cff46ad6b0}{X509\_MAX\_HASH\_DIGEST\_SIZE}];
580 
581    \textcolor{comment}{//Retrieve the signature algorithm that was used to sign the certificate}
582    error = \hyperlink{certificate_2x509__common_8c_ac397a84e21ec7d1d10607d48aa9fdf54}{x509GetSignHashAlgo}(signatureAlgoId, &signAlgo, &hashAlgo);
583    \textcolor{comment}{//Unsupported signature algorithm?}
584    \textcolor{keywordflow}{if}(error)
585       \textcolor{keywordflow}{return} error;
586 
587    \textcolor{comment}{//Ed25519 and Ed448 are used in PureEdDSA mode, without pre-hashing}
588    \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
589    \{
590       \textcolor{comment}{//Digest the TBSCertificate structure using the specified hash algorithm}
591       error = hashAlgo->\hyperlink{structHashAlgo_af06e5499992d76f215cc8329a2d6cbb3}{compute}(tbsCert, tbsCertLen, digest);
592       \textcolor{comment}{//Any error to report?}
593       \textcolor{keywordflow}{if}(error)
594          \textcolor{keywordflow}{return} error;
595 
596 \textcolor{preprocessor}{#if (X509\_RSA\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
597       \textcolor{comment}{//RSA signature algorithm?}
598       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA})
599       \{
600          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
601          \hyperlink{structRsaPublicKey}{RsaPublicKey} publicKey;
602 
603          \textcolor{comment}{//Initialize RSA public key}
604          \hyperlink{rsa_8c_af3d3a1f0ce23e006da06325cc37c4063}{rsaInitPublicKey}(&publicKey);
605 
606          \textcolor{comment}{//Import the RSA public key}
607          error = \hyperlink{x509__key__parse_8c_a46b55059a7e4840fa58c40d2c2b44cd4}{x509ImportRsaPublicKey}(publicKeyInfo, &publicKey);
608 
609          \textcolor{comment}{//Check status code}
610          \textcolor{keywordflow}{if}(!error)
611          \{
612             \textcolor{comment}{//Get the length of the modulus, in bits}
613             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structRsaPublicKey_a51b3d236796d7d46c15d3e6bc7e5acb2}{n});
614 
615             \textcolor{comment}{//Make sure the modulus is acceptable}
616             \textcolor{keywordflow}{if}(k < X509\_MIN\_RSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a511b1a0e91b5d02cd509c45134828001}{X509\_MAX\_RSA\_MODULUS\_SIZE})
617             \{
618                \textcolor{comment}{//Report an error}
619                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
620             \}
621          \}
622 
623          \textcolor{comment}{//Check status code}
624          \textcolor{keywordflow}{if}(!error)
625          \{
626             \textcolor{comment}{//Verify RSA signature (RSASSA-PKCS1-v1\_5 signature scheme)}
627             error = \hyperlink{rsa_8c_ac8bc3701e41ec2201abf77a280dfbc01}{rsassaPkcs1v15Verify}(&publicKey, hashAlgo, digest,
628                signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data}, signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length});
629          \}
630 
631          \textcolor{comment}{//Release previously allocated resources}
632          \hyperlink{rsa_8c_a6dc1711d56454b2a6e565199509d884e}{rsaFreePublicKey}(&publicKey);
633       \}
634       \textcolor{keywordflow}{else}
635 \textcolor{preprocessor}{#endif}
636 \textcolor{preprocessor}{#if (X509\_RSA\_PSS\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
637       \textcolor{comment}{//RSA-PSS signature algorithm?}
638       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS})
639       \{
640          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
641          \hyperlink{structRsaPublicKey}{RsaPublicKey} publicKey;
642 
643          \textcolor{comment}{//Initialize RSA public key}
644          \hyperlink{rsa_8c_af3d3a1f0ce23e006da06325cc37c4063}{rsaInitPublicKey}(&publicKey);
645 
646          \textcolor{comment}{//Import the RSA public key}
647          error = \hyperlink{x509__key__parse_8c_a46b55059a7e4840fa58c40d2c2b44cd4}{x509ImportRsaPublicKey}(publicKeyInfo, &publicKey);
648 
649          \textcolor{comment}{//Check status code}
650          \textcolor{keywordflow}{if}(!error)
651          \{
652             \textcolor{comment}{//Get the length of the modulus, in bits}
653             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structRsaPublicKey_a51b3d236796d7d46c15d3e6bc7e5acb2}{n});
654 
655             \textcolor{comment}{//Make sure the modulus is acceptable}
656             \textcolor{keywordflow}{if}(k < X509\_MIN\_RSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a511b1a0e91b5d02cd509c45134828001}{X509\_MAX\_RSA\_MODULUS\_SIZE})
657             \{
658                \textcolor{comment}{//Report an error}
659                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
660             \}
661          \}
662 
663          \textcolor{comment}{//Check status code}
664          \textcolor{keywordflow}{if}(!error)
665          \{
666             \textcolor{comment}{//Retrieve the length of the salt}
667             k = signatureAlgoId->\hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}.\hyperlink{structX509RsaPssParameters_a0472b015828361df56b2550e4c1ac220}{saltLen};
668 
669             \textcolor{comment}{//Verify RSA signature (RSASSA-PSS signature scheme)}
670             error = \hyperlink{rsa_8c_a353c0daced94ff0a95ec1067f6f9048c}{rsassaPssVerify}(&publicKey, hashAlgo, k, digest,
671                signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data}, signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length});
672          \}
673 
674          \textcolor{comment}{//Release previously allocated resources}
675          \hyperlink{rsa_8c_a6dc1711d56454b2a6e565199509d884e}{rsaFreePublicKey}(&publicKey);
676       \}
677       \textcolor{keywordflow}{else}
678 \textcolor{preprocessor}{#endif}
679 \textcolor{preprocessor}{#if (X509\_DSA\_SUPPORT == ENABLED && DSA\_SUPPORT == ENABLED)}
680       \textcolor{comment}{//DSA signature algorithm?}
681       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA})
682       \{
683          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
684          \hyperlink{structDsaPublicKey}{DsaPublicKey} publicKey;
685          \hyperlink{structDsaSignature}{DsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
686 
687          \textcolor{comment}{//Initialize DSA public key}
688          \hyperlink{dsa_8c_ab058852057768fc18904ba5796f5af4d}{dsaInitPublicKey}(&publicKey);
689          \textcolor{comment}{//Initialize DSA signature}
690          \hyperlink{dsa_8c_a6ebbad1e693d6967da33e2a1338912c7}{dsaInitSignature}(&signature);
691 
692          \textcolor{comment}{//Import the DSA public key}
693          error = \hyperlink{x509__key__parse_8c_aa028d369d57dd4e935aed069e8274de9}{x509ImportDsaPublicKey}(publicKeyInfo, &publicKey);
694 
695          \textcolor{comment}{//Check status code}
696          \textcolor{keywordflow}{if}(!error)
697          \{
698             \textcolor{comment}{//Get the length of the prime modulus, in bits}
699             k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&publicKey.\hyperlink{structDsaPublicKey_a273f5bed06a946fd672c94283f49fc3e}{p});
700 
701             \textcolor{comment}{//Make sure the prime modulus is acceptable}
702             \textcolor{keywordflow}{if}(k < X509\_MIN\_DSA\_MODULUS\_SIZE || k > \hyperlink{certificate_2x509__common_8h_a00cfe4510ccfcf3398b135cef8632ed4}{X509\_MAX\_DSA\_MODULUS\_SIZE})
703             \{
704                \textcolor{comment}{//Report an error}
705                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
706             \}
707          \}
708 
709          \textcolor{comment}{//Check status code}
710          \textcolor{keywordflow}{if}(!error)
711          \{
712             \textcolor{comment}{//Read the ASN.1 encoded signature}
713             error = \hyperlink{dsa_8c_a05526f7cfcf22483963264e0500bc724}{dsaReadSignature}(signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
714                signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length}, &signature);
715          \}
716 
717          \textcolor{comment}{//Check status code}
718          \textcolor{keywordflow}{if}(!error)
719          \{
720             \textcolor{comment}{//Verify DSA signature}
721             error = \hyperlink{dsa_8c_a551e9301249e713b9925e2a7f6d7ed79}{dsaVerifySignature}(&publicKey, digest, hashAlgo->
      \hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
722                &signature);
723          \}
724 
725          \textcolor{comment}{//Release previously allocated resources}
726          \hyperlink{dsa_8c_aecb06a7f6d0f7df028b6a30284fa0016}{dsaFreePublicKey}(&publicKey);
727          \hyperlink{dsa_8c_a78f8ff9636dd1677e22b637476c88e9d}{dsaFreeSignature}(&signature);
728       \}
729       \textcolor{keywordflow}{else}
730 \textcolor{preprocessor}{#endif}
731 \textcolor{preprocessor}{#if (X509\_ECDSA\_SUPPORT == ENABLED && ECDSA\_SUPPORT == ENABLED)}
732       \textcolor{comment}{//ECDSA signature algorithm?}
733       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA})
734       \{
735          \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
736          \hyperlink{structEcDomainParameters}{EcDomainParameters} params;
737          \hyperlink{structEcPoint}{EcPoint} publicKey;
738          \hyperlink{structEcdsaSignature}{EcdsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
739 
740          \textcolor{comment}{//Initialize EC domain parameters}
741          \hyperlink{ec_8c_a5b5132fb8adf668ffa74ec10e7e63441}{ecInitDomainParameters}(&params);
742          \textcolor{comment}{//Initialize ECDSA public key}
743          \hyperlink{ec_8c_ac038e67dcc04d6d94bb930f9475f3ff8}{ecInit}(&publicKey);
744          \textcolor{comment}{//Initialize ECDSA signature}
745          \hyperlink{ecdsa_8c_aef8cd9a530146f44fc0597eb67480133}{ecdsaInitSignature}(&signature);
746 
747          \textcolor{comment}{//Retrieve EC domain parameters}
748          curveInfo = \hyperlink{certificate_2x509__common_8c_a6f6416a69dd75fe6f18aab77a0f7205c}{x509GetCurveInfo}(publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.
      \hyperlink{structX509EcParameters_a122c5387fb2f12374a905ecfd2ca4c86}{namedCurve},
749             publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.\hyperlink{structX509EcParameters_ac58081bd63ed68d0cb101ff7e65667ec}{namedCurveLen});
750 
751          \textcolor{comment}{//Make sure the specified elliptic curve is supported}
752          \textcolor{keywordflow}{if}(curveInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
753          \{
754             \textcolor{comment}{//Load EC domain parameters}
755             error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&params, curveInfo);
756          \}
757          \textcolor{keywordflow}{else}
758          \{
759             \textcolor{comment}{//Invalid EC domain parameters}
760             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
761          \}
762 
763          \textcolor{comment}{//Check status code}
764          \textcolor{keywordflow}{if}(!error)
765          \{
766             \textcolor{comment}{//Retrieve the EC public key}
767             error = \hyperlink{ec_8c_ae707a9a99979ce0b291ac6c0f8d380fd}{ecImport}(&params, &publicKey, publicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
768                publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen});
769          \}
770 
771          \textcolor{comment}{//Check status code}
772          \textcolor{keywordflow}{if}(!error)
773          \{
774             \textcolor{comment}{//Read the ASN.1 encoded signature}
775             error = \hyperlink{ecdsa_8c_a51f5efbd49199a8d8db36b694f0683ff}{ecdsaReadSignature}(signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data},
776                signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length}, &signature);
777          \}
778 
779          \textcolor{comment}{//Check status code}
780          \textcolor{keywordflow}{if}(!error)
781          \{
782             \textcolor{comment}{//Verify ECDSA signature}
783             error = \hyperlink{ecdsa_8c_a34b9fa4b6962c63ed4edf6f4ec1b6f6d}{ecdsaVerifySignature}(&params, &publicKey, digest,
784                hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, &signature);
785          \}
786 
787          \textcolor{comment}{//Release previously allocated resources}
788          \hyperlink{ec_8c_a256993c154cf87c3d9d18138a1365eca}{ecFreeDomainParameters}(&params);
789          \hyperlink{ec_8c_ae4a9276eac491f8acbb6d0916287411b}{ecFree}(&publicKey);
790          \hyperlink{ecdsa_8c_a6f4daa07ea8815b8c67b47c4b089d157}{ecdsaFreeSignature}(&signature);
791       \}
792       \textcolor{keywordflow}{else}
793 \textcolor{preprocessor}{#endif}
794       \textcolor{comment}{//Invalid signature algorithm?}
795       \{
796          \textcolor{comment}{//Report an error}
797          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
798       \}
799    \}
800    \textcolor{keywordflow}{else}
801    \{
802 \textcolor{preprocessor}{#if (X509\_ED25519\_SUPPORT == ENABLED && ED25519\_SUPPORT == ENABLED)}
803       \textcolor{comment}{//Ed25519 signature algorithm?}
804       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a34b6299ba091cde76553b23a7632da7f}{X509\_SIGN\_ALGO\_ED25519})
805       \{
806          \textcolor{comment}{//Check the length of the public key}
807          \textcolor{keywordflow}{if}(publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen} == 
      \hyperlink{ed25519_8h_a5fdd1f73dec2be868a8ed5d2e129bb5e}{ED25519\_PUBLIC\_KEY\_LEN})
808          \{
809             \textcolor{comment}{//Check the length of the EdDSA signature}
810             \textcolor{keywordflow}{if}(signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length} == \hyperlink{ed25519_8h_a6b45906484d3c938aef3a114e3d1a8ea}{ED25519\_SIGNATURE\_LEN})
811             \{
812                \textcolor{comment}{//Verify signature (PureEdDSA mode)}
813                error = \hyperlink{ed25519_8c_a5f517039b2a85e2dbdcf26791e7d1b2c}{ed25519VerifySignature}(publicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
814                   tbsCert, tbsCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data});
815             \}
816             \textcolor{keywordflow}{else}
817             \{
818                \textcolor{comment}{//The length of the EdDSA signature is not valid}
819                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
820             \}
821          \}
822          \textcolor{keywordflow}{else}
823          \{
824             \textcolor{comment}{//The length of the Ed25519 public key is not valid}
825             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
826          \}
827       \}
828       \textcolor{keywordflow}{else}
829 \textcolor{preprocessor}{#endif}
830 \textcolor{preprocessor}{#if (X509\_ED448\_SUPPORT == ENABLED && ED448\_SUPPORT == ENABLED)}
831       \textcolor{comment}{//Ed448 signature algorithm?}
832       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a258c2bcce0e685a5315ff975dc2f7c57}{X509\_SIGN\_ALGO\_ED448})
833       \{
834          \textcolor{comment}{//Check the length of the public key}
835          \textcolor{keywordflow}{if}(publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen} == 
      \hyperlink{ed448_8h_a452cd73807c6a5607ede7ba57cbc3e6a}{ED448\_PUBLIC\_KEY\_LEN})
836          \{
837             \textcolor{comment}{//Check the length of the EdDSA signature}
838             \textcolor{keywordflow}{if}(signatureValue->\hyperlink{structX509SignatureValue_af1bce8baf0e1a46212467145e00079d7}{length} == \hyperlink{ed448_8h_a6faeb89fbb8744bcc8ec3333ec22b099}{ED448\_SIGNATURE\_LEN})
839             \{
840                \textcolor{comment}{//Verify signature (PureEdDSA mode)}
841                error = \hyperlink{ed448_8c_ab6f6de548796083dfc337efbc7542084}{ed448VerifySignature}(publicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q},
842                   tbsCert, tbsCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, signatureValue->\hyperlink{structX509SignatureValue_a3e53e8589cdfc0c22d30e85bebfa0625}{data});
843             \}
844             \textcolor{keywordflow}{else}
845             \{
846                \textcolor{comment}{//The length of the EdDSA signature is not valid}
847                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
848             \}
849          \}
850          \textcolor{keywordflow}{else}
851          \{
852             \textcolor{comment}{//The length of the Ed448 public key is not valid}
853             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
854          \}
855       \}
856       \textcolor{keywordflow}{else}
857 \textcolor{preprocessor}{#endif}
858       \textcolor{comment}{//Invalid signature algorithm?}
859       \{
860          \textcolor{comment}{//Report an error}
861          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
862       \}
863    \}
864 
865    \textcolor{comment}{//Return status code}
866    \textcolor{keywordflow}{return} error;
867 \}
\end{DoxyCode}
