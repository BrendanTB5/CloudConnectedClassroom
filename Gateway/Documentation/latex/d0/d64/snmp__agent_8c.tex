\hypertarget{snmp__agent_8c}{}\section{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent.c File Reference}
\label{snmp__agent_8c}\index{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent.\+c@{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent.\+c}}


S\+N\+MP agent (Simple Network Management Protocol)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+dispatch.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+pdu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+trap.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent\+\_\+inform.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mibs/mib2\+\_\+module.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/asn1.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/oid.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{snmp__agent_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_af5cf34762d7114743a58dd8a05289bd9}{S\+N\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{snmp__agent_8c_a57cc396be1342a6d9ef188b0823950a5}{snmp\+Agent\+Get\+Default\+Settings} (\hyperlink{structSnmpAgentSettings}{Snmp\+Agent\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em Initialize settings with default values. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a77e760c33f755f2f283364cc3cb191d7}{snmp\+Agent\+Init} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structSnmpAgentSettings}{Snmp\+Agent\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em S\+N\+MP agent initialization. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_aeda6cfdefb05459fcdc32e8877baca9e}{snmp\+Agent\+Start} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Start S\+N\+MP agent. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a0bd4f93f8fb393cc0cc0dcf7b386a623}{snmp\+Agent\+Load\+Mib} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structMibModule}{Mib\+Module} $\ast$module)
\begin{DoxyCompactList}\small\item\em Load a M\+IB module. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_ab1194de5d74699946cec6fd323da643c}{snmp\+Agent\+Unload\+Mib} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structMibModule}{Mib\+Module} $\ast$module)
\begin{DoxyCompactList}\small\item\em Unload a M\+IB module. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a9c3fee15540a001a80bcf4542fd70fdc}{snmp\+Agent\+Set\+Version} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version} version\+Min, \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version} version\+Max)
\begin{DoxyCompactList}\small\item\em Set minimum and maximum versions permitted. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a157634ca61b621e1e5e3a0d904699980}{snmp\+Agent\+Set\+Engine\+Boots} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, \hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} engine\+Boots)
\begin{DoxyCompactList}\small\item\em Set the value of the snmp\+Engine\+Boots variable. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a99bbd657869a8800ac3c578f773cfa97}{snmp\+Agent\+Get\+Engine\+Boots} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, \hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} $\ast$engine\+Boots)
\begin{DoxyCompactList}\small\item\em Get the value of the snmp\+Engine\+Boots variable. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a1e829f92b37686e43dabf8af18686d95}{snmp\+Agent\+Set\+Enterprise\+Oid} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$enterprise\+Oid, size\+\_\+t enterprise\+Oid\+Len)
\begin{DoxyCompactList}\small\item\em Set enterprise O\+ID. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a5961caaffaec19dc9b48596b1f479278}{snmp\+Agent\+Set\+Context\+Engine} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const void $\ast$context\+Engine, size\+\_\+t context\+Engine\+Len)
\begin{DoxyCompactList}\small\item\em Set context engine identifier. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_abd0fb0a9802edef43d518c6e581e58b4}{snmp\+Agent\+Set\+Context\+Name} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$context\+Name)
\begin{DoxyCompactList}\small\item\em Set context name. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a1f6d1528707c57051d4d287954412be2}{snmp\+Agent\+Create\+Community} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$community, \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5ca}{Snmp\+Access} \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode})
\begin{DoxyCompactList}\small\item\em Create a new community string. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a59903fc75c378b763b3fb148c8fec129}{snmp\+Agent\+Delete\+Community} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$community)
\begin{DoxyCompactList}\small\item\em Remove a community string. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a3c1dec86c8d939ef89db5d137c4bbe01}{snmp\+Agent\+Create\+User} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name, \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5ca}{Snmp\+Access} \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode}, \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689a}{Snmp\+Key\+Format} key\+Format, \hyperlink{snmp__agent__usm_8h_a13c46b84c881bd15bad7093a7f3639e3}{Snmp\+Auth\+Protocol} auth\+Protocol, const void $\ast$auth\+Key, \hyperlink{snmp__agent__usm_8h_acfd97e4fdb0cd081855bcb3d922dd851}{Snmp\+Priv\+Protocol} priv\+Protocol, const void $\ast$priv\+Key)
\begin{DoxyCompactList}\small\item\em Create a new user. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a245812815ecc8e460368dd05afa5aafc}{snmp\+Agent\+Delete\+User} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name)
\begin{DoxyCompactList}\small\item\em Remove existing user. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a9f67fd4ba3ebc7579fc417cf6acfe38e}{snmp\+Agent\+Join\+Group} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name, \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model} security\+Model, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$group\+Name)
\begin{DoxyCompactList}\small\item\em Join a group of users. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a77e6444a18b1df033832e9db11e8aa13}{snmp\+Agent\+Leave\+Group} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name, \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model} security\+Model)
\begin{DoxyCompactList}\small\item\em Leave a group of users. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_ac436ad93a4cfd299bc560ddce08bb3cb}{snmp\+Agent\+Create\+Access} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$group\+Name, \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model} security\+Model, \hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612}{Snmp\+Security\+Level} security\+Level, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{context\+Prefix}, \hyperlink{snmp__agent__vacm_8h_a8cef40e8881cb290d68171da147f6f20}{Snmp\+Context\+Match} context\+Match, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$read\+View\+Name, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$write\+View\+Name, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$notify\+View\+Name)
\begin{DoxyCompactList}\small\item\em Create access policy for the specified group name. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_ac6d8fb53d9c7ee5d805ebe7c1d604ff8}{snmp\+Agent\+Delete\+Access} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$group\+Name, \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model} security\+Model, \hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612}{Snmp\+Security\+Level} security\+Level, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{context\+Prefix})
\begin{DoxyCompactList}\small\item\em Delete an existing access policy. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a1af1e3f1c0d828bbe77512ee92cb76db}{snmp\+Agent\+Create\+View} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$view\+Name, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$subtree, size\+\_\+t subtree\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{web__socket_8h_a8a74907784be6c7786c2d060c8d7e10b}{mask}, size\+\_\+t mask\+Len, \hyperlink{snmp__agent__vacm_8h_af9211ac922f85ec38c917879483643aa}{Snmp\+View\+Type} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Create a new M\+IB view. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a330dcef0cb755d31f589c6db9f55cb8f}{snmp\+Agent\+Delete\+View} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$view\+Name, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$subtree, size\+\_\+t subtree\+Len)
\begin{DoxyCompactList}\small\item\em Delete an existing M\+IB view. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a7ba98de35572b8375577feecbd654668}{snmp\+Agent\+Send\+Trap} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$\hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{dest\+Ip\+Addr}, \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} generic\+Trap\+Type, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} specific\+Trap\+Code, const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$object\+List, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} object\+List\+Size)
\begin{DoxyCompactList}\small\item\em Send S\+N\+MP trap notification. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent_8c_a0ff8b0b24ab11372d6ca3f101bbdd1f6}{snmp\+Agent\+Send\+Inform} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$\hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{dest\+Ip\+Addr}, \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$user\+Name, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} generic\+Trap\+Type, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} specific\+Trap\+Code, const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$object\+List, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} object\+List\+Size)
\begin{DoxyCompactList}\small\item\em Send S\+N\+MP inform request. \end{DoxyCompactList}\item 
void \hyperlink{snmp__agent_8c_a88caf613d774e191c0ad829f36232cfd}{snmp\+Agent\+Task} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em S\+N\+MP agent task. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+N\+MP agent (Simple Network Management Protocol) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
S\+N\+MP is a simple protocol by which management information for a network element may be inspected or altered by logically remote users. Refer to the following R\+F\+Cs for complete details\+:
\begin{DoxyItemize}
\item R\+FC 1157\+: A Simple Network Management Protocol (S\+N\+MP)
\item R\+FC 1905\+: Protocol Operations for Version 2 of the Simple Network Management Protocol (S\+N\+M\+Pv2)
\item R\+FC 3410\+: Introduction and Applicability Statements for Internet Standard Management Framework
\item R\+FC 3411\+: An Architecture for Describing S\+N\+MP Management Frameworks
\item R\+FC 3412\+: Message Processing and Dispatching for the S\+N\+MP
\item R\+FC 3413\+: Simple Network Management Protocol (S\+N\+MP) Applications
\item R\+FC 3584\+: Coexistence between Version 1, Version 2, and Version 3 of S\+N\+MP Framework
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{snmp__agent_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{snmp__agent_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_af5cf34762d7114743a58dd8a05289bd9}{S\+N\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 48 of file snmp\+\_\+agent.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{snmp__agent_8c_ac436ad93a4cfd299bc560ddce08bb3cb}\label{snmp__agent_8c_ac436ad93a4cfd299bc560ddce08bb3cb}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Create\+Access@{snmp\+Agent\+Create\+Access}}
\index{snmp\+Agent\+Create\+Access@{snmp\+Agent\+Create\+Access}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Create\+Access()}{snmpAgentCreateAccess()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Create\+Access (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{group\+Name,  }\item[{\hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model}}]{security\+Model,  }\item[{\hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612}{Snmp\+Security\+Level}}]{security\+Level,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{context\+Prefix,  }\item[{\hyperlink{snmp__agent__vacm_8h_a8cef40e8881cb290d68171da147f6f20}{Snmp\+Context\+Match}}]{context\+Match,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{read\+View\+Name,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{write\+View\+Name,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{notify\+View\+Name }\end{DoxyParamCaption})}



Create access policy for the specified group name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em group\+Name} & N\+U\+L\+L-\/terminated string that contains the group name \\
\hline
\mbox{\tt in}  & {\em security\+Model} & Security model \\
\hline
\mbox{\tt in}  & {\em security\+Level} & Security level \\
\hline
\mbox{\tt in}  & {\em context\+Prefix} & N\+U\+L\+L-\/terminated string that contains the context name prefix \\
\hline
\mbox{\tt in}  & {\em context\+Match} & Context match \\
\hline
\mbox{\tt in}  & {\em read\+View\+Name} & N\+U\+L\+L-\/terminated string that contains the read view name \\
\hline
\mbox{\tt in}  & {\em write\+View\+Name} & N\+U\+L\+L-\/terminated string that contains the write view name \\
\hline
\mbox{\tt in}  & {\em notify\+View\+Name} & N\+U\+L\+L-\/terminated string that contains the notify view name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1141 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1146 \{
1147 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
1148    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1149    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1150    \hyperlink{structSnmpAccessEntry}{SnmpAccessEntry} *entry;
1151 
1152    \textcolor{comment}{//Check parameters}
1153    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || groupName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix} == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1154       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1155    \textcolor{keywordflow}{if}(readViewName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || writeViewName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || notifyViewName == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1156       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1157 
1158    \textcolor{comment}{//Check security model}
1159    \textcolor{keywordflow}{if}(securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695a9f02fa28fe8ccae6ee20c874584e5de8}{SNMP\_SECURITY\_MODEL\_ANY} &&
1160       securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695ae3de1e0065ac71136736dfc32a7d6704}{SNMP\_SECURITY\_MODEL\_V1} &&
1161       securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695ae2bc999bcb1df0c455037f8184589959}{SNMP\_SECURITY\_MODEL\_V2C} &&
1162       securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695a21c6309103699e29211c87fd78c79521}{SNMP\_SECURITY\_MODEL\_USM})
1163    \{
1164       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1165    \}
1166 
1167    \textcolor{comment}{//Check security level}
1168    \textcolor{keywordflow}{if}(securityLevel != \hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612ae263055fd5ff66ac93f6d5a1b9885116}{SNMP\_SECURITY\_LEVEL\_NO\_AUTH\_NO\_PRIV} &&
1169       securityLevel != \hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612adde91d744f2e65bb9eac4f26b7cff9e0}{SNMP\_SECURITY\_LEVEL\_AUTH\_NO\_PRIV} &&
1170       securityLevel != \hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612ab2d046c82ee883f1d60d66c71b282127}{SNMP\_SECURITY\_LEVEL\_AUTH\_PRIV})
1171    \{
1172       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1173    \}
1174 
1175    \textcolor{comment}{//Check context match}
1176    \textcolor{keywordflow}{if}(contextMatch != \hyperlink{snmp__agent__vacm_8h_a8cef40e8881cb290d68171da147f6f20a4bc95716a2bab835d5d91ff473f286f9}{SNMP\_CONTEXT\_MATCH\_EXACT} &&
1177       contextMatch != \hyperlink{snmp__agent__vacm_8h_a8cef40e8881cb290d68171da147f6f20ae58792f19c0d822290006765a2cffe6c}{SNMP\_CONTEXT\_MATCH\_PREFIX})
1178    \{
1179       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1180    \}
1181 
1182    \textcolor{comment}{//Retrieve the length of the group name}
1183    n = strlen(groupName);
1184 
1185    \textcolor{comment}{//Make sure the group name is valid}
1186    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_a0810d82091ca56abdd23f86a04944c32}{SNMP\_MAX\_GROUP\_NAME\_LEN})
1187       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1188 
1189    \textcolor{comment}{//Make sure the context name prefix is valid}
1190    \textcolor{keywordflow}{if}(strlen(\hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix}) > \hyperlink{snmp__common_8h_a59ce7ec8feba50f15272257094e14ac8}{SNMP\_MAX\_CONTEXT\_NAME\_LEN})
1191       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1192 
1193    \textcolor{comment}{//Make sure the read view name is valid}
1194    \textcolor{keywordflow}{if}(strlen(readViewName) > \hyperlink{snmp__common_8h_a8188d8ada88e9fc2c0a6d2010105b14c}{SNMP\_MAX\_VIEW\_NAME\_LEN})
1195       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1196 
1197    \textcolor{comment}{//Make sure the write view name is valid}
1198    \textcolor{keywordflow}{if}(strlen(writeViewName) > \hyperlink{snmp__common_8h_a8188d8ada88e9fc2c0a6d2010105b14c}{SNMP\_MAX\_VIEW\_NAME\_LEN})
1199       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1200 
1201    \textcolor{comment}{//Make sure the notify view name is valid}
1202    \textcolor{keywordflow}{if}(strlen(notifyViewName) > \hyperlink{snmp__common_8h_a8188d8ada88e9fc2c0a6d2010105b14c}{SNMP\_MAX\_VIEW\_NAME\_LEN})
1203       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1204 
1205    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1206    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1207 
1208    \textcolor{comment}{//Search the access table for a matching entry}
1209    entry = \hyperlink{snmp__agent__vacm_8c_a16bfa3443eca536bcb326f47e117dd41}{snmpFindAccessEntry}(context, groupName, 
      \hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix},
1210       securityModel, securityLevel);
1211 
1212    \textcolor{comment}{//No matching entry found?}
1213    \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1214    \{
1215       \textcolor{comment}{//Create a new entry in the access table}
1216       entry = \hyperlink{snmp__agent__vacm_8c_a61ba0b95e342f8b5416fa8bbb3507d3c}{snmpCreateAccessEntry}(context);
1217    \}
1218 
1219    \textcolor{comment}{//Any entry available?}
1220    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1221    \{
1222       \textcolor{comment}{//Clear entry}
1223       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpAccessEntry}{SnmpAccessEntry}));
1224 
1225       \textcolor{comment}{//Save group name}
1226       strcpy(entry->\hyperlink{structSnmpAccessEntry_a00aa9f193a226e0d2b3753225fbab667}{groupName}, groupName);
1227       \textcolor{comment}{//Save context name prefix}
1228       strcpy(entry->\hyperlink{structSnmpAccessEntry_aed0f5f189ab50350b9e50d28a65faa39}{contextPrefix}, \hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix});
1229       \textcolor{comment}{//Save security model}
1230       entry->\hyperlink{structSnmpAccessEntry_a226703910f64e584c35dece895584f8f}{securityModel} = securityModel;
1231       \textcolor{comment}{//Save security level}
1232       entry->\hyperlink{structSnmpAccessEntry_a46ecf3e9fa2ef86d3661de5ceb279f2a}{securityLevel} = securityLevel;
1233       \textcolor{comment}{//Save context match}
1234       entry->\hyperlink{structSnmpAccessEntry_a01114d52380d6cf6d57407e9af503bf0}{contextMatch} = contextMatch;
1235       \textcolor{comment}{//Save read view name}
1236       strcpy(entry->\hyperlink{structSnmpAccessEntry_aa5691126835f643e16eca03938fd7bb5}{readViewName}, readViewName);
1237       \textcolor{comment}{//Save write view name}
1238       strcpy(entry->\hyperlink{structSnmpAccessEntry_a44bdb9c26c3158808b9c65daa418b8ce}{writeViewName}, writeViewName);
1239       \textcolor{comment}{//Save notify view name}
1240       strcpy(entry->\hyperlink{structSnmpAccessEntry_a55d2f13d5f46593a17b29a88293b29e2}{notifyViewName}, notifyViewName);
1241 
1242       \textcolor{comment}{//The entry is now available for use}
1243       entry->\hyperlink{structSnmpAccessEntry_a8abdd58d85a24efce6aba1b1948f1616}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a438de565ef13d128f16f420284316088}{MIB\_ROW\_STATUS\_ACTIVE};
1244 
1245       \textcolor{comment}{//Successful processing}
1246       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1247    \}
1248    \textcolor{keywordflow}{else}
1249    \{
1250       \textcolor{comment}{//The access table runs out of space}
1251       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
1252    \}
1253 
1254    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1255    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1256 
1257    \textcolor{comment}{//Return status code}
1258    \textcolor{keywordflow}{return} error;
1259 \textcolor{preprocessor}{#else}
1260    \textcolor{comment}{//Not implemented}
1261    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1262 \textcolor{preprocessor}{#endif}
1263 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a1f6d1528707c57051d4d287954412be2}\label{snmp__agent_8c_a1f6d1528707c57051d4d287954412be2}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Create\+Community@{snmp\+Agent\+Create\+Community}}
\index{snmp\+Agent\+Create\+Community@{snmp\+Agent\+Create\+Community}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Create\+Community()}{snmpAgentCreateCommunity()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Create\+Community (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{community,  }\item[{\hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5ca}{Snmp\+Access}}]{mode }\end{DoxyParamCaption})}



Create a new community string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em community} & N\+U\+L\+L-\/terminated string that contains the community name \\
\hline
\mbox{\tt in}  & {\em mode} & Access rights \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 603 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
605 \{
606 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED || SNMP\_V2C\_SUPPORT == ENABLED)}
607    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
608    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
609    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
610 
611    \textcolor{comment}{//Check parameters}
612    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || community == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
613       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
614 
615    \textcolor{comment}{//Retrieve the length of the community string}
616    n = strlen(community);
617 
618    \textcolor{comment}{//Make sure the community string is valid}
619    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_ae889f56d8038ef202bca4b1d974bd53f}{SNMP\_MAX\_USER\_NAME\_LEN})
620       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
621 
622    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
623    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
624 
625    \textcolor{comment}{//Check whether the community string already exists}
626    entry = \hyperlink{snmp__agent__misc_8c_aac1d3ba9a7753dd2afd22d27f199f7a9}{snmpFindCommunityEntry}(context, community, strlen(community));
627 
628    \textcolor{comment}{//If the specified community string does not exist, then a new entry}
629    \textcolor{comment}{//should be created}
630    \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
631    \{
632       \textcolor{comment}{//Create a new entry}
633       entry = \hyperlink{snmp__agent__misc_8c_ad1bc35f9a17a770f8a03e4674f8ebaa5}{snmpCreateCommunityEntry}(context);
634    \}
635 
636    \textcolor{comment}{//Any entry available?}
637    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
638    \{
639       \textcolor{comment}{//Clear the contents}
640       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpUserEntry}{SnmpUserEntry}));
641 
642       \textcolor{comment}{//Save community string}
643       strcpy(entry->\hyperlink{structSnmpUserEntry_a60ae402e93fecec705e4f7ff0755360f}{name}, community);
644       \textcolor{comment}{//Set access rights}
645       entry->\hyperlink{structSnmpUserEntry_af0824f5ebfa463d31b6d9983def956eb}{mode} = \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode};
646       \textcolor{comment}{//The entry is now available for use}
647       entry->\hyperlink{structSnmpUserEntry_add2c8c54d828652fa85a0697654e0573}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a438de565ef13d128f16f420284316088}{MIB\_ROW\_STATUS\_ACTIVE};
648 
649       \textcolor{comment}{//Successful processing}
650       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
651    \}
652    \textcolor{keywordflow}{else}
653    \{
654       \textcolor{comment}{//The table runs out of space}
655       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
656    \}
657 
658    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
659    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
660 
661    \textcolor{comment}{//Return error code}
662    \textcolor{keywordflow}{return} error;
663 \textcolor{preprocessor}{#else}
664    \textcolor{comment}{//Not implemented}
665    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
666 \textcolor{preprocessor}{#endif}
667 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a3c1dec86c8d939ef89db5d137c4bbe01}\label{snmp__agent_8c_a3c1dec86c8d939ef89db5d137c4bbe01}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Create\+User@{snmp\+Agent\+Create\+User}}
\index{snmp\+Agent\+Create\+User@{snmp\+Agent\+Create\+User}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Create\+User()}{snmpAgentCreateUser()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Create\+User (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name,  }\item[{\hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5ca}{Snmp\+Access}}]{mode,  }\item[{\hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689a}{Snmp\+Key\+Format}}]{key\+Format,  }\item[{\hyperlink{snmp__agent__usm_8h_a13c46b84c881bd15bad7093a7f3639e3}{Snmp\+Auth\+Protocol}}]{auth\+Protocol,  }\item[{const void $\ast$}]{auth\+Key,  }\item[{\hyperlink{snmp__agent__usm_8h_acfd97e4fdb0cd081855bcb3d922dd851}{Snmp\+Priv\+Protocol}}]{priv\+Protocol,  }\item[{const void $\ast$}]{priv\+Key }\end{DoxyParamCaption})}



Create a new user. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em user\+Name} & N\+U\+L\+L-\/terminated string that contains the user name \\
\hline
\mbox{\tt in}  & {\em mode} & Access rights \\
\hline
\mbox{\tt in}  & {\em key\+Format} & Key format (A\+S\+C\+II password or raw key) \\
\hline
\mbox{\tt in}  & {\em auth\+Protocol} & Authentication type \\
\hline
\mbox{\tt in}  & {\em auth\+Key} & Key to be used for data authentication \\
\hline
\mbox{\tt in}  & {\em priv\+Protocol} & Privacy type \\
\hline
\mbox{\tt in}  & {\em priv\+Key} & Key to be used for data encryption \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 735 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
739 \{
740 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
741    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
742    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
743    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
744 
745    \textcolor{comment}{//Check parameters}
746    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
747       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
748 
749    \textcolor{comment}{//Data authentication?}
750    \textcolor{keywordflow}{if}(authProtocol != \hyperlink{snmp__agent__usm_8h_a13c46b84c881bd15bad7093a7f3639e3a2c9ec503096d5f8c9f31352c4ad6488b}{SNMP\_AUTH\_PROTOCOL\_NONE})
751    \{
752       \textcolor{comment}{//Check key format}
753       \textcolor{keywordflow}{if}(keyFormat != \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aa4a1f2a30e1f6e025919755625396e2fb}{SNMP\_KEY\_FORMAT\_TEXT} &&
754          keyFormat != \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aad10c80eb047be69f74d4d1c16f2544cb}{SNMP\_KEY\_FORMAT\_RAW} &&
755          keyFormat != \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aa50c0219a6a3c1c4e13239a334098dacd}{SNMP\_KEY\_FORMAT\_LOCALIZED})
756       \{
757          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
758       \}
759 
760       \textcolor{comment}{//Data authentication requires a key}
761       \textcolor{keywordflow}{if}(authKey == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
762          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
763    \}
764 
765    \textcolor{comment}{//Data confidentiality?}
766    \textcolor{keywordflow}{if}(privProtocol != \hyperlink{snmp__agent__usm_8h_acfd97e4fdb0cd081855bcb3d922dd851a29bcb0f6410e21559159915d4c08dac8}{SNMP\_PRIV\_PROTOCOL\_NONE})
767    \{
768       \textcolor{comment}{//Check key format}
769       \textcolor{keywordflow}{if}(keyFormat != \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aa4a1f2a30e1f6e025919755625396e2fb}{SNMP\_KEY\_FORMAT\_TEXT} && keyFormat != 
      \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aad10c80eb047be69f74d4d1c16f2544cb}{SNMP\_KEY\_FORMAT\_RAW})
770          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
771 
772       \textcolor{comment}{//Data confidentiality requires a key}
773       \textcolor{keywordflow}{if}(privKey == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
774          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
775 
776       \textcolor{comment}{//There is no provision for data confidentiality without data authentication}
777       \textcolor{keywordflow}{if}(authProtocol == \hyperlink{snmp__agent__usm_8h_a13c46b84c881bd15bad7093a7f3639e3a2c9ec503096d5f8c9f31352c4ad6488b}{SNMP\_AUTH\_PROTOCOL\_NONE})
778          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
779    \}
780 
781    \textcolor{comment}{//Retrieve the length of the user name}
782    n = strlen(userName);
783 
784    \textcolor{comment}{//Make sure the user name is valid}
785    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_ae889f56d8038ef202bca4b1d974bd53f}{SNMP\_MAX\_USER\_NAME\_LEN})
786       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
787 
788    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
789    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
790 
791    \textcolor{comment}{//Check whether the user name already exists}
792    entry = \hyperlink{snmp__agent__usm_8c_adb4ad71f3b5167a13a2551f075c25110}{snmpFindUserEntry}(context, userName, strlen(userName));
793 
794    \textcolor{comment}{//If the specified user name does not exist, then a new entry}
795    \textcolor{comment}{//should be created}
796    \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
797    \{
798       \textcolor{comment}{//Create a security profile for the new user}
799       entry = \hyperlink{snmp__agent__usm_8c_aa834b11d54972a9deb6af7253f99a541}{snmpCreateUserEntry}(context);
800    \}
801 
802    \textcolor{comment}{//Any entry available?}
803    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
804    \{
805       \textcolor{comment}{//Clear the security profile of the user}
806       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpUserEntry}{SnmpUserEntry}));
807 
808       \textcolor{comment}{//Save user name}
809       strcpy(entry->\hyperlink{structSnmpUserEntry_a60ae402e93fecec705e4f7ff0755360f}{name}, userName);
810       \textcolor{comment}{//Access rights}
811       entry->\hyperlink{structSnmpUserEntry_af0824f5ebfa463d31b6d9983def956eb}{mode} = \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode};
812       \textcolor{comment}{//Authentication protocol}
813       entry->\hyperlink{structSnmpUserEntry_a5131eefca59001108b44e59b284397db}{authProtocol} = authProtocol;
814       \textcolor{comment}{//Privacy protocol}
815       entry->\hyperlink{structSnmpUserEntry_a59bfb353ffa70a6791f0a6d5608ec0eb}{privProtocol} = privProtocol;
816 
817       \textcolor{comment}{//Initialize status code}
818       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
819 
820       \textcolor{comment}{//Data authentication?}
821       \textcolor{keywordflow}{if}(authProtocol != \hyperlink{snmp__agent__usm_8h_a13c46b84c881bd15bad7093a7f3639e3a2c9ec503096d5f8c9f31352c4ad6488b}{SNMP\_AUTH\_PROTOCOL\_NONE})
822       \{
823          \textcolor{comment}{//ASCII password or raw key?}
824          \textcolor{keywordflow}{if}(keyFormat == \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aa4a1f2a30e1f6e025919755625396e2fb}{SNMP\_KEY\_FORMAT\_TEXT})
825          \{
826             \textcolor{comment}{//Generate the authentication key from the provided password}
827             error = \hyperlink{snmp__agent__usm_8c_a3e019f63dd6f8a7287e5e0125526b755}{snmpGenerateKey}(authProtocol, authKey, &entry->
      \hyperlink{structSnmpUserEntry_a32003a1f649e6244a8453157d6502f92}{rawAuthKey});
828 
829             \textcolor{comment}{//Check status code}
830             \textcolor{keywordflow}{if}(!error)
831             \{
832                \textcolor{comment}{//Localize the key with the engine ID}
833                error = \hyperlink{snmp__agent__usm_8c_a169a3d5db383131661599d6b19d81ee5}{snmpLocalizeKey}(authProtocol,
834                   context->contextEngine, context->contextEngineLen,
835                   &entry->\hyperlink{structSnmpUserEntry_a32003a1f649e6244a8453157d6502f92}{rawAuthKey}, &entry->\hyperlink{structSnmpUserEntry_abe989af09e827849ce740a3813edcbc7}{localizedAuthKey});
836             \}
837          \}
838          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyFormat == \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aad10c80eb047be69f74d4d1c16f2544cb}{SNMP\_KEY\_FORMAT\_RAW})
839          \{
840             \textcolor{comment}{//Save the authentication key}
841             memcpy(&entry->\hyperlink{structSnmpUserEntry_a32003a1f649e6244a8453157d6502f92}{rawAuthKey}, authKey, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpKey}{SnmpKey}));
842 
843             \textcolor{comment}{//Now localize the key with the engine ID}
844             error = \hyperlink{snmp__agent__usm_8c_a169a3d5db383131661599d6b19d81ee5}{snmpLocalizeKey}(authProtocol,
845                context->contextEngine, context->contextEngineLen,
846                &entry->\hyperlink{structSnmpUserEntry_a32003a1f649e6244a8453157d6502f92}{rawAuthKey}, &entry->\hyperlink{structSnmpUserEntry_abe989af09e827849ce740a3813edcbc7}{localizedAuthKey});
847          \}
848          \textcolor{keywordflow}{else}
849          \{
850             \textcolor{comment}{//The authentication key is already localized}
851             memcpy(&entry->\hyperlink{structSnmpUserEntry_abe989af09e827849ce740a3813edcbc7}{localizedAuthKey}, authKey, \textcolor{keyword}{sizeof}(
      \hyperlink{structSnmpKey}{SnmpKey}));
852          \}
853       \}
854 
855       \textcolor{comment}{//Check status code}
856       \textcolor{keywordflow}{if}(!error)
857       \{
858          \textcolor{comment}{//Data confidentiality?}
859          \textcolor{keywordflow}{if}(privProtocol != \hyperlink{snmp__agent__usm_8h_acfd97e4fdb0cd081855bcb3d922dd851a29bcb0f6410e21559159915d4c08dac8}{SNMP\_PRIV\_PROTOCOL\_NONE})
860          \{
861             \textcolor{comment}{//ASCII password or raw key?}
862             \textcolor{keywordflow}{if}(keyFormat == \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aa4a1f2a30e1f6e025919755625396e2fb}{SNMP\_KEY\_FORMAT\_TEXT})
863             \{
864                \textcolor{comment}{//Generate the privacy key from the provided password}
865                error = \hyperlink{snmp__agent__usm_8c_a3e019f63dd6f8a7287e5e0125526b755}{snmpGenerateKey}(authProtocol, privKey, &entry->
      \hyperlink{structSnmpUserEntry_ac4445ac274e1da56ffb5c037c9f9cb46}{rawPrivKey});
866 
867                \textcolor{comment}{//Check status code}
868                \textcolor{keywordflow}{if}(!error)
869                \{
870                   \textcolor{comment}{//Localize the key with the engine ID}
871                   error = \hyperlink{snmp__agent__usm_8c_a169a3d5db383131661599d6b19d81ee5}{snmpLocalizeKey}(authProtocol,
872                      context->contextEngine, context->contextEngineLen,
873                      &entry->\hyperlink{structSnmpUserEntry_ac4445ac274e1da56ffb5c037c9f9cb46}{rawPrivKey}, &entry->\hyperlink{structSnmpUserEntry_aee3ff1ac4b61b242440a14543c06bef2}{localizedPrivKey});
874                \}
875             \}
876             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyFormat == \hyperlink{snmp__agent__usm_8h_a26b0f696155116b4f9abd29377c4689aad10c80eb047be69f74d4d1c16f2544cb}{SNMP\_KEY\_FORMAT\_RAW})
877             \{
878                \textcolor{comment}{//Save the privacy key}
879                memcpy(&entry->\hyperlink{structSnmpUserEntry_ac4445ac274e1da56ffb5c037c9f9cb46}{rawPrivKey}, privKey, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpKey}{SnmpKey}));
880 
881                \textcolor{comment}{//Now localize the key with the engine ID}
882                error = \hyperlink{snmp__agent__usm_8c_a169a3d5db383131661599d6b19d81ee5}{snmpLocalizeKey}(authProtocol,
883                   context->contextEngine, context->contextEngineLen,
884                   &entry->\hyperlink{structSnmpUserEntry_ac4445ac274e1da56ffb5c037c9f9cb46}{rawPrivKey}, &entry->\hyperlink{structSnmpUserEntry_aee3ff1ac4b61b242440a14543c06bef2}{localizedPrivKey});
885             \}
886             \textcolor{keywordflow}{else}
887             \{
888                \textcolor{comment}{//The privacy key is already localized}
889                memcpy(&entry->\hyperlink{structSnmpUserEntry_aee3ff1ac4b61b242440a14543c06bef2}{localizedPrivKey}, privKey, \textcolor{keyword}{sizeof}(
      \hyperlink{structSnmpKey}{SnmpKey}));
890             \}
891          \}
892       \}
893 
894       \textcolor{comment}{//Check status code}
895       \textcolor{keywordflow}{if}(!error)
896       \{
897          \textcolor{comment}{//The entry is now available for use}
898          entry->\hyperlink{structSnmpUserEntry_add2c8c54d828652fa85a0697654e0573}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a438de565ef13d128f16f420284316088}{MIB\_ROW\_STATUS\_ACTIVE};
899       \}
900       \textcolor{keywordflow}{else}
901       \{
902          \textcolor{comment}{//Clean up side effects}
903          memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpUserEntry}{SnmpUserEntry}));
904          \textcolor{comment}{//Now mark the entry as free}
905          entry->\hyperlink{structSnmpUserEntry_add2c8c54d828652fa85a0697654e0573}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
906       \}
907    \}
908    \textcolor{keywordflow}{else}
909    \{
910       \textcolor{comment}{//The user table runs out of space}
911       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
912    \}
913 
914    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
915    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
916 
917    \textcolor{comment}{//Return error code}
918    \textcolor{keywordflow}{return} error;
919 \textcolor{preprocessor}{#else}
920    \textcolor{comment}{//Not implemented}
921    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
922 \textcolor{preprocessor}{#endif}
923 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a1af1e3f1c0d828bbe77512ee92cb76db}\label{snmp__agent_8c_a1af1e3f1c0d828bbe77512ee92cb76db}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Create\+View@{snmp\+Agent\+Create\+View}}
\index{snmp\+Agent\+Create\+View@{snmp\+Agent\+Create\+View}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Create\+View()}{snmpAgentCreateView()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Create\+View (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{view\+Name,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{subtree,  }\item[{size\+\_\+t}]{subtree\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{mask,  }\item[{size\+\_\+t}]{mask\+Len,  }\item[{\hyperlink{snmp__agent__vacm_8h_af9211ac922f85ec38c917879483643aa}{Snmp\+View\+Type}}]{type }\end{DoxyParamCaption})}



Create a new M\+IB view. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em view\+Name} & N\+U\+L\+L-\/terminated string that contains the view name \\
\hline
\mbox{\tt in}  & {\em subtree} & Pointer to the subtree \\
\hline
\mbox{\tt in}  & {\em subtree\+Len} & Length of the subtree, in bytes \\
\hline
\mbox{\tt in}  & {\em mask} & Pointer to the bit mask \\
\hline
\mbox{\tt in}  & {\em mask\+Len} & Length of the bit mask \\
\hline
\mbox{\tt in}  & {\em type} & View type \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1336 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1339 \{
1340 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
1341    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1342    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1343    \hyperlink{structSnmpViewEntry}{SnmpViewEntry} *entry;
1344 
1345    \textcolor{comment}{//Check parameters}
1346    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || viewName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || subtree == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1347       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1348 
1349    \textcolor{comment}{//Check view type}
1350    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} != \hyperlink{snmp__agent__vacm_8h_af9211ac922f85ec38c917879483643aaa95645902fe19983f42883dd4bf51b15c}{SNMP\_VIEW\_TYPE\_INCLUDED} &&
1351       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} != \hyperlink{snmp__agent__vacm_8h_af9211ac922f85ec38c917879483643aaa948f6903ac71d2534ab127fbaa147fc0}{SNMP\_VIEW\_TYPE\_EXCLUDED})
1352    \{
1353       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1354    \}
1355 
1356    \textcolor{comment}{//Retrieve the length of the view name}
1357    n = strlen(viewName);
1358 
1359    \textcolor{comment}{//Make sure the view name is valid}
1360    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_a8188d8ada88e9fc2c0a6d2010105b14c}{SNMP\_MAX\_VIEW\_NAME\_LEN})
1361       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1362 
1363    \textcolor{comment}{//Make sure the subtree is valid}
1364    \textcolor{keywordflow}{if}(subtreeLen == 0 || subtreeLen > \hyperlink{mib__common_8h_a70ab69e5198d8438346981c7b26dabca}{MIB\_MAX\_OID\_SIZE})
1365       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1366 
1367    \textcolor{comment}{//Make sure the bit mask is valid}
1368    \textcolor{keywordflow}{if}(maskLen > 0 && \hyperlink{web__socket_8h_a8a74907784be6c7786c2d060c8d7e10b}{mask} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1369       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1370    \textcolor{keywordflow}{if}(maskLen > \hyperlink{snmp__common_8h_a3f142408a36a20aa0c4214559ff23903}{SNMP\_MAX\_BIT\_MASK\_SIZE})
1371       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1372 
1373    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1374    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1375 
1376    \textcolor{comment}{//Search the view table for a matching entry}
1377    entry = \hyperlink{snmp__agent__vacm_8c_afd75c739785a988749fc503fcd64d325}{snmpFindViewEntry}(context, viewName, subtree, subtreeLen);
1378 
1379    \textcolor{comment}{//No matching entry found?}
1380    \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1381    \{
1382       \textcolor{comment}{//Create a new entry in the view table}
1383       entry = \hyperlink{snmp__agent__vacm_8c_a0c0146554c1b728d85beebe146735091}{snmpCreateViewEntry}(context);
1384    \}
1385 
1386    \textcolor{comment}{//Any entry available?}
1387    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1388    \{
1389       \textcolor{comment}{//Clear entry}
1390       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpViewEntry}{SnmpViewEntry}));
1391 
1392       \textcolor{comment}{//Save view name}
1393       strcpy(entry->\hyperlink{structSnmpViewEntry_a6ce36343aeaa16e8b824211598a769c5}{viewName}, viewName);
1394       \textcolor{comment}{//Save subtree}
1395       memcpy(entry->\hyperlink{structSnmpViewEntry_a640a3c23d13bbf9de16ebf23097abc12}{subtree}, subtree, subtreeLen);
1396       \textcolor{comment}{//Save the length of the subtree}
1397       entry->\hyperlink{structSnmpViewEntry_a0b1d281049f1ea869ecb6a7af5a01cb1}{subtreeLen} = subtreeLen;
1398       \textcolor{comment}{//Save bit mask}
1399       memcpy(entry->\hyperlink{structSnmpViewEntry_a692738ca6f958b97c6c1b9b58e2f5e91}{mask}, \hyperlink{web__socket_8h_a8a74907784be6c7786c2d060c8d7e10b}{mask}, maskLen);
1400       \textcolor{comment}{//Save the length of the bit mask}
1401       entry->\hyperlink{structSnmpViewEntry_a6f23a9a82dcf611acc03489e9e812fbe}{maskLen} = maskLen;
1402       \textcolor{comment}{//Save type}
1403       entry->\hyperlink{structSnmpViewEntry_a32a9315f088375a8cd408ded58a20021}{type} = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
1404 
1405       \textcolor{comment}{//The entry is now available for use}
1406       entry->\hyperlink{structSnmpViewEntry_a6eae2c4516db476272ac128113d0748b}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a438de565ef13d128f16f420284316088}{MIB\_ROW\_STATUS\_ACTIVE};
1407 
1408       \textcolor{comment}{//Successful processing}
1409       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1410    \}
1411    \textcolor{keywordflow}{else}
1412    \{
1413       \textcolor{comment}{//The view table runs out of space}
1414       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
1415    \}
1416 
1417    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1418    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1419 
1420    \textcolor{comment}{//Return status code}
1421    \textcolor{keywordflow}{return} error;
1422 \textcolor{preprocessor}{#else}
1423    \textcolor{comment}{//Not implemented}
1424    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1425 \textcolor{preprocessor}{#endif}
1426 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_ac6d8fb53d9c7ee5d805ebe7c1d604ff8}\label{snmp__agent_8c_ac6d8fb53d9c7ee5d805ebe7c1d604ff8}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Delete\+Access@{snmp\+Agent\+Delete\+Access}}
\index{snmp\+Agent\+Delete\+Access@{snmp\+Agent\+Delete\+Access}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Delete\+Access()}{snmpAgentDeleteAccess()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Delete\+Access (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{group\+Name,  }\item[{\hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model}}]{security\+Model,  }\item[{\hyperlink{snmp__agent__usm_8h_a51b89f597dc71c414d602a9195864612}{Snmp\+Security\+Level}}]{security\+Level,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{context\+Prefix }\end{DoxyParamCaption})}



Delete an existing access policy. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em group\+Name} & N\+U\+L\+L-\/terminated string that contains the group name \\
\hline
\mbox{\tt in}  & {\em security\+Model} & Security model \\
\hline
\mbox{\tt in}  & {\em security\+Level} & Security level \\
\hline
\mbox{\tt in}  & {\em context\+Prefix} & N\+U\+L\+L-\/terminated string that contains the context name prefix \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1276 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1279 \{
1280 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
1281    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1282    \hyperlink{structSnmpAccessEntry}{SnmpAccessEntry} *entry;
1283 
1284    \textcolor{comment}{//Check parameters}
1285    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || groupName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix} == 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1286       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1287 
1288    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1289    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1290 
1291    \textcolor{comment}{//Search the access table for a matching entry}
1292    entry = \hyperlink{snmp__agent__vacm_8c_a16bfa3443eca536bcb326f47e117dd41}{snmpFindAccessEntry}(context, groupName, 
      \hyperlink{ndp_8h_adf7f706b22c25e9ed77265df8517f6fc}{contextPrefix},
1293       securityModel, securityLevel);
1294 
1295    \textcolor{comment}{//Any matching entry found?}
1296    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1297    \{
1298       \textcolor{comment}{//Clear the entry}
1299       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpAccessEntry}{SnmpAccessEntry}));
1300       \textcolor{comment}{//Now mark the entry as free}
1301       entry->\hyperlink{structSnmpAccessEntry_a8abdd58d85a24efce6aba1b1948f1616}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
1302 
1303       \textcolor{comment}{//Successful processing}
1304       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1305    \}
1306    \textcolor{keywordflow}{else}
1307    \{
1308       \textcolor{comment}{//The specified entry does not exist}
1309       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
1310    \}
1311 
1312    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1313    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1314 
1315    \textcolor{comment}{//Return status code}
1316    \textcolor{keywordflow}{return} error;
1317 \textcolor{preprocessor}{#else}
1318    \textcolor{comment}{//Not implemented}
1319    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1320 \textcolor{preprocessor}{#endif}
1321 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a59903fc75c378b763b3fb148c8fec129}\label{snmp__agent_8c_a59903fc75c378b763b3fb148c8fec129}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Delete\+Community@{snmp\+Agent\+Delete\+Community}}
\index{snmp\+Agent\+Delete\+Community@{snmp\+Agent\+Delete\+Community}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Delete\+Community()}{snmpAgentDeleteCommunity()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Delete\+Community (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{community }\end{DoxyParamCaption})}



Remove a community string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em community} & N\+U\+L\+L-\/terminated string that contains the community name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 677 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
678 \{
679 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED || SNMP\_V2C\_SUPPORT == ENABLED)}
680    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
681    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
682 
683    \textcolor{comment}{//Check parameters}
684    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || community == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
685       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
686 
687    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
688    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
689 
690    \textcolor{comment}{//Search the community table for the specified community string}
691    entry = \hyperlink{snmp__agent__misc_8c_aac1d3ba9a7753dd2afd22d27f199f7a9}{snmpFindCommunityEntry}(context, community, strlen(community));
692 
693    \textcolor{comment}{//Any matching entry found?}
694    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
695    \{
696       \textcolor{comment}{//Clear the contents}
697       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpUserEntry}{SnmpUserEntry}));
698       \textcolor{comment}{//Now mark the entry as free}
699       entry->\hyperlink{structSnmpUserEntry_add2c8c54d828652fa85a0697654e0573}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
700 
701       \textcolor{comment}{//Successful processing}
702       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
703    \}
704    \textcolor{keywordflow}{else}
705    \{
706       \textcolor{comment}{//The specified community string does not exist}
707       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
708    \}
709 
710    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
711    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
712 
713    \textcolor{comment}{//Return status code}
714    \textcolor{keywordflow}{return} error;
715 \textcolor{preprocessor}{#else}
716    \textcolor{comment}{//Not implemented}
717    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
718 \textcolor{preprocessor}{#endif}
719 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a245812815ecc8e460368dd05afa5aafc}\label{snmp__agent_8c_a245812815ecc8e460368dd05afa5aafc}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Delete\+User@{snmp\+Agent\+Delete\+User}}
\index{snmp\+Agent\+Delete\+User@{snmp\+Agent\+Delete\+User}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Delete\+User()}{snmpAgentDeleteUser()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Delete\+User (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name }\end{DoxyParamCaption})}



Remove existing user. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em user\+Name} & N\+U\+L\+L-\/terminated string that contains the user name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 933 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
934 \{
935 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
936    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
937    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
938 
939    \textcolor{comment}{//Check parameters}
940    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
941       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
942 
943    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
944    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
945 
946    \textcolor{comment}{//Search the user table for the specified user name}
947    entry = \hyperlink{snmp__agent__usm_8c_adb4ad71f3b5167a13a2551f075c25110}{snmpFindUserEntry}(context, userName, strlen(userName));
948 
949    \textcolor{comment}{//Any matching entry found?}
950    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
951    \{
952       \textcolor{comment}{//Clear the security profile of the user}
953       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpUserEntry}{SnmpUserEntry}));
954       \textcolor{comment}{//Now mark the entry as free}
955       entry->\hyperlink{structSnmpUserEntry_add2c8c54d828652fa85a0697654e0573}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
956 
957       \textcolor{comment}{//Successful processing}
958       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
959    \}
960    \textcolor{keywordflow}{else}
961    \{
962       \textcolor{comment}{//The specified user name does not exist}
963       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
964    \}
965 
966    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
967    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
968 
969    \textcolor{comment}{//Return status code}
970    \textcolor{keywordflow}{return} error;
971 \textcolor{preprocessor}{#else}
972    \textcolor{comment}{//Not implemented}
973    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
974 \textcolor{preprocessor}{#endif}
975 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a330dcef0cb755d31f589c6db9f55cb8f}\label{snmp__agent_8c_a330dcef0cb755d31f589c6db9f55cb8f}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Delete\+View@{snmp\+Agent\+Delete\+View}}
\index{snmp\+Agent\+Delete\+View@{snmp\+Agent\+Delete\+View}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Delete\+View()}{snmpAgentDeleteView()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Delete\+View (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{view\+Name,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{subtree,  }\item[{size\+\_\+t}]{subtree\+Len }\end{DoxyParamCaption})}



Delete an existing M\+IB view. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em view\+Name} & N\+U\+L\+L-\/terminated string that contains the view name \\
\hline
\mbox{\tt in}  & {\em subtree} & Pointer to the subtree \\
\hline
\mbox{\tt in}  & {\em subtree\+Len} & Length of the subtree, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1438 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1440 \{
1441 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
1442    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1443    \hyperlink{structSnmpViewEntry}{SnmpViewEntry} *entry;
1444 
1445    \textcolor{comment}{//Check parameters}
1446    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || viewName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || subtree == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1447       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1448 
1449    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1450    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1451 
1452    \textcolor{comment}{//Search the view table for a matching entry}
1453    entry = \hyperlink{snmp__agent__vacm_8c_afd75c739785a988749fc503fcd64d325}{snmpFindViewEntry}(context, viewName, subtree, subtreeLen);
1454 
1455    \textcolor{comment}{//Any matching entry found?}
1456    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1457    \{
1458       \textcolor{comment}{//Clear the entry}
1459       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpViewEntry}{SnmpViewEntry}));
1460       \textcolor{comment}{//Now mark the entry as free}
1461       entry->\hyperlink{structSnmpViewEntry_a6eae2c4516db476272ac128113d0748b}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
1462 
1463       \textcolor{comment}{//Successful processing}
1464       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1465    \}
1466    \textcolor{keywordflow}{else}
1467    \{
1468       \textcolor{comment}{//The specified entry does not exist}
1469       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
1470    \}
1471 
1472    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1473    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1474 
1475    \textcolor{comment}{//Return status code}
1476    \textcolor{keywordflow}{return} error;
1477 \textcolor{preprocessor}{#else}
1478    \textcolor{comment}{//Not implemented}
1479    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1480 \textcolor{preprocessor}{#endif}
1481 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a57cc396be1342a6d9ef188b0823950a5}\label{snmp__agent_8c_a57cc396be1342a6d9ef188b0823950a5}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Get\+Default\+Settings@{snmp\+Agent\+Get\+Default\+Settings}}
\index{snmp\+Agent\+Get\+Default\+Settings@{snmp\+Agent\+Get\+Default\+Settings}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Get\+Default\+Settings()}{snmpAgentGetDefaultSettings()}}
{\footnotesize\ttfamily void snmp\+Agent\+Get\+Default\+Settings (\begin{DoxyParamCaption}\item[{\hyperlink{structSnmpAgentSettings}{Snmp\+Agent\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



Initialize settings with default values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em settings} & Structure that contains S\+N\+MP agent settings \\
\hline
\end{DoxyParams}


Definition at line 73 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
74 \{
75    \textcolor{comment}{//The SNMP agent is not bound to any interface}
76    settings->\hyperlink{structSnmpAgentSettings_ab6c457ae9ee27a3160d9e3d5cb847439}{interface} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
77 
78    \textcolor{comment}{//Minimum version accepted by the SNMP agent}
79    settings->\hyperlink{structSnmpAgentSettings_aeeffa3bd908a4c92e8380c388c8663c4}{versionMin} = \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1};
80    \textcolor{comment}{//Maximum version accepted by the SNMP agent}
81    settings->\hyperlink{structSnmpAgentSettings_a709a4c333b2d522b20c37466b50e3e9a}{versionMax} = \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa92886bc76b0167bf8604e3a266c6be9c}{SNMP\_VERSION\_3};
82 
83    \textcolor{comment}{//SNMP port number}
84    settings->\hyperlink{structSnmpAgentSettings_a65d509855573423c26fbdf01cfc5a713}{port} = \hyperlink{snmp__common_8h_aafa60dee0b23954f025e6b82dbbc5ce9}{SNMP\_PORT};
85    \textcolor{comment}{//SNMP trap port number}
86    settings->\hyperlink{structSnmpAgentSettings_a8e3e0489658544f2f39c4d0cb59d14ae}{trapPort} = \hyperlink{snmp__common_8h_a0b2d70f3919ed0e4f831496c61d9836e}{SNMP\_TRAP\_PORT};
87 
88    \textcolor{comment}{//Random data generation callback function}
89    settings->\hyperlink{structSnmpAgentSettings_a48ad68f4f7fd56d9f64acab57420398d}{randCallback} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
90 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a99bbd657869a8800ac3c578f773cfa97}\label{snmp__agent_8c_a99bbd657869a8800ac3c578f773cfa97}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Get\+Engine\+Boots@{snmp\+Agent\+Get\+Engine\+Boots}}
\index{snmp\+Agent\+Get\+Engine\+Boots@{snmp\+Agent\+Get\+Engine\+Boots}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Get\+Engine\+Boots()}{snmpAgentGetEngineBoots()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Get\+Engine\+Boots (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} $\ast$}]{engine\+Boots }\end{DoxyParamCaption})}



Get the value of the snmp\+Engine\+Boots variable. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt out}  & {\em engine\+Boots} & Number of times the S\+N\+MP engine has re-\/booted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 461 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
462 \{
463 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
464    \textcolor{comment}{//Check parameters}
465    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || engineBoots == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
466       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
467 
468    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
469    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
470    \textcolor{comment}{//Get the current value of the snmpEngineBoots}
471    *engineBoots = context->engineBoots;
472    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
473    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
474 
475    \textcolor{comment}{//Successful processing}
476    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
477 \textcolor{preprocessor}{#else}
478    \textcolor{comment}{//Not implemented}
479    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
480 \textcolor{preprocessor}{#endif}
481 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a77e760c33f755f2f283364cc3cb191d7}\label{snmp__agent_8c_a77e760c33f755f2f283364cc3cb191d7}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Init@{snmp\+Agent\+Init}}
\index{snmp\+Agent\+Init@{snmp\+Agent\+Init}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Init()}{snmpAgentInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSnmpAgentSettings}{Snmp\+Agent\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



S\+N\+MP agent initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em settings} & S\+N\+MP agent specific settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 100 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
101 \{
102    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
103 
104    \textcolor{comment}{//Debug message}
105    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Initializing SNMP agent...\(\backslash\)r\(\backslash\)n"});
106 
107    \textcolor{comment}{//Ensure the parameters are valid}
108    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || settings == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
109       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
110 
111    \textcolor{comment}{//Check minimum and maximum SNMP versions}
112    \textcolor{keywordflow}{if}(settings->\hyperlink{structSnmpAgentSettings_aeeffa3bd908a4c92e8380c388c8663c4}{versionMin} > settings->\hyperlink{structSnmpAgentSettings_a709a4c333b2d522b20c37466b50e3e9a}{versionMax})
113       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
114 
115    \textcolor{comment}{//Clear the SNMP agent context}
116    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{SnmpAgentContext}));
117 
118    \textcolor{comment}{//Save user settings}
119    context->settings = *settings;
120 
121    \textcolor{comment}{//Initialize request identifier}
122    context->requestId = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(1, \hyperlink{stdint_8h_a181807730d4a375f848ba139813ce04f}{INT32\_MAX});
123 
124 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
125    \textcolor{comment}{//Get current time}
126    context->systemTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
127 
128    \textcolor{comment}{//Each SNMP engine maintains two values, snmpEngineBoots and snmpEngineTime,}
129    \textcolor{comment}{//which taken together provide an indication of time at that SNMP engine}
130    context->engineBoots = 1;
131    context->engineTime = 0;
132 
133    \textcolor{comment}{//Initialize message identifier}
134    context->msgId = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(1, \hyperlink{stdint_8h_a181807730d4a375f848ba139813ce04f}{INT32\_MAX});
135 
136    \textcolor{comment}{//Check whether SNMPv3 is supported}
137    \textcolor{keywordflow}{if}(settings->\hyperlink{structSnmpAgentSettings_aeeffa3bd908a4c92e8380c388c8663c4}{versionMin} <= \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa92886bc76b0167bf8604e3a266c6be9c}{SNMP\_VERSION\_3} &&
138       settings->\hyperlink{structSnmpAgentSettings_a709a4c333b2d522b20c37466b50e3e9a}{versionMax} >= \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa92886bc76b0167bf8604e3a266c6be9c}{SNMP\_VERSION\_3})
139    \{
140       \textcolor{comment}{//Make sure a random number generator has been registered}
141       \textcolor{keywordflow}{if}(settings->\hyperlink{structSnmpAgentSettings_a48ad68f4f7fd56d9f64acab57420398d}{randCallback} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
142          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
143 
144       \textcolor{comment}{//The salt integer is initialized to an arbitrary value at boot time}
145       error = settings->\hyperlink{structSnmpAgentSettings_a48ad68f4f7fd56d9f64acab57420398d}{randCallback}((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) &context->salt, \textcolor{keyword}{sizeof}(context->salt));
146       \textcolor{comment}{//Any error to report?}
147       \textcolor{keywordflow}{if}(error)
148          \textcolor{keywordflow}{return} error;
149    \}
150 \textcolor{preprocessor}{#endif}
151 
152    \textcolor{comment}{//Create a mutex to prevent simultaneous access to SNMP agent context}
153    \textcolor{keywordflow}{if}(!\hyperlink{os__port__chibios_8c_a16627f901c807c29adf29a38fb1af16a}{osCreateMutex}(&context->mutex))
154    \{
155       \textcolor{comment}{//Failed to create mutex}
156       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
157    \}
158 
159 \textcolor{preprocessor}{#if (SNMP\_AGENT\_INFORM\_SUPPORT == ENABLED)}
160    \textcolor{comment}{//Create an event object to manage inform request retransmissions}
161    \textcolor{keywordflow}{if}(!\hyperlink{os__port__chibios_8c_ac1658f3fed1eb64efcd47e4503a9ef2e}{osCreateEvent}(&context->informEvent))
162    \{
163       \textcolor{comment}{//Clean up side effects}
164       \hyperlink{os__port__chibios_8c_a2b0ba1e39227e4a4d52ee46bbee15c11}{osDeleteMutex}(&context->mutex);
165       \textcolor{comment}{//Failed to event object}
166       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
167    \}
168 \textcolor{preprocessor}{#endif}
169 
170    \textcolor{comment}{//Open a UDP socket}
171    context->socket = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a26963b01dac3a99a930779035d3796a7}{SOCKET\_TYPE\_DGRAM}, 
      \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969a53c45ffdb9dee4a8f885b816386a99b8}{SOCKET\_IP\_PROTO\_UDP});
172 
173    \textcolor{comment}{//Failed to open socket?}
174    \textcolor{keywordflow}{if}(context->socket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
175    \{
176       \textcolor{comment}{//Clean up side effects}
177       \hyperlink{os__port__chibios_8c_a2b0ba1e39227e4a4d52ee46bbee15c11}{osDeleteMutex}(&context->mutex);
178 \textcolor{preprocessor}{#if (SNMP\_AGENT\_INFORM\_SUPPORT == ENABLED)}
179       \hyperlink{os__port__chibios_8c_a2b0ba1e39227e4a4d52ee46bbee15c11}{osDeleteMutex}(&context->informEvent);
180 \textcolor{preprocessor}{#endif}
181       \textcolor{comment}{//Report an error}
182       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
183    \}
184 
185    \textcolor{comment}{//Start of exception handling block}
186    \textcolor{keywordflow}{do}
187    \{
188       \textcolor{comment}{//Explicitly associate the socket with the relevant interface}
189       error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(context->socket, settings->
      \hyperlink{structSnmpAgentSettings_ab6c457ae9ee27a3160d9e3d5cb847439}{interface});
190       \textcolor{comment}{//Unable to bind the socket to the desired interface?}
191       \textcolor{keywordflow}{if}(error)
192          \textcolor{keywordflow}{break};
193 
194       \textcolor{comment}{//The SNMP agent listens for messages on port 161}
195       error = \hyperlink{socket_8c_a56de93ca9f66782811dbe151d6da0b9c}{socketBind}(context->socket, &\hyperlink{ip_8c_a132481a9d89ddf554ea8bbbe342e5d5a}{IP\_ADDR\_ANY}, settings->
      \hyperlink{structSnmpAgentSettings_a65d509855573423c26fbdf01cfc5a713}{port});
196       \textcolor{comment}{//Unable to bind the socket to the desired port?}
197       \textcolor{keywordflow}{if}(error)
198          \textcolor{keywordflow}{break};
199 
200       \textcolor{comment}{//End of exception handling block}
201    \} \textcolor{keywordflow}{while}(0);
202 
203    \textcolor{comment}{//Any error to report?}
204    \textcolor{keywordflow}{if}(error)
205    \{
206       \textcolor{comment}{//Clean up side effects}
207       \hyperlink{os__port__chibios_8c_a2b0ba1e39227e4a4d52ee46bbee15c11}{osDeleteMutex}(&context->mutex);
208 \textcolor{preprocessor}{#if (SNMP\_AGENT\_INFORM\_SUPPORT == ENABLED)}
209       \hyperlink{os__port__chibios_8c_a2b0ba1e39227e4a4d52ee46bbee15c11}{osDeleteMutex}(&context->informEvent);
210 \textcolor{preprocessor}{#endif}
211       \textcolor{comment}{//Close underlying socket}
212       \hyperlink{socket_8c_ac5012e9f71c97e2ea0410f2c5baccb0e}{socketClose}(context->socket);
213    \}
214 
215    \textcolor{comment}{//Return status code}
216    \textcolor{keywordflow}{return} error;
217 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a9f67fd4ba3ebc7579fc417cf6acfe38e}\label{snmp__agent_8c_a9f67fd4ba3ebc7579fc417cf6acfe38e}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Join\+Group@{snmp\+Agent\+Join\+Group}}
\index{snmp\+Agent\+Join\+Group@{snmp\+Agent\+Join\+Group}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Join\+Group()}{snmpAgentJoinGroup()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Join\+Group (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name,  }\item[{\hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model}}]{security\+Model,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{group\+Name }\end{DoxyParamCaption})}



Join a group of users. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em user\+Name} & N\+U\+L\+L-\/terminated string that contains the user name \\
\hline
\mbox{\tt in}  & {\em security\+Model} & Security model \\
\hline
\mbox{\tt in}  & {\em group\+Name} & N\+U\+L\+L-\/terminated string that contains the group name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 987 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
989 \{
990 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
991    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
992    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
993    \hyperlink{structSnmpGroupEntry}{SnmpGroupEntry} *entry;
994 
995    \textcolor{comment}{//Check parameters}
996    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || groupName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
997       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
998 
999    \textcolor{comment}{//Check security model}
1000    \textcolor{keywordflow}{if}(securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695ae3de1e0065ac71136736dfc32a7d6704}{SNMP\_SECURITY\_MODEL\_V1} &&
1001       securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695ae2bc999bcb1df0c455037f8184589959}{SNMP\_SECURITY\_MODEL\_V2C} &&
1002       securityModel != \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695a21c6309103699e29211c87fd78c79521}{SNMP\_SECURITY\_MODEL\_USM})
1003    \{
1004       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1005    \}
1006 
1007    \textcolor{comment}{//Retrieve the length of the user name}
1008    n = strlen(userName);
1009 
1010    \textcolor{comment}{//Make sure the user name is valid}
1011    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_ae889f56d8038ef202bca4b1d974bd53f}{SNMP\_MAX\_USER\_NAME\_LEN})
1012       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1013 
1014    \textcolor{comment}{//Retrieve the length of the group name}
1015    n = strlen(groupName);
1016 
1017    \textcolor{comment}{//Make sure the group name is valid}
1018    \textcolor{keywordflow}{if}(n == 0 || n > \hyperlink{snmp__common_8h_a0810d82091ca56abdd23f86a04944c32}{SNMP\_MAX\_GROUP\_NAME\_LEN})
1019       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1020 
1021    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1022    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1023 
1024    \textcolor{comment}{//Search the group table for a matching entry}
1025    entry = \hyperlink{snmp__agent__vacm_8c_ae62d86e2a0e05b31d66602f6b884e842}{snmpFindGroupEntry}(context, securityModel, userName,
1026       strlen(userName));
1027 
1028    \textcolor{comment}{//No matching entry found?}
1029    \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1030    \{
1031       \textcolor{comment}{//Create a new entry in the group table}
1032       entry = \hyperlink{snmp__agent__vacm_8c_a2f852a60dcafbf0b311726bc8e0a255c}{snmpCreateGroupEntry}(context);
1033    \}
1034 
1035    \textcolor{comment}{//Any entry available?}
1036    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1037    \{
1038       \textcolor{comment}{//Clear entry}
1039       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpGroupEntry}{SnmpGroupEntry}));
1040 
1041       \textcolor{comment}{//Save security model}
1042       entry->\hyperlink{structSnmpGroupEntry_a49d7c30c44a6ee54b7febef1e0fe2e2f}{securityModel} = securityModel;
1043       \textcolor{comment}{//Save user name}
1044       strcpy(entry->\hyperlink{structSnmpGroupEntry_a5e747f5e2226fd1e218689b5bac75344}{securityName}, userName);
1045       \textcolor{comment}{//Save group name}
1046       strcpy(entry->\hyperlink{structSnmpGroupEntry_af3ec2a0fe036650f877493147eed85b6}{groupName}, groupName);
1047 
1048       \textcolor{comment}{//The entry is now available for use}
1049       entry->\hyperlink{structSnmpGroupEntry_a4ef2232ee93ed76fc09656ca669db373}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a438de565ef13d128f16f420284316088}{MIB\_ROW\_STATUS\_ACTIVE};
1050 
1051       \textcolor{comment}{//Successful processing}
1052       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1053    \}
1054    \textcolor{keywordflow}{else}
1055    \{
1056       \textcolor{comment}{//The group table runs out of space}
1057       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
1058    \}
1059 
1060    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1061    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1062 
1063    \textcolor{comment}{//Return status code}
1064    \textcolor{keywordflow}{return} error;
1065 \textcolor{preprocessor}{#else}
1066    \textcolor{comment}{//Not implemented}
1067    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1068 \textcolor{preprocessor}{#endif}
1069 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a77e6444a18b1df033832e9db11e8aa13}\label{snmp__agent_8c_a77e6444a18b1df033832e9db11e8aa13}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Leave\+Group@{snmp\+Agent\+Leave\+Group}}
\index{snmp\+Agent\+Leave\+Group@{snmp\+Agent\+Leave\+Group}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Leave\+Group()}{snmpAgentLeaveGroup()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Leave\+Group (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name,  }\item[{\hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695}{Snmp\+Security\+Model}}]{security\+Model }\end{DoxyParamCaption})}



Leave a group of users. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em user\+Name} & N\+U\+L\+L-\/terminated string that contains the user name \\
\hline
\mbox{\tt in}  & {\em security\+Model} & Security model \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1080 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1082 \{
1083 \textcolor{preprocessor}{#if (SNMP\_AGENT\_VACM\_SUPPORT == ENABLED)}
1084    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1085    \hyperlink{structSnmpGroupEntry}{SnmpGroupEntry} *entry;
1086 
1087    \textcolor{comment}{//Check parameters}
1088    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1089       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1090 
1091    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1092    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1093 
1094    \textcolor{comment}{//Search the group table for a matching entry}
1095    entry = \hyperlink{snmp__agent__vacm_8c_ae62d86e2a0e05b31d66602f6b884e842}{snmpFindGroupEntry}(context, securityModel, userName,
1096       strlen(userName));
1097 
1098    \textcolor{comment}{//Any matching entry found?}
1099    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1100    \{
1101       \textcolor{comment}{//Clear the entry}
1102       memset(entry, 0, \textcolor{keyword}{sizeof}(\hyperlink{structSnmpGroupEntry}{SnmpGroupEntry}));
1103       \textcolor{comment}{//Now mark the entry as free}
1104       entry->\hyperlink{structSnmpGroupEntry_a4ef2232ee93ed76fc09656ca669db373}{status} = \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED};
1105 
1106       \textcolor{comment}{//Successful processing}
1107       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1108    \}
1109    \textcolor{keywordflow}{else}
1110    \{
1111       \textcolor{comment}{//The specified entry does not exist}
1112       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
1113    \}
1114 
1115    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1116    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1117 
1118    \textcolor{comment}{//Return status code}
1119    \textcolor{keywordflow}{return} error;
1120 \textcolor{preprocessor}{#else}
1121    \textcolor{comment}{//Not implemented}
1122    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1123 \textcolor{preprocessor}{#endif}
1124 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a0bd4f93f8fb393cc0cc0dcf7b386a623}\label{snmp__agent_8c_a0bd4f93f8fb393cc0cc0dcf7b386a623}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Load\+Mib@{snmp\+Agent\+Load\+Mib}}
\index{snmp\+Agent\+Load\+Mib@{snmp\+Agent\+Load\+Mib}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Load\+Mib()}{snmpAgentLoadMib()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Load\+Mib (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structMibModule}{Mib\+Module} $\ast$}]{module }\end{DoxyParamCaption})}



Load a M\+IB module. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em module} & Pointer the M\+IB module to be loaded \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 257 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
258 \{
259    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
260    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
261 
262    \textcolor{comment}{//Check parameters}
263    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || module == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
264       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
265    \textcolor{keywordflow}{if}(module->\hyperlink{structMibModule_ab9594c4a682ecd9c16c0986307dce4b3}{numObjects} < 1)
266       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
267 
268    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
269    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
270 
271    \textcolor{comment}{//Loop through existing MIBs}
272    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
273    \{
274       \textcolor{comment}{//Check whether the specified MIB module is already loaded}
275       \textcolor{keywordflow}{if}(context->mibTable[i] == module)
276          \textcolor{keywordflow}{break};
277    \}
278 
279    \textcolor{comment}{//MIB module found?}
280    \textcolor{keywordflow}{if}(i < SNMP\_AGENT\_MAX\_MIBS)
281    \{
282       \textcolor{comment}{//Prevent the SNMP agent from loading the same MIB multiple times}
283       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
284    \}
285    \textcolor{keywordflow}{else}
286    \{
287       \textcolor{comment}{//Loop through existing MIBs}
288       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
289       \{
290          \textcolor{comment}{//Check if the current entry is available}
291          \textcolor{keywordflow}{if}(context->mibTable[i] == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
292             \textcolor{keywordflow}{break};
293       \}
294 
295       \textcolor{comment}{//Make sure there is enough room to add the specified MIB}
296       \textcolor{keywordflow}{if}(i < SNMP\_AGENT\_MAX\_MIBS)
297       \{
298          \textcolor{comment}{//Invoke user callback, if any}
299          \textcolor{keywordflow}{if}(module->\hyperlink{structMibModule_a01077b888aea380f8d383a992aea0efa}{load} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
300             error = module->\hyperlink{structMibModule_a01077b888aea380f8d383a992aea0efa}{load}(context);
301          \textcolor{keywordflow}{else}
302             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
303 
304          \textcolor{comment}{//Check status code}
305          \textcolor{keywordflow}{if}(!error)
306          \{
307             \textcolor{comment}{//Add the MIB to the list}
308             context->mibTable[i] = module;
309          \}
310       \}
311       \textcolor{keywordflow}{else}
312       \{
313          \textcolor{comment}{//Failed to load the specified MIB}
314          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
315       \}
316    \}
317 
318    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
319    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
320 
321    \textcolor{comment}{//Return status code}
322    \textcolor{keywordflow}{return} error;
323 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a0ff8b0b24ab11372d6ca3f101bbdd1f6}\label{snmp__agent_8c_a0ff8b0b24ab11372d6ca3f101bbdd1f6}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Send\+Inform@{snmp\+Agent\+Send\+Inform}}
\index{snmp\+Agent\+Send\+Inform@{snmp\+Agent\+Send\+Inform}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Send\+Inform()}{snmpAgentSendInform()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Send\+Inform (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{dest\+Ip\+Addr,  }\item[{\hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version}}]{version,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{generic\+Trap\+Type,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{specific\+Trap\+Code,  }\item[{const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$}]{object\+List,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{object\+List\+Size }\end{DoxyParamCaption})}



Send S\+N\+MP inform request. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em dest\+Ip\+Addr} & Destination IP address \\
\hline
\mbox{\tt in}  & {\em version} & S\+N\+MP version identifier \\
\hline
\mbox{\tt in}  & {\em user\+Name} & User name or community name \\
\hline
\mbox{\tt in}  & {\em generic\+Trap\+Type} & Generic trap type \\
\hline
\mbox{\tt in}  & {\em specific\+Trap\+Code} & Specific code \\
\hline
\mbox{\tt in}  & {\em object\+List} & List of object names \\
\hline
\mbox{\tt in}  & {\em object\+List\+Size} & Number of entries in the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1572 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1575 \{
1576 \textcolor{preprocessor}{#if (SNMP\_AGENT\_INFORM\_SUPPORT == ENABLED)}
1577    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1578    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} status;
1579 
1580    \textcolor{comment}{//Check parameters}
1581    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || destIpAddr == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1582       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1583 
1584    \textcolor{comment}{//Make sure the list of objects is valid}
1585    \textcolor{keywordflow}{if}(objectListSize > 0 && objectList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1586       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1587 
1588    \textcolor{comment}{//Initialize status code}
1589    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1590 
1591    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1592    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1593 
1594    \textcolor{comment}{//Send an inform request and wait for the acknowledgment to be received}
1595    \textcolor{keywordflow}{while}(!error)
1596    \{
1597       \textcolor{comment}{//Check current state}
1598       \textcolor{keywordflow}{if}(context->informState == \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE})
1599       \{
1600          \textcolor{comment}{//Reset event object}
1601          \hyperlink{os__port__chibios_8c_a9122a1cf258caef553a6b224ef8ef6bf}{osResetEvent}(&context->informEvent);
1602          \textcolor{comment}{//Initialize retransmission counter}
1603          context->informRetransmitCount = 0;
1604 
1605 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
1606          \textcolor{comment}{//SNMPv3 version?}
1607          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa92886bc76b0167bf8604e3a266c6be9c}{SNMP\_VERSION\_3})
1608          \{
1609             \textcolor{comment}{//The User-based Security Model (USM) of SNMPv3 provides a mechanism}
1610             \textcolor{comment}{//to discover the snmpEngineID of the remote SNMP engine}
1611             context->informContextEngineLen = 0;
1612             context->informEngineBoots = 0;
1613             context->informEngineTime = 0;
1614 
1615             \textcolor{comment}{//Perform discovery process}
1616             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda316ef28518ac056d706fcb103108ecf9}{SNMP\_AGENT\_STATE\_SENDING\_GET\_REQ};
1617          \}
1618          \textcolor{keywordflow}{else}
1619 \textcolor{preprocessor}{#endif}
1620          \textcolor{comment}{//SNMPv2c version?}
1621          \{
1622             \textcolor{comment}{//Send an inform request message}
1623             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda3c09c83e8cdfc4c8d711dfad0e674266}{SNMP\_AGENT\_STATE\_SENDING\_INFORM\_REQ};
1624          \}
1625       \}
1626 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
1627       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->informState == \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda316ef28518ac056d706fcb103108ecf9}{SNMP\_AGENT\_STATE\_SENDING\_GET\_REQ})
1628       \{
1629          \textcolor{comment}{//Format GetRequest message}
1630          error = \hyperlink{snmp__agent__inform_8c_abdec1fb63c64b654b6b65ff2aafc43f4}{snmpFormatGetRequestMessage}(context, 
      \hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version});
1631 
1632          \textcolor{comment}{//Check status}
1633          \textcolor{keywordflow}{if}(!error)
1634          \{
1635             \textcolor{comment}{//Total number of messages which were passed from the SNMP protocol}
1636             \textcolor{comment}{//entity to the transport service}
1637             \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutPkts, 1);
1638 
1639             \textcolor{comment}{//Debug message}
1640             \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending SNMP message to %s port %"} PRIu16
1641                \textcolor{stringliteral}{" (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1642                \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(destIpAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
1643                context->settings.trapPort, context->response.length);
1644 
1645             \textcolor{comment}{//Display the contents of the SNMP message}
1646             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->response.pos, context->response.length);
1647             \textcolor{comment}{//Display ASN.1 structure}
1648             \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(context->response.pos, context->response.length, 0);
1649 
1650             \textcolor{comment}{//Send SNMP message}
1651             error = \hyperlink{socket_8c_a5985321fef9f287f84c4004aaa78920e}{socketSendTo}(context->socket, destIpAddr, context->settings.trapPort,
1652                context->response.pos, context->response.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1653          \}
1654 
1655          \textcolor{comment}{//Check status code}
1656          \textcolor{keywordflow}{if}(!error)
1657          \{
1658             \textcolor{comment}{//Save the time at which the GetResponse-PDU was sent}
1659             context->informTimestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1660             \textcolor{comment}{//Increment retransmission counter}
1661             context->informRetransmitCount++;
1662             \textcolor{comment}{//Wait for an Report-PDU to be received}
1663             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda85f3ab38761a7e5aa1668cfc6dd7b0a9}{SNMP\_AGENT\_STATE\_WAITING\_REPORT};
1664          \}
1665          \textcolor{keywordflow}{else}
1666          \{
1667             \textcolor{comment}{//Back to default state}
1668             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1669          \}
1670       \}
1671       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->informState == \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda85f3ab38761a7e5aa1668cfc6dd7b0a9}{SNMP\_AGENT\_STATE\_WAITING\_REPORT})
1672       \{
1673          \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1674          \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1675 
1676          \textcolor{comment}{//Wait for a matching Report-PDU to be received}
1677          status = \hyperlink{os__port__chibios_8c_a1dc707247e44dfefae5bec4a322fc78a}{osWaitForEvent}(&context->informEvent,
1678             \hyperlink{snmp__agent__inform_8h_abfb11527d8db1a79e5c8194f301de12f}{SNMP\_AGENT\_INFORM\_TIMEOUT});
1679 
1680          \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1681          \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1682 
1683          \textcolor{comment}{//Any Report-PDU received?}
1684          \textcolor{keywordflow}{if}(status && context->informContextEngineLen > 0)
1685          \{
1686             \textcolor{comment}{//Reset event object}
1687             \hyperlink{os__port__chibios_8c_a9122a1cf258caef553a6b224ef8ef6bf}{osResetEvent}(&context->informEvent);
1688             \textcolor{comment}{//Initialize retransmission counter}
1689             context->informRetransmitCount = 0;
1690             \textcolor{comment}{//Send an inform request message}
1691             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda3c09c83e8cdfc4c8d711dfad0e674266}{SNMP\_AGENT\_STATE\_SENDING\_INFORM\_REQ};
1692          \}
1693          \textcolor{keywordflow}{else}
1694          \{
1695 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == DISABLED)}
1696             \textcolor{comment}{//Get current time}
1697             \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1698 
1699             \textcolor{comment}{//Check current time}
1700             \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->informTimestamp + 
      \hyperlink{snmp__agent__inform_8h_abfb11527d8db1a79e5c8194f301de12f}{SNMP\_AGENT\_INFORM\_TIMEOUT}) < 0)
1701             \{
1702                \textcolor{comment}{//Exit immediately}
1703                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK};
1704             \}
1705             \textcolor{keywordflow}{else}
1706 \textcolor{preprocessor}{#endif}
1707             \{
1708                \textcolor{comment}{//The request should be retransmitted if no corresponding response}
1709                \textcolor{comment}{//is received in an appropriate time interval}
1710                \textcolor{keywordflow}{if}(context->informRetransmitCount < \hyperlink{snmp__agent__inform_8h_ae71036f892d807783cdae6a2e96b54d1}{SNMP\_AGENT\_INFORM\_MAX\_RETRIES}
      )
1711                \{
1712                   \textcolor{comment}{//Retransmit the request}
1713                   context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda316ef28518ac056d706fcb103108ecf9}{SNMP\_AGENT\_STATE\_SENDING\_GET\_REQ};
1714                \}
1715                \textcolor{keywordflow}{else}
1716                \{
1717                   \textcolor{comment}{//Back to default state}
1718                   context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1719                   \textcolor{comment}{//Report a timeout error}
1720                   error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
1721                \}
1722             \}
1723          \}
1724       \}
1725 \textcolor{preprocessor}{#endif}
1726       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->informState == \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda3c09c83e8cdfc4c8d711dfad0e674266}{SNMP\_AGENT\_STATE\_SENDING\_INFORM\_REQ}
      )
1727       \{
1728          \textcolor{comment}{//Format InformRequest message}
1729          error = \hyperlink{snmp__agent__inform_8c_aec9b2ad134f1fbb61e5f44605a80e470}{snmpFormatInformRequestMessage}(context, 
      \hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version}, userName,
1730             genericTrapType, specificTrapCode, objectList, objectListSize);
1731 
1732          \textcolor{comment}{//Check status code}
1733          \textcolor{keywordflow}{if}(!error)
1734          \{
1735             \textcolor{comment}{//Total number of messages which were passed from the SNMP protocol}
1736             \textcolor{comment}{//entity to the transport service}
1737             \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutPkts, 1);
1738 
1739             \textcolor{comment}{//Debug message}
1740             \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending SNMP message to %s port %"} PRIu16
1741                \textcolor{stringliteral}{" (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1742                \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(destIpAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
1743                context->settings.trapPort, context->response.length);
1744 
1745             \textcolor{comment}{//Display the contents of the SNMP message}
1746             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->response.pos, context->response.length);
1747             \textcolor{comment}{//Display ASN.1 structure}
1748             \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(context->response.pos, context->response.length, 0);
1749 
1750             \textcolor{comment}{//Send SNMP message}
1751             error = \hyperlink{socket_8c_a5985321fef9f287f84c4004aaa78920e}{socketSendTo}(context->socket, destIpAddr, context->settings.trapPort,
1752                context->response.pos, context->response.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1753          \}
1754 
1755          \textcolor{comment}{//Check status code}
1756          \textcolor{keywordflow}{if}(!error)
1757          \{
1758             \textcolor{comment}{//Save the time at which the InformRequest-PDU was sent}
1759             context->informTimestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1760             \textcolor{comment}{//Increment retransmission counter}
1761             context->informRetransmitCount++;
1762             \textcolor{comment}{//Wait for a GetResponse-PDU to be received}
1763             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda0bd343209b6867934c3cf3ad30b87cb2}{SNMP\_AGENT\_STATE\_WAITING\_GET\_RESP};
1764          \}
1765          \textcolor{keywordflow}{else}
1766          \{
1767             \textcolor{comment}{//Back to default state}
1768             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1769          \}
1770       \}
1771       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->informState == \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda0bd343209b6867934c3cf3ad30b87cb2}{SNMP\_AGENT\_STATE\_WAITING\_GET\_RESP})
1772       \{
1773          \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1774          \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1775 
1776          \textcolor{comment}{//Wait for a matching GetResponse-PDU to be received}
1777          status = \hyperlink{os__port__chibios_8c_a1dc707247e44dfefae5bec4a322fc78a}{osWaitForEvent}(&context->informEvent,
1778             \hyperlink{snmp__agent__inform_8h_abfb11527d8db1a79e5c8194f301de12f}{SNMP\_AGENT\_INFORM\_TIMEOUT});
1779 
1780          \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1781          \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1782 
1783          \textcolor{comment}{//Any GetResponse-PDU received?}
1784          \textcolor{keywordflow}{if}(status)
1785          \{
1786             \textcolor{comment}{//Back to default state}
1787             context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1788             \textcolor{comment}{//The inform request has been acknowledged}
1789             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1790             \textcolor{comment}{//We are done}
1791             \textcolor{keywordflow}{break};
1792          \}
1793          \textcolor{keywordflow}{else}
1794          \{
1795 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == DISABLED)}
1796             \textcolor{comment}{//Get current time}
1797             \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1798 
1799             \textcolor{comment}{//Check current time}
1800             \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->informTimestamp + 
      \hyperlink{snmp__agent__inform_8h_abfb11527d8db1a79e5c8194f301de12f}{SNMP\_AGENT\_INFORM\_TIMEOUT}) < 0)
1801             \{
1802                \textcolor{comment}{//Exit immediately}
1803                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK};
1804             \}
1805             \textcolor{keywordflow}{else}
1806 \textcolor{preprocessor}{#endif}
1807             \{
1808                \textcolor{comment}{//The request should be retransmitted if no corresponding response}
1809                \textcolor{comment}{//is received in an appropriate time interval}
1810                \textcolor{keywordflow}{if}(context->informRetransmitCount < \hyperlink{snmp__agent__inform_8h_ae71036f892d807783cdae6a2e96b54d1}{SNMP\_AGENT\_INFORM\_MAX\_RETRIES}
      )
1811                \{
1812                   \textcolor{comment}{//Retransmit the request}
1813                   context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda3c09c83e8cdfc4c8d711dfad0e674266}{SNMP\_AGENT\_STATE\_SENDING\_INFORM\_REQ}
      ;
1814                \}
1815                \textcolor{keywordflow}{else}
1816                \{
1817                   \textcolor{comment}{//Back to default state}
1818                   context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1819                   \textcolor{comment}{//Report a timeout error}
1820                   error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
1821                \}
1822             \}
1823          \}
1824       \}
1825       \textcolor{keywordflow}{else}
1826       \{
1827          \textcolor{comment}{//Back to default state}
1828          context->informState = \hyperlink{snmp__agent__inform_8h_aa426c1a6fdbc65cdfa26a178d64371fda804f832a8a113d02b5232b9a2f78230c}{SNMP\_AGENT\_STATE\_IDLE};
1829          \textcolor{comment}{//Report an error}
1830          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac3190fa1f36c6acf147c7ce453a655e2}{ERROR\_WRONG\_STATE};
1831       \}
1832    \}
1833 
1834    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1835    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1836 
1837    \textcolor{comment}{//Return status code}
1838    \textcolor{keywordflow}{return} error;
1839 \textcolor{preprocessor}{#else}
1840    \textcolor{comment}{//Not implemented}
1841    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1842 \textcolor{preprocessor}{#endif}
1843 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a7ba98de35572b8375577feecbd654668}\label{snmp__agent_8c_a7ba98de35572b8375577feecbd654668}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Send\+Trap@{snmp\+Agent\+Send\+Trap}}
\index{snmp\+Agent\+Send\+Trap@{snmp\+Agent\+Send\+Trap}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Send\+Trap()}{snmpAgentSendTrap()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Send\+Trap (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{dest\+Ip\+Addr,  }\item[{\hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version}}]{version,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{user\+Name,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{generic\+Trap\+Type,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{specific\+Trap\+Code,  }\item[{const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$}]{object\+List,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{object\+List\+Size }\end{DoxyParamCaption})}



Send S\+N\+MP trap notification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em dest\+Ip\+Addr} & Destination IP address \\
\hline
\mbox{\tt in}  & {\em version} & S\+N\+MP version identifier \\
\hline
\mbox{\tt in}  & {\em user\+Name} & User name or community name \\
\hline
\mbox{\tt in}  & {\em generic\+Trap\+Type} & Generic trap type \\
\hline
\mbox{\tt in}  & {\em specific\+Trap\+Code} & Specific code \\
\hline
\mbox{\tt in}  & {\em object\+List} & List of object names \\
\hline
\mbox{\tt in}  & {\em object\+List\+Size} & Number of entries in the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1497 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1500 \{
1501 \textcolor{preprocessor}{#if (SNMP\_AGENT\_TRAP\_SUPPORT == ENABLED)}
1502    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1503 
1504    \textcolor{comment}{//Check parameters}
1505    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || destIpAddr == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || userName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1506       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1507 
1508    \textcolor{comment}{//Make sure the list of objects is valid}
1509    \textcolor{keywordflow}{if}(objectListSize > 0 && objectList == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1510       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1511 
1512    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1513    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1514 
1515 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
1516    \textcolor{comment}{//Refresh SNMP engine time}
1517    \hyperlink{snmp__agent__usm_8c_a68a80c798e29b1410db2a383af9e8876}{snmpRefreshEngineTime}(context);
1518 \textcolor{preprocessor}{#endif}
1519 
1520    \textcolor{comment}{//Format Trap message}
1521    error = \hyperlink{snmp__agent__trap_8c_a880353e617b91ca7770104332b2d5f3f}{snmpFormatTrapMessage}(context, \hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version}, userName,
1522       genericTrapType, specificTrapCode, objectList, objectListSize);
1523 
1524    \textcolor{comment}{//Check status code}
1525    \textcolor{keywordflow}{if}(!error)
1526    \{
1527       \textcolor{comment}{//Total number of messages which were passed from the SNMP protocol}
1528       \textcolor{comment}{//entity to the transport service}
1529       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutPkts, 1);
1530 
1531       \textcolor{comment}{//Debug message}
1532       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending SNMP message to %s port %"} PRIu16
1533          \textcolor{stringliteral}{" (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1534          \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(destIpAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
1535          context->settings.trapPort, context->response.length);
1536 
1537       \textcolor{comment}{//Display the contents of the SNMP message}
1538       \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->response.pos, context->response.length);
1539       \textcolor{comment}{//Display ASN.1 structure}
1540       \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(context->response.pos, context->response.length, 0);
1541 
1542       \textcolor{comment}{//Send SNMP message}
1543       error = \hyperlink{socket_8c_a5985321fef9f287f84c4004aaa78920e}{socketSendTo}(context->socket, destIpAddr, context->settings.trapPort,
1544          context->response.pos, context->response.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1545    \}
1546 
1547    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1548    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1549 
1550    \textcolor{comment}{//Return status code}
1551    \textcolor{keywordflow}{return} error;
1552 \textcolor{preprocessor}{#else}
1553    \textcolor{comment}{//Not implemented}
1554    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
1555 \textcolor{preprocessor}{#endif}
1556 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a5961caaffaec19dc9b48596b1f479278}\label{snmp__agent_8c_a5961caaffaec19dc9b48596b1f479278}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Set\+Context\+Engine@{snmp\+Agent\+Set\+Context\+Engine}}
\index{snmp\+Agent\+Set\+Context\+Engine@{snmp\+Agent\+Set\+Context\+Engine}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Set\+Context\+Engine()}{snmpAgentSetContextEngine()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Set\+Context\+Engine (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{context\+Engine,  }\item[{size\+\_\+t}]{context\+Engine\+Len }\end{DoxyParamCaption})}



Set context engine identifier. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em context\+Engine} & Pointer to the context engine identifier \\
\hline
\mbox{\tt in}  & {\em context\+Engine\+Len} & Length of the context engine identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 525 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
527 \{
528 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
529    \textcolor{comment}{//Check parameters}
530    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || contextEngine == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
531       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
532    \textcolor{keywordflow}{if}(contextEngineLen > \hyperlink{snmp__common_8h_a182f7381f1e0c29ee196042008e380be}{SNMP\_MAX\_CONTEXT\_ENGINE\_SIZE})
533       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
534 
535    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
536    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
537 
538    \textcolor{comment}{//Set context engine identifier}
539    memcpy(context->contextEngine, contextEngine, contextEngineLen);
540    \textcolor{comment}{//Save the length of the context engine identifier}
541    context->contextEngineLen = contextEngineLen;
542 
543    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
544    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
545 
546    \textcolor{comment}{//Successful processing}
547    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
548 \textcolor{preprocessor}{#else}
549    \textcolor{comment}{//Not implemented}
550    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
551 \textcolor{preprocessor}{#endif}
552 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_abd0fb0a9802edef43d518c6e581e58b4}\label{snmp__agent_8c_abd0fb0a9802edef43d518c6e581e58b4}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Set\+Context\+Name@{snmp\+Agent\+Set\+Context\+Name}}
\index{snmp\+Agent\+Set\+Context\+Name@{snmp\+Agent\+Set\+Context\+Name}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Set\+Context\+Name()}{snmpAgentSetContextName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Set\+Context\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{context\+Name }\end{DoxyParamCaption})}



Set context name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em context\+Name} & N\+U\+L\+L-\/terminated string that contains the context name \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 562 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
564 \{
565 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
566    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
567 
568    \textcolor{comment}{//Check parameters}
569    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || contextName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
570       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
571 
572    \textcolor{comment}{//Retrieve the length of the context name}
573    n = strlen(contextName);
574 
575    \textcolor{comment}{//Make sure the context name is valid}
576    \textcolor{keywordflow}{if}(n > \hyperlink{snmp__common_8h_a59ce7ec8feba50f15272257094e14ac8}{SNMP\_MAX\_CONTEXT\_NAME\_LEN})
577       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
578 
579    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
580    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
581    \textcolor{comment}{//Set context name}
582    strcpy(context->contextName, contextName);
583    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
584    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
585 
586    \textcolor{comment}{//Successful processing}
587    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
588 \textcolor{preprocessor}{#else}
589    \textcolor{comment}{//Not implemented}
590    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
591 \textcolor{preprocessor}{#endif}
592 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a157634ca61b621e1e5e3a0d904699980}\label{snmp__agent_8c_a157634ca61b621e1e5e3a0d904699980}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Set\+Engine\+Boots@{snmp\+Agent\+Set\+Engine\+Boots}}
\index{snmp\+Agent\+Set\+Engine\+Boots@{snmp\+Agent\+Set\+Engine\+Boots}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Set\+Engine\+Boots()}{snmpAgentSetEngineBoots()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Set\+Engine\+Boots (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t}}]{engine\+Boots }\end{DoxyParamCaption})}



Set the value of the snmp\+Engine\+Boots variable. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em engine\+Boots} & Number of times the S\+N\+MP engine has re-\/booted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 422 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
423 \{
424 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
425    \textcolor{comment}{//Check parameters}
426    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
427       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
428    \textcolor{keywordflow}{if}(engineBoots < 0)
429       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca796107c17e41c601d633f670e5e29800}{ERROR\_OUT\_OF\_RANGE};
430 
431    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
432    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
433 
434    \textcolor{comment}{//Get current time}
435    context->systemTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
436 
437    \textcolor{comment}{//Set the value of the snmpEngineBoots}
438    context->engineBoots = engineBoots;
439    \textcolor{comment}{//The snmpEngineTime is reset to zero}
440    context->engineTime = 0;
441 
442    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
443    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
444 
445    \textcolor{comment}{//Successful processing}
446    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
447 \textcolor{preprocessor}{#else}
448    \textcolor{comment}{//Not implemented}
449    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
450 \textcolor{preprocessor}{#endif}
451 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a1e829f92b37686e43dabf8af18686d95}\label{snmp__agent_8c_a1e829f92b37686e43dabf8af18686d95}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Set\+Enterprise\+Oid@{snmp\+Agent\+Set\+Enterprise\+Oid}}
\index{snmp\+Agent\+Set\+Enterprise\+Oid@{snmp\+Agent\+Set\+Enterprise\+Oid}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Set\+Enterprise\+Oid()}{snmpAgentSetEnterpriseOid()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Set\+Enterprise\+Oid (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{enterprise\+Oid,  }\item[{size\+\_\+t}]{enterprise\+Oid\+Len }\end{DoxyParamCaption})}



Set enterprise O\+ID. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em enterprise\+Oid} & Pointer to the enterprise O\+ID \\
\hline
\mbox{\tt in}  & {\em enterprise\+Oid\+Len} & Length of the enterprise O\+ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 492 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
494 \{
495    \textcolor{comment}{//Check parameters}
496    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || enterpriseOid == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
497       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
498    \textcolor{keywordflow}{if}(enterpriseOidLen > \hyperlink{snmp__common_8h_a7eee56441ee1b961702e8b4cbe9586a7}{SNMP\_MAX\_OID\_SIZE})
499       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
500 
501    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
502    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
503 
504    \textcolor{comment}{//Set enterprise OID}
505    memcpy(context->enterpriseOid, enterpriseOid, enterpriseOidLen);
506    \textcolor{comment}{//Save the length of the enterprise OID}
507    context->enterpriseOidLen = enterpriseOidLen;
508 
509    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
510    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
511 
512    \textcolor{comment}{//Successful processing}
513    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
514 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a9c3fee15540a001a80bcf4542fd70fdc}\label{snmp__agent_8c_a9c3fee15540a001a80bcf4542fd70fdc}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Set\+Version@{snmp\+Agent\+Set\+Version}}
\index{snmp\+Agent\+Set\+Version@{snmp\+Agent\+Set\+Version}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Set\+Version()}{snmpAgentSetVersion()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Set\+Version (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{\hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version}}]{version\+Min,  }\item[{\hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95df}{Snmp\+Version}}]{version\+Max }\end{DoxyParamCaption})}



Set minimum and maximum versions permitted. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em version\+Min} & Minimum version accepted by the S\+N\+MP agent \\
\hline
\mbox{\tt in}  & {\em version\+Max} & Maximum version accepted by the S\+N\+MP agent \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 391 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
393 \{
394    \textcolor{comment}{//Check parameters}
395    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
396       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
397    \textcolor{keywordflow}{if}(versionMin > versionMax)
398       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
399 
400    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
401    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
402 
403    \textcolor{comment}{//Set minimum and maximum versions permitted}
404    context->settings.versionMin = versionMin;
405    context->settings.versionMax = versionMax;
406 
407    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
408    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
409 
410    \textcolor{comment}{//Successful processing}
411    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
412 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_aeda6cfdefb05459fcdc32e8877baca9e}\label{snmp__agent_8c_aeda6cfdefb05459fcdc32e8877baca9e}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Start@{snmp\+Agent\+Start}}
\index{snmp\+Agent\+Start@{snmp\+Agent\+Start}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Start()}{snmpAgentStart()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Start (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Start S\+N\+MP agent. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 226 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
227 \{
228    \hyperlink{structOsTask}{OsTask} *task;
229 
230    \textcolor{comment}{//Debug message}
231    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Starting SNMP agent...\(\backslash\)r\(\backslash\)n"});
232 
233    \textcolor{comment}{//Make sure the SNMP agent context is valid}
234    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
235       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
236 
237    \textcolor{comment}{//Start the SNMP agent service}
238    task = \hyperlink{os__port__chibios_8c_aef8c6fe13a0df9e5cfaeb0501ecbac3e}{osCreateTask}(\textcolor{stringliteral}{"SNMP Agent"}, (\hyperlink{os__port__chibios_8h_a52a4e1975bb554c2ce70aaac35b752d2}{OsTaskCode}) 
      \hyperlink{snmp__agent_8c_a88caf613d774e191c0ad829f36232cfd}{snmpAgentTask},
239       context, \hyperlink{snmp__agent_8h_a53c3c4a7736147e57e20faccbaf7e2ce}{SNMP\_AGENT\_STACK\_SIZE}, \hyperlink{snmp__agent_8h_a895f54805236e54554685ed459235264}{SNMP\_AGENT\_PRIORITY});
240 
241    \textcolor{comment}{//Unable to create the task?}
242    \textcolor{keywordflow}{if}(task == \hyperlink{os__port_8h_aa673e52d8b286c3b613ad127aa85d536}{OS\_INVALID\_HANDLE})
243       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
244 
245    \textcolor{comment}{//The SNMP agent has successfully started}
246    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
247 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_a88caf613d774e191c0ad829f36232cfd}\label{snmp__agent_8c_a88caf613d774e191c0ad829f36232cfd}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Task@{snmp\+Agent\+Task}}
\index{snmp\+Agent\+Task@{snmp\+Agent\+Task}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Task()}{snmpAgentTask()}}
{\footnotesize\ttfamily void snmp\+Agent\+Task (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



S\+N\+MP agent task. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}


Definition at line 1851 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
1852 \{
1853    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1854 
1855 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
1856    \textcolor{comment}{//Task prologue}
1857    \hyperlink{os__port__chibios_8h_abd3485ee30ab6a2de1208b0498a449cf}{osEnterTask}();
1858 
1859    \textcolor{comment}{//Main loop}
1860    \textcolor{keywordflow}{while}(1)
1861    \{
1862 \textcolor{preprocessor}{#endif}
1863       \textcolor{comment}{//Wait for an incoming datagram}
1864       error = \hyperlink{socket_8c_a26af4b642b71708e1408fc94483f90bb}{socketReceiveFrom}(context->socket, &context->remoteIpAddr,
1865          &context->remotePort, context->request.buffer,
1866          \hyperlink{snmp__common_8h_af5a22cbaa4973c106e664d5d01316fae}{SNMP\_MAX\_MSG\_SIZE}, &context->request.bufferLen, 0);
1867 
1868       \textcolor{comment}{//Any datagram received?}
1869       \textcolor{keywordflow}{if}(!error)
1870       \{
1871          \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
1872          \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
1873 
1874          \textcolor{comment}{//Debug message}
1875          \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nSNMP message received from %s port %"} PRIu16
1876             \textcolor{stringliteral}{" (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1877             \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(&context->remoteIpAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
1878             context->remotePort, context->request.bufferLen);
1879 
1880          \textcolor{comment}{//Display the contents of the SNMP message}
1881          \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->request.buffer, context->request.bufferLen);
1882          \textcolor{comment}{//Dump ASN.1 structure}
1883          \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(context->request.buffer, context->request.bufferLen, 0);
1884 
1885          \textcolor{comment}{//Process incoming SNMP message}
1886          error = \hyperlink{snmp__agent__dispatch_8c_ab88d8e3596e25e12417dc2418308791a}{snmpProcessMessage}(context);
1887 
1888          \textcolor{comment}{//Check status code}
1889          \textcolor{keywordflow}{if}(!error)
1890          \{
1891             \textcolor{comment}{//Any response?}
1892             \textcolor{keywordflow}{if}(context->response.length > 0)
1893             \{
1894                \textcolor{comment}{//Debug message}
1895                \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending SNMP message to %s port %"} PRIu16
1896                   \textcolor{stringliteral}{" (%"} PRIuSIZE \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1897                   \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(&context->remoteIpAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
1898                   context->remotePort, context->response.length);
1899 
1900                \textcolor{comment}{//Display the contents of the SNMP message}
1901                \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, context->response.pos, context->response.length);
1902                \textcolor{comment}{//Display ASN.1 structure}
1903                \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(context->response.pos, context->response.length, 0);
1904 
1905                \textcolor{comment}{//Send SNMP response message}
1906                \hyperlink{socket_8c_a5985321fef9f287f84c4004aaa78920e}{socketSendTo}(context->socket, &context->remoteIpAddr,
1907                   context->remotePort, context->response.pos,
1908                   context->response.length, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1909             \}
1910          \}
1911 
1912          \textcolor{comment}{//Release exclusive access to the SNMP agent context}
1913          \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
1914       \}
1915 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
1916    \}
1917 \textcolor{preprocessor}{#endif}
1918 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent_8c_ab1194de5d74699946cec6fd323da643c}\label{snmp__agent_8c_ab1194de5d74699946cec6fd323da643c}} 
\index{snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}!snmp\+Agent\+Unload\+Mib@{snmp\+Agent\+Unload\+Mib}}
\index{snmp\+Agent\+Unload\+Mib@{snmp\+Agent\+Unload\+Mib}!snmp\+\_\+agent.\+c@{snmp\+\_\+agent.\+c}}
\subsubsection{\texorpdfstring{snmp\+Agent\+Unload\+Mib()}{snmpAgentUnloadMib()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Agent\+Unload\+Mib (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structMibModule}{Mib\+Module} $\ast$}]{module }\end{DoxyParamCaption})}



Unload a M\+IB module. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em module} & Pointer the M\+IB module to be unloaded \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 333 of file snmp\+\_\+agent.\+c.


\begin{DoxyCode}
334 \{
335    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
336    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
337 
338    \textcolor{comment}{//Check parameters}
339    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || module == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
340       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
341 
342    \textcolor{comment}{//Acquire exclusive access to the SNMP agent context}
343    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
344 
345    \textcolor{comment}{//Loop through existing MIBs}
346    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
347    \{
348       \textcolor{comment}{//Check whether the specified MIB module is already loaded}
349       \textcolor{keywordflow}{if}(context->mibTable[i] == module)
350          \textcolor{keywordflow}{break};
351    \}
352 
353    \textcolor{comment}{//MIB module found?}
354    \textcolor{keywordflow}{if}(i < SNMP\_AGENT\_MAX\_MIBS)
355    \{
356       \textcolor{comment}{//Any registered callback?}
357       \textcolor{keywordflow}{if}(context->mibTable[i]->unload != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
358       \{
359          \textcolor{comment}{//Invoke user callback function}
360          context->mibTable[i]->unload(context);
361       \}
362 
363       \textcolor{comment}{//Remove the MIB from the list}
364       context->mibTable[i] = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
365 
366       \textcolor{comment}{//Successful processing}
367       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
368    \}
369    \textcolor{keywordflow}{else}
370    \{
371       \textcolor{comment}{//Failed to unload the specified MIB}
372       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
373    \}
374 
375    \textcolor{comment}{//Release exclusive access to the SNMP agent context}
376    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
377 
378    \textcolor{comment}{//Return status code}
379    \textcolor{keywordflow}{return} error;
380 \}
\end{DoxyCode}
