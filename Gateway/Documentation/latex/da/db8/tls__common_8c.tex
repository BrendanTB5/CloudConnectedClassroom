\hypertarget{tls__common_8c}{}\section{cyclone\+\_\+ssl/tls\+\_\+common.c File Reference}
\label{tls__common_8c}\index{cyclone\+\_\+ssl/tls\+\_\+common.\+c@{cyclone\+\_\+ssl/tls\+\_\+common.\+c}}


Handshake message processing (T\+LS client and server)  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+cipher\+\_\+suites.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+handshake.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+server.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+certificate.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+signature.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+transcript\+\_\+hash.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+cache.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dtls\+\_\+record.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tls__common_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_ae447dcb4133c50b4baf93b4808824474}{tls\+Send\+Certificate} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send Certificate message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_ad10693e5b3286d3df6fca1597c61201e}{tls\+Send\+Certificate\+Verify} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send Certificate\+Verify message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a4a916411e28b77ed86195f311ebebb4b}{tls\+Send\+Change\+Cipher\+Spec} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send Change\+Cipher\+Spec message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a6830d5e2c36cf6293e93369370d8e4c2}{tls\+Send\+Finished} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send Finished message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tls\+Send\+Alert} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{tls_8h_a8119fa4b03f4c903dfa45ab2b6d5534f}{description})
\begin{DoxyCompactList}\small\item\em Send Alert message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a4dc3d3d81329b32858ef30a612cc8062}{tls\+Format\+Certificate} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{Tls\+Certificate} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format Certificate message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_abb74b69c218815c9727fa2c5e199b912}{tls\+Format\+Certificate\+Verify} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{Tls\+Certificate\+Verify} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format Certificate\+Verify message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_aa7ee11d8f87308e4f216dd7ed291897f}{tls\+Format\+Change\+Cipher\+Spec} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{Tls\+Change\+Cipher\+Spec} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format Change\+Cipher\+Spec message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a1a3dfb06aefb89631e1f1b4cff0e57b6}{tls\+Format\+Finished} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{Tls\+Finished} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format Finished message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a7e24682ce12b8812ca66d9c2c5aa0b5c}{tls\+Format\+Alert} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{tls_8h_a8119fa4b03f4c903dfa45ab2b6d5534f}{description}, \hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{Tls\+Alert} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Format Alert message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a3e8da6ef31b6d88603dd0b9ff5c9899c}{tls\+Format\+Signature\+Algorithms\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} cipher\+Suite\+Types, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Signature\+Algorithms extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a2cb196a73d9b8d67091a344fe3551789}{tls\+Format\+Signature\+Algorithms\+Cert\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Signature\+Algorithms\+Cert extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a8ea298350bb1262e85bca00a448122f3}{tls\+Parse\+Certificate} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{Tls\+Certificate} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Certificate message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a28b47eb94395efb96c6b4d274a5aeb38}{tls\+Parse\+Certificate\+Verify} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{Tls\+Certificate\+Verify} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Certificate\+Verify message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_a5e337b2359ac1c81214620f4d4744f29}{tls\+Parse\+Change\+Cipher\+Spec} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{Tls\+Change\+Cipher\+Spec} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Change\+Cipher\+Spec message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_ad2a518c781f8297e7b21fdbeb569de31}{tls\+Parse\+Finished} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{Tls\+Finished} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Finished message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__common_8c_abd3d66a2f80b812ee5db99a78191b795}{tls\+Parse\+Alert} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{Tls\+Alert} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Alert message. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Handshake message processing (T\+LS client and server) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{tls__common_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{tls__common_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file tls\+\_\+common.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{tls__common_8c_a7e24682ce12b8812ca66d9c2c5aa0b5c}\label{tls__common_8c_a7e24682ce12b8812ca66d9c2c5aa0b5c}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Alert@{tls\+Format\+Alert}}
\index{tls\+Format\+Alert@{tls\+Format\+Alert}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Alert()}{tlsFormatAlert()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Alert (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{level,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{description,  }\item[{\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{Tls\+Alert} $\ast$}]{message,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Format Alert message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em level} & Severity of the message (warning or fatal) \\
\hline
\mbox{\tt in}  & {\em description} & Description of the alert \\
\hline
\mbox{\tt out}  & {\em message} & Buffer where to format the Alert message \\
\hline
\mbox{\tt out}  & {\em length} & Length of the resulting Alert message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 770 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
772 \{
773    \textcolor{comment}{//Severity of the message}
774    \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->level = \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level};
775    \textcolor{comment}{//Description of the alert}
776    \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->description = \hyperlink{tls_8h_a8119fa4b03f4c903dfa45ab2b6d5534f}{description};
777 
778    \textcolor{comment}{//Length of the Alert message}
779    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert});
780 
781    \textcolor{comment}{//Successful processing}
782    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
783 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a4dc3d3d81329b32858ef30a612cc8062}\label{tls__common_8c_a4dc3d3d81329b32858ef30a612cc8062}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Certificate@{tls\+Format\+Certificate}}
\index{tls\+Format\+Certificate@{tls\+Format\+Certificate}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Certificate()}{tlsFormatCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Certificate (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{Tls\+Certificate} $\ast$}]{message,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Format Certificate message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em message} & Buffer where to format the Certificate message \\
\hline
\mbox{\tt out}  & {\em length} & Length of the resulting Certificate message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 566 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
568 \{
569    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
570    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
571    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
572    \hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList} *certificateList;
573 
574    \textcolor{comment}{//Point to the beginning of the handshake message}
575    p = \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
576    \textcolor{comment}{//Length of the handshake message}
577    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = 0;
578 
579 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
580    \textcolor{comment}{//TLS 1.3 currently selected?}
581    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
582    \{
583       \hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext} *certRequestContext;
584 
585       \textcolor{comment}{//Point to the certificate request context}
586       certRequestContext = (\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext} *) p;
587 
588       \textcolor{comment}{//Check whether TLS operates as a client or a server}
589       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
590       \{
591          \textcolor{comment}{//The value of the certificate\_request\_context field from server's}
592          \textcolor{comment}{//CertificateRequest message is echoed in the Certificate message}
593          \textcolor{keywordflow}{if}(context->certRequestContextLen > 0)
594          \{
595             \textcolor{comment}{//Copy certificate request context}
596             memcpy(certRequestContext->value, context->certRequestContext,
597                context->certRequestContextLen);
598          \}
599 
600          \textcolor{comment}{//The context is preceded by a length field}
601          certRequestContext->length = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) context->certRequestContextLen;
602       \}
603       \textcolor{keywordflow}{else}
604       \{
605          \textcolor{comment}{//In the case of server authentication, this field shall be zero length}
606          certRequestContext->length = 0;
607       \}
608 
609       \textcolor{comment}{//Point to the next field}
610       p += \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}) + certRequestContext->length;
611       \textcolor{comment}{//Adjust the length of the Certificate message}
612       *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} += \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}) + certRequestContext->length;
613    \}
614 \textcolor{preprocessor}{#endif}
615 
616    \textcolor{comment}{//Point to the chain of certificates}
617    certificateList = (\hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList} *) p;
618 
619 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
620    \textcolor{comment}{//Check certificate type}
621    \textcolor{keywordflow}{if}(context->certFormat == \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0a598a87140d01a36216289f5dfb6c0f35}{TLS\_CERT\_FORMAT\_RAW\_PUBLIC\_KEY})
622    \{
623       \textcolor{comment}{//Format the raw public key}
624       error = \hyperlink{tls__certificate_8c_a5f855ef4facdcad83e2b3ef570bafc40}{tlsFormatRawPublicKey}(context, certificateList->value, &n);
625    \}
626    \textcolor{keywordflow}{else}
627 \textcolor{preprocessor}{#endif}
628    \{
629       \textcolor{comment}{//Format the certificate chain}
630       error = \hyperlink{tls__certificate_8c_aef1ffcaaa014634e0e8e21eeb09ecc05}{tlsFormatCertificateList}(context, certificateList->value, &n);
631    \}
632 
633    \textcolor{comment}{//Check status code}
634    \textcolor{keywordflow}{if}(!error)
635    \{
636       \textcolor{comment}{//A 3-byte length field shall precede the certificate list}
637       \hyperlink{cpu__endian_8h_acba352ed22d98efff17d0374c0790885}{STORE24BE}(n, certificateList->length);
638       \textcolor{comment}{//Adjust the length of the Certificate message}
639       *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList}) + n;
640    \}
641 
642    \textcolor{comment}{//Return status code}
643    \textcolor{keywordflow}{return} error;
644 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_abb74b69c218815c9727fa2c5e199b912}\label{tls__common_8c_abb74b69c218815c9727fa2c5e199b912}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Certificate\+Verify@{tls\+Format\+Certificate\+Verify}}
\index{tls\+Format\+Certificate\+Verify@{tls\+Format\+Certificate\+Verify}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Certificate\+Verify()}{tlsFormatCertificateVerify()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Certificate\+Verify (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{Tls\+Certificate\+Verify} $\ast$}]{message,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Format Certificate\+Verify message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em message} & Buffer where to format the Certificate\+Verify message \\
\hline
\mbox{\tt out}  & {\em length} & Length of the resulting Certificate\+Verify message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 655 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
657 \{
658    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
659 
660    \textcolor{comment}{//Length of the handshake message}
661    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = 0;
662 
663 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
664    \textcolor{comment}{//SSL 3.0, TLS 1.0 or TLS 1.1 currently selected?}
665    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
666    \{
667       \textcolor{comment}{//In TLS version prior to 1.2, the digitally-signed element combines}
668       \textcolor{comment}{//MD5 and SHA-1}
669       error = \hyperlink{tls__signature_8c_a07a3479608a65af8f3d18563a8e41f43}{tlsGenerateSignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
670    \}
671    \textcolor{keywordflow}{else}
672 \textcolor{preprocessor}{#endif}
673 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
674    \textcolor{comment}{//TLS 1.2 currently selected?}
675    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
676    \{
677       \textcolor{comment}{//In TLS 1.2, the MD5/SHA-1 combination in the digitally-signed element}
678       \textcolor{comment}{//has been replaced with a single hash. The signed element now includes}
679       \textcolor{comment}{//a field that explicitly specifies the hash algorithm used}
680       error = \hyperlink{tls__signature_8c_a97215ed0441ecd8d4f5fc073b2300bae}{tls12GenerateSignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
681    \}
682    \textcolor{keywordflow}{else}
683 \textcolor{preprocessor}{#endif}
684 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
685    \textcolor{comment}{//TLS 1.3 currently selected?}
686    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
687    \{
688       \textcolor{comment}{//In TLS 1.3, the signed element specifies the signature algorithm used.}
689       \textcolor{comment}{//The content that is covered under the signature is the transcript hash}
690       \textcolor{comment}{//output}
691       error = \hyperlink{tls13__misc_8h_a06e6ab55d26ff86f94fae2555f66b5ab}{tls13GenerateSignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
692    \}
693    \textcolor{keywordflow}{else}
694 \textcolor{preprocessor}{#endif}
695    \textcolor{comment}{//Invalid TLS version?}
696    \{
697       \textcolor{comment}{//Report an error}
698       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
699    \}
700 
701    \textcolor{comment}{//Return status code}
702    \textcolor{keywordflow}{return} error;
703 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_aa7ee11d8f87308e4f216dd7ed291897f}\label{tls__common_8c_aa7ee11d8f87308e4f216dd7ed291897f}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Change\+Cipher\+Spec@{tls\+Format\+Change\+Cipher\+Spec}}
\index{tls\+Format\+Change\+Cipher\+Spec@{tls\+Format\+Change\+Cipher\+Spec}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Change\+Cipher\+Spec()}{tlsFormatChangeCipherSpec()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Change\+Cipher\+Spec (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{Tls\+Change\+Cipher\+Spec} $\ast$}]{message,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Format Change\+Cipher\+Spec message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em message} & Buffer where to format the Change\+Cipher\+Spec message \\
\hline
\mbox{\tt out}  & {\em length} & Length of the resulting Change\+Cipher\+Spec message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 714 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
716 \{
717    \textcolor{comment}{//The message consists of a single byte of value 1}
718    \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->type = 1;
719 
720    \textcolor{comment}{//Length of the ChangeCipherSpec message}
721    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{TlsChangeCipherSpec});
722 
723    \textcolor{comment}{//Successful processing}
724    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
725 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a1a3dfb06aefb89631e1f1b4cff0e57b6}\label{tls__common_8c_a1a3dfb06aefb89631e1f1b4cff0e57b6}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Finished@{tls\+Format\+Finished}}
\index{tls\+Format\+Finished@{tls\+Format\+Finished}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Finished()}{tlsFormatFinished()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Finished (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{Tls\+Finished} $\ast$}]{message,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Format Finished message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em message} & Buffer where to format the Finished message \\
\hline
\mbox{\tt out}  & {\em length} & Length of the resulting Finished message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 736 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
738 \{
739    \textcolor{comment}{//Check whether TLS operates as a client or a server}
740    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
741    \{
742       \textcolor{comment}{//Copy the client's verify data}
743       memcpy(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, context->clientVerifyData, context->clientVerifyDataLen);
744       \textcolor{comment}{//Length of the handshake message}
745       *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = context->clientVerifyDataLen;
746    \}
747    \textcolor{keywordflow}{else}
748    \{
749       \textcolor{comment}{//Copy the server's verify data}
750       memcpy(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, context->serverVerifyData, context->serverVerifyDataLen);
751       \textcolor{comment}{//Length of the handshake message}
752       *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = context->serverVerifyDataLen;
753    \}
754 
755    \textcolor{comment}{//Successful processing}
756    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
757 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a2cb196a73d9b8d67091a344fe3551789}\label{tls__common_8c_a2cb196a73d9b8d67091a344fe3551789}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Signature\+Algorithms\+Cert\+Extension@{tls\+Format\+Signature\+Algorithms\+Cert\+Extension}}
\index{tls\+Format\+Signature\+Algorithms\+Cert\+Extension@{tls\+Format\+Signature\+Algorithms\+Cert\+Extension}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Signature\+Algorithms\+Cert\+Extension()}{tlsFormatSignatureAlgorithmsCertExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Signature\+Algorithms\+Cert\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Signature\+Algorithms\+Cert extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Signature\+Algorithms\+Cert extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1001 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1003 \{
1004    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
1005 
1006 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
1007    \textcolor{comment}{//TLS 1.2 implementations should also process this extension}
1008    \textcolor{keywordflow}{if}(context->versionMax >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1009    \{
1010       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
1011       \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *supportedSignAlgos;
1012 
1013       \textcolor{comment}{//Add the SignatureAlgorithmsCert extension}
1014       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1015       \textcolor{comment}{//Type of the extension}
1016       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a12873cfa8f4d5499d80bbb1abafb08a1}{TLS\_EXT\_SIGNATURE\_ALGORITHMS\_CERT});
1017 
1018       \textcolor{comment}{//The SignatureAlgorithmsCert extension allows a client to indicate}
1019       \textcolor{comment}{//which signature algorithms it can validate in X.509 certificates}
1020       supportedSignAlgos = (\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *) extension->value;
1021 
1022       \textcolor{comment}{//Enumerate the hash/signature algorithm pairs in descending order}
1023       \textcolor{comment}{//of preference}
1024       n = 0;
1025 
1026       \textcolor{comment}{//Ed25519 signature algorithm (PureEdDSA mode)}
1027       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a34b6299ba091cde76553b23a7632da7f}{X509\_SIGN\_ALGO\_ED25519}))
1028       \{
1029          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae6cdc4f0c6a497d2bd2c5d15412759ef}{TLS\_SIGN\_ALGO\_ED25519};
1030          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1031       \}
1032 
1033       \textcolor{comment}{//Ed448 signature algorithm (PureEdDSA mode)}
1034       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a258c2bcce0e685a5315ff975dc2f7c57}{X509\_SIGN\_ALGO\_ED448}))
1035       \{
1036          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a6fbbd4136d21496a9053ccca846ecf3f}{TLS\_SIGN\_ALGO\_ED448};
1037          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1038       \}
1039 
1040       \textcolor{comment}{//ECDSA signature algorithm with SHA-256}
1041       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA}) &&
1042          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a0639b14f3d787f086b8408386392e7cc}{X509\_HASH\_ALGO\_SHA256}))
1043       \{
1044          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1045          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1046       \}
1047 
1048       \textcolor{comment}{//ECDSA signature algorithm with SHA-384}
1049       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA}) &&
1050          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06ae094f54a0b17faeb0788684f9e4bfb9b}{X509\_HASH\_ALGO\_SHA384}))
1051       \{
1052          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1053          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
1054       \}
1055 
1056       \textcolor{comment}{//ECDSA signature algorithm with SHA-512}
1057       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA}) &&
1058          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a687299cc1c88f8989c0aa106f1cf40df}{X509\_HASH\_ALGO\_SHA512}))
1059       \{
1060          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1061          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
1062       \}
1063 
1064       \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-256}
1065       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS}) &&
1066          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a0639b14f3d787f086b8408386392e7cc}{X509\_HASH\_ALGO\_SHA256}))
1067       \{
1068          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA256};
1069          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1070       \}
1071 
1072       \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-384}
1073       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS}) &&
1074          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06ae094f54a0b17faeb0788684f9e4bfb9b}{X509\_HASH\_ALGO\_SHA384}))
1075       \{
1076          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA384};
1077          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1078       \}
1079 
1080       \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-512}
1081       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS}) &&
1082          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a687299cc1c88f8989c0aa106f1cf40df}{X509\_HASH\_ALGO\_SHA512}))
1083       \{
1084          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a1f76baf2d64af86ca98e164c9089a77c}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA512};
1085          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1086       \}
1087 
1088       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-256}
1089       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1090          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a0639b14f3d787f086b8408386392e7cc}{X509\_HASH\_ALGO\_SHA256}))
1091       \{
1092          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA256};
1093          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1094       \}
1095 
1096       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-384}
1097       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1098          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06ae094f54a0b17faeb0788684f9e4bfb9b}{X509\_HASH\_ALGO\_SHA384}))
1099       \{
1100          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA384};
1101          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1102       \}
1103 
1104       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-512}
1105       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1106          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a687299cc1c88f8989c0aa106f1cf40df}{X509\_HASH\_ALGO\_SHA512}))
1107       \{
1108          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a53d5e91921faf4103349e699d188ea5f}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA512};
1109          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1110       \}
1111 
1112       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-256}
1113       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1114          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a0639b14f3d787f086b8408386392e7cc}{X509\_HASH\_ALGO\_SHA256}))
1115       \{
1116          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1117          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1118       \}
1119 
1120       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-384}
1121       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1122          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06ae094f54a0b17faeb0788684f9e4bfb9b}{X509\_HASH\_ALGO\_SHA384}))
1123       \{
1124          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1125          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
1126       \}
1127 
1128       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-512}
1129       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1130          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a687299cc1c88f8989c0aa106f1cf40df}{X509\_HASH\_ALGO\_SHA512}))
1131       \{
1132          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1133          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
1134       \}
1135 
1136       \textcolor{comment}{//ECDSA signature algorithm with SHA-1}
1137       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA}) &&
1138          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06af40563ae1bc8ef6caf67820347c7c9ad}{X509\_HASH\_ALGO\_SHA1}))
1139       \{
1140          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1141          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1142       \}
1143 
1144       \textcolor{comment}{//ECDSA signature algorithm with SHA-224}
1145       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA}) &&
1146          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a7590d7e02cd20390d83c42968a8ec3cd}{X509\_HASH\_ALGO\_SHA224}))
1147       \{
1148          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1149          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
1150       \}
1151 
1152       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-1}
1153       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1154          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06af40563ae1bc8ef6caf67820347c7c9ad}{X509\_HASH\_ALGO\_SHA1}))
1155       \{
1156          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1157          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1158       \}
1159 
1160       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-224}
1161       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1162          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a7590d7e02cd20390d83c42968a8ec3cd}{X509\_HASH\_ALGO\_SHA224}))
1163       \{
1164          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1165          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
1166       \}
1167 
1168       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with MD5}
1169       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA}) &&
1170          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a437558a21e6d63a7f8c23d7f0160c4dc}{X509\_HASH\_ALGO\_MD5}))
1171       \{
1172          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1173          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daa72f43566b2829dd24049126ac7a7392}{TLS\_HASH\_ALGO\_MD5};
1174       \}
1175 
1176       \textcolor{comment}{//DSA signature algorithm with SHA-1}
1177       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA}) &&
1178          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06af40563ae1bc8ef6caf67820347c7c9ad}{X509\_HASH\_ALGO\_SHA1}))
1179       \{
1180          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1181          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1182       \}
1183 
1184       \textcolor{comment}{//DSA signature algorithm with SHA-224}
1185       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA}) &&
1186          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a7590d7e02cd20390d83c42968a8ec3cd}{X509\_HASH\_ALGO\_SHA224}))
1187       \{
1188          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1189          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
1190       \}
1191 
1192       \textcolor{comment}{//DSA signature algorithm with SHA-256}
1193       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA}) &&
1194          \hyperlink{certificate_2x509__common_8c_afcc7fe618817b6e5a4bd3db2a541daf0}{x509IsHashAlgoSupported}(\hyperlink{certificate_2x509__common_8h_a6a9d4c3832120bb78c1ac7117bfbdf06a0639b14f3d787f086b8408386392e7cc}{X509\_HASH\_ALGO\_SHA256}))
1195       \{
1196          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1197          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1198       \}
1199 
1200       \textcolor{comment}{//Compute the length, in bytes, of the list}
1201       n *= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
1202       \textcolor{comment}{//Fix the length of the list}
1203       supportedSignAlgos->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
1204 
1205       \textcolor{comment}{//Consider the 2-byte length field that precedes the list}
1206       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos});
1207       \textcolor{comment}{//Fix the length of the extension}
1208       extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
1209 
1210       \textcolor{comment}{//Compute the length, in bytes, of the SignatureAlgorithmsCert extension}
1211       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
1212    \}
1213 \textcolor{preprocessor}{#endif}
1214 
1215    \textcolor{comment}{//Total number of bytes that have been written}
1216    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1217 
1218    \textcolor{comment}{//Successful processing}
1219    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1220 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a3e8da6ef31b6d88603dd0b9ff5c9899c}\label{tls__common_8c_a3e8da6ef31b6d88603dd0b9ff5c9899c}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Format\+Signature\+Algorithms\+Extension@{tls\+Format\+Signature\+Algorithms\+Extension}}
\index{tls\+Format\+Signature\+Algorithms\+Extension@{tls\+Format\+Signature\+Algorithms\+Extension}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Signature\+Algorithms\+Extension()}{tlsFormatSignatureAlgorithmsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Signature\+Algorithms\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{cipher\+Suite\+Types,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Signature\+Algorithms extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cipher\+Suite\+Types} & Types of cipher suites proposed by the client \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Signature\+Algorithms extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 795 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
797 \{
798    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
799 
800 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
801    \textcolor{comment}{//This extension is not meaningful for TLS versions prior to 1.2. Clients}
802    \textcolor{comment}{//must not offer it if they are offering prior versions (refer to RFC 5246,}
803    \textcolor{comment}{//section 7.4.1.4.1)}
804    \textcolor{keywordflow}{if}(context->versionMax >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
805    \{
806       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
807       \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *supportedSignAlgos;
808 
809       \textcolor{comment}{//Add the SignatureAlgorithms extension}
810       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
811       \textcolor{comment}{//Type of the extension}
812       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a7eb2061b5b5c2690b4458f1d162e5dac}{TLS\_EXT\_SIGNATURE\_ALGORITHMS});
813 
814       \textcolor{comment}{//Point to the list of the hash/signature algorithm pairs that the}
815       \textcolor{comment}{//server is able to verify}
816       supportedSignAlgos = (\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos} *) extension->value;
817 
818       \textcolor{comment}{//Enumerate the hash/signature algorithm pairs in descending order}
819       \textcolor{comment}{//of preference}
820       n = 0;
821 
822 #if (\hyperlink{tls_8h_a0c1d82e58dc59d8a74c9634a6db0f891}{TLS\_EDDSA\_SIGN\_SUPPORT} == \hyperlink{os__port_8h_a73c228f87e038e8295ee8ea8eceaa5ac}{ENABLED})
823 \textcolor{preprocessor}{#if (TLS\_ED25519\_SUPPORT == ENABLED)}
824       \textcolor{comment}{//Ed25519 signature algorithm (PureEdDSA mode)}
825       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae6cdc4f0c6a497d2bd2c5d15412759ef}{TLS\_SIGN\_ALGO\_ED25519};
826       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
827 \textcolor{preprocessor}{#endif}
828 \textcolor{preprocessor}{#if (TLS\_ED448\_SUPPORT == ENABLED)}
829       \textcolor{comment}{//Ed448 signature algorithm (PureEdDSA mode)}
830       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a6fbbd4136d21496a9053ccca846ecf3f}{TLS\_SIGN\_ALGO\_ED448};
831       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
832 \textcolor{preprocessor}{#endif}
833 \textcolor{preprocessor}{#endif}
834 
835 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
836       \textcolor{comment}{//Any ECC cipher suite proposed by the client?}
837       \textcolor{keywordflow}{if}((cipherSuiteTypes & \hyperlink{tls__cipher__suites_8h_aa19934da0d53bda533624f13ba98303ba876aff9a6f283b9cc44eeb7c668cad43}{TLS\_CIPHER\_SUITE\_TYPE\_ECC}) != 0 ||
838          (cipherSuiteTypes & \hyperlink{tls__cipher__suites_8h_aa19934da0d53bda533624f13ba98303ba944e55ede9a5d1931be5ab8eb2d85a23}{TLS\_CIPHER\_SUITE\_TYPE\_TLS13}) != 0)
839       \{
840 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
841          \textcolor{comment}{//ECDSA signature algorithm with SHA-256}
842          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
843          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
844 \textcolor{preprocessor}{#endif}
845 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
846          \textcolor{comment}{//ECDSA signature algorithm with SHA-384}
847          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
848          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
849 \textcolor{preprocessor}{#endif}
850 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
851          \textcolor{comment}{//ECDSA signature algorithm with SHA-512}
852          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
853          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
854 \textcolor{preprocessor}{#endif}
855       \}
856 \textcolor{preprocessor}{#endif}
857 
858 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
859       \textcolor{comment}{//Check whether the X.509 parser supports RSA-PSS signatures}
860       \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__common_8c_ab4fb04ff1cc1ecd24548e967fb7acb5a}{x509IsSignAlgoSupported}(\hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS}))
861       \{
862 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
863          \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-256}
864          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA256};
865          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
866 \textcolor{preprocessor}{#endif}
867 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
868          \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-384}
869          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA384};
870          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
871 \textcolor{preprocessor}{#endif}
872 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
873          \textcolor{comment}{//RSASSA-PSS PSS signature algorithm with SHA-512}
874          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a1f76baf2d64af86ca98e164c9089a77c}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA512};
875          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
876 \textcolor{preprocessor}{#endif}
877       \}
878 \textcolor{preprocessor}{#endif}
879 
880 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
881 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
882       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-256}
883       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA256};
884       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
885 \textcolor{preprocessor}{#endif}
886 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
887       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-384}
888       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA384};
889       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
890 \textcolor{preprocessor}{#endif}
891 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
892       \textcolor{comment}{//RSASSA-PSS RSAE signature algorithm with SHA-512}
893       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = 
      \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a53d5e91921faf4103349e699d188ea5f}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA512};
894       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
895 \textcolor{preprocessor}{#endif}
896 \textcolor{preprocessor}{#endif}
897 
898 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED)}
899 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
900       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-256}
901       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
902       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
903 \textcolor{preprocessor}{#endif}
904 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
905       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-384}
906       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
907       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
908 \textcolor{preprocessor}{#endif}
909 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
910       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-512}
911       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
912       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
913 \textcolor{preprocessor}{#endif}
914 \textcolor{preprocessor}{#endif}
915 
916 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
917       \textcolor{comment}{//Any ECC cipher suite proposed by the client?}
918       \textcolor{keywordflow}{if}((cipherSuiteTypes & TLS\_CIPHER\_SUITE\_TYPE\_ECC) != 0 ||
919          (cipherSuiteTypes & \hyperlink{tls__cipher__suites_8h_aa19934da0d53bda533624f13ba98303ba944e55ede9a5d1931be5ab8eb2d85a23}{TLS\_CIPHER\_SUITE\_TYPE\_TLS13}) != 0)
920       \{
921 \textcolor{preprocessor}{#if (TLS\_SHA1\_SUPPORT == ENABLED)}
922          \textcolor{comment}{//ECDSA signature algorithm with SHA-1}
923          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
924          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
925 \textcolor{preprocessor}{#endif}
926 \textcolor{preprocessor}{#if (TLS\_SHA224\_SUPPORT == ENABLED)}
927          \textcolor{comment}{//ECDSA signature algorithm with SHA-224}
928          supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
929          supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
930 \textcolor{preprocessor}{#endif}
931       \}
932 \textcolor{preprocessor}{#endif}
933 
934 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED)}
935 \textcolor{preprocessor}{#if (TLS\_SHA1\_SUPPORT == ENABLED)}
936       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-1}
937       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
938       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
939 \textcolor{preprocessor}{#endif}
940 \textcolor{preprocessor}{#if (TLS\_SHA224\_SUPPORT == ENABLED)}
941       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with SHA-224}
942       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
943       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
944 \textcolor{preprocessor}{#endif}
945 \textcolor{preprocessor}{#if (TLS\_MD5\_SUPPORT == ENABLED)}
946       \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature algorithm with MD5}
947       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
948       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daa72f43566b2829dd24049126ac7a7392}{TLS\_HASH\_ALGO\_MD5};
949 \textcolor{preprocessor}{#endif}
950 \textcolor{preprocessor}{#endif}
951 
952 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
953 \textcolor{preprocessor}{#if (TLS\_SHA1\_SUPPORT == ENABLED)}
954       \textcolor{comment}{//DSA signature algorithm with SHA-1}
955       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
956       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
957 \textcolor{preprocessor}{#endif}
958 \textcolor{preprocessor}{#if (TLS\_SHA224\_SUPPORT == ENABLED)}
959       \textcolor{comment}{//DSA signature algorithm with SHA-224}
960       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
961       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
962 \textcolor{preprocessor}{#endif}
963 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
964       \textcolor{comment}{//DSA signature algorithm with SHA-256}
965       supportedSignAlgos->value[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}].signature = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
966       supportedSignAlgos->value[n++].hash = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
967 \textcolor{preprocessor}{#endif}
968 \textcolor{preprocessor}{#endif}
969 
970       \textcolor{comment}{//Compute the length, in bytes, of the list}
971       n *= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
972       \textcolor{comment}{//Fix the length of the list}
973       supportedSignAlgos->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
974 
975       \textcolor{comment}{//Consider the 2-byte length field that precedes the list}
976       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{TlsSignHashAlgos});
977       \textcolor{comment}{//Fix the length of the extension}
978       extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
979 
980       \textcolor{comment}{//Compute the length, in bytes, of the SignatureAlgorithms extension}
981       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
982    \}
983 \textcolor{preprocessor}{#endif}
984 
985    \textcolor{comment}{//Total number of bytes that have been written}
986    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
987 
988    \textcolor{comment}{//Successful processing}
989    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
990 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_abd3d66a2f80b812ee5db99a78191b795}\label{tls__common_8c_abd3d66a2f80b812ee5db99a78191b795}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Parse\+Alert@{tls\+Parse\+Alert}}
\index{tls\+Parse\+Alert@{tls\+Parse\+Alert}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Alert()}{tlsParseAlert()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Alert (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{Tls\+Alert} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Alert message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em message} & Incoming Alert message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Message length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1772 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1774 \{
1775    \textcolor{comment}{//Debug message}
1776    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Alert message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1777    \hyperlink{debug_8h_a291f0d17dd4473553319c186e48ed439}{TRACE\_INFO\_ARRAY}(\textcolor{stringliteral}{"  "}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1778 
1779    \textcolor{comment}{//Check message length}
1780    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert}))
1781       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
1782 
1783    \textcolor{comment}{//Debug message}
1784    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Level = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->level);
1785    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Description = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->description);
1786 
1787    \textcolor{comment}{//Alert messages convey the severity of the message}
1788    \textcolor{keywordflow}{if}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->level == \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202a0fac70d0bd6a19666d5b2f13c71cddf7}{TLS\_ALERT\_LEVEL\_WARNING})
1789    \{
1790 \textcolor{preprocessor}{#if (TLS\_MAX\_WARNING\_ALERTS > 0)}
1791       \textcolor{comment}{//Increment the count of consecutive warning alerts}
1792       context->alertCount++;
1793 
1794       \textcolor{comment}{//Do not allow too many consecutive warning alerts}
1795       \textcolor{keywordflow}{if}(context->alertCount > \hyperlink{tls_8h_a560f90e88b20f77121417ae223945ca8}{TLS\_MAX\_WARNING\_ALERTS})
1796          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1797 \textcolor{preprocessor}{#endif}
1798 
1799       \textcolor{comment}{//Check alert type}
1800       \textcolor{keywordflow}{if}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->description == \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba73d804f6b3c2241690af4f53d621c0d1}{TLS\_ALERT\_CLOSE\_NOTIFY})
1801       \{
1802          \textcolor{comment}{//A closure alert has been received}
1803          context->closeNotifyReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1804 
1805          \textcolor{comment}{//Close down the connection immediately}
1806          \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA})
1807             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING};
1808       \}
1809       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->description == \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba1e2c52231aad635cc3791718c62fc4f6}{TLS\_ALERT\_USER\_CANCELED})
1810       \{
1811          \textcolor{comment}{//This alert notifies the recipient that the sender is canceling the}
1812          \textcolor{comment}{//handshake for some reason unrelated to a protocol failure}
1813       \}
1814       \textcolor{keywordflow}{else}
1815       \{
1816          \textcolor{comment}{//TLS 1.3 currently selected?}
1817          \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
1818          \{
1819             \textcolor{comment}{//Unknown alert types must be treated as error alerts}
1820             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1821          \}
1822       \}
1823    \}
1824    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->level == \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL})
1825    \{
1826       \textcolor{comment}{//A fatal alert message has been received}
1827       context->fatalAlertReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1828 
1829 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
1830       \textcolor{comment}{//Any connection terminated with a fatal alert must not be resumed}
1831       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
1832       \{
1833          \hyperlink{tls__cache_8c_a7ec82d843e8bef5efc1ace2394b7e6cb}{tlsRemoveFromCache}(context);
1834       \}
1835 \textcolor{preprocessor}{#endif}
1836 
1837       \textcolor{comment}{//Servers and clients must forget any session identifiers}
1838       memset(context->sessionId, 0, 32);
1839       context->sessionIdLen = 0;
1840 
1841       \textcolor{comment}{//Alert messages with a level of fatal result in the immediate}
1842       \textcolor{comment}{//termination of the connection}
1843       context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED};
1844    \}
1845    \textcolor{keywordflow}{else}
1846    \{
1847       \textcolor{comment}{//Report an error}
1848       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
1849    \}
1850 
1851    \textcolor{comment}{//Successful processing}
1852    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1853 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a8ea298350bb1262e85bca00a448122f3}\label{tls__common_8c_a8ea298350bb1262e85bca00a448122f3}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Parse\+Certificate@{tls\+Parse\+Certificate}}
\index{tls\+Parse\+Certificate@{tls\+Parse\+Certificate}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Certificate()}{tlsParseCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Certificate (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{Tls\+Certificate} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Certificate message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em message} & Incoming Certificate message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Message length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1231 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1233 \{
1234    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1235    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1236    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1237    \textcolor{keyword}{const} \hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList} *certificateList;
1238 
1239    \textcolor{comment}{//Debug message}
1240    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Certificate message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1241    \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1242 
1243    \textcolor{comment}{//Check whether TLS operates as a client or a server}
1244    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1245    \{
1246       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1247       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1248       \{
1249          \textcolor{comment}{//Check current state}
1250          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074}{TLS\_STATE\_SERVER\_CERTIFICATE})
1251             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1252       \}
1253       \textcolor{keywordflow}{else}
1254       \{
1255          \textcolor{comment}{//The CertificateRequest message is optional}
1256          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783}{TLS\_STATE\_CERTIFICATE\_REQUEST} &&
1257             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074}{TLS\_STATE\_SERVER\_CERTIFICATE})
1258          \{
1259             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1260          \}
1261       \}
1262    \}
1263    \textcolor{keywordflow}{else}
1264    \{
1265       \textcolor{comment}{//Check current state}
1266       \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251}{TLS\_STATE\_CLIENT\_CERTIFICATE})
1267          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1268    \}
1269 
1270    \textcolor{comment}{//Point to the beginning of the handshake message}
1271    p = \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
1272 
1273 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
1274    \textcolor{comment}{//TLS 1.3 currently selected?}
1275    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
1276    \{
1277       \textcolor{keyword}{const} \hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext} *certRequestContext;
1278 
1279       \textcolor{comment}{//Point to the certificate request context}
1280       certRequestContext = (\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext} *) p;
1281 
1282       \textcolor{comment}{//Malformed Certificate message?}
1283       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}))
1284          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1285       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < (\textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}) + certRequestContext->
      length))
1286          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1287 
1288       \textcolor{comment}{//Point to the next field}
1289       p += \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}) + certRequestContext->length;
1290       \textcolor{comment}{//Remaining bytes to process}
1291       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{tls13__misc_8h_a7a73aa4b5d0ca0a547bc83636546f438}{Tls13CertRequestContext}) + certRequestContext->length;
1292    \}
1293 \textcolor{preprocessor}{#endif}
1294 
1295    \textcolor{comment}{//Point to the chain of certificates}
1296    certificateList = (\hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList} *) p;
1297 
1298    \textcolor{comment}{//Malformed Certificate message?}
1299    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList}))
1300       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1301 
1302    \textcolor{comment}{//Get the size occupied by the certificate list}
1303    n = \hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(certificateList->length);
1304    \textcolor{comment}{//Remaining bytes to process}
1305    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ae84f7ad0d95544f726da4295b4e0e2ac}{TlsCertificateList});
1306 
1307    \textcolor{comment}{//Malformed Certificate message?}
1308    \textcolor{keywordflow}{if}(n != \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
1309       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1310 
1311    \textcolor{comment}{//Non-empty certificate list?}
1312    \textcolor{keywordflow}{if}(n > 0)
1313    \{
1314 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
1315       \textcolor{comment}{//Check certificate type}
1316       \textcolor{keywordflow}{if}(context->peerCertFormat == \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0a598a87140d01a36216289f5dfb6c0f35}{TLS\_CERT\_FORMAT\_RAW\_PUBLIC\_KEY})
1317       \{
1318          \textcolor{comment}{//Parse the raw public key}
1319          error = \hyperlink{tls__certificate_8c_aa425ea4126c69179a25b0d4c07049a66}{tlsParseRawPublicKey}(context, certificateList->value, n);
1320       \}
1321       \textcolor{keywordflow}{else}
1322 \textcolor{preprocessor}{#endif}
1323       \{
1324          \textcolor{comment}{//Parse the certificate chain}
1325          error = \hyperlink{tls__certificate_8c_a271d9a0eaaca97bb85f64c7ad176c33e}{tlsParseCertificateList}(context, certificateList->value, n);
1326       \}
1327    \}
1328    \textcolor{keywordflow}{else}
1329    \{
1330 \textcolor{preprocessor}{#if (TLS\_SERVER\_SUPPORT == ENABLED)}
1331       \textcolor{comment}{//Server mode?}
1332       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
1333       \{
1334          \textcolor{comment}{//Check whether client authentication is required}
1335          \textcolor{keywordflow}{if}(context->clientAuthMode == \hyperlink{tls_8h_a657708ec632fe90da5a94cf667118527a5cbcc6f0c66081f9c833381df854d994}{TLS\_CLIENT\_AUTH\_REQUIRED})
1336          \{
1337             \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1338             \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1339             \{
1340                \textcolor{comment}{//If the client does not send any certificates, the server}
1341                \textcolor{comment}{//responds with a fatal handshake\_failure alert (refer to}
1342                \textcolor{comment}{//RFC 5246, section 7.4.6)}
1343                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1344             \}
1345             \textcolor{keywordflow}{else}
1346             \{
1347                \textcolor{comment}{//If the client does not send any certificates, the server}
1348                \textcolor{comment}{//aborts the handshake with a certificate\_required alert (refer}
1349                \textcolor{comment}{//to RFC 8446, section 4.4.2.4)}
1350                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac9ea6c354e68dee76c22d47d620f7718}{ERROR\_CERTIFICATE\_REQUIRED};
1351             \}
1352          \}
1353          \textcolor{keywordflow}{else}
1354          \{
1355             \textcolor{comment}{//The client did not send any certificates}
1356             context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdae8286884ac120d31a1c3bbf125d116ec}{TLS\_CERT\_NONE};
1357             \textcolor{comment}{//The server may continue the handshake without client authentication}
1358             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1359          \}
1360       \}
1361       \textcolor{keywordflow}{else}
1362 \textcolor{preprocessor}{#endif}
1363       \textcolor{comment}{//Client mode?}
1364       \{
1365          \textcolor{comment}{//The server's certificate list must always be non-empty (refer to}
1366          \textcolor{comment}{//RFC 8446, section 4.4.2)}
1367          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1368       \}
1369    \}
1370 
1371    \textcolor{comment}{//Check status code}
1372    \textcolor{keywordflow}{if}(!error)
1373    \{
1374       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1375       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1376       \{
1377          \textcolor{comment}{//Check whether TLS operates as a client or a server}
1378          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1379          \{
1380             \textcolor{comment}{//The server does not send a ServerKeyExchange message when RSA}
1381             \textcolor{comment}{//key exchange method is used}
1382             \textcolor{keywordflow}{if}(context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e}{TLS\_KEY\_EXCH\_RSA})
1383                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783}{TLS\_STATE\_CERTIFICATE\_REQUEST};
1384             \textcolor{keywordflow}{else}
1385                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da8ed746876fcd686d131f90d04809fd32}{TLS\_STATE\_SERVER\_KEY\_EXCHANGE};
1386          \}
1387          \textcolor{keywordflow}{else}
1388          \{
1389             \textcolor{comment}{//Wait for a ClientKeyExchange message from the client}
1390             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c}{TLS\_STATE\_CLIENT\_KEY\_EXCHANGE};
1391          \}
1392       \}
1393       \textcolor{keywordflow}{else}
1394       \{
1395          \textcolor{comment}{//Check whether TLS operates as a client or a server}
1396          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1397          \{
1398             \textcolor{comment}{//The server must send a CertificateVerify message immediately}
1399             \textcolor{comment}{//after the Certificate message}
1400             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da21097ff5428ba2ba5b8be925fd42224b}{TLS\_STATE\_SERVER\_CERTIFICATE\_VERIFY};
1401          \}
1402          \textcolor{keywordflow}{else}
1403          \{
1404             \textcolor{comment}{//The client must send a CertificateVerify message when the}
1405             \textcolor{comment}{//Certificate message is non-empty}
1406             \textcolor{keywordflow}{if}(context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdae8286884ac120d31a1c3bbf125d116ec}{TLS\_CERT\_NONE})
1407                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b}{TLS\_STATE\_CLIENT\_CERTIFICATE\_VERIFY};
1408             \textcolor{keywordflow}{else}
1409                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
1410          \}
1411       \}
1412    \}
1413 
1414    \textcolor{comment}{//Return status code}
1415    \textcolor{keywordflow}{return} error;
1416 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a28b47eb94395efb96c6b4d274a5aeb38}\label{tls__common_8c_a28b47eb94395efb96c6b4d274a5aeb38}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Parse\+Certificate\+Verify@{tls\+Parse\+Certificate\+Verify}}
\index{tls\+Parse\+Certificate\+Verify@{tls\+Parse\+Certificate\+Verify}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Certificate\+Verify()}{tlsParseCertificateVerify()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Certificate\+Verify (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{Tls\+Certificate\+Verify} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Certificate\+Verify message. 

The Certificate\+Verify message is used to provide explicit verification of a client certificate. This message is only sent following a client certificate that has signing capability


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em message} & Incoming Certificate\+Verify message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Message length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1432 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1434 \{
1435    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1436 
1437    \textcolor{comment}{//Debug message}
1438    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"CertificateVerify message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1439    \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1440 
1441    \textcolor{comment}{//Check whether TLS operates as a client or a server}
1442    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1443    \{
1444       \textcolor{comment}{//Check current state}
1445       \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da21097ff5428ba2ba5b8be925fd42224b}{TLS\_STATE\_SERVER\_CERTIFICATE\_VERIFY})
1446          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1447    \}
1448    \textcolor{keywordflow}{else}
1449    \{
1450       \textcolor{comment}{//Check current state}
1451       \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b}{TLS\_STATE\_CLIENT\_CERTIFICATE\_VERIFY})
1452          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1453    \}
1454 
1455 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_1)}
1456    \textcolor{comment}{//SSL 3.0, TLS 1.0 or TLS 1.1 currently selected?}
1457    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
1458    \{
1459       \textcolor{comment}{//In TLS version prior to 1.2, the digitally-signed element combines}
1460       \textcolor{comment}{//MD5 and SHA-1}
1461       error = \hyperlink{tls__signature_8c_a15ddf6f6b2111125bc180fcae4bb6fd8}{tlsVerifySignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1462    \}
1463    \textcolor{keywordflow}{else}
1464 \textcolor{preprocessor}{#endif}
1465 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_2 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
1466    \textcolor{comment}{//TLS 1.2 currently selected?}
1467    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1468    \{
1469       \textcolor{comment}{//In TLS 1.2, the MD5/SHA-1 combination in the digitally-signed element}
1470       \textcolor{comment}{//has been replaced with a single hash. The signed element now includes}
1471       \textcolor{comment}{//a field that explicitly specifies the hash algorithm used}
1472       error = \hyperlink{tls__signature_8c_a9becdc76c429a991386747d7974d47e1}{tls12VerifySignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1473    \}
1474    \textcolor{keywordflow}{else}
1475 \textcolor{preprocessor}{#endif}
1476 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
1477    \textcolor{comment}{//TLS 1.3 currently selected?}
1478    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
1479    \{
1480       \textcolor{comment}{//In TLS 1.3, the signed element specifies the signature algorithm used.}
1481       \textcolor{comment}{//The content that is covered under the signature is the transcript hash}
1482       \textcolor{comment}{//output}
1483       error = \hyperlink{tls13__misc_8h_a126c73370183a9563d53843c9e224de4}{tls13VerifySignature}(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1484    \}
1485    \textcolor{keywordflow}{else}
1486 \textcolor{preprocessor}{#endif}
1487    \textcolor{comment}{//Invalid TLS version?}
1488    \{
1489       \textcolor{comment}{//Report an error}
1490       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
1491    \}
1492 
1493    \textcolor{comment}{//Check status code}
1494    \textcolor{keywordflow}{if}(!error)
1495    \{
1496       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1497       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1498       \{
1499          \textcolor{comment}{//Wait for a ChangeCipherSpec message from the client}
1500          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC};
1501       \}
1502       \textcolor{keywordflow}{else}
1503       \{
1504          \textcolor{comment}{//Wait for a Finished message from the peer}
1505          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1506             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED};
1507          \textcolor{keywordflow}{else}
1508             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
1509       \}
1510    \}
1511 
1512    \textcolor{comment}{//Return status code}
1513    \textcolor{keywordflow}{return} error;
1514 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a5e337b2359ac1c81214620f4d4744f29}\label{tls__common_8c_a5e337b2359ac1c81214620f4d4744f29}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Parse\+Change\+Cipher\+Spec@{tls\+Parse\+Change\+Cipher\+Spec}}
\index{tls\+Parse\+Change\+Cipher\+Spec@{tls\+Parse\+Change\+Cipher\+Spec}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Change\+Cipher\+Spec()}{tlsParseChangeCipherSpec()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Change\+Cipher\+Spec (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{Tls\+Change\+Cipher\+Spec} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Change\+Cipher\+Spec message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em message} & Incoming Change\+Cipher\+Spec message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Message length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1525 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1527 \{
1528    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1529 
1530    \textcolor{comment}{//Debug message}
1531    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"ChangeCipherSpec message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1532    \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1533 
1534    \textcolor{comment}{//Check the length of the ChangeCipherSpec message}
1535    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{TlsChangeCipherSpec}))
1536       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1537 
1538    \textcolor{comment}{//The message consists of a single byte of value 1}
1539    \textcolor{keywordflow}{if}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->type != 0x01)
1540       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1541 
1542    \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1543    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1544    \{
1545       \textcolor{comment}{//Check whether TLS operates as a client or a server}
1546       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1547       \{
1548          \textcolor{comment}{//Check current state}
1549          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0}{TLS\_STATE\_SERVER\_CHANGE\_CIPHER\_SPEC})
1550             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1551       \}
1552       \textcolor{keywordflow}{else}
1553       \{
1554          \textcolor{comment}{//Check current state}
1555          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC})
1556             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1557       \}
1558 
1559       \textcolor{comment}{//Release decryption engine first}
1560       \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->decryptionEngine);
1561 
1562       \textcolor{comment}{//Check whether TLS operates as a client or a server}
1563       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1564       \{
1565          \textcolor{comment}{//Initialize decryption engine using server write keys}
1566          error = \hyperlink{tls__misc_8c_a4162f3ce7f2e32575f8f6a011b8502ce}{tlsInitEncryptionEngine}(context, &context->decryptionEngine,
1567             \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1568          \textcolor{comment}{//Any error to report?}
1569          \textcolor{keywordflow}{if}(error)
1570             \textcolor{keywordflow}{return} error;
1571 
1572          \textcolor{comment}{//Wait for a Finished message from the server}
1573          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED};
1574       \}
1575       \textcolor{keywordflow}{else}
1576       \{
1577          \textcolor{comment}{//Initialize decryption engine using client write keys}
1578          error = \hyperlink{tls__misc_8c_a4162f3ce7f2e32575f8f6a011b8502ce}{tlsInitEncryptionEngine}(context, &context->decryptionEngine,
1579             \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1580          \textcolor{comment}{//Any error to report?}
1581          \textcolor{keywordflow}{if}(error)
1582             \textcolor{keywordflow}{return} error;
1583 
1584          \textcolor{comment}{//Wait for a Finished message from the client}
1585          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
1586       \}
1587 
1588 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
1589       \textcolor{comment}{//DTLS protocol?}
1590       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
1591       \{
1592          \textcolor{comment}{//Initialize sliding window}
1593          \hyperlink{dtls__misc_8c_ab59f2c12633543d0d87d60fadadf1f6b}{dtlsInitReplayWindow}(context);
1594       \}
1595 \textcolor{preprocessor}{#endif}
1596    \}
1597    \textcolor{keywordflow}{else}
1598    \{
1599       \textcolor{comment}{//In TLS 1.3, the ChangeCipherSpec message is used only for compatibility}
1600       \textcolor{comment}{//purposes and must be dropped without further processing}
1601       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1602       \{
1603          \textcolor{comment}{//A ChangeCipherSpec message received received before the first}
1604          \textcolor{comment}{//ClientHello message or after the server's Finished message must}
1605          \textcolor{comment}{//be treated as an unexpected record type}
1606          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a}{TLS\_STATE\_SERVER\_HELLO} &&
1607             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da22971523377f52c52b251553e373b4c8}{TLS\_STATE\_SERVER\_HELLO\_2} &&
1608             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf72c48e789c26be573d3726c9e7ad163}{TLS\_STATE\_ENCRYPTED\_EXTENSIONS} &&
1609             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783}{TLS\_STATE\_CERTIFICATE\_REQUEST} &&
1610             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074}{TLS\_STATE\_SERVER\_CERTIFICATE} &&
1611             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da21097ff5428ba2ba5b8be925fd42224b}{TLS\_STATE\_SERVER\_CERTIFICATE\_VERIFY} &&
1612             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED})
1613          \{
1614             \textcolor{comment}{//Report an error}
1615             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1616          \}
1617       \}
1618       \textcolor{keywordflow}{else}
1619       \{
1620          \textcolor{comment}{//A ChangeCipherSpec message received received before the first}
1621          \textcolor{comment}{//ClientHello message or after the client's Finished message must}
1622          \textcolor{comment}{//be treated as an unexpected record type}
1623          \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d}{TLS\_STATE\_CLIENT\_HELLO\_2} &&
1624             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251}{TLS\_STATE\_CLIENT\_CERTIFICATE} &&
1625             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b}{TLS\_STATE\_CLIENT\_CERTIFICATE\_VERIFY} &&
1626             context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED})
1627          \{
1628             \textcolor{comment}{//Report an error}
1629             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1630          \}
1631       \}
1632 
1633 \textcolor{preprocessor}{#if (TLS\_MAX\_CHANGE\_CIPHER\_SPEC\_MESSAGES > 0)}
1634       \textcolor{comment}{//Increment the count of consecutive ChangeCipherSpec messages}
1635       context->changeCipherSpecCount++;
1636 
1637       \textcolor{comment}{//Do not allow too many consecutive ChangeCipherSpec messages}
1638       \textcolor{keywordflow}{if}(context->changeCipherSpecCount > \hyperlink{tls_8h_a25651893ebf813a5d02f68f8f8718b5c}{TLS\_MAX\_CHANGE\_CIPHER\_SPEC\_MESSAGES}
      )
1639          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1640 \textcolor{preprocessor}{#endif}
1641    \}
1642 
1643    \textcolor{comment}{//Successful processing}
1644    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1645 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_ad2a518c781f8297e7b21fdbeb569de31}\label{tls__common_8c_ad2a518c781f8297e7b21fdbeb569de31}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Parse\+Finished@{tls\+Parse\+Finished}}
\index{tls\+Parse\+Finished@{tls\+Parse\+Finished}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Finished()}{tlsParseFinished()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Finished (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{Tls\+Finished} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Finished message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em message} & Incoming Finished message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Message length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1656 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
1658 \{
1659    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1660 
1661    \textcolor{comment}{//Debug message}
1662    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Finished message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1663    \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1664 
1665    \textcolor{comment}{//Check whether TLS operates as a client or a server}
1666    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1667    \{
1668       \textcolor{comment}{//Check current state}
1669       \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED})
1670          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1671 
1672       \textcolor{comment}{//The verify data is generated from all messages in this handshake}
1673       \textcolor{comment}{//up to but not including the Finished message}
1674       error = \hyperlink{tls__transcript__hash_8c_a2cbaa8d948e71f9a3ec07a3a78cff0a9}{tlsComputeVerifyData}(context, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER},
1675          context->serverVerifyData, &context->serverVerifyDataLen);
1676       \textcolor{comment}{//Unable to generate the verify data?}
1677       \textcolor{keywordflow}{if}(error)
1678          \textcolor{keywordflow}{return} error;
1679 
1680       \textcolor{comment}{//Check the length of the Finished message}
1681       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != context->serverVerifyDataLen)
1682       \{
1683 \textcolor{preprocessor}{#if (TLS\_MAX\_EMPTY\_RECORDS > 0)}
1684          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
1685 \textcolor{preprocessor}{#else}
1686          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1687 \textcolor{preprocessor}{#endif}
1688       \}
1689 
1690       \textcolor{comment}{//Check the resulting verify data}
1691       \textcolor{keywordflow}{if}(memcmp(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, context->serverVerifyData, context->serverVerifyDataLen))
1692          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
1693    \}
1694    \textcolor{keywordflow}{else}
1695    \{
1696       \textcolor{comment}{//Check current state}
1697       \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED})
1698          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
1699 
1700       \textcolor{comment}{//The verify data is generated from all messages in this handshake}
1701       \textcolor{comment}{//up to but not including the Finished message}
1702       error = \hyperlink{tls__transcript__hash_8c_a2cbaa8d948e71f9a3ec07a3a78cff0a9}{tlsComputeVerifyData}(context, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT},
1703          context->clientVerifyData, &context->clientVerifyDataLen);
1704       \textcolor{comment}{//Unable to generate the verify data?}
1705       \textcolor{keywordflow}{if}(error)
1706          \textcolor{keywordflow}{return} error;
1707 
1708       \textcolor{comment}{//Check the length of the Finished message}
1709       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != context->clientVerifyDataLen)
1710       \{
1711 \textcolor{preprocessor}{#if (TLS\_MAX\_EMPTY\_RECORDS > 0)}
1712          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
1713 \textcolor{preprocessor}{#else}
1714          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
1715 \textcolor{preprocessor}{#endif}
1716       \}
1717 
1718       \textcolor{comment}{//Check the resulting verify data}
1719       \textcolor{keywordflow}{if}(memcmp(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, context->clientVerifyData, context->clientVerifyDataLen))
1720          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
1721    \}
1722 
1723    \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
1724    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
1725    \{
1726       \textcolor{comment}{//Check whether TLS operates as a client or a server}
1727       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1728       \{
1729          \textcolor{comment}{//Abbreviated or full handshake?}
1730          \textcolor{keywordflow}{if}(context->resume)
1731             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC};
1732          \textcolor{keywordflow}{else}
1733             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA};
1734       \}
1735       \textcolor{keywordflow}{else}
1736       \{
1737          \textcolor{comment}{//Abbreviated or full handshake?}
1738          \textcolor{keywordflow}{if}(context->resume)
1739             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA};
1740          \textcolor{keywordflow}{else}
1741             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0}{TLS\_STATE\_SERVER\_CHANGE\_CIPHER\_SPEC};
1742       \}
1743    \}
1744    \textcolor{keywordflow}{else}
1745    \{
1746       \textcolor{comment}{//Check whether TLS operates as a client or a server}
1747       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1748       \{
1749          \textcolor{comment}{//Compute server application traffic keys}
1750          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4540b72ab65fe29516e8148fbb43261d}{TLS\_STATE\_SERVER\_APP\_TRAFFIC\_KEYS};
1751       \}
1752       \textcolor{keywordflow}{else}
1753       \{
1754          \textcolor{comment}{//Compute client application traffic keys}
1755          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da429690fe1b1bd88bcc256dc5ec811448}{TLS\_STATE\_CLIENT\_APP\_TRAFFIC\_KEYS};
1756       \}
1757    \}
1758 
1759    \textcolor{comment}{//Successful processing}
1760    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1761 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}\label{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Send\+Alert@{tls\+Send\+Alert}}
\index{tls\+Send\+Alert@{tls\+Send\+Alert}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Send\+Alert()}{tlsSendAlert()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Send\+Alert (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{level,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{description }\end{DoxyParamCaption})}



Send Alert message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em level} & Severity of the message (warning or fatal) \\
\hline
\mbox{\tt in}  & {\em description} & Description of the alert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 480 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
481 \{
482    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
483    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
484    \hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
485 
486    \textcolor{comment}{//Point to the buffer where to format the message}
487    message = (\hyperlink{tls_8h_aae4f7171708af263a31b184f9747b17a}{TlsAlert} *) (context->txBuffer + context->txBufferLen);
488 
489    \textcolor{comment}{//Format Alert message}
490    error = \hyperlink{tls__common_8c_a7e24682ce12b8812ca66d9c2c5aa0b5c}{tlsFormatAlert}(context, \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level}, \hyperlink{tls_8h_a8119fa4b03f4c903dfa45ab2b6d5534f}{description}, message, &length);
491 
492    \textcolor{comment}{//Check status code}
493    \textcolor{keywordflow}{if}(!error)
494    \{
495       \textcolor{comment}{//Debug message}
496       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Alert message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
497       \hyperlink{debug_8h_a291f0d17dd4473553319c186e48ed439}{TRACE\_INFO\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
498 
499 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
500       \textcolor{comment}{//DTLS protocol?}
501       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
502       \{
503          \textcolor{comment}{//Send Alert message}
504          error = \hyperlink{dtls__record_8c_ab15a3a01b2765ebf23f0fc72f1405f92}{dtlsWriteProtocolData}(context, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message,
505             length, \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896cac576c866dc3772236d51f16226adfbd9}{TLS\_TYPE\_ALERT});
506       \}
507       \textcolor{keywordflow}{else}
508 \textcolor{preprocessor}{#endif}
509       \textcolor{comment}{//TLS protocol?}
510       \{
511          \textcolor{comment}{//Send Alert message}
512          error = \hyperlink{tls__record_8c_ae8f8c035d23eb99d1d5642d4ce644715}{tlsWriteProtocolData}(context, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message,
513             length, \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896cac576c866dc3772236d51f16226adfbd9}{TLS\_TYPE\_ALERT});
514       \}
515    \}
516 
517    \textcolor{comment}{//Alert messages convey the severity of the message}
518    \textcolor{keywordflow}{if}(\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} == \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202a0fac70d0bd6a19666d5b2f13c71cddf7}{TLS\_ALERT\_LEVEL\_WARNING})
519    \{
520       \textcolor{comment}{//If an alert with a level of warning is sent, generally the}
521       \textcolor{comment}{//connection can continue normally}
522       \textcolor{keywordflow}{if}(\hyperlink{tls_8h_a8119fa4b03f4c903dfa45ab2b6d5534f}{description} == \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba73d804f6b3c2241690af4f53d621c0d1}{TLS\_ALERT\_CLOSE\_NOTIFY})
523       \{
524          \textcolor{comment}{//Either party may initiate a close by sending a close\_notify alert}
525          context->closeNotifySent = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
526 
527          \textcolor{comment}{//Update FSM state}
528          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING};
529       \}
530    \}
531    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} == \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL})
532    \{
533       \textcolor{comment}{//Alert messages with a level of fatal result in the immediate}
534       \textcolor{comment}{//termination of the connection}
535       context->fatalAlertSent = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
536 
537 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
538       \textcolor{comment}{//Any connection terminated with a fatal alert must not be resumed}
539       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
540       \{
541          \hyperlink{tls__cache_8c_a7ec82d843e8bef5efc1ace2394b7e6cb}{tlsRemoveFromCache}(context);
542       \}
543 \textcolor{preprocessor}{#endif}
544 
545       \textcolor{comment}{//Servers and clients must forget any session identifiers}
546       memset(context->sessionId, 0, 32);
547       context->sessionIdLen = 0;
548 
549       \textcolor{comment}{//Update FSM state}
550       context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4dabb02ceb758f4c4dedc2aabf472677fbe}{TLS\_STATE\_CLOSING};
551    \}
552 
553    \textcolor{comment}{//Return status code}
554    \textcolor{keywordflow}{return} error;
555 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_ae447dcb4133c50b4baf93b4808824474}\label{tls__common_8c_ae447dcb4133c50b4baf93b4808824474}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Send\+Certificate@{tls\+Send\+Certificate}}
\index{tls\+Send\+Certificate@{tls\+Send\+Certificate}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Send\+Certificate()}{tlsSendCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Send\+Certificate (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send Certificate message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 62 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
63 \{
64    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
65    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
66    \hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{TlsCertificate} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
67 
68    \textcolor{comment}{//Initialize status code}
69    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
70 
71    \textcolor{comment}{//Point to the buffer where to format the message}
72    message = (\hyperlink{tls_8h_a54d28ff176bb6dbe1a5c1791e0bdede4}{TlsCertificate} *) (context->txBuffer + context->txBufferLen);
73 
74 \textcolor{preprocessor}{#if (TLS\_CLIENT\_SUPPORT == ENABLED)}
75    \textcolor{comment}{//Client mode?}
76    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
77    \{
78       \textcolor{comment}{//The client must send a Certificate message if the server requests it}
79       \textcolor{keywordflow}{if}(context->clientCertRequested)
80       \{
81 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= SSL\_VERSION\_3\_0)}
82          \textcolor{comment}{//No suitable certificate available?}
83          \textcolor{keywordflow}{if}(context->cert == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->version == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
84          \{
85             \textcolor{comment}{//The client should send a no\_certificate alert instead}
86             error = \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202a0fac70d0bd6a19666d5b2f13c71cddf7}{TLS\_ALERT\_LEVEL\_WARNING},
87                \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba56784a4dc959a7fade003bb296584f15}{TLS\_ALERT\_NO\_CERTIFICATE});
88          \}
89          \textcolor{keywordflow}{else}
90 \textcolor{preprocessor}{#endif}
91          \{
92             \textcolor{comment}{//Format Certificate message}
93             error = \hyperlink{tls__common_8c_a4dc3d3d81329b32858ef30a612cc8062}{tlsFormatCertificate}(context, message, &length);
94 
95             \textcolor{comment}{//Check status code}
96             \textcolor{keywordflow}{if}(!error)
97             \{
98                \textcolor{comment}{//Debug message}
99                \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Certificate message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      length);
100                \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
101 
102                \textcolor{comment}{//Send handshake message}
103                error = \hyperlink{tls__handshake_8c_ad729f5d4a23f051eebf844a6fe4964cd}{tlsSendHandshakeMessage}(context, message, length,
104                   \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bab621c6882cff8d5b59980875b6ce7cfc}{TLS\_TYPE\_CERTIFICATE});
105             \}
106          \}
107       \}
108    \}
109    \textcolor{keywordflow}{else}
110 \textcolor{preprocessor}{#endif}
111 \textcolor{preprocessor}{#if (TLS\_SERVER\_SUPPORT == ENABLED)}
112    \textcolor{comment}{//Server mode?}
113    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
114    \{
115       \textcolor{comment}{//The server must send a Certificate message whenever the agreed-upon}
116       \textcolor{comment}{//key exchange method uses certificates for authentication}
117       \textcolor{keywordflow}{if}(context->cert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
118       \{
119          \textcolor{comment}{//Format Certificate message}
120          error = \hyperlink{tls__common_8c_a4dc3d3d81329b32858ef30a612cc8062}{tlsFormatCertificate}(context, message, &length);
121 
122          \textcolor{comment}{//Check status code}
123          \textcolor{keywordflow}{if}(!error)
124          \{
125             \textcolor{comment}{//Debug message}
126             \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Certificate message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length
      );
127             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
128 
129             \textcolor{comment}{//Send handshake message}
130             error = \hyperlink{tls__handshake_8c_ad729f5d4a23f051eebf844a6fe4964cd}{tlsSendHandshakeMessage}(context, message, length,
131                \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9bab621c6882cff8d5b59980875b6ce7cfc}{TLS\_TYPE\_CERTIFICATE});
132          \}
133       \}
134    \}
135    \textcolor{keywordflow}{else}
136 \textcolor{preprocessor}{#endif}
137    \textcolor{comment}{//Unsupported mode of operation?}
138    \{
139       \textcolor{comment}{//Report an error}
140       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
141    \}
142 
143    \textcolor{comment}{//Check status code}
144    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} || error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK} || error == 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
145    \{
146       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
147       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
148       \{
149          \textcolor{comment}{//Check whether TLS operates as a client or a server}
150          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
151             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c}{TLS\_STATE\_CLIENT\_KEY\_EXCHANGE};
152          \textcolor{keywordflow}{else}
153             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da8ed746876fcd686d131f90d04809fd32}{TLS\_STATE\_SERVER\_KEY\_EXCHANGE};
154       \}
155       \textcolor{keywordflow}{else}
156       \{
157          \textcolor{comment}{//Check whether TLS operates as a client or a server}
158          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
159          \{
160             \textcolor{comment}{//Clients must send a CertificateVerify message whenever}
161             \textcolor{comment}{//authenticating via a certificate}
162             \textcolor{keywordflow}{if}(context->clientCertRequested)
163                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b}{TLS\_STATE\_CLIENT\_CERTIFICATE\_VERIFY};
164             \textcolor{keywordflow}{else}
165                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
166          \}
167          \textcolor{keywordflow}{else}
168          \{
169             \textcolor{comment}{//Servers must send a CertificateVerify message whenever}
170             \textcolor{comment}{//authenticating via a certificate}
171             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da21097ff5428ba2ba5b8be925fd42224b}{TLS\_STATE\_SERVER\_CERTIFICATE\_VERIFY};
172          \}
173       \}
174    \}
175 
176    \textcolor{comment}{//Return status code}
177    \textcolor{keywordflow}{return} error;
178 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_ad10693e5b3286d3df6fca1597c61201e}\label{tls__common_8c_ad10693e5b3286d3df6fca1597c61201e}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Send\+Certificate\+Verify@{tls\+Send\+Certificate\+Verify}}
\index{tls\+Send\+Certificate\+Verify@{tls\+Send\+Certificate\+Verify}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Send\+Certificate\+Verify()}{tlsSendCertificateVerify()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Send\+Certificate\+Verify (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send Certificate\+Verify message. 

The Certificate\+Verify message is used to provide explicit verification of a client certificate. This message is only sent following a client certificate that has signing capability


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 192 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
193 \{
194    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
195    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
196    \hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{TlsCertificateVerify} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
197 
198    \textcolor{comment}{//Initialize status code}
199    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
200 
201    \textcolor{comment}{//The CertificateVerify message is only sent following a client certificate}
202    \textcolor{comment}{//that has signing capability}
203    \textcolor{keywordflow}{if}(context->cert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
204    \{
205       \textcolor{comment}{//Check certificate type}
206       \textcolor{keywordflow}{if}(context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN} ||
207          context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN} ||
208          context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN} ||
209          context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN} ||
210          context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN} ||
211          context->cert->type == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN})
212       \{
213          \textcolor{comment}{//Point to the buffer where to format the message}
214          message = (\hyperlink{tls_8h_a25576ceaf7d7b705438f73f671fbcac4}{TlsCertificateVerify} *) (context->txBuffer + context->txBufferLen);
215 
216          \textcolor{comment}{//Format CertificateVerify message}
217          error = \hyperlink{tls__common_8c_abb74b69c218815c9727fa2c5e199b912}{tlsFormatCertificateVerify}(context, message, &length);
218 
219          \textcolor{comment}{//Check status code}
220          \textcolor{keywordflow}{if}(!error)
221          \{
222             \textcolor{comment}{//Debug message}
223             \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending CertificateVerify message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      length);
224             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
225 
226             \textcolor{comment}{//Send handshake message}
227             error = \hyperlink{tls__handshake_8c_ad729f5d4a23f051eebf844a6fe4964cd}{tlsSendHandshakeMessage}(context, message, length,
228                \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9ba43d7fd238682404358c9831b0048aa18}{TLS\_TYPE\_CERTIFICATE\_VERIFY});
229          \}
230       \}
231    \}
232 
233    \textcolor{comment}{//Check status code}
234    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} || error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK} || error == 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
235    \{
236       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
237       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
238       \{
239          \textcolor{comment}{//Send a ChangeCipherSpec message to the server}
240          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC};
241       \}
242       \textcolor{keywordflow}{else}
243       \{
244          \textcolor{comment}{//Send a Finished message to the peer}
245          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
246             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
247          \textcolor{keywordflow}{else}
248             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED};
249       \}
250    \}
251 
252    \textcolor{comment}{//Return status code}
253    \textcolor{keywordflow}{return} error;
254 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a4a916411e28b77ed86195f311ebebb4b}\label{tls__common_8c_a4a916411e28b77ed86195f311ebebb4b}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Send\+Change\+Cipher\+Spec@{tls\+Send\+Change\+Cipher\+Spec}}
\index{tls\+Send\+Change\+Cipher\+Spec@{tls\+Send\+Change\+Cipher\+Spec}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Send\+Change\+Cipher\+Spec()}{tlsSendChangeCipherSpec()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Send\+Change\+Cipher\+Spec (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send Change\+Cipher\+Spec message. 

The change cipher spec message is sent by both the client and the server to notify the receiving party that subsequent records will be protected under the newly negotiated Cipher\+Spec and keys


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 268 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
269 \{
270    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
271    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
272    \hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{TlsChangeCipherSpec} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
273 
274    \textcolor{comment}{//Point to the buffer where to format the message}
275    message = (\hyperlink{tls_8h_a589c515096324e0d72dbaf58631c0501}{TlsChangeCipherSpec} *) (context->txBuffer + context->txBufferLen);
276 
277    \textcolor{comment}{//Format ChangeCipherSpec message}
278    error = \hyperlink{tls__common_8c_aa7ee11d8f87308e4f216dd7ed291897f}{tlsFormatChangeCipherSpec}(context, message, &length);
279 
280    \textcolor{comment}{//Check status code}
281    \textcolor{keywordflow}{if}(!error)
282    \{
283       \textcolor{comment}{//Debug message}
284       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending ChangeCipherSpec message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length)
      ;
285       \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
286 
287 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
288       \textcolor{comment}{//DTLS protocol?}
289       \textcolor{keywordflow}{if}(context->transportProtocol == \hyperlink{tls_8h_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92}{TLS\_TRANSPORT\_PROTOCOL\_DATAGRAM})
290       \{
291          \textcolor{comment}{//Send ChangeCipherSpec message}
292          error = \hyperlink{dtls__record_8c_ab15a3a01b2765ebf23f0fc72f1405f92}{dtlsWriteProtocolData}(context, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message,
293             length, \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca4a02e9d014afd5e75b90deefd3e5428c}{TLS\_TYPE\_CHANGE\_CIPHER\_SPEC});
294       \}
295       \textcolor{keywordflow}{else}
296 \textcolor{preprocessor}{#endif}
297       \textcolor{comment}{//TLS protocol?}
298       \{
299          \textcolor{comment}{//Send ChangeCipherSpec message}
300          error = \hyperlink{tls__record_8c_ae8f8c035d23eb99d1d5642d4ce644715}{tlsWriteProtocolData}(context, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message,
301             length, \hyperlink{tls_8h_a6fad1efb9f011dc3f76039976bef896ca4a02e9d014afd5e75b90deefd3e5428c}{TLS\_TYPE\_CHANGE\_CIPHER\_SPEC});
302       \}
303    \}
304 
305    \textcolor{comment}{//Check status code}
306    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} || error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK} || error == 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
307    \{
308       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
309       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
310       \{
311 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
312          \textcolor{comment}{//Release previous encryption engine first}
313          \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->prevEncryptionEngine);
314 
315          \textcolor{comment}{//Save current encryption engine for later use}
316          context->prevEncryptionEngine = context->encryptionEngine;
317          \textcolor{comment}{//Clear current encryption engine}
318          memset(&context->encryptionEngine, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTlsEncryptionEngine}{TlsEncryptionEngine}));
319 \textcolor{preprocessor}{#else}
320          \textcolor{comment}{//Release encryption engine first}
321          \hyperlink{tls__misc_8c_a4b2ee57846957d64f8cae5cd6408f3fc}{tlsFreeEncryptionEngine}(&context->encryptionEngine);
322 \textcolor{preprocessor}{#endif}
323 
324          \textcolor{comment}{//Inform the record layer that subsequent records will be protected}
325          \textcolor{comment}{//under the newly negotiated encryption algorithm}
326          error = \hyperlink{tls__misc_8c_a4162f3ce7f2e32575f8f6a011b8502ce}{tlsInitEncryptionEngine}(context, &context->encryptionEngine,
327             context->entity, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
328 
329          \textcolor{comment}{//Check status code}
330          \textcolor{keywordflow}{if}(!error)
331          \{
332             \textcolor{comment}{//Send a Finished message to the peer}
333             \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
334                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da3cb415075672864bb35731a372a18fbd}{TLS\_STATE\_CLIENT\_FINISHED};
335             \textcolor{keywordflow}{else}
336                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4638034a43094f0a8409cc8f0163d23b}{TLS\_STATE\_SERVER\_FINISHED};
337          \}
338       \}
339       \textcolor{keywordflow}{else}
340       \{
341 \textcolor{preprocessor}{#if (TLS13\_MIDDLEBOX\_COMPAT\_SUPPORT == ENABLED)}
342          \textcolor{comment}{//The middlebox compatibility mode improves the chance of successfully}
343          \textcolor{comment}{//connecting through middleboxes}
344          \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC} ||
345             context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da2064050523f96771d69ecb8fe15ff8f7}{TLS\_STATE\_SERVER\_CHANGE\_CIPHER\_SPEC\_2})
346          \{
347             \textcolor{comment}{//The client can send its second flight}
348             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d}{TLS\_STATE\_CLIENT\_HELLO\_2};
349          \}
350          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0}{TLS\_STATE\_SERVER\_CHANGE\_CIPHER\_SPEC} 
      ||
351             context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da9e601264440c96a1e68763e9b0e5761a}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC\_2})
352          \{
353             \textcolor{comment}{//All handshake messages after the ServerHello are now encrypted}
354             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daeb443224abb7649fc9e8adf3e51864a2}{TLS\_STATE\_HANDSHAKE\_TRAFFIC\_KEYS};
355          \}
356          \textcolor{keywordflow}{else}
357 \textcolor{preprocessor}{#endif}
358          \{
359             \textcolor{comment}{//Middlebox compatibility mode is not implemented}
360             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac17950207f5a741c1f2a1f5edb64c22e}{ERROR\_UNEXPECTED\_STATE};
361          \}
362       \}
363    \}
364 
365    \textcolor{comment}{//Return status code}
366    \textcolor{keywordflow}{return} error;
367 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__common_8c_a6830d5e2c36cf6293e93369370d8e4c2}\label{tls__common_8c_a6830d5e2c36cf6293e93369370d8e4c2}} 
\index{tls\+\_\+common.\+c@{tls\+\_\+common.\+c}!tls\+Send\+Finished@{tls\+Send\+Finished}}
\index{tls\+Send\+Finished@{tls\+Send\+Finished}!tls\+\_\+common.\+c@{tls\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{tls\+Send\+Finished()}{tlsSendFinished()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Send\+Finished (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send Finished message. 

A Finished message is always sent immediately after a change cipher spec message to verify that the key exchange and authentication processes were successful. It is essential that a change cipher spec message be received between the other handshake messages and the Finished message


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 383 of file tls\+\_\+common.\+c.


\begin{DoxyCode}
384 \{
385    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
386    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
387    \hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{TlsFinished} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
388 
389    \textcolor{comment}{//Point to the buffer where to format the message}
390    message = (\hyperlink{tls_8h_a5d4444c4e84d35423b8c7dfaa042c9f1}{TlsFinished} *) (context->txBuffer + context->txBufferLen);
391 
392    \textcolor{comment}{//Check whether TLS operates as a client or a server}
393    \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
394    \{
395       \textcolor{comment}{//The verify data is generated from all messages in this handshake}
396       \textcolor{comment}{//up to but not including the Finished message}
397       error = \hyperlink{tls__transcript__hash_8c_a2cbaa8d948e71f9a3ec07a3a78cff0a9}{tlsComputeVerifyData}(context, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT},
398          context->clientVerifyData, &context->clientVerifyDataLen);
399    \}
400    \textcolor{keywordflow}{else}
401    \{
402       \textcolor{comment}{//The verify data is generated from all messages in this handshake}
403       \textcolor{comment}{//up to but not including the Finished message}
404       error = \hyperlink{tls__transcript__hash_8c_a2cbaa8d948e71f9a3ec07a3a78cff0a9}{tlsComputeVerifyData}(context, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER},
405          context->serverVerifyData, &context->serverVerifyDataLen);
406    \}
407 
408    \textcolor{comment}{//Check status code}
409    \textcolor{keywordflow}{if}(!error)
410    \{
411       \textcolor{comment}{//Format Finished message}
412       error = \hyperlink{tls__common_8c_a1a3dfb06aefb89631e1f1b4cff0e57b6}{tlsFormatFinished}(context, message, &length);
413    \}
414 
415    \textcolor{comment}{//Check status code}
416    \textcolor{keywordflow}{if}(!error)
417    \{
418       \textcolor{comment}{//Debug message}
419       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Finished message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
420       \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, message, length);
421 
422       \textcolor{comment}{//Send handshake message}
423       error = \hyperlink{tls__handshake_8c_ad729f5d4a23f051eebf844a6fe4964cd}{tlsSendHandshakeMessage}(context, message, length,
424          \hyperlink{tls_8h_aea257240929f03e1e6ea3c7ab65ddb9baa70dd3c1f4f49e708201d020a2125b9f}{TLS\_TYPE\_FINISHED});
425    \}
426 
427    \textcolor{comment}{//Check status code}
428    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} || error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK} || error == 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
429    \{
430       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
431       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
432       \{
433          \textcolor{comment}{//Check whether TLS operates as a client or a server}
434          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
435          \{
436             \textcolor{comment}{//Abbreviated or full handshake?}
437             \textcolor{keywordflow}{if}(context->resume)
438                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA};
439             \textcolor{keywordflow}{else}
440                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0}{TLS\_STATE\_SERVER\_CHANGE\_CIPHER\_SPEC};
441          \}
442          \textcolor{keywordflow}{else}
443          \{
444             \textcolor{comment}{//Abbreviated or full handshake?}
445             \textcolor{keywordflow}{if}(context->resume)
446                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b}{TLS\_STATE\_CLIENT\_CHANGE\_CIPHER\_SPEC};
447             \textcolor{keywordflow}{else}
448                context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b}{TLS\_STATE\_APPLICATION\_DATA};
449          \}
450       \}
451       \textcolor{keywordflow}{else}
452       \{
453          \textcolor{comment}{//Check whether TLS operates as a client or a server}
454          \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
455          \{
456             \textcolor{comment}{//Compute client application traffic keys}
457             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da429690fe1b1bd88bcc256dc5ec811448}{TLS\_STATE\_CLIENT\_APP\_TRAFFIC\_KEYS};
458          \}
459          \textcolor{keywordflow}{else}
460          \{
461             \textcolor{comment}{//Compute server application traffic keys}
462             context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da4540b72ab65fe29516e8148fbb43261d}{TLS\_STATE\_SERVER\_APP\_TRAFFIC\_KEYS};
463          \}
464       \}
465    \}
466 
467    \textcolor{comment}{//Return status code}
468    \textcolor{keywordflow}{return} error;
469 \}
\end{DoxyCode}
