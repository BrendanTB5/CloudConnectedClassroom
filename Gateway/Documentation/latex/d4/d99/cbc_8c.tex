\hypertarget{cbc_8c}{}\section{cyclone\+\_\+crypto/cipher\+\_\+mode/cbc.c File Reference}
\label{cbc_8c}\index{cyclone\+\_\+crypto/cipher\+\_\+mode/cbc.\+c@{cyclone\+\_\+crypto/cipher\+\_\+mode/cbc.\+c}}


Cipher Block Chaining (C\+BC) mode.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cipher\+\_\+mode/cbc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{cbc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{cbc_8c_a51d0daca289df7143bfb16726b27e281}{cbc\+Encrypt} (const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, void $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em C\+BC encryption. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{cbc_8c_a840b0b9b34ed3e5d7a3ccb85487896de}{cbc\+Decrypt} (const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, void $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em C\+BC decryption. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Cipher Block Chaining (C\+BC) mode. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
The Cipher Block Chaining (C\+BC) mode is a confidentiality mode whose encryption process features the combining of the plaintext blocks with the previous ciphertext blocks. The C\+BC mode requires an IV to combine with the first plaintext block. Refer to SP 800-\/38A for more details

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{cbc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{cbc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{cbc.\+c@{cbc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!cbc.\+c@{cbc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 39 of file cbc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{cbc_8c_a840b0b9b34ed3e5d7a3ccb85487896de}\label{cbc_8c_a840b0b9b34ed3e5d7a3ccb85487896de}} 
\index{cbc.\+c@{cbc.\+c}!cbc\+Decrypt@{cbc\+Decrypt}}
\index{cbc\+Decrypt@{cbc\+Decrypt}!cbc.\+c@{cbc.\+c}}
\subsubsection{\texorpdfstring{cbc\+Decrypt()}{cbcDecrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} cbc\+Decrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{void $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



C\+BC decryption. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cipher} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em context} & Cipher algorithm context \\
\hline
\mbox{\tt in,out}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em c} & Ciphertext to be decrypted \\
\hline
\mbox{\tt out}  & {\em p} & Plaintext resulting from the decryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be decrypted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 108 of file cbc.\+c.


\begin{DoxyCode}
110 \{
111    \textcolor{keywordtype}{size\_t} i;
112    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[16];
113 
114    \textcolor{comment}{//CBC mode operates in a block-by-block fashion}
115    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize})
116    \{
117       \textcolor{comment}{//Save input block}
118       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(t, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
119 
120       \textcolor{comment}{//Decrypt the current block}
121       cipher->\hyperlink{structCipherAlgo_a3023886b85aca88688456ed460a8576d}{decryptBlock}(context, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
122 
123       \textcolor{comment}{//XOR output block with IV contents}
124       \textcolor{keywordflow}{for}(i = 0; i < cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize}; i++)
125       \{
126          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}[i] ^= \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}[i];
127       \}
128 
129       \textcolor{comment}{//Update IV with input block contents}
130       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, t, cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
131 
132       \textcolor{comment}{//Next block}
133       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
134       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
135       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
136    \}
137 
138    \textcolor{comment}{//The ciphertext must be a multiple of the block size}
139    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
140       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
141 
142    \textcolor{comment}{//Successful encryption}
143    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
144 \}
\end{DoxyCode}
\mbox{\Hypertarget{cbc_8c_a51d0daca289df7143bfb16726b27e281}\label{cbc_8c_a51d0daca289df7143bfb16726b27e281}} 
\index{cbc.\+c@{cbc.\+c}!cbc\+Encrypt@{cbc\+Encrypt}}
\index{cbc\+Encrypt@{cbc\+Encrypt}!cbc.\+c@{cbc.\+c}}
\subsubsection{\texorpdfstring{cbc\+Encrypt()}{cbcEncrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} cbc\+Encrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{void $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



C\+BC encryption. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cipher} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em context} & Cipher algorithm context \\
\hline
\mbox{\tt in,out}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em p} & Plaintext to be encrypted \\
\hline
\mbox{\tt out}  & {\em c} & Ciphertext resulting from the encryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be encrypted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 61 of file cbc.\+c.


\begin{DoxyCode}
63 \{
64    \textcolor{keywordtype}{size\_t} i;
65 
66    \textcolor{comment}{//CBC mode operates in a block-by-block fashion}
67    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize})
68    \{
69       \textcolor{comment}{//XOR input block with IV contents}
70       \textcolor{keywordflow}{for}(i = 0; i < cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize}; i++)
71       \{
72          \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}[i] = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}[i] ^ \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}[i];
73       \}
74 
75       \textcolor{comment}{//Encrypt the current block based upon the output}
76       \textcolor{comment}{//of the previous encryption}
77       cipher->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c});
78 
79       \textcolor{comment}{//Update IV with output block contents}
80       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
81 
82       \textcolor{comment}{//Next block}
83       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
84       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
85       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= cipher->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize};
86    \}
87 
88    \textcolor{comment}{//The plaintext must be a multiple of the block size}
89    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
90       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
91 
92    \textcolor{comment}{//Successful encryption}
93    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
94 \}
\end{DoxyCode}
