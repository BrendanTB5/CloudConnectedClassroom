\hypertarget{lan8742__driver_8c}{}\section{cyclone\+\_\+tcp/drivers/phy/lan8742\+\_\+driver.c File Reference}
\label{lan8742__driver_8c}\index{cyclone\+\_\+tcp/drivers/phy/lan8742\+\_\+driver.\+c@{cyclone\+\_\+tcp/drivers/phy/lan8742\+\_\+driver.\+c}}


L\+A\+N8742 Ethernet P\+HY transceiver.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}drivers/phy/lan8742\+\_\+driver.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{lan8742__driver_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a880f48968c7969b328d5061cd3db0f36}{N\+I\+C\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{lan8742__driver_8c_a224a395c5c43a5afa4bb39d16580fd32}{lan8742\+Init} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em L\+A\+N8742 P\+HY transceiver initialization. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_a133d4b0289ac8b69d1518133a4c75cd4}{lan8742\+Tick} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em L\+A\+N8742 timer handler. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_ae659d122f3e30a2e658869b894c7699e}{lan8742\+Enable\+Irq} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Enable interrupts. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_afb06e10c92d3d4b436762436b3e38a91}{lan8742\+Disable\+Irq} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Disable interrupts. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_a1e1d12b5e38fb54044f9512e57e242f2}{lan8742\+Event\+Handler} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em L\+A\+N8742 event handler. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}{lan8742\+Write\+Phy\+Reg} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ndp_8h_a1b452a6c3ab338d73213b321b6750f2b}{address}, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data})
\begin{DoxyCompactList}\small\item\em Write P\+HY register. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742\+Read\+Phy\+Reg} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ndp_8h_a1b452a6c3ab338d73213b321b6750f2b}{address})
\begin{DoxyCompactList}\small\item\em Read P\+HY register. \end{DoxyCompactList}\item 
void \hyperlink{lan8742__driver_8c_ac01763a4f355ab20153fa13a9b6da0f0}{lan8742\+Dump\+Phy\+Reg} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Dump P\+HY registers for debugging purpose. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \hyperlink{structPhyDriver}{Phy\+Driver} \hyperlink{lan8742__driver_8c_a919e45bda2910728fb70d3c1dfa1c30d}{lan8742\+Phy\+Driver}
\begin{DoxyCompactList}\small\item\em L\+A\+N8742 Ethernet P\+HY driver. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
L\+A\+N8742 Ethernet P\+HY transceiver. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{lan8742__driver_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{lan8742__driver_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a880f48968c7969b328d5061cd3db0f36}{N\+I\+C\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file lan8742\+\_\+driver.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{lan8742__driver_8c_afb06e10c92d3d4b436762436b3e38a91}\label{lan8742__driver_8c_afb06e10c92d3d4b436762436b3e38a91}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Disable\+Irq@{lan8742\+Disable\+Irq}}
\index{lan8742\+Disable\+Irq@{lan8742\+Disable\+Irq}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Disable\+Irq()}{lan8742DisableIrq()}}
{\footnotesize\ttfamily void lan8742\+Disable\+Irq (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Disable interrupts. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 171 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
172 \{
173    \textcolor{comment}{//Disable PHY transceiver interrupts}
174    \textcolor{keywordflow}{if}(interface->extIntDriver != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
175    \{
176       interface->extIntDriver->disableIrq();
177    \}
178 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_ac01763a4f355ab20153fa13a9b6da0f0}\label{lan8742__driver_8c_ac01763a4f355ab20153fa13a9b6da0f0}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Dump\+Phy\+Reg@{lan8742\+Dump\+Phy\+Reg}}
\index{lan8742\+Dump\+Phy\+Reg@{lan8742\+Dump\+Phy\+Reg}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Dump\+Phy\+Reg()}{lan8742DumpPhyReg()}}
{\footnotesize\ttfamily void lan8742\+Dump\+Phy\+Reg (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Dump P\+HY registers for debugging purpose. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 291 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
292 \{
293    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} i;
294 
295    \textcolor{comment}{//Loop through PHY registers}
296    \textcolor{keywordflow}{for}(i = 0; i < 32; i++)
297    \{
298       \textcolor{comment}{//Display current PHY register}
299       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{": 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, i,
300          \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, i));
301    \}
302 
303    \textcolor{comment}{//Terminate with a line feed}
304    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
305 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_ae659d122f3e30a2e658869b894c7699e}\label{lan8742__driver_8c_ae659d122f3e30a2e658869b894c7699e}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Enable\+Irq@{lan8742\+Enable\+Irq}}
\index{lan8742\+Enable\+Irq@{lan8742\+Enable\+Irq}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Enable\+Irq()}{lan8742EnableIrq()}}
{\footnotesize\ttfamily void lan8742\+Enable\+Irq (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Enable interrupts. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 156 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
157 \{
158    \textcolor{comment}{//Enable PHY transceiver interrupts}
159    \textcolor{keywordflow}{if}(interface->extIntDriver != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
160    \{
161       interface->extIntDriver->enableIrq();
162    \}
163 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_a1e1d12b5e38fb54044f9512e57e242f2}\label{lan8742__driver_8c_a1e1d12b5e38fb54044f9512e57e242f2}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Event\+Handler@{lan8742\+Event\+Handler}}
\index{lan8742\+Event\+Handler@{lan8742\+Event\+Handler}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Event\+Handler()}{lan8742EventHandler()}}
{\footnotesize\ttfamily void lan8742\+Event\+Handler (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



L\+A\+N8742 event handler. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 186 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
187 \{
188    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
189 
190    \textcolor{comment}{//Read status register to acknowledge the interrupt}
191    value = \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_a504dabf5f59df1f49516876a7dd55674}{LAN8742\_ISR});
192 
193    \textcolor{comment}{//Link status change?}
194    \textcolor{keywordflow}{if}(value & (\hyperlink{lan8742__driver_8h_ac2b7692484d24dbdb8a1b102e48aee59}{LAN8742\_IMR\_AN\_COMPLETE} | 
      \hyperlink{lan8742__driver_8h_af0d6e907d0a17079ec4891aff7ef401e}{LAN8742\_IMR\_LINK\_DOWN}))
195    \{
196       \textcolor{comment}{//Any link failure condition is latched in the BMSR register. Reading}
197       \textcolor{comment}{//the register twice will always return the actual link status}
198       value = \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_a7c844dd9bf572e95a6e62392a79144e2}{LAN8742\_BMSR});
199       value = \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_a7c844dd9bf572e95a6e62392a79144e2}{LAN8742\_BMSR});
200 
201       \textcolor{comment}{//Link is up?}
202       \textcolor{keywordflow}{if}(value & \hyperlink{lan8742__driver_8h_a44e56b48ad9e0d5b032c6113be2c1e62}{LAN8742\_BMSR\_LINK\_STATUS})
203       \{
204          \textcolor{comment}{//Read PHY special control/status register}
205          value = \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_aeade0994a6034e565af359e4ba6892cc}{LAN8742\_PSCSR});
206 
207          \textcolor{comment}{//Check current operation mode}
208          \textcolor{keywordflow}{switch}(value & \hyperlink{lan8742__driver_8h_aaf346eb89b26ad3c1f5047ae6080b2a0}{LAN8742\_PSCSR\_HCDSPEED})
209          \{
210          \textcolor{comment}{//10BASE-T half-duplex}
211          \textcolor{keywordflow}{case} \hyperlink{lan8742__driver_8h_aaba62d731ddcef3aa01c493655b9b7de}{LAN8742\_PSCSR\_HCDSPEED\_10BT\_HD}:
212             interface->linkSpeed = \hyperlink{nic_8h_afef666155a43e0a2a3a1f0df9e50bab4a43656b0244470a43d497c77353f3da84}{NIC\_LINK\_SPEED\_10MBPS};
213             interface->duplexMode = \hyperlink{nic_8h_ae96e77ca948a3796e2d1900a73f133daa60856f1c6ecbcb1227b653fb48205f41}{NIC\_HALF\_DUPLEX\_MODE};
214             \textcolor{keywordflow}{break};
215          \textcolor{comment}{//10BASE-T full-duplex}
216          \textcolor{keywordflow}{case} \hyperlink{lan8742__driver_8h_a9e3f1ea2685860df079c0d0aec334bd6}{LAN8742\_PSCSR\_HCDSPEED\_10BT\_FD}:
217             interface->linkSpeed = \hyperlink{nic_8h_afef666155a43e0a2a3a1f0df9e50bab4a43656b0244470a43d497c77353f3da84}{NIC\_LINK\_SPEED\_10MBPS};
218             interface->duplexMode = \hyperlink{nic_8h_ae96e77ca948a3796e2d1900a73f133daa2c75584234136d8fd79f372116d26340}{NIC\_FULL\_DUPLEX\_MODE};
219             \textcolor{keywordflow}{break};
220          \textcolor{comment}{//100BASE-TX half-duplex}
221          \textcolor{keywordflow}{case} \hyperlink{lan8742__driver_8h_a182bf9d88ce8a4c396a3337b74f9d6cd}{LAN8742\_PSCSR\_HCDSPEED\_100BTX\_HD}:
222             interface->linkSpeed = \hyperlink{nic_8h_afef666155a43e0a2a3a1f0df9e50bab4a3001394d2b59b22c97f6957e07ca28fd}{NIC\_LINK\_SPEED\_100MBPS};
223             interface->duplexMode = \hyperlink{nic_8h_ae96e77ca948a3796e2d1900a73f133daa60856f1c6ecbcb1227b653fb48205f41}{NIC\_HALF\_DUPLEX\_MODE};
224             \textcolor{keywordflow}{break};
225          \textcolor{comment}{//100BASE-TX full-duplex}
226          \textcolor{keywordflow}{case} \hyperlink{lan8742__driver_8h_a2541b9b2f1ddd451db093c8398a06443}{LAN8742\_PSCSR\_HCDSPEED\_100BTX\_FD}:
227             interface->linkSpeed = \hyperlink{nic_8h_afef666155a43e0a2a3a1f0df9e50bab4a3001394d2b59b22c97f6957e07ca28fd}{NIC\_LINK\_SPEED\_100MBPS};
228             interface->duplexMode = \hyperlink{nic_8h_ae96e77ca948a3796e2d1900a73f133daa2c75584234136d8fd79f372116d26340}{NIC\_FULL\_DUPLEX\_MODE};
229             \textcolor{keywordflow}{break};
230          \textcolor{comment}{//Unknown operation mode}
231          \textcolor{keywordflow}{default}:
232             \textcolor{comment}{//Debug message}
233             \hyperlink{debug_8h_a72b9761add7486364dba449091cd2579}{TRACE\_WARNING}(\textcolor{stringliteral}{"Invalid operation mode!\(\backslash\)r\(\backslash\)n"});
234             \textcolor{keywordflow}{break};
235          \}
236 
237          \textcolor{comment}{//Update link state}
238          interface->linkState = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
239 
240          \textcolor{comment}{//Adjust MAC configuration parameters for proper operation}
241          interface->nicDriver->updateMacConfig(interface);
242       \}
243       \textcolor{keywordflow}{else}
244       \{
245          \textcolor{comment}{//Update link state}
246          interface->linkState = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
247       \}
248 
249       \textcolor{comment}{//Process link state change event}
250       \hyperlink{nic_8c_ae9054795c5d49a4db97396bf1d16b413}{nicNotifyLinkChange}(interface);
251    \}
252 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_a224a395c5c43a5afa4bb39d16580fd32}\label{lan8742__driver_8c_a224a395c5c43a5afa4bb39d16580fd32}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Init@{lan8742\+Init}}
\index{lan8742\+Init@{lan8742\+Init}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Init()}{lan8742Init()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} lan8742\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



L\+A\+N8742 P\+HY transceiver initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 62 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
63 \{
64    \textcolor{comment}{//Debug message}
65    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Initializing LAN8742...\(\backslash\)r\(\backslash\)n"});
66 
67    \textcolor{comment}{//Undefined PHY address?}
68    \textcolor{keywordflow}{if}(interface->phyAddr >= 32)
69    \{
70       \textcolor{comment}{//Use the default address}
71       interface->phyAddr = \hyperlink{lan8742__driver_8h_ab87df76779c8bb79a3771fb1c73cf270}{LAN8742\_PHY\_ADDR};
72    \}
73 
74    \textcolor{comment}{//Initialize external interrupt line driver}
75    \textcolor{keywordflow}{if}(interface->extIntDriver != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
76    \{
77       interface->extIntDriver->init();
78    \}
79 
80    \textcolor{comment}{//Reset PHY transceiver (soft reset)}
81    \hyperlink{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}{lan8742WritePhyReg}(interface, \hyperlink{lan8742__driver_8h_a96220837d655d513a0f9b7470e24e634}{LAN8742\_BMCR}, 
      \hyperlink{lan8742__driver_8h_abfabe7125577759bd18e052c6f678349}{LAN8742\_BMCR\_RESET});
82 
83    \textcolor{comment}{//Wait for the reset to complete}
84    \textcolor{keywordflow}{while}(\hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_a96220837d655d513a0f9b7470e24e634}{LAN8742\_BMCR}) & 
      \hyperlink{lan8742__driver_8h_abfabe7125577759bd18e052c6f678349}{LAN8742\_BMCR\_RESET})
85    \{
86    \}
87 
88    \textcolor{comment}{//Restore default auto-negotiation advertisement parameters}
89    \hyperlink{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}{lan8742WritePhyReg}(interface, \hyperlink{lan8742__driver_8h_abf156cd2ea636716b2e46350d59b900e}{LAN8742\_ANAR}, 
      \hyperlink{lan8742__driver_8h_adf3e6599d23e8c536b0edb286f9907a9}{LAN8742\_ANAR\_100BTX\_FD} |
90       \hyperlink{lan8742__driver_8h_aabbf9bbeaaff8593d114ed33109c3f0d}{LAN8742\_ANAR\_100BTX\_HD} | \hyperlink{lan8742__driver_8h_ad5ae356c548a70bedcfb018ed2bb38b9}{LAN8742\_ANAR\_10BT\_FD} | 
      \hyperlink{lan8742__driver_8h_a5917e729d6077dd4c4f9aacab5dc3934}{LAN8742\_ANAR\_10BT\_HD} |
91       \hyperlink{lan8742__driver_8h_a5e9b860c4deeca78181c68156645a9f5}{LAN8742\_ANAR\_SELECTOR\_DEFAULT});
92 
93    \textcolor{comment}{//Enable auto-negotiation}
94    \hyperlink{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}{lan8742WritePhyReg}(interface, \hyperlink{lan8742__driver_8h_a96220837d655d513a0f9b7470e24e634}{LAN8742\_BMCR}, 
      \hyperlink{lan8742__driver_8h_a76e74fff12b23ebbc771cdd333b6af95}{LAN8742\_BMCR\_AN\_EN});
95 
96    \textcolor{comment}{//Dump PHY registers for debugging purpose}
97    \hyperlink{lan8742__driver_8c_ac01763a4f355ab20153fa13a9b6da0f0}{lan8742DumpPhyReg}(interface);
98 
99    \textcolor{comment}{//The PHY will generate interrupts when link status changes are detected}
100    \hyperlink{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}{lan8742WritePhyReg}(interface, \hyperlink{lan8742__driver_8h_aea7c404134fcec09cbb074c7710f2f12}{LAN8742\_IMR}, 
      \hyperlink{lan8742__driver_8h_ac2b7692484d24dbdb8a1b102e48aee59}{LAN8742\_IMR\_AN\_COMPLETE} |
101       \hyperlink{lan8742__driver_8h_af0d6e907d0a17079ec4891aff7ef401e}{LAN8742\_IMR\_LINK\_DOWN});
102 
103    \textcolor{comment}{//Force the TCP/IP stack to poll the link state at startup}
104    interface->phyEvent = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
105    \textcolor{comment}{//Notify the TCP/IP stack of the event}
106    \hyperlink{os__port__chibios_8c_afc1d64fc90afbf03baecfa636bb99ff7}{osSetEvent}(&\hyperlink{net_8c_a4ad5a175123589d00e402e0c1c842fdc}{netEvent});
107 
108    \textcolor{comment}{//Successful initialization}
109    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
110 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}\label{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Read\+Phy\+Reg@{lan8742\+Read\+Phy\+Reg}}
\index{lan8742\+Read\+Phy\+Reg@{lan8742\+Read\+Phy\+Reg}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Read\+Phy\+Reg()}{lan8742ReadPhyReg()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} lan8742\+Read\+Phy\+Reg (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{address }\end{DoxyParamCaption})}



Read P\+HY register. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em address} & P\+HY register address \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Register value 
\end{DoxyReturn}


Definition at line 278 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
279 \{
280    \textcolor{comment}{//Read the specified PHY register}
281    \textcolor{keywordflow}{return} interface->nicDriver->readPhyReg(\hyperlink{nic_8h_acceb418bf1cbc9cf0483446cd1cb1e78}{SMI\_OPCODE\_READ},
282       interface->phyAddr, \hyperlink{dhcpv6__common_8h_aaee906fadd211e863c2e29a3690b25c4}{address});
283 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_a133d4b0289ac8b69d1518133a4c75cd4}\label{lan8742__driver_8c_a133d4b0289ac8b69d1518133a4c75cd4}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Tick@{lan8742\+Tick}}
\index{lan8742\+Tick@{lan8742\+Tick}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Tick()}{lan8742Tick()}}
{\footnotesize\ttfamily void lan8742\+Tick (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



L\+A\+N8742 timer handler. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 118 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
119 \{
120    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
121    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} linkState;
122 
123    \textcolor{comment}{//No external interrupt line driver?}
124    \textcolor{keywordflow}{if}(interface->extIntDriver == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
125    \{
126       \textcolor{comment}{//Read basic status register}
127       value = \hyperlink{lan8742__driver_8c_a2be65ac5d0f3101311e78b194cf9fc4d}{lan8742ReadPhyReg}(interface, \hyperlink{lan8742__driver_8h_a7c844dd9bf572e95a6e62392a79144e2}{LAN8742\_BMSR});
128       \textcolor{comment}{//Retrieve current link state}
129       linkState = (value & \hyperlink{lan8742__driver_8h_a44e56b48ad9e0d5b032c6113be2c1e62}{LAN8742\_BMSR\_LINK\_STATUS}) ? 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} : \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
130 
131       \textcolor{comment}{//Link up event?}
132       \textcolor{keywordflow}{if}(linkState && !interface->linkState)
133       \{
134          \textcolor{comment}{//Set event flag}
135          interface->phyEvent = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
136          \textcolor{comment}{//Notify the TCP/IP stack of the event}
137          \hyperlink{os__port__chibios_8c_afc1d64fc90afbf03baecfa636bb99ff7}{osSetEvent}(&\hyperlink{net_8c_a4ad5a175123589d00e402e0c1c842fdc}{netEvent});
138       \}
139       \textcolor{comment}{//Link down event?}
140       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!linkState && interface->linkState)
141       \{
142          \textcolor{comment}{//Set event flag}
143          interface->phyEvent = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
144          \textcolor{comment}{//Notify the TCP/IP stack of the event}
145          \hyperlink{os__port__chibios_8c_afc1d64fc90afbf03baecfa636bb99ff7}{osSetEvent}(&\hyperlink{net_8c_a4ad5a175123589d00e402e0c1c842fdc}{netEvent});
146       \}
147    \}
148 \}
\end{DoxyCode}
\mbox{\Hypertarget{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}\label{lan8742__driver_8c_a9e0899c399252fbca851eb15a2166c2a}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Write\+Phy\+Reg@{lan8742\+Write\+Phy\+Reg}}
\index{lan8742\+Write\+Phy\+Reg@{lan8742\+Write\+Phy\+Reg}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Write\+Phy\+Reg()}{lan8742WritePhyReg()}}
{\footnotesize\ttfamily void lan8742\+Write\+Phy\+Reg (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{address,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{data }\end{DoxyParamCaption})}



Write P\+HY register. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em address} & P\+HY register address \\
\hline
\mbox{\tt in}  & {\em data} & Register value \\
\hline
\end{DoxyParams}


Definition at line 262 of file lan8742\+\_\+driver.\+c.


\begin{DoxyCode}
264 \{
265    \textcolor{comment}{//Write the specified PHY register}
266    interface->nicDriver->writePhyReg(\hyperlink{nic_8h_a1fa0e7586e487646372c0f169c9ea786}{SMI\_OPCODE\_WRITE},
267       interface->phyAddr, \hyperlink{dhcpv6__common_8h_aaee906fadd211e863c2e29a3690b25c4}{address}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data});
268 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{lan8742__driver_8c_a919e45bda2910728fb70d3c1dfa1c30d}\label{lan8742__driver_8c_a919e45bda2910728fb70d3c1dfa1c30d}} 
\index{lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}!lan8742\+Phy\+Driver@{lan8742\+Phy\+Driver}}
\index{lan8742\+Phy\+Driver@{lan8742\+Phy\+Driver}!lan8742\+\_\+driver.\+c@{lan8742\+\_\+driver.\+c}}
\subsubsection{\texorpdfstring{lan8742\+Phy\+Driver}{lan8742PhyDriver}}
{\footnotesize\ttfamily const \hyperlink{structPhyDriver}{Phy\+Driver} lan8742\+Phy\+Driver}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=
\{
   \hyperlink{lan8742__driver_8c_a224a395c5c43a5afa4bb39d16580fd32}{lan8742Init},
   \hyperlink{lan8742__driver_8c_a133d4b0289ac8b69d1518133a4c75cd4}{lan8742Tick},
   \hyperlink{lan8742__driver_8c_ae659d122f3e30a2e658869b894c7699e}{lan8742EnableIrq},
   \hyperlink{lan8742__driver_8c_afb06e10c92d3d4b436762436b3e38a91}{lan8742DisableIrq},
   \hyperlink{lan8742__driver_8c_a1e1d12b5e38fb54044f9512e57e242f2}{lan8742EventHandler},
   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},
   NULL
\}
\end{DoxyCode}


L\+A\+N8742 Ethernet P\+HY driver. 



Definition at line 44 of file lan8742\+\_\+driver.\+c.

