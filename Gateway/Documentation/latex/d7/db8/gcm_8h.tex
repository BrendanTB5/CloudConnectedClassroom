\hypertarget{gcm_8h}{}\section{cyclone\+\_\+crypto/aead/gcm.h File Reference}
\label{gcm_8h}\index{cyclone\+\_\+crypto/aead/gcm.\+h@{cyclone\+\_\+crypto/aead/gcm.\+h}}


Galois/\+Counter Mode (G\+CM)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structGcmContext}{Gcm\+Context}
\begin{DoxyCompactList}\small\item\em G\+CM context. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gcm_8h_abc76ae24190694f6db77a7dc195072f9}{gcm\+Init} (\hyperlink{structGcmContext}{Gcm\+Context} $\ast$context, const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher\+Algo, void $\ast$cipher\+Context)
\begin{DoxyCompactList}\small\item\em Initialize G\+CM context. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gcm_8h_a2f5111c280fe4411127041f1c43d4346}{gcm\+Encrypt} (\hyperlink{structGcmContext}{Gcm\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, size\+\_\+t iv\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, size\+\_\+t a\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, size\+\_\+t t\+Len)
\begin{DoxyCompactList}\small\item\em Authenticated encryption using G\+CM. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gcm_8h_aa540a4a01d648db3457f3ab0d5c15601}{gcm\+Decrypt} (\hyperlink{structGcmContext}{Gcm\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, size\+\_\+t iv\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, size\+\_\+t a\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, size\+\_\+t t\+Len)
\begin{DoxyCompactList}\small\item\em Authenticated decryption using G\+CM. \end{DoxyCompactList}\item 
void \hyperlink{gcm_8h_a4902afa05ac8bd33baba48555b666d33}{gcm\+Mul} (\hyperlink{structGcmContext}{Gcm\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x)
\begin{DoxyCompactList}\small\item\em Multiplication operation in G\+F(2$^\wedge$128) \end{DoxyCompactList}\item 
void \hyperlink{gcm_8h_ae34e336ae8c1571d31fad11ba6045710}{gcm\+Xor\+Block} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b}, size\+\_\+t \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n})
\begin{DoxyCompactList}\small\item\em X\+OR operation. \end{DoxyCompactList}\item 
void \hyperlink{gcm_8h_af6cae3de2e85b6d416ab17f07da48cd8}{gcm\+Inc\+Counter} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x)
\begin{DoxyCompactList}\small\item\em Increment counter block. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Galois/\+Counter Mode (G\+CM) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{gcm_8h_aa540a4a01d648db3457f3ab0d5c15601}\label{gcm_8h_aa540a4a01d648db3457f3ab0d5c15601}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Decrypt@{gcm\+Decrypt}}
\index{gcm\+Decrypt@{gcm\+Decrypt}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Decrypt()}{gcmDecrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gcm\+Decrypt (\begin{DoxyParamCaption}\item[{\hyperlink{structGcmContext}{Gcm\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{size\+\_\+t}]{iv\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{size\+\_\+t}]{a\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{size\+\_\+t}]{t\+Len }\end{DoxyParamCaption})}



Authenticated decryption using G\+CM. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+CM context \\
\hline
\mbox{\tt in}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em iv\+Len} & Length of the initialization vector \\
\hline
\mbox{\tt in}  & {\em a} & Additional authenticated data \\
\hline
\mbox{\tt in}  & {\em a\+Len} & Length of the additional data \\
\hline
\mbox{\tt in}  & {\em c} & Ciphertext to be decrypted \\
\hline
\mbox{\tt out}  & {\em p} & Plaintext resulting from the decryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be decrypted \\
\hline
\mbox{\tt in}  & {\em t} & Authentication tag \\
\hline
\mbox{\tt in}  & {\em t\+Len} & Length of the authentication tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}
Make sure the G\+CM context is valid 

Definition at line 337 of file gcm.\+c.


\begin{DoxyCode}
340 \{
341    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{web__socket_8h_a8a74907784be6c7786c2d060c8d7e10b}{mask};
342    \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
343    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
344    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[16];
345    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} j[16];
346    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{gcm_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[16];
347    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{md2_8c_adf356ff381033f761b7de5f76e763a45}{s}[16];
348 
350    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
351       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
352 
353    \textcolor{comment}{//The length of the IV shall meet SP 800-38D requirements}
354    \textcolor{keywordflow}{if}(ivLen < 1)
355       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
356 
357    \textcolor{comment}{//Check the length of the authentication tag}
358    \textcolor{keywordflow}{if}(tLen < 4 || tLen > 16)
359       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
360 
361    \textcolor{comment}{//Check whether the length of the IV is 96 bits}
362    \textcolor{keywordflow}{if}(ivLen == 12)
363    \{
364       \textcolor{comment}{//When the length of the IV is 96 bits, the padding string is appended}
365       \textcolor{comment}{//to the IV to form the pre-counter block}
366       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, 12);
367       \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(1, j + 12);
368    \}
369    \textcolor{keywordflow}{else}
370    \{
371       \textcolor{comment}{//Initialize GHASH calculation}
372       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(j, 0, 16);
373 
374       \textcolor{comment}{//Length of the IV}
375       n = ivLen;
376 
377       \textcolor{comment}{//Process the initialization vector}
378       \textcolor{keywordflow}{while}(n > 0)
379       \{
380          \textcolor{comment}{//The IV processed in a block-by-block fashion}
381          k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
382 
383          \textcolor{comment}{//Apply GHASH function}
384          \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(j, j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, k);
385          \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, j);
386 
387          \textcolor{comment}{//Next block}
388          \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
389          n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
390       \}
391 
392       \textcolor{comment}{//The string is appended with 64 additional 0 bits, followed by the}
393       \textcolor{comment}{//64-bit representation of the length of the IV}
394       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(b, 0, 8);
395       \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(ivLen * 8, b + 8);
396 
397       \textcolor{comment}{//The GHASH function is applied to the resulting string to form the}
398       \textcolor{comment}{//pre-counter block}
399       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(j, j, b, 16);
400       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, j);
401    \}
402 
403    \textcolor{comment}{//Compute MSB(CIPH(J(0)))}
404    context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext}, j, b);
405    \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(r, b, tLen);
406 
407    \textcolor{comment}{//Initialize GHASH calculation}
408    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(s, 0, 16);
409    \textcolor{comment}{//Length of the AAD}
410    n = aLen;
411 
412    \textcolor{comment}{//Process AAD}
413    \textcolor{keywordflow}{while}(n > 0)
414    \{
415       \textcolor{comment}{//Additional data are processed in a block-by-block fashion}
416       k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
417 
418       \textcolor{comment}{//Apply GHASH function}
419       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, k);
420       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
421 
422       \textcolor{comment}{//Next block}
423       \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
424       n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
425    \}
426 
427    \textcolor{comment}{//Length of the ciphertext}
428    n = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
429 
430    \textcolor{comment}{//Process ciphertext}
431    \textcolor{keywordflow}{while}(n > 0)
432    \{
433       \textcolor{comment}{//The decryption operates in a block-by-block fashion}
434       k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
435 
436       \textcolor{comment}{//Apply GHASH function}
437       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, k);
438       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
439 
440       \textcolor{comment}{//Increment counter}
441       \hyperlink{gcm_8c_af6cae3de2e85b6d416ab17f07da48cd8}{gcmIncCounter}(j);
442 
443       \textcolor{comment}{//Decrypt ciphertext}
444       context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext}, j, b);
445       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, b, k);
446 
447       \textcolor{comment}{//Next block}
448       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
449       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
450       n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
451    \}
452 
453    \textcolor{comment}{//Append the 64-bit representation of the length of the AAD and the}
454    \textcolor{comment}{//ciphertext}
455    \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(aLen * 8, b);
456    \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} * 8, b + 8);
457 
458    \textcolor{comment}{//The GHASH function is applied to the result to produce a single output}
459    \textcolor{comment}{//block S}
460    \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, b, 16);
461    \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
462 
463    \textcolor{comment}{//Let R = MSB(GCTR(J(0), S))}
464    \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(r, r, s, tLen);
465 
466    \textcolor{comment}{//The calculated tag is bitwise compared to the received tag. The message}
467    \textcolor{comment}{//is authenticated if and only if the tags match}
468    \textcolor{keywordflow}{for}(mask = 0, n = 0; n < tLen; n++)
469    \{
470       mask |= r[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] ^ \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}];
471    \}
472 
473    \textcolor{comment}{//Return status code}
474    \textcolor{keywordflow}{return} (mask == 0) ? \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} : \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
475 \}
\end{DoxyCode}
\mbox{\Hypertarget{gcm_8h_a2f5111c280fe4411127041f1c43d4346}\label{gcm_8h_a2f5111c280fe4411127041f1c43d4346}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Encrypt@{gcm\+Encrypt}}
\index{gcm\+Encrypt@{gcm\+Encrypt}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Encrypt()}{gcmEncrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gcm\+Encrypt (\begin{DoxyParamCaption}\item[{\hyperlink{structGcmContext}{Gcm\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{size\+\_\+t}]{iv\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{size\+\_\+t}]{a\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{size\+\_\+t}]{t\+Len }\end{DoxyParamCaption})}



Authenticated encryption using G\+CM. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+CM context \\
\hline
\mbox{\tt in}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em iv\+Len} & Length of the initialization vector \\
\hline
\mbox{\tt in}  & {\em a} & Additional authenticated data \\
\hline
\mbox{\tt in}  & {\em a\+Len} & Length of the additional data \\
\hline
\mbox{\tt in}  & {\em p} & Plaintext to be encrypted \\
\hline
\mbox{\tt out}  & {\em c} & Ciphertext resulting from the encryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be encrypted \\
\hline
\mbox{\tt out}  & {\em t} & Authentication tag \\
\hline
\mbox{\tt in}  & {\em t\+Len} & Length of the authentication tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 190 of file gcm.\+c.


\begin{DoxyCode}
193 \{
194    \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
195    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
196    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[16];
197    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} j[16];
198    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{md2_8c_adf356ff381033f761b7de5f76e763a45}{s}[16];
199 
200    \textcolor{comment}{//Make sure the GCM context is valid}
201    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
202       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
203 
204    \textcolor{comment}{//The length of the IV shall meet SP 800-38D requirements}
205    \textcolor{keywordflow}{if}(ivLen < 1)
206       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
207 
208    \textcolor{comment}{//Check the length of the authentication tag}
209    \textcolor{keywordflow}{if}(tLen < 4 || tLen > 16)
210       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
211 
212    \textcolor{comment}{//Check whether the length of the IV is 96 bits}
213    \textcolor{keywordflow}{if}(ivLen == 12)
214    \{
215       \textcolor{comment}{//When the length of the IV is 96 bits, the padding string is appended}
216       \textcolor{comment}{//to the IV to form the pre-counter block}
217       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, 12);
218       \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(1, j + 12);
219    \}
220    \textcolor{keywordflow}{else}
221    \{
222       \textcolor{comment}{//Initialize GHASH calculation}
223       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(j, 0, 16);
224 
225       \textcolor{comment}{//Length of the IV}
226       n = ivLen;
227 
228       \textcolor{comment}{//Process the initialization vector}
229       \textcolor{keywordflow}{while}(n > 0)
230       \{
231          \textcolor{comment}{//The IV processed in a block-by-block fashion}
232          k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
233 
234          \textcolor{comment}{//Apply GHASH function}
235          \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(j, j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, k);
236          \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, j);
237 
238          \textcolor{comment}{//Next block}
239          \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
240          n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
241       \}
242 
243       \textcolor{comment}{//The string is appended with 64 additional 0 bits, followed by the}
244       \textcolor{comment}{//64-bit representation of the length of the IV}
245       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(b, 0, 8);
246       \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(ivLen * 8, b + 8);
247 
248       \textcolor{comment}{//The GHASH function is applied to the resulting string to form the}
249       \textcolor{comment}{//pre-counter block}
250       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(j, j, b, 16);
251       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, j);
252    \}
253 
254    \textcolor{comment}{//Compute MSB(CIPH(J(0)))}
255    context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext}, j, b);
256    \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, b, tLen);
257 
258    \textcolor{comment}{//Initialize GHASH calculation}
259    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(s, 0, 16);
260    \textcolor{comment}{//Length of the AAD}
261    n = aLen;
262 
263    \textcolor{comment}{//Process AAD}
264    \textcolor{keywordflow}{while}(n > 0)
265    \{
266       \textcolor{comment}{//Additional data are processed in a block-by-block fashion}
267       k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
268 
269       \textcolor{comment}{//Apply GHASH function}
270       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, k);
271       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
272 
273       \textcolor{comment}{//Next block}
274       \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
275       n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
276    \}
277 
278    \textcolor{comment}{//Length of the plaintext}
279    n = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
280 
281    \textcolor{comment}{//Process plaintext}
282    \textcolor{keywordflow}{while}(n > 0)
283    \{
284       \textcolor{comment}{//The encryption operates in a block-by-block fashion}
285       k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
286 
287       \textcolor{comment}{//Increment counter}
288       \hyperlink{gcm_8c_af6cae3de2e85b6d416ab17f07da48cd8}{gcmIncCounter}(j);
289 
290       \textcolor{comment}{//Encrypt plaintext}
291       context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext}, j, b);
292       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, b, k);
293 
294       \textcolor{comment}{//Apply GHASH function}
295       \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, k);
296       \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
297 
298       \textcolor{comment}{//Next block}
299       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
300       \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
301       n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
302    \}
303 
304    \textcolor{comment}{//Append the 64-bit representation of the length of the AAD and the}
305    \textcolor{comment}{//ciphertext}
306    \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(aLen * 8, b);
307    \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} * 8, b + 8);
308 
309    \textcolor{comment}{//The GHASH function is applied to the result to produce a single output}
310    \textcolor{comment}{//block S}
311    \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(s, s, b, 16);
312    \hyperlink{gcm_8c_a4902afa05ac8bd33baba48555b666d33}{gcmMul}(context, s);
313 
314    \textcolor{comment}{//Let T = MSB(GCTR(J(0), S)}
315    \hyperlink{gcm_8c_ae34e336ae8c1571d31fad11ba6045710}{gcmXorBlock}(\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, s, tLen);
316 
317    \textcolor{comment}{//Successful encryption}
318    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
319 \}
\end{DoxyCode}
\mbox{\Hypertarget{gcm_8h_af6cae3de2e85b6d416ab17f07da48cd8}\label{gcm_8h_af6cae3de2e85b6d416ab17f07da48cd8}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Inc\+Counter@{gcm\+Inc\+Counter}}
\index{gcm\+Inc\+Counter@{gcm\+Inc\+Counter}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Inc\+Counter()}{gcmIncCounter()}}
{\footnotesize\ttfamily void gcm\+Inc\+Counter (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x }\end{DoxyParamCaption})}



Increment counter block. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em x} & Pointer to the counter block \\
\hline
\end{DoxyParams}


Definition at line 570 of file gcm.\+c.


\begin{DoxyCode}
571 \{
572    \textcolor{keywordtype}{size\_t} i;
573 
574    \textcolor{comment}{//The function increments the right-most 32 bits of the block. The remaining}
575    \textcolor{comment}{//left-most 96 bits remain unchanged}
576    \textcolor{keywordflow}{for}(i = 0; i < 4; i++)
577    \{
578       \textcolor{comment}{//Increment the current byte and propagate the carry if necessary}
579       \textcolor{keywordflow}{if}(++(x[15 - i]) != 0)
580       \{
581          \textcolor{keywordflow}{break};
582       \}
583    \}
584 \}
\end{DoxyCode}
\mbox{\Hypertarget{gcm_8h_abc76ae24190694f6db77a7dc195072f9}\label{gcm_8h_abc76ae24190694f6db77a7dc195072f9}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Init@{gcm\+Init}}
\index{gcm\+Init@{gcm\+Init}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Init()}{gcmInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gcm\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structGcmContext}{Gcm\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher\+Algo,  }\item[{void $\ast$}]{cipher\+Context }\end{DoxyParamCaption})}



Initialize G\+CM context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+CM context \\
\hline
\mbox{\tt in}  & {\em cipher\+Algo} & Cipher algorithm \\
\hline
\mbox{\tt in}  & {\em cipher\+Context} & Pointer to the cipher algorithm context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 78 of file gcm.\+c.


\begin{DoxyCode}
80 \{
81    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
82    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
83    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
84    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{ndp_8h_a1f1dfeb2f802fe99f37fe91867b84456}{h}[4];
85 
86    \textcolor{comment}{//GCM supports only symmetric block ciphers whose block size is 128 bits}
87    \textcolor{keywordflow}{if}(cipherAlgo->\hyperlink{structCipherAlgo_a840c614fa1ae0f98a9350bc4f040dc7a}{type} != \hyperlink{cyclone__crypto_2core_2crypto_8h_ae03a6c8f32ed798857924d908aacc49bac347f6aa82618d4d57fe85cba6520ce9}{CIPHER\_ALGO\_TYPE\_BLOCK} || cipherAlgo->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} != 16)
88       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
89 
90    \textcolor{comment}{//Save cipher algorithm context}
91    context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo} = cipherAlgo;
92    context->\hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext} = cipherContext;
93 
94    \textcolor{comment}{//Let H = 0}
95    h[0] = 0;
96    h[1] = 0;
97    h[2] = 0;
98    h[3] = 0;
99 
100    \textcolor{comment}{//Generate the hash subkey H}
101    context->\hyperlink{structGcmContext_afa015f0dceedd8d55d07d615048edb3b}{cipherAlgo}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->
      \hyperlink{structGcmContext_aa5080560b185493361680b1b0a02c2ec}{cipherContext},
102       (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) h, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) h);
103 
104    \textcolor{comment}{//Pre-compute M(0) = H * 0}
105    j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(0);
106    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0] = 0;
107    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1] = 0;
108    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2] = 0;
109    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3] = 0;
110 
111    \textcolor{comment}{//Pre-compute M(1) = H * 1}
112    j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1);
113    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[3]);
114    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[2]);
115    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[1]);
116    context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[0]);
117 
118    \textcolor{comment}{//Pre-compute all 4-bit multiples of H}
119    \textcolor{keywordflow}{for}(i = 2; i < 16; i++)
120    \{
121       \textcolor{comment}{//Odd value?}
122       \textcolor{keywordflow}{if}(i & 1)
123       \{
124          \textcolor{comment}{//Compute M(i) = M(i - 1) + H}
125          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i - 1);
126          h[0] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0];
127          h[1] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1];
128          h[2] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2];
129          h[3] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3];
130 
131          \textcolor{comment}{//An addition in GF(2^128) is identical to a bitwise exclusive-OR}
132          \textcolor{comment}{//operation}
133          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1);
134          h[0] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0];
135          h[1] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1];
136          h[2] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2];
137          h[3] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3];
138       \}
139       \textcolor{comment}{//Even value?}
140       \textcolor{keywordflow}{else}
141       \{
142          \textcolor{comment}{//Compute M(i) = M(i / 2) * x}
143          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i / 2);
144          h[0] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0];
145          h[1] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1];
146          h[2] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2];
147          h[3] = context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3];
148 
149          \textcolor{comment}{//The multiplication of a polynomial by x in GF(2^128) corresponds}
150          \textcolor{comment}{//to a shift of indices}
151          c = h[0] & 0x01;
152          h[0] = (h[0] >> 1) | (h[1] << 31);
153          h[1] = (h[1] >> 1) | (h[2] << 31);
154          h[2] = (h[2] >> 1) | (h[3] << 31);
155          h[3] >>= 1;
156 
157          \textcolor{comment}{//If the highest term of the result is equal to one, then perform}
158          \textcolor{comment}{//reduction}
159          h[3] ^= \hyperlink{gcm_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1)] & ~(c - 1);
160       \}
161 
162       \textcolor{comment}{//Save M(i)}
163       j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i);
164       context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][0] = h[0];
165       context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][1] = h[1];
166       context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][2] = h[2];
167       context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[j][3] = h[3];
168    \}
169 
170    \textcolor{comment}{//Successful initialization}
171    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
172 \}
\end{DoxyCode}
\mbox{\Hypertarget{gcm_8h_a4902afa05ac8bd33baba48555b666d33}\label{gcm_8h_a4902afa05ac8bd33baba48555b666d33}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Mul@{gcm\+Mul}}
\index{gcm\+Mul@{gcm\+Mul}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Mul()}{gcmMul()}}
{\footnotesize\ttfamily void gcm\+Mul (\begin{DoxyParamCaption}\item[{\hyperlink{structGcmContext}{Gcm\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x }\end{DoxyParamCaption})}



Multiplication operation in G\+F(2$^\wedge$128) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+CM context \\
\hline
\mbox{\tt in,out}  & {\em x} & 16-\/byte block to be multiplied by H \\
\hline
\end{DoxyParams}


Definition at line 484 of file gcm.\+c.


\begin{DoxyCode}
485 \{
486    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} i;
487    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b};
488    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
489    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dns__common_8h_ab3539ae3820541b70d17c66cfc5a0e3f}{z}[4];
490 
491    \textcolor{comment}{//Let Z = 0}
492    z[0] = 0;
493    z[1] = 0;
494    z[2] = 0;
495    z[3] = 0;
496 
497    \textcolor{comment}{//Fast table-driven implementation}
498    \textcolor{keywordflow}{for}(i = 15; i >= 0; i--)
499    \{
500       \textcolor{comment}{//Get the lower nibble}
501       b = x[i] & 0x0F;
502 
503       \textcolor{comment}{//Multiply 4 bits at a time}
504       c = z[0] & 0x0F;
505       z[0] = (z[0] >> 4) | (z[1] << 28);
506       z[1] = (z[1] >> 4) | (z[2] << 28);
507       z[2] = (z[2] >> 4) | (z[3] << 28);
508       z[3] >>= 4;
509 
510       z[0] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][0];
511       z[1] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][1];
512       z[2] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][2];
513       z[3] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][3];
514 
515       \textcolor{comment}{//Perform reduction}
516       z[3] ^= \hyperlink{gcm_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
517 
518       \textcolor{comment}{//Get the upper nibble}
519       b = (x[i] >> 4) & 0x0F;
520 
521       \textcolor{comment}{//Multiply 4 bits at a time}
522       c = z[0] & 0x0F;
523       z[0] = (z[0] >> 4) | (z[1] << 28);
524       z[1] = (z[1] >> 4) | (z[2] << 28);
525       z[2] = (z[2] >> 4) | (z[3] << 28);
526       z[3] >>= 4;
527 
528       z[0] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][0];
529       z[1] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][1];
530       z[2] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][2];
531       z[3] ^= context->\hyperlink{structGcmContext_af5ec6bf9a36e7a98a7645517d8b77733}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][3];
532 
533       \textcolor{comment}{//Perform reduction}
534       z[3] ^= \hyperlink{gcm_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
535    \}
536 
537    \textcolor{comment}{//Save the result}
538    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[3], x);
539    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[2], x + 4);
540    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[1], x + 8);
541    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[0], x + 12);
542 \}
\end{DoxyCode}
\mbox{\Hypertarget{gcm_8h_ae34e336ae8c1571d31fad11ba6045710}\label{gcm_8h_ae34e336ae8c1571d31fad11ba6045710}} 
\index{gcm.\+h@{gcm.\+h}!gcm\+Xor\+Block@{gcm\+Xor\+Block}}
\index{gcm\+Xor\+Block@{gcm\+Xor\+Block}!gcm.\+h@{gcm.\+h}}
\subsubsection{\texorpdfstring{gcm\+Xor\+Block()}{gcmXorBlock()}}
{\footnotesize\ttfamily void gcm\+Xor\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b,  }\item[{size\+\_\+t}]{n }\end{DoxyParamCaption})}



X\+OR operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em x} & Block resulting from the X\+OR operation \\
\hline
\mbox{\tt in}  & {\em a} & First block \\
\hline
\mbox{\tt in}  & {\em b} & Second block \\
\hline
\mbox{\tt in}  & {\em n} & Size of the block \\
\hline
\end{DoxyParams}


Definition at line 553 of file gcm.\+c.


\begin{DoxyCode}
554 \{
555    \textcolor{keywordtype}{size\_t} i;
556 
557    \textcolor{comment}{//Perform XOR operation}
558    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
559    \{
560       x[i] = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i] ^ \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[i];
561    \}
562 \}
\end{DoxyCode}
