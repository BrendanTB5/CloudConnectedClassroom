\hypertarget{web__socket__auth_8c}{}\section{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+auth.c File Reference}
\label{web__socket__auth_8c}\index{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+auth.\+c@{cyclone\+\_\+tcp/web\+\_\+socket/web\+\_\+socket\+\_\+auth.\+c}}


H\+T\+TP authentication for Web\+Sockets.  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}web\+\_\+socket/web\+\_\+socket.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}web\+\_\+socket/web\+\_\+socket\+\_\+auth.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/base64.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}hash/md5.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{web__socket__auth_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a726918867be6caec18d98f3fc26813f9}{W\+E\+B\+\_\+\+S\+O\+C\+K\+E\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{web__socket__auth_8c_af798ae15658d57fb91fcc2dbe5f230de}{web\+Socket\+Parse\+Authenticate\+Field} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Parse W\+W\+W-\/\+Authenticate header field. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{web__socket__auth_8c_a8adbda0a7e2adcf9aeab2613ac830209}{web\+Socket\+Add\+Authorization\+Field} (\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$web\+Socket, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$output)
\begin{DoxyCompactList}\small\item\em Format Authorization header field. \end{DoxyCompactList}\item 
void \hyperlink{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}{web\+Socket\+Convert\+Array\+To\+Hex\+String} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$input, size\+\_\+t input\+Len, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$output)
\begin{DoxyCompactList}\small\item\em Convert byte array to hex string. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
H\+T\+TP authentication for Web\+Sockets. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{web__socket__auth_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{web__socket__auth_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a726918867be6caec18d98f3fc26813f9}{W\+E\+B\+\_\+\+S\+O\+C\+K\+E\+T\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file web\+\_\+socket\+\_\+auth.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{web__socket__auth_8c_a8adbda0a7e2adcf9aeab2613ac830209}\label{web__socket__auth_8c_a8adbda0a7e2adcf9aeab2613ac830209}} 
\index{web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}!web\+Socket\+Add\+Authorization\+Field@{web\+Socket\+Add\+Authorization\+Field}}
\index{web\+Socket\+Add\+Authorization\+Field@{web\+Socket\+Add\+Authorization\+Field}!web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Add\+Authorization\+Field()}{webSocketAddAuthorizationField()}}
{\footnotesize\ttfamily size\+\_\+t web\+Socket\+Add\+Authorization\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{output }\end{DoxyParamCaption})}



Format Authorization header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the header field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Total length of the header field 
\end{DoxyReturn}


Definition at line 167 of file web\+\_\+socket\+\_\+auth.\+c.


\begin{DoxyCode}
168 \{
169    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
170 
171 \textcolor{preprocessor}{#if (WEB\_SOCKET\_BASIC\_AUTH\_SUPPORT == ENABLED || WEB\_SOCKET\_DIGEST\_AUTH\_SUPPORT == ENABLED)}
172    \hyperlink{structWebSocketAuthContext}{WebSocketAuthContext} *authContext;
173 
174    \textcolor{comment}{//Point to the handshake context}
175    authContext = &webSocket->authContext;
176 \textcolor{preprocessor}{#endif}
177 
178 \textcolor{preprocessor}{#if (WEB\_SOCKET\_BASIC\_AUTH\_SUPPORT == ENABLED)}
179    \textcolor{comment}{//Basic authentication scheme?}
180    \textcolor{keywordflow}{if}(authContext->\hyperlink{structWebSocketAuthContext_ab75d64b66c1e870bea0affdc5c2bf492}{selectedAuthMode} == \hyperlink{web__socket_8h_a2c2f8d99948379e06bb22ea64745ba77a30430e212026c8648a527167cd8914b0}{WS\_AUTH\_MODE\_BASIC})
181    \{
182       \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
183       \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *temp;
184 
185       \textcolor{comment}{//Temporary buffer}
186       temp = (\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *) webSocket->rxContext.buffer;
187 
188       \textcolor{comment}{//Format Authorization header field}
189       n = sprintf(output, \textcolor{stringliteral}{"Authorization: Basic "});
190 
191       \textcolor{comment}{//The client sends the userid and password, separated by a single colon}
192       \textcolor{comment}{//character, within a Base64-encoded string in the credentials}
193       k = sprintf(temp, \textcolor{stringliteral}{"%s:%s"}, authContext->\hyperlink{structWebSocketAuthContext_a69b8df5c2bf4a6849bec5f2c84068da9}{username},
194          authContext->\hyperlink{structWebSocketAuthContext_af6fc321cd2597378b1086cfe03858830}{password});
195 
196       \textcolor{comment}{//Encode the resulting string using Base64}
197       \hyperlink{base64_8c_a6eb49435a26b3297e611264f6d1cbf5f}{base64Encode}(temp, k, output + n, &k);
198       \textcolor{comment}{//Update the total length of the header field}
199       n += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
200 
201       \textcolor{comment}{//Properly terminate the Authorization header field}
202       n += sprintf(output + n, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
203    \}
204    \textcolor{keywordflow}{else}
205 \textcolor{preprocessor}{#endif}
206 \textcolor{preprocessor}{#if (WEB\_SOCKET\_DIGEST\_AUTH\_SUPPORT == ENABLED)}
207    \textcolor{comment}{//Digest authentication scheme?}
208    \textcolor{keywordflow}{if}(authContext->\hyperlink{structWebSocketAuthContext_ab75d64b66c1e870bea0affdc5c2bf492}{selectedAuthMode} == \hyperlink{web__socket_8h_a2c2f8d99948379e06bb22ea64745ba77ace1b2d04ef4bf3d72f7d378fee80e744}{WS\_AUTH\_MODE\_DIGEST})
209    \{
210       \hyperlink{structMd5Context}{Md5Context} md5Context;
211       \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} ha1[2 * \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE} + 1];
212       \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} ha2[2 * \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE} + 1];
213       \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} nc[9];
214 
215       \textcolor{comment}{//Count of the number of requests (including the current request)}
216       \textcolor{comment}{//that the client has sent with the nonce value in this request}
217       authContext->\hyperlink{structWebSocketAuthContext_a23961b8af61e72b164bde15362baa8a5}{nc}++;
218 
219       \textcolor{comment}{//Convert the value to hex string}
220       sprintf(nc, \textcolor{stringliteral}{"%08x"}, authContext->\hyperlink{structWebSocketAuthContext_a23961b8af61e72b164bde15362baa8a5}{nc});
221 
222       \textcolor{comment}{//Compute HA1 = MD5(username : realm : password)}
223       \hyperlink{md5_8c_acc37d4333236797f144067f5c39f345e}{md5Init}(&md5Context);
224       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, authContext->\hyperlink{structWebSocketAuthContext_a69b8df5c2bf4a6849bec5f2c84068da9}{username}, strlen(authContext->
      \hyperlink{structWebSocketAuthContext_a69b8df5c2bf4a6849bec5f2c84068da9}{username}));
225       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
226       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, authContext->\hyperlink{structWebSocketAuthContext_ae54b0e674cf0be7223519ecb9ff9c9cd}{realm}, strlen(authContext->
      \hyperlink{structWebSocketAuthContext_ae54b0e674cf0be7223519ecb9ff9c9cd}{realm}));
227       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
228       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, authContext->\hyperlink{structWebSocketAuthContext_af6fc321cd2597378b1086cfe03858830}{password}, strlen(authContext->
      \hyperlink{structWebSocketAuthContext_af6fc321cd2597378b1086cfe03858830}{password}));
229       \hyperlink{md5_8c_add832f9f73d9df95f48bed551122df55}{md5Final}(&md5Context, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
230 
231       \textcolor{comment}{//Convert MD5 hash to hex string}
232       \hyperlink{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}{webSocketConvertArrayToHexString}(md5Context.
      \hyperlink{structMd5Context_a2f29146370d91b5b9b9a6bd6f9b8f79b}{digest}, \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE}, ha1);
233       \textcolor{comment}{//Debug message}
234       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  HA1: %s\(\backslash\)r\(\backslash\)n"}, ha1);
235 
236       \textcolor{comment}{//Compute HA2 = MD5(method : uri)}
237       \hyperlink{md5_8c_acc37d4333236797f144067f5c39f345e}{md5Init}(&md5Context);
238       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{"GET"}, 3);
239       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
240       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, webSocket->uri, strlen(webSocket->uri));
241       \hyperlink{md5_8c_add832f9f73d9df95f48bed551122df55}{md5Final}(&md5Context, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
242 
243       \textcolor{comment}{//Convert MD5 hash to hex string}
244       \hyperlink{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}{webSocketConvertArrayToHexString}(md5Context.
      \hyperlink{structMd5Context_a2f29146370d91b5b9b9a6bd6f9b8f79b}{digest}, \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE}, ha2);
245       \textcolor{comment}{//Debug message}
246       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  HA2: %s\(\backslash\)r\(\backslash\)n"}, ha2);
247 
248       \textcolor{comment}{//Compute MD5(HA1 : nonce : nc : cnonce : qop : HA2)}
249       \hyperlink{md5_8c_acc37d4333236797f144067f5c39f345e}{md5Init}(&md5Context);
250       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, ha1, strlen(ha1));
251       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
252       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, authContext->\hyperlink{structWebSocketAuthContext_a76375cce9f84668fc50430de22dafc10}{nonce}, strlen(authContext->
      \hyperlink{structWebSocketAuthContext_a76375cce9f84668fc50430de22dafc10}{nonce}));
253       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
254       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, nc, strlen(nc));
255       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
256       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, authContext->\hyperlink{structWebSocketAuthContext_ab0845a2003e5f41154be669607a5e85c}{cnonce}, strlen(authContext->
      \hyperlink{structWebSocketAuthContext_ab0845a2003e5f41154be669607a5e85c}{cnonce}));
257       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
258       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{"auth"}, 4);
259       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, \textcolor{stringliteral}{":"}, 1);
260       \hyperlink{md5_8c_aa396f66cc4a5275f4b610551602df8ff}{md5Update}(&md5Context, ha2, strlen(ha2));
261       \hyperlink{md5_8c_add832f9f73d9df95f48bed551122df55}{md5Final}(&md5Context, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
262 
263       \textcolor{comment}{//Convert MD5 hash to hex string}
264       \hyperlink{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}{webSocketConvertArrayToHexString}(md5Context.
      \hyperlink{structMd5Context_a2f29146370d91b5b9b9a6bd6f9b8f79b}{digest}, \hyperlink{md5_8h_ad86b38d6ab14e243543904e30f26bed2}{MD5\_DIGEST\_SIZE}, ha1);
265       \textcolor{comment}{//Debug message}
266       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  response: %s\(\backslash\)r\(\backslash\)n"}, ha1);
267 
268       \textcolor{comment}{//Format Authorization header field}
269       n = sprintf(output, \textcolor{stringliteral}{"Authorization: Digest\(\backslash\)r\(\backslash\)n"});
270 
271       \textcolor{comment}{//Username}
272       n += sprintf(output + n, \textcolor{stringliteral}{"  username=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_a69b8df5c2bf4a6849bec5f2c84068da9}{username});
273       \textcolor{comment}{//Realm}
274       n += sprintf(output + n, \textcolor{stringliteral}{"  realm=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_ae54b0e674cf0be7223519ecb9ff9c9cd}{realm});
275       \textcolor{comment}{//Nonce value}
276       n += sprintf(output + n, \textcolor{stringliteral}{"  nonce=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_a76375cce9f84668fc50430de22dafc10}{nonce});
277       \textcolor{comment}{//URI}
278       n += sprintf(output + n, \textcolor{stringliteral}{"  uri=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, webSocket->uri);
279       \textcolor{comment}{//Quality of protection}
280       n += sprintf(output + n, \textcolor{stringliteral}{"  qop=\(\backslash\)"auth\(\backslash\)",\(\backslash\)r\(\backslash\)n"});
281       \textcolor{comment}{//Nonce count}
282       n += sprintf(output + n, \textcolor{stringliteral}{"  nc=\(\backslash\)"%08x\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_a23961b8af61e72b164bde15362baa8a5}{nc});
283       \textcolor{comment}{//Cnonce value}
284       n += sprintf(output + n, \textcolor{stringliteral}{"  cnonce=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_ab0845a2003e5f41154be669607a5e85c}{cnonce});
285       \textcolor{comment}{//Response}
286       n += sprintf(output + n, \textcolor{stringliteral}{"  response=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, ha1);
287       \textcolor{comment}{//Opaque parameter}
288       n += sprintf(output + n, \textcolor{stringliteral}{"  opaque=\(\backslash\)"%s\(\backslash\)",\(\backslash\)r\(\backslash\)n"}, authContext->\hyperlink{structWebSocketAuthContext_aea6c6e4970c40b250d06dc458f142dd5}{opaque});
289    \}
290    \textcolor{keywordflow}{else}
291 \textcolor{preprocessor}{#endif}
292    \textcolor{comment}{//Unknown authentication scheme?}
293    \{
294       \textcolor{comment}{//No need to add the Authorization header field}
295       n = 0;
296    \}
297 
298    \textcolor{comment}{//Return the total length of the Authorization header field}
299    \textcolor{keywordflow}{return} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
300 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}\label{web__socket__auth_8c_a6cbcaa172904edf5cd5ee774562164cd}} 
\index{web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}!web\+Socket\+Convert\+Array\+To\+Hex\+String@{web\+Socket\+Convert\+Array\+To\+Hex\+String}}
\index{web\+Socket\+Convert\+Array\+To\+Hex\+String@{web\+Socket\+Convert\+Array\+To\+Hex\+String}!web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Convert\+Array\+To\+Hex\+String()}{webSocketConvertArrayToHexString()}}
{\footnotesize\ttfamily void web\+Socket\+Convert\+Array\+To\+Hex\+String (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{input,  }\item[{size\+\_\+t}]{input\+Len,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{output }\end{DoxyParamCaption})}



Convert byte array to hex string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input} & Point to the byte array \\
\hline
\mbox{\tt in}  & {\em input\+Len} & Length of the byte array \\
\hline
\mbox{\tt out}  & {\em output} & N\+U\+L\+L-\/terminated string resulting from the conversion \\
\hline
\end{DoxyParams}


Definition at line 310 of file web\+\_\+socket\+\_\+auth.\+c.


\begin{DoxyCode}
312 \{
313    \textcolor{keywordtype}{size\_t} i;
314 
315    \textcolor{comment}{//Hex conversion table}
316    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} hexDigit[16] =
317    \{
318       \textcolor{charliteral}{'0'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'2'}, \textcolor{charliteral}{'3'}, \textcolor{charliteral}{'4'}, \textcolor{charliteral}{'5'}, \textcolor{charliteral}{'6'}, \textcolor{charliteral}{'7'},
319       \textcolor{charliteral}{'8'}, \textcolor{charliteral}{'9'}, \textcolor{charliteral}{'a'}, \textcolor{charliteral}{'b'}, \textcolor{charliteral}{'c'}, \textcolor{charliteral}{'d'}, \textcolor{charliteral}{'e'}, \textcolor{charliteral}{'f'}
320    \};
321 
322    \textcolor{comment}{//Process byte array}
323    \textcolor{keywordflow}{for}(i = 0; i < inputLen; i++)
324    \{
325       \textcolor{comment}{//Convert upper nibble}
326       output[i * 2] = hexDigit[(input[i] >> 4) & 0x0F];
327       \textcolor{comment}{//Then convert lower nibble}
328       output[i * 2 + 1] = hexDigit[input[i] & 0x0F];
329    \}
330 
331    \textcolor{comment}{//Properly terminate the string with a NULL character}
332    output[i * 2] = \textcolor{charliteral}{'\(\backslash\)0'};
333 \}
\end{DoxyCode}
\mbox{\Hypertarget{web__socket__auth_8c_af798ae15658d57fb91fcc2dbe5f230de}\label{web__socket__auth_8c_af798ae15658d57fb91fcc2dbe5f230de}} 
\index{web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}!web\+Socket\+Parse\+Authenticate\+Field@{web\+Socket\+Parse\+Authenticate\+Field}}
\index{web\+Socket\+Parse\+Authenticate\+Field@{web\+Socket\+Parse\+Authenticate\+Field}!web\+\_\+socket\+\_\+auth.\+c@{web\+\_\+socket\+\_\+auth.\+c}}
\subsubsection{\texorpdfstring{web\+Socket\+Parse\+Authenticate\+Field()}{webSocketParseAuthenticateField()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} web\+Socket\+Parse\+Authenticate\+Field (\begin{DoxyParamCaption}\item[{\hyperlink{web__socket_8h_aad796fb4e3af91c4358c5b273d4a2028}{Web\+Socket} $\ast$}]{web\+Socket,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Parse W\+W\+W-\/\+Authenticate header field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em web\+Socket} & Handle to a Web\+Socket \\
\hline
\mbox{\tt in}  & {\em value} & N\+U\+L\+L-\/terminated string that contains the value of header field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 55 of file web\+\_\+socket\+\_\+auth.\+c.


\begin{DoxyCode}
56 \{
57 \textcolor{preprocessor}{#if (WEB\_SOCKET\_BASIC\_AUTH\_SUPPORT == ENABLED || WEB\_SOCKET\_DIGEST\_AUTH\_SUPPORT == ENABLED)}
58    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
59    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
60    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{coap__common_8h_aaa0137cdddb344591e20a2930a1ba54d}{token};
61    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *separator;
62    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name};
63    \hyperlink{structWebSocketAuthContext}{WebSocketAuthContext} *authContext;
64 
65    \textcolor{comment}{//Point to the handshake context}
66    authContext = &webSocket->authContext;
67 
68    \textcolor{comment}{//Retrieve the authentication scheme}
69    token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{" \(\backslash\)t"}, &p);
70 
71    \textcolor{comment}{//Any parsing error?}
72    \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
73       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
74 
75    \textcolor{comment}{//Basic access authentication?}
76    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"Basic"}))
77    \{
78       \textcolor{comment}{//Basic authentication is required by the WebSocket server}
79       authContext->\hyperlink{structWebSocketAuthContext_a50c3cdd7ca2e85e2f1de07c0312320aa}{requiredAuthMode} = \hyperlink{web__socket_8h_a2c2f8d99948379e06bb22ea64745ba77a30430e212026c8648a527167cd8914b0}{WS\_AUTH\_MODE\_BASIC};
80    \}
81    \textcolor{comment}{//Digest access authentication?}
82    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"Digest"}))
83    \{
84       \textcolor{comment}{//Digest authentication is required by the WebSocket server}
85       authContext->\hyperlink{structWebSocketAuthContext_a50c3cdd7ca2e85e2f1de07c0312320aa}{requiredAuthMode} = \hyperlink{web__socket_8h_a2c2f8d99948379e06bb22ea64745ba77ace1b2d04ef4bf3d72f7d378fee80e744}{WS\_AUTH\_MODE\_DIGEST};
86    \}
87    \textcolor{comment}{//Unknown authentication scheme?}
88    \textcolor{keywordflow}{else}
89    \{
90       \textcolor{comment}{//Report an error}
91       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
92    \}
93 
94    \textcolor{comment}{//Get the first parameter}
95    token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{","}, &p);
96 
97    \textcolor{comment}{//Parse the WWW-Authenticate field}
98    \textcolor{keywordflow}{while}(token != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
99    \{
100       \textcolor{comment}{//Check whether a separator is present}
101       separator = strchr(token, \textcolor{charliteral}{'='});
102 
103       \textcolor{comment}{//Separator found?}
104       \textcolor{keywordflow}{if}(separator != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
105       \{
106          \textcolor{comment}{//Split the string}
107          *separator = \textcolor{charliteral}{'\(\backslash\)0'};
108 
109          \textcolor{comment}{//Get field name and value}
110          name = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(token);
111          \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(separator + 1);
112 
113          \textcolor{comment}{//Retrieve the length of the value field}
114          n = strlen(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value});
115 
116          \textcolor{comment}{//Discard the surrounding quotes}
117          \textcolor{keywordflow}{if}(n > 0 && \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}[n - 1] == \textcolor{charliteral}{'\(\backslash\)"'})
118             \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}[n - 1] = \textcolor{charliteral}{'\(\backslash\)0'};
119          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}[0] == \textcolor{charliteral}{'\(\backslash\)"'})
120             \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}++;
121 
122          \textcolor{comment}{//Check parameter name}
123          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"realm"}))
124          \{
125             \textcolor{comment}{//Save realm}
126             \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(authContext->\hyperlink{structWebSocketAuthContext_ae54b0e674cf0be7223519ecb9ff9c9cd}{realm}, \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, 
      \hyperlink{web__socket_8h_ae74a00b949ab02514b90f9783031b311}{WEB\_SOCKET\_REALM\_MAX\_LEN});
127          \}
128 \textcolor{preprocessor}{#if (WEB\_SOCKET\_DIGEST\_AUTH\_SUPPORT == ENABLED)}
129          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"nonce"}))
130          \{
131             \textcolor{comment}{//Save nonce}
132             \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(authContext->\hyperlink{structWebSocketAuthContext_a76375cce9f84668fc50430de22dafc10}{nonce}, \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, 
      \hyperlink{web__socket_8h_a48d19c4a819af2a5c5b3fea833a7c7ea}{WEB\_SOCKET\_NONCE\_MAX\_LEN} + 1);
133          \}
134          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"opaque"}))
135          \{
136             \textcolor{comment}{//Save nonce}
137             \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(authContext->\hyperlink{structWebSocketAuthContext_aea6c6e4970c40b250d06dc458f142dd5}{opaque}, \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, 
      \hyperlink{web__socket_8h_a1703dd1ad84a33246b072ed9a3042d5f}{WEB\_SOCKET\_OPAQUE\_MAX\_LEN} + 1);
138          \}
139          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(name, \textcolor{stringliteral}{"stale"}))
140          \{
141             \textcolor{comment}{//Save stale flag}
142             \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value}, \textcolor{stringliteral}{"true"}))
143                authContext->\hyperlink{structWebSocketAuthContext_a19357f3f322cd3ffeb07fb8fed174181}{stale} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
144             \textcolor{keywordflow}{else}
145                authContext->\hyperlink{structWebSocketAuthContext_a19357f3f322cd3ffeb07fb8fed174181}{stale} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
146          \}
147 \textcolor{preprocessor}{#endif}
148 
149          \textcolor{comment}{//Get next parameter}
150          token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{","}, &p);
151       \}
152    \}
153 \textcolor{preprocessor}{#endif}
154 
155    \textcolor{comment}{//Successful processing}
156    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
157 \}
\end{DoxyCode}
