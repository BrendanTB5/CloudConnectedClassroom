\hypertarget{base64url_8h}{}\section{cyclone\+\_\+crypto/encoding/base64url.h File Reference}
\label{base64url_8h}\index{cyclone\+\_\+crypto/encoding/base64url.\+h@{cyclone\+\_\+crypto/encoding/base64url.\+h}}


Base64url encoding scheme.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{base64url_8h_ae374d6e03a566b4e76cfe72e3906d920}{base64url\+Encode} (const void $\ast$input, size\+\_\+t input\+Len, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$output, size\+\_\+t $\ast$output\+Len)
\begin{DoxyCompactList}\small\item\em Base64url encoding algorithm. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{base64url_8h_a5e9c9236d95a4ad8fef23609bc6baa11}{base64url\+Decode} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$input, size\+\_\+t input\+Len, void $\ast$output, size\+\_\+t $\ast$output\+Len)
\begin{DoxyCompactList}\small\item\em Base64url decoding algorithm. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Base64url encoding scheme. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{base64url_8h_a5e9c9236d95a4ad8fef23609bc6baa11}\label{base64url_8h_a5e9c9236d95a4ad8fef23609bc6baa11}} 
\index{base64url.\+h@{base64url.\+h}!base64url\+Decode@{base64url\+Decode}}
\index{base64url\+Decode@{base64url\+Decode}!base64url.\+h@{base64url.\+h}}
\subsubsection{\texorpdfstring{base64url\+Decode()}{base64urlDecode()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} base64url\+Decode (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{input,  }\item[{size\+\_\+t}]{input\+Len,  }\item[{void $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{output\+Len }\end{DoxyParamCaption})}



Base64url decoding algorithm. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input} & Base64url-\/encoded string \\
\hline
\mbox{\tt in}  & {\em input\+Len} & Length of the encoded string \\
\hline
\mbox{\tt out}  & {\em output} & Resulting decoded data \\
\hline
\mbox{\tt out}  & {\em output\+Len} & Length of the decoded data \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 184 of file base64url.\+c.


\begin{DoxyCode}
186 \{
187    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
188    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
189    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
190    \textcolor{keywordtype}{size\_t} i;
191    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
192    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
193 
194    \textcolor{comment}{//Check parameters}
195    \textcolor{keywordflow}{if}(input == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && inputLen != 0)
196       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
197    \textcolor{keywordflow}{if}(outputLen == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
198       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
199 
200    \textcolor{comment}{//Check the length of the input string}
201    \textcolor{keywordflow}{if}((inputLen % 4) == 1)
202       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
203 
204    \textcolor{comment}{//Initialize status code}
205    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
206 
207    \textcolor{comment}{//Point to the buffer where to write the decoded data}
208    p = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) output;
209 
210    \textcolor{comment}{//Initialize variables}
211    n = 0;
212    value = 0;
213 
214    \textcolor{comment}{//Process the Base64url-encoded string}
215    \textcolor{keywordflow}{for}(i = 0; i < inputLen && !error; i++)
216    \{
217       \textcolor{comment}{//Get current character}
218       c = (\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t}) input[i];
219 
220       \textcolor{comment}{//Check the value of the current character}
221       \textcolor{keywordflow}{if}(c < 128 && \hyperlink{base64url_8c_a2aa13607fd96c94a6bd25e4e82fb41ed}{base64urlDecTable}[c] < 64)
222       \{
223          \textcolor{comment}{//Decode the current character}
224          value = (value << 6) | \hyperlink{base64url_8c_a2aa13607fd96c94a6bd25e4e82fb41ed}{base64urlDecTable}[c];
225 
226          \textcolor{comment}{//Divide the input stream into blocks of 4 characters}
227          \textcolor{keywordflow}{if}((i % 4) == 3)
228          \{
229             \textcolor{comment}{//Map each 4-character block to 3 bytes}
230             \textcolor{keywordflow}{if}(p != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
231             \{
232                p[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = (value >> 16) & 0xFF;
233                p[n + 1] = (value >> 8) & 0xFF;
234                p[n + 2] = value & 0xFF;
235             \}
236 
237             \textcolor{comment}{//Adjust the length of the decoded data}
238             n += 3;
239             \textcolor{comment}{//Decode next block}
240             value = 0;
241          \}
242       \}
243       \textcolor{keywordflow}{else}
244       \{
245          \textcolor{comment}{//Implementations must reject the encoded data if it contains}
246          \textcolor{comment}{//characters outside the base alphabet}
247          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca72da934338a39cb699b6413f00691ddd}{ERROR\_INVALID\_CHARACTER};
248       \}
249    \}
250 
251    \textcolor{comment}{//Check status code}
252    \textcolor{keywordflow}{if}(!error)
253    \{
254       \textcolor{comment}{//All trailing pad characters are omitted in Base64url}
255       \textcolor{keywordflow}{if}((inputLen % 4) == 2)
256       \{
257          \textcolor{comment}{//The last block contains only 1 byte}
258          \textcolor{keywordflow}{if}(p != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
259          \{
260             \textcolor{comment}{//Decode the last byte}
261             p[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = (value >> 4) & 0xFF;
262          \}
263 
264          \textcolor{comment}{//Adjust the length of the decoded data}
265          n++;
266       \}
267       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((inputLen % 4) == 3)
268       \{
269          \textcolor{comment}{//The last block contains only 2 bytes}
270          \textcolor{keywordflow}{if}(p != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
271          \{
272             \textcolor{comment}{//Decode the last two bytes}
273             p[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = (value >> 10) & 0xFF;
274             p[n + 1] = (value >> 2) & 0xFF;
275          \}
276 
277          \textcolor{comment}{//Adjust the length of the decoded data}
278          n += 2;
279       \}
280       \textcolor{keywordflow}{else}
281       \{
282          \textcolor{comment}{//No pad characters in this case}
283       \}
284    \}
285 
286    \textcolor{comment}{//Total number of bytes that have been written}
287    *outputLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
288 
289    \textcolor{comment}{//Return status code}
290    \textcolor{keywordflow}{return} error;
291 \}
\end{DoxyCode}
\mbox{\Hypertarget{base64url_8h_ae374d6e03a566b4e76cfe72e3906d920}\label{base64url_8h_ae374d6e03a566b4e76cfe72e3906d920}} 
\index{base64url.\+h@{base64url.\+h}!base64url\+Encode@{base64url\+Encode}}
\index{base64url\+Encode@{base64url\+Encode}!base64url.\+h@{base64url.\+h}}
\subsubsection{\texorpdfstring{base64url\+Encode()}{base64urlEncode()}}
{\footnotesize\ttfamily void base64url\+Encode (\begin{DoxyParamCaption}\item[{const void $\ast$}]{input,  }\item[{size\+\_\+t}]{input\+Len,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{output\+Len }\end{DoxyParamCaption})}



Base64url encoding algorithm. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input} & Input data to encode \\
\hline
\mbox{\tt in}  & {\em input\+Len} & Length of the data to encode \\
\hline
\mbox{\tt out}  & {\em output} & N\+U\+L\+L-\/terminated string encoded with Base64url algorithm \\
\hline
\mbox{\tt out}  & {\em output\+Len} & Length of the encoded string (optional parameter) \\
\hline
\end{DoxyParams}


Definition at line 72 of file base64url.\+c.


\begin{DoxyCode}
74 \{
75    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
76    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a};
77    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b};
78    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
79    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} d;
80    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
81 
82    \textcolor{comment}{//Point to the first byte of the input data}
83    p = (\textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) input;
84 
85    \textcolor{comment}{//Divide the input stream into blocks of 3 bytes}
86    n = inputLen / 3;
87 
88    \textcolor{comment}{//A full encoding quantum is always completed at the end of a quantity}
89    \textcolor{keywordflow}{if}(inputLen == (n * 3 + 1))
90    \{
91       \textcolor{comment}{//The final quantum of encoding input is exactly 8 bits}
92       \textcolor{keywordflow}{if}(input != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
93       \{
94          \textcolor{comment}{//Read input data}
95          a = (p[n * 3] & 0xFC) >> 2;
96          b = (p[n * 3] & 0x03) << 4;
97 
98          \textcolor{comment}{//The final unit of encoded output will be two characters}
99          output[n * 4] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}];
100          output[n * 4 + 1] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}];
101          output[n * 4 + 2] = \textcolor{charliteral}{'\(\backslash\)0'};
102       \}
103 
104       \textcolor{comment}{//Length of the encoded string (excluding the terminating NULL)}
105       \textcolor{keywordflow}{if}(outputLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
106       \{
107          *outputLen = n * 4 + 2;
108       \}
109    \}
110    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(inputLen == (n * 3 + 2))
111    \{
112       \textcolor{comment}{//The final quantum of encoding input is exactly 16 bits}
113       \textcolor{keywordflow}{if}(input != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
114       \{
115          \textcolor{comment}{//Read input data}
116          a = (p[n * 3] & 0xFC) >> 2;
117          b = ((p[n * 3] & 0x03) << 4) | ((p[n * 3 + 1] & 0xF0) >> 4);
118          c = (p[n * 3 + 1] & 0x0F) << 2;
119 
120          \textcolor{comment}{//The final unit of encoded output will be three characters followed}
121          \textcolor{comment}{//by one "=" padding character}
122          output[n * 4] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}];
123          output[n * 4 + 1] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}];
124          output[n * 4 + 2] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
125          output[n * 4 + 3] = \textcolor{charliteral}{'\(\backslash\)0'};
126       \}
127 
128       \textcolor{comment}{//Length of the encoded string (excluding the terminating NULL)}
129       \textcolor{keywordflow}{if}(outputLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
130       \{
131          *outputLen = n * 4 + 3;
132       \}
133    \}
134    \textcolor{keywordflow}{else}
135    \{
136       \textcolor{comment}{//The final quantum of encoding input is an integral multiple of 24 bits}
137       \textcolor{keywordflow}{if}(output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
138       \{
139          \textcolor{comment}{//The final unit of encoded output will be an integral multiple of 4}
140          \textcolor{comment}{//characters}
141          output[n * 4] = \textcolor{charliteral}{'\(\backslash\)0'};
142       \}
143 
144       \textcolor{comment}{//Length of the encoded string (excluding the terminating NULL)}
145       \textcolor{keywordflow}{if}(outputLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
146       \{
147          *outputLen = n * 4;
148       \}
149    \}
150 
151    \textcolor{comment}{//If the output parameter is NULL, then the function calculates the}
152    \textcolor{comment}{//length of the resulting Base64url string without copying any data}
153    \textcolor{keywordflow}{if}(input != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
154    \{
155       \textcolor{comment}{//The input data is processed block by block}
156       \textcolor{keywordflow}{while}(n-- > 0)
157       \{
158          \textcolor{comment}{//Read input data}
159          a = (p[n * 3] & 0xFC) >> 2;
160          b = ((p[n * 3] & 0x03) << 4) | ((p[n * 3 + 1] & 0xF0) >> 4);
161          c = ((p[n * 3 + 1] & 0x0F) << 2) | ((p[n * 3 + 2] & 0xC0) >> 6);
162          d = p[n * 3 + 2] & 0x3F;
163 
164          \textcolor{comment}{//Map each 3-byte block to 4 printable characters using the Base64url}
165          \textcolor{comment}{//character set}
166          output[n * 4] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}];
167          output[n * 4 + 1] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}];
168          output[n * 4 + 2] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
169          output[n * 4 + 3] = \hyperlink{base64url_8c_ae27b391ac447942a84a299b0312da185}{base64urlEncTable}[d];
170       \}
171    \}
172 \}
\end{DoxyCode}
