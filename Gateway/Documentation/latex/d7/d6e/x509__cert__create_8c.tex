\hypertarget{x509__cert__create_8c}{}\section{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+create.c File Reference}
\label{x509__cert__create_8c}\index{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+create.\+c@{cyclone\+\_\+crypto/pkix/x509\+\_\+cert\+\_\+create.\+c}}


X.\+509 certificate generation.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+cert\+\_\+create.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+key\+\_\+format.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/asn1.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/oid.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkc/rsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkc/dsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ecdsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/eddsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ed25519.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ed448.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}hash/sha1.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{x509__cert__create_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aaa281e9a954e1e04b4cd104a1adeb91c}{x509\+Create\+Certificate} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{structX509CertRequestInfo}{X509\+Cert\+Request\+Info} $\ast$cert\+Req\+Info, const void $\ast$subject\+Public\+Key, const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$issuer\+Cert\+Info, const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$serial\+Number, const \hyperlink{structX509Validity}{X509\+Validity} $\ast$validity, const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo, const void $\ast$signer\+Private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Generate a X.\+509 certificate. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a6a25188d938c0b892efc45bbce0b4c82}{x509\+Format\+Tbs\+Certificate} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$serial\+Number, const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo, const \hyperlink{structX509Name}{X509\+Name} $\ast$issuer, const \hyperlink{structX509Validity}{X509\+Validity} $\ast$validity, const \hyperlink{structX509Name}{X509\+Name} $\ast$subject, const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$subject\+Public\+Key\+Info, const void $\ast$public\+Key, const \hyperlink{structX509Extensions}{X509\+Extensions} $\ast$\hyperlink{tls13__misc_8h_a7b8cc84c920376c616d85d575080d28e}{extensions}, const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$auth\+Key\+Id, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format T\+B\+S\+Certificate structure. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a60dc2ae12891195a8a6704cc2ca81248}{x509\+Format\+Version} (\hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26}{X509\+Version} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Version field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_adf62b1f2c3c93683146f027d9eeca1bd}{x509\+Format\+Serial\+Number} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$serial\+Number, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Serial\+Number field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aca759ee4ba07227fa402f76e6cc6f096}{x509\+Format\+Name} (const \hyperlink{structX509Name}{X509\+Name} $\ast$\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Name structure. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509\+Format\+Name\+Attribute} (\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, size\+\_\+t oid\+Len, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value}, size\+\_\+t value\+Len, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Name attribute. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_ac287aebe03d5b2ae65b87a8aa5c1e2de}{x509\+Format\+Validity} (const \hyperlink{structX509Validity}{X509\+Validity} $\ast$validity, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Validity structure. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aed4ae38a9e4efd397c672b0405018137}{x509\+Format\+Time} (const \hyperlink{structDateTime}{Date\+Time} $\ast$date\+Time, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format U\+T\+C\+Time or Generalized\+Time field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a46a26883a0eba55a8560789e03fa2979}{x509\+Format\+Extensions} (const \hyperlink{structX509Extensions}{X509\+Extensions} $\ast$\hyperlink{tls13__misc_8h_a7b8cc84c920376c616d85d575080d28e}{extensions}, const \hyperlink{structX509SubjectKeyId}{X509\+Subject\+Key\+Id} $\ast$subject\+Key\+Id, const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$auth\+Key\+Id, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Extensions structure. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aab7e52cc20ffb4bd15f7f13299a11556}{x509\+Format\+Basic\+Constraints} (const \hyperlink{structX509BasicConstraints}{X509\+Basic\+Constraints} $\ast$basic\+Constraints, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Basic\+Constraints extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_ab84912d96bc7de79d6dfce84dbd9192b}{x509\+Format\+Key\+Usage} (const \hyperlink{structX509KeyUsage}{X509\+Key\+Usage} $\ast$key\+Usage, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Key\+Usage extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a38cdde45ede5832c497a6eaaa48f6497}{x509\+Format\+Subject\+Alt\+Name} (const \hyperlink{structX509SubjectAltName}{X509\+Subject\+Alt\+Name} $\ast$subject\+Alt\+Name, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Subject\+Alt\+Name extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_acbc812f874a24204d6d0b3eb36496e99}{x509\+Format\+Subject\+Key\+Id} (const \hyperlink{structX509SubjectKeyId}{X509\+Subject\+Key\+Id} $\ast$subject\+Key\+Id, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Subject\+Key\+Identifier extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aeacf29869bc640615a5ff1f401912f9e}{x509\+Format\+Authority\+Key\+Id} (const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$auth\+Key\+Id, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Authority\+Key\+Identifier extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a2fa92746382f5edb5b4c7d8d3794ec0d}{x509\+Format\+Ns\+Cert\+Type} (const \hyperlink{structX509NsCertType}{X509\+Ns\+Cert\+Type} $\ast$ns\+Cert\+Type, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Netscape\+Cert\+Type extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a902ddc6c88855db5490c42a5974ab8fa}{x509\+Format\+Signature\+Algo} (const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Signature\+Algorithm structure. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_a05ae03292e916a3b6493a5a23e7b8040}{x509\+Format\+Signature\+Value} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$tbs\+Cert, size\+\_\+t tbs\+Cert\+Len, const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo\+Id, const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$public\+Key\+Info, const void $\ast$private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Signature\+Value field. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{x509__cert__create_8c_aa98a1f3f8ea1236bc8e78926e7fbb339}{x509\+Generate\+Signature} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$tbs\+Cert, size\+\_\+t tbs\+Cert\+Len, const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$signature\+Algo\+Id, const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$public\+Key\+Info, const void $\ast$private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Certificate signature generation. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
X.\+509 certificate generation. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{x509__cert__create_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{x509__cert__create_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file x509\+\_\+cert\+\_\+create.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{x509__cert__create_8c_aaa281e9a954e1e04b4cd104a1adeb91c}\label{x509__cert__create_8c_aaa281e9a954e1e04b4cd104a1adeb91c}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Create\+Certificate@{x509\+Create\+Certificate}}
\index{x509\+Create\+Certificate@{x509\+Create\+Certificate}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Create\+Certificate()}{x509CreateCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Create\+Certificate (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{structX509CertRequestInfo}{X509\+Cert\+Request\+Info} $\ast$}]{cert\+Req\+Info,  }\item[{const void $\ast$}]{subject\+Public\+Key,  }\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{issuer\+Cert\+Info,  }\item[{const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$}]{serial\+Number,  }\item[{const \hyperlink{structX509Validity}{X509\+Validity} $\ast$}]{validity,  }\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo,  }\item[{const void $\ast$}]{signer\+Private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Generate a X.\+509 certificate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em cert\+Req\+Info} & Certificate request information \\
\hline
\mbox{\tt in}  & {\em subject\+Public\+Key} & Subject\textquotesingle{}s public key (optional parameter) \\
\hline
\mbox{\tt in}  & {\em issuer\+Cert\+Info} & Issuer\textquotesingle{}s certificate (optional parameter) \\
\hline
\mbox{\tt in}  & {\em serial\+Number} & Serial number (optional parameter) \\
\hline
\mbox{\tt in}  & {\em validity} & Validity period \\
\hline
\mbox{\tt in}  & {\em signature\+Algo} & Signature algorithm \\
\hline
\mbox{\tt in}  & {\em signer\+Private\+Key} & Pointer to the issuer\textquotesingle{}s private key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to store the X.\+509 certificate \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting X.\+509 certificate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 69 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
74 \{
75    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
76    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
77    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
78    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
79    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *tbsCert;
80    \textcolor{keywordtype}{size\_t} tbsCertLen;
81    \textcolor{keyword}{const} \hyperlink{structX509Name}{X509Name} *issuer;
82    \textcolor{keyword}{const} \hyperlink{structX509SubjectPublicKeyInfo}{X509SubjectPublicKeyInfo} *publicKeyInfo;
83    \hyperlink{structX509AuthorityKeyId}{X509AuthorityKeyId} authKeyId;
84    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
85 
86    \textcolor{comment}{//Check parameters}
87    \textcolor{keywordflow}{if}(certReqInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || validity == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || signatureAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
88       signerPrivateKey == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || written == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
89    \{
90       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
91    \}
92 
93    \textcolor{comment}{//Point to the buffer where to write the certificate}
94    p = output;
95    \textcolor{comment}{//Length of the certificate}
96    length = 0;
97 
98    \textcolor{comment}{//Self-signed certificate?}
99    \textcolor{keywordflow}{if}(issuerCertInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
100    \{
101       \textcolor{comment}{//Self-issued certificates are CA certificates in which the issuer}
102       \textcolor{comment}{//and subject are the same entity}
103       issuer = &certReqInfo->\hyperlink{structX509CertRequestInfo_ab7cab6a9a43f28a64198f227f2abae3f}{subject};
104 
105       \textcolor{comment}{//Where a CA distributes its public key in the form of a self-signed}
106       \textcolor{comment}{//certificate, the authority key identifier may be omitted}
107       authKeyId = certReqInfo->\hyperlink{structX509CertRequestInfo_ac4a74fdd56ba3feb52bb1a29de2c2e5c}{attributes}.\hyperlink{structX509Attributes_a67c2453fe7c47efb38e5657346330316}{extensionReq}.
      \hyperlink{structX509Extensions_a3c41096ba469c33d9fed4c090f5713fb}{authKeyId};
108 
109       \textcolor{comment}{//Point to the subject's public key}
110       publicKeyInfo = &certReqInfo->\hyperlink{structX509CertRequestInfo_ab1c561b08bbbb942b684423343363e22}{subjectPublicKeyInfo};
111    \}
112    \textcolor{keywordflow}{else}
113    \{
114       \textcolor{comment}{//Check issuer's certificate version}
115       \textcolor{keywordflow}{if}(issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_a651e18b39b7492e6e739823ea19129d9}{version} >= \hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26addaa01d4830baa29e7e19044f0a656eb}{X509\_VERSION\_3})
116       \{
117          \textcolor{keyword}{const} \hyperlink{structX509Extensions}{X509Extensions} *\hyperlink{tls13__misc_8h_a7b8cc84c920376c616d85d575080d28e}{extensions};
118 
119          \textcolor{comment}{//Point to the extensions of the issuer's certificate}
120          extensions = &issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_aa60d8b8a952d01fd8de02c2da091563e}{extensions};
121 
122          \textcolor{comment}{//Make sure the cA boolean is asserted}
123          \textcolor{keywordflow}{if}(!extensions->\hyperlink{structX509Extensions_ab06800e3424608f8d652ff23c5a027a9}{basicConstraints}.\hyperlink{structX509BasicConstraints_afcfd439b65fdffa3e6fd07e6a46e9d7d}{cA})
124             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
125 
126          \textcolor{comment}{//Check if the KeyUsage extension is present}
127          \textcolor{keywordflow}{if}(extensions->\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage}.bitmap != 0)
128          \{
129             \textcolor{comment}{//Make sure the keyCertSign is asserted}
130             \textcolor{keywordflow}{if}((extensions->\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage}.bitmap & 
      \hyperlink{certificate_2x509__common_8h_a071feff2befadce3a4fe5b708cdb149ba2dc6d1748a2dd8a65a7ba5e521a1c054}{X509\_KEY\_USAGE\_KEY\_CERT\_SIGN}) == 0)
131                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
132          \}
133       \}
134 
135       \textcolor{comment}{//The issuer field identifies the entity that has signed and issued}
136       \textcolor{comment}{//the certificate}
137       issuer = &issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_a68e21bffb3f287f4e57378b275e1d178}{subject};
138 
139       \textcolor{comment}{//The KeyIdentifier field of the AuthorityKeyIdentifier extension must}
140       \textcolor{comment}{//be included in all certificates generated by conforming CAs to}
141       \textcolor{comment}{//facilitate certification path construction}
142       authKeyId.\hyperlink{structX509AuthorityKeyId_a6fcba640adab232183f55a463d066b81}{critical} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
143       authKeyId.\hyperlink{structX509AuthorityKeyId_ab96ff029d18bc7035b698c9b0daa9681}{keyId} = issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_aa60d8b8a952d01fd8de02c2da091563e}{extensions}.
      \hyperlink{structX509Extensions_a720e6ecde7eba80ee36a83d18a67dfd9}{subjectKeyId}.\hyperlink{structX509SubjectKeyId_ac13791883d5af3098c8fcecd596f4737}{value};
144       authKeyId.\hyperlink{structX509AuthorityKeyId_ae1cbf5840bbe41649ea904a2f787278d}{keyIdLen} = issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_aa60d8b8a952d01fd8de02c2da091563e}{extensions}.
      \hyperlink{structX509Extensions_a720e6ecde7eba80ee36a83d18a67dfd9}{subjectKeyId}.\hyperlink{structX509SubjectKeyId_ae72259e33329d3224c90547e63f95804}{length};
145 
146       \textcolor{comment}{//Point to the issuer's public key}
147       publicKeyInfo = &issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo};
148    \}
149 
150    \textcolor{comment}{//Format TBSCertificate structure}
151    error = \hyperlink{x509__cert__create_8c_a6a25188d938c0b892efc45bbce0b4c82}{x509FormatTbsCertificate}(prngAlgo, prngContext, serialNumber,
152       signatureAlgo, issuer, validity, &certReqInfo->\hyperlink{structX509CertRequestInfo_ab7cab6a9a43f28a64198f227f2abae3f}{subject},
153       &certReqInfo->\hyperlink{structX509CertRequestInfo_ab1c561b08bbbb942b684423343363e22}{subjectPublicKeyInfo}, subjectPublicKey,
154       &certReqInfo->\hyperlink{structX509CertRequestInfo_ac4a74fdd56ba3feb52bb1a29de2c2e5c}{attributes}.\hyperlink{structX509Attributes_a67c2453fe7c47efb38e5657346330316}{extensionReq}, &authKeyId, p, &n);
155    \textcolor{comment}{//Any error to report?}
156    \textcolor{keywordflow}{if}(error)
157       \textcolor{keywordflow}{return} error;
158 
159    \textcolor{comment}{//The ASN.1 DER-encoded TBSCertificate is used as the input to the}
160    \textcolor{comment}{//signature function}
161    tbsCert = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
162    tbsCertLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
163 
164    \textcolor{comment}{//Advance data pointer}
165    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
166    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
167 
168    \textcolor{comment}{//Format SignatureAlgorithm structure}
169    error = \hyperlink{x509__cert__create_8c_a902ddc6c88855db5490c42a5974ab8fa}{x509FormatSignatureAlgo}(signatureAlgo, p, &n);
170    \textcolor{comment}{//Any error to report?}
171    \textcolor{keywordflow}{if}(error)
172       \textcolor{keywordflow}{return} error;
173 
174    \textcolor{comment}{//Advance data pointer}
175    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
176    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
177 
178    \textcolor{comment}{//Format SignatureValue structure}
179    error = \hyperlink{x509__cert__create_8c_a05ae03292e916a3b6493a5a23e7b8040}{x509FormatSignatureValue}(prngAlgo, prngContext, tbsCert,
180       tbsCertLen, signatureAlgo, publicKeyInfo, signerPrivateKey, p, &n);
181    \textcolor{comment}{//Any error to report?}
182    \textcolor{keywordflow}{if}(error)
183       \textcolor{keywordflow}{return} error;
184 
185    \textcolor{comment}{//Advance data pointer}
186    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
187    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
188 
189    \textcolor{comment}{//The certificate is encapsulated within a sequence}
190    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
191    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
192    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
193    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
194    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
195 
196    \textcolor{comment}{//Write the corresponding ASN.1 tag}
197    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
198    \textcolor{comment}{//Any error to report?}
199    \textcolor{keywordflow}{if}(error)
200       \textcolor{keywordflow}{return} error;
201 
202    \textcolor{comment}{//Total number of bytes that have been written}
203    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
204 
205    \textcolor{comment}{//Successful processing}
206    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
207 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_aeacf29869bc640615a5ff1f401912f9e}\label{x509__cert__create_8c_aeacf29869bc640615a5ff1f401912f9e}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Authority\+Key\+Id@{x509\+Format\+Authority\+Key\+Id}}
\index{x509\+Format\+Authority\+Key\+Id@{x509\+Format\+Authority\+Key\+Id}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Authority\+Key\+Id()}{x509FormatAuthorityKeyId()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Authority\+Key\+Id (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$}]{auth\+Key\+Id,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Authority\+Key\+Identifier extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em auth\+Key\+Id} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1495 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1497 \{
1498    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1499    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1500    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1501    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1502    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1503 
1504    \textcolor{comment}{//Initialize status code}
1505    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1506 
1507    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1508    p = output;
1509    \textcolor{comment}{//Length of the ASN.1 structure}
1510    length = 0;
1511 
1512    \textcolor{comment}{//The authority key identifier extension provides a means of identifying the}
1513    \textcolor{comment}{//public key corresponding to the private key used to sign a certificate}
1514    \textcolor{keywordflow}{if}(authKeyId->\hyperlink{structX509AuthorityKeyId_ab96ff029d18bc7035b698c9b0daa9681}{keyId} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && authKeyId->\hyperlink{structX509AuthorityKeyId_ae1cbf5840bbe41649ea904a2f787278d}{keyIdLen} > 0)
1515    \{
1516       \textcolor{comment}{//Format the extension identifier}
1517       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1518       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1519       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1520       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_ae647117666d0ad67f65ade1ec8da1f60}{X509\_AUTHORITY\_KEY\_ID\_OID});
1521       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_ae647117666d0ad67f65ade1ec8da1f60}{X509\_AUTHORITY\_KEY\_ID\_OID};
1522 
1523       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1524       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1525       \textcolor{comment}{//Any error to report?}
1526       \textcolor{keywordflow}{if}(error)
1527          \textcolor{keywordflow}{return} error;
1528 
1529       \textcolor{comment}{//Advance data pointer}
1530       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1531       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1532 
1533       \textcolor{comment}{//Explicit tagging shall be used to encode the keyIdentifier field}
1534       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1535       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
1536       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = 0;
1537       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = authKeyId->\hyperlink{structX509AuthorityKeyId_ae1cbf5840bbe41649ea904a2f787278d}{keyIdLen};
1538       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = authKeyId->\hyperlink{structX509AuthorityKeyId_ab96ff029d18bc7035b698c9b0daa9681}{keyId};
1539 
1540       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1541       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1542       \textcolor{comment}{//Any error to report?}
1543       \textcolor{keywordflow}{if}(error)
1544          \textcolor{keywordflow}{return} error;
1545 
1546       \textcolor{comment}{//The KeyIdentifier field is encapsulated within a sequence}
1547       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1548       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1549       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1550       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1551       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1552 
1553       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1554       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1555       \textcolor{comment}{//Any error to report?}
1556       \textcolor{keywordflow}{if}(error)
1557          \textcolor{keywordflow}{return} error;
1558 
1559       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1560       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1561       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1562       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1563       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1564       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1565 
1566       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1567       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1568       \textcolor{comment}{//Any error to report?}
1569       \textcolor{keywordflow}{if}(error)
1570          \textcolor{keywordflow}{return} error;
1571 
1572       \textcolor{comment}{//Adjust the length of the extension}
1573       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1574 
1575       \textcolor{comment}{//The extension is encapsulated within a sequence}
1576       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1577       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1578       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1579       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1580       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1581 
1582       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1583       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1584       \textcolor{comment}{//Any error to report?}
1585       \textcolor{keywordflow}{if}(error)
1586          \textcolor{keywordflow}{return} error;
1587    \}
1588 
1589    \textcolor{comment}{//Total number of bytes that have been written}
1590    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1591 
1592    \textcolor{comment}{//Successful processing}
1593    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1594 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_aab7e52cc20ffb4bd15f7f13299a11556}\label{x509__cert__create_8c_aab7e52cc20ffb4bd15f7f13299a11556}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Basic\+Constraints@{x509\+Format\+Basic\+Constraints}}
\index{x509\+Format\+Basic\+Constraints@{x509\+Format\+Basic\+Constraints}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Basic\+Constraints()}{x509FormatBasicConstraints()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Basic\+Constraints (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509BasicConstraints}{X509\+Basic\+Constraints} $\ast$}]{basic\+Constraints,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Basic\+Constraints extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em basic\+Constraints} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 965 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
967 \{
968    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
969    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
970    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
971    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
972    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
973    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
974    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} buffer[3];
975 
976    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
977    p = output;
978    \textcolor{comment}{//Length of the ASN.1 structure}
979    length = 0;
980 
981    \textcolor{comment}{//The basic constraints extension identifies whether the subject of the}
982    \textcolor{comment}{//certificate is a CA and the maximum depth of valid certification paths}
983    \textcolor{comment}{//that include this certificate}
984    \textcolor{keywordflow}{if}(basicConstraints->\hyperlink{structX509BasicConstraints_afcfd439b65fdffa3e6fd07e6a46e9d7d}{cA} || basicConstraints->\hyperlink{structX509BasicConstraints_a188f2fcfc8d1a8da81a6361affeb66e8}{critical})
985    \{
986       \textcolor{comment}{//Format the extension identifier}
987       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
988       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
989       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
990       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_a457e7911fb0bbd8a8579f7198d2dbcba}{X509\_BASIC\_CONSTRAINTS\_OID});
991       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_a457e7911fb0bbd8a8579f7198d2dbcba}{X509\_BASIC\_CONSTRAINTS\_OID};
992 
993       \textcolor{comment}{//Write the corresponding ASN.1 tag}
994       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
995       \textcolor{comment}{//Any error to report?}
996       \textcolor{keywordflow}{if}(error)
997          \textcolor{keywordflow}{return} error;
998 
999       \textcolor{comment}{//Advance data pointer}
1000       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1001       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1002 
1003       \textcolor{comment}{//An extension includes the critical flag, with a default value of FALSE}
1004       \textcolor{keywordflow}{if}(basicConstraints->\hyperlink{structX509BasicConstraints_a188f2fcfc8d1a8da81a6361affeb66e8}{critical})
1005       \{
1006          \textcolor{comment}{//Mark the extension as critical}
1007          buffer[0] = 0xFF;
1008 
1009          \textcolor{comment}{//Format the critical field}
1010          tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1011          tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1012          tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa6e8bd3d6d3cfdc39ccc2891743560462}{ASN1\_TYPE\_BOOLEAN};
1013          tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = 1;
1014          tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = buffer;
1015 
1016          \textcolor{comment}{//Write the corresponding ASN.1 tag}
1017          error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1018          \textcolor{comment}{//Any error to report?}
1019          \textcolor{keywordflow}{if}(error)
1020             \textcolor{keywordflow}{return} error;
1021 
1022          \textcolor{comment}{//Advance data pointer}
1023          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1024          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1025       \}
1026 
1027       \textcolor{comment}{//Total number of bytes that have been written}
1028       *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1029 
1030       \textcolor{comment}{//Length of the extension value}
1031       length = 0;
1032 
1033       \textcolor{comment}{//Check whether the cA boolean is set}
1034       \textcolor{keywordflow}{if}(basicConstraints->\hyperlink{structX509BasicConstraints_afcfd439b65fdffa3e6fd07e6a46e9d7d}{cA})
1035       \{
1036          \textcolor{comment}{//The cA boolean indicates whether the certified public key may be used}
1037          \textcolor{comment}{//to verify certificate signatures}
1038          buffer[0] = 0xFF;
1039 
1040          \textcolor{comment}{//Format the cA field}
1041          tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1042          tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1043          tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa6e8bd3d6d3cfdc39ccc2891743560462}{ASN1\_TYPE\_BOOLEAN};
1044          tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = 1;
1045          tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = buffer;
1046 
1047          \textcolor{comment}{//Write the corresponding ASN.1 tag}
1048          error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &length);
1049          \textcolor{comment}{//Any error to report?}
1050          \textcolor{keywordflow}{if}(error)
1051             \textcolor{keywordflow}{return} error;
1052 
1053          \textcolor{comment}{//Where pathLenConstraint does not appear, no limit is imposed}
1054          \textcolor{keywordflow}{if}(basicConstraints->\hyperlink{structX509BasicConstraints_a13c129a1b79a0a489604e28d69dd0950}{pathLenConstraint} >= 0)
1055          \{
1056             \textcolor{comment}{//The pathLenConstraint field gives the maximum number of non-self-issued}
1057             \textcolor{comment}{//intermediate certificates that may follow this certificate in a valid}
1058             \textcolor{comment}{//certification path}
1059             value = basicConstraints->\hyperlink{structX509BasicConstraints_a13c129a1b79a0a489604e28d69dd0950}{pathLenConstraint};
1060 
1061             \textcolor{comment}{//Encode pathLenConstraint value}
1062             error = \hyperlink{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}{asn1WriteInt32}(value, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p + length, &n);
1063 
1064             \textcolor{comment}{//Update the length of the extension value}
1065             length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1066          \}
1067       \}
1068 
1069       \textcolor{comment}{//The BasicConstraints extension is encapsulated within a sequence}
1070       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1071       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1072       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1073       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1074       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1075 
1076       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1077       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1078       \textcolor{comment}{//Any error to report?}
1079       \textcolor{keywordflow}{if}(error)
1080          \textcolor{keywordflow}{return} error;
1081 
1082       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1083       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1084       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1085       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1086       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1087       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1088 
1089       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1090       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output + *written, &n);
1091       \textcolor{comment}{//Any error to report?}
1092       \textcolor{keywordflow}{if}(error)
1093          \textcolor{keywordflow}{return} error;
1094 
1095       \textcolor{comment}{//Adjust the length of the extension}
1096       *written += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1097 
1098       \textcolor{comment}{//The extension is encapsulated within a sequence}
1099       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1100       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1101       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1102       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = *written;
1103       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1104 
1105       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1106       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1107       \textcolor{comment}{//Any error to report?}
1108       \textcolor{keywordflow}{if}(error)
1109          \textcolor{keywordflow}{return} error;
1110    \}
1111 
1112    \textcolor{comment}{//Total number of bytes that have been written}
1113    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1114 
1115    \textcolor{comment}{//Successful processing}
1116    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1117 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a46a26883a0eba55a8560789e03fa2979}\label{x509__cert__create_8c_a46a26883a0eba55a8560789e03fa2979}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Extensions@{x509\+Format\+Extensions}}
\index{x509\+Format\+Extensions@{x509\+Format\+Extensions}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Extensions()}{x509FormatExtensions()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Extensions (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509Extensions}{X509\+Extensions} $\ast$}]{extensions,  }\item[{const \hyperlink{structX509SubjectKeyId}{X509\+Subject\+Key\+Id} $\ast$}]{subject\+Key\+Id,  }\item[{const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$}]{auth\+Key\+Id,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Extensions structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em extensions} & Pointer to the X.\+509 extensions \\
\hline
\mbox{\tt in}  & {\em subject\+Key\+Id} & Subject\+Key\+Identifier extension \\
\hline
\mbox{\tt in}  & {\em auth\+Key\+Id} & Authority\+Key\+Identifier extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 844 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
847 \{
848    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
849    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
850    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
851    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
852    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
853 
854    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
855    p = output;
856    \textcolor{comment}{//Length of the ASN.1 structure}
857    length = 0;
858 
859    \textcolor{comment}{//Format NetscapeCertType extension}
860    error = \hyperlink{x509__cert__create_8c_a2fa92746382f5edb5b4c7d8d3794ec0d}{x509FormatNsCertType}(&extensions->\hyperlink{structX509Extensions_a3600340825a23651f29c87e6da57a4bb}{nsCertType}, p, &n);
861    \textcolor{comment}{//Any error to report?}
862    \textcolor{keywordflow}{if}(error)
863       \textcolor{keywordflow}{return} error;
864 
865    \textcolor{comment}{//Advance data pointer}
866    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
867    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
868 
869    \textcolor{comment}{//Format BasicConstraints extension}
870    error = \hyperlink{x509__cert__create_8c_aab7e52cc20ffb4bd15f7f13299a11556}{x509FormatBasicConstraints}(&extensions->
      \hyperlink{structX509Extensions_ab06800e3424608f8d652ff23c5a027a9}{basicConstraints}, p, &n);
871    \textcolor{comment}{//Any error to report?}
872    \textcolor{keywordflow}{if}(error)
873       \textcolor{keywordflow}{return} error;
874 
875    \textcolor{comment}{//Advance data pointer}
876    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
877    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
878 
879    \textcolor{comment}{//Format KeyUsage extension}
880    error = \hyperlink{x509__cert__create_8c_ab84912d96bc7de79d6dfce84dbd9192b}{x509FormatKeyUsage}(&extensions->\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage}, p, &n);
881    \textcolor{comment}{//Any error to report?}
882    \textcolor{keywordflow}{if}(error)
883       \textcolor{keywordflow}{return} error;
884 
885    \textcolor{comment}{//Advance data pointer}
886    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
887    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
888 
889    \textcolor{comment}{//Format x509ParseSubjectKeyId extension}
890    error = \hyperlink{x509__cert__create_8c_acbc812f874a24204d6d0b3eb36496e99}{x509FormatSubjectKeyId}(subjectKeyId, p, &n);
891    \textcolor{comment}{//Any error to report?}
892    \textcolor{keywordflow}{if}(error)
893       \textcolor{keywordflow}{return} error;
894 
895    \textcolor{comment}{//Advance data pointer}
896    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
897    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
898 
899    \textcolor{comment}{//Format AuthorityKeyId extension}
900    error = \hyperlink{x509__cert__create_8c_aeacf29869bc640615a5ff1f401912f9e}{x509FormatAuthorityKeyId}(authKeyId, p, &n);
901    \textcolor{comment}{//Any error to report?}
902    \textcolor{keywordflow}{if}(error)
903       \textcolor{keywordflow}{return} error;
904 
905    \textcolor{comment}{//Advance data pointer}
906    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
907    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
908 
909    \textcolor{comment}{//Format SubjectAltName extension}
910    error = \hyperlink{x509__cert__create_8c_a38cdde45ede5832c497a6eaaa48f6497}{x509FormatSubjectAltName}(&extensions->
      \hyperlink{structX509Extensions_a6a01ce6bc43517af604b8cf580ebd01d}{subjectAltName}, p, &n);
911    \textcolor{comment}{//Any error to report?}
912    \textcolor{keywordflow}{if}(error)
913       \textcolor{keywordflow}{return} error;
914 
915    \textcolor{comment}{//Advance data pointer}
916    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
917    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
918 
919    \textcolor{comment}{//Any extensions written?}
920    \textcolor{keywordflow}{if}(length > 0)
921    \{
922       \textcolor{comment}{//The extensions are encapsulated within a sequence}
923       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
924       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
925       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
926       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
927       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
928 
929       \textcolor{comment}{//Write the corresponding ASN.1 tag}
930       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
931       \textcolor{comment}{//Any error to report?}
932       \textcolor{keywordflow}{if}(error)
933          \textcolor{keywordflow}{return} error;
934 
935       \textcolor{comment}{//Explicit tagging shall be used to encode the Extensions structure}
936       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
937       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
938       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = 3;
939       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
940       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
941 
942       \textcolor{comment}{//Write the corresponding ASN.1 tag}
943       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
944       \textcolor{comment}{//Any error to report?}
945       \textcolor{keywordflow}{if}(error)
946          \textcolor{keywordflow}{return} error;
947    \}
948 
949    \textcolor{comment}{//Total number of bytes that have been written}
950    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
951 
952    \textcolor{comment}{//Successful processing}
953    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
954 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_ab84912d96bc7de79d6dfce84dbd9192b}\label{x509__cert__create_8c_ab84912d96bc7de79d6dfce84dbd9192b}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Key\+Usage@{x509\+Format\+Key\+Usage}}
\index{x509\+Format\+Key\+Usage@{x509\+Format\+Key\+Usage}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Key\+Usage()}{x509FormatKeyUsage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Key\+Usage (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509KeyUsage}{X509\+Key\+Usage} $\ast$}]{key\+Usage,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Key\+Usage extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em key\+Usage} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1128 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1130 \{
1131    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1132    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1133    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1134    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1135    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1136    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1137    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} buffer[3];
1138 
1139    \textcolor{comment}{//Initialize status code}
1140    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1141 
1142    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1143    p = output;
1144    \textcolor{comment}{//Length of the ASN.1 structure}
1145    length = 0;
1146 
1147    \textcolor{comment}{//The key usage extension defines the purpose of the key contained in the}
1148    \textcolor{comment}{//certificate}
1149    \textcolor{keywordflow}{if}(keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} != 0 || keyUsage->\hyperlink{structX509KeyUsage_a111fd22c20e3dd57cbc8036432987a57}{critical})
1150    \{
1151       \textcolor{comment}{//Format the extension identifier}
1152       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1153       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1154       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1155       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_ab8715054378778b299416013e3dba1c8}{X509\_KEY\_USAGE\_OID});
1156       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_ab8715054378778b299416013e3dba1c8}{X509\_KEY\_USAGE\_OID};
1157 
1158       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1159       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1160       \textcolor{comment}{//Any error to report?}
1161       \textcolor{keywordflow}{if}(error)
1162          \textcolor{keywordflow}{return} error;
1163 
1164       \textcolor{comment}{//Advance data pointer}
1165       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1166       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1167 
1168       \textcolor{comment}{//An extension includes the critical flag, with a default value of FALSE}
1169       \textcolor{keywordflow}{if}(keyUsage->\hyperlink{structX509KeyUsage_a111fd22c20e3dd57cbc8036432987a57}{critical})
1170       \{
1171          \textcolor{comment}{//Mark the extension as critical}
1172          buffer[0] = 0xFF;
1173 
1174          \textcolor{comment}{//Format the critical field}
1175          tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1176          tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1177          tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa6e8bd3d6d3cfdc39ccc2891743560462}{ASN1\_TYPE\_BOOLEAN};
1178          tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = 1;
1179          tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = buffer;
1180 
1181          \textcolor{comment}{//Write the corresponding ASN.1 tag}
1182          error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1183          \textcolor{comment}{//Any error to report?}
1184          \textcolor{keywordflow}{if}(error)
1185             \textcolor{keywordflow}{return} error;
1186 
1187          \textcolor{comment}{//Advance data pointer}
1188          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1189          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1190       \}
1191 
1192       \textcolor{comment}{//Calculate the length, in bits, of the KeyUsage value}
1193       \textcolor{keywordflow}{for}(k = 16; k > 0; k--)
1194       \{
1195          \textcolor{keywordflow}{if}(keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & (1 << (k - 1)))
1196             \textcolor{keywordflow}{break};
1197       \}
1198 
1199       \textcolor{comment}{//Total number of bytes needed to encode the KeyUsage value}
1200       n = 0;
1201 
1202       \textcolor{comment}{//Encode bit string value}
1203       \textcolor{keywordflow}{if}(k <= 8)
1204       \{
1205          buffer[n++] = 8 - \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1206          buffer[n++] = \hyperlink{cpu__endian_8c_af2ffdcd294086e82ec95ff4ade458aea}{reverseInt8}(keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & 0xFF);
1207       \}
1208       \textcolor{keywordflow}{else}
1209       \{
1210          buffer[n++] = 16 - \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1211          buffer[n++] = \hyperlink{cpu__endian_8c_af2ffdcd294086e82ec95ff4ade458aea}{reverseInt8}(keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & 0xFF);
1212          buffer[n++] = \hyperlink{cpu__endian_8c_af2ffdcd294086e82ec95ff4ade458aea}{reverseInt8}((keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} >> 8) & 0xFF);
1213       \}
1214 
1215       \textcolor{comment}{//Format the bit string using ASN.1}
1216       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1217       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1218       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab40c213cd2fda439f157e8e4523d020c}{ASN1\_TYPE\_BIT\_STRING};
1219       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1220       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = buffer;
1221 
1222       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1223       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1224       \textcolor{comment}{//Any error to report?}
1225       \textcolor{keywordflow}{if}(error)
1226          \textcolor{keywordflow}{return} error;
1227 
1228       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1229       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1230       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1231       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1232       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1233       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1234 
1235       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1236       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1237       \textcolor{comment}{//Any error to report?}
1238       \textcolor{keywordflow}{if}(error)
1239          \textcolor{keywordflow}{return} error;
1240 
1241       \textcolor{comment}{//Adjust the length of the extension}
1242       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1243 
1244       \textcolor{comment}{//The extension is encapsulated within a sequence}
1245       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1246       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1247       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1248       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1249       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1250 
1251       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1252       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1253       \textcolor{comment}{//Any error to report?}
1254       \textcolor{keywordflow}{if}(error)
1255          \textcolor{keywordflow}{return} error;
1256    \}
1257 
1258    \textcolor{comment}{//Total number of bytes that have been written}
1259    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1260 
1261    \textcolor{comment}{//Successful processing}
1262    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1263 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_aca759ee4ba07227fa402f76e6cc6f096}\label{x509__cert__create_8c_aca759ee4ba07227fa402f76e6cc6f096}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Name@{x509\+Format\+Name}}
\index{x509\+Format\+Name@{x509\+Format\+Name}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Name()}{x509FormatName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509Name}{X509\+Name} $\ast$}]{name,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Name structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em name} & Information about the name to be encoded \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 468 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
470 \{
471    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
472    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
473    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
474    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
475    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
476 
477    \textcolor{comment}{//Initialize status code}
478    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
479 
480    \textcolor{comment}{//Raw ASN.1 sequence?}
481    \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_a16f889e11f79b38a1ade245692857253}{rawData} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->\hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen} > 0)
482    \{
483       \textcolor{comment}{//Copy raw ASN.1 sequence}
484       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(output, name->\hyperlink{structX509Name_a16f889e11f79b38a1ade245692857253}{rawData}, name->\hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen});
485       \textcolor{comment}{//Total number of bytes that have been written}
486       *written = name->\hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen};
487    \}
488    \textcolor{keywordflow}{else}
489    \{
490       \textcolor{comment}{//Point to the buffer where to write the Name structure}
491       p = output;
492       \textcolor{comment}{//Length of the Name structure}
493       length = 0;
494 
495       \textcolor{comment}{//Valid Country Name attribute?}
496       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_aebedcf83915608e1929d6cc612a67c2e}{countryName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->\hyperlink{structX509Name_ae146dda0b021633e3cfc15bda3435bf9}{countryNameLen} > 0)
497       \{
498          \textcolor{comment}{//Encode Country Name attribute}
499          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab8c073a8ddd8bb70bf652a5c3366319e}{ASN1\_TYPE\_PRINTABLE\_STRING},
500             \hyperlink{certificate_2x509__common_8c_a358f40098801dee2105f40d48d4d6a3c}{X509\_COUNTRY\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_a358f40098801dee2105f40d48d4d6a3c}{X509\_COUNTRY\_NAME\_OID}),
501             name->\hyperlink{structX509Name_aebedcf83915608e1929d6cc612a67c2e}{countryName}, name->\hyperlink{structX509Name_ae146dda0b021633e3cfc15bda3435bf9}{countryNameLen}, p, &n);
502          \textcolor{comment}{//Any error to report?}
503          \textcolor{keywordflow}{if}(error)
504             \textcolor{keywordflow}{return} error;
505 
506          \textcolor{comment}{//Advance data pointer}
507          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
508          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
509       \}
510 
511       \textcolor{comment}{//Valid State Or Province Name attribute?}
512       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_ad7101a1d70be5540fc1246c3819383dd}{stateOrProvinceName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->
      \hyperlink{structX509Name_a976a693703efcb68deed5c6294d0c95e}{stateOrProvinceNameLen} > 0)
513       \{
514          \textcolor{comment}{//Encode State Or Province Name attribute}
515          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING},
516             \hyperlink{certificate_2x509__common_8c_a29d223ee0c7055add854914bad3b0907}{X509\_STATE\_OR\_PROVINCE\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_a29d223ee0c7055add854914bad3b0907}{X509\_STATE\_OR\_PROVINCE\_NAME\_OID}),
517             name->\hyperlink{structX509Name_ad7101a1d70be5540fc1246c3819383dd}{stateOrProvinceName}, name->
      \hyperlink{structX509Name_a976a693703efcb68deed5c6294d0c95e}{stateOrProvinceNameLen}, p, &n);
518          \textcolor{comment}{//Any error to report?}
519          \textcolor{keywordflow}{if}(error)
520             \textcolor{keywordflow}{return} error;
521 
522          \textcolor{comment}{//Advance data pointer}
523          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
524          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
525       \}
526 
527       \textcolor{comment}{//Valid Locality Name attribute?}
528       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_a9e5c517817abea85a4ad7a8fa074fb76}{localityName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->\hyperlink{structX509Name_aba984d3fdf4e5c6eecb90752e54de3a7}{localityNameLen} > 0)
529       \{
530          \textcolor{comment}{//Encode Locality Name attribute}
531          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING},
532             \hyperlink{certificate_2x509__common_8c_a0b268786ad68f63b1e38d64a48e77436}{X509\_LOCALITY\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_a0b268786ad68f63b1e38d64a48e77436}{X509\_LOCALITY\_NAME\_OID}),
533             name->\hyperlink{structX509Name_a9e5c517817abea85a4ad7a8fa074fb76}{localityName}, name->\hyperlink{structX509Name_aba984d3fdf4e5c6eecb90752e54de3a7}{localityNameLen}, p, &n);
534          \textcolor{comment}{//Any error to report?}
535          \textcolor{keywordflow}{if}(error)
536             \textcolor{keywordflow}{return} error;
537 
538          \textcolor{comment}{//Advance data pointer}
539          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
540          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
541       \}
542 
543       \textcolor{comment}{//Valid Organization Name attribute?}
544       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_a521dfa010d25113b7ebca412a8ef1b6b}{organizationName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->
      \hyperlink{structX509Name_af2841192675d2bd0f999533a723d1c1d}{organizationNameLen} > 0)
545       \{
546          \textcolor{comment}{//Encode Organization Name attribute}
547          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING},
548             \hyperlink{certificate_2x509__common_8c_ac425aa6ed62ca6e26603c42a0036bed9}{X509\_ORGANIZATION\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_ac425aa6ed62ca6e26603c42a0036bed9}{X509\_ORGANIZATION\_NAME\_OID}),
549             name->\hyperlink{structX509Name_a521dfa010d25113b7ebca412a8ef1b6b}{organizationName}, name->\hyperlink{structX509Name_af2841192675d2bd0f999533a723d1c1d}{organizationNameLen}, p, &n);
550          \textcolor{comment}{//Any error to report?}
551          \textcolor{keywordflow}{if}(error)
552             \textcolor{keywordflow}{return} error;
553 
554          \textcolor{comment}{//Advance data pointer}
555          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
556          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
557       \}
558 
559       \textcolor{comment}{//Valid Organizational Unit Name attribute?}
560       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_a4095d2020e8553687a85b462fd00eac9}{organizationalUnitName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->
      \hyperlink{structX509Name_a17dc575cf29d256e44331bcb05ea67f0}{organizationalUnitNameLen} > 0)
561       \{
562          \textcolor{comment}{//Encode Organizational Unit Name attribute}
563          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING},
564             \hyperlink{certificate_2x509__common_8c_a5e4b5b454f1950a297fa7d74db18a6cd}{X509\_ORGANIZATIONAL\_UNIT\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_a5e4b5b454f1950a297fa7d74db18a6cd}{X509\_ORGANIZATIONAL\_UNIT\_NAME\_OID}),
565             name->\hyperlink{structX509Name_a4095d2020e8553687a85b462fd00eac9}{organizationalUnitName}, name->
      \hyperlink{structX509Name_a17dc575cf29d256e44331bcb05ea67f0}{organizationalUnitNameLen}, p, &n);
566          \textcolor{comment}{//Any error to report?}
567          \textcolor{keywordflow}{if}(error)
568             \textcolor{keywordflow}{return} error;
569 
570          \textcolor{comment}{//Advance data pointer}
571          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
572          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
573       \}
574 
575       \textcolor{comment}{//Valid Common Name attribute?}
576       \textcolor{keywordflow}{if}(name->\hyperlink{structX509Name_a29948ef6424aa86551582e5bf7afa47a}{commonName} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && name->\hyperlink{structX509Name_a5c5af434bfa902d83cae8cec8af15581}{commonNameLen} > 0)
577       \{
578          \textcolor{comment}{//Encode Common Name attribute}
579          error = \hyperlink{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}{x509FormatNameAttribute}(
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING},
580             \hyperlink{certificate_2x509__common_8c_a2b21c2e5cf2832b0e88fd6fab5a94e42}{X509\_COMMON\_NAME\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{certificate_2x509__common_8c_a2b21c2e5cf2832b0e88fd6fab5a94e42}{X509\_COMMON\_NAME\_OID}),
581             name->\hyperlink{structX509Name_a29948ef6424aa86551582e5bf7afa47a}{commonName}, name->\hyperlink{structX509Name_a5c5af434bfa902d83cae8cec8af15581}{commonNameLen}, p, &n);
582          \textcolor{comment}{//Any error to report?}
583          \textcolor{keywordflow}{if}(error)
584             \textcolor{keywordflow}{return} error;
585 
586          \textcolor{comment}{//Advance data pointer}
587          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
588          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
589       \}
590 
591       \textcolor{comment}{//The Name structure is encapsulated within a sequence}
592       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
593       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
594       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
595       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
596       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
597 
598       \textcolor{comment}{//Write the corresponding ASN.1 tag}
599       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
600       \textcolor{comment}{//Any error to report?}
601       \textcolor{keywordflow}{if}(error)
602          \textcolor{keywordflow}{return} error;
603 
604       \textcolor{comment}{//Total number of bytes that have been written}
605       *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
606    \}
607 
608    \textcolor{comment}{//Successful processing}
609    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
610 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}\label{x509__cert__create_8c_ac65a5349788ec9bbdefdd395b3004e5b}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Name\+Attribute@{x509\+Format\+Name\+Attribute}}
\index{x509\+Format\+Name\+Attribute@{x509\+Format\+Name\+Attribute}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Name\+Attribute()}{x509FormatNameAttribute()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Name\+Attribute (\begin{DoxyParamCaption}\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{type,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{oid,  }\item[{size\+\_\+t}]{oid\+Len,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{value,  }\item[{size\+\_\+t}]{value\+Len,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Name attribute. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em type} & A\+S\+N.\+1 string type \\
\hline
\mbox{\tt in}  & {\em oid} & Attribute O\+ID \\
\hline
\mbox{\tt in}  & {\em oid\+Len} & Length of the attribute O\+ID, in bytes \\
\hline
\mbox{\tt in}  & {\em value} & Attribute value \\
\hline
\mbox{\tt in}  & {\em value\+Len} & Length of the attribute value, in bytes \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 625 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
627 \{
628    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
629    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
630    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
631    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
632    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
633 
634    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
635    p = output;
636    \textcolor{comment}{//Length of the ASN.1 structure}
637    length = 0;
638 
639    \textcolor{comment}{//Format AttributeType field}
640    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
641    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
642    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
643    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = oidLen;
644    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid};
645 
646    \textcolor{comment}{//Write the corresponding ASN.1 tag}
647    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
648    \textcolor{comment}{//Any error to report?}
649    \textcolor{keywordflow}{if}(error)
650       \textcolor{keywordflow}{return} error;
651 
652    \textcolor{comment}{//Advance data pointer}
653    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
654    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
655 
656    \textcolor{comment}{//Format AttributeValue field}
657    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
658    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
659    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
660    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = valueLen;
661    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
662 
663    \textcolor{comment}{//Write the corresponding ASN.1 tag}
664    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
665    \textcolor{comment}{//Any error to report?}
666    \textcolor{keywordflow}{if}(error)
667       \textcolor{keywordflow}{return} error;
668 
669    \textcolor{comment}{//Advance data pointer}
670    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
671    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
672 
673    \textcolor{comment}{//The attribute type and value are encapsulated within a sequence}
674    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
675    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
676    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
677    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
678    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
679 
680    \textcolor{comment}{//Write the corresponding ASN.1 tag}
681    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
682    \textcolor{comment}{//Any error to report?}
683    \textcolor{keywordflow}{if}(error)
684       \textcolor{keywordflow}{return} error;
685 
686    \textcolor{comment}{//The sequence is encapsulated within a set}
687    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
688    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
689    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa9b2fa570f44ed585417c69fdeead6efa}{ASN1\_TYPE\_SET};
690    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
691    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
692 
693    \textcolor{comment}{//Write the corresponding ASN.1 tag}
694    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
695    \textcolor{comment}{//Any error to report?}
696    \textcolor{keywordflow}{if}(error)
697       \textcolor{keywordflow}{return} error;
698 
699    \textcolor{comment}{//Total number of bytes that have been written}
700    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
701 
702    \textcolor{comment}{//Successful processing}
703    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
704 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a2fa92746382f5edb5b4c7d8d3794ec0d}\label{x509__cert__create_8c_a2fa92746382f5edb5b4c7d8d3794ec0d}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Ns\+Cert\+Type@{x509\+Format\+Ns\+Cert\+Type}}
\index{x509\+Format\+Ns\+Cert\+Type@{x509\+Format\+Ns\+Cert\+Type}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Ns\+Cert\+Type()}{x509FormatNsCertType()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Ns\+Cert\+Type (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509NsCertType}{X509\+Ns\+Cert\+Type} $\ast$}]{ns\+Cert\+Type,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Netscape\+Cert\+Type extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ns\+Cert\+Type} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1605 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1607 \{
1608    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1609    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1610    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1611    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1612    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1613    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1614    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} buffer[2];
1615 
1616    \textcolor{comment}{//Initialize status code}
1617    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1618 
1619    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1620    p = output;
1621    \textcolor{comment}{//Length of the ASN.1 structure}
1622    length = 0;
1623 
1624    \textcolor{comment}{//The NetscapeCertType extension limit the use of a certificate}
1625    \textcolor{keywordflow}{if}(nsCertType->\hyperlink{structX509NsCertType_a573466b1c15b14b50697f06c64005917}{bitmap} != 0)
1626    \{
1627       \textcolor{comment}{//Format the extension identifier}
1628       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1629       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1630       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1631       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_a2144da6500b31dc85f50a2a1b6d38f87}{X509\_NS\_CERT\_TYPE\_OID});
1632       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_a2144da6500b31dc85f50a2a1b6d38f87}{X509\_NS\_CERT\_TYPE\_OID};
1633 
1634       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1635       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1636       \textcolor{comment}{//Any error to report?}
1637       \textcolor{keywordflow}{if}(error)
1638          \textcolor{keywordflow}{return} error;
1639 
1640       \textcolor{comment}{//Advance data pointer}
1641       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1642       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1643 
1644       \textcolor{comment}{//Calculate the length, in bits, of the NetscapeCertType value}
1645       \textcolor{keywordflow}{for}(k = 8; k > 0; k--)
1646       \{
1647          \textcolor{keywordflow}{if}(nsCertType->\hyperlink{structX509NsCertType_a573466b1c15b14b50697f06c64005917}{bitmap} & (1 << (k - 1)))
1648             \textcolor{keywordflow}{break};
1649       \}
1650 
1651       \textcolor{comment}{//Encode bit string value}
1652       buffer[0] = 8 - \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1653       buffer[1] = \hyperlink{cpu__endian_8c_af2ffdcd294086e82ec95ff4ade458aea}{reverseInt8}(nsCertType->\hyperlink{structX509NsCertType_a573466b1c15b14b50697f06c64005917}{bitmap});
1654 
1655       \textcolor{comment}{//Format the bit string using ASN.1}
1656       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1657       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1658       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab40c213cd2fda439f157e8e4523d020c}{ASN1\_TYPE\_BIT\_STRING};
1659       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(buffer);
1660       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = buffer;
1661 
1662       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1663       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1664       \textcolor{comment}{//Any error to report?}
1665       \textcolor{keywordflow}{if}(error)
1666          \textcolor{keywordflow}{return} error;
1667 
1668       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1669       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1670       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1671       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1672       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1673       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1674 
1675       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1676       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1677       \textcolor{comment}{//Any error to report?}
1678       \textcolor{keywordflow}{if}(error)
1679          \textcolor{keywordflow}{return} error;
1680 
1681       \textcolor{comment}{//Adjust the length of the extension}
1682       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1683 
1684       \textcolor{comment}{//The extension is encapsulated within a sequence}
1685       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1686       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1687       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1688       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1689       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1690 
1691       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1692       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1693       \textcolor{comment}{//Any error to report?}
1694       \textcolor{keywordflow}{if}(error)
1695          \textcolor{keywordflow}{return} error;
1696    \}
1697 
1698    \textcolor{comment}{//Total number of bytes that have been written}
1699    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1700 
1701    \textcolor{comment}{//Successful processing}
1702    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1703 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_adf62b1f2c3c93683146f027d9eeca1bd}\label{x509__cert__create_8c_adf62b1f2c3c93683146f027d9eeca1bd}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Serial\+Number@{x509\+Format\+Serial\+Number}}
\index{x509\+Format\+Serial\+Number@{x509\+Format\+Serial\+Number}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Serial\+Number()}{x509FormatSerialNumber()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Serial\+Number (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$}]{serial\+Number,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Serial\+Number field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em serial\+Number} & Pointer to the serial number (optional parameter) \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 408 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
410 \{
411    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
412    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
413    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
414 
415    \textcolor{comment}{//Valid serial number?}
416    \textcolor{keywordflow}{if}(serialNumber != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
417    \{
418       \textcolor{comment}{//The serial number is a unique integer assigned by the CA to each}
419       \textcolor{comment}{//certificate}
420       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
421       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
422       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER};
423       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = serialNumber->\hyperlink{structX509SerialNumber_ab076f0a46bcefa47cdc8135d5990ab78}{length};
424       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = serialNumber->\hyperlink{structX509SerialNumber_a04490ca0624096caf478beed3331d552}{data};
425    \}
426    \textcolor{keywordflow}{else}
427    \{
428       \textcolor{comment}{//Conforming CAs must not use serial number values longer than 20 octets}
429       error = prngAlgo->\hyperlink{structPrngAlgo_a079621740ef14faacfcd05b84c9036eb}{read}(prngContext, output, \hyperlink{pkix_2x509__common_8h_a21a4bce17b7a6fb5e8d25a41936767e4}{X509\_SERIAL\_NUMBER\_SIZE});
430       \textcolor{comment}{//Any error to report?}
431       \textcolor{keywordflow}{if}(error)
432          \textcolor{keywordflow}{return} error;
433 
434       \textcolor{comment}{//CAs must force the serial number to be a non-negative integer}
435       output[0] = (output[0] & 0x3F) | 0x40;
436 
437       \textcolor{comment}{//The serial number is a unique integer assigned by the CA to each}
438       \textcolor{comment}{//certificate}
439       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
440       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
441       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER};
442       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{pkix_2x509__common_8h_a21a4bce17b7a6fb5e8d25a41936767e4}{X509\_SERIAL\_NUMBER\_SIZE};
443       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
444    \}
445 
446    \textcolor{comment}{//Write the corresponding ASN.1 tag}
447    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
448    \textcolor{comment}{//Any error to report?}
449    \textcolor{keywordflow}{if}(error)
450       \textcolor{keywordflow}{return} error;
451 
452    \textcolor{comment}{//Total number of bytes that have been written}
453    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
454 
455    \textcolor{comment}{//Successful processing}
456    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
457 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a902ddc6c88855db5490c42a5974ab8fa}\label{x509__cert__create_8c_a902ddc6c88855db5490c42a5974ab8fa}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Signature\+Algo@{x509\+Format\+Signature\+Algo}}
\index{x509\+Format\+Signature\+Algo@{x509\+Format\+Signature\+Algo}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Signature\+Algo()}{x509FormatSignatureAlgo()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Signature\+Algo (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Signature\+Algorithm structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em signature\+Algo} & Pointer to the Signature\+Algorithm structure \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1714 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1716 \{
1717    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1718    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1719    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1720    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1721    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1722    \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078}{X509SignatureAlgo} signAlgo;
1723    \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
1724 
1725    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1726    p = output;
1727    \textcolor{comment}{//Length of the ASN.1 structure}
1728    length = 0;
1729 
1730    \textcolor{comment}{//Retrieve the signature algorithm that will be used to sign the certificate}
1731    error = \hyperlink{certificate_2x509__common_8c_ac397a84e21ec7d1d10607d48aa9fdf54}{x509GetSignHashAlgo}(signatureAlgo, &signAlgo, &hashAlgo);
1732    \textcolor{comment}{//Unsupported signature algorithm?}
1733    \textcolor{keywordflow}{if}(error)
1734       \textcolor{keywordflow}{return} error;
1735 
1736    \textcolor{comment}{//The Algorithm field contains the OID for the algorithm used by the CA}
1737    \textcolor{comment}{//to sign the certificate}
1738    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1739    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1740    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1741    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = signatureAlgo->\hyperlink{structX509SignatureAlgoId_a4a15b78049b8e360a069b72f0c79b0f4}{oidLen};
1742    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = signatureAlgo->\hyperlink{structX509SignatureAlgoId_a98ec1f180733e1e0cc22b133f8a23416}{oid};
1743 
1744    \textcolor{comment}{//Write the corresponding ASN.1 tag}
1745    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1746    \textcolor{comment}{//Any error to report?}
1747    \textcolor{keywordflow}{if}(error)
1748       \textcolor{keywordflow}{return} error;
1749 
1750    \textcolor{comment}{//Advance data pointer}
1751    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1752    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1753 
1754 \textcolor{preprocessor}{#if (X509\_RSA\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
1755    \textcolor{comment}{//RSA signature algorithm?}
1756    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA})
1757    \{
1758       \textcolor{comment}{//For RSA signature algorithm, the parameters component of that type}
1759       \textcolor{comment}{//shall be the ASN.1 type NULL (refer to RFC 3279, section 2.2.1)}
1760       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1761       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1762       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfac7b5ab1acfd186cfa72328495cc5261a}{ASN1\_TYPE\_NULL};
1763       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = 0;
1764       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1765 
1766       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1767       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1768    \}
1769    \textcolor{keywordflow}{else}
1770 \textcolor{preprocessor}{#endif}
1771 \textcolor{preprocessor}{#if (X509\_RSA\_PSS\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
1772    \textcolor{comment}{//RSA-PSS signature algorithm?}
1773    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS})
1774    \{
1775       \textcolor{comment}{//The parameters must be present when used in the algorithm identifier}
1776       \textcolor{comment}{//associated with a signature value (refer to RFC 4055, section 3.1)}
1777       error = \hyperlink{x509__key__format_8c_ae2b4a6a59d622e8c77a4fb961aee2735}{x509FormatRsaPssParameters}(&signatureAlgo->
      \hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}, p, &n);
1778    \}
1779    \textcolor{keywordflow}{else}
1780 \textcolor{preprocessor}{#endif}
1781 \textcolor{preprocessor}{#if (X509\_DSA\_SUPPORT == ENABLED && DSA\_SUPPORT == ENABLED)}
1782    \textcolor{comment}{//DSA signature algorithm?}
1783    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA})
1784    \{
1785       \textcolor{comment}{//For DSA signature algorithm, the encoding shall omit the parameters}
1786       \textcolor{comment}{//field (refer to RFC 3279, section 2.2.2)}
1787       n = 0;
1788    \}
1789    \textcolor{keywordflow}{else}
1790 \textcolor{preprocessor}{#endif}
1791 \textcolor{preprocessor}{#if (X509\_ECDSA\_SUPPORT == ENABLED && ECDSA\_SUPPORT == ENABLED)}
1792    \textcolor{comment}{//ECDSA signature algorithm?}
1793    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA})
1794    \{
1795       \textcolor{comment}{//For ECDSA signature algorithm, the encoding must omit the parameters}
1796       \textcolor{comment}{//field (refer to RFC 3279, section 2.2.3)}
1797       n = 0;
1798    \}
1799    \textcolor{keywordflow}{else}
1800 \textcolor{preprocessor}{#endif}
1801 \textcolor{preprocessor}{#if (X509\_ED25519\_SUPPORT == ENABLED && ED25519\_SUPPORT == ENABLED)}
1802    \textcolor{comment}{//Ed25519 signature algorithm?}
1803    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a34b6299ba091cde76553b23a7632da7f}{X509\_SIGN\_ALGO\_ED25519})
1804    \{
1805       \textcolor{comment}{//The parameters must be absent (refer to RFC 8410, section 6)}
1806       n = 0;
1807    \}
1808    \textcolor{keywordflow}{else}
1809 \textcolor{preprocessor}{#endif}
1810 \textcolor{preprocessor}{#if (X509\_ED448\_SUPPORT == ENABLED && ED448\_SUPPORT == ENABLED)}
1811    \textcolor{comment}{//Ed448 signature algorithm?}
1812    \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a258c2bcce0e685a5315ff975dc2f7c57}{X509\_SIGN\_ALGO\_ED448})
1813    \{
1814       \textcolor{comment}{//The parameters must be absent (refer to RFC 8410, section 6)}
1815       n = 0;
1816    \}
1817    \textcolor{keywordflow}{else}
1818 \textcolor{preprocessor}{#endif}
1819    \textcolor{comment}{//Invalid signature algorithm?}
1820    \{
1821       \textcolor{comment}{//Report an error}
1822       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
1823    \}
1824 
1825    \textcolor{comment}{//Check status code}
1826    \textcolor{keywordflow}{if}(error)
1827       \textcolor{keywordflow}{return} error;
1828 
1829    \textcolor{comment}{//Advance data pointer}
1830    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1831    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1832 
1833    \textcolor{comment}{//The Algorithm and Parameters fields are encapsulated within a sequence}
1834    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1835    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1836    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1837    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1838    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1839 
1840    \textcolor{comment}{//Write the corresponding ASN.1 tag}
1841    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1842    \textcolor{comment}{//Any error to report?}
1843    \textcolor{keywordflow}{if}(error)
1844       \textcolor{keywordflow}{return} error;
1845 
1846    \textcolor{comment}{//Total number of bytes that have been written}
1847    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1848 
1849    \textcolor{comment}{//Successful processing}
1850    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1851 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a05ae03292e916a3b6493a5a23e7b8040}\label{x509__cert__create_8c_a05ae03292e916a3b6493a5a23e7b8040}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Signature\+Value@{x509\+Format\+Signature\+Value}}
\index{x509\+Format\+Signature\+Value@{x509\+Format\+Signature\+Value}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Signature\+Value()}{x509FormatSignatureValue()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Signature\+Value (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{tbs\+Cert,  }\item[{size\+\_\+t}]{tbs\+Cert\+Len,  }\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo\+Id,  }\item[{const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$}]{public\+Key\+Info,  }\item[{const void $\ast$}]{private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Signature\+Value field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em tbs\+Cert} & Pointer to the T\+B\+S\+Certificate to be signed \\
\hline
\mbox{\tt in}  & {\em tbs\+Cert\+Len} & Length of the T\+B\+S\+Certificate, in bytes \\
\hline
\mbox{\tt in}  & {\em signature\+Algo\+Id} & Signature algorithm identifier \\
\hline
\mbox{\tt in}  & {\em public\+Key\+Info} & Signer\textquotesingle{}s public key information \\
\hline
\mbox{\tt in}  & {\em private\+Key} & Signer\textquotesingle{}s private key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1868 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1872 \{
1873    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1874    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1875    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1876 
1877    \textcolor{comment}{//The bit string shall contain an initial octet which encodes the number}
1878    \textcolor{comment}{//of unused bits in the final subsequent octet}
1879    output[0] = 0;
1880 
1881    \textcolor{comment}{//The ASN.1 DER-encoded tbsCertificate is used as the input to the signature}
1882    \textcolor{comment}{//function}
1883    error = \hyperlink{x509__cert__create_8c_aa98a1f3f8ea1236bc8e78926e7fbb339}{x509GenerateSignature}(prngAlgo, prngContext, tbsCert, tbsCertLen,
1884       signatureAlgoId, publicKeyInfo, privateKey, output + 1, &n);
1885    \textcolor{comment}{//Any error to report?}
1886    \textcolor{keywordflow}{if}(error)
1887       \textcolor{keywordflow}{return} error;
1888 
1889    \textcolor{comment}{//The signature is encapsulated within a bit string}
1890    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1891    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1892    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab40c213cd2fda439f157e8e4523d020c}{ASN1\_TYPE\_BIT\_STRING};
1893    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = n + 1;
1894    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1895 
1896    \textcolor{comment}{//Write the corresponding ASN.1 tag}
1897    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
1898    \textcolor{comment}{//Any error to report?}
1899    \textcolor{keywordflow}{if}(error)
1900       \textcolor{keywordflow}{return} error;
1901 
1902    \textcolor{comment}{//Total number of bytes that have been written}
1903    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1904 
1905    \textcolor{comment}{//Successful processing}
1906    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1907 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a38cdde45ede5832c497a6eaaa48f6497}\label{x509__cert__create_8c_a38cdde45ede5832c497a6eaaa48f6497}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Subject\+Alt\+Name@{x509\+Format\+Subject\+Alt\+Name}}
\index{x509\+Format\+Subject\+Alt\+Name@{x509\+Format\+Subject\+Alt\+Name}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Subject\+Alt\+Name()}{x509FormatSubjectAltName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Subject\+Alt\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509SubjectAltName}{X509\+Subject\+Alt\+Name} $\ast$}]{subject\+Alt\+Name,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Subject\+Alt\+Name extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em subject\+Alt\+Name} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1274 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1276 \{
1277    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1278    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1279    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1280    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1281    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1282    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1283 
1284    \textcolor{comment}{//Initialize status code}
1285    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1286 
1287    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1288    p = output;
1289    \textcolor{comment}{//Length of the ASN.1 structure}
1290    length = 0;
1291 
1292    \textcolor{comment}{//The subject alternative name extension allows identities to be bound to the}
1293    \textcolor{comment}{//subject of the certificate. These identities may be included in addition}
1294    \textcolor{comment}{//to or in place of the identity in the subject field of the certificate}
1295    \textcolor{keywordflow}{if}(subjectAltName->\hyperlink{structX509SubjectAltName_a320072e6555af4e2bd76d9d154ef7eca}{numGeneralNames} > 0)
1296    \{
1297       \textcolor{comment}{//Format the extension identifier}
1298       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1299       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1300       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1301       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_a54156c89eb4115b75cc540863e438879}{X509\_SUBJECT\_ALT\_NAME\_OID});
1302       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_a54156c89eb4115b75cc540863e438879}{X509\_SUBJECT\_ALT\_NAME\_OID};
1303 
1304       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1305       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1306       \textcolor{comment}{//Any error to report?}
1307       \textcolor{keywordflow}{if}(error)
1308          \textcolor{keywordflow}{return} error;
1309 
1310       \textcolor{comment}{//Advance data pointer}
1311       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1312       \textcolor{comment}{//Total number of bytes that have been written}
1313       *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1314 
1315       \textcolor{comment}{//Loop through subject alternative names}
1316       \textcolor{keywordflow}{for}(i = 0; i < subjectAltName->\hyperlink{structX509SubjectAltName_a320072e6555af4e2bd76d9d154ef7eca}{numGeneralNames}; i++)
1317       \{
1318          \textcolor{comment}{//Format the current name}
1319          tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1320          tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
1321          tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = subjectAltName->\hyperlink{structX509SubjectAltName_ab4a56143bba771858700f363a8da4647}{generalNames}[i].\hyperlink{structX509GeneralName_a014e3358c1ab42d4da4cd2535d59f05f}{type};
1322          tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = subjectAltName->\hyperlink{structX509SubjectAltName_ab4a56143bba771858700f363a8da4647}{generalNames}[i].\hyperlink{structX509GeneralName_a2804f41c9ae3cf1fb375b1d222d4f3af}{length};
1323          tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) subjectAltName->\hyperlink{structX509SubjectAltName_ab4a56143bba771858700f363a8da4647}{generalNames}[i].
      \hyperlink{structX509GeneralName_a00814b3509e1b708f019a645511e3d3a}{value};
1324 
1325          \textcolor{comment}{//Write the corresponding ASN.1 tag}
1326          error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1327          \textcolor{comment}{//Any error to report?}
1328          \textcolor{keywordflow}{if}(error)
1329             \textcolor{keywordflow}{return} error;
1330 
1331          \textcolor{comment}{//Advance data pointer}
1332          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1333          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1334       \}
1335 
1336       \textcolor{comment}{//Point to the first object}
1337       p = output + *written;
1338 
1339       \textcolor{comment}{//The names are encapsulated within a sequence}
1340       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1341       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1342       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1343       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1344       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1345 
1346       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1347       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1348       \textcolor{comment}{//Any error to report?}
1349       \textcolor{keywordflow}{if}(error)
1350          \textcolor{keywordflow}{return} error;
1351 
1352       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1353       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1354       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1355       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1356       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1357       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1358 
1359       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1360       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1361       \textcolor{comment}{//Any error to report?}
1362       \textcolor{keywordflow}{if}(error)
1363          \textcolor{keywordflow}{return} error;
1364 
1365       \textcolor{comment}{//Adjust the length of the extension}
1366       *written += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1367 
1368       \textcolor{comment}{//The extension is encapsulated within a sequence}
1369       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1370       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1371       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1372       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = *written;
1373       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1374 
1375       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1376       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1377       \textcolor{comment}{//Any error to report?}
1378       \textcolor{keywordflow}{if}(error)
1379          \textcolor{keywordflow}{return} error;
1380    \}
1381 
1382    \textcolor{comment}{//Total number of bytes that have been written}
1383    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1384 
1385    \textcolor{comment}{//Successful processing}
1386    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1387 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_acbc812f874a24204d6d0b3eb36496e99}\label{x509__cert__create_8c_acbc812f874a24204d6d0b3eb36496e99}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Subject\+Key\+Id@{x509\+Format\+Subject\+Key\+Id}}
\index{x509\+Format\+Subject\+Key\+Id@{x509\+Format\+Subject\+Key\+Id}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Subject\+Key\+Id()}{x509FormatSubjectKeyId()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Subject\+Key\+Id (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509SubjectKeyId}{X509\+Subject\+Key\+Id} $\ast$}]{subject\+Key\+Id,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Subject\+Key\+Identifier extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em subject\+Key\+Id} & Value of the extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1398 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1400 \{
1401    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1402    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1403    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1404    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1405    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
1406 
1407    \textcolor{comment}{//Initialize status code}
1408    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1409 
1410    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
1411    p = output;
1412    \textcolor{comment}{//Length of the ASN.1 structure}
1413    length = 0;
1414 
1415    \textcolor{comment}{//The subject key identifier extension provides a means of identifying}
1416    \textcolor{comment}{//certificates that contain a particular public key}
1417    \textcolor{keywordflow}{if}(subjectKeyId->\hyperlink{structX509SubjectKeyId_ac13791883d5af3098c8fcecd596f4737}{value} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && subjectKeyId->\hyperlink{structX509SubjectKeyId_ae72259e33329d3224c90547e63f95804}{length} > 0)
1418    \{
1419       \textcolor{comment}{//Format the extension identifier}
1420       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1421       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1422       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
1423       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \textcolor{keyword}{sizeof}(\hyperlink{certificate_2x509__common_8c_a035e654ed9823c727dd109c18e5e2cbd}{X509\_SUBJECT\_KEY\_ID\_OID});
1424       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{certificate_2x509__common_8c_a035e654ed9823c727dd109c18e5e2cbd}{X509\_SUBJECT\_KEY\_ID\_OID};
1425 
1426       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1427       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1428       \textcolor{comment}{//Any error to report?}
1429       \textcolor{keywordflow}{if}(error)
1430          \textcolor{keywordflow}{return} error;
1431 
1432       \textcolor{comment}{//Advance data pointer}
1433       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1434       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1435 
1436       \textcolor{comment}{//Format the KeyIdentifier field}
1437       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1438       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1439       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1440       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = subjectKeyId->\hyperlink{structX509SubjectKeyId_ae72259e33329d3224c90547e63f95804}{length};
1441       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = subjectKeyId->\hyperlink{structX509SubjectKeyId_ac13791883d5af3098c8fcecd596f4737}{value};
1442 
1443       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1444       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1445       \textcolor{comment}{//Any error to report?}
1446       \textcolor{keywordflow}{if}(error)
1447          \textcolor{keywordflow}{return} error;
1448 
1449       \textcolor{comment}{//The extension value is encapsulated in an octet string}
1450       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1451       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1452       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
1453       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1454       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1455 
1456       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1457       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
1458       \textcolor{comment}{//Any error to report?}
1459       \textcolor{keywordflow}{if}(error)
1460          \textcolor{keywordflow}{return} error;
1461 
1462       \textcolor{comment}{//Adjust the length of the extension}
1463       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1464 
1465       \textcolor{comment}{//The extension is encapsulated within a sequence}
1466       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1467       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
1468       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
1469       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1470       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
1471 
1472       \textcolor{comment}{//Write the corresponding ASN.1 tag}
1473       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &length);
1474       \textcolor{comment}{//Any error to report?}
1475       \textcolor{keywordflow}{if}(error)
1476          \textcolor{keywordflow}{return} error;
1477    \}
1478 
1479    \textcolor{comment}{//Total number of bytes that have been written}
1480    *written = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1481 
1482    \textcolor{comment}{//Successful processing}
1483    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1484 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a6a25188d938c0b892efc45bbce0b4c82}\label{x509__cert__create_8c_a6a25188d938c0b892efc45bbce0b4c82}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Tbs\+Certificate@{x509\+Format\+Tbs\+Certificate}}
\index{x509\+Format\+Tbs\+Certificate@{x509\+Format\+Tbs\+Certificate}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Tbs\+Certificate()}{x509FormatTbsCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Tbs\+Certificate (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{structX509SerialNumber}{X509\+Serial\+Number} $\ast$}]{serial\+Number,  }\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo,  }\item[{const \hyperlink{structX509Name}{X509\+Name} $\ast$}]{issuer,  }\item[{const \hyperlink{structX509Validity}{X509\+Validity} $\ast$}]{validity,  }\item[{const \hyperlink{structX509Name}{X509\+Name} $\ast$}]{subject,  }\item[{const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$}]{subject\+Public\+Key\+Info,  }\item[{const void $\ast$}]{public\+Key,  }\item[{const \hyperlink{structX509Extensions}{X509\+Extensions} $\ast$}]{extensions,  }\item[{const \hyperlink{structX509AuthorityKeyId}{X509\+Authority\+Key\+Id} $\ast$}]{auth\+Key\+Id,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format T\+B\+S\+Certificate structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em serial\+Number} & Serial number \\
\hline
\mbox{\tt in}  & {\em signature\+Algo} & Signature algorithm \\
\hline
\mbox{\tt in}  & {\em issuer} & Issuer\textquotesingle{}s name \\
\hline
\mbox{\tt in}  & {\em validity} & Validity period \\
\hline
\mbox{\tt in}  & {\em subject} & Subject\textquotesingle{}s name \\
\hline
\mbox{\tt in}  & {\em subject\+Public\+Key\+Info} & Subject\textquotesingle{}s public key information \\
\hline
\mbox{\tt in}  & {\em public\+Key} & Subject\textquotesingle{}s public key \\
\hline
\mbox{\tt in}  & {\em extensions} & X.\+509 certificates extensions \\
\hline
\mbox{\tt in}  & {\em auth\+Key\+Id} & Authority\+Key\+Identifier extension \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 228 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
234 \{
235    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
236    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
237    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
238    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
239    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
240    \hyperlink{structX509SubjectKeyId}{X509SubjectKeyId} subjectKeyId;
241    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} digest[\hyperlink{sha1_8h_a3ba9296b223f1b3c710d6b812fd860e8}{SHA1\_DIGEST\_SIZE}];
242 
243    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
244    p = output;
245    \textcolor{comment}{//Length of the ASN.1 structure}
246    length = 0;
247 
248    \textcolor{comment}{//Format Version field}
249    error = \hyperlink{x509__cert__create_8c_a60dc2ae12891195a8a6704cc2ca81248}{x509FormatVersion}(\hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26addaa01d4830baa29e7e19044f0a656eb}{X509\_VERSION\_3}, p, &n);
250    \textcolor{comment}{//Any error to report?}
251    \textcolor{keywordflow}{if}(error)
252       \textcolor{keywordflow}{return} error;
253 
254    \textcolor{comment}{//Advance data pointer}
255    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
256    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
257 
258    \textcolor{comment}{//Format SerialNumber field}
259    error = \hyperlink{x509__cert__create_8c_adf62b1f2c3c93683146f027d9eeca1bd}{x509FormatSerialNumber}(prngAlgo, prngContext, serialNumber, p, &n);
260    \textcolor{comment}{//Any error to report?}
261    \textcolor{keywordflow}{if}(error)
262       \textcolor{keywordflow}{return} error;
263 
264    \textcolor{comment}{//Advance data pointer}
265    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
266    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
267 
268    \textcolor{comment}{//Format Signature field}
269    error = \hyperlink{x509__cert__create_8c_a902ddc6c88855db5490c42a5974ab8fa}{x509FormatSignatureAlgo}(signatureAlgo, p, &n);
270    \textcolor{comment}{//Any error to report?}
271    \textcolor{keywordflow}{if}(error)
272       \textcolor{keywordflow}{return} error;
273 
274    \textcolor{comment}{//Advance data pointer}
275    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
276    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
277 
278    \textcolor{comment}{//Format Issuer field}
279    error = \hyperlink{x509__cert__create_8c_aca759ee4ba07227fa402f76e6cc6f096}{x509FormatName}(issuer, p, &n);
280    \textcolor{comment}{//Any error to report?}
281    \textcolor{keywordflow}{if}(error)
282       \textcolor{keywordflow}{return} error;
283 
284    \textcolor{comment}{//Advance data pointer}
285    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
286    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
287 
288    \textcolor{comment}{//Format Validity field}
289    error = \hyperlink{x509__cert__create_8c_ac287aebe03d5b2ae65b87a8aa5c1e2de}{x509FormatValidity}(validity, p, &n);
290    \textcolor{comment}{//Any error to report?}
291    \textcolor{keywordflow}{if}(error)
292       \textcolor{keywordflow}{return} error;
293 
294    \textcolor{comment}{//Advance data pointer}
295    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
296    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
297 
298    \textcolor{comment}{//Format Subject field}
299    error = \hyperlink{x509__cert__create_8c_aca759ee4ba07227fa402f76e6cc6f096}{x509FormatName}(subject, p, &n);
300    \textcolor{comment}{//Any error to report?}
301    \textcolor{keywordflow}{if}(error)
302       \textcolor{keywordflow}{return} error;
303 
304    \textcolor{comment}{//Advance data pointer}
305    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
306    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
307 
308    \textcolor{comment}{//Format SubjectPublicKeyInfo field}
309    error = \hyperlink{x509__key__format_8c_abbb03bcffd2633f46b56044c90372cd3}{x509FormatSubjectPublicKeyInfo}(subjectPublicKeyInfo, publicKey,
310       digest, p, &n);
311    \textcolor{comment}{//Any error to report?}
312    \textcolor{keywordflow}{if}(error)
313       \textcolor{keywordflow}{return} error;
314 
315    \textcolor{comment}{//Advance data pointer}
316    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
317    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
318 
319    \textcolor{comment}{//The SubjectKeyIdentifier extension provides a means of identifying}
320    \textcolor{comment}{//certificates that contain a particular public key}
321    subjectKeyId.\hyperlink{structX509SubjectKeyId_abae7eb488122b99c3413adb35d04d7f2}{critical} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
322    subjectKeyId.\hyperlink{structX509SubjectKeyId_ac13791883d5af3098c8fcecd596f4737}{value} = digest;
323    subjectKeyId.\hyperlink{structX509SubjectKeyId_ae72259e33329d3224c90547e63f95804}{length} = \hyperlink{sha1_8h_a3ba9296b223f1b3c710d6b812fd860e8}{SHA1\_DIGEST\_SIZE};
324 
325    \textcolor{comment}{//The Extensions field must only appear if the version is 3}
326    error = \hyperlink{x509__cert__create_8c_a46a26883a0eba55a8560789e03fa2979}{x509FormatExtensions}(extensions, &subjectKeyId, authKeyId, p, &n);
327    \textcolor{comment}{//Any error to report?}
328    \textcolor{keywordflow}{if}(error)
329       \textcolor{keywordflow}{return} error;
330 
331    \textcolor{comment}{//Advance data pointer}
332    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
333    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
334 
335    \textcolor{comment}{//The TBSCertificate structure is encapsulated within a sequence}
336    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
337    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
338    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
339    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
340    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
341 
342    \textcolor{comment}{//Write the corresponding ASN.1 tag}
343    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
344    \textcolor{comment}{//Any error to report?}
345    \textcolor{keywordflow}{if}(error)
346       \textcolor{keywordflow}{return} error;
347 
348    \textcolor{comment}{//Total number of bytes that have been written}
349    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
350 
351    \textcolor{comment}{//Successful processing}
352    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
353 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_aed4ae38a9e4efd397c672b0405018137}\label{x509__cert__create_8c_aed4ae38a9e4efd397c672b0405018137}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Time@{x509\+Format\+Time}}
\index{x509\+Format\+Time@{x509\+Format\+Time}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Time()}{x509FormatTime()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Time (\begin{DoxyParamCaption}\item[{const \hyperlink{structDateTime}{Date\+Time} $\ast$}]{date\+Time,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format U\+T\+C\+Time or Generalized\+Time field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em date\+Time} & Date to be encoded \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 778 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
780 \{
781    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
782    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
783    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
784    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
785    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} buffer[16];
786 
787    \textcolor{comment}{//UTCTime is limited to the period from 1950 to 2049}
788    \textcolor{keywordflow}{if}(dateTime->\hyperlink{structDateTime_a0a61d60280541502e47f9a7fd6e1c8d2}{year} >= 1950 && dateTime->\hyperlink{structDateTime_a0a61d60280541502e47f9a7fd6e1c8d2}{year} <= 2049)
789    \{
790       \textcolor{comment}{//Use UTCTime format}
791       type = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa9f9c0acd29e300911008f2f14d38603d}{ASN1\_TYPE\_UTC\_TIME};
792 
793       \textcolor{comment}{//The UTCTime uses a 2-digit representation of the year. If YY is greater}
794       \textcolor{comment}{//than or equal to 50, the year shall be interpreted as 19YY. If YY is}
795       \textcolor{comment}{//less than 50, the year shall be interpreted as 20YY}
796       sprintf(buffer, \textcolor{stringliteral}{"%02"} PRIu16 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8
797          \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"Z"},
798          dateTime->\hyperlink{structDateTime_a0a61d60280541502e47f9a7fd6e1c8d2}{year} % 100, dateTime->\hyperlink{structDateTime_ac895afb51c74941c50205f746b709148}{month}, dateTime->\hyperlink{structDateTime_a727866b5ecdfda1edf946efe86aa74af}{day},
799          dateTime->\hyperlink{structDateTime_a46fa4e0c13c7fc19c8ae97a5642c4a15}{hours}, dateTime->\hyperlink{structDateTime_a9e705a28fc51e333616553313107d579}{minutes}, dateTime->\hyperlink{structDateTime_a428828f757146b36432b4669e8b27eeb}{seconds});
800    \}
801    \textcolor{keywordflow}{else}
802    \{
803       \textcolor{comment}{//Use GeneralizedTime format}
804       type = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa27cd934568bfa45864e37d5ba434b3f9}{ASN1\_TYPE\_GENERALIZED\_TIME};
805 
806       \textcolor{comment}{//The GeneralizedTime uses a 4-digit representation of the year}
807       sprintf(buffer, \textcolor{stringliteral}{"%04"} PRIu16 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8
808          \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"%02"} PRIu8 \textcolor{stringliteral}{"Z"},
809          dateTime->\hyperlink{structDateTime_a0a61d60280541502e47f9a7fd6e1c8d2}{year}, dateTime->\hyperlink{structDateTime_ac895afb51c74941c50205f746b709148}{month}, dateTime->\hyperlink{structDateTime_a727866b5ecdfda1edf946efe86aa74af}{day},
810          dateTime->\hyperlink{structDateTime_a46fa4e0c13c7fc19c8ae97a5642c4a15}{hours}, dateTime->\hyperlink{structDateTime_a9e705a28fc51e333616553313107d579}{minutes}, dateTime->\hyperlink{structDateTime_a428828f757146b36432b4669e8b27eeb}{seconds});
811    \}
812 
813    \textcolor{comment}{//The date may be encoded as UTCTime or GeneralizedTime}
814    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
815    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
816    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
817    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{cyclone__crypto_2core_2crypto_8h_a60355e8a0b63bff69cedd877fc82c624}{cryptoStrlen}(buffer);
818    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) buffer;
819 
820    \textcolor{comment}{//Write the corresponding ASN.1 tag}
821    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
822    \textcolor{comment}{//Any error to report?}
823    \textcolor{keywordflow}{if}(error)
824       \textcolor{keywordflow}{return} error;
825 
826    \textcolor{comment}{//Total number of bytes that have been written}
827    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
828 
829    \textcolor{comment}{//Successful processing}
830    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
831 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_ac287aebe03d5b2ae65b87a8aa5c1e2de}\label{x509__cert__create_8c_ac287aebe03d5b2ae65b87a8aa5c1e2de}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Validity@{x509\+Format\+Validity}}
\index{x509\+Format\+Validity@{x509\+Format\+Validity}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Validity()}{x509FormatValidity()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Validity (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509Validity}{X509\+Validity} $\ast$}]{validity,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Validity structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em validity} & Validity period \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 715 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
717 \{
718    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
719    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
720    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
721    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
722    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
723 
724    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
725    p = output;
726    \textcolor{comment}{//Length of the ASN.1 structure}
727    length = 0;
728 
729    \textcolor{comment}{//The NotBefore field may be encoded as UTCTime or GeneralizedTime}
730    error = \hyperlink{x509__cert__create_8c_aed4ae38a9e4efd397c672b0405018137}{x509FormatTime}(&validity->\hyperlink{structX509Validity_a54d94f88fced1072aaacb4824757aee0}{notBefore}, p, &n);
731    \textcolor{comment}{//Any error to report?}
732    \textcolor{keywordflow}{if}(error)
733       \textcolor{keywordflow}{return} error;
734 
735    \textcolor{comment}{//Advance data pointer}
736    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
737    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
738 
739    \textcolor{comment}{//The NotAfter field may be encoded as UTCTime or GeneralizedTime}
740    error = \hyperlink{x509__cert__create_8c_aed4ae38a9e4efd397c672b0405018137}{x509FormatTime}(&validity->\hyperlink{structX509Validity_a23debc3797b2921431fce9658ecc1b73}{notAfter}, p, &n);
741    \textcolor{comment}{//Any error to report?}
742    \textcolor{keywordflow}{if}(error)
743       \textcolor{keywordflow}{return} error;
744 
745    \textcolor{comment}{//Advance data pointer}
746    p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
747    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
748 
749    \textcolor{comment}{//The Validity structure is encapsulated within a sequence}
750    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
751    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
752    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
753    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
754    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
755 
756    \textcolor{comment}{//Write the corresponding ASN.1 tag}
757    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
758    \textcolor{comment}{//Any error to report?}
759    \textcolor{keywordflow}{if}(error)
760       \textcolor{keywordflow}{return} error;
761 
762    \textcolor{comment}{//Total number of bytes that have been written}
763    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
764 
765    \textcolor{comment}{//Successful processing}
766    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
767 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_a60dc2ae12891195a8a6704cc2ca81248}\label{x509__cert__create_8c_a60dc2ae12891195a8a6704cc2ca81248}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Format\+Version@{x509\+Format\+Version}}
\index{x509\+Format\+Version@{x509\+Format\+Version}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Format\+Version()}{x509FormatVersion()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Format\+Version (\begin{DoxyParamCaption}\item[{\hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26}{X509\+Version}}]{version,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Version field. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em version} & Version number \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 364 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
366 \{
367    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
368    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
369    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
370 
371    \textcolor{comment}{//Encode the version number}
372    error = \hyperlink{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}{asn1WriteInt32}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version}, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
373    \textcolor{comment}{//Any error to report?}
374    \textcolor{keywordflow}{if}(error)
375       \textcolor{keywordflow}{return} error;
376 
377    \textcolor{comment}{//Explicit tagging shall be used to encode version}
378    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
379    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
380    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = 0;
381    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
382    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
383 
384    \textcolor{comment}{//Write the corresponding ASN.1 tag}
385    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
386    \textcolor{comment}{//Any error to report?}
387    \textcolor{keywordflow}{if}(error)
388       \textcolor{keywordflow}{return} error;
389 
390    \textcolor{comment}{//Total number of bytes that have been written}
391    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
392 
393    \textcolor{comment}{//Successful processing}
394    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
395 \}
\end{DoxyCode}
\mbox{\Hypertarget{x509__cert__create_8c_aa98a1f3f8ea1236bc8e78926e7fbb339}\label{x509__cert__create_8c_aa98a1f3f8ea1236bc8e78926e7fbb339}} 
\index{x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}!x509\+Generate\+Signature@{x509\+Generate\+Signature}}
\index{x509\+Generate\+Signature@{x509\+Generate\+Signature}!x509\+\_\+cert\+\_\+create.\+c@{x509\+\_\+cert\+\_\+create.\+c}}
\subsubsection{\texorpdfstring{x509\+Generate\+Signature()}{x509GenerateSignature()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} x509\+Generate\+Signature (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{tbs\+Cert,  }\item[{size\+\_\+t}]{tbs\+Cert\+Len,  }\item[{const \hyperlink{structX509SignatureAlgoId}{X509\+Signature\+Algo\+Id} $\ast$}]{signature\+Algo\+Id,  }\item[{const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$}]{public\+Key\+Info,  }\item[{const void $\ast$}]{private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Certificate signature generation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em tbs\+Cert} & Pointer to the T\+B\+S\+Certificate to be signed \\
\hline
\mbox{\tt in}  & {\em tbs\+Cert\+Len} & Length of the T\+B\+S\+Certificate, in bytes \\
\hline
\mbox{\tt in}  & {\em signature\+Algo\+Id} & Signature algorithm identifier \\
\hline
\mbox{\tt in}  & {\em public\+Key\+Info} & Signer\textquotesingle{}s public key information \\
\hline
\mbox{\tt in}  & {\em private\+Key} & Signer\textquotesingle{}s private key \\
\hline
\mbox{\tt out}  & {\em output} & Resulting signature \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting signature \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1924 of file x509\+\_\+cert\+\_\+create.\+c.


\begin{DoxyCode}
1928 \{
1929    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1930    \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078}{X509SignatureAlgo} signAlgo;
1931    \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
1932    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} digest[\hyperlink{pkix_2x509__common_8h_aaa7e393a09f334c6e3d573cff46ad6b0}{X509\_MAX\_HASH\_DIGEST\_SIZE}];
1933 
1934    \textcolor{comment}{//Retrieve the signature algorithm that will be used to sign the certificate}
1935    error = \hyperlink{certificate_2x509__common_8c_ac397a84e21ec7d1d10607d48aa9fdf54}{x509GetSignHashAlgo}(signatureAlgoId, &signAlgo, &hashAlgo);
1936    \textcolor{comment}{//Unsupported signature algorithm?}
1937    \textcolor{keywordflow}{if}(error)
1938       \textcolor{keywordflow}{return} error;
1939 
1940    \textcolor{comment}{//Ed25519 and Ed448 are used in PureEdDSA mode, without pre-hashing}
1941    \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1942    \{
1943       \textcolor{comment}{//Digest the TBSCertificate structure using the specified hash algorithm}
1944       error = hashAlgo->\hyperlink{structHashAlgo_af06e5499992d76f215cc8329a2d6cbb3}{compute}(tbsCert, tbsCertLen, digest);
1945       \textcolor{comment}{//Any error to report?}
1946       \textcolor{keywordflow}{if}(error)
1947          \textcolor{keywordflow}{return} error;
1948 
1949 \textcolor{preprocessor}{#if (X509\_RSA\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
1950       \textcolor{comment}{//RSA signature algorithm?}
1951       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aaa23c66e6e738231765cb534729eb144}{X509\_SIGN\_ALGO\_RSA})
1952       \{
1953          \textcolor{comment}{//Generate RSA signature}
1954          error = \hyperlink{rsa_8c_aa11231857578f3d094759dd7789015b8}{rsassaPkcs1v15Sign}(privateKey, hashAlgo, digest, output,
1955             written);
1956       \}
1957       \textcolor{keywordflow}{else}
1958 \textcolor{preprocessor}{#endif}
1959 \textcolor{preprocessor}{#if (X509\_RSA\_PSS\_SUPPORT == ENABLED && RSA\_SUPPORT == ENABLED)}
1960       \textcolor{comment}{//RSA-PSS signature algorithm?}
1961       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a}{X509\_SIGN\_ALGO\_RSA\_PSS})
1962       \{
1963          \textcolor{comment}{//Generate RSA-PSS signature}
1964          error = \hyperlink{rsa_8c_a2bc9405e58c8ce947d411cd9751e96b2}{rsassaPssSign}(prngAlgo, prngContext, privateKey, hashAlgo,
1965             signatureAlgoId->\hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}.\hyperlink{structX509RsaPssParameters_a0472b015828361df56b2550e4c1ac220}{saltLen}, digest, output, written);
1966       \}
1967       \textcolor{keywordflow}{else}
1968 \textcolor{preprocessor}{#endif}
1969 \textcolor{preprocessor}{#if (X509\_DSA\_SUPPORT == ENABLED && DSA\_SUPPORT == ENABLED)}
1970       \textcolor{comment}{//DSA signature algorithm?}
1971       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078aab93ed50739173cd96d39538379411da}{X509\_SIGN\_ALGO\_DSA})
1972       \{
1973          \hyperlink{structDsaSignature}{DsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
1974 
1975          \textcolor{comment}{//Initialize DSA signature}
1976          \hyperlink{dsa_8c_a6ebbad1e693d6967da33e2a1338912c7}{dsaInitSignature}(&signature);
1977 
1978          \textcolor{comment}{//Generate DSA signature}
1979          error = \hyperlink{dsa_8c_a8fd22ce221e40d536537ec45c8e89895}{dsaGenerateSignature}(prngAlgo, prngContext, privateKey,
1980             digest, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, &signature);
1981 
1982          \textcolor{comment}{//Check status code}
1983          \textcolor{keywordflow}{if}(!error)
1984          \{
1985             \textcolor{comment}{//Encode DSA signature using ASN.1}
1986             error = \hyperlink{dsa_8c_af4e812722524ed43ff16494d2f4ffbb5}{dsaWriteSignature}(&signature, output, written);
1987          \}
1988 
1989          \textcolor{comment}{//Release previously allocated resources}
1990          \hyperlink{dsa_8c_a78f8ff9636dd1677e22b637476c88e9d}{dsaFreeSignature}(&signature);
1991       \}
1992       \textcolor{keywordflow}{else}
1993 \textcolor{preprocessor}{#endif}
1994 \textcolor{preprocessor}{#if (X509\_ECDSA\_SUPPORT == ENABLED && ECDSA\_SUPPORT == ENABLED)}
1995       \textcolor{comment}{//ECDSA signature algorithm?}
1996       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078abef3275bb5075ac798ff19adb39cfb95}{X509\_SIGN\_ALGO\_ECDSA})
1997       \{
1998          \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
1999          \hyperlink{structEcDomainParameters}{EcDomainParameters} params;
2000          \hyperlink{structEcdsaSignature}{EcdsaSignature} \hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature};
2001 
2002          \textcolor{comment}{//Initialize EC domain parameters}
2003          \hyperlink{ec_8c_a5b5132fb8adf668ffa74ec10e7e63441}{ecInitDomainParameters}(&params);
2004          \textcolor{comment}{//Initialize ECDSA signature}
2005          \hyperlink{ecdsa_8c_aef8cd9a530146f44fc0597eb67480133}{ecdsaInitSignature}(&signature);
2006 
2007          \textcolor{comment}{//Retrieve EC domain parameters}
2008          curveInfo = \hyperlink{certificate_2x509__common_8c_a6f6416a69dd75fe6f18aab77a0f7205c}{x509GetCurveInfo}(publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.
      \hyperlink{structX509EcParameters_a122c5387fb2f12374a905ecfd2ca4c86}{namedCurve},
2009             publicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.\hyperlink{structX509EcParameters_ac58081bd63ed68d0cb101ff7e65667ec}{namedCurveLen});
2010 
2011          \textcolor{comment}{//Make sure the specified elliptic curve is supported}
2012          \textcolor{keywordflow}{if}(curveInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2013          \{
2014             \textcolor{comment}{//Load EC domain parameters}
2015             error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&params, curveInfo);
2016          \}
2017          \textcolor{keywordflow}{else}
2018          \{
2019             \textcolor{comment}{//Invalid EC domain parameters}
2020             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
2021          \}
2022 
2023          \textcolor{comment}{//Check status code}
2024          \textcolor{keywordflow}{if}(!error)
2025          \{
2026             \textcolor{comment}{//Generate ECDSA signature}
2027             error = \hyperlink{ecdsa_8c_a8f4a74d48b4e59e1682a6dc05fee42fe}{ecdsaGenerateSignature}(prngAlgo, prngContext, &params,
2028                privateKey, digest, hashAlgo->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize}, &signature);
2029          \}
2030 
2031          \textcolor{comment}{//Check status code}
2032          \textcolor{keywordflow}{if}(!error)
2033          \{
2034             \textcolor{comment}{//Encode ECDSA signature using ASN.1}
2035             error = \hyperlink{ecdsa_8c_a38bfa167c941721c005548c336c44d51}{ecdsaWriteSignature}(&signature, output, written);
2036          \}
2037 
2038          \textcolor{comment}{//Release previously allocated resources}
2039          \hyperlink{ec_8c_a256993c154cf87c3d9d18138a1365eca}{ecFreeDomainParameters}(&params);
2040          \hyperlink{ecdsa_8c_a6f4daa07ea8815b8c67b47c4b089d157}{ecdsaFreeSignature}(&signature);
2041       \}
2042       \textcolor{keywordflow}{else}
2043 \textcolor{preprocessor}{#endif}
2044       \textcolor{comment}{//Invalid signature algorithm?}
2045       \{
2046          \textcolor{comment}{//Report an error}
2047          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
2048       \}
2049    \}
2050    \textcolor{keywordflow}{else}
2051    \{
2052 \textcolor{preprocessor}{#if (X509\_ED25519\_SUPPORT == ENABLED && ED25519\_SUPPORT == ENABLED)}
2053       \textcolor{comment}{//Ed25519 signature algorithm?}
2054       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a34b6299ba091cde76553b23a7632da7f}{X509\_SIGN\_ALGO\_ED25519})
2055       \{
2056          \textcolor{keyword}{const} \hyperlink{structEddsaPrivateKey}{EddsaPrivateKey} *eddsaPrivateKey;
2057 
2058          \textcolor{comment}{//Point to the EdDSA private key}
2059          eddsaPrivateKey = (\textcolor{keyword}{const} \hyperlink{structEddsaPrivateKey}{EddsaPrivateKey} *) privateKey;
2060 
2061          \textcolor{comment}{//Check the length of the EdDSA private key}
2062          \textcolor{keywordflow}{if}(\hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&eddsaPrivateKey->\hyperlink{structEddsaPrivateKey_a58ef5164bc00df5a7ee8adc18fa2b63a}{d}) == 
      \hyperlink{ed25519_8h_aed3a21b9d4421f2fc69bc1dd92af50ab}{ED25519\_PRIVATE\_KEY\_LEN})
2063          \{
2064             \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} d[\hyperlink{ed25519_8h_aed3a21b9d4421f2fc69bc1dd92af50ab}{ED25519\_PRIVATE\_KEY\_LEN}];
2065 
2066             \textcolor{comment}{//Retrieve private key}
2067             error = \hyperlink{mpi_8c_aad846b0b5a3560243e1bf8601ad1b6a5}{mpiExport}(&eddsaPrivateKey->\hyperlink{structEddsaPrivateKey_a58ef5164bc00df5a7ee8adc18fa2b63a}{d}, d, 
      \hyperlink{ed25519_8h_aed3a21b9d4421f2fc69bc1dd92af50ab}{ED25519\_PRIVATE\_KEY\_LEN},
2068                \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
2069 
2070             \textcolor{comment}{//Check status code}
2071             \textcolor{keywordflow}{if}(!error)
2072             \{
2073                \textcolor{comment}{//Generate Ed25519 signature (PureEdDSA mode)}
2074                error = \hyperlink{ed25519_8c_ab4014bf39652bc11ca5ce38131705eef}{ed25519GenerateSignature}(d, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, tbsCert, tbsCertLen,
2075                   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, output);
2076             \}
2077 
2078             \textcolor{comment}{//Length of the resulting EdDSA signature}
2079             *written = \hyperlink{ed25519_8h_a6b45906484d3c938aef3a114e3d1a8ea}{ED25519\_SIGNATURE\_LEN};
2080          \}
2081          \textcolor{keywordflow}{else}
2082          \{
2083             \textcolor{comment}{//The length of the EdDSA private key is not valid}
2084             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
2085          \}
2086       \}
2087       \textcolor{keywordflow}{else}
2088 \textcolor{preprocessor}{#endif}
2089 \textcolor{preprocessor}{#if (X509\_ED448\_SUPPORT == ENABLED && ED448\_SUPPORT == ENABLED)}
2090       \textcolor{comment}{//Ed448 signature algorithm?}
2091       \textcolor{keywordflow}{if}(signAlgo == \hyperlink{certificate_2x509__common_8h_ac7f323ef3436e8cc3a89862a5e818078a258c2bcce0e685a5315ff975dc2f7c57}{X509\_SIGN\_ALGO\_ED448})
2092       \{
2093          \textcolor{keyword}{const} \hyperlink{structEddsaPrivateKey}{EddsaPrivateKey} *eddsaPrivateKey;
2094 
2095          \textcolor{comment}{//Point to the EdDSA private key}
2096          eddsaPrivateKey = (\textcolor{keyword}{const} \hyperlink{structEddsaPrivateKey}{EddsaPrivateKey} *) privateKey;
2097 
2098          \textcolor{comment}{//Check the length of the EdDSA private key}
2099          \textcolor{keywordflow}{if}(\hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&eddsaPrivateKey->\hyperlink{structEddsaPrivateKey_a58ef5164bc00df5a7ee8adc18fa2b63a}{d}) == 
      \hyperlink{ed448_8h_a26f2969270eebc560926f8bada35cb65}{ED448\_PRIVATE\_KEY\_LEN})
2100          \{
2101             \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} d[\hyperlink{ed448_8h_a26f2969270eebc560926f8bada35cb65}{ED448\_PRIVATE\_KEY\_LEN}];
2102 
2103             \textcolor{comment}{//Retrieve private key}
2104             error = \hyperlink{mpi_8c_aad846b0b5a3560243e1bf8601ad1b6a5}{mpiExport}(&eddsaPrivateKey->\hyperlink{structEddsaPrivateKey_a58ef5164bc00df5a7ee8adc18fa2b63a}{d}, d, 
      \hyperlink{ed448_8h_a26f2969270eebc560926f8bada35cb65}{ED448\_PRIVATE\_KEY\_LEN},
2105                \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
2106 
2107             \textcolor{comment}{//Check status code}
2108             \textcolor{keywordflow}{if}(!error)
2109             \{
2110                \textcolor{comment}{//Generate Ed448 signature (PureEdDSA mode)}
2111                error = \hyperlink{ed448_8c_a6c02071081eff48fb9e6c6b8c5342377}{ed448GenerateSignature}(d, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, tbsCert, tbsCertLen,
2112                   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, output);
2113             \}
2114 
2115             \textcolor{comment}{//Length of the resulting EdDSA signature}
2116             *written = \hyperlink{ed448_8h_a6faeb89fbb8744bcc8ec3333ec22b099}{ED448\_SIGNATURE\_LEN};
2117          \}
2118          \textcolor{keywordflow}{else}
2119          \{
2120             \textcolor{comment}{//The length of the EdDSA private key is not valid}
2121             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca31846fcd73423f08cca08d9acf9b3f8e}{ERROR\_INVALID\_KEY};
2122          \}
2123       \}
2124       \textcolor{keywordflow}{else}
2125 \textcolor{preprocessor}{#endif}
2126       \textcolor{comment}{//Invalid signature algorithm?}
2127       \{
2128          \textcolor{comment}{//Report an error}
2129          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4c54d9b14297edac328805943cf95795}{ERROR\_UNSUPPORTED\_SIGNATURE\_ALGO};
2130       \}
2131    \}
2132 
2133    \textcolor{comment}{//Return status code}
2134    \textcolor{keywordflow}{return} error;
2135 \}
\end{DoxyCode}
