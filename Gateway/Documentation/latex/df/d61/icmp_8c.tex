\hypertarget{icmp_8c}{}\section{cyclone\+\_\+tcp/ipv4/icmp.c File Reference}
\label{icmp_8c}\index{cyclone\+\_\+tcp/ipv4/icmp.\+c@{cyclone\+\_\+tcp/ipv4/icmp.\+c}}


I\+C\+MP (Internet Control Message Protocol)  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}core/ip.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv4/ipv4.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv4/ipv4\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv4/icmp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mibs/mib2\+\_\+module.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mibs/ip\+\_\+mib\+\_\+module.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{icmp_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a345c38d304c6ab234e8617a8fd0b12a6}{I\+C\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{icmp_8c_a0d8c46d0a65341dc6a7c85ff95e7cf51}{icmp\+Process\+Message} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4\+Pseudo\+Header} $\ast$request\+Pseudo\+Header, const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$buffer, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset})
\begin{DoxyCompactList}\small\item\em Incoming I\+C\+MP message processing. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_a063fa94357900cdc92a7a0cd2035b160}{icmp\+Process\+Echo\+Request} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4\+Pseudo\+Header} $\ast$request\+Pseudo\+Header, const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$request, size\+\_\+t request\+Offset)
\begin{DoxyCompactList}\small\item\em Echo Request message processing. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{icmp_8c_a9360e2c67e5001ebcceb50e81081901b}{icmp\+Send\+Error\+Message} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_a966576744a473fafb7687f8e5649941f}{code}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{icmpv6_8h_aa9b2b1016c7bcb4d12166681dcc74ced}{parameter}, const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$\hyperlink{ndp_8h_a6c97f605f59d957e1720030e1b1058e5}{ip\+Packet}, size\+\_\+t ip\+Packet\+Offset)
\begin{DoxyCompactList}\small\item\em Send an I\+C\+MP Error message. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_a22ee61774eaf9dc820e1b9a67ddea536}{icmp\+Update\+In\+Stats} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Update I\+C\+MP input statistics. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_afc67d9a328bc84a3ddca79deb4ce4952}{icmp\+Update\+Out\+Stats} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Update I\+C\+MP output statistics. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_a222d2cfe21803669cd4ddeabd4ff943a}{icmp\+Dump\+Message} (const \hyperlink{icmp_8h_a012c3d69fb14c394894b4a6ceaca1916}{Icmp\+Header} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message})
\begin{DoxyCompactList}\small\item\em Dump I\+C\+MP message for debugging purpose. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_a7b2f32460a64bde1e966e27f38a62d2c}{icmp\+Dump\+Echo\+Message} (const \hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{Icmp\+Echo\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message})
\begin{DoxyCompactList}\small\item\em Dump I\+C\+MP Echo Request or Echo Reply message. \end{DoxyCompactList}\item 
void \hyperlink{icmp_8c_a64a97435006bc1d6c252f013901bc5c7}{icmp\+Dump\+Error\+Message} (const \hyperlink{icmp_8h_a9f4870737700c51fb78e9c247c846e0c}{Icmp\+Error\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message})
\begin{DoxyCompactList}\small\item\em Dump generic I\+C\+MP Error message. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
I\+C\+MP (Internet Control Message Protocol) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{icmp_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{icmp_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{icmp.\+c@{icmp.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a345c38d304c6ab234e8617a8fd0b12a6}{I\+C\+M\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file icmp.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{icmp_8c_a7b2f32460a64bde1e966e27f38a62d2c}\label{icmp_8c_a7b2f32460a64bde1e966e27f38a62d2c}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Dump\+Echo\+Message@{icmp\+Dump\+Echo\+Message}}
\index{icmp\+Dump\+Echo\+Message@{icmp\+Dump\+Echo\+Message}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Dump\+Echo\+Message()}{icmpDumpEchoMessage()}}
{\footnotesize\ttfamily void icmp\+Dump\+Echo\+Message (\begin{DoxyParamCaption}\item[{const \hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{Icmp\+Echo\+Message} $\ast$}]{message }\end{DoxyParamCaption})}



Dump I\+C\+MP Echo Request or Echo Reply message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the I\+C\+MP message \\
\hline
\end{DoxyParams}


Definition at line 505 of file icmp.\+c.


\begin{DoxyCode}
506 \{
507    \textcolor{comment}{//Dump ICMP message}
508    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Type = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->type);
509    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Code = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->code);
510    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Checksum = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->checksum));
511    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Identifier = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(
      \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->identifier));
512    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Sequence Number = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(
      \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->sequenceNumber));
513 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a64a97435006bc1d6c252f013901bc5c7}\label{icmp_8c_a64a97435006bc1d6c252f013901bc5c7}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Dump\+Error\+Message@{icmp\+Dump\+Error\+Message}}
\index{icmp\+Dump\+Error\+Message@{icmp\+Dump\+Error\+Message}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Dump\+Error\+Message()}{icmpDumpErrorMessage()}}
{\footnotesize\ttfamily void icmp\+Dump\+Error\+Message (\begin{DoxyParamCaption}\item[{const \hyperlink{icmp_8h_a9f4870737700c51fb78e9c247c846e0c}{Icmp\+Error\+Message} $\ast$}]{message }\end{DoxyParamCaption})}



Dump generic I\+C\+MP Error message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the I\+C\+MP message \\
\hline
\end{DoxyParams}


Definition at line 521 of file icmp.\+c.


\begin{DoxyCode}
522 \{
523    \textcolor{comment}{//Dump ICMP message}
524    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Type = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->type);
525    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Code = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->code);
526    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Checksum = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->checksum));
527    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Parameter = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->parameter);
528 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a222d2cfe21803669cd4ddeabd4ff943a}\label{icmp_8c_a222d2cfe21803669cd4ddeabd4ff943a}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Dump\+Message@{icmp\+Dump\+Message}}
\index{icmp\+Dump\+Message@{icmp\+Dump\+Message}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Dump\+Message()}{icmpDumpMessage()}}
{\footnotesize\ttfamily void icmp\+Dump\+Message (\begin{DoxyParamCaption}\item[{const \hyperlink{icmp_8h_a012c3d69fb14c394894b4a6ceaca1916}{Icmp\+Header} $\ast$}]{message }\end{DoxyParamCaption})}



Dump I\+C\+MP message for debugging purpose. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the I\+C\+MP message \\
\hline
\end{DoxyParams}


Definition at line 491 of file icmp.\+c.


\begin{DoxyCode}
492 \{
493    \textcolor{comment}{//Dump ICMP message}
494    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Type = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->type);
495    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Code = %"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->code);
496    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Checksum = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->checksum));
497 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a063fa94357900cdc92a7a0cd2035b160}\label{icmp_8c_a063fa94357900cdc92a7a0cd2035b160}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Process\+Echo\+Request@{icmp\+Process\+Echo\+Request}}
\index{icmp\+Process\+Echo\+Request@{icmp\+Process\+Echo\+Request}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Process\+Echo\+Request()}{icmpProcessEchoRequest()}}
{\footnotesize\ttfamily void icmp\+Process\+Echo\+Request (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4\+Pseudo\+Header} $\ast$}]{request\+Pseudo\+Header,  }\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{request,  }\item[{size\+\_\+t}]{request\+Offset }\end{DoxyParamCaption})}



Echo Request message processing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em request\+Pseudo\+Header} & I\+Pv4 pseudo header \\
\hline
\mbox{\tt in}  & {\em request} & Multi-\/part buffer containing the incoming Echo Request message \\
\hline
\mbox{\tt in}  & {\em request\+Offset} & Offset to the first byte of the Echo Request message \\
\hline
\end{DoxyParams}


Definition at line 138 of file icmp.\+c.


\begin{DoxyCode}
141 \{
142    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
143    \textcolor{keywordtype}{size\_t} requestLength;
144    \textcolor{keywordtype}{size\_t} replyOffset;
145    \textcolor{keywordtype}{size\_t} replyLength;
146    \hyperlink{structNetBuffer}{NetBuffer} *reply;
147    \hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage} *requestHeader;
148    \hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage} *replyHeader;
149    \hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4PseudoHeader} replyPseudoHeader;
150 
151    \textcolor{comment}{//Retrieve the length of the Echo Request message}
152    requestLength = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(request) - requestOffset;
153 
154    \textcolor{comment}{//Ensure the packet length is correct}
155    \textcolor{keywordflow}{if}(requestLength < \textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage}))
156       \textcolor{keywordflow}{return};
157 
158    \textcolor{comment}{//Point to the Echo Request header}
159    requestHeader = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(request, requestOffset);
160    \textcolor{comment}{//Sanity check}
161    \textcolor{keywordflow}{if}(requestHeader == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
162       \textcolor{keywordflow}{return};
163 
164    \textcolor{comment}{//Debug message}
165    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"ICMP Echo Request message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      requestLength);
166    \textcolor{comment}{//Dump message contents for debugging purpose}
167    \hyperlink{icmp_8c_a7b2f32460a64bde1e966e27f38a62d2c}{icmpDumpEchoMessage}(requestHeader);
168 
169    \textcolor{comment}{//Check whether the destination address of the Echo Request message is}
170    \textcolor{comment}{//a broadcast or a multicast address}
171    \textcolor{keywordflow}{if}(\hyperlink{ipv4__misc_8c_a73422a205c437d811cf29972c3464e1c}{ipv4IsBroadcastAddr}(interface, requestPseudoHeader->destAddr) ||
172       \hyperlink{ipv4_8h_aada5b622e70acf16bd1cd5a9c08ea107}{ipv4IsMulticastAddr}(requestPseudoHeader->destAddr))
173    \{
174       \hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr} \hyperlink{mib__common_8h_a3860e959b1b7dd73686a6e11424805e2}{ipAddr};
175 
176       \textcolor{comment}{//If support for broadcast Echo Request messages has been explicitly}
177       \textcolor{comment}{//disabled, then the host shall not respond to the incoming request}
178       \textcolor{keywordflow}{if}(!interface->ipv4Context.enableBroadcastEchoReq)
179          \textcolor{keywordflow}{return};
180 
181       \textcolor{comment}{//The source address of the reply must be a unicast address belonging to}
182       \textcolor{comment}{//the interface on which the broadcast Echo Request message was received}
183       error = \hyperlink{ipv4__misc_8c_af1ec532996ca54986f87e67a354e03e1}{ipv4SelectSourceAddr}(&interface, requestPseudoHeader->srcAddr,
184          &ipAddr);
185       \textcolor{comment}{//Any error to report?}
186       \textcolor{keywordflow}{if}(error)
187          \textcolor{keywordflow}{return};
188 
189       \textcolor{comment}{//Copy the resulting source IP address}
190       replyPseudoHeader.srcAddr = \hyperlink{mib__common_8h_a3860e959b1b7dd73686a6e11424805e2}{ipAddr};
191    \}
192    \textcolor{keywordflow}{else}
193    \{
194       \textcolor{comment}{//The destination address of the Echo Request message is a unicast address}
195       replyPseudoHeader.srcAddr = requestPseudoHeader->destAddr;
196    \}
197 
198    \textcolor{comment}{//Allocate memory to hold the Echo Reply message}
199    reply = \hyperlink{ip_8c_a2222fb64b1b18140283119eea309c1b3}{ipAllocBuffer}(\textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage}), &replyOffset);
200    \textcolor{comment}{//Failed to allocate memory?}
201    \textcolor{keywordflow}{if}(reply == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
202       \textcolor{keywordflow}{return};
203 
204    \textcolor{comment}{//Point to the Echo Reply header}
205    replyHeader = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(reply, replyOffset);
206 
207    \textcolor{comment}{//Format Echo Reply header}
208    replyHeader->type = \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a8fcd1da1c798421c28f9098da07af8ee}{ICMP\_TYPE\_ECHO\_REPLY};
209    replyHeader->code = 0;
210    replyHeader->checksum = 0;
211    replyHeader->identifier = requestHeader->identifier;
212    replyHeader->sequenceNumber = requestHeader->sequenceNumber;
213 
214    \textcolor{comment}{//Point to the first data byte}
215    requestOffset += \textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage});
216    requestLength -= \textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a3a2d01bc5809641dfb0d13f0881f3bfd}{IcmpEchoMessage});
217 
218    \textcolor{comment}{//Copy data}
219    error = \hyperlink{net__mem_8c_aba4fe2d850142e40a9a668afeb2a0c8a}{netBufferConcat}(reply, request, requestOffset, requestLength);
220 
221    \textcolor{comment}{//Check status code}
222    \textcolor{keywordflow}{if}(!error)
223    \{
224       \textcolor{comment}{//Get the length of the resulting message}
225       replyLength = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(reply) - replyOffset;
226       \textcolor{comment}{//Calculate ICMP header checksum}
227       replyHeader->checksum = \hyperlink{ip_8c_a888dbaa377c95a06a4d511cb9ec4f278}{ipCalcChecksumEx}(reply, replyOffset, replyLength);
228 
229       \textcolor{comment}{//Format IPv4 pseudo header}
230       replyPseudoHeader.destAddr = requestPseudoHeader->srcAddr;
231       replyPseudoHeader.reserved = 0;
232       replyPseudoHeader.protocol = \hyperlink{ipv4_8h_a113cd13f7321e81a3f55491fa3b7db23ac5aacca18c7a215ac7084c5bcfdcc559}{IPV4\_PROTOCOL\_ICMP};
233       replyPseudoHeader.length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(replyLength);
234 
235       \textcolor{comment}{//Update ICMP statistics}
236       \hyperlink{icmp_8c_afc67d9a328bc84a3ddca79deb4ce4952}{icmpUpdateOutStats}(\hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a8fcd1da1c798421c28f9098da07af8ee}{ICMP\_TYPE\_ECHO\_REPLY});
237 
238       \textcolor{comment}{//Debug message}
239       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending ICMP Echo Reply message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      replyLength);
240       \textcolor{comment}{//Dump message contents for debugging purpose}
241       \hyperlink{icmp_8c_a7b2f32460a64bde1e966e27f38a62d2c}{icmpDumpEchoMessage}(replyHeader);
242 
243       \textcolor{comment}{//Send Echo Reply message}
244       \hyperlink{ipv4_8c_a26addbb0c6bcabe165be9d7b96c4b4b1}{ipv4SendDatagram}(interface, &replyPseudoHeader, reply, replyOffset,
245          \hyperlink{ipv4_8h_a23220cfb7e593785a73a64a092829228}{IPV4\_DEFAULT\_TTL});
246    \}
247 
248    \textcolor{comment}{//Free previously allocated memory block}
249    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(reply);
250 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a0d8c46d0a65341dc6a7c85ff95e7cf51}\label{icmp_8c_a0d8c46d0a65341dc6a7c85ff95e7cf51}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Process\+Message@{icmp\+Process\+Message}}
\index{icmp\+Process\+Message@{icmp\+Process\+Message}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Process\+Message()}{icmpProcessMessage()}}
{\footnotesize\ttfamily void icmp\+Process\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4\+Pseudo\+Header} $\ast$}]{request\+Pseudo\+Header,  }\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{offset }\end{DoxyParamCaption})}



Incoming I\+C\+MP message processing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em request\+Pseudo\+Header} & I\+Pv4 pseudo header \\
\hline
\mbox{\tt in}  & {\em buffer} & Multi-\/part buffer containing the incoming I\+C\+MP message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to the first byte of the I\+C\+MP message \\
\hline
\end{DoxyParams}


Definition at line 57 of file icmp.\+c.


\begin{DoxyCode}
60 \{
61    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
62    \hyperlink{icmp_8h_a012c3d69fb14c394894b4a6ceaca1916}{IcmpHeader} *header;
63 
64    \textcolor{comment}{//Total number of ICMP messages which the entity received}
65    \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInMsgs, 1);
66    \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpStats.icmpStatsInMsgs, 1);
67 
68    \textcolor{comment}{//Retrieve the length of the ICMP message}
69    length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(buffer) - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
70 
71    \textcolor{comment}{//Ensure the message length is correct}
72    \textcolor{keywordflow}{if}(length < \textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a012c3d69fb14c394894b4a6ceaca1916}{IcmpHeader}))
73    \{
74       \textcolor{comment}{//Number of ICMP messages which the entity received but determined}
75       \textcolor{comment}{//as having ICMP-specific errors}
76       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInErrors, 1);
77       \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpStats.icmpStatsInErrors, 1);
78 
79       \textcolor{comment}{//Silently discard incoming message}
80       \textcolor{keywordflow}{return};
81    \}
82 
83    \textcolor{comment}{//Point to the ICMP message header}
84    header = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
85    \textcolor{comment}{//Sanity check}
86    \textcolor{keywordflow}{if}(header == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
87       \textcolor{keywordflow}{return};
88 
89    \textcolor{comment}{//Debug message}
90    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"ICMP message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
91    \textcolor{comment}{//Dump message contents for debugging purpose}
92    \hyperlink{icmp_8c_a222d2cfe21803669cd4ddeabd4ff943a}{icmpDumpMessage}(header);
93 
94    \textcolor{comment}{//Verify checksum value}
95    \textcolor{keywordflow}{if}(\hyperlink{ip_8c_a888dbaa377c95a06a4d511cb9ec4f278}{ipCalcChecksumEx}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, length) != 0x0000)
96    \{
97       \textcolor{comment}{//Debug message}
98       \hyperlink{debug_8h_a72b9761add7486364dba449091cd2579}{TRACE\_WARNING}(\textcolor{stringliteral}{"Wrong ICMP header checksum!\(\backslash\)r\(\backslash\)n"});
99 
100       \textcolor{comment}{//Number of ICMP messages which the entity received but determined}
101       \textcolor{comment}{//as having ICMP-specific errors}
102       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInErrors, 1);
103       \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpStats.icmpStatsInErrors, 1);
104 
105       \textcolor{comment}{//Drop incoming message}
106       \textcolor{keywordflow}{return};
107    \}
108 
109    \textcolor{comment}{//Update ICMP statistics}
110    \hyperlink{icmp_8c_a22ee61774eaf9dc820e1b9a67ddea536}{icmpUpdateInStats}(header->type);
111 
112    \textcolor{comment}{//Check the type of ICMP message}
113    \textcolor{keywordflow}{switch}(header->type)
114    \{
115    \textcolor{comment}{//Echo Request?}
116    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a9625766a2a7b525a89a43044093e4199}{ICMP\_TYPE\_ECHO\_REQUEST}:
117       \textcolor{comment}{//Process Echo Request message}
118       \hyperlink{icmp_8c_a063fa94357900cdc92a7a0cd2035b160}{icmpProcessEchoRequest}(interface, requestPseudoHeader, buffer, 
      \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
119       \textcolor{keywordflow}{break};
120    \textcolor{comment}{//Unknown type?}
121    \textcolor{keywordflow}{default}:
122       \textcolor{comment}{//Debug message}
123       \hyperlink{debug_8h_a72b9761add7486364dba449091cd2579}{TRACE\_WARNING}(\textcolor{stringliteral}{"Unknown ICMP message type!\(\backslash\)r\(\backslash\)n"});
124       \textcolor{comment}{//Discard incoming ICMP message}
125       \textcolor{keywordflow}{break};
126    \}
127 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a9360e2c67e5001ebcceb50e81081901b}\label{icmp_8c_a9360e2c67e5001ebcceb50e81081901b}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Send\+Error\+Message@{icmp\+Send\+Error\+Message}}
\index{icmp\+Send\+Error\+Message@{icmp\+Send\+Error\+Message}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Send\+Error\+Message()}{icmpSendErrorMessage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} icmp\+Send\+Error\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{type,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{code,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{parameter,  }\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{ip\+Packet,  }\item[{size\+\_\+t}]{ip\+Packet\+Offset }\end{DoxyParamCaption})}



Send an I\+C\+MP Error message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em type} & Message type \\
\hline
\mbox{\tt in}  & {\em code} & Specific message code \\
\hline
\mbox{\tt in}  & {\em parameter} & Specific message parameter \\
\hline
\mbox{\tt in}  & {\em ip\+Packet} & Multi-\/part buffer that holds the invoking I\+Pv4 packet \\
\hline
\mbox{\tt in}  & {\em ip\+Packet\+Offset} & Offset to the first byte of the I\+Pv4 packet \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 264 of file icmp.\+c.


\begin{DoxyCode}
266 \{
267    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
268    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
269    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
270    \hyperlink{ipv4_8h_a294daf3717d3c22ffb24cbd3485ddbfc}{Ipv4Header} *ipHeader;
271    \hyperlink{structNetBuffer}{NetBuffer} *icmpMessage;
272    \hyperlink{icmp_8h_a9f4870737700c51fb78e9c247c846e0c}{IcmpErrorMessage} *icmpHeader;
273    \hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4PseudoHeader} pseudoHeader;
274 
275    \textcolor{comment}{//Retrieve the length of the invoking IPv4 packet}
276    length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(ipPacket) - ipPacketOffset;
277 
278    \textcolor{comment}{//Check the length of the IPv4 packet}
279    \textcolor{keywordflow}{if}(length < \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a294daf3717d3c22ffb24cbd3485ddbfc}{Ipv4Header}))
280       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
281 
282    \textcolor{comment}{//Point to the header of the invoking packet}
283    ipHeader = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(ipPacket, ipPacketOffset);
284    \textcolor{comment}{//Sanity check}
285    \textcolor{keywordflow}{if}(ipHeader == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
286       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
287 
288    \textcolor{comment}{//Never respond to a packet destined to a broadcast or a multicast address}
289    \textcolor{keywordflow}{if}(\hyperlink{ipv4__misc_8c_a73422a205c437d811cf29972c3464e1c}{ipv4IsBroadcastAddr}(interface, ipHeader->destAddr) ||
290       \hyperlink{ipv4_8h_aada5b622e70acf16bd1cd5a9c08ea107}{ipv4IsMulticastAddr}(ipHeader->destAddr))
291    \{
292       \textcolor{comment}{//Report an error}
293       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca21cbabf2c791471c05a9bc2710638aec}{ERROR\_INVALID\_ADDRESS};
294    \}
295 
296    \textcolor{comment}{//Length of the data that will be returned along with the ICMP header}
297    length = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(length, (\textcolor{keywordtype}{size\_t}) ipHeader->headerLength * 4 + 8);
298 
299    \textcolor{comment}{//Allocate a memory buffer to hold the ICMP message}
300    icmpMessage = \hyperlink{ip_8c_a2222fb64b1b18140283119eea309c1b3}{ipAllocBuffer}(\textcolor{keyword}{sizeof}(\hyperlink{icmp_8h_a9f4870737700c51fb78e9c247c846e0c}{IcmpErrorMessage}), &offset);
301    \textcolor{comment}{//Failed to allocate memory?}
302    \textcolor{keywordflow}{if}(icmpMessage == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
303       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
304 
305    \textcolor{comment}{//Point to the ICMP header}
306    icmpHeader = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(icmpMessage, offset);
307 
308    \textcolor{comment}{//Format ICMP message}
309    icmpHeader->type = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
310    icmpHeader->code = \hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code};
311    icmpHeader->checksum = 0;
312    icmpHeader->parameter = \hyperlink{icmp_8h_aa9b2b1016c7bcb4d12166681dcc74ced}{parameter};
313    icmpHeader->unused = 0;
314 
315    \textcolor{comment}{//Copy the IP header and the first 8 bytes of the original datagram data}
316    error = \hyperlink{net__mem_8c_aba4fe2d850142e40a9a668afeb2a0c8a}{netBufferConcat}(icmpMessage, ipPacket, ipPacketOffset, length);
317 
318    \textcolor{comment}{//Check status code}
319    \textcolor{keywordflow}{if}(!error)
320    \{
321       \textcolor{comment}{//Get the length of the resulting message}
322       length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(icmpMessage) - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
323       \textcolor{comment}{//Message checksum calculation}
324       icmpHeader->checksum = \hyperlink{ip_8c_a888dbaa377c95a06a4d511cb9ec4f278}{ipCalcChecksumEx}(icmpMessage, offset, length);
325 
326       \textcolor{comment}{//Format IPv4 pseudo header}
327       pseudoHeader.srcAddr = ipHeader->destAddr;
328       pseudoHeader.destAddr = ipHeader->srcAddr;
329       pseudoHeader.reserved = 0;
330       pseudoHeader.protocol = \hyperlink{ipv4_8h_a113cd13f7321e81a3f55491fa3b7db23ac5aacca18c7a215ac7084c5bcfdcc559}{IPV4\_PROTOCOL\_ICMP};
331       pseudoHeader.length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
332 
333       \textcolor{comment}{//Update ICMP statistics}
334       \hyperlink{icmp_8c_afc67d9a328bc84a3ddca79deb4ce4952}{icmpUpdateOutStats}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type});
335 
336       \textcolor{comment}{//Debug message}
337       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending ICMP Error message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
338       \textcolor{comment}{//Dump message contents for debugging purpose}
339       \hyperlink{icmp_8c_a64a97435006bc1d6c252f013901bc5c7}{icmpDumpErrorMessage}(icmpHeader);
340 
341       \textcolor{comment}{//Send ICMP Error message}
342       error = \hyperlink{ipv4_8c_a26addbb0c6bcabe165be9d7b96c4b4b1}{ipv4SendDatagram}(interface, &pseudoHeader, icmpMessage, offset,
343          \hyperlink{ipv4_8h_a23220cfb7e593785a73a64a092829228}{IPV4\_DEFAULT\_TTL});
344    \}
345 
346    \textcolor{comment}{//Free previously allocated memory}
347    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(icmpMessage);
348 
349    \textcolor{comment}{//Return status code}
350    \textcolor{keywordflow}{return} error;
351 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_a22ee61774eaf9dc820e1b9a67ddea536}\label{icmp_8c_a22ee61774eaf9dc820e1b9a67ddea536}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Update\+In\+Stats@{icmp\+Update\+In\+Stats}}
\index{icmp\+Update\+In\+Stats@{icmp\+Update\+In\+Stats}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Update\+In\+Stats()}{icmpUpdateInStats()}}
{\footnotesize\ttfamily void icmp\+Update\+In\+Stats (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{type }\end{DoxyParamCaption})}



Update I\+C\+MP input statistics. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em type} & I\+C\+MP message type \\
\hline
\end{DoxyParams}


Definition at line 359 of file icmp.\+c.


\begin{DoxyCode}
360 \{
361    \textcolor{comment}{//Check ICMP message type}
362    \textcolor{keywordflow}{switch}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type})
363    \{
364    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ae3e581726c20c4800a20b780a1b0f3a0}{ICMP\_TYPE\_DEST\_UNREACHABLE}:
365       \textcolor{comment}{//Number of ICMP Destination Unreachable messages received}
366       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInDestUnreachs, 1);
367       \textcolor{keywordflow}{break};
368    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ac6c6848528e6853bf9c0193ae3fca3f1}{ICMP\_TYPE\_TIME\_EXCEEDED}:
369       \textcolor{comment}{//Number of ICMP Time Exceeded messages received}
370       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInTimeExcds, 1);
371       \textcolor{keywordflow}{break};
372    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a7ec2350f8dc60095657c0d797fcdf8f8}{ICMP\_TYPE\_PARAM\_PROBLEM}:
373       \textcolor{comment}{//Number of ICMP Parameter Problem messages received}
374       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInParmProbs, 1);
375       \textcolor{keywordflow}{break};
376    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80af00b4df929aab6242a55dbfb042b8d06}{ICMP\_TYPE\_SOURCE\_QUENCH}:
377       \textcolor{comment}{//Number of ICMP Source Quench messages received}
378       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInSrcQuenchs, 1);
379       \textcolor{keywordflow}{break};
380    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ab54d526decab9df6ea1d70da718fda15}{ICMP\_TYPE\_REDIRECT}:
381       \textcolor{comment}{//Number of ICMP Redirect messages received}
382       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInRedirects, 1);
383       \textcolor{keywordflow}{break};
384    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a9625766a2a7b525a89a43044093e4199}{ICMP\_TYPE\_ECHO\_REQUEST}:
385       \textcolor{comment}{//Number of ICMP Echo Request messages received}
386       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInEchos, 1);
387       \textcolor{keywordflow}{break};
388    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80aa46d23314505417045d9f3d957e0f457}{ICMP\_TYPE\_INFO\_REPLY}:
389       \textcolor{comment}{//Number of ICMP Echo Reply messages received}
390       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInEchoReps, 1);
391       \textcolor{keywordflow}{break};
392    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a70042154af5bf024a21817ed737be713}{ICMP\_TYPE\_TIMESTAMP\_REQUEST}:
393       \textcolor{comment}{//Number of ICMP Timestamp Request messages received}
394       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInTimestamps, 1);
395       \textcolor{keywordflow}{break};
396    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a0b06cedc8c4ac9a4019a0deeb1c30a67}{ICMP\_TYPE\_TIMESTAMP\_REPLY}:
397       \textcolor{comment}{//Number of ICMP Timestamp Reply messages received}
398       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInTimestampReps, 1);
399       \textcolor{keywordflow}{break};
400    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ac83c603acdc17eb95d2a44157545311b}{ICMP\_TYPE\_ADDR\_MASK\_REQUEST}:
401       \textcolor{comment}{//Number of ICMP Address Mask Request messages received}
402       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInAddrMasks, 1);
403       \textcolor{keywordflow}{break};
404    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80acef9d4c0a84b226ba1bb8cb7bd29946c}{ICMP\_TYPE\_ADDR\_MASK\_REPLY}:
405       \textcolor{comment}{//Number of ICMP Address Mask Reply messages received}
406       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpInAddrMaskReps, 1);
407       \textcolor{keywordflow}{break};
408    \textcolor{keywordflow}{default}:
409       \textcolor{comment}{//Just for sanity}
410       \textcolor{keywordflow}{break};
411    \}
412 
413    \textcolor{comment}{//Increment per-message type ICMP counter}
414    \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpMsgStatsTable.icmpMsgStatsInPkts[
      \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type}], 1);
415 \}
\end{DoxyCode}
\mbox{\Hypertarget{icmp_8c_afc67d9a328bc84a3ddca79deb4ce4952}\label{icmp_8c_afc67d9a328bc84a3ddca79deb4ce4952}} 
\index{icmp.\+c@{icmp.\+c}!icmp\+Update\+Out\+Stats@{icmp\+Update\+Out\+Stats}}
\index{icmp\+Update\+Out\+Stats@{icmp\+Update\+Out\+Stats}!icmp.\+c@{icmp.\+c}}
\subsubsection{\texorpdfstring{icmp\+Update\+Out\+Stats()}{icmpUpdateOutStats()}}
{\footnotesize\ttfamily void icmp\+Update\+Out\+Stats (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{type }\end{DoxyParamCaption})}



Update I\+C\+MP output statistics. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em type} & I\+C\+M\+Pv6 message type \\
\hline
\end{DoxyParams}


Definition at line 423 of file icmp.\+c.


\begin{DoxyCode}
424 \{
425    \textcolor{comment}{//Total number of ICMP messages which this entity attempted to send}
426    \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutMsgs, 1);
427    \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpStats.icmpStatsOutMsgs, 1);
428 
429    \textcolor{comment}{//Check ICMP message type}
430    \textcolor{keywordflow}{switch}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type})
431    \{
432    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ae3e581726c20c4800a20b780a1b0f3a0}{ICMP\_TYPE\_DEST\_UNREACHABLE}:
433       \textcolor{comment}{//Number of ICMP Destination Unreachable messages sent}
434       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutDestUnreachs, 1);
435       \textcolor{keywordflow}{break};
436    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ac6c6848528e6853bf9c0193ae3fca3f1}{ICMP\_TYPE\_TIME\_EXCEEDED}:
437       \textcolor{comment}{//Number of ICMP Time Exceeded messages sent}
438       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutTimeExcds, 1);
439       \textcolor{keywordflow}{break};
440    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a7ec2350f8dc60095657c0d797fcdf8f8}{ICMP\_TYPE\_PARAM\_PROBLEM}:
441       \textcolor{comment}{//Number of ICMP Parameter Problem messages sent}
442       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutParmProbs, 1);
443       \textcolor{keywordflow}{break};
444    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80af00b4df929aab6242a55dbfb042b8d06}{ICMP\_TYPE\_SOURCE\_QUENCH}:
445       \textcolor{comment}{//Number of ICMP Source Quench messages sent}
446       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutSrcQuenchs, 1);
447       \textcolor{keywordflow}{break};
448    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ab54d526decab9df6ea1d70da718fda15}{ICMP\_TYPE\_REDIRECT}:
449       \textcolor{comment}{//Number of ICMP Redirect messages sent}
450       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutRedirects, 1);
451       \textcolor{keywordflow}{break};
452    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a9625766a2a7b525a89a43044093e4199}{ICMP\_TYPE\_ECHO\_REQUEST}:
453       \textcolor{comment}{//Number of ICMP Echo Request messages sent}
454       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutEchos, 1);
455       \textcolor{keywordflow}{break};
456    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80aa46d23314505417045d9f3d957e0f457}{ICMP\_TYPE\_INFO\_REPLY}:
457       \textcolor{comment}{//Number of ICMP Echo Reply messages sent}
458       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutEchoReps, 1);
459       \textcolor{keywordflow}{break};
460    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a70042154af5bf024a21817ed737be713}{ICMP\_TYPE\_TIMESTAMP\_REQUEST}:
461       \textcolor{comment}{//Number of ICMP Timestamp Request messages sent}
462       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutTimestamps, 1);
463       \textcolor{keywordflow}{break};
464    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80a0b06cedc8c4ac9a4019a0deeb1c30a67}{ICMP\_TYPE\_TIMESTAMP\_REPLY}:
465       \textcolor{comment}{//Number of ICMP Timestamp Reply messages sent}
466       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutTimestampReps, 1);
467       \textcolor{keywordflow}{break};
468    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80ac83c603acdc17eb95d2a44157545311b}{ICMP\_TYPE\_ADDR\_MASK\_REQUEST}:
469       \textcolor{comment}{//Number of ICMP Address Mask Request messages sent}
470       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutAddrMasks, 1);
471       \textcolor{keywordflow}{break};
472    \textcolor{keywordflow}{case} \hyperlink{icmp_8h_a19857c9f7d9a5734a6256d79d5abcf80acef9d4c0a84b226ba1bb8cb7bd29946c}{ICMP\_TYPE\_ADDR\_MASK\_REPLY}:
473       \textcolor{comment}{//Number of ICMP Address Mask Reply messages sent}
474       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(icmpGroup.icmpOutAddrMaskReps, 1);
475       \textcolor{keywordflow}{break};
476    \textcolor{keywordflow}{default}:
477       \textcolor{comment}{//Just for sanity}
478       \textcolor{keywordflow}{break};
479    \}
480 
481    \textcolor{comment}{//Increment per-message type ICMP counter}
482    \hyperlink{ip__mib__module_8h_abbb1f41624dcbd4f21b44932e338a479}{IP\_MIB\_INC\_COUNTER32}(icmpMsgStatsTable.icmpMsgStatsOutPkts[
      \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type}], 1);
483 \}
\end{DoxyCode}
