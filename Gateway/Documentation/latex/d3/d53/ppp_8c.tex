\hypertarget{ppp_8c}{}\section{cyclone\+\_\+tcp/ppp/ppp.c File Reference}
\label{ppp_8c}\index{cyclone\+\_\+tcp/ppp/ppp.\+c@{cyclone\+\_\+tcp/ppp/ppp.\+c}}


P\+PP (Point-\/to-\/\+Point Protocol)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp\+\_\+hdlc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/lcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipv6cp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/pap.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/chap.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ppp_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{ppp_8c_a58fa953a597d252f7a9d19aa9f613eeb}{ppp\+Get\+Default\+Settings} (\hyperlink{structPppSettings}{Ppp\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em Initialize settings with default values. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_ae9a22ab7fb2fcfb2bc0d9b6358343231}{ppp\+Init} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{structPppSettings}{Ppp\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em P\+PP initialization. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_a53171ddccab09e1fbaa68feae9d0b33e}{ppp\+Set\+Timeout} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} timeout)
\begin{DoxyCompactList}\small\item\em Set timeout value for blocking operations. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_a83be02b4725b3116300f52dd5fe89f96}{ppp\+Set\+Auth\+Info} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$username, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$password)
\begin{DoxyCompactList}\small\item\em Set P\+PP authentication information. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{ppp_8c_a28a74c023989184cfe69e14e69e64b31}{ppp\+Check\+Password} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$password)
\begin{DoxyCompactList}\small\item\em Password verification. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_a211aeda6e331e5f5163505913c6b57fe}{ppp\+Send\+At\+Command} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data})
\begin{DoxyCompactList}\small\item\em Send AT command. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_ae4b158f1002db1be9deb3737043f2f57}{ppp\+Receive\+At\+Command} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size)
\begin{DoxyCompactList}\small\item\em Wait for an incoming AT command. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_a5734fdcd49e2d5a9414db7e6b9c4fb25}{ppp\+Connect} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Establish a P\+PP connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_a26f8462aab221392d3ac781e0b99245a}{ppp\+Close} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Close a P\+PP connection. \end{DoxyCompactList}\item 
void \hyperlink{ppp_8c_a84c6cb03237408546372831dd59c3c52}{ppp\+Tick} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em P\+PP timer handler. \end{DoxyCompactList}\item 
void \hyperlink{ppp_8c_acf85af1268ca737c3e4b07d39befa40c}{ppp\+Process\+Frame} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$frame, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process an incoming P\+PP frame. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{ppp\+Send\+Frame} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$buffer, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Send a P\+PP frame. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{ppp_8c_ae896ec90ae7eca9ead89a74495a6e601}{ppp\+Parse\+Frame\+Header} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$frame, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$\hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Parse P\+PP frame header. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{ppp_8c_a57d411a503bd3cd2f7191bc9b9841e83}{ppp\+Calc\+Fcs} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em F\+CS calculation. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{ppp_8c_a6aa9d2b46ddfb23e723be17e3bc50770}{ppp\+Calc\+Fcs\+Ex} (const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$buffer, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Calculate F\+CS over a multi-\/part buffer. \end{DoxyCompactList}\item 
\hyperlink{structNetBuffer}{Net\+Buffer} $\ast$ \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{ppp\+Alloc\+Buffer} (size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$\hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset})
\begin{DoxyCompactList}\small\item\em Allocate a buffer to hold a P\+PP frame. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} \hyperlink{ppp_8c_ae978e425325a88275be9719a4cf28a01}{ppp\+Tick\+Counter}
\item 
static const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{ppp_8c_a4c2ec07a7827a39e2666be9cf3c88b47}{fcs\+Table} \mbox{[}256\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
P\+PP (Point-\/to-\/\+Point Protocol) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ppp_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ppp_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ppp.\+c@{ppp.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}



Definition at line 32 of file ppp.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ppp_8c_a9100186e00aec050c4952fd462b035aa}\label{ppp_8c_a9100186e00aec050c4952fd462b035aa}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Alloc\+Buffer@{ppp\+Alloc\+Buffer}}
\index{ppp\+Alloc\+Buffer@{ppp\+Alloc\+Buffer}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Alloc\+Buffer()}{pppAllocBuffer()}}
{\footnotesize\ttfamily \hyperlink{structNetBuffer}{Net\+Buffer}$\ast$ ppp\+Alloc\+Buffer (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{offset }\end{DoxyParamCaption})}



Allocate a buffer to hold a P\+PP frame. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em length} & Desired payload length \\
\hline
\mbox{\tt out}  & {\em offset} & Offset to the first byte of the payload \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns a pointer to the newly allocated buffer. If the system is out of resources, N\+U\+LL is returned 
\end{DoxyReturn}


Definition at line 1265 of file ppp.\+c.


\begin{DoxyCode}
1266 \{
1267    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
1268 
1269    \textcolor{comment}{//Allocate a buffer to hold the Ethernet header and the payload}
1270    buffer = \hyperlink{net__mem_8c_a986c9991e530e99528faa4c43efadc6f}{netBufferAlloc}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} + \hyperlink{ppp_8h_a0f47a9bc9ba33684c3f56ad9208f4612}{PPP\_FRAME\_HEADER\_SIZE});
1271    \textcolor{comment}{//Failed to allocate buffer?}
1272    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1273       \textcolor{keywordflow}{return} \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1274 
1275    \textcolor{comment}{//Offset to the first byte of the payload}
1276    *\hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} = \hyperlink{ppp_8h_a0f47a9bc9ba33684c3f56ad9208f4612}{PPP\_FRAME\_HEADER\_SIZE};
1277 
1278    \textcolor{comment}{//Return a pointer to the freshly allocated buffer}
1279    \textcolor{keywordflow}{return} buffer;
1280 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a57d411a503bd3cd2f7191bc9b9841e83}\label{ppp_8c_a57d411a503bd3cd2f7191bc9b9841e83}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Calc\+Fcs@{ppp\+Calc\+Fcs}}
\index{ppp\+Calc\+Fcs@{ppp\+Calc\+Fcs}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Calc\+Fcs()}{pppCalcFcs()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} ppp\+Calc\+Fcs (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



F\+CS calculation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Pointer to the data over which to calculate the F\+CS \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to process \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Resulting F\+CS value 
\end{DoxyReturn}


Definition at line 1180 of file ppp.\+c.


\begin{DoxyCode}
1181 \{
1182    \textcolor{keywordtype}{size\_t} i;
1183    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} fcs;
1184 
1185    \textcolor{comment}{//FCS preset value}
1186    fcs = 0xFFFF;
1187 
1188    \textcolor{comment}{//Loop through data}
1189    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i++)
1190    \{
1191       \textcolor{comment}{//The message is processed byte by byte}
1192       fcs = (fcs >> 8) ^ \hyperlink{ppp_8c_a4c2ec07a7827a39e2666be9cf3c88b47}{fcsTable}[(fcs & 0xFF) ^ \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i]];
1193    \}
1194 
1195    \textcolor{comment}{//Return 1's complement value}
1196    \textcolor{keywordflow}{return} ~fcs;
1197 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a6aa9d2b46ddfb23e723be17e3bc50770}\label{ppp_8c_a6aa9d2b46ddfb23e723be17e3bc50770}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Calc\+Fcs\+Ex@{ppp\+Calc\+Fcs\+Ex}}
\index{ppp\+Calc\+Fcs\+Ex@{ppp\+Calc\+Fcs\+Ex}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Calc\+Fcs\+Ex()}{pppCalcFcsEx()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} ppp\+Calc\+Fcs\+Ex (\begin{DoxyParamCaption}\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{offset,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Calculate F\+CS over a multi-\/part buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buffer} & Pointer to the multi-\/part buffer \\
\hline
\mbox{\tt in}  & {\em offset} & Offset from the beginning of the buffer \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to process \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Resulting F\+CS value 
\end{DoxyReturn}


Definition at line 1208 of file ppp.\+c.


\begin{DoxyCode}
1209 \{
1210    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1211    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1212    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} fcs;
1213    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1214 
1215    \textcolor{comment}{//FCS preset value}
1216    fcs = 0xFFFF;
1217 
1218    \textcolor{comment}{//Loop through data chunks}
1219    \textcolor{keywordflow}{for}(i = 0; i < buffer->\hyperlink{structNetBuffer_a43ab1f87d0236d4e01c19ff14f899618}{chunkCount} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0; i++)
1220    \{
1221       \textcolor{comment}{//Is there any data to process in the current chunk?}
1222       \textcolor{keywordflow}{if}(offset < buffer->chunk[i].\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
1223       \{
1224          \textcolor{comment}{//Point to the first data byte}
1225          p = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) buffer->\hyperlink{structNetBuffer_a5d399f3f37224030dcac9c4da3ca41eb}{chunk}[i].\hyperlink{structChunkDesc_a014aac6efdc5722e058a9b67ca5f8358}{address} + \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1226          \textcolor{comment}{//Compute the number of bytes to process}
1227          n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(buffer->\hyperlink{structNetBuffer_a5d399f3f37224030dcac9c4da3ca41eb}{chunk}[i].\hyperlink{structChunkDesc_a4bdd57a9363511126fe5cd6d30c51c81}{length} - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, length);
1228          \textcolor{comment}{//Adjust byte counter}
1229          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1230 
1231          \textcolor{comment}{//Process current chunk}
1232          \textcolor{keywordflow}{while}(n > 0)
1233          \{
1234             \textcolor{comment}{//The message is processed byte by byte}
1235             fcs = (fcs >> 8) ^ \hyperlink{ppp_8c_a4c2ec07a7827a39e2666be9cf3c88b47}{fcsTable}[(fcs & 0xFF) ^ *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}];
1236 
1237             \textcolor{comment}{//Next byte}
1238             p++;
1239             n--;
1240          \}
1241 
1242          \textcolor{comment}{//Process the next block from the start}
1243          \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} = 0;
1244       \}
1245       \textcolor{keywordflow}{else}
1246       \{
1247          \textcolor{comment}{//Skip the current chunk}
1248          \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} -= buffer->\hyperlink{structNetBuffer_a5d399f3f37224030dcac9c4da3ca41eb}{chunk}[i].\hyperlink{structChunkDesc_a4bdd57a9363511126fe5cd6d30c51c81}{length};
1249       \}
1250    \}
1251 
1252    \textcolor{comment}{//Return 1's complement value}
1253    \textcolor{keywordflow}{return} ~fcs;
1254 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a28a74c023989184cfe69e14e69e64b31}\label{ppp_8c_a28a74c023989184cfe69e14e69e64b31}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Check\+Password@{ppp\+Check\+Password}}
\index{ppp\+Check\+Password@{ppp\+Check\+Password}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Check\+Password()}{pppCheckPassword()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} ppp\+Check\+Password (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{password }\end{DoxyParamCaption})}



Password verification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em password} & N\+U\+L\+L-\/terminated string containing the password to be checked \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the password is valid, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 271 of file ppp.\+c.


\begin{DoxyCode}
272 \{
273    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} status;
274    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
275 
276    \textcolor{comment}{//Debug message}
277    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"PPP password verification...\(\backslash\)r\(\backslash\)n"});
278 
279    \textcolor{comment}{//The password has not been verified yet}
280    status = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
281 
282    \textcolor{comment}{//Point to the PPP context}
283    context = interface->pppContext;
284 
285    \textcolor{comment}{//Make sure PPP has been properly configured}
286    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
287    \{
288       \textcolor{comment}{//Check authentication protocol}
289       \textcolor{keywordflow}{if}(context->localConfig.authProtocol == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP})
290       \{
291 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
292          \textcolor{comment}{//PAP authentication protocol}
293          status = \hyperlink{pap_8c_ab8ed6527ded0112f6a485159ee442e9a}{papCheckPassword}(context, password);
294 \textcolor{preprocessor}{#endif}
295       \}
296       \textcolor{comment}{//CHAP authentication protocol?}
297       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->localConfig.authProtocol == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2ac0897e91a9ab8cedc751087ef1b65a1d}{PPP\_PROTOCOL\_CHAP})
298       \{
299 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
300          \textcolor{comment}{//CHAP authentication protocol}
301          status = \hyperlink{chap_8c_a788ef009a57f3ca195ff29d5bbbe85b9}{chapCheckPassword}(context, password);
302 \textcolor{preprocessor}{#endif}
303       \}
304    \}
305 
306    \textcolor{comment}{//Return TRUE is the password is valid, else FALSE}
307    \textcolor{keywordflow}{return} status;
308 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a26f8462aab221392d3ac781e0b99245a}\label{ppp_8c_a26f8462aab221392d3ac781e0b99245a}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Close@{ppp\+Close}}
\index{ppp\+Close@{ppp\+Close}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Close()}{pppClose()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Close (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Close a P\+PP connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 727 of file ppp.\+c.


\begin{DoxyCode}
728 \{
729    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
730    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
731 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
732    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
733    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} start;
734 \textcolor{preprocessor}{#endif}
735 
736    \textcolor{comment}{//Check parameters}
737    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
738       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
739    \textcolor{comment}{//Make sure PPP has been properly configured}
740    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
741       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
742 
743    \textcolor{comment}{//Point to the PPP context}
744    context = interface->pppContext;
745 
746    \textcolor{comment}{//Get exclusive access}
747    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
748 
749    \textcolor{comment}{//The link is no longer available for traffic}
750    error = \hyperlink{lcp_8c_a588713b9f40b510b652a2ef5fe564161}{lcpClose}(context);
751 
752    \textcolor{comment}{//Release exclusive access}
753    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
754 
755    \textcolor{comment}{//Any error to report?}
756    \textcolor{keywordflow}{if}(error)
757       \textcolor{keywordflow}{return} error;
758 
759 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
760    \textcolor{comment}{//Save current time}
761    start = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
762 
763    \textcolor{comment}{//Wait for the connection to be closed}
764    \textcolor{keywordflow}{while}(1)
765    \{
766       \textcolor{comment}{//Check current PPP phase}
767       \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD})
768       \{
769          \textcolor{comment}{//PPP connection is closed}
770          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
771          \textcolor{comment}{//Exit immediately}
772          \textcolor{keywordflow}{break};
773       \}
774 
775       \textcolor{comment}{//Check timeout value}
776       \textcolor{keywordflow}{if}(context->timeout != \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY})
777       \{
778          \textcolor{comment}{//Get current time}
779          time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
780 
781          \textcolor{comment}{//Check whether the timeout period has elapsed}
782          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, start + context->timeout) >= 0)
783          \{
784             \textcolor{comment}{//Report an error}
785             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
786             \textcolor{comment}{//Exit immediately}
787             \textcolor{keywordflow}{break};
788          \}
789       \}
790 
791       \textcolor{comment}{//Poll the state}
792       \hyperlink{os__port__chibios_8c_a69608590db97c707277aebf15be010e5}{osDelayTask}(\hyperlink{ppp_8h_aca6222e960eafa9531cbf7e0245e7b1c}{PPP\_POLLING\_INTERVAL});
793    \}
794 
795    \textcolor{comment}{//Failed to properly close the connection?}
796    \textcolor{keywordflow}{if}(error)
797    \{
798       \textcolor{comment}{//Get exclusive access}
799       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
800 
801       \textcolor{comment}{//Abort the PPP connection}
802       context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD};
803       context->lcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
804 
805 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
806       \textcolor{comment}{//Reset IPCP finite state machine}
807       context->ipcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
808 \textcolor{preprocessor}{#endif}
809 
810 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
811       \textcolor{comment}{//Reset IPV6CP finite state machine}
812       context->ipv6cpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
813 \textcolor{preprocessor}{#endif}
814 
815 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
816       \textcolor{comment}{//Abort PAP authentication process}
817       context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
818       context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
819 \textcolor{preprocessor}{#endif}
820 
821 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
822       \textcolor{comment}{//Abort CHAP authentication process}
823       context->chapFsm.localState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
824       context->chapFsm.peerState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
825 \textcolor{preprocessor}{#endif}
826 
827       \textcolor{comment}{//Release exclusive access}
828       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
829    \}
830 \textcolor{preprocessor}{#endif}
831 
832    \textcolor{comment}{//Return status code}
833    \textcolor{keywordflow}{return} error;
834 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a5734fdcd49e2d5a9414db7e6b9c4fb25}\label{ppp_8c_a5734fdcd49e2d5a9414db7e6b9c4fb25}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Connect@{ppp\+Connect}}
\index{ppp\+Connect@{ppp\+Connect}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Connect()}{pppConnect()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Connect (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Establish a P\+PP connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 459 of file ppp.\+c.


\begin{DoxyCode}
460 \{
461    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
462    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
463 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
464    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
465    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} start;
466 \textcolor{preprocessor}{#endif}
467 
468    \textcolor{comment}{//Check parameters}
469    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
470       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
471    \textcolor{comment}{//Make sure PPP has been properly configured}
472    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
473       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
474 
475    \textcolor{comment}{//Point to the PPP context}
476    context = interface->pppContext;
477 
478    \textcolor{comment}{//Get exclusive access}
479    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
480 
481    \textcolor{comment}{//Default PPP phase}
482    context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD};
483 
484    \textcolor{comment}{//Initialize LCP FSM}
485    context->lcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
486    context->lcpFsm.identifier = 0;
487    context->lcpFsm.restartCounter = 0;
488    context->lcpFsm.failureCounter = 0;
489 
490 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
491    \textcolor{comment}{//Initialize IPCP FSM}
492    context->ipcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
493    context->ipcpFsm.identifier = 0;
494    context->ipcpFsm.restartCounter = 0;
495    context->ipcpFsm.failureCounter = 0;
496 \textcolor{preprocessor}{#endif}
497 
498 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
499    \textcolor{comment}{//Initialize IPV6CP FSM}
500    context->ipv6cpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
501    context->ipv6cpFsm.identifier = 0;
502    context->ipv6cpFsm.restartCounter = 0;
503    context->ipv6cpFsm.failureCounter = 0;
504 \textcolor{preprocessor}{#endif}
505 
506    \textcolor{comment}{//Authentication has not been completed}
507    context->localAuthDone = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
508    context->peerAuthDone = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
509 
510 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
511    \textcolor{comment}{//Initialize PAP FSM}
512    context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
513    context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
514    context->papFsm.identifier = 0;
515    context->papFsm.restartCounter = 0;
516 \textcolor{preprocessor}{#endif}
517 
518 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
519    \textcolor{comment}{//Initialize CHAP FSM}
520    context->chapFsm.localState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
521    context->chapFsm.localIdentifier = 0;
522    context->chapFsm.peerState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
523    context->chapFsm.peerIdentifier = 0;
524 \textcolor{preprocessor}{#endif}
525 
526    \textcolor{comment}{//Default local configuration}
527    context->localConfig.mru = context->settings.mru;
528    context->localConfig.mruRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
529    context->localConfig.accm = context->settings.accm;
530    context->localConfig.accmRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
531    context->localConfig.authProtocol = 0;
532    context->localConfig.authAlgo = 0;
533    context->localConfig.authProtocolRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
534    context->localConfig.magicNumber = \hyperlink{ppp_8h_aed55c175e22cda3b4bdfa1965ecae0c8}{PPP\_DEFAULT\_MAGIC\_NUMBER};
535    context->localConfig.magicNumberRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
536    context->localConfig.pfc = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
537    context->localConfig.pfcRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
538    context->localConfig.acfc = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
539    context->localConfig.acfcRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
540 
541    \textcolor{comment}{//Check whether the other end of the PPP link must be authenticated}
542    \textcolor{keywordflow}{if}(context->settings.authCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
543    \{
544 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
545       \textcolor{comment}{//PAP provides an easy implementation of peer authentication}
546       \textcolor{keywordflow}{if}(context->settings.authProtocol & \hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a8725b1327c28c7103183935d108edfb4}{PPP\_AUTH\_PROTOCOL\_PAP})
547       \{
548          \textcolor{comment}{//Select PAP authentication protocol}
549          context->localConfig.authProtocol = \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP};
550       \}
551 \textcolor{preprocessor}{#endif}
552 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
553       \textcolor{comment}{//CHAP with MD5 ensures greater security in the implementation}
554       \textcolor{keywordflow}{if}(context->settings.authProtocol & \hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a9779a00f4c08df5f7436eb2641ee6649}{PPP\_AUTH\_PROTOCOL\_CHAP\_MD5})
555       \{
556          \textcolor{comment}{//Select CHAP with MD5 authentication protocol}
557          context->localConfig.authProtocol = \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2ac0897e91a9ab8cedc751087ef1b65a1d}{PPP\_PROTOCOL\_CHAP};
558          context->localConfig.authAlgo = \hyperlink{chap_8h_a6a6019b22b92730d95f488f291cc6dd0a16d4a6501df8b6b73b8702d02e36f1b2}{CHAP\_ALGO\_ID\_CHAP\_MD5};
559       \}
560 \textcolor{preprocessor}{#endif}
561    \}
562 
563    \textcolor{comment}{//Default peer's configuration}
564    context->peerConfig.mru = \hyperlink{ppp_8h_aafef0c86ab4acdbf353d2c64abc7d9a3}{PPP\_DEFAULT\_MRU};
565    context->peerConfig.accm = \hyperlink{ppp_8h_a9abac89eadc302964ae0f31556bf750d}{PPP\_DEFAULT\_ACCM};
566    context->peerConfig.authProtocol = 0;
567    context->peerConfig.magicNumber = \hyperlink{ppp_8h_aed55c175e22cda3b4bdfa1965ecae0c8}{PPP\_DEFAULT\_MAGIC\_NUMBER};
568    context->peerConfig.pfc = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
569    context->peerConfig.acfc = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
570 
571 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
572    \textcolor{comment}{//Default local configuration}
573    context->localConfig.ipAddr = interface->ipv4Context.addrList[0].addr;
574    context->localConfig.ipAddrRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
575    context->localConfig.primaryDns = interface->ipv4Context.dnsServerList[0];
576    context->localConfig.primaryDnsRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
577 
578 \textcolor{preprocessor}{#if (IPV4\_DNS\_SERVER\_LIST\_SIZE >= 2)}
579    context->localConfig.secondaryDns = interface->ipv4Context.dnsServerList[1];
580    context->localConfig.secondaryDnsRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
581 \textcolor{preprocessor}{#else}
582    context->localConfig.secondaryDns = \hyperlink{ipv4_8h_aa9d277a6ff68d361eaf48d6af73e78e8}{IPV4\_UNSPECIFIED\_ADDR};
583    context->localConfig.secondaryDnsRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
584 \textcolor{preprocessor}{#endif}
585 
586    \textcolor{comment}{//Manual primary DNS configuration?}
587    \textcolor{keywordflow}{if}(context->localConfig.primaryDns != \hyperlink{ipv4_8h_aa9d277a6ff68d361eaf48d6af73e78e8}{IPV4\_UNSPECIFIED\_ADDR})
588       context->localConfig.primaryDnsRejected = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
589 
590    \textcolor{comment}{//Manual secondary DNS configuration?}
591    \textcolor{keywordflow}{if}(context->localConfig.secondaryDns != \hyperlink{ipv4_8h_aa9d277a6ff68d361eaf48d6af73e78e8}{IPV4\_UNSPECIFIED\_ADDR})
592       context->localConfig.secondaryDnsRejected = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
593 
594    \textcolor{comment}{//Default peer's configuration}
595    context->peerConfig.ipAddr = interface->ipv4Context.addrList[0].defaultGateway;
596 \textcolor{preprocessor}{#endif}
597 
598 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
599    \textcolor{comment}{//Default local configuration}
600    \hyperlink{ethernet_8h_a6783be585acb900081b3e1864e2b08e8}{eui64CopyAddr}(&context->localConfig.interfaceId,
601       interface->ipv6Context.addrList[0].addr.b + 8);
602 
603    context->localConfig.interfaceIdRejected = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
604 
605    \textcolor{comment}{//Default peer's configuration}
606    \hyperlink{ethernet_8h_a6783be585acb900081b3e1864e2b08e8}{eui64CopyAddr}(&context->peerConfig.interfaceId,
607       interface->ipv6Context.routerList[0].addr.b + 8);
608 \textcolor{preprocessor}{#endif}
609 
610    \textcolor{comment}{//The link is available for traffic}
611    error = \hyperlink{lcp_8c_ac28b8ec8de588dc9eea42c8a73c8b273}{lcpOpen}(context);
612 
613    \textcolor{comment}{//Release exclusive access}
614    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
615 
616    \textcolor{comment}{//Any error to report?}
617    \textcolor{keywordflow}{if}(error)
618       \textcolor{keywordflow}{return} error;
619 
620 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
621    \textcolor{comment}{//Save current time}
622    start = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
623 
624    \textcolor{comment}{//Wait for the connection to be established}
625    \textcolor{keywordflow}{while}(1)
626    \{
627       \textcolor{comment}{//Check current PPP phase}
628       \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29ab0d3380ae163bae2a13438207f8f6adf}{PPP\_PHASE\_NETWORK})
629       \{
630 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
631          \textcolor{comment}{//Check current IPCP state}
632          \textcolor{keywordflow}{if}(context->ipcpFsm.state == \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca3a46b5a98c799ee1827ef8aa0ddc4d07}{PPP\_STATE\_9\_OPENED})
633          \{
634             \textcolor{comment}{//Connection successfully established}
635             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
636             \textcolor{comment}{//Exit immediately}
637             \textcolor{keywordflow}{break};
638          \}
639 \textcolor{preprocessor}{#endif}
640 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
641          \textcolor{comment}{//Check current IPV6CP state}
642          \textcolor{keywordflow}{if}(context->ipv6cpFsm.state == \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca3a46b5a98c799ee1827ef8aa0ddc4d07}{PPP\_STATE\_9\_OPENED})
643          \{
644             \textcolor{comment}{//Connection successfully established}
645             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
646             \textcolor{comment}{//Exit immediately}
647             \textcolor{keywordflow}{break};
648          \}
649 \textcolor{preprocessor}{#endif}
650       \}
651       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD})
652       \{
653          \textcolor{comment}{//Failed to establish connection}
654          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca0a6ba075ed4da57d15cfd4b151a2b3d6}{ERROR\_CONNECTION\_FAILED};
655          \textcolor{comment}{//Exit immediately}
656          \textcolor{keywordflow}{break};
657       \}
658 
659       \textcolor{comment}{//Check timeout value}
660       \textcolor{keywordflow}{if}(context->timeout != \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY})
661       \{
662          \textcolor{comment}{//Get current time}
663          time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
664 
665          \textcolor{comment}{//Check whether the timeout period has elapsed}
666          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, start + context->timeout) >= 0)
667          \{
668             \textcolor{comment}{//Report an error}
669             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
670             \textcolor{comment}{//Exit immediately}
671             \textcolor{keywordflow}{break};
672          \}
673       \}
674 
675       \textcolor{comment}{//Polling delay}
676       \hyperlink{os__port__chibios_8c_a69608590db97c707277aebf15be010e5}{osDelayTask}(\hyperlink{ppp_8h_aca6222e960eafa9531cbf7e0245e7b1c}{PPP\_POLLING\_INTERVAL});
677    \}
678 
679    \textcolor{comment}{//Failed to establish connection?}
680    \textcolor{keywordflow}{if}(error)
681    \{
682       \textcolor{comment}{//Get exclusive access}
683       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
684 
685       \textcolor{comment}{//Abort the PPP connection}
686       context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD};
687       context->lcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
688 
689 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
690       \textcolor{comment}{//Reset IPCP finite state machine}
691       context->ipcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
692 \textcolor{preprocessor}{#endif}
693 
694 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
695       \textcolor{comment}{//Reset IPV6CP finite state machine}
696       context->ipv6cpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
697 \textcolor{preprocessor}{#endif}
698 
699 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
700       \textcolor{comment}{//Abort PAP authentication process}
701       context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
702       context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
703 \textcolor{preprocessor}{#endif}
704 
705 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
706       \textcolor{comment}{//Abort CHAP authentication process}
707       context->chapFsm.localState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
708       context->chapFsm.peerState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
709 \textcolor{preprocessor}{#endif}
710 
711       \textcolor{comment}{//Release exclusive access}
712       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
713    \}
714 \textcolor{preprocessor}{#endif}
715 
716    \textcolor{comment}{//Return status code}
717    \textcolor{keywordflow}{return} error;
718 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a58fa953a597d252f7a9d19aa9f613eeb}\label{ppp_8c_a58fa953a597d252f7a9d19aa9f613eeb}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Get\+Default\+Settings@{ppp\+Get\+Default\+Settings}}
\index{ppp\+Get\+Default\+Settings@{ppp\+Get\+Default\+Settings}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Get\+Default\+Settings()}{pppGetDefaultSettings()}}
{\footnotesize\ttfamily void ppp\+Get\+Default\+Settings (\begin{DoxyParamCaption}\item[{\hyperlink{structPppSettings}{Ppp\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



Initialize settings with default values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em settings} & Structure that contains P\+PP settings \\
\hline
\end{DoxyParams}


Definition at line 96 of file ppp.\+c.


\begin{DoxyCode}
97 \{
98    \textcolor{comment}{//Use default interface}
99    settings->\hyperlink{structPppSettings_a41a15a72350cde4438f491ddba81008a}{interface} = \hyperlink{net_8c_a991aba7eae4de79f30c6889d95cc6870}{netGetDefaultInterface}();
100 
101    \textcolor{comment}{//Default MRU}
102    settings->\hyperlink{structPppSettings_a6a19b72b250787099c5e704dbadcdce0}{mru} = \hyperlink{ppp_8h_aafef0c86ab4acdbf353d2c64abc7d9a3}{PPP\_DEFAULT\_MRU};
103    \textcolor{comment}{//Default async control character map}
104    settings->\hyperlink{structPppSettings_a5b90c3b4cf91d8ad6ed514b72fe5df06}{accm} = \hyperlink{ppp_8h_a9abac89eadc302964ae0f31556bf750d}{PPP\_DEFAULT\_ACCM};
105    \textcolor{comment}{//Allowed authentication protocols}
106    settings->\hyperlink{structPppSettings_a81721d1a0829cda028bee35921661eb6}{authProtocol} = \hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a8725b1327c28c7103183935d108edfb4}{PPP\_AUTH\_PROTOCOL\_PAP} | 
      \hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a9779a00f4c08df5f7436eb2641ee6649}{PPP\_AUTH\_PROTOCOL\_CHAP\_MD5};
107 
108    \textcolor{comment}{//Random data generation callback function}
109    settings->\hyperlink{structPppSettings_a1c589432617efd3704cfb709256d0210}{randCallback} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
110    \textcolor{comment}{//PPP authentication callback function}
111    settings->\hyperlink{structPppSettings_a4b619da9280c64b1494efa226a1cdf07}{authCallback} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
112 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_ae9a22ab7fb2fcfb2bc0d9b6358343231}\label{ppp_8c_ae9a22ab7fb2fcfb2bc0d9b6358343231}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Init@{ppp\+Init}}
\index{ppp\+Init@{ppp\+Init}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Init()}{pppInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structPppSettings}{Ppp\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



P\+PP initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the P\+PP context \\
\hline
\mbox{\tt in}  & {\em settings} & P\+PP specific settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 122 of file ppp.\+c.


\begin{DoxyCode}
123 \{
124    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
125    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
126 
127    \textcolor{comment}{//Debug message}
128    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"PPP initialization\(\backslash\)r\(\backslash\)n"});
129 
130    \textcolor{comment}{//Underlying network interface}
131    \textcolor{keyword}{interface }= settings->interface;
132 
133    \textcolor{comment}{//Initialize PPP context}
134    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext}));
135 
136    \textcolor{comment}{//Save user settings}
137    context->settings = *settings;
138 
139 \textcolor{preprocessor}{#if (PAP\_SUPPORT == DISABLED)}
140    \textcolor{comment}{//PAP authentication is not supported}
141    context->settings.\hyperlink{structPppSettings_a81721d1a0829cda028bee35921661eb6}{authProtocol} &= ~\hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a8725b1327c28c7103183935d108edfb4}{PPP\_AUTH\_PROTOCOL\_PAP};
142 \textcolor{preprocessor}{#endif}
143 
144 \textcolor{preprocessor}{#if (PAP\_SUPPORT == DISABLED)}
145    \textcolor{comment}{//CHAP with MD5 authentication is not supported}
146    context->settings.authProtocol &= ~\hyperlink{ppp_8h_a9015267d0befaf7905376607634aead6a9779a00f4c08df5f7436eb2641ee6649}{PPP\_AUTH\_PROTOCOL\_CHAP\_MD5};
147 \textcolor{preprocessor}{#endif}
148 
149    \textcolor{comment}{//Attach the PPP context to the network interface}
150    interface->pppContext = context;
151 
152    \textcolor{comment}{//Initialize structure}
153    context->interface = interface;
154    context->timeout = \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY};
155 
156    \textcolor{comment}{//Initialize PPP finite state machine}
157    context->pppPhase = \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD};
158    context->lcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
159 
160 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
161    \textcolor{comment}{//Initialize IPCP finite state machine}
162    context->ipcpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
163 \textcolor{preprocessor}{#endif}
164 
165 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
166    \textcolor{comment}{//Initialize IPV6CP finite state machine}
167    context->ipv6cpFsm.state = \hyperlink{ppp_8h_a4cd9e6fb37bf811037ccb89b4f314bbca209062413b1ed1b40756deb6f417fb32}{PPP\_STATE\_0\_INITIAL};
168 \textcolor{preprocessor}{#endif}
169 
170 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
171    \textcolor{comment}{//Initialize PAP finite state machine}
172    context->papFsm.localState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
173    context->papFsm.peerState = \hyperlink{pap_8h_aa24c12abc2d3ea39d6a2164f88b5a0e9a32de5973be2deca58cfb300905aaca3e}{PAP\_STATE\_0\_INITIAL};
174 \textcolor{preprocessor}{#endif}
175 
176 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
177    \textcolor{comment}{//Initialize CHAP finite state machine}
178    context->chapFsm.localState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
179    context->chapFsm.peerState = \hyperlink{chap_8h_a3bdf094cadf998921f2dc76942809bc8abe2c63d482b5edcbc36ded67c10953d8}{CHAP\_STATE\_0\_INITIAL};
180 \textcolor{preprocessor}{#endif}
181 
182    \textcolor{comment}{//Attach PPP HDLC driver}
183    error = \hyperlink{net_8c_a121c90cb72825dd4bacd3f2d1da7d2d6}{netSetDriver}(interface, &\hyperlink{ppp__hdlc_8c_a6db1370f80a5ab501dcab63dbed46812}{pppHdlcDriver});
184 
185    \textcolor{comment}{//Return status code}
186    \textcolor{keywordflow}{return} error;
187 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_ae896ec90ae7eca9ead89a74495a6e601}\label{ppp_8c_ae896ec90ae7eca9ead89a74495a6e601}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Parse\+Frame\+Header@{ppp\+Parse\+Frame\+Header}}
\index{ppp\+Parse\+Frame\+Header@{ppp\+Parse\+Frame\+Header}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Parse\+Frame\+Header()}{pppParseFrameHeader()}}
{\footnotesize\ttfamily size\+\_\+t ppp\+Parse\+Frame\+Header (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{frame,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} $\ast$}]{protocol }\end{DoxyParamCaption})}



Parse P\+PP frame header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em frame} & Pointer to the P\+PP frame \\
\hline
\mbox{\tt in}  & {\em length} & Length of the frame, in bytes \\
\hline
\mbox{\tt out}  & {\em protocol} & Value of the Protocol field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
If the P\+PP header was successfully parsed, the function returns the size of the P\+PP header, in bytes. If a parsing error occurred, zero is returned 
\end{DoxyReturn}


Definition at line 1108 of file ppp.\+c.


\begin{DoxyCode}
1109 \{
1110    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1111 
1112    \textcolor{comment}{//Size of the PPP header, in bytes}
1113    n = 0;
1114 
1115    \textcolor{comment}{//On reception, the Address and Control fields are decompressed by}
1116    \textcolor{comment}{//examining the first two octets}
1117    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= 2)
1118    \{
1119       \textcolor{comment}{//If they contain the values 0xff and 0x03, they are assumed to be}
1120       \textcolor{comment}{//the Address and Control fields. If not, it is assumed that the}
1121       \textcolor{comment}{//fields were compressed and were not transmitted}
1122       \textcolor{keywordflow}{if}(frame[0] == \hyperlink{ppp_8h_a6bf9b573c61dad0116281ea0a0d704bb}{PPP\_ADDR\_FIELD} && frame[1] == \hyperlink{ppp_8h_a19db537819c722f453349fd41196f9c3}{PPP\_CTRL\_FIELD})
1123       \{
1124          \textcolor{comment}{//Move to the Protocol field}
1125          n = 2;
1126       \}
1127    \}
1128 
1129    \textcolor{comment}{//Check the length of the PPP frame}
1130    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= (n + 1))
1131    \{
1132       \textcolor{comment}{//PPP Protocol field numbers are chosen such that some values may be}
1133       \textcolor{comment}{//compressed into a single octet form which is clearly distinguishable}
1134       \textcolor{comment}{//from the two octet form}
1135       \textcolor{keywordflow}{if}(frame[n] & 0x01)
1136       \{
1137          \textcolor{comment}{//The presence of a binary 1 as the LSB marks the last octet of}
1138          \textcolor{comment}{//the Protocol field}
1139          *\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} = frame[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}];
1140 
1141          \textcolor{comment}{//Update the length of the header}
1142          n++;
1143       \}
1144       \textcolor{keywordflow}{else}
1145       \{
1146          \textcolor{comment}{//Check the length of the PPP frame}
1147          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} >= (n + 2))
1148          \{
1149             \textcolor{comment}{//The Protocol field is not compressed}
1150             *\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} = (frame[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] << 8) | frame[n + 1];
1151 
1152             \textcolor{comment}{//Update the length of the header}
1153             n += 2;
1154          \}
1155          \textcolor{keywordflow}{else}
1156          \{
1157             \textcolor{comment}{//Malformed PPP frame}
1158             n = 0;
1159          \}
1160       \}
1161    \}
1162    \textcolor{keywordflow}{else}
1163    \{
1164       \textcolor{comment}{//Malformed PPP frame}
1165       n = 0;
1166    \}
1167 
1168    \textcolor{comment}{//Return the size of the PPP header, in bytes}
1169    \textcolor{keywordflow}{return} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1170 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_acf85af1268ca737c3e4b07d39befa40c}\label{ppp_8c_acf85af1268ca737c3e4b07d39befa40c}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Process\+Frame@{ppp\+Process\+Frame}}
\index{ppp\+Process\+Frame@{ppp\+Process\+Frame}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Process\+Frame()}{pppProcessFrame()}}
{\footnotesize\ttfamily void ppp\+Process\+Frame (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{frame,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process an incoming P\+PP frame. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em frame} & Incoming P\+PP frame to process \\
\hline
\mbox{\tt in}  & {\em length} & Total frame length \\
\hline
\end{DoxyParams}


Definition at line 889 of file ppp.\+c.


\begin{DoxyCode}
890 \{
891    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
892    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol};
893    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
894 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
895    \hyperlink{structNetBuffer1}{NetBuffer1} buffer;
896 \textcolor{preprocessor}{#endif}
897 
898    \textcolor{comment}{//Point to the PPP context}
899    context = interface->pppContext;
900 
901    \textcolor{comment}{//Check the length of the PPP frame}
902    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \hyperlink{ppp_8h_ac2e55a55a1df4bfe475c61a5b4e646cd}{PPP\_FCS\_SIZE})
903       \textcolor{keywordflow}{return};
904 
905    \textcolor{comment}{//Debug message}
906    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"PPP frame received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
907 
908    \textcolor{comment}{//The value of the residue is 0x0F47 when no FCS errors are detected}
909    \textcolor{keywordflow}{if}(\hyperlink{ppp_8c_a57d411a503bd3cd2f7191bc9b9841e83}{pppCalcFcs}(frame, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}) != 0x0F47)
910    \{
911       \textcolor{comment}{//Debug message}
912       \hyperlink{debug_8h_a72b9761add7486364dba449091cd2579}{TRACE\_WARNING}(\textcolor{stringliteral}{"Wrong FCS detected!\(\backslash\)r\(\backslash\)n"});
913       \textcolor{comment}{//Drop the received frame}
914       \textcolor{keywordflow}{return};
915    \}
916 
917    \textcolor{comment}{//Calculate the length of PPP frame excluding the FCS field}
918    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{ppp_8h_ac2e55a55a1df4bfe475c61a5b4e646cd}{PPP\_FCS\_SIZE};
919 
920    \textcolor{comment}{//Decompress the frame header}
921    n = \hyperlink{ppp_8c_ae896ec90ae7eca9ead89a74495a6e601}{pppParseFrameHeader}(frame, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &protocol);
922    \textcolor{comment}{//Malformed PPP frame?}
923    \textcolor{keywordflow}{if}(!n)
924       \textcolor{keywordflow}{return};
925 
926    \textcolor{comment}{//Point to the payload field}
927    frame += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
928    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
929 
930    \textcolor{comment}{//Check protocol field}
931    \textcolor{keywordflow}{switch}(protocol)
932    \{
933    \textcolor{comment}{//Link control protocol?}
934    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2aa16ec94a0acadd78f8c120d8bdd45dc5}{PPP\_PROTOCOL\_LCP}:
935       \textcolor{comment}{//Process incoming LCP packet}
936       \hyperlink{lcp_8c_afb2003c0d7a0aba04ebed21f6c9ed7f5}{lcpProcessPacket}(context, (\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
937       \textcolor{keywordflow}{break};
938 
939 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
940    \textcolor{comment}{//IP control protocol?}
941    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2a1dbae0b4db670646438954a53f57254a}{PPP\_PROTOCOL\_IPCP}:
942       \textcolor{comment}{//Process incoming IPCP packet}
943       \hyperlink{ipcp_8c_a7606087c70322577cbfd6d2a0b6bf74b}{ipcpProcessPacket}(context, (\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
944       \textcolor{keywordflow}{break};
945    \textcolor{comment}{//IP protocol?}
946    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2ab7bc5a54ca81625aa54dbe2b3fc6ffbb}{PPP\_PROTOCOL\_IP}:
947       \textcolor{comment}{//Process incoming IPv4 packet}
948       \hyperlink{ipv4_8c_a56bd5279686b3415f88d758b6a548978}{ipv4ProcessPacket}(interface, (\hyperlink{ipv4_8h_a294daf3717d3c22ffb24cbd3485ddbfc}{Ipv4Header} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
949       \textcolor{keywordflow}{break};
950 \textcolor{preprocessor}{#endif}
951 
952 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
953    \textcolor{comment}{//IPv6 control protocol?}
954    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2abc85aaca4959631f37902c4c8f34146a}{PPP\_PROTOCOL\_IPV6CP}:
955       \textcolor{comment}{//Process incoming IPV6CP packet}
956       \hyperlink{ipv6cp_8c_a2affb96ff3fd10841c3a2b1508a2fcb6}{ipv6cpProcessPacket}(context, (\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
957       \textcolor{keywordflow}{break};
958    \textcolor{comment}{//IPv6 protocol?}
959    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2af1df03be97aa4a98a941e011c9fedcbd}{PPP\_PROTOCOL\_IPV6}:
960       \textcolor{comment}{//The incoming PPP frame fits in a single chunk}
961       buffer.\hyperlink{structNetBuffer1_a05cff68539009da3dd878a7b7d38e1e6}{chunkCount} = 1;
962       buffer.\hyperlink{structNetBuffer1_a17baf9f6d2d0ea0520a6ee1b00e954de}{maxChunkCount} = 1;
963       buffer.\hyperlink{structNetBuffer1_a2450ee8ad02374a831693b3529283739}{chunk}[0].\hyperlink{structChunkDesc_a014aac6efdc5722e058a9b67ca5f8358}{address} = frame;
964       buffer.\hyperlink{structNetBuffer1_a2450ee8ad02374a831693b3529283739}{chunk}[0].\hyperlink{structChunkDesc_a4bdd57a9363511126fe5cd6d30c51c81}{length} = (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}) \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
965       buffer.\hyperlink{structNetBuffer1_a2450ee8ad02374a831693b3529283739}{chunk}[0].\hyperlink{structChunkDesc_ab06232d65ee252651962c202651910c4}{size} = 0;
966 
967       \textcolor{comment}{//Process incoming IPv6 packet}
968       \hyperlink{ipv6_8c_ae5a231be5cc78f474ac7fb73df8947bd}{ipv6ProcessPacket}(interface, (\hyperlink{structNetBuffer}{NetBuffer} *) &buffer, 0);
969       \textcolor{keywordflow}{break};
970 \textcolor{preprocessor}{#endif}
971 
972 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
973    \textcolor{comment}{//PAP protocol?}
974    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2acf222ed31e41d910b4b75d9eb58db3a2}{PPP\_PROTOCOL\_PAP}:
975       \textcolor{comment}{//Process incoming PAP packet}
976       \hyperlink{pap_8c_a86bcd6a8b9aac4e31febd023cae60ad0}{papProcessPacket}(context, (\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
977       \textcolor{keywordflow}{break};
978 \textcolor{preprocessor}{#endif}
979 
980 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
981    \textcolor{comment}{//CHAP protocol?}
982    \textcolor{keywordflow}{case} \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2ac0897e91a9ab8cedc751087ef1b65a1d}{PPP\_PROTOCOL\_CHAP}:
983       \textcolor{comment}{//Process incoming CHAP packet}
984       \hyperlink{chap_8c_a45e64d4338d5a8673235e4136db7acec}{chapProcessPacket}(context, (\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
985       \textcolor{keywordflow}{break};
986 \textcolor{preprocessor}{#endif}
987 
988    \textcolor{comment}{//Unknown protocol field}
989    \textcolor{keywordflow}{default}:
990       \textcolor{comment}{//The peer is attempting to use a protocol which is unsupported}
991       \hyperlink{lcp_8c_abeb711fbddcd63260c596e713efe2279}{lcpProcessUnknownProtocol}(context, protocol, frame, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
992       \textcolor{keywordflow}{break};
993    \}
994 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_ae4b158f1002db1be9deb3737043f2f57}\label{ppp_8c_ae4b158f1002db1be9deb3737043f2f57}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Receive\+At\+Command@{ppp\+Receive\+At\+Command}}
\index{ppp\+Receive\+At\+Command@{ppp\+Receive\+At\+Command}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Receive\+At\+Command()}{pppReceiveAtCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Receive\+At\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Wait for an incoming AT command. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt out}  & {\em data} & Buffer where to store the incoming AT command \\
\hline
\mbox{\tt in}  & {\em size} & Size of the buffer, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 381 of file ppp.\+c.


\begin{DoxyCode}
382 \{
383    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
384    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
385    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} start;
386    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
387 
388    \textcolor{comment}{//Check parameters}
389    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
390       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
391    \textcolor{comment}{//Make sure PPP has been properly configured}
392    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
393       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
394 
395    \textcolor{comment}{//Point to the PPP context}
396    context = interface->pppContext;
397    \textcolor{comment}{//Save current time}
398    start = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
399 
400    \textcolor{comment}{//Wait for an incoming AT command}
401    \textcolor{keywordflow}{while}(1)
402    \{
403       \textcolor{comment}{//Get exclusive access}
404       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
405 
406       \textcolor{comment}{//Check current PPP state}
407       \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD})
408       \{
409          \textcolor{comment}{//Wait for an incoming AT command}
410          error = \hyperlink{ppp__hdlc_8c_a5db1a3e0bf8d1806cabd21fb780e918a}{pppHdlcDriverReceiveAtCommand}(interface, 
      \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size);
411       \}
412       \textcolor{keywordflow}{else}
413       \{
414          \textcolor{comment}{//Report an error}
415          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf13ecb3f9a3314ab1eec8859427852c5}{ERROR\_ALREADY\_CONNECTED};
416       \}
417 
418       \textcolor{comment}{//Release exclusive access}
419       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
420 
421       \textcolor{comment}{//No data received?}
422       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca838a7a87abb42b87d6862e98849fab2d}{ERROR\_BUFFER\_EMPTY} || \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] == \textcolor{charliteral}{'\(\backslash\)0'})
423       \{
424          \textcolor{comment}{//Get current time}
425          time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
426 
427          \textcolor{comment}{//Check whether the timeout period has elapsed}
428          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, start + context->timeout) >= 0)
429          \{
430             \textcolor{comment}{//Timeout error}
431             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
432             \textcolor{comment}{//Exit immediately}
433             \textcolor{keywordflow}{break};
434          \}
435          \textcolor{keywordflow}{else}
436          \{
437             \textcolor{comment}{//Wait for more data to be received}
438             \hyperlink{os__port__chibios_8c_a69608590db97c707277aebf15be010e5}{osDelayTask}(\hyperlink{ppp_8h_aca6222e960eafa9531cbf7e0245e7b1c}{PPP\_POLLING\_INTERVAL});
439          \}
440       \}
441       \textcolor{keywordflow}{else}
442       \{
443          \textcolor{comment}{//We are done}
444          \textcolor{keywordflow}{break};
445       \}
446    \}
447 
448    \textcolor{comment}{//Return status code}
449    \textcolor{keywordflow}{return} error;
450 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a211aeda6e331e5f5163505913c6b57fe}\label{ppp_8c_a211aeda6e331e5f5163505913c6b57fe}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Send\+At\+Command@{ppp\+Send\+At\+Command}}
\index{ppp\+Send\+At\+Command@{ppp\+Send\+At\+Command}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+At\+Command()}{pppSendAtCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+At\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{data }\end{DoxyParamCaption})}



Send AT command. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em data} & N\+U\+L\+L-\/terminated string that contains the AT command to be sent \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 318 of file ppp.\+c.


\begin{DoxyCode}
319 \{
320    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
321    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} status;
322    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
323 
324    \textcolor{comment}{//Check parameters}
325    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
326       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
327    \textcolor{comment}{//Make sure PPP has been properly configured}
328    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
329       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
330 
331    \textcolor{comment}{//Point to the PPP context}
332    context = interface->pppContext;
333 
334    \textcolor{comment}{//Wait for the send buffer to be available for writing}
335    status = \hyperlink{os__port__chibios_8c_a1dc707247e44dfefae5bec4a322fc78a}{osWaitForEvent}(&interface->nicTxEvent, context->timeout);
336 
337    \textcolor{comment}{//Check status}
338    \textcolor{keywordflow}{if}(status)
339    \{
340       \textcolor{comment}{//Get exclusive access}
341       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
342 
343       \textcolor{comment}{//Check current PPP state}
344       \textcolor{keywordflow}{if}(context->pppPhase == \hyperlink{ppp_8h_aa187b5eb62890e0b7bac9a94259c1d29aac297c054291557a24288cf2efa96842}{PPP\_PHASE\_DEAD})
345       \{
346          \textcolor{comment}{//Purge receive buffer}
347          error = \hyperlink{ppp__hdlc_8c_a1fea067fc71506ad97d7af04d7690d5d}{pppHdlcDriverPurgeRxBuffer}(context);
348 
349          \textcolor{comment}{//Send AT command}
350          \textcolor{keywordflow}{if}(!error)
351             error = \hyperlink{ppp__hdlc_8c_a09fd6e6a9931029b977da60a5749b9b1}{pppHdlcDriverSendAtCommand}(interface, 
      \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data});
352       \}
353       \textcolor{keywordflow}{else}
354       \{
355          \textcolor{comment}{//Report an error}
356          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf13ecb3f9a3314ab1eec8859427852c5}{ERROR\_ALREADY\_CONNECTED};
357       \}
358 
359       \textcolor{comment}{//Release exclusive access}
360       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
361    \}
362    \textcolor{keywordflow}{else}
363    \{
364       \textcolor{comment}{//Timeout error}
365       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
366    \}
367 
368    \textcolor{comment}{//Return status code}
369    \textcolor{keywordflow}{return} error;
370 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}\label{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Send\+Frame@{ppp\+Send\+Frame}}
\index{ppp\+Send\+Frame@{ppp\+Send\+Frame}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Frame()}{pppSendFrame()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Frame (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{offset,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{protocol }\end{DoxyParamCaption})}



Send a P\+PP frame. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em buffer} & Multi-\/part buffer containing the data \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to the first data byte \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1006 of file ppp.\+c.


\begin{DoxyCode}
1008 \{
1009    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1010    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1011    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} fcs;
1012    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1013    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
1014 
1015    \textcolor{comment}{//Point to the PPP context}
1016    context = interface->pppContext;
1017 
1018    \textcolor{comment}{//Check whether the Protocol field can be compressed}
1019    \textcolor{keywordflow}{if}(context->peerConfig.pfc && \hyperlink{os__port_8h_aeb61a4e8fff2f4624a632a3189cbd3a0}{MSB}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol}) == 0)
1020    \{
1021       \textcolor{comment}{//Is there enough space in the buffer to store the compressed}
1022       \textcolor{comment}{//Protocol field?}
1023       \textcolor{keywordflow}{if}(\hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} < 1)
1024          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1025 
1026       \textcolor{comment}{//Make room for the Protocol field}
1027       \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}--;
1028       \textcolor{comment}{//Move backward}
1029       p = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
1030       \textcolor{comment}{//Compress the Protocol field}
1031       p[0] = \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
1032    \}
1033    \textcolor{keywordflow}{else}
1034    \{
1035       \textcolor{comment}{//Is there enough space in the buffer to store the uncompressed}
1036       \textcolor{comment}{//Protocol field?}
1037       \textcolor{keywordflow}{if}(\hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} < 2)
1038          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1039 
1040       \textcolor{comment}{//Make room for the Protocol field}
1041       \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} -= 2;
1042       \textcolor{comment}{//Move backward}
1043       p = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
1044       \textcolor{comment}{//Do not compress the Protocol field}
1045       p[0] = \hyperlink{os__port_8h_aeb61a4e8fff2f4624a632a3189cbd3a0}{MSB}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
1046       p[1] = \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
1047    \}
1048 
1049    \textcolor{comment}{//Check whether the Address and Control fields can be compressed}
1050    \textcolor{keywordflow}{if}(context->peerConfig.acfc && \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} != \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2aa16ec94a0acadd78f8c120d8bdd45dc5}{PPP\_PROTOCOL\_LCP})
1051    \{
1052       \textcolor{comment}{//On transmission, compressed Address and Control fields}
1053       \textcolor{comment}{//are simply omitted...}
1054    \}
1055    \textcolor{keywordflow}{else}
1056    \{
1057       \textcolor{comment}{//Is there enough space in the buffer to store the uncompressed}
1058       \textcolor{comment}{//Address and Control fields?}
1059       \textcolor{keywordflow}{if}(\hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} < 2)
1060          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1061 
1062       \textcolor{comment}{//Make room for the Address and Control fields}
1063       \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset} -= 2;
1064       \textcolor{comment}{//Move backward}
1065       p = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
1066       \textcolor{comment}{//Do not compress the Address and Control fields}
1067       p[0] = \hyperlink{ppp_8h_a6bf9b573c61dad0116281ea0a0d704bb}{PPP\_ADDR\_FIELD};
1068       p[1] = \hyperlink{ppp_8h_a19db537819c722f453349fd41196f9c3}{PPP\_CTRL\_FIELD};
1069    \}
1070 
1071    \textcolor{comment}{//Retrieve the length of the frame}
1072    length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(buffer) - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1073 
1074    \textcolor{comment}{//Compute FCS over the header and payload}
1075    fcs = \hyperlink{ppp_8c_a6aa9d2b46ddfb23e723be17e3bc50770}{pppCalcFcsEx}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, length);
1076    \textcolor{comment}{//The FCS is transmitted least significant octet first}
1077    fcs = \hyperlink{cpu__endian_8h_ac1026f2dc20cf505379802ee47db4f6d}{htole16}(fcs);
1078 
1079    \textcolor{comment}{//Append the calculated FCS value}
1080    error = \hyperlink{net__mem_8c_aceae1188a93321e1d4daed11bb8005df}{netBufferAppend}(buffer, &fcs, \hyperlink{ppp_8h_ac2e55a55a1df4bfe475c61a5b4e646cd}{PPP\_FCS\_SIZE});
1081    \textcolor{comment}{//Any error to report?}
1082    \textcolor{keywordflow}{if}(error)
1083       \textcolor{keywordflow}{return} error;
1084 
1085    \textcolor{comment}{//Adjust frame length}
1086    length += \hyperlink{ppp_8h_ac2e55a55a1df4bfe475c61a5b4e646cd}{PPP\_FCS\_SIZE};
1087 
1088    \textcolor{comment}{//Debug message}
1089    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"Sending PPP frame (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
1090    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  Protocol = 0x%04"} PRIX16 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
1091 
1092    \textcolor{comment}{//Send the resulting frame over the specified link}
1093    error = \hyperlink{nic_8c_af480b2743ecb07bc0312f2bbcecdb287}{nicSendPacket}(interface, buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
1094    \textcolor{comment}{//Return status code}
1095    \textcolor{keywordflow}{return} error;
1096 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a83be02b4725b3116300f52dd5fe89f96}\label{ppp_8c_a83be02b4725b3116300f52dd5fe89f96}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Set\+Auth\+Info@{ppp\+Set\+Auth\+Info}}
\index{ppp\+Set\+Auth\+Info@{ppp\+Set\+Auth\+Info}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Set\+Auth\+Info()}{pppSetAuthInfo()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Set\+Auth\+Info (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{username,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{password }\end{DoxyParamCaption})}



Set P\+PP authentication information. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em username} & N\+U\+L\+L-\/terminated string containing the user name to be used \\
\hline
\mbox{\tt in}  & {\em password} & N\+U\+L\+L-\/terminated string containing the password to be used \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 233 of file ppp.\+c.


\begin{DoxyCode}
235 \{
236    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
237 
238    \textcolor{comment}{//Check parameters}
239    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || username == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || password == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
240       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
241    \textcolor{comment}{//Make sure PPP has been properly configured}
242    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
243       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
244 
245    \textcolor{comment}{//Point to the PPP context}
246    context = interface->pppContext;
247 
248    \textcolor{comment}{//Get exclusive access}
249    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
250 
251    \textcolor{comment}{//Save user name}
252    \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(context->username, username, \hyperlink{ppp_8h_acafaf0139acdee8a293aa63cd32666b6}{PPP\_MAX\_USERNAME\_LEN});
253    \textcolor{comment}{//Save password}
254    \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(context->password, password, \hyperlink{ppp_8h_ad230927bc4f26aec472b73dd4e3fa46a}{PPP\_MAX\_PASSWORD\_LEN});
255 
256    \textcolor{comment}{//Release exclusive access}
257    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
258 
259    \textcolor{comment}{//No error to report}
260    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
261 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a53171ddccab09e1fbaa68feae9d0b33e}\label{ppp_8c_a53171ddccab09e1fbaa68feae9d0b33e}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Set\+Timeout@{ppp\+Set\+Timeout}}
\index{ppp\+Set\+Timeout@{ppp\+Set\+Timeout}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Set\+Timeout()}{pppSetTimeout()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Set\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{timeout }\end{DoxyParamCaption})}



Set timeout value for blocking operations. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em timeout} & Maximum time to wait \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 197 of file ppp.\+c.


\begin{DoxyCode}
198 \{
199    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
200 
201    \textcolor{comment}{//Check parameters}
202    \textcolor{keywordflow}{if}(interface == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
203       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
204    \textcolor{comment}{//Make sure PPP has been properly configured}
205    \textcolor{keywordflow}{if}(interface->pppContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
206       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
207 
208    \textcolor{comment}{//Point to the PPP context}
209    context = interface->pppContext;
210 
211    \textcolor{comment}{//Get exclusive access}
212    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
213 
214    \textcolor{comment}{//Set timeout value}
215    context->timeout = timeout;
216 
217    \textcolor{comment}{//Release exclusive access}
218    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
219 
220    \textcolor{comment}{//No error to report}
221    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
222 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp_8c_a84c6cb03237408546372831dd59c3c52}\label{ppp_8c_a84c6cb03237408546372831dd59c3c52}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Tick@{ppp\+Tick}}
\index{ppp\+Tick@{ppp\+Tick}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Tick()}{pppTick()}}
{\footnotesize\ttfamily void ppp\+Tick (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



P\+PP timer handler. 

This routine must be periodically called by the T\+C\+P/\+IP stack to manage retransmissions


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}


Definition at line 846 of file ppp.\+c.


\begin{DoxyCode}
847 \{
848    \hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{PppContext} *context;
849 
850    \textcolor{comment}{//PPP driver?}
851    \textcolor{keywordflow}{if}(interface->nicDriver->type == \hyperlink{nic_8h_ac1ce8659a9797513ecd9cc1afedce40bafe21fcd3851e27a8b4ac8f6ea0a692df}{NIC\_TYPE\_PPP})
852    \{
853       \textcolor{comment}{//Point to the PPP context}
854       context = interface->pppContext;
855 
856       \textcolor{comment}{//Handle LCP retransmission timer}
857       \hyperlink{lcp_8c_afe7b3ad105bd83710936f826eaef350b}{lcpTick}(context);
858 
859 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
860       \textcolor{comment}{//Handle IPCP retransmission timer}
861       \hyperlink{ipcp_8c_a8477eeed2aca078da957d972a0298761}{ipcpTick}(context);
862 \textcolor{preprocessor}{#endif}
863 
864 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
865       \textcolor{comment}{//Handle IPV6CP retransmission timer}
866       \hyperlink{ipv6cp_8c_a4a7b1c64da15e7c08b39ef5e5c96de95}{ipv6cpTick}(context);
867 \textcolor{preprocessor}{#endif}
868 
869 \textcolor{preprocessor}{#if (PAP\_SUPPORT == ENABLED)}
870       \textcolor{comment}{//Handle PAP timer}
871       \hyperlink{pap_8c_ab4891a99f146863f2ab0f60020f96566}{papTick}(context);
872 \textcolor{preprocessor}{#endif}
873 
874 \textcolor{preprocessor}{#if (CHAP\_SUPPORT == ENABLED)}
875       \textcolor{comment}{//Handle CHAP timer}
876       \hyperlink{chap_8c_ade54e106e42ba888d9e125cf1fc919b4}{chapTick}(context);
877 \textcolor{preprocessor}{#endif}
878    \}
879 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{ppp_8c_a4c2ec07a7827a39e2666be9cf3c88b47}\label{ppp_8c_a4c2ec07a7827a39e2666be9cf3c88b47}} 
\index{ppp.\+c@{ppp.\+c}!fcs\+Table@{fcs\+Table}}
\index{fcs\+Table@{fcs\+Table}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{fcs\+Table}{fcsTable}}
{\footnotesize\ttfamily const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} fcs\+Table\mbox{[}256\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 54 of file ppp.\+c.

\mbox{\Hypertarget{ppp_8c_ae978e425325a88275be9719a4cf28a01}\label{ppp_8c_ae978e425325a88275be9719a4cf28a01}} 
\index{ppp.\+c@{ppp.\+c}!ppp\+Tick\+Counter@{ppp\+Tick\+Counter}}
\index{ppp\+Tick\+Counter@{ppp\+Tick\+Counter}!ppp.\+c@{ppp.\+c}}
\subsubsection{\texorpdfstring{ppp\+Tick\+Counter}{pppTickCounter}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} ppp\+Tick\+Counter}



Definition at line 51 of file ppp.\+c.

