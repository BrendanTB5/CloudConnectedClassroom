\hypertarget{ssi_8c}{}\section{cyclone\+\_\+tcp/http/ssi.c File Reference}
\label{ssi_8c}\index{cyclone\+\_\+tcp/http/ssi.\+c@{cyclone\+\_\+tcp/http/ssi.\+c}}


S\+SI (Server Side Includes)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+server.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/http\+\_\+server\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/mime.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}http/ssi.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}fs\+\_\+port.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ssi_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ace1dd0cc4628f20c72a1d8dc9612d2f1}{H\+T\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_afe14b7f41b8507b8d8c7d35dca53b2a4}{ssi\+Execute\+Script} (\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$connection, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$uri, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
\begin{DoxyCompactList}\small\item\em Execute S\+SI script. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_a5d550bb3514d6c7ddaea0f4a79806b0a}{ssi\+Process\+Command} (\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$connection, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$tag, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$uri, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
\begin{DoxyCompactList}\small\item\em Process S\+SI directive. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_ae023dd9991e79b7c622a4e12cd4bbe34}{ssi\+Process\+Include\+Command} (\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$connection, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$tag, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$uri, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
\begin{DoxyCompactList}\small\item\em Process S\+SI include directive. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_ac8cdaca0cb930447f8f67d75c950f38f}{ssi\+Process\+Echo\+Command} (\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$connection, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$tag, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process S\+SI echo directive. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_ae7dfd6aaf6f5636c3ac9ede2923fb42e}{ssi\+Process\+Exec\+Command} (\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$connection, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$tag, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Process S\+SI exec directive. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}{ssi\+Search\+Tag} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{ndp_8h_a2dee666f0c1fe072c549ff86b1d0a8ab}{s}, size\+\_\+t s\+Len, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$tag, size\+\_\+t tag\+Len, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} $\ast$pos)
\begin{DoxyCompactList}\small\item\em Search a string for a given tag. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+SI (Server Side Includes) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
Server Side Includes (S\+SI) is a simple interpreted server-\/side scripting language used to generate dynamic content to web pages

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ssi_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ssi_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ssi.\+c@{ssi.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ace1dd0cc4628f20c72a1d8dc9612d2f1}{H\+T\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 37 of file ssi.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ssi_8c_afe14b7f41b8507b8d8c7d35dca53b2a4}\label{ssi_8c_afe14b7f41b8507b8d8c7d35dca53b2a4}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Execute\+Script@{ssi\+Execute\+Script}}
\index{ssi\+Execute\+Script@{ssi\+Execute\+Script}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Execute\+Script()}{ssiExecuteScript()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Execute\+Script (\begin{DoxyParamCaption}\item[{\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$}]{connection,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{uri,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{level }\end{DoxyParamCaption})}



Execute S\+SI script. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Structure representing an H\+T\+TP connection \\
\hline
\mbox{\tt in}  & {\em uri} & N\+U\+L\+L-\/terminated string containing the file to process \\
\hline
\mbox{\tt in}  & {\em level} & Current level of recursion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 67 of file ssi.\+c.


\begin{DoxyCode}
68 \{
69    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
70    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
71 
72 \textcolor{preprocessor}{#if (HTTP\_SERVER\_FS\_SUPPORT == ENABLED)}
73    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} more;
74    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} pos;
75    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
76    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *buffer;
77    \hyperlink{fs__port__fatfs_8h_a913e2a93cbf8ed241fe05fb6abc3f316}{FsFile} *\hyperlink{dhcp__common_8h_a5c7003134e7a7486271d4f33c2e7b7de}{file};
78 \textcolor{preprocessor}{#else}
79    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
80    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
81    \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data};
82 \textcolor{preprocessor}{#endif}
83 
84    \textcolor{comment}{//Recursion limit exceeded?}
85    \textcolor{keywordflow}{if}(\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} >= \hyperlink{http__server_8h_aa86d8e602f06770e2950eb80353b46f5}{HTTP\_SERVER\_SSI\_MAX\_RECURSION})
86       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
87 
88    \textcolor{comment}{//Retrieve the full pathname}
89    \hyperlink{http__server__misc_8c_a34edbde4371909896b60846f2545fbaa}{httpGetAbsolutePath}(connection, uri,
90       connection->buffer, \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE});
91 
92 \textcolor{preprocessor}{#if (HTTP\_SERVER\_FS\_SUPPORT == ENABLED)}
93    \textcolor{comment}{//Open the file for reading}
94    file = \hyperlink{fs__port__fatfs_8c_aba7fcc4f174dcf4652a8b84cdfff22b5}{fsOpenFile}(connection->buffer, \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51cadf6c1e1805f97fa4f535acbdc2d943db}{FS\_FILE\_MODE\_READ});
95    \textcolor{comment}{//Failed to open the file?}
96    \textcolor{keywordflow}{if}(file == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
97       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
98 
99    \textcolor{comment}{//Allocate a memory buffer}
100    buffer = \hyperlink{os__port__chibios_8c_ae86758dcd9fc3c98247ae19815987c9a}{osAllocMem}(\hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE});
101    \textcolor{comment}{//Failed to allocate memory?}
102    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
103    \{
104       \textcolor{comment}{//Close the file}
105       \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(file);
106       \textcolor{comment}{//Report an error}
107       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
108    \}
109 \textcolor{preprocessor}{#else}
110    \textcolor{comment}{//Get the resource data associated with the URI}
111    error = \hyperlink{resource__manager_8c_a0fe55f3dce16ce80683cae543c61f22c}{resGetData}(connection->buffer, (\textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} **) &data, &length);
112    \textcolor{comment}{//The specified URI cannot be found?}
113    \textcolor{keywordflow}{if}(error)
114       \textcolor{keywordflow}{return} error;
115 \textcolor{preprocessor}{#endif}
116 
117    \textcolor{comment}{//Send the HTTP response header before executing the script}
118    \textcolor{keywordflow}{if}(!\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
119    \{
120       \textcolor{comment}{//Format HTTP response header}
121       connection->response.statusCode = 200;
122       connection->response.contentType = \hyperlink{mime_8c_a9e79374594b83b65457d42c5589db7e0}{mimeGetType}(uri);
123       connection->response.chunkedEncoding = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
124 
125       \textcolor{comment}{//Send the header to the client}
126       error = \hyperlink{http__server_8c_ae90b959869f2eec5ad37c951b156855f}{httpWriteHeader}(connection);
127       \textcolor{comment}{//Any error to report?}
128       \textcolor{keywordflow}{if}(error)
129       \{
130 \textcolor{preprocessor}{#if (HTTP\_SERVER\_FS\_SUPPORT == ENABLED)}
131          \textcolor{comment}{//Close the file}
132          \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(file);
133          \textcolor{comment}{//Release memory buffer}
134          \hyperlink{os__port__chibios_8c_a68e4fa4326f2031eab28b92a25f2d68d}{osFreeMem}(buffer);
135 \textcolor{preprocessor}{#endif}
136          \textcolor{comment}{//Return status code}
137          \textcolor{keywordflow}{return} error;
138       \}
139    \}
140 
141 \textcolor{preprocessor}{#if (HTTP\_SERVER\_FS\_SUPPORT == ENABLED)}
142    \textcolor{comment}{//Point to the beginning of the buffer}
143    pos = 0;
144    length = 0;
145 
146    \textcolor{comment}{//This flag indicates whether data should be read}
147    more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
148 
149    \textcolor{comment}{//Parse the specified file}
150    \textcolor{keywordflow}{while}(1)
151    \{
152       \textcolor{comment}{//Read more data if needed}
153       \textcolor{keywordflow}{if}(more)
154       \{
155          \textcolor{comment}{//Check whether the current position is aligned on 32-bit boundaries}
156          n = 4 - ((pos + \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}) % 4);
157 
158          \textcolor{comment}{//Maintain proper alignment}
159          \textcolor{keywordflow}{if}(n != 4)
160          \{
161             memmove(buffer + pos + n, buffer + pos, length);
162             pos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
163          \}
164 
165          \textcolor{comment}{//Read data from the specified file}
166          error = \hyperlink{fs__port__fatfs_8c_af802c67ab60bcc6273bcc65a967d99ab}{fsReadFile}(file, buffer + pos + length,
167             \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE} - (pos + length), &n);
168 
169          \textcolor{comment}{//End of input stream?}
170          \textcolor{keywordflow}{if}(error)
171          \{
172             \textcolor{comment}{//Purge data buffer}
173             error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, buffer + pos, length);
174             \textcolor{comment}{//Exit immediately}
175             \textcolor{keywordflow}{break};
176          \}
177 
178          \textcolor{comment}{//Adjust the length of the buffer}
179          length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
180          \textcolor{comment}{//Clear flag}
181          more = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
182       \}
183 
184       \textcolor{comment}{//Search for any SSI tags}
185       error = \hyperlink{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}{ssiSearchTag}(buffer + pos, length, \textcolor{stringliteral}{"<!--#"}, 5, &n);
186 
187       \textcolor{comment}{//Full match?}
188       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
189       \{
190          \textcolor{comment}{//Send the part of the file that precedes the tag}
191          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, buffer + pos, n);
192          \textcolor{comment}{//Failed to send data?}
193          \textcolor{keywordflow}{if}(error)
194             \textcolor{keywordflow}{break};
195 
196          \textcolor{comment}{//Advance data pointer}
197          pos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
198          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
199 
200          \textcolor{comment}{//Search for the comment terminator}
201          error = \hyperlink{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}{ssiSearchTag}(buffer + pos + 5, length - 5, \textcolor{stringliteral}{"-->"}, 3, &n);
202 
203          \textcolor{comment}{//Full match?}
204          \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
205          \{
206             \textcolor{comment}{//Advance data pointer over the opening identifier}
207             pos += 5;
208             length -= 5;
209 
210             \textcolor{comment}{//Process SSI directive}
211             error = \hyperlink{ssi_8c_a5d550bb3514d6c7ddaea0f4a79806b0a}{ssiProcessCommand}(connection, buffer + pos, n, uri, 
      \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level});
212             \textcolor{comment}{//Any error to report?}
213             \textcolor{keywordflow}{if}(error)
214                \textcolor{keywordflow}{break};
215 
216             \textcolor{comment}{//Advance data pointer over the SSI tag}
217             pos += n + 3;
218             length -= n + 3;
219          \}
220          \textcolor{comment}{//No match or partial match?}
221          \textcolor{keywordflow}{else}
222          \{
223             \textcolor{keywordflow}{if}(pos > 0)
224             \{
225                \textcolor{comment}{//Move the remaining bytes to the start of the buffer}
226                memmove(buffer, buffer + pos, length);
227                \textcolor{comment}{//Rewind to the beginning of the buffer}
228                pos = 0;
229                \textcolor{comment}{//More data are needed}
230                more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
231             \}
232             \textcolor{keywordflow}{else}
233             \{
234                \textcolor{comment}{//Send data to the client}
235                error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, buffer + pos, length);
236                \textcolor{comment}{//Any error to report?}
237                \textcolor{keywordflow}{if}(error)
238                   \textcolor{keywordflow}{break};
239 
240                \textcolor{comment}{//Rewind to the beginning of the buffer}
241                pos = 0;
242                length = 0;
243                \textcolor{comment}{//More data are needed}
244                more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
245             \}
246          \}
247       \}
248       \textcolor{comment}{//Partial match?}
249       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87d35f569078d53830c08f9b8408787e}{ERROR\_PARTIAL\_MATCH})
250       \{
251          \textcolor{comment}{//Send the part of the file that precedes the tag}
252          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, buffer + pos, n);
253          \textcolor{comment}{//Failed to send data?}
254          \textcolor{keywordflow}{if}(error)
255             \textcolor{keywordflow}{break};
256 
257          \textcolor{comment}{//Advance data pointer}
258          pos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
259          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
260 
261          \textcolor{comment}{//Move the remaining bytes to the start of the buffer}
262          memmove(buffer, buffer + pos, length);
263          \textcolor{comment}{//Rewind to the beginning of the buffer}
264          pos = 0;
265          \textcolor{comment}{//More data are needed}
266          more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
267       \}
268       \textcolor{comment}{//No match?}
269       \textcolor{keywordflow}{else}
270       \{
271          \textcolor{comment}{//Send data to the client}
272          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, buffer + pos, length);
273          \textcolor{comment}{//Any error to report?}
274          \textcolor{keywordflow}{if}(error)
275             \textcolor{keywordflow}{break};
276 
277          \textcolor{comment}{//Rewind to the beginning of the buffer}
278          pos = 0;
279          length = 0;
280          \textcolor{comment}{//More data are needed}
281          more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
282       \}
283    \}
284 
285    \textcolor{comment}{//Close the file}
286    \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(file);
287    \textcolor{comment}{//Release memory buffer}
288    \hyperlink{os__port__chibios_8c_a68e4fa4326f2031eab28b92a25f2d68d}{osFreeMem}(buffer);
289 
290    \textcolor{comment}{//Properly close the output stream}
291    \textcolor{keywordflow}{if}(!\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} && error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
292       error = \hyperlink{http__server_8c_ad794634ec0494f8b61a9ea4d439552a1}{httpCloseStream}(connection);
293 \textcolor{preprocessor}{#else}
294    \textcolor{comment}{//Parse the specified file}
295    \textcolor{keywordflow}{while}(length > 0)
296    \{
297       \textcolor{comment}{//Search for any SSI tags}
298       error = \hyperlink{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}{ssiSearchTag}(data, length, \textcolor{stringliteral}{"<!--#"}, 5, &i);
299 
300       \textcolor{comment}{//Opening identifier found?}
301       \textcolor{keywordflow}{if}(!error)
302       \{
303          \textcolor{comment}{//Search for the comment terminator}
304          error = \hyperlink{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}{ssiSearchTag}(data + i + 5, length - i - 5, \textcolor{stringliteral}{"-->"}, 3, &j);
305       \}
306 
307       \textcolor{comment}{//Check whether a valid SSI tag has been found?}
308       \textcolor{keywordflow}{if}(!error)
309       \{
310          \textcolor{comment}{//Send the part of the file that precedes the tag}
311          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, data, i);
312          \textcolor{comment}{//Failed to send data?}
313          \textcolor{keywordflow}{if}(error)
314             \textcolor{keywordflow}{return} error;
315 
316          \textcolor{comment}{//Advance data pointer over the opening identifier}
317          data += i + 5;
318          length -= i + 5;
319 
320          \textcolor{comment}{//Process SSI directive}
321          error = \hyperlink{ssi_8c_a5d550bb3514d6c7ddaea0f4a79806b0a}{ssiProcessCommand}(connection, data, j, uri, 
      \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level});
322          \textcolor{comment}{//Any error to report?}
323          \textcolor{keywordflow}{if}(error)
324             \textcolor{keywordflow}{return} error;
325 
326          \textcolor{comment}{//Advance data pointer over the SSI tag}
327          data += j + 3;
328          length -= j + 3;
329       \}
330       \textcolor{keywordflow}{else}
331       \{
332          \textcolor{comment}{//Send the rest of the file}
333          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, data, length);
334          \textcolor{comment}{//Failed to send data?}
335          \textcolor{keywordflow}{if}(error)
336             \textcolor{keywordflow}{return} error;
337 
338          \textcolor{comment}{//Advance data pointer}
339          data += \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
340          length = 0;
341       \}
342    \}
343 
344    \textcolor{comment}{//Properly close the output stream}
345    \textcolor{keywordflow}{if}(!\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
346       error = \hyperlink{http__server_8c_ad794634ec0494f8b61a9ea4d439552a1}{httpCloseStream}(connection);
347 \textcolor{preprocessor}{#endif}
348 
349    \textcolor{comment}{//Return status code}
350    \textcolor{keywordflow}{return} error;
351 \}
\end{DoxyCode}
\mbox{\Hypertarget{ssi_8c_a5d550bb3514d6c7ddaea0f4a79806b0a}\label{ssi_8c_a5d550bb3514d6c7ddaea0f4a79806b0a}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Process\+Command@{ssi\+Process\+Command}}
\index{ssi\+Process\+Command@{ssi\+Process\+Command}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Process\+Command()}{ssiProcessCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Process\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$}]{connection,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{tag,  }\item[{size\+\_\+t}]{length,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{uri,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{level }\end{DoxyParamCaption})}



Process S\+SI directive. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Structure representing an H\+T\+TP connection \\
\hline
\mbox{\tt in}  & {\em tag} & Pointer to the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em uri} & N\+U\+L\+L-\/terminated string containing the file being processed \\
\hline
\mbox{\tt in}  & {\em level} & Current level of recursion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 364 of file ssi.\+c.


\begin{DoxyCode}
366 \{
367    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
368 
369    \textcolor{comment}{//Include command found?}
370    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 7 && !\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(tag, \textcolor{stringliteral}{"include"}, 7))
371    \{
372       \textcolor{comment}{//Process SSI include directive}
373       error = \hyperlink{ssi_8c_ae023dd9991e79b7c622a4e12cd4bbe34}{ssiProcessIncludeCommand}(connection, tag, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, uri, \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level});
374    \}
375    \textcolor{comment}{//Echo command found?}
376    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 4 && !\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(tag, \textcolor{stringliteral}{"echo"}, 4))
377    \{
378       \textcolor{comment}{//Process SSI echo directive}
379       error = \hyperlink{ssi_8c_ac8cdaca0cb930447f8f67d75c950f38f}{ssiProcessEchoCommand}(connection, tag, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
380    \}
381    \textcolor{comment}{//Exec command found?}
382    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 4 && !\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(tag, \textcolor{stringliteral}{"exec"}, 4))
383    \{
384       \textcolor{comment}{//Process SSI exec directive}
385       error = \hyperlink{ssi_8c_ae7dfd6aaf6f5636c3ac9ede2923fb42e}{ssiProcessExecCommand}(connection, tag, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
386    \}
387    \textcolor{comment}{//Unknown command?}
388    \textcolor{keywordflow}{else}
389    \{
390       \textcolor{comment}{//The server is unable to decode the SSI tag}
391       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
392    \}
393 
394    \textcolor{comment}{//Invalid SSI directive?}
395    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG})
396    \{
397       \textcolor{comment}{//Report a warning to the user}
398       error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, \textcolor{stringliteral}{"Warning: Invalid SSI Tag"}, 24);
399    \}
400 
401    \textcolor{comment}{//Return status code}
402    \textcolor{keywordflow}{return} error;
403 \}
\end{DoxyCode}
\mbox{\Hypertarget{ssi_8c_ac8cdaca0cb930447f8f67d75c950f38f}\label{ssi_8c_ac8cdaca0cb930447f8f67d75c950f38f}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Process\+Echo\+Command@{ssi\+Process\+Echo\+Command}}
\index{ssi\+Process\+Echo\+Command@{ssi\+Process\+Echo\+Command}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Process\+Echo\+Command()}{ssiProcessEchoCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Process\+Echo\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$}]{connection,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{tag,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process S\+SI echo directive. 

This echo directive displays the contents of a specified H\+T\+TP environment variable


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Structure representing an H\+T\+TP connection \\
\hline
\mbox{\tt in}  & {\em tag} & Pointer to the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the S\+SI tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 598 of file ssi.\+c.


\begin{DoxyCode}
599 \{
600    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
601    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *separator;
602    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *attribute;
603    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
604 
605    \textcolor{comment}{//Discard invalid SSI directives}
606    \textcolor{keywordflow}{if}(length < 4 || length >= \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE})
607       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
608 
609    \textcolor{comment}{//Skip the SSI echo command (4 bytes)}
610    memcpy(connection->buffer, tag + 4, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 4);
611    \textcolor{comment}{//Ensure the resulting string is NULL-terminated}
612    connection->buffer[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 4] = \textcolor{charliteral}{'\(\backslash\)0'};
613 
614    \textcolor{comment}{//Check whether a separator is present}
615    separator = strchr(connection->buffer, \textcolor{charliteral}{'='});
616    \textcolor{comment}{//Separator not found?}
617    \textcolor{keywordflow}{if}(!separator)
618       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
619 
620    \textcolor{comment}{//Split the tag}
621    *separator = \textcolor{charliteral}{'\(\backslash\)0'};
622 
623    \textcolor{comment}{//Get attribute name and value}
624    attribute = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(connection->buffer);
625    value = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(separator + 1);
626 
627    \textcolor{comment}{//Remove leading simple or double quote}
628    \textcolor{keywordflow}{if}(value[0] == \textcolor{charliteral}{'\(\backslash\)''} || value[0] == \textcolor{charliteral}{'\(\backslash\)"'})
629       value++;
630 
631    \textcolor{comment}{//Get the length of the attribute value}
632    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = strlen(value);
633 
634    \textcolor{comment}{//Remove trailing simple or double quote}
635    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
636    \{
637       \textcolor{keywordflow}{if}(value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)''} || value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)"'})
638          value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] = \textcolor{charliteral}{'\(\backslash\)0'};
639    \}
640 
641    \textcolor{comment}{//Enforce attribute name}
642    \textcolor{keywordflow}{if}(\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"var"}))
643       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
644 
645    \textcolor{comment}{//Remote address?}
646    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"REMOTE\_ADDR"}))
647    \{
648       \textcolor{comment}{//The IP address of the host making this request}
649       \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(&connection->socket->remoteIpAddr, connection->buffer);
650    \}
651    \textcolor{comment}{//Remote port?}
652    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"REMOTE\_PORT"}))
653    \{
654       \textcolor{comment}{//The port number used by the remote host when making this request}
655       sprintf(connection->buffer, \textcolor{stringliteral}{"%"} PRIu16, connection->socket->remotePort);
656    \}
657    \textcolor{comment}{//Server address?}
658    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"SERVER\_ADDR"}))
659    \{
660       \textcolor{comment}{//The IP address of the server for this URL}
661       \hyperlink{ip_8c_aecdb577de79f65f8c814d5f101c7c6ae}{ipAddrToString}(&connection->socket->localIpAddr, connection->buffer);
662    \}
663    \textcolor{comment}{//Server port?}
664    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"SERVER\_PORT"}))
665    \{
666       \textcolor{comment}{//The port number on this server to which this request was directed}
667       sprintf(connection->buffer, \textcolor{stringliteral}{"%"} PRIu16, connection->socket->localPort);
668    \}
669    \textcolor{comment}{//Request method?}
670    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"REQUEST\_METHOD"}))
671    \{
672       \textcolor{comment}{//The method used for this HTTP request}
673       strcpy(connection->buffer, connection->request.method);
674    \}
675    \textcolor{comment}{//Document root?}
676    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"DOCUMENT\_ROOT"}))
677    \{
678       \textcolor{comment}{//The root directory}
679       strcpy(connection->buffer, connection->settings->rootDirectory);
680    \}
681    \textcolor{comment}{//Document URI?}
682    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"DOCUMENT\_URI"}))
683    \{
684       \textcolor{comment}{//The URI for this request relative to the root directory}
685       strcpy(connection->buffer, connection->request.uri);
686    \}
687    \textcolor{comment}{//Document name?}
688    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"DOCUMENT\_NAME"}))
689    \{
690       \textcolor{comment}{//The full physical path and filename of the document requested}
691       \hyperlink{http__server__misc_8c_a34edbde4371909896b60846f2545fbaa}{httpGetAbsolutePath}(connection, connection->request.uri,
692          connection->buffer, \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE});
693    \}
694    \textcolor{comment}{//Query string?}
695    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"QUERY\_STRING"}))
696    \{
697       \textcolor{comment}{//The information following the "?" in the URL for this request}
698       strcpy(connection->buffer, connection->request.queryString);
699    \}
700    \textcolor{comment}{//User name?}
701    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"AUTH\_USER"}))
702    \{
703 \textcolor{preprocessor}{#if (HTTP\_SERVER\_BASIC\_AUTH\_SUPPORT == ENABLED || HTTP\_SERVER\_DIGEST\_AUTH\_SUPPORT == ENABLED)}
704       \textcolor{comment}{//The username provided by the user to the server}
705       strcpy(connection->buffer, connection->request.auth.user);
706 \textcolor{preprocessor}{#else}
707       \textcolor{comment}{//Basic access authentication is not supported}
708       connection->buffer[0] = \textcolor{charliteral}{'\(\backslash\)0'};
709 \textcolor{preprocessor}{#endif}
710    \}
711    \textcolor{comment}{//GMT time?}
712    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"DATE\_GMT"}))
713    \{
714       \textcolor{comment}{//The current date and time in Greenwich Mean Time}
715       connection->buffer[0] = \textcolor{charliteral}{'\(\backslash\)0'};
716    \}
717    \textcolor{comment}{//Local time?}
718    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(value, \textcolor{stringliteral}{"DATE\_LOCAL"}))
719    \{
720       \textcolor{comment}{//The current date and time in the local timezone}
721       connection->buffer[0] = \textcolor{charliteral}{'\(\backslash\)0'};
722    \}
723    \textcolor{comment}{//Unknown variable?}
724    \textcolor{keywordflow}{else}
725    \{
726       \textcolor{comment}{//Report an error}
727       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
728    \}
729 
730    \textcolor{comment}{//Get the length of the resulting string}
731    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = strlen(connection->buffer);
732 
733    \textcolor{comment}{//Send the contents of the specified environment variable}
734    error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, connection->buffer, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
735    \textcolor{comment}{//Failed to send data?}
736    \textcolor{keywordflow}{if}(error)
737       \textcolor{keywordflow}{return} error;
738 
739    \textcolor{comment}{//Successful processing}
740    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
741 \}
\end{DoxyCode}
\mbox{\Hypertarget{ssi_8c_ae7dfd6aaf6f5636c3ac9ede2923fb42e}\label{ssi_8c_ae7dfd6aaf6f5636c3ac9ede2923fb42e}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Process\+Exec\+Command@{ssi\+Process\+Exec\+Command}}
\index{ssi\+Process\+Exec\+Command@{ssi\+Process\+Exec\+Command}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Process\+Exec\+Command()}{ssiProcessExecCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Process\+Exec\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$}]{connection,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{tag,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Process S\+SI exec directive. 

This exec directive executes a program, script, or shell command on the server. The cmd parameter specifies a server-\/side command. The cgi parameter specifies the path to a C\+GI script


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Structure representing an H\+T\+TP connection \\
\hline
\mbox{\tt in}  & {\em tag} & Pointer to the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the S\+SI tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 757 of file ssi.\+c.


\begin{DoxyCode}
758 \{
759    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *separator;
760    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *attribute;
761    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
762 
763    \textcolor{comment}{//First, check whether CGI is supported by the server}
764    \textcolor{keywordflow}{if}(connection->settings->cgiCallback == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
765       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
766 
767    \textcolor{comment}{//Discard invalid SSI directives}
768    \textcolor{keywordflow}{if}(length < 4 || length >= \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE})
769       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
770 
771    \textcolor{comment}{//Skip the SSI exec command (4 bytes)}
772    memcpy(connection->buffer, tag + 4, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 4);
773    \textcolor{comment}{//Ensure the resulting string is NULL-terminated}
774    connection->buffer[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 4] = \textcolor{charliteral}{'\(\backslash\)0'};
775 
776    \textcolor{comment}{//Check whether a separator is present}
777    separator = strchr(connection->buffer, \textcolor{charliteral}{'='});
778    \textcolor{comment}{//Separator not found?}
779    \textcolor{keywordflow}{if}(!separator)
780       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
781 
782    \textcolor{comment}{//Split the tag}
783    *separator = \textcolor{charliteral}{'\(\backslash\)0'};
784 
785    \textcolor{comment}{//Get attribute name and value}
786    attribute = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(connection->buffer);
787    value = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(separator + 1);
788 
789    \textcolor{comment}{//Remove leading simple or double quote}
790    \textcolor{keywordflow}{if}(value[0] == \textcolor{charliteral}{'\(\backslash\)''} || value[0] == \textcolor{charliteral}{'\(\backslash\)"'})
791       value++;
792 
793    \textcolor{comment}{//Get the length of the attribute value}
794    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = strlen(value);
795 
796    \textcolor{comment}{//Remove trailing simple or double quote}
797    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
798    \{
799       \textcolor{keywordflow}{if}(value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)''} || value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)"'})
800          value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] = \textcolor{charliteral}{'\(\backslash\)0'};
801    \}
802 
803    \textcolor{comment}{//Enforce attribute name}
804    \textcolor{keywordflow}{if}(\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"cgi"}) && \hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"cmd"}) && 
      \hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"cmd\_argument"}))
805       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
806    \textcolor{comment}{//Check the length of the CGI parameter}
807    \textcolor{keywordflow}{if}(strlen(value) > \hyperlink{http__server_8h_a4a3fc828d1b1db329b49b1f339eb06fe}{HTTP\_SERVER\_CGI\_PARAM\_MAX\_LEN})
808       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
809 
810    \textcolor{comment}{//The scratch buffer may be altered by the user-defined callback.}
811    \textcolor{comment}{//So the CGI parameter must be copied prior to function invocation}
812    strcpy(connection->cgiParam, value);
813 
814    \textcolor{comment}{//Invoke user-defined callback}
815    \textcolor{keywordflow}{return} connection->settings->cgiCallback(connection, connection->cgiParam);
816 \}
\end{DoxyCode}
\mbox{\Hypertarget{ssi_8c_ae023dd9991e79b7c622a4e12cd4bbe34}\label{ssi_8c_ae023dd9991e79b7c622a4e12cd4bbe34}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Process\+Include\+Command@{ssi\+Process\+Include\+Command}}
\index{ssi\+Process\+Include\+Command@{ssi\+Process\+Include\+Command}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Process\+Include\+Command()}{ssiProcessIncludeCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Process\+Include\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{http__server_8h_a3506ecffde998ab02629dca83587d2f9}{Http\+Connection} $\ast$}]{connection,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{tag,  }\item[{size\+\_\+t}]{length,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{uri,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{level }\end{DoxyParamCaption})}



Process S\+SI include directive. 

This include directive allows the content of one document to be included in another. The file parameter defines the included file as relative to the document path. The virtual parameter defines the included file as relative to the document root


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Structure representing an H\+T\+TP connection \\
\hline
\mbox{\tt in}  & {\em tag} & Pointer to the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em length} & Total length of the S\+SI tag \\
\hline
\mbox{\tt in}  & {\em uri} & N\+U\+L\+L-\/terminated string containing the file being processed \\
\hline
\mbox{\tt in}  & {\em level} & Current level of recursion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 422 of file ssi.\+c.


\begin{DoxyCode}
424 \{
425    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
426    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *separator;
427    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *attribute;
428    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
429    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *path;
430    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
431 
432    \textcolor{comment}{//Discard invalid SSI directives}
433    \textcolor{keywordflow}{if}(length < 7 || length >= \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE})
434       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
435 
436    \textcolor{comment}{//Skip the SSI include command (7 bytes)}
437    memcpy(connection->buffer, tag + 7, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 7);
438    \textcolor{comment}{//Ensure the resulting string is NULL-terminated}
439    connection->buffer[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 7] = \textcolor{charliteral}{'\(\backslash\)0'};
440 
441    \textcolor{comment}{//Check whether a separator is present}
442    separator = strchr(connection->buffer, \textcolor{charliteral}{'='});
443    \textcolor{comment}{//Separator not found?}
444    \textcolor{keywordflow}{if}(!separator)
445       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
446 
447    \textcolor{comment}{//Split the tag}
448    *separator = \textcolor{charliteral}{'\(\backslash\)0'};
449 
450    \textcolor{comment}{//Get attribute name and value}
451    attribute = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(connection->buffer);
452    value = \hyperlink{str_8c_ade9441b268416af6b024eb2ba3a5847e}{strTrimWhitespace}(separator + 1);
453 
454    \textcolor{comment}{//Remove leading simple or double quote}
455    \textcolor{keywordflow}{if}(value[0] == \textcolor{charliteral}{'\(\backslash\)''} || value[0] == \textcolor{charliteral}{'\(\backslash\)"'})
456       value++;
457 
458    \textcolor{comment}{//Get the length of the attribute value}
459    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = strlen(value);
460 
461    \textcolor{comment}{//Remove trailing simple or double quote}
462    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
463    \{
464       \textcolor{keywordflow}{if}(value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)''} || value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] == \textcolor{charliteral}{'\(\backslash\)"'})
465          value[\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - 1] = \textcolor{charliteral}{'\(\backslash\)0'};
466    \}
467 
468    \textcolor{comment}{//Check the length of the filename}
469    \textcolor{keywordflow}{if}(strlen(value) > \hyperlink{http__server_8h_aad636f905c4ba1aa4f135adbada5a70b}{HTTP\_SERVER\_URI\_MAX\_LEN})
470       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
471 
472    \textcolor{comment}{//The file parameter defines the included file as relative to the document path}
473    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"file"}))
474    \{
475       \textcolor{comment}{//Allocate a buffer to hold the path to the file to be included}
476       path = \hyperlink{os__port__chibios_8c_ae86758dcd9fc3c98247ae19815987c9a}{osAllocMem}(strlen(uri) + strlen(value) + 1);
477       \textcolor{comment}{//Failed to allocate memory?}
478       \textcolor{keywordflow}{if}(path == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
479          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
480 
481       \textcolor{comment}{//Copy the path identifying the script file being processed}
482       strcpy(path, uri);
483       \textcolor{comment}{//Search for the last slash character}
484       p = strrchr(path, \textcolor{charliteral}{'/'});
485 
486       \textcolor{comment}{//Remove the filename from the path if applicable}
487       \textcolor{keywordflow}{if}(p)
488          strcpy(p + 1, value);
489       \textcolor{keywordflow}{else}
490          strcpy(path, value);
491    \}
492    \textcolor{comment}{//The virtual parameter defines the included file as relative to the document root}
493    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(attribute, \textcolor{stringliteral}{"virtual"}))
494    \{
495       \textcolor{comment}{//Copy the absolute path}
496       path = \hyperlink{str_8c_a9006c65380cbc2ab5e7e02e57c8d3d4e}{strDuplicate}(value);
497       \textcolor{comment}{//Failed to duplicate the string?}
498       \textcolor{keywordflow}{if}(path == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
499          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
500    \}
501    \textcolor{comment}{//Unknown parameter...}
502    \textcolor{keywordflow}{else}
503    \{
504       \textcolor{comment}{//Report an error}
505       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
506    \}
507 
508    \textcolor{comment}{//Use server-side scripting to dynamically generate HTML code?}
509    \textcolor{keywordflow}{if}(\hyperlink{http__server__misc_8c_aebda8c10016605385b6958ff384013aa}{httpCompExtension}(value, \textcolor{stringliteral}{".stm"}) ||
510       \hyperlink{http__server__misc_8c_aebda8c10016605385b6958ff384013aa}{httpCompExtension}(value, \textcolor{stringliteral}{".shtm"}) ||
511       \hyperlink{http__server__misc_8c_aebda8c10016605385b6958ff384013aa}{httpCompExtension}(value, \textcolor{stringliteral}{".shtml"}))
512    \{
513       \textcolor{comment}{//SSI processing (Server Side Includes)}
514       error = \hyperlink{ssi_8c_afe14b7f41b8507b8d8c7d35dca53b2a4}{ssiExecuteScript}(connection, path, \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1);
515    \}
516    \textcolor{keywordflow}{else}
517    \{
518 \textcolor{preprocessor}{#if (HTTP\_SERVER\_FS\_SUPPORT == ENABLED)}
519       \hyperlink{fs__port__fatfs_8h_a913e2a93cbf8ed241fe05fb6abc3f316}{FsFile} *\hyperlink{dhcp__common_8h_a5c7003134e7a7486271d4f33c2e7b7de}{file};
520 
521       \textcolor{comment}{//Retrieve the full pathname}
522       \hyperlink{http__server__misc_8c_a34edbde4371909896b60846f2545fbaa}{httpGetAbsolutePath}(connection, path,
523          connection->buffer, \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE});
524 
525       \textcolor{comment}{//Open the file for reading}
526       file = \hyperlink{fs__port__fatfs_8c_aba7fcc4f174dcf4652a8b84cdfff22b5}{fsOpenFile}(connection->buffer, \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51cadf6c1e1805f97fa4f535acbdc2d943db}{FS\_FILE\_MODE\_READ});
527 
528       \textcolor{comment}{//Successful operation?}
529       \textcolor{keywordflow}{if}(file)
530       \{
531          \textcolor{comment}{//Send the contents of the requested file}
532          \textcolor{keywordflow}{while}(1)
533          \{
534             \textcolor{comment}{//Read data from the specified file}
535             error = \hyperlink{fs__port__fatfs_8c_af802c67ab60bcc6273bcc65a967d99ab}{fsReadFile}(file, connection->buffer, 
      \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE}, &\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
536             \textcolor{comment}{//End of input stream?}
537             \textcolor{keywordflow}{if}(error)
538                \textcolor{keywordflow}{break};
539 
540             \textcolor{comment}{//Send data to the client}
541             error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, connection->buffer, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
542             \textcolor{comment}{//Any error to report?}
543             \textcolor{keywordflow}{if}(error)
544                \textcolor{keywordflow}{break};
545          \}
546 
547          \textcolor{comment}{//Close the file}
548          \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(file);
549 
550          \textcolor{comment}{//Successful file transfer?}
551          \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca488b657f8cc2e6c29df47f282e8ff3ad}{ERROR\_END\_OF\_FILE})
552             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
553       \}
554       \textcolor{keywordflow}{else}
555       \{
556          \textcolor{comment}{//The specified URI cannot be found}
557          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND};
558       \}
559 \textcolor{preprocessor}{#else}
560       \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data};
561 
562       \textcolor{comment}{//Retrieve the full pathname}
563       \hyperlink{http__server__misc_8c_a34edbde4371909896b60846f2545fbaa}{httpGetAbsolutePath}(connection, path,
564          connection->buffer, \hyperlink{http__server_8h_a7323ad0fee234d179bd1f679496174d2}{HTTP\_SERVER\_BUFFER\_SIZE});
565 
566       \textcolor{comment}{//Get the resource data associated with the file}
567       error = \hyperlink{resource__manager_8c_a0fe55f3dce16ce80683cae543c61f22c}{resGetData}(connection->buffer, &data, &\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
568 
569       \textcolor{comment}{//Send the contents of the requested file}
570       \textcolor{keywordflow}{if}(!error)
571          error = \hyperlink{http__server_8c_acb70b948502efdd99db7cf234fcb74db}{httpWriteStream}(connection, data, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
572 \textcolor{preprocessor}{#endif}
573    \}
574 
575    \textcolor{comment}{//Cannot found the specified resource?}
576    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4cca37264afee88cb14cd105f0d59607}{ERROR\_NOT\_FOUND})
577       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
578 
579    \textcolor{comment}{//Release previously allocated memory}
580    \hyperlink{os__port__chibios_8c_a68e4fa4326f2031eab28b92a25f2d68d}{osFreeMem}(path);
581    \textcolor{comment}{//return status code}
582    \textcolor{keywordflow}{return} error;
583 \}
\end{DoxyCode}
\mbox{\Hypertarget{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}\label{ssi_8c_a93e1f8064d7752a1ae1294bf6ba10b13}} 
\index{ssi.\+c@{ssi.\+c}!ssi\+Search\+Tag@{ssi\+Search\+Tag}}
\index{ssi\+Search\+Tag@{ssi\+Search\+Tag}!ssi.\+c@{ssi.\+c}}
\subsubsection{\texorpdfstring{ssi\+Search\+Tag()}{ssiSearchTag()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ssi\+Search\+Tag (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{s,  }\item[{size\+\_\+t}]{s\+Len,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{tag,  }\item[{size\+\_\+t}]{tag\+Len,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} $\ast$}]{pos }\end{DoxyParamCaption})}



Search a string for a given tag. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em s} & String to search \\
\hline
\mbox{\tt in}  & {\em s\+Len} & Length of the string to search \\
\hline
\mbox{\tt in}  & {\em tag} & String containing the tag to search for \\
\hline
\mbox{\tt in}  & {\em tag\+Len} & Length of the tag \\
\hline
\mbox{\tt out}  & {\em pos} & The index of the first occurrence of the tag in the string, \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em N\+O\+\_\+\+E\+R\+R\+OR} & if the specified tag has been found \\
\hline
{\em E\+R\+R\+O\+R\+\_\+\+P\+A\+R\+T\+I\+A\+L\+\_\+\+M\+A\+T\+CH} & if a partial match occurs \\
\hline
{\em E\+R\+R\+O\+R\+\_\+\+N\+O\+\_\+\+M\+A\+T\+CH} & if the tag does not appear in the string \\
\hline
\end{DoxyRetVals}


Definition at line 831 of file ssi.\+c.


\begin{DoxyCode}
832 \{
833    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
834    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
835 
836    \textcolor{comment}{//Parse the input string}
837    \textcolor{keywordflow}{for}(i = 0; i <= sLen; i++)
838    \{
839       \textcolor{comment}{//Compare current substring with the given tag}
840       \textcolor{keywordflow}{for}(j = 0; (i + j) < sLen && j < tagLen; j++)
841       \{
842          \textcolor{keywordflow}{if}(\hyperlink{md2_8c_adf356ff381033f761b7de5f76e763a45}{s}[i + j] != tag[j])
843             \textcolor{keywordflow}{break};
844       \}
845 
846       \textcolor{comment}{//Check whether a full match occurred}
847       \textcolor{keywordflow}{if}(j == tagLen)
848       \{
849          \textcolor{comment}{//Save the position of the first character}
850          *pos = i;
851          \textcolor{comment}{//The specified tag has been found}
852          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
853       \}
854       \textcolor{comment}{//Check whether a partial match occurred}
855       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((i + j) == sLen && j > 0)
856       \{
857          \textcolor{comment}{//Save the position of the first character}
858          *pos = i;
859          \textcolor{comment}{//The beginning of the tag matches the end of the string}
860          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87d35f569078d53830c08f9b8408787e}{ERROR\_PARTIAL\_MATCH};
861       \}
862    \}
863 
864    \textcolor{comment}{//The tag does not appear in the string}
865    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca512028ab157e5890d50e18052d577e39}{ERROR\_NO\_MATCH};
866 \}
\end{DoxyCode}
