\hypertarget{scrypt_8h}{}\section{cyclone\+\_\+crypto/kdf/scrypt.h File Reference}
\label{scrypt_8h}\index{cyclone\+\_\+crypto/kdf/scrypt.\+h@{cyclone\+\_\+crypto/kdf/scrypt.\+h}}


scrypt P\+B\+K\+DF (Password-\/\+Based Key Derivation Function)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{scrypt_8h_a245bcf925d52380c4ae63da320a2c075}{scrypt} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$password, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$salt, size\+\_\+t salt\+Len, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$dk, size\+\_\+t dk\+Len)
\begin{DoxyCompactList}\small\item\em scrypt algorithm \end{DoxyCompactList}\item 
void \hyperlink{scrypt_8h_a460a1ef00ecb453c8e1485a44581c6e2}{scrypt\+Ro\+Mix} (\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$v, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$y)
\begin{DoxyCompactList}\small\item\em scrypt\+R\+O\+Mix algorithm \end{DoxyCompactList}\item 
void \hyperlink{scrypt_8h_a3e4bb8ed035df8596154316bd6c8e2ec}{scrypt\+Block\+Mix} (\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$y)
\begin{DoxyCompactList}\small\item\em scrypt\+Block\+Mix algorithm \end{DoxyCompactList}\item 
void \hyperlink{scrypt_8h_adda5b9501f42813e6fa0a2ea15678d05}{scrypt\+Xor\+Block} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b}, size\+\_\+t \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n})
\begin{DoxyCompactList}\small\item\em X\+OR operation. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
scrypt P\+B\+K\+DF (Password-\/\+Based Key Derivation Function) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{scrypt_8h_a245bcf925d52380c4ae63da320a2c075}\label{scrypt_8h_a245bcf925d52380c4ae63da320a2c075}} 
\index{scrypt.\+h@{scrypt.\+h}!scrypt@{scrypt}}
\index{scrypt@{scrypt}!scrypt.\+h@{scrypt.\+h}}
\subsubsection{\texorpdfstring{scrypt()}{scrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} scrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{password,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{salt,  }\item[{size\+\_\+t}]{salt\+Len,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{n,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{r,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{dk,  }\item[{size\+\_\+t}]{dk\+Len }\end{DoxyParamCaption})}



scrypt algorithm 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em password} & N\+U\+L\+L-\/terminated passphrase \\
\hline
\mbox{\tt in}  & {\em salt} & Random salt \\
\hline
\mbox{\tt in}  & {\em salt\+Len} & Length of the random salt, in bytes \\
\hline
\mbox{\tt in}  & {\em n} & C\+P\+U/\+Memory cost parameter \\
\hline
\mbox{\tt in}  & {\em r} & Block size parameter \\
\hline
\mbox{\tt in}  & {\em p} & Parallelization parameter \\
\hline
\mbox{\tt out}  & {\em dk} & Derived key \\
\hline
\mbox{\tt in}  & {\em dk\+Len} & Intended output length in octets of the derived key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 65 of file scrypt.\+c.


\begin{DoxyCode}
67 \{
68    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
69    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
70    \textcolor{keywordtype}{size\_t} blockSize;
71    \textcolor{keywordtype}{size\_t} passwordLen;
72    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b};
73    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *v;
74    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *y;
75 
76    \textcolor{comment}{//Check parameters}
77    \textcolor{keywordflow}{if}(password == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || salt == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || dk == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
78       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
79 
80    \textcolor{comment}{//Initialize variables}
81    b = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
82    v = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
83    y = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
84 
85    \textcolor{comment}{//The CPU/Memory cost parameter must be larger than 1, a power of 2, and}
86    \textcolor{comment}{//less than 2^(128 * r / 8)}
87    \textcolor{keywordflow}{if}(\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} <= 1 || (\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} & (\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} - 1)) != 0)
88       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
89 
90    \textcolor{comment}{//The block size parameter must be a positive integer}
91    \textcolor{keywordflow}{if}(\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r} == 0)
92       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
93 
94    \textcolor{comment}{//The parallelization parameter must be a positive integer less than or equal}
95    \textcolor{comment}{//to ((2^32-1) * hLen) / MFLen where hLen is 32 and MFlen is 128 * r}
96    \textcolor{keywordflow}{if}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} == 0)
97       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
98 
99    \textcolor{comment}{//Retrieve the length of the passphrase}
100    passwordLen = \hyperlink{cyclone__crypto_2core_2crypto_8h_a60355e8a0b63bff69cedd877fc82c624}{cryptoStrlen}(password);
101 
102    \textcolor{comment}{//Each block consists of 128 * r octets}
103    blockSize = 128 * \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r};
104 
105    \textcolor{comment}{//Start of exception handling block}
106    \textcolor{keywordflow}{do}
107    \{
108       \textcolor{comment}{//Initialize an array B consisting of p blocks}
109       b = \hyperlink{cyclone__crypto_2core_2crypto_8h_a48b53d16f66d31e5dcf82db3c1b882ba}{cryptoAllocMem}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} * blockSize);
110       \textcolor{comment}{//Failed to allocate memory?}
111       \textcolor{keywordflow}{if}(b == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
112       \{
113          \textcolor{comment}{//Report an error}
114          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
115          \textcolor{keywordflow}{break};
116       \}
117 
118       \textcolor{comment}{//Initialize a working array V consisting of N blocks}
119       v = \hyperlink{cyclone__crypto_2core_2crypto_8h_a48b53d16f66d31e5dcf82db3c1b882ba}{cryptoAllocMem}(\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} * blockSize);
120       \textcolor{comment}{//Failed to allocate memory?}
121       \textcolor{keywordflow}{if}(v == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
122       \{
123          \textcolor{comment}{//Report an error}
124          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
125          \textcolor{keywordflow}{break};
126       \}
127 
128       \textcolor{comment}{//Initialize a working array Y}
129       y = \hyperlink{cyclone__crypto_2core_2crypto_8h_a48b53d16f66d31e5dcf82db3c1b882ba}{cryptoAllocMem}(blockSize);
130       \textcolor{comment}{//Failed to allocate memory?}
131       \textcolor{keywordflow}{if}(y == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
132       \{
133          \textcolor{comment}{//Report an error}
134          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
135          \textcolor{keywordflow}{break};
136       \}
137 
138       \textcolor{comment}{//Compute B = PBKDF2-HMAC-SHA256(P, S, 1, p * 128 * r)}
139       error = \hyperlink{pkcs5_8c_a30d96e01765a8a1815fb7f3ad7f8d8f9}{pbkdf2}(\hyperlink{sha256_8h_ac65e86d6ed85707af5486ff4d9f87c71}{SHA256\_HASH\_ALGO}, password, passwordLen, salt, saltLen,
140          1, b, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} * blockSize);
141       \textcolor{comment}{//Any error to report?}
142       \textcolor{keywordflow}{if}(error)
143          \textcolor{keywordflow}{break};
144 
145       \textcolor{comment}{//Iterate as many times as desired}
146       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}; i++)
147       \{
148          \textcolor{comment}{//Compute B[i] = scryptROMix(r, B[i], N)}
149          \hyperlink{scrypt_8c_a460a1ef00ecb453c8e1485a44581c6e2}{scryptRoMix}(\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, b + i * blockSize, \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, v, y);
150       \}
151 
152       \textcolor{comment}{//Compute DK = PBKDF2-HMAC-SHA256(P, B, 1, dkLen)}
153       error = \hyperlink{pkcs5_8c_a30d96e01765a8a1815fb7f3ad7f8d8f9}{pbkdf2}(\hyperlink{sha256_8h_ac65e86d6ed85707af5486ff4d9f87c71}{SHA256\_HASH\_ALGO}, password, passwordLen, b,
154          p * blockSize, 1, dk, dkLen);
155       \textcolor{comment}{//Any error to report?}
156       \textcolor{keywordflow}{if}(error)
157          \textcolor{keywordflow}{break};
158 
159       \textcolor{comment}{//End of exception handling block}
160    \} \textcolor{keywordflow}{while}(0);
161 
162    \textcolor{comment}{//Release array B}
163    \textcolor{keywordflow}{if}(b != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
164       \hyperlink{cyclone__crypto_2core_2crypto_8h_ac8a223b176683db4e9eed4162774f870}{cryptoFreeMem}(b);
165 
166    \textcolor{comment}{//Release working array V}
167    \textcolor{keywordflow}{if}(v != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
168       \hyperlink{cyclone__crypto_2core_2crypto_8h_ac8a223b176683db4e9eed4162774f870}{cryptoFreeMem}(v);
169 
170    \textcolor{comment}{//Release working array Y}
171    \textcolor{keywordflow}{if}(y != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
172       \hyperlink{cyclone__crypto_2core_2crypto_8h_ac8a223b176683db4e9eed4162774f870}{cryptoFreeMem}(y);
173 
174    \textcolor{comment}{//Return status code}
175    \textcolor{keywordflow}{return} error;
176 \}
\end{DoxyCode}
\mbox{\Hypertarget{scrypt_8h_a3e4bb8ed035df8596154316bd6c8e2ec}\label{scrypt_8h_a3e4bb8ed035df8596154316bd6c8e2ec}} 
\index{scrypt.\+h@{scrypt.\+h}!scrypt\+Block\+Mix@{scrypt\+Block\+Mix}}
\index{scrypt\+Block\+Mix@{scrypt\+Block\+Mix}!scrypt.\+h@{scrypt.\+h}}
\subsubsection{\texorpdfstring{scrypt\+Block\+Mix()}{scryptBlockMix()}}
{\footnotesize\ttfamily void scrypt\+Block\+Mix (\begin{DoxyParamCaption}\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{r,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{y }\end{DoxyParamCaption})}



scrypt\+Block\+Mix algorithm 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em r} & Block size parameter \\
\hline
\mbox{\tt in,out}  & {\em b} & Octet vector of length 128 $\ast$ r octets \\
\hline
\mbox{\tt in,out}  & {\em y} & Working array \\
\hline
\end{DoxyParams}


Definition at line 233 of file scrypt.\+c.


\begin{DoxyCode}
234 \{
235    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
236    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} x[64];
237 
238    \textcolor{comment}{//Let X = B[2 * r - 1]}
239    \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(x, \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b} + \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r} * 128 - 64, 64);
240 
241    \textcolor{comment}{//Iterate as many times as desired}
242    \textcolor{keywordflow}{for}(i = 0; i < (2 * \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}); i++)
243    \{
244       \textcolor{comment}{//Compute T = X xor B[i]}
245       \hyperlink{scrypt_8c_adda5b9501f42813e6fa0a2ea15678d05}{scryptXorBlock}(x, x, \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b} + i * 64, 64);
246 
247       \textcolor{comment}{//Salsa20/8 Core is used as the hash function}
248       \hyperlink{salsa20_8c_a5cf1a4e0c6b1809a86daf47ea08b7324}{salsa20ProcessBlock}(x, x, 8);
249 
250       \textcolor{comment}{//Let Y[i] = X}
251       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(y + i * 64, x, 64);
252    \}
253 
254    \textcolor{comment}{//Let  B' = (Y[0], Y[2], ..., Y[2 * r - 2], Y[1], Y[3], ..., Y[2 * r - 1])}
255    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}; i++)
256    \{
257       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b} + i * 64, y + i * 128, 64);
258       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b} + (r + i) * 64, y + i * 128 + 64, 64);
259    \}
260 \}
\end{DoxyCode}
\mbox{\Hypertarget{scrypt_8h_a460a1ef00ecb453c8e1485a44581c6e2}\label{scrypt_8h_a460a1ef00ecb453c8e1485a44581c6e2}} 
\index{scrypt.\+h@{scrypt.\+h}!scrypt\+Ro\+Mix@{scrypt\+Ro\+Mix}}
\index{scrypt\+Ro\+Mix@{scrypt\+Ro\+Mix}!scrypt.\+h@{scrypt.\+h}}
\subsubsection{\texorpdfstring{scrypt\+Ro\+Mix()}{scryptRoMix()}}
{\footnotesize\ttfamily void scrypt\+Ro\+Mix (\begin{DoxyParamCaption}\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{r,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{n,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{v,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{y }\end{DoxyParamCaption})}



scrypt\+R\+O\+Mix algorithm 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em r} & Block size parameter \\
\hline
\mbox{\tt in,out}  & {\em b} & Octet vector of length 128 $\ast$ r octets \\
\hline
\mbox{\tt in}  & {\em n} & C\+P\+U/\+Memory cost parameter \\
\hline
\mbox{\tt in,out}  & {\em v} & Working array \\
\hline
\mbox{\tt in,out}  & {\em y} & Working array \\
\hline
\end{DoxyParams}


Definition at line 188 of file scrypt.\+c.


\begin{DoxyCode}
189 \{
190    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
191    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} j;
192    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *x;
193    \textcolor{keywordtype}{size\_t} blockSize;
194 
195    \textcolor{comment}{//Each block consists of 128 * r octets}
196    blockSize = 128 * \hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r};
197 
198    \textcolor{comment}{//Let X = B}
199    x = \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b};
200 
201    \textcolor{comment}{//Compute V array}
202    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
203    \{
204       \textcolor{comment}{//Let V[i] = X}
205       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(v + i * blockSize, x, blockSize);
206 
207       \textcolor{comment}{//Compute X = scryptBlockMix(r, X)}
208       \hyperlink{scrypt_8c_a3e4bb8ed035df8596154316bd6c8e2ec}{scryptBlockMix}(\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, x, y);
209    \}
210 
211    \textcolor{comment}{//Compute B' array}
212    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
213    \{
214       \textcolor{comment}{//Compute j = Integerify(X) mod N}
215       j = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(x + blockSize - 64) & (n - 1);
216 
217       \textcolor{comment}{//Compute T = X xor V[j]}
218       \hyperlink{scrypt_8c_adda5b9501f42813e6fa0a2ea15678d05}{scryptXorBlock}(x, x, v + j * blockSize, blockSize);
219 
220       \textcolor{comment}{//Compute X = scryptBlockMix(r, T)}
221       \hyperlink{scrypt_8c_a3e4bb8ed035df8596154316bd6c8e2ec}{scryptBlockMix}(\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, x, y);
222    \}
223 \}
\end{DoxyCode}
\mbox{\Hypertarget{scrypt_8h_adda5b9501f42813e6fa0a2ea15678d05}\label{scrypt_8h_adda5b9501f42813e6fa0a2ea15678d05}} 
\index{scrypt.\+h@{scrypt.\+h}!scrypt\+Xor\+Block@{scrypt\+Xor\+Block}}
\index{scrypt\+Xor\+Block@{scrypt\+Xor\+Block}!scrypt.\+h@{scrypt.\+h}}
\subsubsection{\texorpdfstring{scrypt\+Xor\+Block()}{scryptXorBlock()}}
{\footnotesize\ttfamily void scrypt\+Xor\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b,  }\item[{size\+\_\+t}]{n }\end{DoxyParamCaption})}



X\+OR operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em x} & Block resulting from the X\+OR operation \\
\hline
\mbox{\tt in}  & {\em a} & First block \\
\hline
\mbox{\tt in}  & {\em b} & Second block \\
\hline
\mbox{\tt in}  & {\em n} & Size of the block \\
\hline
\end{DoxyParams}


Definition at line 271 of file scrypt.\+c.


\begin{DoxyCode}
272 \{
273    \textcolor{keywordtype}{size\_t} i;
274 
275    \textcolor{comment}{//Perform XOR operation}
276    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
277    \{
278       x[i] = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i] ^ \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[i];
279    \}
280 \}
\end{DoxyCode}
