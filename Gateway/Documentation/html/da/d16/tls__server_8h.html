<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Senior Design Gateway: cyclone_ssl/tls_server.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Senior Design Gateway
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A HTTP To MQTT Converted for AWS IoT Core.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d16/tls__server_8h.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tls_server.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handshake message processing (TLS server)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../df/d79/tls_8h_source.html">tls.h</a>&quot;</code><br />
</div>
<p><a href="../../da/d16/tls__server_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a67975b6b6f060d494e01cc75e171fecf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a67975b6b6f060d494e01cc75e171fecf">tlsSendServerHello</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context)</td></tr>
<tr class="memdesc:a67975b6b6f060d494e01cc75e171fecf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send ServerHello message.  <a href="#a67975b6b6f060d494e01cc75e171fecf">More...</a><br /></td></tr>
<tr class="separator:a67975b6b6f060d494e01cc75e171fecf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b4084306cc9d8e1d083e272cd98aef1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a5b4084306cc9d8e1d083e272cd98aef1">tlsSendServerKeyExchange</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context)</td></tr>
<tr class="memdesc:a5b4084306cc9d8e1d083e272cd98aef1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send ServerKeyExchange message.  <a href="#a5b4084306cc9d8e1d083e272cd98aef1">More...</a><br /></td></tr>
<tr class="separator:a5b4084306cc9d8e1d083e272cd98aef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f8b0853322153b88ff07e7bea633835"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a5f8b0853322153b88ff07e7bea633835">tlsSendCertificateRequest</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context)</td></tr>
<tr class="memdesc:a5f8b0853322153b88ff07e7bea633835"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send CertificateRequest message.  <a href="#a5f8b0853322153b88ff07e7bea633835">More...</a><br /></td></tr>
<tr class="separator:a5f8b0853322153b88ff07e7bea633835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bc3bb08a169817c6105f9f5f13f58ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a1bc3bb08a169817c6105f9f5f13f58ac">tlsSendServerHelloDone</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context)</td></tr>
<tr class="memdesc:a1bc3bb08a169817c6105f9f5f13f58ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send ServerHelloDone message.  <a href="#a1bc3bb08a169817c6105f9f5f13f58ac">More...</a><br /></td></tr>
<tr class="separator:a1bc3bb08a169817c6105f9f5f13f58ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d8dee25b92b399334e45683b466f403"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a4d8dee25b92b399334e45683b466f403">tlsFormatServerHello</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, <a class="el" href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t *<a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:a4d8dee25b92b399334e45683b466f403"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format ServerHello message.  <a href="#a4d8dee25b92b399334e45683b466f403">More...</a><br /></td></tr>
<tr class="separator:a4d8dee25b92b399334e45683b466f403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9133776b8d42f0da84f6b8446448069"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#ae9133776b8d42f0da84f6b8446448069">tlsFormatServerKeyExchange</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, <a class="el" href="../../df/d79/tls_8h.html#a69c0b3ab7349e73b2e8f9452dbdfef5a">TlsServerKeyExchange</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t *<a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:ae9133776b8d42f0da84f6b8446448069"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format ServerKeyExchange message.  <a href="#ae9133776b8d42f0da84f6b8446448069">More...</a><br /></td></tr>
<tr class="separator:ae9133776b8d42f0da84f6b8446448069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a422aa0a39a41b30d586a06b9d42dbbdf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a422aa0a39a41b30d586a06b9d42dbbdf">tlsFormatCertificateRequest</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, <a class="el" href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t *<a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:a422aa0a39a41b30d586a06b9d42dbbdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format CertificateRequest message.  <a href="#a422aa0a39a41b30d586a06b9d42dbbdf">More...</a><br /></td></tr>
<tr class="separator:a422aa0a39a41b30d586a06b9d42dbbdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2375898dec7aa0ceaff2faefd467f76"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#ac2375898dec7aa0ceaff2faefd467f76">tlsFormatServerHelloDone</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, <a class="el" href="../../df/d79/tls_8h.html#a71e29f87ab91f2adb5655ad8157e7aea">TlsServerHelloDone</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t *<a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:ac2375898dec7aa0ceaff2faefd467f76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format ServerHelloDone message.  <a href="#ac2375898dec7aa0ceaff2faefd467f76">More...</a><br /></td></tr>
<tr class="separator:ac2375898dec7aa0ceaff2faefd467f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ce6b990031f07a875c795599ccd5d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a38ce6b990031f07a875c795599ccd5d4">tlsParseClientHello</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, const <a class="el" href="../../df/d79/tls_8h.html#ac78d39e638430eb19c4017e5f9797d16">TlsClientHello</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t <a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:a38ce6b990031f07a875c795599ccd5d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse ClientHello message.  <a href="#a38ce6b990031f07a875c795599ccd5d4">More...</a><br /></td></tr>
<tr class="separator:a38ce6b990031f07a875c795599ccd5d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a204fb38ba0d5de7703844660c79e0b40"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d16/tls__server_8h.html#a204fb38ba0d5de7703844660c79e0b40">tlsParseClientKeyExchange</a> (<a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *context, const <a class="el" href="../../df/d79/tls_8h.html#a88521372020709c027828954c0208b8f">TlsClientKeyExchange</a> *<a class="el" href="../../de/df0/pap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, size_t <a class="el" href="../../d8/dca/ppp_8h.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>)</td></tr>
<tr class="memdesc:a204fb38ba0d5de7703844660c79e0b40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse ClientKeyExchange message.  <a href="#a204fb38ba0d5de7703844660c79e0b40">More...</a><br /></td></tr>
<tr class="separator:a204fb38ba0d5de7703844660c79e0b40"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handshake message processing (TLS server) </p>
<h1><a class="anchor" id="License"></a>
License</h1>
<p>SPDX-License-Identifier: GPL-2.0-or-later</p>
<p>Copyright (C) 2010-2019 Oryx Embedded SARL. All rights reserved.</p>
<p>This file is part of CycloneSSL Open.</p>
<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>
<dl class="section author"><dt>Author</dt><dd>Oryx Embedded SARL (www.oryx-embedded.com) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.9.6 </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../da/d16/tls__server_8h_source.html">tls_server.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a422aa0a39a41b30d586a06b9d42dbbdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a422aa0a39a41b30d586a06b9d42dbbdf">&#9670;&nbsp;</a></span>tlsFormatCertificateRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsFormatCertificateRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format CertificateRequest message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>Buffer where to format the CertificateRequest message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">length</td><td>Length of the resulting CertificateRequest message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00802">802</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;{</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *<a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="comment">//Initialize status code</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   <span class="comment">//Point to the beginning of the message</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   p = (<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *) <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= SSL_VERSION_3_0 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_2)</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordtype">size_t</span> pemCertLen;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a40bb5262bf908c328fbcfbe5d29d0201">char_t</a> *<a class="code" href="../../d4/ddf/demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c.html#a52d999bffef4c5d89345bd0ce7d91042">trustedCaList</a>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordtype">size_t</span> trustedCaListLen;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *derCert;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordtype">size_t</span> derCertLen;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <a class="code" href="../../d4/d16/structX509CertificateInfo.html">X509CertificateInfo</a> *certInfo;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <a class="code" href="../../df/d79/tls_8h.html#a96ef533723d450ad6c4903a78c756f9e">TlsCertAuthorities</a> *certAuthorities;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="comment">//Enumerate the types of certificate types that the client may offer</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      n = 0;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">#if (TLS_RSA_SIGN_SUPPORT == ENABLED || TLS_RSA_PSS_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">//Accept certificates that contain an RSA public key</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;certificateTypes[n++] = <a class="code" href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b">TLS_CERT_RSA_SIGN</a>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="preprocessor">#if (TLS_DSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">//Accept certificates that contain a DSA public key</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;certificateTypes[n++] = <a class="code" href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4">TLS_CERT_DSS_SIGN</a>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">#if (TLS_ECDSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="comment">//Accept certificates that contain an ECDSA public key</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;certificateTypes[n++] = <a class="code" href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec">TLS_CERT_ECDSA_SIGN</a>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="comment">//Fix the length of the list</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;certificateTypesLen = (<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>) n;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="comment">//Length of the handshake message</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a>) + n;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">//TLS 1.2 currently selected?</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version == <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         <a class="code" href="../../df/d79/tls_8h.html#a52f8ea223987ee1e857b6687f38d3888">TlsSignHashAlgos</a> *supportedSignAlgos;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;         <span class="comment">//Point to the list of the hash/signature algorithm pairs that the server</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <span class="comment">//is able to verify. Servers can minimize the computation cost by offering</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         <span class="comment">//a restricted set of digest algorithms</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;         supportedSignAlgos = <a class="code" href="../../da/d42/os__port_8h.html#ab20fce5a8cce390611c29101c2e48dd9">PTR_OFFSET</a>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;         <span class="comment">//Enumerate the hash/signature algorithm pairs in descending</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;         <span class="comment">//order of preference</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;         n = 0;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="preprocessor">#if (TLS_SHA256_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;         <span class="comment">//The hash algorithm used for PRF operations can also be used for signing</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;         <span class="keywordflow">if</span>(context-&gt;cipherSuite.prfHashAlgo == <a class="code" href="../../d5/de3/sha256_8h.html#ac65e86d6ed85707af5486ff4d9f87c71">SHA256_HASH_ALGO</a>)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">#if (TLS_ECDSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="comment">//ECDSA signature algorithm with SHA-256</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a">TLS_SIGN_ALGO_ECDSA</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182">TLS_HASH_ALGO_SHA256</a>;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#if (TLS_RSA_PSS_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="comment">//Check whether the X.509 parser supports RSA-PSS signatures</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d8/dc7/certificate_2x509__common_8c.html#ab4fb04ff1cc1ecd24548e967fb7acb5a">x509IsSignAlgoSupported</a>(<a class="code" href="../../dd/db2/certificate_2x509__common_8h.html#ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a">X509_SIGN_ALGO_RSA_PSS</a>))</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;               <span class="comment">//RSASSA-PSS PSS signature algorithm with SHA-256</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;               supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d">TLS_SIGN_ALGO_RSA_PSS_PSS_SHA256</a>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;               supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882">TLS_HASH_ALGO_INTRINSIC</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#if (TLS_RSA_PSS_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <span class="comment">//RSASSA-PSS RSAE signature algorithm with SHA-256</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57">TLS_SIGN_ALGO_RSA_PSS_RSAE_SHA256</a>;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882">TLS_HASH_ALGO_INTRINSIC</a>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="preprocessor">#if (TLS_RSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <span class="comment">//RSASSA-PKCS1-v1_5 signature algorithm with SHA-256</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5">TLS_SIGN_ALGO_RSA</a>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182">TLS_HASH_ALGO_SHA256</a>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="preprocessor">#if (TLS_DSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="comment">//DSA signature algorithm with SHA-256</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d">TLS_SIGN_ALGO_DSA</a>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182">TLS_HASH_ALGO_SHA256</a>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;         }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#if (TLS_SHA384_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;         <span class="comment">//The hash algorithm used for PRF operations can also be used for signing</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;         <span class="keywordflow">if</span>(context-&gt;cipherSuite.prfHashAlgo == <a class="code" href="../../d5/de0/sha384_8h.html#a3dd6226e61249284db3162706a53ea39">SHA384_HASH_ALGO</a>)</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;         {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="preprocessor">#if (TLS_ECDSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="comment">//ECDSA signature algorithm with SHA-384</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a">TLS_SIGN_ALGO_ECDSA</a>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb">TLS_HASH_ALGO_SHA384</a>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="preprocessor">#if (TLS_RSA_PSS_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="comment">//Check whether the X.509 parser supports RSA-PSS signatures</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d8/dc7/certificate_2x509__common_8c.html#ab4fb04ff1cc1ecd24548e967fb7acb5a">x509IsSignAlgoSupported</a>(<a class="code" href="../../dd/db2/certificate_2x509__common_8h.html#ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a">X509_SIGN_ALGO_RSA_PSS</a>))</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;               <span class="comment">//RSASSA-PSS PSS signature algorithm with SHA-384</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;               supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7">TLS_SIGN_ALGO_RSA_PSS_PSS_SHA384</a>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;               supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882">TLS_HASH_ALGO_INTRINSIC</a>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor">#if (TLS_RSA_PSS_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            <span class="comment">//RSASSA-PSS RSAE signature algorithm with SHA-384</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4">TLS_SIGN_ALGO_RSA_PSS_RSAE_SHA384</a>;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882">TLS_HASH_ALGO_INTRINSIC</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="preprocessor">#if (TLS_RSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <span class="comment">//RSASSA-PKCS1-v1_5 signature algorithm with SHA-384</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5">TLS_SIGN_ALGO_RSA</a>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb">TLS_HASH_ALGO_SHA384</a>;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;         }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">#if (TLS_SHA1_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="preprocessor">#if (TLS_ECDSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;         <span class="comment">//ECDSA signature algorithm with SHA-1</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;         supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a">TLS_SIGN_ALGO_ECDSA</a>;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;         supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f">TLS_HASH_ALGO_SHA1</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#if (TLS_RSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;         <span class="comment">//RSASSA-PKCS1-v1_5 signature algorithm with SHA-1</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;         supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5">TLS_SIGN_ALGO_RSA</a>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;         supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f">TLS_HASH_ALGO_SHA1</a>;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">#if (TLS_DSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;         <span class="comment">//DSA signature algorithm with SHA-1</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;         supportedSignAlgos-&gt;value[<a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>].signature = <a class="code" href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d">TLS_SIGN_ALGO_DSA</a>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         supportedSignAlgos-&gt;value[n++].hash = <a class="code" href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f">TLS_HASH_ALGO_SHA1</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;         <span class="comment">//Fix the length of the list</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;         supportedSignAlgos-&gt;length = <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(n * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a5c96bca6675e08f0abe6e3efb0a78eb3">TlsSignHashAlgo</a>));</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;         <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;         *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a52f8ea223987ee1e857b6687f38d3888">TlsSignHashAlgos</a>) + n * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a5c96bca6675e08f0abe6e3efb0a78eb3">TlsSignHashAlgo</a>);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="comment">//Point to the list of the distinguished names of acceptable certificate</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="comment">//authorities</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      certAuthorities = <a class="code" href="../../da/d42/os__port_8h.html#ab20fce5a8cce390611c29101c2e48dd9">PTR_OFFSET</a>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a96ef533723d450ad6c4903a78c756f9e">TlsCertAuthorities</a>);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="comment">//Point to the first certificate authority</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      p = certAuthorities-&gt;value;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="comment">//Length of the list in bytes</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      n = 0;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="comment">//Point to the first trusted CA certificate</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      trustedCaList = context-&gt;trustedCaList;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="comment">//Get the total length, in bytes, of the trusted CA list</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      trustedCaListLen = context-&gt;trustedCaListLen;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="comment">//Allocate a memory buffer to store X.509 certificate info</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      certInfo = <a class="code" href="../../df/d79/tls_8h.html#a00504a83fb06cb4206f7205664ffeeb4">tlsAllocMem</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d16/structX509CertificateInfo.html">X509CertificateInfo</a>));</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="comment">//Successful memory allocation?</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keywordflow">if</span>(certInfo != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;         <span class="comment">//Loop through the list of trusted CA certificates</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;         <span class="keywordflow">while</span>(trustedCaListLen &gt; 0 &amp;&amp; error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;         {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="comment">//The first pass calculates the length of the DER-encoded certificate</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            error = <a class="code" href="../../d5/d2f/certificate_2pem__import_8c.html#a861695b3eda2ba8ca5ea2a5b2715c152">pemImportCertificate</a>(trustedCaList, trustedCaListLen, <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;               &amp;derCertLen, &amp;pemCertLen);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <span class="comment">//Check status code</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            {</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;               <span class="comment">//Allocate a memory buffer to hold the DER-encoded certificate</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;               derCert = <a class="code" href="../../df/d79/tls_8h.html#a00504a83fb06cb4206f7205664ffeeb4">tlsAllocMem</a>(derCertLen);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;               <span class="comment">//Successful memory allocation?</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;               <span class="keywordflow">if</span>(derCert != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;               {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                  <span class="comment">//The second pass decodes the PEM certificate</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                  error = <a class="code" href="../../d5/d2f/certificate_2pem__import_8c.html#a861695b3eda2ba8ca5ea2a5b2715c152">pemImportCertificate</a>(trustedCaList, trustedCaListLen,</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                     derCert, &amp;derCertLen, <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                  <span class="comment">//Check status code</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                  <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                  {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                     <span class="comment">//Parse X.509 certificate</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                     error = <a class="code" href="../../d3/d76/certificate_2x509__cert__parse_8c.html#a0c8997b0f608c1fee25bdd281e7c4acb">x509ParseCertificate</a>(derCert, derCertLen, certInfo);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                  }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                  <span class="comment">//Valid CA certificate?</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                  <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                  {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                     <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                     *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">rawDataLen</a> + 2;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                     <span class="comment">//Sanity check</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                     <span class="keywordflow">if</span>(*length &lt;= context-&gt;txBufferMaxLen)</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                     {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                        <span class="comment">//Each distinguished name is preceded by a 2-byte length field</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                        <a class="code" href="../../df/de9/cpu__endian_8h.html#a8e657bcdf3842380d2d0006859029240">STORE16BE</a>(certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">rawDataLen</a>, p);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                        <span class="comment">//The distinguished name shall be DER-encoded</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                        memcpy(p + 2, certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a16f889e11f79b38a1ade245692857253">rawData</a>,</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                           certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">rawDataLen</a>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                        <span class="comment">//Advance write pointer</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                        p += certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">rawDataLen</a> + 2;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                        n += certInfo-&gt;<a class="code" href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">tbsCert</a>.<a class="code" href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">subject</a>.<a class="code" href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">rawDataLen</a> + 2;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                     }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                     <span class="keywordflow">else</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                     {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                        <span class="comment">//Report an error</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                        error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf">ERROR_MESSAGE_TOO_LONG</a>;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                     } </div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                  }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                  <span class="keywordflow">else</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                  {</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                     <span class="comment">//Discard current CA certificate</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                     error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                  }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                  <span class="comment">//Free previously allocated memory</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                  <a class="code" href="../../df/d79/tls_8h.html#a3bf186204f261ff5d65b31794917f742">tlsFreeMem</a>(derCert);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;               }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;               <span class="keywordflow">else</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;               {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                  <span class="comment">//Failed to allocate memory</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                  error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69">ERROR_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;               }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;               <span class="comment">//Advance read pointer</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;               trustedCaList += pemCertLen;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;               trustedCaListLen -= pemCertLen;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;               <span class="comment">//End of file detected</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;               trustedCaListLen = 0;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;               error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;         }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;         <span class="comment">//Fix the length of the list</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;         certAuthorities-&gt;length = <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(n);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;         <span class="comment">//Free previously allocated memory</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;         <a class="code" href="../../df/d79/tls_8h.html#a3bf186204f261ff5d65b31794917f742">tlsFreeMem</a>(certInfo);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         <span class="comment">//Failed to allocate memory</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;         error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69">ERROR_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   }</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= TLS_VERSION_1_3 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_3)</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <span class="comment">//TLS 1.3 currently selected?</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version == <a class="code" href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a>)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <a class="code" href="../../dc/d84/tls13__misc_8h.html#a7a73aa4b5d0ca0a547bc83636546f438">Tls13CertRequestContext</a> *certRequestContext;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a> *extensionList;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="comment">//Point to the certificate_request_context field</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      certRequestContext = (<a class="code" href="../../dc/d84/tls13__misc_8h.html#a7a73aa4b5d0ca0a547bc83636546f438">Tls13CertRequestContext</a> *) p;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="comment">//The certificate_request_context field shall be zero length unless</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="comment">//used for the post-handshake authentication exchange</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      certRequestContext-&gt;length = 0;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      p += <span class="keyword">sizeof</span>(<a class="code" href="../../dc/d84/tls13__misc_8h.html#a7a73aa4b5d0ca0a547bc83636546f438">Tls13CertRequestContext</a>);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="comment">//Length of the handshake message</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../dc/d84/tls13__misc_8h.html#a7a73aa4b5d0ca0a547bc83636546f438">Tls13CertRequestContext</a>);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="comment">//The extensions describe the parameters of the certificate being</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="comment">//requested</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      extensionList = (<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a> *) p;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="comment">//Total length of the extension list</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      extensionList-&gt;length = 0;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <span class="comment">//Point to the first extension of the list</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="comment">//The SignatureAlgorithms extension must be specified</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      error = <a class="code" href="../../da/db8/tls__common_8c.html#a3e8da6ef31b6d88603dd0b9ff5c9899c">tlsFormatSignatureAlgorithmsExtension</a>(context,</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         <a class="code" href="../../d1/d4c/tls__cipher__suites_8h.html#aa19934da0d53bda533624f13ba98303ba876aff9a6f283b9cc44eeb7c668cad43">TLS_CIPHER_SUITE_TYPE_ECC</a>, p, &amp;n);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="preprocessor">#if (TLS_SIGN_ALGOS_CERT_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="comment">//Check status code</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;         <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;         <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;         p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;         <span class="comment">//The SignatureAlgorithmsCert extension may optionally be included</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;         error = <a class="code" href="../../da/db8/tls__common_8c.html#a2cb196a73d9b8d67091a344fe3551789">tlsFormatSignatureAlgorithmsCertExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      }</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="comment">//Check status code</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      {</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;         <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;         extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;         <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;         p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      }</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <span class="comment">//Convert the length of the extension list to network byte order</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      extensionList-&gt;length = <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(extensionList-&gt;length);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="comment">//Total length of the message</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(extensionList-&gt;length);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   <span class="comment">//Invalid TLS version?</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="comment">//Report an error</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a>;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="ttc" id="tls__common_8c_html_a2cb196a73d9b8d67091a344fe3551789"><div class="ttname"><a href="../../da/db8/tls__common_8c.html#a2cb196a73d9b8d67091a344fe3551789">tlsFormatSignatureAlgorithmsCertExtension</a></div><div class="ttdeci">error_t tlsFormatSignatureAlgorithmsCertExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format SignatureAlgorithmsCert extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db8/tls__common_8c_source.html#l01001">tls_common.c:1001</a></div></div>
<div class="ttc" id="structX509CertificateInfo_html_acfa4445df39031f204f8936a2eec189e"><div class="ttname"><a href="../../d4/d16/structX509CertificateInfo.html#acfa4445df39031f204f8936a2eec189e">X509CertificateInfo::tbsCert</a></div><div class="ttdeci">X509TbsCertificate tbsCert</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd1/pkix_2x509__common_8h_source.html#l00922">x509_common.h:922</a></div></div>
<div class="ttc" id="certificate_2pem__import_8c_html_a861695b3eda2ba8ca5ea2a5b2715c152"><div class="ttname"><a href="../../d5/d2f/certificate_2pem__import_8c.html#a861695b3eda2ba8ca5ea2a5b2715c152">pemImportCertificate</a></div><div class="ttdeci">error_t pemImportCertificate(const char_t **input, size_t *inputLen, uint8_t **output, size_t *outputSize, size_t *outputLen)</div><div class="ttdoc">Decode a PEM file containing a certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2f/certificate_2pem__import_8c_source.html#l02482">pem_import.c:2482</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a40bb5262bf908c328fbcfbe5d29d0201"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a40bb5262bf908c328fbcfbe5d29d0201">char_t</a></div><div class="ttdeci">char char_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00043">compiler_port.h:43</a></div></div>
<div class="ttc" id="tls_8h_html_a207a823320ed0904352de25ac220b5d8"><div class="ttname"><a href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a></div><div class="ttdeci">__start_packed struct @87 TlsCertificateRequest</div><div class="ttdoc">CertificateRequest message. </div></div>
<div class="ttc" id="structX509Name_html_a16f889e11f79b38a1ade245692857253"><div class="ttname"><a href="../../d7/d7c/structX509Name.html#a16f889e11f79b38a1ade245692857253">X509Name::rawData</a></div><div class="ttdeci">const uint8_t * rawData</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/certificate_2x509__common_8h_source.html#l00477">x509_common.h:477</a></div></div>
<div class="ttc" id="tls_8h_html_a3bf186204f261ff5d65b31794917f742"><div class="ttname"><a href="../../df/d79/tls_8h.html#a3bf186204f261ff5d65b31794917f742">tlsFreeMem</a></div><div class="ttdeci">#define tlsFreeMem(p)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00762">tls.h:762</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7">TLS_SIGN_ALGO_RSA_PSS_PSS_SHA384</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01121">tls.h:1121</a></div></div>
<div class="ttc" id="ndp_8h_html_a6519522ad9a6f45e7a8d25d31392a977"><div class="ttname"><a href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a></div><div class="ttdeci">uint8_t p</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/ndp_8h_source.html#l00298">ndp.h:298</a></div></div>
<div class="ttc" id="structX509Name_html_a0f57dd73feee5e3a4aa769fa1ecf3766"><div class="ttname"><a href="../../d7/d7c/structX509Name.html#a0f57dd73feee5e3a4aa769fa1ecf3766">X509Name::rawDataLen</a></div><div class="ttdeci">size_t rawDataLen</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/certificate_2x509__common_8h_source.html#l00478">x509_common.h:478</a></div></div>
<div class="ttc" id="tls_8h_html_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec">TLS_CERT_ECDSA_SIGN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01079">tls.h:1079</a></div></div>
<div class="ttc" id="tls__common_8c_html_a3e8da6ef31b6d88603dd0b9ff5c9899c"><div class="ttname"><a href="../../da/db8/tls__common_8c.html#a3e8da6ef31b6d88603dd0b9ff5c9899c">tlsFormatSignatureAlgorithmsExtension</a></div><div class="ttdeci">error_t tlsFormatSignatureAlgorithmsExtension(TlsContext *context, uint_t cipherSuiteTypes, uint8_t *p, size_t *written)</div><div class="ttdoc">Format SignatureAlgorithms extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db8/tls__common_8c_source.html#l00795">tls_common.c:795</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="structX509CertificateInfo_html"><div class="ttname"><a href="../../d4/d16/structX509CertificateInfo.html">X509CertificateInfo</a></div><div class="ttdoc">X.509 certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/certificate_2x509__common_8h_source.html#l00766">x509_common.h:766</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a">TLS_SIGN_ALGO_ECDSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01114">tls.h:1114</a></div></div>
<div class="ttc" id="certificate_2x509__cert__parse_8c_html_a0c8997b0f608c1fee25bdd281e7c4acb"><div class="ttname"><a href="../../d3/d76/certificate_2x509__cert__parse_8c.html#a0c8997b0f608c1fee25bdd281e7c4acb">x509ParseCertificate</a></div><div class="ttdeci">error_t x509ParseCertificate(const uint8_t *data, size_t length, X509CertificateInfo *certInfo)</div><div class="ttdoc">Parse a X.509 certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d76/certificate_2x509__cert__parse_8c_source.html#l00062">x509_cert_parse.c:62</a></div></div>
<div class="ttc" id="tls_8h_html_ab44dc642afbfbd72926ab1f94634cd4d"><div class="ttname"><a href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a></div><div class="ttdeci">#define TLS_VERSION_1_3</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00095">tls.h:95</a></div></div>
<div class="ttc" id="stdint_8h_html_a273cf69d639a59973b6019625df33e30"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a></div><div class="ttdeci">unsigned short uint16_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00079">stdint.h:79</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57">TLS_SIGN_ALGO_RSA_PSS_RSAE_SHA256</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01115">tls.h:1115</a></div></div>
<div class="ttc" id="cpu__endian_8h_html_a800cdbf435a85a9b3ad4f0edc518472a"><div class="ttname"><a href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a></div><div class="ttdeci">#define htons(value)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/cpu__endian_8h_source.html#l00392">cpu_endian.h:392</a></div></div>
<div class="ttc" id="group__BSPDefine_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6b/nm__bsp_8h_source.html#l00070">nm_bsp.h:70</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf">ERROR_MESSAGE_TOO_LONG</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00134">error.h:134</a></div></div>
<div class="ttc" id="os__port_8h_html_ab20fce5a8cce390611c29101c2e48dd9"><div class="ttname"><a href="../../da/d42/os__port_8h.html#ab20fce5a8cce390611c29101c2e48dd9">PTR_OFFSET</a></div><div class="ttdeci">#define PTR_OFFSET(addr, offset)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00040">os_port.h:40</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d">TLS_SIGN_ALGO_DSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01113">tls.h:1113</a></div></div>
<div class="ttc" id="stdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00078">stdint.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a52f8ea223987ee1e857b6687f38d3888"><div class="ttname"><a href="../../df/d79/tls_8h.html#a52f8ea223987ee1e857b6687f38d3888">TlsSignHashAlgos</a></div><div class="ttdeci">__start_packed struct @65 TlsSignHashAlgos</div><div class="ttdoc">List of signature algorithms. </div></div>
<div class="ttc" id="certificate_2x509__common_8c_html_ab4fb04ff1cc1ecd24548e967fb7acb5a"><div class="ttname"><a href="../../d8/dc7/certificate_2x509__common_8c.html#ab4fb04ff1cc1ecd24548e967fb7acb5a">x509IsSignAlgoSupported</a></div><div class="ttdeci">bool_t x509IsSignAlgoSupported(X509SignatureAlgo signAlgo)</div><div class="ttdoc">Check whether a given signature algorithm is supported. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc7/certificate_2x509__common_8c_source.html#l00307">x509_common.c:307</a></div></div>
<div class="ttc" id="sha256_8h_html_ac65e86d6ed85707af5486ff4d9f87c71"><div class="ttname"><a href="../../d5/de3/sha256_8h.html#ac65e86d6ed85707af5486ff4d9f87c71">SHA256_HASH_ALGO</a></div><div class="ttdeci">#define SHA256_HASH_ALGO</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de3/sha256_8h_source.html#l00046">sha256.h:46</a></div></div>
<div class="ttc" id="tls_8h_html_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882"><div class="ttname"><a href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882">TLS_HASH_ALGO_INTRINSIC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01101">tls.h:1101</a></div></div>
<div class="ttc" id="tls_8h_html_a5c96bca6675e08f0abe6e3efb0a78eb3"><div class="ttname"><a href="../../df/d79/tls_8h.html#a5c96bca6675e08f0abe6e3efb0a78eb3">TlsSignHashAlgo</a></div><div class="ttdeci">__start_packed struct @64 TlsSignHashAlgo</div><div class="ttdoc">Signature algorithm. </div></div>
<div class="ttc" id="sha384_8h_html_a3dd6226e61249284db3162706a53ea39"><div class="ttname"><a href="../../d5/de0/sha384_8h.html#a3dd6226e61249284db3162706a53ea39">SHA384_HASH_ALGO</a></div><div class="ttdeci">#define SHA384_HASH_ALGO</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de0/sha384_8h_source.html#l00047">sha384.h:47</a></div></div>
<div class="ttc" id="structX509TbsCertificate_html_a68e21bffb3f287f4e57378b275e1d178"><div class="ttname"><a href="../../df/daa/structX509TbsCertificate.html#a68e21bffb3f287f4e57378b275e1d178">X509TbsCertificate::subject</a></div><div class="ttdeci">X509Name subject</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd1/pkix_2x509__common_8h_source.html#l00910">x509_common.h:910</a></div></div>
<div class="ttc" id="tls_8h_html_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b">TLS_CERT_RSA_SIGN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01072">tls.h:1072</a></div></div>
<div class="ttc" id="tls_8h_html_a7bbdd7bf690ae50dd1106ebc0bd92b0c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a></div><div class="ttdeci">__start_packed struct @69 TlsExtensionList</div><div class="ttdoc">List of TLS extensions. </div></div>
<div class="ttc" id="certificate_2x509__common_8h_html_ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a"><div class="ttname"><a href="../../dd/db2/certificate_2x509__common_8h.html#ac7f323ef3436e8cc3a89862a5e818078ae780ed4bee657c707e10479fc8f55c0a">X509_SIGN_ALGO_RSA_PSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/certificate_2x509__common_8h_source.html#l00432">x509_common.h:432</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4">TLS_SIGN_ALGO_RSA_PSS_RSAE_SHA384</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01116">tls.h:1116</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4">TLS_CERT_DSS_SIGN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01073">tls.h:1073</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls_8h_html_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb"><div class="ttname"><a href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb">TLS_HASH_ALGO_SHA384</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01099">tls.h:1099</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5">TLS_SIGN_ALGO_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01112">tls.h:1112</a></div></div>
<div class="ttc" id="cpu__endian_8h_html_a8e657bcdf3842380d2d0006859029240"><div class="ttname"><a href="../../df/de9/cpu__endian_8h.html#a8e657bcdf3842380d2d0006859029240">STORE16BE</a></div><div class="ttdeci">#define STORE16BE(a, p)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/cpu__endian_8h_source.html#l00246">cpu_endian.h:246</a></div></div>
<div class="ttc" id="tls_8h_html_a96ef533723d450ad6c4903a78c756f9e"><div class="ttname"><a href="../../df/d79/tls_8h.html#a96ef533723d450ad6c4903a78c756f9e">TlsCertAuthorities</a></div><div class="ttdeci">__start_packed struct @67 TlsCertAuthorities</div><div class="ttdoc">List of certificate authorities. </div></div>
<div class="ttc" id="demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_html_a52d999bffef4c5d89345bd0ce7d91042"><div class="ttname"><a href="../../d4/ddf/demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c.html#a52d999bffef4c5d89345bd0ce7d91042">trustedCaList</a></div><div class="ttdeci">const char_t trustedCaList[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_source.html#l00195">main.c:195</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00116">error.h:116</a></div></div>
<div class="ttc" id="tls13__misc_8h_html_a7a73aa4b5d0ca0a547bc83636546f438"><div class="ttname"><a href="../../dc/d84/tls13__misc_8h.html#a7a73aa4b5d0ca0a547bc83636546f438">Tls13CertRequestContext</a></div><div class="ttdeci">__start_packed struct @98 Tls13CertRequestContext</div><div class="ttdoc">Certificate request context. </div></div>
<div class="ttc" id="tls__cipher__suites_8h_html_aa19934da0d53bda533624f13ba98303ba876aff9a6f283b9cc44eeb7c668cad43"><div class="ttname"><a href="../../d1/d4c/tls__cipher__suites_8h.html#aa19934da0d53bda533624f13ba98303ba876aff9a6f283b9cc44eeb7c668cad43">TLS_CIPHER_SUITE_TYPE_ECC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d4c/tls__cipher__suites_8h_source.html#l00431">tls_cipher_suites.h:431</a></div></div>
<div class="ttc" id="tls_8h_html_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f"><div class="ttname"><a href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f">TLS_HASH_ALGO_SHA1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01096">tls.h:1096</a></div></div>
<div class="ttc" id="tls_8h_html_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182"><div class="ttname"><a href="../../df/d79/tls_8h.html#a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182">TLS_HASH_ALGO_SHA256</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01098">tls.h:1098</a></div></div>
<div class="ttc" id="tls_8h_html_a00504a83fb06cb4206f7205664ffeeb4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a00504a83fb06cb4206f7205664ffeeb4">tlsAllocMem</a></div><div class="ttdeci">#define tlsAllocMem(size)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00757">tls.h:757</a></div></div>
<div class="ttc" id="tls_8h_html_abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d"><div class="ttname"><a href="../../df/d79/tls_8h.html#abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d">TLS_SIGN_ALGO_RSA_PSS_PSS_SHA256</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01120">tls.h:1120</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_a5a648f5ec00c526b0dfa2df7a272c6c0"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a></div><div class="ttdeci">uint8_t n</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00413">dhcpv6_common.h:413</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69">ERROR_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00063">error.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4d8dee25b92b399334e45683b466f403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d8dee25b92b399334e45683b466f403">&#9670;&nbsp;</a></span>tlsFormatServerHello()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsFormatServerHello </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format ServerHello message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>Buffer where to format the ServerHello message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">length</td><td>Length of the resulting ServerHello message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00386">386</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;{</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">version</a>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *<a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a> *extensionList;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="comment">//In TLS 1.3, the client indicates its version preferences in the</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="comment">//SupportedVersions extension and the legacy_version field must be</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="comment">//set to 0x0303, which is the version number for TLS 1.2</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   version = <a class="code" href="../../da/d42/os__port_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(context-&gt;version, <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#if (DTLS_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <span class="comment">//DTLS protocol?</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keywordflow">if</span>(context-&gt;transportProtocol == <a class="code" href="../../df/d79/tls_8h.html#a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92">TLS_TRANSPORT_PROTOCOL_DATAGRAM</a>)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="comment">//Get the corresponding DTLS version</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      version = <a class="code" href="../../dd/da4/dtls__misc_8c.html#a309abf8d9966cd0d5a28be1d94859970">dtlsTranslateVersion</a>(version);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   }</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="comment">//In previous versions of TLS, the version field contains the lower of</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="comment">//the version suggested by the client in the ClientHello and the highest</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <span class="comment">//supported by the server</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;serverVersion = <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(version);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <span class="comment">//Server random value</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   memcpy(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;random, context-&gt;serverRandom, 32);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="comment">//Point to the session ID</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   p = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="comment">//Length of the handshake message</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="preprocessor">#if (TLS_SESSION_RESUME_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="comment">//The session ID uniquely identifies the current session</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      memcpy(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId, context-&gt;sessionId, context-&gt;sessionIdLen);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen = (<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>) context-&gt;sessionIdLen;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="comment">//The server may return an empty session ID to indicate that the session</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="comment">//will not be cached and therefore cannot be resumed</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen = 0;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;#endif</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">//The legacy_session_id_echo echoes the contents of the client&#39;s</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">//legacy_session_id field</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      memcpy(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId, context-&gt;sessionId, context-&gt;sessionIdLen);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen = (<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>) context-&gt;sessionIdLen;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="comment">//Debug message</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a67a8f9bc74358aa21745a76e23768dae">TRACE_DEBUG</a>(<span class="stringliteral">&quot;Session ID (%&quot;</span> PRIu8 <span class="stringliteral">&quot; bytes):\r\n&quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   p += <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="comment">//The cipher_suite field contains the single cipher suite selected by</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   <span class="comment">//the server</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <a class="code" href="../../df/de9/cpu__endian_8h.html#a8e657bcdf3842380d2d0006859029240">STORE16BE</a>(context-&gt;cipherSuite.identifier, p);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="comment">//The CRIME exploit takes advantage of TLS compression, so conservative</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="comment">//implementations do not enable compression at the TLS level</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   *p = <a class="code" href="../../df/d79/tls_8h.html#a27ce2afc296aeccf0726bf834d2df74da9e6d39fe3397b578757793795b18d882">TLS_COMPRESSION_METHOD_NULL</a>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;   p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;   <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;   <span class="comment">//Only extensions offered by the client can appear in the server&#39;s list</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   extensionList = (<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a> *) p;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   <span class="comment">//Total length of the extension list</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   extensionList-&gt;length = 0;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   <span class="comment">//Point to the first extension of the list</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a>);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= SSL_VERSION_3_0 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_2)</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="comment">//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 selected by the server?</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">#if (TLS_SNI_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">//The server may include a SNI extension in the ServerHello</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#abe85c18235cfd55be223b44c6c30d464">tlsFormatServerSniExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">#if (TLS_MAX_FRAG_LEN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="comment">//Servers that receive an ClientHello containing a MaxFragmentLength</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="comment">//extension may accept the requested maximum fragment length by including</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="comment">//an extension of type MaxFragmentLength in the ServerHello</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a83a033674e9efbf357891a543c3f4ed3">tlsFormatServerMaxFragLenExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="preprocessor">#if (TLS_RECORD_SIZE_LIMIT_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="comment">//The value of RecordSizeLimit is the maximum size of record in octets</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="comment">//that the endpoint is willing to receive</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#ae228e4be4faa6572a4e6506cab404887">tlsFormatServerRecordSizeLimitExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#if (TLS_ECDH_ANON_KE_SUPPORT == ENABLED || TLS_ECDHE_RSA_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">   TLS_ECDHE_ECDSA_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="comment">//A server that selects an ECC cipher suite in response to a ClientHello</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">//message including an EcPointFormats extension appends this extension</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="comment">//to its ServerHello message</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#aa856298d8714aca4f310519e76694417">tlsFormatServerEcPointFormatsExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor">#if (TLS_ALPN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="comment">//The ALPN extension contains the name of the selected protocol</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#ae9f0a3949fe6785f04c1b7fe18fdc607">tlsFormatServerAlpnExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#if (TLS_RAW_PUBLIC_KEY_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="comment">//The ClientCertType extension in the ServerHello indicates the type</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="comment">//of certificates the client is requested to provide in a subsequent</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="comment">//certificate payload</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a5eb2cc5e804ae91309a4a2459e171463">tlsFormatClientCertTypeExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">//With the ServerCertType extension in the ServerHello, the TLS server</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="comment">//indicates the certificate type carried in the certificate payload</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a4b410a15ac55feeba5986c6a9e15b3a6">tlsFormatServerCertTypeExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#if (TLS_EXT_MASTER_SECRET_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="comment">//If a server implementing RFC 7627 receives the ExtendedMasterSecret</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="comment">//extension, it must include the extension in its ServerHello message</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a02581afedcbbb2656e478ba98700a679">tlsFormatServerEmsExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#if (TLS_SECURE_RENEGOTIATION_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="comment">//During secure renegotiation, the server must include a renegotiation_info</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">//extension containing the saved client_verify_data and server_verify_data</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#ae3a2681db3e04378ed7cedff914875d3">tlsFormatServerRenegoInfoExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= TLS_VERSION_1_3 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_3)</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   <span class="comment">//TLS 1.3 selected by the server?</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version == <a class="code" href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a>)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">//A server which negotiates TLS 1.3 must respond by sending a</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">//SupportedVersions extension containing the selected version value</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      error = <a class="code" href="../../d5/da3/tls13__server__extensions_8h.html#aea9f239bca2d7c4ee1afff4fe77c98c1">tls13FormatServerSupportedVersionsExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="comment">//If using (EC)DHE key establishment, servers offer exactly one</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="comment">//KeyShareEntry in the ServerHello</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      error = <a class="code" href="../../d5/da3/tls13__server__extensions_8h.html#a7500e6dd20343dd41fa023fbce015a77">tls13FormatServerKeyShareExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">//In order to accept PSK key establishment, the server sends a</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">//PreSharedKey extension indicating the selected identity</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      error = <a class="code" href="../../d5/da3/tls13__server__extensions_8h.html#a989030b6604ad5e1f0b360b5e3634264">tls13FormatServerPreSharedKeyExtension</a>(context, p, &amp;n);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">//Fix the length of the extension list</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      extensionList-&gt;length += (<a class="code" href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>) n;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="comment">//Invalid TLS version?</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="comment">//Report an error</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <span class="comment">//Any extensions included in the ServerHello message?</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <span class="keywordflow">if</span>(extensionList-&gt;length &gt; 0)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">//Convert the length of the extension list to network byte order</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      extensionList-&gt;length = <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(extensionList-&gt;length);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">//Total length of the message</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a>) + <a class="code" href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a>(extensionList-&gt;length);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;   }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <span class="comment">//Successful processing</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div><div class="ttc" id="dtls__misc_8h_html_ab6d7b6f8c2ceaba7acda80aaf05f4899"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">version</a></div><div class="ttdeci">uint16_t version</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00172">dtls_misc.h:172</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_ae9f0a3949fe6785f04c1b7fe18fdc607"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#ae9f0a3949fe6785f04c1b7fe18fdc607">tlsFormatServerAlpnExtension</a></div><div class="ttdeci">error_t tlsFormatServerAlpnExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format ALPN extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00309">tls_server_extensions.c:309</a></div></div>
<div class="ttc" id="tls_8h_html_a27ce2afc296aeccf0726bf834d2df74da9e6d39fe3397b578757793795b18d882"><div class="ttname"><a href="../../df/d79/tls_8h.html#a27ce2afc296aeccf0726bf834d2df74da9e6d39fe3397b578757793795b18d882">TLS_COMPRESSION_METHOD_NULL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01015">tls.h:1015</a></div></div>
<div class="ttc" id="ndp_8h_html_a6519522ad9a6f45e7a8d25d31392a977"><div class="ttname"><a href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a></div><div class="ttdeci">uint8_t p</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/ndp_8h_source.html#l00298">ndp.h:298</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_ae3a2681db3e04378ed7cedff914875d3"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#ae3a2681db3e04378ed7cedff914875d3">tlsFormatServerRenegoInfoExtension</a></div><div class="ttdeci">error_t tlsFormatServerRenegoInfoExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format RenegotiationInfo extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00512">tls_server_extensions.c:512</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a02581afedcbbb2656e478ba98700a679"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a02581afedcbbb2656e478ba98700a679">tlsFormatServerEmsExtension</a></div><div class="ttdeci">error_t tlsFormatServerEmsExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format ExtendedMasterSecret extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00471">tls_server_extensions.c:471</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="tls_8h_html_ab44dc642afbfbd72926ab1f94634cd4d"><div class="ttname"><a href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a></div><div class="ttdeci">#define TLS_VERSION_1_3</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00095">tls.h:95</a></div></div>
<div class="ttc" id="stdint_8h_html_a273cf69d639a59973b6019625df33e30"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a></div><div class="ttdeci">unsigned short uint16_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00079">stdint.h:79</a></div></div>
<div class="ttc" id="cpu__endian_8h_html_a800cdbf435a85a9b3ad4f0edc518472a"><div class="ttname"><a href="../../df/de9/cpu__endian_8h.html#a800cdbf435a85a9b3ad4f0edc518472a">htons</a></div><div class="ttdeci">#define htons(value)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/cpu__endian_8h_source.html#l00392">cpu_endian.h:392</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="stdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00078">stdint.h:78</a></div></div>
<div class="ttc" id="tls13__server__extensions_8h_html_aea9f239bca2d7c4ee1afff4fe77c98c1"><div class="ttname"><a href="../../d5/da3/tls13__server__extensions_8h.html#aea9f239bca2d7c4ee1afff4fe77c98c1">tls13FormatServerSupportedVersionsExtension</a></div><div class="ttdeci">error_t tls13FormatServerSupportedVersionsExtension(TlsContext *context, uint8_t *p, size_t *written)</div></div>
<div class="ttc" id="tls_8h_html_a3b37d03b4f71ce65b23f369d2040a245"><div class="ttname"><a href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a></div><div class="ttdeci">__start_packed struct @86 TlsServerHello</div><div class="ttdoc">ServerHello message. </div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a83a033674e9efbf357891a543c3f4ed3"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a83a033674e9efbf357891a543c3f4ed3">tlsFormatServerMaxFragLenExtension</a></div><div class="ttdeci">error_t tlsFormatServerMaxFragLenExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format MaxFragmentLength extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00109">tls_server_extensions.c:109</a></div></div>
<div class="ttc" id="tls_8h_html_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92"><div class="ttname"><a href="../../df/d79/tls_8h.html#a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92">TLS_TRANSPORT_PROTOCOL_DATAGRAM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00851">tls.h:851</a></div></div>
<div class="ttc" id="tls13__server__extensions_8h_html_a7500e6dd20343dd41fa023fbce015a77"><div class="ttname"><a href="../../d5/da3/tls13__server__extensions_8h.html#a7500e6dd20343dd41fa023fbce015a77">tls13FormatServerKeyShareExtension</a></div><div class="ttdeci">error_t tls13FormatServerKeyShareExtension(TlsContext *context, uint8_t *p, size_t *written)</div></div>
<div class="ttc" id="dtls__misc_8c_html_a309abf8d9966cd0d5a28be1d94859970"><div class="ttname"><a href="../../dd/da4/dtls__misc_8c.html#a309abf8d9966cd0d5a28be1d94859970">dtlsTranslateVersion</a></div><div class="ttdeci">uint16_t dtlsTranslateVersion(uint16_t version)</div><div class="ttdoc">Translate TLS version into DTLS version. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/da4/dtls__misc_8c_source.html#l00113">dtls_misc.c:113</a></div></div>
<div class="ttc" id="tls_8h_html_a7bbdd7bf690ae50dd1106ebc0bd92b0c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a7bbdd7bf690ae50dd1106ebc0bd92b0c">TlsExtensionList</a></div><div class="ttdeci">__start_packed struct @69 TlsExtensionList</div><div class="ttdoc">List of TLS extensions. </div></div>
<div class="ttc" id="os__port_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../da/d42/os__port_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00062">os_port.h:62</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_ae228e4be4faa6572a4e6506cab404887"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#ae228e4be4faa6572a4e6506cab404887">tlsFormatServerRecordSizeLimitExtension</a></div><div class="ttdeci">error_t tlsFormatServerRecordSizeLimitExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format RecordSizeLimit extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00177">tls_server_extensions.c:177</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a4b410a15ac55feeba5986c6a9e15b3a6"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a4b410a15ac55feeba5986c6a9e15b3a6">tlsFormatServerCertTypeExtension</a></div><div class="ttdeci">error_t tlsFormatServerCertTypeExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format ServerCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00424">tls_server_extensions.c:424</a></div></div>
<div class="ttc" id="cpu__endian_8h_html_a8e657bcdf3842380d2d0006859029240"><div class="ttname"><a href="../../df/de9/cpu__endian_8h.html#a8e657bcdf3842380d2d0006859029240">STORE16BE</a></div><div class="ttdeci">#define STORE16BE(a, p)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/cpu__endian_8h_source.html#l00246">cpu_endian.h:246</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00116">error.h:116</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a5eb2cc5e804ae91309a4a2459e171463"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a5eb2cc5e804ae91309a4a2459e171463">tlsFormatClientCertTypeExtension</a></div><div class="ttdeci">error_t tlsFormatClientCertTypeExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format ClientCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00376">tls_server_extensions.c:376</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_aa856298d8714aca4f310519e76694417"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#aa856298d8714aca4f310519e76694417">tlsFormatServerEcPointFormatsExtension</a></div><div class="ttdeci">error_t tlsFormatServerEcPointFormatsExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format EcPointFormats extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00236">tls_server_extensions.c:236</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_a5a648f5ec00c526b0dfa2df7a272c6c0"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a></div><div class="ttdeci">uint8_t n</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00413">dhcpv6_common.h:413</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_abe85c18235cfd55be223b44c6c30d464"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#abe85c18235cfd55be223b44c6c30d464">tlsFormatServerSniExtension</a></div><div class="ttdeci">error_t tlsFormatServerSniExtension(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format SNI extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00055">tls_server_extensions.c:55</a></div></div>
<div class="ttc" id="tls13__server__extensions_8h_html_a989030b6604ad5e1f0b360b5e3634264"><div class="ttname"><a href="../../d5/da3/tls13__server__extensions_8h.html#a989030b6604ad5e1f0b360b5e3634264">tls13FormatServerPreSharedKeyExtension</a></div><div class="ttdeci">error_t tls13FormatServerPreSharedKeyExtension(TlsContext *context, uint8_t *p, size_t *written)</div></div>
<div class="ttc" id="debug_8h_html_a67a8f9bc74358aa21745a76e23768dae"><div class="ttname"><a href="../../db/d16/debug_8h.html#a67a8f9bc74358aa21745a76e23768dae">TRACE_DEBUG</a></div><div class="ttdeci">#define TRACE_DEBUG(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00106">debug.h:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac2375898dec7aa0ceaff2faefd467f76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2375898dec7aa0ceaff2faefd467f76">&#9670;&nbsp;</a></span>tlsFormatServerHelloDone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsFormatServerHelloDone </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#a71e29f87ab91f2adb5655ad8157e7aea">TlsServerHelloDone</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format ServerHelloDone message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>Buffer where to format the ServerHelloDone message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">length</td><td>Length of the resulting ServerHelloDone message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l01151">1151</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;{</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="comment">//The ServerHelloDone message does not contain any data</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> = 0;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <span class="comment">//Successful processing</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;}</div><div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9133776b8d42f0da84f6b8446448069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9133776b8d42f0da84f6b8446448069">&#9670;&nbsp;</a></span>tlsFormatServerKeyExchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsFormatServerKeyExchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#a69c0b3ab7349e73b2e8f9452dbdfef5a">TlsServerKeyExchange</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format ServerKeyExchange message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>Buffer where to format the ServerKeyExchange message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">length</td><td>Length of the resulting ServerKeyExchange message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00680">680</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;{</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   <span class="keywordtype">size_t</span> paramsLen;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *<a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *params;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="comment">//Point to the beginning of the handshake message</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   p = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="comment">//Length of the handshake message</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> = 0;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">#if (TLS_PSK_KE_SUPPORT == ENABLED || TLS_RSA_PSK_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">   TLS_DHE_PSK_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="comment">//PSK key exchange method?</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a> ||</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a> ||</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a> ||</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a>)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="comment">//To help the client in selecting which identity to use, the server</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">//can provide a PSK identity hint in the ServerKeyExchange message</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#aef25ac0a386d26b16921691ef75a97d1">tlsFormatPskIdentityHint</a>(context, p, &amp;n);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   <span class="comment">//Diffie-Hellman or ECDH key exchange method?</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa">TLS_KEY_EXCH_DH_ANON</a> ||</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a> ||</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a> ||</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a> ||</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953">TLS_KEY_EXCH_ECDH_ANON</a> ||</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a> ||</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a> ||</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a>)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">//Point to the server&#39;s key exchange parameters</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      params = <a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="comment">//Format server&#39;s key exchange parameters</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a066a88bee17c444813a6b631b1f442cd">tlsFormatServerKeyParams</a>(context, p, &amp;paramsLen);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      p += paramsLen;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += paramsLen;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="comment">//Just for sanity</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      params = <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      paramsLen = 0;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="comment">//For non-anonymous Diffie-Hellman and ECDH key exchanges, a signature</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="comment">//over the server&#39;s key exchange parameters shall be generated</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a> ||</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a> ||</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a> ||</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a>)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= SSL_VERSION_3_0 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_1)</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="comment">//SSL 3.0, TLS 1.0 or TLS 1.1 currently selected?</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#a9e359f668824d16983a41f8deb338979">TLS_VERSION_1_1</a>)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;         <span class="comment">//Sign server&#39;s key exchange parameters</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;         error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#abf2189814fc56621fbab70c7af9a0ea2">tlsGenerateServerKeySignature</a>(context,</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            (<a class="code" href="../../df/d79/tls_8h.html#a8e07cba48fef31563460ba8f90ad5f1d">TlsDigitalSignature</a> *) p, params, paramsLen, &amp;n);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= TLS_VERSION_1_2 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_2)</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="comment">//TLS 1.2 currently selected?</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version == <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;         <span class="comment">//Sign server&#39;s key exchange parameters</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;         error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a1ac1dcf9d144fb9eb54018ac25b22801">tls12GenerateServerKeySignature</a>(context,</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            (<a class="code" href="../../df/d79/tls_8h.html#ad6758810e829828a20529e27e0f1fb6a">Tls12DigitalSignature</a> *) p, params, paramsLen, &amp;n);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <span class="comment">//Report an error</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;         error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a>;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      }</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="comment">//Advance data pointer</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="comment">//Adjust the length of the message</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      *<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   <span class="comment">//Successful processing</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;}</div><div class="ttc" id="ndp_8h_html_a6519522ad9a6f45e7a8d25d31392a977"><div class="ttname"><a href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a></div><div class="ttdeci">uint8_t p</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/ndp_8h_source.html#l00298">ndp.h:298</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01036">tls.h:1036</a></div></div>
<div class="ttc" id="group__BSPDefine_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6b/nm__bsp_8h_source.html#l00070">nm_bsp.h:70</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01034">tls.h:1034</a></div></div>
<div class="ttc" id="stdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00078">stdint.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953">TLS_KEY_EXCH_ECDH_ANON</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01037">tls.h:1037</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa">TLS_KEY_EXCH_DH_ANON</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01032">tls.h:1032</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_a066a88bee17c444813a6b631b1f442cd"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a066a88bee17c444813a6b631b1f442cd">tlsFormatServerKeyParams</a></div><div class="ttdeci">error_t tlsFormatServerKeyParams(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format server&amp;#39;s key exchange parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00109">tls_server_misc.c:109</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01031">tls.h:1031</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a9e359f668824d16983a41f8deb338979"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9e359f668824d16983a41f8deb338979">TLS_VERSION_1_1</a></div><div class="ttdeci">#define TLS_VERSION_1_1</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00093">tls.h:93</a></div></div>
<div class="ttc" id="tls_8h_html_ad6758810e829828a20529e27e0f1fb6a"><div class="ttname"><a href="../../df/d79/tls_8h.html#ad6758810e829828a20529e27e0f1fb6a">Tls12DigitalSignature</a></div><div class="ttdeci">__start_packed struct @82 Tls12DigitalSignature</div><div class="ttdoc">Digitally-signed element (TLS 1.2) </div></div>
<div class="ttc" id="tls__server__misc_8c_html_a1ac1dcf9d144fb9eb54018ac25b22801"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a1ac1dcf9d144fb9eb54018ac25b22801">tls12GenerateServerKeySignature</a></div><div class="ttdeci">error_t tls12GenerateServerKeySignature(TlsContext *context, Tls12DigitalSignature *signature, const uint8_t *params, size_t paramsLen, size_t *written)</div><div class="ttdoc">Sign server&amp;#39;s key exchange parameters (TLS 1.2) </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00532">tls_server_misc.c:532</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls_8h_html_a8e07cba48fef31563460ba8f90ad5f1d"><div class="ttname"><a href="../../df/d79/tls_8h.html#a8e07cba48fef31563460ba8f90ad5f1d">TlsDigitalSignature</a></div><div class="ttdeci">__start_packed struct @81 TlsDigitalSignature</div><div class="ttdoc">Digitally-signed element (SSL 3.0, TLS 1.0 and TLS 1.1) </div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01029">tls.h:1029</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00116">error.h:116</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01040">tls.h:1040</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_abf2189814fc56621fbab70c7af9a0ea2"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#abf2189814fc56621fbab70c7af9a0ea2">tlsGenerateServerKeySignature</a></div><div class="ttdeci">error_t tlsGenerateServerKeySignature(TlsContext *context, TlsDigitalSignature *signature, const uint8_t *params, size_t paramsLen, size_t *written)</div><div class="ttdoc">Sign server&amp;#39;s key exchange parameters (SSL 3.0, TLS 1.0 and TLS 1.1) </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00325">tls_server_misc.c:325</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01039">tls.h:1039</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01038">tls.h:1038</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_aef25ac0a386d26b16921691ef75a97d1"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#aef25ac0a386d26b16921691ef75a97d1">tlsFormatPskIdentityHint</a></div><div class="ttdeci">error_t tlsFormatPskIdentityHint(TlsContext *context, uint8_t *p, size_t *written)</div><div class="ttdoc">Format PSK identity hint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00064">tls_server_misc.c:64</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_a5a648f5ec00c526b0dfa2df7a272c6c0"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a></div><div class="ttdeci">uint8_t n</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00413">dhcpv6_common.h:413</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01041">tls.h:1041</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a38ce6b990031f07a875c795599ccd5d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ce6b990031f07a875c795599ccd5d4">&#9670;&nbsp;</a></span>tlsParseClientHello()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsParseClientHello </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d79/tls_8h.html#ac78d39e638430eb19c4017e5f9797d16">TlsClientHello</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse ClientHello message. </p>
<p>When a client first connects to a server, it is required to send the ClientHello as its first message. The client can also send a ClientHello in response to a HelloRequest or on its own initiative in order to renegotiate the security parameters in an existing connection</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Incoming ClientHello message to parse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>Message length </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l01177">1177</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;{</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;   <span class="keyword">const</span> <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *<a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <span class="keyword">const</span> <a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a> *cipherSuites;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;   <span class="keyword">const</span> <a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a> *compressMethods;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;   <a class="code" href="../../d4/d61/structTlsHelloExtensions.html">TlsHelloExtensions</a> <a class="code" href="../../dc/d84/tls13__misc_8h.html#a7b8cc84c920376c616d85d575080d28e">extensions</a>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="preprocessor">#if (DTLS_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   <span class="keyword">const</span> <a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a> *<a class="code" href="../../d3/d25/dtls__misc_8h.html#a126a9f1c8e75ec207f319533d142c88d">cookie</a>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;   <span class="comment">//Debug message</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;ClientHello message received (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   <span class="comment">//Check current state</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dade201db86ae38480c06696f3a48e0170">TLS_STATE_CLIENT_HELLO</a>)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   {</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="comment">//When a client first connects to a server, it is required to send</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="comment">//the ClientHello as its first message</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   }</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d">TLS_STATE_CLIENT_HELLO_2</a>)</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= TLS_VERSION_1_3 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_3)</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="comment">//The client will also send a updated ClientHello when the server has</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="comment">//responded to its initial ClientHello with a HelloRetryRequest</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      context-&gt;updatedClientHelloReceived = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   }</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b">TLS_STATE_APPLICATION_DATA</a>)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= SSL_VERSION_3_0 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_2)</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="preprocessor">#if (TLS_SECURE_RENEGOTIATION_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;         <span class="comment">//Check whether secure renegotiation is enabled</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;         <span class="keywordflow">if</span>(context-&gt;secureRenegoEnabled)</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;         {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="comment">//Make sure the secure_renegociation flag is set</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <span class="keywordflow">if</span>(!context-&gt;secureRenegoFlag)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;               <span class="comment">//If the connection&#39;s secure_renegotiation flag is set to</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;               <span class="comment">//FALSE, it is recommended that servers do not permit legacy</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;               <span class="comment">//renegotiation (refer to RFC 5746, section 4.4)</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;               <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a>;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;         }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;         {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="comment">//Secure renegotiation is disabled</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;         }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      {</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;         <span class="comment">//Because TLS 1.3 forbids renegotiation, if a server has negotiated</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         <span class="comment">//TLS 1.3 and receives a ClientHello at any other time, it must</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;         <span class="comment">//terminate the connection with an unexpected_message alert</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;   }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="comment">//Report an error</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   <span class="comment">//Check the length of the ClientHello message</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#ac78d39e638430eb19c4017e5f9797d16">TlsClientHello</a>))</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <span class="comment">//Get the version the client wishes to use during this session</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   context-&gt;clientVersion = <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;clientVersion);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="comment">//Point to the session ID</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   p = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   n = <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> - <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#ac78d39e638430eb19c4017e5f9797d16">TlsClientHello</a>);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="comment">//Check the length of the session ID</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen &gt; n)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen &gt; 32)</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <span class="comment">//Debug message</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a67a8f9bc74358aa21745a76e23768dae">TRACE_DEBUG</a>(<span class="stringliteral">&quot;Session ID (%&quot;</span> PRIu8 <span class="stringliteral">&quot; bytes):\r\n&quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   p += <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   n -= <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">#if (DTLS_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="comment">//DTLS protocol?</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordflow">if</span>(context-&gt;transportProtocol == <a class="code" href="../../df/d79/tls_8h.html#a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92">TLS_TRANSPORT_PROTOCOL_DATAGRAM</a>)</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <span class="comment">//Point to the Cookie field</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      cookie = (<a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a> *) p;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="comment">//Malformed ClientHello message?</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">if</span>(n &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a>))</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">if</span>(n &lt; (<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a>) + cookie-&gt;length))</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="comment">//Check the length of the cookie</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">if</span>(cookie-&gt;length &gt; <a class="code" href="../../d3/d25/dtls__misc_8h.html#a64a1e901ad7f80e35590f9595348c410">DTLS_MAX_COOKIE_SIZE</a>)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2">ERROR_ILLEGAL_PARAMETER</a>;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      p += <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a>) + cookie-&gt;length;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      n -= <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a>) + cookie-&gt;length;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;   }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;   {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="comment">//Just for sanity</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      cookie = <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;   }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;   <span class="comment">//List of cryptographic algorithms supported by the client</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   cipherSuites = (<a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a> *) p;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   <span class="comment">//Malformed ClientHello message?</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordflow">if</span>(n &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a>))</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   <span class="keywordflow">if</span>(n &lt; (<span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a>) + <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length)))</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   <span class="comment">//Check the length of the list</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length) == 0)</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;   <span class="keywordflow">if</span>((<a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length) % 2) != 0)</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;   <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a>) + <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   n -= <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a>) + <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   <span class="comment">//List of compression algorithms supported by the client</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   compressMethods = (<a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a> *) p;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   <span class="comment">//Malformed ClientHello message?</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   <span class="keywordflow">if</span>(n &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a>))</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;   <span class="keywordflow">if</span>(n &lt; (<span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a>) + compressMethods-&gt;length))</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;   <span class="comment">//Check the length of the list</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <span class="keywordflow">if</span>(compressMethods-&gt;length == 0)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   p += <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a>) + compressMethods-&gt;length;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   n -= <span class="keyword">sizeof</span>(<a class="code" href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a>) + compressMethods-&gt;length;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <span class="comment">//Parse the list of extensions offered by the client</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   error = <a class="code" href="../../d1/d72/tls__extensions_8c.html#a44cc44e114cbc3c28245bdfa6546cb5c">tlsParseHelloExtensions</a>(<a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8">TLS_TYPE_CLIENT_HELLO</a>, p, n, &amp;extensions);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;   <span class="comment">//Check whether the ClientHello includes any SCSV cipher suites</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#acd0ea01bfbd67e0d7ccbdfc03c595f4f">tlsCheckSignalingCipherSuiteValues</a>(context, cipherSuites);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="preprocessor">#if (TLS_SECURE_RENEGOTIATION_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   <span class="comment">//Parse RenegotiationInfo extension</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#adddc100a1d10d444b0735b69491619a2">tlsParseClientRenegoInfoExtension</a>(context, extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#aecf5a78a44bd06ba8018bd5f4a5043de">renegoInfo</a>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="preprocessor">#if (DTLS_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;   <span class="comment">//DTLS protocol?</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;   <span class="keywordflow">if</span>(context-&gt;transportProtocol == <a class="code" href="../../df/d79/tls_8h.html#a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92">TLS_TRANSPORT_PROTOCOL_DATAGRAM</a>)</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   {</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <a class="code" href="../../df/d13/structDtlsClientParameters.html">DtlsClientParameters</a> clientParams;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <span class="comment">//The server should use client parameters (version, random, session_id,</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      <span class="comment">//cipher_suites, compression_method) to generate its cookie</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a76502088d967b0f240e8804b585e019a">version</a> = <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;clientVersion);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#af465b2ea577f66ff4ebf3b83e5c0b854">random</a> = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;random;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a08ff7ceea84f110d641bc30a7adcdd9e">randomLen</a> = 32;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a6671f99ef473de11b1b7c1b76e8e2cb8">sessionId</a> = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#aca04db05a88059730c97a3dcc25705c0">sessionIdLen</a> = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#ab32c1230661533668c5675127371f0d3">cipherSuites</a> = (<span class="keyword">const</span> <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *) cipherSuites-&gt;value;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a06be73dd013213bf25b4f651f6d5efa8">cipherSuitesLen</a> = <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(cipherSuites-&gt;length);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a233abf95be55fe711b945119c08ffd07">compressMethods</a> = compressMethods-&gt;value;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      clientParams.<a class="code" href="../../df/d13/structDtlsClientParameters.html#a0910d54a373e1c9b1dbfe47cc45458d6">compressMethodsLen</a> = compressMethods-&gt;length;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="comment">//Verify that the cookie is valid</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      error = <a class="code" href="../../dd/da4/dtls__misc_8c.html#af5608ff09d69338af8269eaf548c70d3">dtlsVerifyCookie</a>(context, cookie, &amp;clientParams);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="comment">//The server may respond with a HelloVerifyRequest message containing</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="comment">//a stateless cookie</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da28df1d3e7276c71ab9e2f8c75cdeef2e">TLS_STATE_HELLO_VERIFY_REQUEST</a>)</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      {</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;         <span class="comment">//Exit immediately</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      }</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;   <span class="comment">//Perform version negotiation</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#ad99a99db09cdc1ac0f3cb60f15711035">tlsNegotiateVersion</a>(context, <a class="code" href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a>(<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;clientVersion),</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#ad2c1f8bd3e6432fe17b9ac339fc35a0b">supportedVersionList</a>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   <span class="comment">//Check the list of extensions offered by the client</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   error = <a class="code" href="../../d1/d72/tls__extensions_8c.html#a67e977c5311fc3d9b3503ca226f2ea7a">tlsCheckHelloExtensions</a>(<a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8">TLS_TYPE_CLIENT_HELLO</a>, context-&gt;version,</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      &amp;extensions);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   <span class="comment">//The SignatureAlgorithms extension is not meaningful for TLS versions</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   <span class="comment">//prior to 1.2 (refer to RFC 5246, section 7.4.1.4.1)</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#a9e359f668824d16983a41f8deb338979">TLS_VERSION_1_1</a>)</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   {</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      <span class="comment">//Even if clients do offer it, the rules specified in RFC 6066 require</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="comment">//servers to ignore extensions they do not understand</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a7903ad9cf319d5f27990432c4e719544">signAlgoList</a> = <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a640637c05b8aec2ef15420d5005830cb">certSignAlgoList</a> = <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;   }</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <span class="comment">//Save client random value</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;   memcpy(context-&gt;clientRandom, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;random, 32);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#if (TLS_SNI_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;   <span class="comment">//In order to provide the server name, clients may include a ServerName</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   <span class="comment">//extension</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#ab34de7891d354995208e858a53a14b57">tlsParseClientSniExtension</a>(context, extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a53acaa1dcce86449741ea9a780331d46">serverNameList</a>);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= SSL_VERSION_3_0 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_2)</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   <span class="comment">//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;   {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="comment">//The server attempts to resume TLS session via session ID</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a5f4a1b96d929e08c6e62fa2f5408a894">tlsResumeServerSession</a>(context, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId,</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;         <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen, cipherSuites, &amp;extensions);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="comment">//Full handshake?</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <span class="keywordflow">if</span>(!context-&gt;resume)</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      {</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;         <span class="comment">//Perform cipher suite negotiation</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;         error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a634953aa0fd11d11c625673b3edb2456">tlsNegotiateCipherSuite</a>(context, <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, cipherSuites,</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            &amp;extensions);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;         <span class="comment">//If no acceptable choices are presented, terminate the handshake</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;         <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a>;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;         <span class="comment">//Parse the list of compression methods supported by the client</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;         error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a7aec22c82399ab4173339771d47ceff7">tlsParseCompressMethods</a>(context, compressMethods);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;         <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;         <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      }</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="comment">//Initialize handshake message hashing</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      error = <a class="code" href="../../d6/dca/tls__transcript__hash_8c.html#a96f18526c55951964667477c4134f092">tlsInitTranscriptHash</a>(context);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="preprocessor">#if (TLS_ECDH_ANON_KE_SUPPORT == ENABLED || TLS_ECDHE_RSA_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="preprocessor">   TLS_ECDHE_ECDSA_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="comment">//A client that proposes ECC cipher suites in its ClientHello message</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="comment">//may send the EcPointFormats extension</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#ae22d1c58492882319be6973f889a2244">tlsParseClientEcPointFormatsExtension</a>(context,</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;         extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#aeea7fd9313f97525e78c56a722b0dcfd">ecPointFormatList</a>);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="preprocessor">#if (TLS_EXT_MASTER_SECRET_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="comment">//Parse ExtendedMasterSecret extension</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a1964c308b6b9b35f1c6fc81e59ba2a83">tlsParseClientEmsExtension</a>(context,</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;         extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a04cc0ffcf992700820ec12d6f43212bf">extendedMasterSecret</a>);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   }</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="preprocessor">#if (TLS_MAX_VERSION &gt;= TLS_VERSION_1_3 &amp;&amp; TLS_MIN_VERSION &lt;= TLS_VERSION_1_3)</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   <span class="comment">//TLS 1.3 currently selected?</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version == <a class="code" href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a>)</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;   {</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="comment">//Save the client&#39;s legacy_session_id field</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      memcpy(context-&gt;sessionId, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionId, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      context-&gt;sessionIdLen = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>-&gt;sessionIdLen;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="comment">//Perform cipher suite and key exchange method negotiation</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      error = <a class="code" href="../../da/de2/tls13__server__misc_8h.html#a649ccf93c250a1d8a6c1c4a63ca1660a">tls13NegotiateCipherSuite</a>(context, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>, cipherSuites,</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;         &amp;extensions);</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="comment">//If no acceptable choices are presented, terminate the handshake</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="comment">//Parse the list of compression methods supported by the client</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a7aec22c82399ab4173339771d47ceff7">tlsParseCompressMethods</a>(context, compressMethods);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="comment">//When a PSK is used and early data is allowed for that PSK, the client</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="comment">//can send application data in its first flight of messages</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordflow">if</span>(extensions.earlyDataIndication != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <span class="comment">//If the client opts to do so, it must supply both the PreSharedKey</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;         <span class="comment">//and EarlyData extensions (refer to RFC 8446, section 4.2.10)</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;         <span class="keywordflow">if</span>(extensions.identityList == <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || extensions.binderList == <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;         {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            context-&gt;earlyDataRejected = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;         }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   <span class="comment">//Invalid TLS version?</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="comment">//Just for sanity</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a>;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;   }</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="preprocessor">#if (TLS_MAX_FRAG_LEN_SUPPORT == ENABLED &amp;&amp; TLS_RECORD_SIZE_LIMIT_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;   <span class="comment">//A server that supports the RecordSizeLimit extension must ignore a</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;   <span class="comment">//MaxFragmentLength that appears in a ClientHello if both extensions</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   <span class="comment">//appear (refer to RFC 8449, section 5)</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;   <span class="keywordflow">if</span>(extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a45f3337429c669574aaedfcc6a1a2d23">maxFragLen</a> != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a35167138c60de81d1635fc1d87fc3b8f">recordSizeLimit</a> != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a45f3337429c669574aaedfcc6a1a2d23">maxFragLen</a> = <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="preprocessor">#if (TLS_MAX_FRAG_LEN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;   <span class="comment">//In order to negotiate smaller maximum fragment lengths, clients may</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;   <span class="comment">//include a MaxFragmentLength extension</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a9cc022e4c7f789f6c9a82d1999e77c6a">tlsParseClientMaxFragLenExtension</a>(context, extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a45f3337429c669574aaedfcc6a1a2d23">maxFragLen</a>);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="preprocessor">#if (TLS_RECORD_SIZE_LIMIT_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;   <span class="comment">//The value of RecordSizeLimit is the maximum size of record in octets</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;   <span class="comment">//that the peer is willing to receive</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a4525618ed7ee2f566b94acf4ae6b15af">tlsParseClientRecordSizeLimitExtension</a>(context,</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a35167138c60de81d1635fc1d87fc3b8f">recordSizeLimit</a>);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="preprocessor">#if (TLS_ALPN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;   <span class="comment">//Parse ALPN extension</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a951a27c0cca43690037251630f6511c2">tlsParseClientAlpnExtension</a>(context, extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a0752d52c09a933f5b001385db60159b1">protocolNameList</a>);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="preprocessor">#if (TLS_RAW_PUBLIC_KEY_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;   <span class="comment">//Parse ClientCertType extension</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#a8a2885ab0aadaad5b643aaccc0cc5949">tlsParseClientCertTypeListExtension</a>(context,</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a3091449503c4dcce58f3e62d70c24cd0">clientCertTypeList</a>);</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;   <span class="comment">//Parse ServerCertType extension</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   error = <a class="code" href="../../d9/da7/tls__server__extensions_8c.html#aa5440eb1a18caf8461d6418167d79c5c">tlsParseServerCertTypeListExtension</a>(context,</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      extensions.<a class="code" href="../../d4/d61/structTlsHelloExtensions.html#a7e4a609ad6013ea6bcab97286320cf16">serverCertTypeList</a>);</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;   <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;   <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;   {</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="comment">//Send a ServerHello message to the client</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a">TLS_STATE_SERVER_HELLO</a>;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;   }</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;   {</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="comment">//Send a ServerHello or a HelloRetryRequest message to the client</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dade201db86ae38480c06696f3a48e0170">TLS_STATE_CLIENT_HELLO</a>)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a">TLS_STATE_SERVER_HELLO</a>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d">TLS_STATE_CLIENT_HELLO_2</a>)</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da22971523377f52c52b251553e373b4c8">TLS_STATE_SERVER_HELLO_2</a>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daa874b96bf23b3215942a719bbad609b5">TLS_STATE_HELLO_RETRY_REQUEST</a>;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;   }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;   <span class="comment">//Successful processing</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;}</div><div class="ttc" id="structDtlsClientParameters_html_a0910d54a373e1c9b1dbfe47cc45458d6"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a0910d54a373e1c9b1dbfe47cc45458d6">DtlsClientParameters::compressMethodsLen</a></div><div class="ttdeci">size_t compressMethodsLen</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00227">dtls_misc.h:227</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_a64a1e901ad7f80e35590f9595348c410"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#a64a1e901ad7f80e35590f9595348c410">DTLS_MAX_COOKIE_SIZE</a></div><div class="ttdeci">#define DTLS_MAX_COOKIE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00075">dtls_misc.h:75</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da22971523377f52c52b251553e373b4c8"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da22971523377f52c52b251553e373b4c8">TLS_STATE_SERVER_HELLO_2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01296">tls.h:1296</a></div></div>
<div class="ttc" id="tls__extensions_8c_html_a44cc44e114cbc3c28245bdfa6546cb5c"><div class="ttname"><a href="../../d1/d72/tls__extensions_8c.html#a44cc44e114cbc3c28245bdfa6546cb5c">tlsParseHelloExtensions</a></div><div class="ttdeci">error_t tlsParseHelloExtensions(TlsMessageType msgType, const uint8_t *p, size_t length, TlsHelloExtensions *extensions)</div><div class="ttdoc">Parse Hello extensions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d72/tls__extensions_8c_source.html#l00057">tls_extensions.c:57</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da7ff3a76e0b1787b6d0026e533a89649b">TLS_STATE_APPLICATION_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01319">tls.h:1319</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_a76502088d967b0f240e8804b585e019a"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a76502088d967b0f240e8804b585e019a">DtlsClientParameters::version</a></div><div class="ttdeci">uint16_t version</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00219">dtls_misc.h:219</a></div></div>
<div class="ttc" id="tls13__server__misc_8h_html_a649ccf93c250a1d8a6c1c4a63ca1660a"><div class="ttname"><a href="../../da/de2/tls13__server__misc_8h.html#a649ccf93c250a1d8a6c1c4a63ca1660a">tls13NegotiateCipherSuite</a></div><div class="ttdeci">error_t tls13NegotiateCipherSuite(TlsContext *context, const void *clientHello, size_t clientHelloLen, const TlsCipherSuites *cipherSuites, TlsHelloExtensions *extensions)</div></div>
<div class="ttc" id="structTlsHelloExtensions_html_aecf5a78a44bd06ba8018bd5f4a5043de"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#aecf5a78a44bd06ba8018bd5f4a5043de">TlsHelloExtensions::renegoInfo</a></div><div class="ttdeci">const TlsRenegoInfo * renegoInfo</div><div class="ttdoc">RenegotiationInfo extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01922">tls.h:1922</a></div></div>
<div class="ttc" id="ndp_8h_html_a6519522ad9a6f45e7a8d25d31392a977"><div class="ttname"><a href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a></div><div class="ttdeci">uint8_t p</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/ndp_8h_source.html#l00298">ndp.h:298</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daa874b96bf23b3215942a719bbad609b5"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daa874b96bf23b3215942a719bbad609b5">TLS_STATE_HELLO_RETRY_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01294">tls.h:1294</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a9cc022e4c7f789f6c9a82d1999e77c6a"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a9cc022e4c7f789f6c9a82d1999e77c6a">tlsParseClientMaxFragLenExtension</a></div><div class="ttdeci">error_t tlsParseClientMaxFragLenExtension(TlsContext *context, const uint8_t *maxFragLen)</div><div class="ttdoc">Parse MaxFragmentLength extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00714">tls_server_extensions.c:714</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_a08ff7ceea84f110d641bc30a7adcdd9e"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a08ff7ceea84f110d641bc30a7adcdd9e">DtlsClientParameters::randomLen</a></div><div class="ttdeci">size_t randomLen</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00221">dtls_misc.h:221</a></div></div>
<div class="ttc" id="tls_8h_html_aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8"><div class="ttname"><a href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba374f2754185de2cef4ffb42530ce16a8">TLS_TYPE_CLIENT_HELLO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00933">tls.h:933</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4dade201db86ae38480c06696f3a48e0170"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dade201db86ae38480c06696f3a48e0170">TLS_STATE_CLIENT_HELLO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01290">tls.h:1290</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html">DtlsClientParameters</a></div><div class="ttdoc">Client parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00217">dtls_misc.h:217</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a7903ad9cf319d5f27990432c4e719544"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a7903ad9cf319d5f27990432c4e719544">TlsHelloExtensions::signAlgoList</a></div><div class="ttdeci">const TlsSignHashAlgos * signAlgoList</div><div class="ttdoc">SignatureAlgorithms extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01901">tls.h:1901</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_a5f4a1b96d929e08c6e62fa2f5408a894"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a5f4a1b96d929e08c6e62fa2f5408a894">tlsResumeServerSession</a></div><div class="ttdeci">error_t tlsResumeServerSession(TlsContext *context, const uint8_t *sessionId, size_t sessionIdLen, const TlsCipherSuites *cipherSuites, const TlsHelloExtensions *extensions)</div><div class="ttdoc">Resume TLS session via session ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00921">tls_server_misc.c:921</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_aa5440eb1a18caf8461d6418167d79c5c"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#aa5440eb1a18caf8461d6418167d79c5c">tlsParseServerCertTypeListExtension</a></div><div class="ttdeci">error_t tlsParseServerCertTypeListExtension(TlsContext *context, const TlsCertTypeList *serverCertTypeList)</div><div class="ttdoc">Parse ServerCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l01103">tls_server_extensions.c:1103</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a4525618ed7ee2f566b94acf4ae6b15af"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a4525618ed7ee2f566b94acf4ae6b15af">tlsParseClientRecordSizeLimitExtension</a></div><div class="ttdeci">error_t tlsParseClientRecordSizeLimitExtension(TlsContext *context, const uint8_t *recordSizeLimit)</div><div class="ttdoc">Parse RecordSizeLimit extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00787">tls_server_extensions.c:787</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_a06be73dd013213bf25b4f651f6d5efa8"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a06be73dd013213bf25b4f651f6d5efa8">DtlsClientParameters::cipherSuitesLen</a></div><div class="ttdeci">size_t cipherSuitesLen</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00225">dtls_misc.h:225</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_a60a5bbbe761197a18b2793a1148d56f9"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#a60a5bbbe761197a18b2793a1148d56f9">DtlsCookie</a></div><div class="ttdeci">__start_packed struct @56 DtlsCookie</div><div class="ttdoc">Cookie. </div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a3091449503c4dcce58f3e62d70c24cd0"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a3091449503c4dcce58f3e62d70c24cd0">TlsHelloExtensions::clientCertTypeList</a></div><div class="ttdeci">const TlsCertTypeList * clientCertTypeList</div><div class="ttdoc">ClientCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01913">tls.h:1913</a></div></div>
<div class="ttc" id="tls_8h_html_ab44dc642afbfbd72926ab1f94634cd4d"><div class="ttname"><a href="../../df/d79/tls_8h.html#ab44dc642afbfbd72926ab1f94634cd4d">TLS_VERSION_1_3</a></div><div class="ttdeci">#define TLS_VERSION_1_3</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00095">tls.h:95</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a951a27c0cca43690037251630f6511c2"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a951a27c0cca43690037251630f6511c2">tlsParseClientAlpnExtension</a></div><div class="ttdeci">error_t tlsParseClientAlpnExtension(TlsContext *context, const TlsProtocolNameList *protocolNameList)</div><div class="ttdoc">Parse ALPN extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00929">tls_server_extensions.c:929</a></div></div>
<div class="ttc" id="tls_8h_html_a73df667e4fbedd6b3dd66620b4d5d018"><div class="ttname"><a href="../../df/d79/tls_8h.html#a73df667e4fbedd6b3dd66620b4d5d018">TlsCompressMethods</a></div><div class="ttdeci">__start_packed struct @63 TlsCompressMethods</div><div class="ttdoc">Compression methods. </div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="group__BSPDefine_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6b/nm__bsp_8h_source.html#l00070">nm_bsp.h:70</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_adddc100a1d10d444b0735b69491619a2"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#adddc100a1d10d444b0735b69491619a2">tlsParseClientRenegoInfoExtension</a></div><div class="ttdeci">error_t tlsParseClientRenegoInfoExtension(TlsContext *context, const TlsRenegoInfo *renegoInfo)</div><div class="ttdoc">Parse RenegotiationInfo extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l01225">tls_server_extensions.c:1225</a></div></div>
<div class="ttc" id="stdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00078">stdint.h:78</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00192">error.h:192</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_acd0ea01bfbd67e0d7ccbdfc03c595f4f"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#acd0ea01bfbd67e0d7ccbdfc03c595f4f">tlsCheckSignalingCipherSuiteValues</a></div><div class="ttdeci">error_t tlsCheckSignalingCipherSuiteValues(TlsContext *context, const TlsCipherSuites *cipherSuites)</div><div class="ttdoc">Check whether the ClientHello includes any SCSV cipher suites. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l00816">tls_server_misc.c:816</a></div></div>
<div class="ttc" id="tls__transcript__hash_8c_html_a96f18526c55951964667477c4134f092"><div class="ttname"><a href="../../d6/dca/tls__transcript__hash_8c.html#a96f18526c55951964667477c4134f092">tlsInitTranscriptHash</a></div><div class="ttdeci">error_t tlsInitTranscriptHash(TlsContext *context)</div><div class="ttdoc">Initialize handshake message hashing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dca/tls__transcript__hash_8c_source.html#l00054">tls_transcript_hash.c:54</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a35167138c60de81d1635fc1d87fc3b8f"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a35167138c60de81d1635fc1d87fc3b8f">TlsHelloExtensions::recordSizeLimit</a></div><div class="ttdeci">const uint8_t * recordSizeLimit</div><div class="ttdoc">RecordSizeLimit extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01907">tls.h:1907</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_a7aec22c82399ab4173339771d47ceff7"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a7aec22c82399ab4173339771d47ceff7">tlsParseCompressMethods</a></div><div class="ttdeci">error_t tlsParseCompressMethods(TlsContext *context, const TlsCompressMethods *compressMethods)</div><div class="ttdoc">Parse the list of compression methods supported by the client. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l01589">tls_server_misc.c:1589</a></div></div>
<div class="ttc" id="os__port_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00050">os_port.h:50</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html">TlsHelloExtensions</a></div><div class="ttdoc">Hello extensions. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01894">tls.h:1894</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a45f3337429c669574aaedfcc6a1a2d23"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a45f3337429c669574aaedfcc6a1a2d23">TlsHelloExtensions::maxFragLen</a></div><div class="ttdeci">const uint8_t * maxFragLen</div><div class="ttdoc">MaxFragmentLength extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01904">tls.h:1904</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_a634953aa0fd11d11c625673b3edb2456"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a634953aa0fd11d11c625673b3edb2456">tlsNegotiateCipherSuite</a></div><div class="ttdeci">error_t tlsNegotiateCipherSuite(TlsContext *context, const HashAlgo *hashAlgo, const TlsCipherSuites *cipherSuites, TlsHelloExtensions *extensions)</div><div class="ttdoc">Cipher suite negotiation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l01165">tls_server_misc.c:1165</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_ae22d1c58492882319be6973f889a2244"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#ae22d1c58492882319be6973f889a2244">tlsParseClientEcPointFormatsExtension</a></div><div class="ttdeci">error_t tlsParseClientEcPointFormatsExtension(TlsContext *context, const TlsEcPointFormatList *ecPointFormatList)</div><div class="ttdoc">Parse EcPointFormats extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00868">tls_server_extensions.c:868</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2">ERROR_ILLEGAL_PARAMETER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00237">error.h:237</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a7e4a609ad6013ea6bcab97286320cf16"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a7e4a609ad6013ea6bcab97286320cf16">TlsHelloExtensions::serverCertTypeList</a></div><div class="ttdeci">const TlsCertTypeList * serverCertTypeList</div><div class="ttdoc">ServerCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01915">tls.h:1915</a></div></div>
<div class="ttc" id="cpu__endian_8h_html_a9312c6eb72e64f748ae0d0e0dc3ec9b9"><div class="ttname"><a href="../../df/de9/cpu__endian_8h.html#a9312c6eb72e64f748ae0d0e0dc3ec9b9">ntohs</a></div><div class="ttdeci">#define ntohs(value)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/cpu__endian_8h_source.html#l00398">cpu_endian.h:398</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_ab32c1230661533668c5675127371f0d3"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#ab32c1230661533668c5675127371f0d3">DtlsClientParameters::cipherSuites</a></div><div class="ttdeci">const uint8_t * cipherSuites</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00224">dtls_misc.h:224</a></div></div>
<div class="ttc" id="tls_8h_html_a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92"><div class="ttname"><a href="../../df/d79/tls_8h.html#a25cb7e3df9004160eb21eac9377dc89fa3055717a6d464160f611ee26a81c7d92">TLS_TRANSPORT_PROTOCOL_DATAGRAM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00851">tls.h:851</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_ad2c1f8bd3e6432fe17b9ac339fc35a0b"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#ad2c1f8bd3e6432fe17b9ac339fc35a0b">TlsHelloExtensions::supportedVersionList</a></div><div class="ttdeci">const TlsSupportedVersionList * supportedVersionList</div><div class="ttdoc">SupportedVersions extension (ClientHello) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01896">tls.h:1896</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_aca04db05a88059730c97a3dcc25705c0"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#aca04db05a88059730c97a3dcc25705c0">DtlsClientParameters::sessionIdLen</a></div><div class="ttdeci">size_t sessionIdLen</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00223">dtls_misc.h:223</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a04cc0ffcf992700820ec12d6f43212bf"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a04cc0ffcf992700820ec12d6f43212bf">TlsHelloExtensions::extendedMasterSecret</a></div><div class="ttdeci">const uint8_t * extendedMasterSecret</div><div class="ttdoc">ExtendedMasterSecret extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01919">tls.h:1919</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a1964c308b6b9b35f1c6fc81e59ba2a83"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a1964c308b6b9b35f1c6fc81e59ba2a83">tlsParseClientEmsExtension</a></div><div class="ttdeci">error_t tlsParseClientEmsExtension(TlsContext *context, const uint8_t *extendedMasterSecret)</div><div class="ttdoc">Parse ExtendedMasterSecret extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l01166">tls_server_extensions.c:1166</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_a6671f99ef473de11b1b7c1b76e8e2cb8"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a6671f99ef473de11b1b7c1b76e8e2cb8">DtlsClientParameters::sessionId</a></div><div class="ttdeci">const uint8_t * sessionId</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00222">dtls_misc.h:222</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_aeea7fd9313f97525e78c56a722b0dcfd"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#aeea7fd9313f97525e78c56a722b0dcfd">TlsHelloExtensions::ecPointFormatList</a></div><div class="ttdeci">const TlsEcPointFormatList * ecPointFormatList</div><div class="ttdoc">EcPointFormats extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01900">tls.h:1900</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a53acaa1dcce86449741ea9a780331d46"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a53acaa1dcce86449741ea9a780331d46">TlsHelloExtensions::serverNameList</a></div><div class="ttdeci">const TlsServerNameList * serverNameList</div><div class="ttdoc">ServerName extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01898">tls.h:1898</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_a8a2885ab0aadaad5b643aaccc0cc5949"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#a8a2885ab0aadaad5b643aaccc0cc5949">tlsParseClientCertTypeListExtension</a></div><div class="ttdeci">error_t tlsParseClientCertTypeListExtension(TlsContext *context, const TlsCertTypeList *clientCertTypeList)</div><div class="ttdoc">Parse ClientCertType extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l01023">tls_server_extensions.c:1023</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a9e359f668824d16983a41f8deb338979"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9e359f668824d16983a41f8deb338979">TLS_VERSION_1_1</a></div><div class="ttdeci">#define TLS_VERSION_1_1</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00093">tls.h:93</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_a126a9f1c8e75ec207f319533d142c88d"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#a126a9f1c8e75ec207f319533d142c88d">cookie</a></div><div class="ttdeci">uint8_t cookie[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00203">dtls_misc.h:203</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00228">error.h:228</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls13__misc_8h_html_a7b8cc84c920376c616d85d575080d28e"><div class="ttname"><a href="../../dc/d84/tls13__misc_8h.html#a7b8cc84c920376c616d85d575080d28e">extensions</a></div><div class="ttdeci">uint8_t extensions[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d84/tls13__misc_8h_source.html#l00327">tls13_misc.h:327</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da28df1d3e7276c71ab9e2f8c75cdeef2e"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da28df1d3e7276c71ab9e2f8c75cdeef2e">TLS_STATE_HELLO_VERIFY_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01293">tls.h:1293</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a">TLS_STATE_SERVER_HELLO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01295">tls.h:1295</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a063ff78ef819d405642544154c856ec4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a063ff78ef819d405642544154c856ec4">TlsCipherSuites</a></div><div class="ttdeci">__start_packed struct @62 TlsCipherSuites</div><div class="ttdoc">Cipher suites. </div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d">TLS_STATE_CLIENT_HELLO_2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01291">tls.h:1291</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b">ERROR_INVALID_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00116">error.h:116</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_a233abf95be55fe711b945119c08ffd07"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#a233abf95be55fe711b945119c08ffd07">DtlsClientParameters::compressMethods</a></div><div class="ttdeci">const uint8_t * compressMethods</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00226">dtls_misc.h:226</a></div></div>
<div class="ttc" id="structDtlsClientParameters_html_af465b2ea577f66ff4ebf3b83e5c0b854"><div class="ttname"><a href="../../df/d13/structDtlsClientParameters.html#af465b2ea577f66ff4ebf3b83e5c0b854">DtlsClientParameters::random</a></div><div class="ttdeci">const uint8_t * random</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00220">dtls_misc.h:220</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a640637c05b8aec2ef15420d5005830cb"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a640637c05b8aec2ef15420d5005830cb">TlsHelloExtensions::certSignAlgoList</a></div><div class="ttdeci">const TlsSignHashAlgos * certSignAlgoList</div><div class="ttdoc">SignatureAlgorithmsCert extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01902">tls.h:1902</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_a5a648f5ec00c526b0dfa2df7a272c6c0"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a></div><div class="ttdeci">uint8_t n</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00413">dhcpv6_common.h:413</a></div></div>
<div class="ttc" id="tls_8h_html_ac78d39e638430eb19c4017e5f9797d16"><div class="ttname"><a href="../../df/d79/tls_8h.html#ac78d39e638430eb19c4017e5f9797d16">TlsClientHello</a></div><div class="ttdeci">__start_packed struct @85 TlsClientHello</div><div class="ttdoc">ClientHello message. </div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00235">error.h:235</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_ad99a99db09cdc1ac0f3cb60f15711035"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#ad99a99db09cdc1ac0f3cb60f15711035">tlsNegotiateVersion</a></div><div class="ttdeci">error_t tlsNegotiateVersion(TlsContext *context, uint16_t clientVersion, const TlsSupportedVersionList *supportedVersionList)</div><div class="ttdoc">Version negotiation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l01068">tls_server_misc.c:1068</a></div></div>
<div class="ttc" id="structTlsHelloExtensions_html_a0752d52c09a933f5b001385db60159b1"><div class="ttname"><a href="../../d4/d61/structTlsHelloExtensions.html#a0752d52c09a933f5b001385db60159b1">TlsHelloExtensions::protocolNameList</a></div><div class="ttdeci">const TlsProtocolNameList * protocolNameList</div><div class="ttdoc">ALPN extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01910">tls.h:1910</a></div></div>
<div class="ttc" id="tls__server__extensions_8c_html_ab34de7891d354995208e858a53a14b57"><div class="ttname"><a href="../../d9/da7/tls__server__extensions_8c.html#ab34de7891d354995208e858a53a14b57">tlsParseClientSniExtension</a></div><div class="ttdeci">error_t tlsParseClientSniExtension(TlsContext *context, const TlsServerNameList *serverNameList)</div><div class="ttdoc">Parse SNI extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da7/tls__server__extensions_8c_source.html#l00628">tls_server_extensions.c:628</a></div></div>
<div class="ttc" id="tls__extensions_8c_html_a67e977c5311fc3d9b3503ca226f2ea7a"><div class="ttname"><a href="../../d1/d72/tls__extensions_8c.html#a67e977c5311fc3d9b3503ca226f2ea7a">tlsCheckHelloExtensions</a></div><div class="ttdeci">error_t tlsCheckHelloExtensions(TlsMessageType msgType, uint16_t version, TlsHelloExtensions *extensions)</div><div class="ttdoc">Check Hello extensions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d72/tls__extensions_8c_source.html#l00663">tls_extensions.c:663</a></div></div>
<div class="ttc" id="dtls__misc_8c_html_af5608ff09d69338af8269eaf548c70d3"><div class="ttname"><a href="../../dd/da4/dtls__misc_8c.html#af5608ff09d69338af8269eaf548c70d3">dtlsVerifyCookie</a></div><div class="ttdeci">error_t dtlsVerifyCookie(TlsContext *context, const DtlsCookie *cookie, const DtlsClientParameters *clientParams)</div><div class="ttdoc">Cookie verification. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/da4/dtls__misc_8c_source.html#l00174">dtls_misc.c:174</a></div></div>
<div class="ttc" id="debug_8h_html_a67a8f9bc74358aa21745a76e23768dae"><div class="ttname"><a href="../../db/d16/debug_8h.html#a67a8f9bc74358aa21745a76e23768dae">TRACE_DEBUG</a></div><div class="ttdeci">#define TRACE_DEBUG(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00106">debug.h:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a204fb38ba0d5de7703844660c79e0b40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a204fb38ba0d5de7703844660c79e0b40">&#9670;&nbsp;</a></span>tlsParseClientKeyExchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsParseClientKeyExchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d79/tls_8h.html#a88521372020709c027828954c0208b8f">TlsClientKeyExchange</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse ClientKeyExchange message. </p>
<p>This message is always sent by the client. It must immediately follow the client Certificate message, if it is sent. Otherwise, it must be the first message sent by the client after it receives the ServerHelloDone message</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Incoming ClientKeyExchange message to parse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>Message length </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l01617">1617</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;{</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   <span class="keyword">const</span> <a class="code" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *<a class="code" href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a>;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   <span class="comment">//Debug message</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;ClientKeyExchange message received (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   <span class="comment">//Check TLS version</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">if</span>(context-&gt;version &gt; <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;   <span class="comment">//Check current state</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;   <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251">TLS_STATE_CLIENT_CERTIFICATE</a>)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;   {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="comment">//A an non-anonymous server can optionally request a certificate from the client</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e">TLS_KEY_EXCH_RSA</a> ||</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a> ||</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a> ||</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a> ||</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a> ||</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a>)</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      {</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;         <span class="comment">//If client authentication is required by the server for the handshake</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;         <span class="comment">//to continue, it may respond with a fatal handshake failure alert</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;         <span class="keywordflow">if</span>(context-&gt;clientAuthMode == <a class="code" href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a5cbcc6f0c66081f9c833381df854d994">TLS_CLIENT_AUTH_REQUIRED</a>)</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a>;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      }</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;   }</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;state != <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c">TLS_STATE_CLIENT_KEY_EXCHANGE</a>)</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;   {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <span class="comment">//Send a fatal alert to the client</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;   <span class="comment">//Point to the beginning of the handshake message</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;   p = <a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="preprocessor">#if (TLS_PSK_KE_SUPPORT == ENABLED || TLS_RSA_PSK_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="preprocessor">   TLS_DHE_PSK_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;   <span class="comment">//PSK key exchange method?</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a> ||</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a> ||</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a> ||</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a>)</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;   {</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="comment">//The PSK identity is sent in cleartext</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#a83d2e7ba7af8d605e367229331aabbbb">tlsParsePskIdentity</a>(context, p, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>, &amp;n);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> -= <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;   }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;   <span class="comment">//RSA, Diffie-Hellman or ECDH key exchange method?</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod != <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a>)</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;   {</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <span class="comment">//Parse client&#39;s key exchange parameters</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      error = <a class="code" href="../../d1/daa/tls__server__misc_8c.html#aeb2235551aa3828c696652a82ca808b6">tlsParseClientKeyParams</a>(context, p, <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>, &amp;n);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="comment">//Point to the next field</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      p += <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="comment">//Remaining bytes to process</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> -= <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;   }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;   <span class="comment">//If the amount of data in the message does not precisely match the format</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;   <span class="comment">//of the ClientKeyExchange message, then send a fatal alert</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a> != 0)</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="preprocessor">#if (TLS_PSK_KE_SUPPORT == ENABLED || TLS_RSA_PSK_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="preprocessor">   TLS_DHE_PSK_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;   <span class="comment">//PSK key exchange method?</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a> ||</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a> ||</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a> ||</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a>)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;   {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="comment">//Invalid pre-shared key?</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <span class="keywordflow">if</span>(context-&gt;pskLen == 0)</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca3764b2929469f1eb1bf7af50b40df62f">ERROR_INVALID_KEY_LENGTH</a>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="comment">//Generate premaster secret</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      error = <a class="code" href="../../d5/daf/tls__key__material_8c.html#ac5650a18e65eed6e74b8d5ebec573a0d">tlsGeneratePskPremasterSecret</a>(context);</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="comment">//Any error to report?</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;         <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;   }</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;   <span class="comment">//Derive session keys from the premaster secret</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;   error = <a class="code" href="../../d5/daf/tls__key__material_8c.html#a48b57409ac1d3429ddc2e236ba8beeb3">tlsGenerateSessionKeys</a>(context);</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;   <span class="comment">//Unable to generate key material?</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;   <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      <span class="keywordflow">return</span> error;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;   <span class="comment">//Update FSM state</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;   <span class="keywordflow">if</span>(context-&gt;peerCertType != <a class="code" href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffdae8286884ac120d31a1c3bbf125d116ec">TLS_CERT_NONE</a>)</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b">TLS_STATE_CLIENT_CERTIFICATE_VERIFY</a>;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b">TLS_STATE_CLIENT_CHANGE_CIPHER_SPEC</a>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;   <span class="comment">//Successful processing</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;}</div><div class="ttc" id="tls__key__material_8c_html_a48b57409ac1d3429ddc2e236ba8beeb3"><div class="ttname"><a href="../../d5/daf/tls__key__material_8c.html#a48b57409ac1d3429ddc2e236ba8beeb3">tlsGenerateSessionKeys</a></div><div class="ttdeci">error_t tlsGenerateSessionKeys(TlsContext *context)</div><div class="ttdoc">Generate session keys. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/daf/tls__key__material_8c_source.html#l00053">tls_key_material.c:53</a></div></div>
<div class="ttc" id="ndp_8h_html_a6519522ad9a6f45e7a8d25d31392a977"><div class="ttname"><a href="../../d3/d8d/ndp_8h.html#a6519522ad9a6f45e7a8d25d31392a977">p</a></div><div class="ttdeci">uint8_t p</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/ndp_8h_source.html#l00298">ndp.h:298</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da0f0ff1805dfdec56bba42cbd8f42097b">TLS_STATE_CLIENT_CERTIFICATE_VERIFY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01307">tls.h:1307</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01036">tls.h:1036</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01034">tls.h:1034</a></div></div>
<div class="ttc" id="stdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00078">stdint.h:78</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17">ERROR_UNEXPECTED_MESSAGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00192">error.h:192</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c">TLS_STATE_CLIENT_KEY_EXCHANGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01306">tls.h:1306</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e">TLS_KEY_EXCH_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01027">tls.h:1027</a></div></div>
<div class="ttc" id="tls__key__material_8c_html_ac5650a18e65eed6e74b8d5ebec573a0d"><div class="ttname"><a href="../../d5/daf/tls__key__material_8c.html#ac5650a18e65eed6e74b8d5ebec573a0d">tlsGeneratePskPremasterSecret</a></div><div class="ttdeci">error_t tlsGeneratePskPremasterSecret(TlsContext *context)</div><div class="ttdoc">Premaster secret generation (for PSK cipher suites) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/daf/tls__key__material_8c_source.html#l00303">tls_key_material.c:303</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf4ad5e0b1c92eb5991962aa9f3a6932b">TLS_STATE_CLIENT_CHANGE_CIPHER_SPEC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01308">tls.h:1308</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01031">tls.h:1031</a></div></div>
<div class="ttc" id="tls_8h_html_a9bd45859e2bffbd3edb8beff07240ffdae8286884ac120d31a1c3bbf125d116ec"><div class="ttname"><a href="../../df/d79/tls_8h.html#a9bd45859e2bffbd3edb8beff07240ffdae8286884ac120d31a1c3bbf125d116ec">TLS_CERT_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01071">tls.h:1071</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc">ERROR_HANDSHAKE_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00228">error.h:228</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca3764b2929469f1eb1bf7af50b40df62f"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca3764b2929469f1eb1bf7af50b40df62f">ERROR_INVALID_KEY_LENGTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00105">error.h:105</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_aeb2235551aa3828c696652a82ca808b6"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#aeb2235551aa3828c696652a82ca808b6">tlsParseClientKeyParams</a></div><div class="ttdeci">error_t tlsParseClientKeyParams(TlsContext *context, const uint8_t *p, size_t length, size_t *consumed)</div><div class="ttdoc">Parse client&amp;#39;s key exchange parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l01693">tls_server_misc.c:1693</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251">TLS_STATE_CLIENT_CERTIFICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01305">tls.h:1305</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01029">tls.h:1029</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01040">tls.h:1040</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01039">tls.h:1039</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01038">tls.h:1038</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_a5a648f5ec00c526b0dfa2df7a272c6c0"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#a5a648f5ec00c526b0dfa2df7a272c6c0">n</a></div><div class="ttdeci">uint8_t n</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00413">dhcpv6_common.h:413</a></div></div>
<div class="ttc" id="tls_8h_html_a657708ec632fe90da5a94cf667118527a5cbcc6f0c66081f9c833381df854d994"><div class="ttname"><a href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a5cbcc6f0c66081f9c833381df854d994">TLS_CLIENT_AUTH_REQUIRED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00874">tls.h:874</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768">ERROR_DECODING_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00235">error.h:235</a></div></div>
<div class="ttc" id="tls__server__misc_8c_html_a83d2e7ba7af8d605e367229331aabbbb"><div class="ttname"><a href="../../d1/daa/tls__server__misc_8c.html#a83d2e7ba7af8d605e367229331aabbbb">tlsParsePskIdentity</a></div><div class="ttdeci">error_t tlsParsePskIdentity(TlsContext *context, const uint8_t *p, size_t length, size_t *consumed)</div><div class="ttdoc">Parse PSK identity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/tls__server__misc_8c_source.html#l01642">tls_server_misc.c:1642</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01041">tls.h:1041</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5f8b0853322153b88ff07e7bea633835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f8b0853322153b88ff07e7bea633835">&#9670;&nbsp;</a></span>tlsSendCertificateRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsSendCertificateRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send CertificateRequest message. </p>
<p>A server can optionally request a certificate from the client, if appropriate for the selected cipher suite. This message will immediately follow the ServerKeyExchange message</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00262">262</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   <a class="code" href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a> *<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="comment">//Initialize status code</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor">#if (TLS_RSA_SIGN_SUPPORT == ENABLED || TLS_RSA_PSS_SIGN_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">   TLS_DSA_SIGN_SUPPORT == ENABLED || TLS_ECDSA_SIGN_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="comment">//A server can optionally request a certificate from the client</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">if</span>(context-&gt;clientAuthMode != <a class="code" href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d">TLS_CLIENT_AUTH_NONE</a>)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">//Non-anonymous key exchange?</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e">TLS_KEY_EXCH_RSA</a> ||</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a> ||</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a> ||</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a> ||</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a> ||</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a> ||</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a73afc728c1b23fef9f03ce4a08d0e20b">TLS13_KEY_EXCH_DHE</a> ||</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a3cde206533769f2a174205875bd0b8da">TLS13_KEY_EXCH_ECDHE</a>)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         <span class="comment">//Point to the buffer where to format the message</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;         message = (<a class="code" href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a> *) (context-&gt;txBuffer + context-&gt;txBufferLen);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;         <span class="comment">//Format CertificateRequest message</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;         error = <a class="code" href="../../d8/dde/tls__server_8c.html#a422aa0a39a41b30d586a06b9d42dbbdf">tlsFormatCertificateRequest</a>(context, message, &amp;length);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         <span class="comment">//Check status code</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;         {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="comment">//Debug message</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;Sending CertificateRequest message (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, length);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, message, length);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="comment">//Send handshake message</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            error = <a class="code" href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a>(context, message, length,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;               <a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9badf4f63379ab93eec891cdbae8f8a2717">TLS_TYPE_CERTIFICATE_REQUEST</a>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;         }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordflow">if</span>(error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a>)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <span class="comment">//Send a ServerHelloDone message to the client</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dacfeeaa75eec1aecc4c975236b2af1f9c">TLS_STATE_SERVER_HELLO_DONE</a>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;         <span class="comment">//Send a Certificate message to the client</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074">TLS_STATE_SERVER_CERTIFICATE</a>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00095">error.h:95</a></div></div>
<div class="ttc" id="tls_8h_html_a207a823320ed0904352de25ac220b5d8"><div class="ttname"><a href="../../df/d79/tls_8h.html#a207a823320ed0904352de25ac220b5d8">TlsCertificateRequest</a></div><div class="ttdeci">__start_packed struct @87 TlsCertificateRequest</div><div class="ttdoc">CertificateRequest message. </div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4dacfeeaa75eec1aecc4c975236b2af1f9c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dacfeeaa75eec1aecc4c975236b2af1f9c">TLS_STATE_SERVER_HELLO_DONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01304">tls.h:1304</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01036">tls.h:1036</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01034">tls.h:1034</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00094">error.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e">TLS_KEY_EXCH_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01027">tls.h:1027</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a73afc728c1b23fef9f03ce4a08d0e20b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a73afc728c1b23fef9f03ce4a08d0e20b">TLS13_KEY_EXCH_DHE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01045">tls.h:1045</a></div></div>
<div class="ttc" id="tls_8h_html_a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d"><div class="ttname"><a href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d">TLS_CLIENT_AUTH_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00872">tls.h:872</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01031">tls.h:1031</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074">TLS_STATE_SERVER_CERTIFICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01300">tls.h:1300</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls__server_8c_html_a422aa0a39a41b30d586a06b9d42dbbdf"><div class="ttname"><a href="../../d8/dde/tls__server_8c.html#a422aa0a39a41b30d586a06b9d42dbbdf">tlsFormatCertificateRequest</a></div><div class="ttdeci">error_t tlsFormatCertificateRequest(TlsContext *context, TlsCertificateRequest *message, size_t *length)</div><div class="ttdoc">Format CertificateRequest message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dde/tls__server_8c_source.html#l00802">tls_server.c:802</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01029">tls.h:1029</a></div></div>
<div class="ttc" id="tls__handshake_8c_html_ad729f5d4a23f051eebf844a6fe4964cd"><div class="ttname"><a href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a></div><div class="ttdeci">error_t tlsSendHandshakeMessage(TlsContext *context, const void *data, size_t length, TlsMessageType type)</div><div class="ttdoc">Send handshake message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/tls__handshake_8c_source.html#l00156">tls_handshake.c:156</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01039">tls.h:1039</a></div></div>
<div class="ttc" id="tls_8h_html_aea257240929f03e1e6ea3c7ab65ddb9badf4f63379ab93eec891cdbae8f8a2717"><div class="ttname"><a href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9badf4f63379ab93eec891cdbae8f8a2717">TLS_TYPE_CERTIFICATE_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00942">tls.h:942</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a3cde206533769f2a174205875bd0b8da"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a3cde206533769f2a174205875bd0b8da">TLS13_KEY_EXCH_ECDHE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01046">tls.h:1046</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a67975b6b6f060d494e01cc75e171fecf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67975b6b6f060d494e01cc75e171fecf">&#9670;&nbsp;</a></span>tlsSendServerHello()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsSendServerHello </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send ServerHello message. </p>
<p>The server will send this message in response to a ClientHello message when it was able to find an acceptable set of algorithms. If it cannot find such a match, it will respond with a handshake failure alert</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00083">83</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   <a class="code" href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a> *<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="comment">//Point to the buffer where to format the message</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   message = (<a class="code" href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a> *) (context-&gt;txBuffer + context-&gt;txBufferLen);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="comment">//Generate the server random value using a cryptographically-safe</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   <span class="comment">//pseudorandom number generator</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   error = <a class="code" href="../../d6/db2/tls__misc_8c.html#a316db53174c47a590bc25a2aadae6af6">tlsGenerateRandomValue</a>(context, context-&gt;serverRandom);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">//Format ServerHello message</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      error = <a class="code" href="../../d8/dde/tls__server_8c.html#a4d8dee25b92b399334e45683b466f403">tlsFormatServerHello</a>(context, message, &amp;length);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">//Debug message</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;Sending ServerHello message (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, length);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, message, length);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">//Send handshake message</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      error = <a class="code" href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a>(context, message, length,</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;         <a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac">TLS_TYPE_SERVER_HELLO</a>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keywordflow">if</span>(error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a>)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="comment">//Version of TLS prior to TLS 1.3?</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordflow">if</span>(context-&gt;version &lt;= <a class="code" href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a>)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#if (TLS_SESSION_RESUME_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;         <span class="comment">//Use abbreviated handshake?</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;         <span class="keywordflow">if</span>(context-&gt;resume)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;         {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="comment">//Derive session keys from the master secret</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            error = <a class="code" href="../../d5/daf/tls__key__material_8c.html#a48b57409ac1d3429ddc2e236ba8beeb3">tlsGenerateSessionKeys</a>(context);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="comment">//Key material successfully generated?</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;               <span class="comment">//At this point, both client and server must send ChangeCipherSpec</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;               <span class="comment">//messages and proceed directly to Finished messages</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;               context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0">TLS_STATE_SERVER_CHANGE_CIPHER_SPEC</a>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;         {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="comment">//Perform a full handshake</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074">TLS_STATE_SERVER_CERTIFICATE</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;         }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#if (TLS13_MIDDLEBOX_COMPAT_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;         <span class="comment">//First handshake message sent by the server?</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;         <span class="keywordflow">if</span>(context-&gt;state == <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a">TLS_STATE_SERVER_HELLO</a>)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;         {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="comment">//In middlebox compatibility mode, the server must send a dummy</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment">//ChangeCipherSpec record immediately after its first handshake</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="comment">//message</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0">TLS_STATE_SERVER_CHANGE_CIPHER_SPEC</a>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;         }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="comment">//All handshake messages after the ServerHello are now encrypted</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daeb443224abb7649fc9e8adf3e51864a2">TLS_STATE_HANDSHAKE_TRAFFIC_KEYS</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00095">error.h:95</a></div></div>
<div class="ttc" id="tls__key__material_8c_html_a48b57409ac1d3429ddc2e236ba8beeb3"><div class="ttname"><a href="../../d5/daf/tls__key__material_8c.html#a48b57409ac1d3429ddc2e236ba8beeb3">tlsGenerateSessionKeys</a></div><div class="ttdeci">error_t tlsGenerateSessionKeys(TlsContext *context)</div><div class="ttdoc">Generate session keys. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/daf/tls__key__material_8c_source.html#l00053">tls_key_material.c:53</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00094">error.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a3b37d03b4f71ce65b23f369d2040a245"><div class="ttname"><a href="../../df/d79/tls_8h.html#a3b37d03b4f71ce65b23f369d2040a245">TlsServerHello</a></div><div class="ttdeci">__start_packed struct @86 TlsServerHello</div><div class="ttdoc">ServerHello message. </div></div>
<div class="ttc" id="tls_8h_html_aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac"><div class="ttname"><a href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba0ec92de95e5ea4899b69affe1bc7aeac">TLS_TYPE_SERVER_HELLO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00934">tls.h:934</a></div></div>
<div class="ttc" id="tls__misc_8c_html_a316db53174c47a590bc25a2aadae6af6"><div class="ttname"><a href="../../d6/db2/tls__misc_8c.html#a316db53174c47a590bc25a2aadae6af6">tlsGenerateRandomValue</a></div><div class="ttdeci">error_t tlsGenerateRandomValue(TlsContext *context, uint8_t *random)</div><div class="ttdoc">Generate client or server random value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db2/tls__misc_8c_source.html#l00165">tls_misc.c:165</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da0023cfdc8ed0f0062637380bee3683a0">TLS_STATE_SERVER_CHANGE_CIPHER_SPEC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01312">tls.h:1312</a></div></div>
<div class="ttc" id="tls__server_8c_html_a4d8dee25b92b399334e45683b466f403"><div class="ttname"><a href="../../d8/dde/tls__server_8c.html#a4d8dee25b92b399334e45683b466f403">tlsFormatServerHello</a></div><div class="ttdeci">error_t tlsFormatServerHello(TlsContext *context, TlsServerHello *message, size_t *length)</div><div class="ttdoc">Format ServerHello message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dde/tls__server_8c_source.html#l00386">tls_server.c:386</a></div></div>
<div class="ttc" id="tls_8h_html_af97e91c5fb95fb0957e5f37ec9e9eae8"><div class="ttname"><a href="../../df/d79/tls_8h.html#af97e91c5fb95fb0957e5f37ec9e9eae8">TLS_VERSION_1_2</a></div><div class="ttdeci">#define TLS_VERSION_1_2</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da09790eaca7bac9c6bfd5b3e0775b6074">TLS_STATE_SERVER_CERTIFICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01300">tls.h:1300</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4da69787ce8e1f218e8e47defe7af1c601a">TLS_STATE_SERVER_HELLO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01295">tls.h:1295</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls__handshake_8c_html_ad729f5d4a23f051eebf844a6fe4964cd"><div class="ttname"><a href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a></div><div class="ttdeci">error_t tlsSendHandshakeMessage(TlsContext *context, const void *data, size_t length, TlsMessageType type)</div><div class="ttdoc">Send handshake message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/tls__handshake_8c_source.html#l00156">tls_handshake.c:156</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daeb443224abb7649fc9e8adf3e51864a2"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daeb443224abb7649fc9e8adf3e51864a2">TLS_STATE_HANDSHAKE_TRAFFIC_KEYS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01298">tls.h:1298</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1bc3bb08a169817c6105f9f5f13f58ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bc3bb08a169817c6105f9f5f13f58ac">&#9670;&nbsp;</a></span>tlsSendServerHelloDone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsSendServerHelloDone </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send ServerHelloDone message. </p>
<p>The ServerHelloDone message is sent by the server to indicate the end of the ServerHello and associated messages. After sending this message, the server will wait for a client response</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00339">339</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   <a class="code" href="../../df/d79/tls_8h.html#a71e29f87ab91f2adb5655ad8157e7aea">TlsServerHelloDone</a> *<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <span class="comment">//Point to the buffer where to format the message</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   message = (<a class="code" href="../../df/d79/tls_8h.html#a71e29f87ab91f2adb5655ad8157e7aea">TlsServerHelloDone</a> *) (context-&gt;txBuffer + context-&gt;txBufferLen);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <span class="comment">//Format ServerHelloDone message</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   error = <a class="code" href="../../d8/dde/tls__server_8c.html#ac2375898dec7aa0ceaff2faefd467f76">tlsFormatServerHelloDone</a>(context, message, &amp;length);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="comment">//Debug message</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;Sending ServerHelloDone message (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, length);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, message, length);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">//Send handshake message</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      error = <a class="code" href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a>(context, message, length,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;         <a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba979c5881efc687024fa12190b925ac1f">TLS_TYPE_SERVER_HELLO_DONE</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordflow">if</span>(error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a>)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="comment">//The client must send a Certificate message if the server requests it</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">if</span>(context-&gt;clientAuthMode != <a class="code" href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d">TLS_CLIENT_AUTH_NONE</a>)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251">TLS_STATE_CLIENT_CERTIFICATE</a>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c">TLS_STATE_CLIENT_KEY_EXCHANGE</a>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div><div class="ttc" id="tls_8h_html_a71e29f87ab91f2adb5655ad8157e7aea"><div class="ttname"><a href="../../df/d79/tls_8h.html#a71e29f87ab91f2adb5655ad8157e7aea">TlsServerHelloDone</a></div><div class="ttdeci">void TlsServerHelloDone</div><div class="ttdoc">ServerHelloDone message. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01662">tls.h:1662</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00095">error.h:95</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00094">error.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daec55a02fa5725d9b44460666d30b3a5c">TLS_STATE_CLIENT_KEY_EXCHANGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01306">tls.h:1306</a></div></div>
<div class="ttc" id="tls_8h_html_a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d"><div class="ttname"><a href="../../df/d79/tls_8h.html#a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d">TLS_CLIENT_AUTH_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00872">tls.h:872</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4daf228b75114f59a280fff6ec472c5a251">TLS_STATE_CLIENT_CERTIFICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01305">tls.h:1305</a></div></div>
<div class="ttc" id="tls__handshake_8c_html_ad729f5d4a23f051eebf844a6fe4964cd"><div class="ttname"><a href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a></div><div class="ttdeci">error_t tlsSendHandshakeMessage(TlsContext *context, const void *data, size_t length, TlsMessageType type)</div><div class="ttdoc">Send handshake message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/tls__handshake_8c_source.html#l00156">tls_handshake.c:156</a></div></div>
<div class="ttc" id="tls_8h_html_aea257240929f03e1e6ea3c7ab65ddb9ba979c5881efc687024fa12190b925ac1f"><div class="ttname"><a href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9ba979c5881efc687024fa12190b925ac1f">TLS_TYPE_SERVER_HELLO_DONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00943">tls.h:943</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="tls__server_8c_html_ac2375898dec7aa0ceaff2faefd467f76"><div class="ttname"><a href="../../d8/dde/tls__server_8c.html#ac2375898dec7aa0ceaff2faefd467f76">tlsFormatServerHelloDone</a></div><div class="ttdeci">error_t tlsFormatServerHelloDone(TlsContext *context, TlsServerHelloDone *message, size_t *length)</div><div class="ttdoc">Format ServerHelloDone message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dde/tls__server_8c_source.html#l01151">tls_server.c:1151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5b4084306cc9d8e1d083e272cd98aef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b4084306cc9d8e1d083e272cd98aef1">&#9670;&nbsp;</a></span>tlsSendServerKeyExchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> tlsSendServerKeyExchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d79/tls_8h.html#ac09f7a286c0cdf9b07ee1edd107946f5">TlsContext</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send ServerKeyExchange message. </p>
<p>The ServerKeyExchange message is sent by the server only when the server Certificate message does not contain enough data to allow the client to exchange a premaster secret</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>Pointer to the TLS context </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d8/dde/tls__server_8c_source.html#l00179">179</a> of file <a class="el" href="../../d8/dde/tls__server_8c_source.html">tls_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;{</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <a class="code" href="../../df/d79/tls_8h.html#a69c0b3ab7349e73b2e8f9452dbdfef5a">TlsServerKeyExchange</a> *<a class="code" href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="comment">//Initialize status code</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   error = <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="comment">//Point to the buffer where to format the message</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   message = (<a class="code" href="../../df/d79/tls_8h.html#a69c0b3ab7349e73b2e8f9452dbdfef5a">TlsServerKeyExchange</a> *) (context-&gt;txBuffer + context-&gt;txBufferLen);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="comment">//Initialize length</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   length = 0;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="comment">//The ServerKeyExchange message is sent by the server only when the server</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="comment">//Certificate message (if sent) does not contain enough data to allow the</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="comment">//client to exchange a premaster secret</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa">TLS_KEY_EXCH_DH_ANON</a> ||</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a> ||</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a> ||</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a> ||</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953">TLS_KEY_EXCH_ECDH_ANON</a> ||</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a> ||</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a> ||</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a>)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="comment">//Format ServerKeyExchange message</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      error = <a class="code" href="../../d8/dde/tls__server_8c.html#ae9133776b8d42f0da84f6b8446448069">tlsFormatServerKeyExchange</a>(context, message, &amp;length);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a> ||</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      context-&gt;keyExchMethod == <a class="code" href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a>)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">#if (TLS_PSK_KE_SUPPORT == ENABLED || TLS_RSA_PSK_KE_SUPPORT == ENABLED || \</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">   TLS_DHE_PSK_KE_SUPPORT == ENABLED || TLS_ECDHE_PSK_KE_SUPPORT == ENABLED)</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="comment">//If no PSK identity hint is provided by the server, the</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">//ServerKeyExchange message is omitted...</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span>(context-&gt;pskIdentityHint != <a class="code" href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;         <span class="comment">//Format ServerKeyExchange message</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         error = <a class="code" href="../../d8/dde/tls__server_8c.html#ae9133776b8d42f0da84f6b8446448069">tlsFormatServerKeyExchange</a>(context, message, &amp;length);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="comment">//Any message to send?</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">if</span>(length &gt; 0)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         <span class="comment">//Debug message</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;         <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;Sending ServerKeyExchange message (%&quot;</span> <a class="code" href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a> <span class="stringliteral">&quot; bytes)...\r\n&quot;</span>, length);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;         <a class="code" href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a>(<span class="stringliteral">&quot;  &quot;</span>, message, length);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;         <span class="comment">//Send handshake message</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;         error = <a class="code" href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a>(context, message, length,</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <a class="code" href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9baa4910b2d8fcdfb42e1e3199e634ce290">TLS_TYPE_SERVER_KEY_EXCHANGE</a>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   <span class="comment">//Check status code</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordflow">if</span>(error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a> || error == <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a>)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="comment">//A server can optionally request a certificate from the client</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      context-&gt;state = <a class="code" href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783">TLS_STATE_CERTIFICATE_REQUEST</a>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6">ERROR_WOULD_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00095">error.h:95</a></div></div>
<div class="ttc" id="chap_8h_html_a52f19d36a71e9b8ddea38fe00c291181"><div class="ttname"><a href="../../d5/dbb/chap_8h.html#a52f19d36a71e9b8ddea38fe00c291181">message</a></div><div class="ttdeci">uint8_t message[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbb/chap_8h_source.html#l00152">chap.h:152</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7">TLS_KEY_EXCH_ECDHE_ECDSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01036">tls.h:1036</a></div></div>
<div class="ttc" id="debug_8h_html_a1f71019169d85407d8827300ed43bdf0"><div class="ttname"><a href="../../db/d16/debug_8h.html#a1f71019169d85407d8827300ed43bdf0">TRACE_DEBUG_ARRAY</a></div><div class="ttdeci">#define TRACE_DEBUG_ARRAY(p, a, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00107">debug.h:107</a></div></div>
<div class="ttc" id="group__BSPDefine_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../de/da2/group__BSPDefine.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6b/nm__bsp_8h_source.html#l00070">nm_bsp.h:70</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b">TLS_KEY_EXCH_ECDHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01034">tls.h:1034</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2">ERROR_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00094">error.h:94</a></div></div>
<div class="ttc" id="tls__server_8c_html_ae9133776b8d42f0da84f6b8446448069"><div class="ttname"><a href="../../d8/dde/tls__server_8c.html#ae9133776b8d42f0da84f6b8446448069">tlsFormatServerKeyExchange</a></div><div class="ttdeci">error_t tlsFormatServerKeyExchange(TlsContext *context, TlsServerKeyExchange *message, size_t *length)</div><div class="ttdoc">Format ServerKeyExchange message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dde/tls__server_8c_source.html#l00680">tls_server.c:680</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a895e0af86b29640264f699235be22953">TLS_KEY_EXCH_ECDH_ANON</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01037">tls.h:1037</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a33535bd987c46f1ba621d6e28b0b3bfa">TLS_KEY_EXCH_DH_ANON</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01032">tls.h:1032</a></div></div>
<div class="ttc" id="tls_8h_html_a69c0b3ab7349e73b2e8f9452dbdfef5a"><div class="ttname"><a href="../../df/d79/tls_8h.html#a69c0b3ab7349e73b2e8f9452dbdfef5a">TlsServerKeyExchange</a></div><div class="ttdeci">void TlsServerKeyExchange</div><div class="ttdoc">ServerKeyExchange message. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01644">tls.h:1644</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39">TLS_KEY_EXCH_DHE_DSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01031">tls.h:1031</a></div></div>
<div class="ttc" id="tls_8h_html_aea257240929f03e1e6ea3c7ab65ddb9baa4910b2d8fcdfb42e1e3199e634ce290"><div class="ttname"><a href="../../df/d79/tls_8h.html#aea257240929f03e1e6ea3c7ab65ddb9baa4910b2d8fcdfb42e1e3199e634ce290">TLS_TYPE_SERVER_KEY_EXCHANGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00941">tls.h:941</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94">NO_ERROR</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00044">error.h:44</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a2b7b0557dc6cd786df02dafbb51f5292"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a2b7b0557dc6cd786df02dafbb51f5292">PRIuSIZE</a></div><div class="ttdeci">#define PRIuSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00078">compiler_port.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4">TLS_KEY_EXCH_DHE_RSA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01029">tls.h:1029</a></div></div>
<div class="ttc" id="tls__handshake_8c_html_ad729f5d4a23f051eebf844a6fe4964cd"><div class="ttname"><a href="../../d5/dff/tls__handshake_8c.html#ad729f5d4a23f051eebf844a6fe4964cd">tlsSendHandshakeMessage</a></div><div class="ttdeci">error_t tlsSendHandshakeMessage(TlsContext *context, const void *data, size_t length, TlsMessageType type)</div><div class="ttdoc">Send handshake message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/tls__handshake_8c_source.html#l00156">tls_handshake.c:156</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a32a252b7c7befeccaa088290d6a71dfe">TLS_KEY_EXCH_DHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01040">tls.h:1040</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c">TLS_KEY_EXCH_RSA_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01039">tls.h:1039</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aed949c3b521aa45b6685846fa9a3b8f0">TLS_KEY_EXCH_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01038">tls.h:1038</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_ab43ca82dd7fa2a0e56f941032ef324c4"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#ab43ca82dd7fa2a0e56f941032ef324c4">length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00149">dtls_misc.h:149</a></div></div>
<div class="ttc" id="tls_8h_html_a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783"><div class="ttname"><a href="../../df/d79/tls_8h.html#a02bb4c8aa7988b33fe4d4836d8ff4a4dae316fcecd0b42b329c94f5c3102d8783">TLS_STATE_CERTIFICATE_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01303">tls.h:1303</a></div></div>
<div class="ttc" id="tls_8h_html_a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520"><div class="ttname"><a href="../../df/d79/tls_8h.html#a10c9078f6485419c2b8644b573ef0b75aebba2060dba7ad92238668218f3a6520">TLS_KEY_EXCH_ECDHE_PSK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l01041">tls.h:1041</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_67fa3d68f7f9c168a7ec56bc54b9842b.html">cyclone_ssl</a></li><li class="navelem"><a class="el" href="../../da/d16/tls__server_8h.html">tls_server.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
