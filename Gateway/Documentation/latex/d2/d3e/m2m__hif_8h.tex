\hypertarget{m2m__hif_8h}{}\section{third\+\_\+party/atmel/devices/wilc1000/driver/source/m2m\+\_\+hif.h File Reference}
\label{m2m__hif_8h}\index{third\+\_\+party/atmel/devices/wilc1000/driver/source/m2m\+\_\+hif.\+h@{third\+\_\+party/atmel/devices/wilc1000/driver/source/m2m\+\_\+hif.\+h}}


This module contains W\+I\+LC M2M host interface A\+P\+Is implementation.  


{\ttfamily \#include \char`\"{}common/include/nm\+\_\+common.\+h\char`\"{}}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structtstrHifHdr}{tstr\+Hif\+Hdr}
\begin{DoxyCompactList}\small\item\em Structure to hold H\+IF header. \end{DoxyCompactList}\item 
struct \hyperlink{structtstrHifinitParam}{tstr\+Hifinit\+Param}
\begin{DoxyCompactList}\small\item\em Structure to hold H\+IF Init Param. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{m2m__hif_8h_a3d3fd9d841573202e949bd931c5faf70}{M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}~(1600 -\/ 4)
\item 
\#define \hyperlink{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}{M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET}~(sizeof(\hyperlink{structtstrHifHdr}{tstr\+Hif\+Hdr}) + 4)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef void($\ast$ \hyperlink{m2m__hif_8h_a78a3e5d59cea8566ca5c67c96f2215dc}{tpf\+Hif\+Call\+Back}) (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Op\+Code, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Data\+Size, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Buff)
\begin{DoxyCompactList}\small\item\em used to point to Wi-\/\+Fi call back function depend on Arduino project or other projects. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a98d80ebd8d05b076ab1dfe4d42d2a1bd}{hif\+\_\+init} (\hyperlink{structtstrHifinitParam}{tstr\+Hifinit\+Param} $\ast$pstr\+Init\+Param)
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a297b5d8edbc7f34eedb4992bf20b16ab}{hif\+\_\+deinit} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em To Deinitialize H\+IF layer. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a13ba8ad11b2ac39516ca787386d16ce0}{hif\+\_\+send} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Gid, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Opcode, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Ctrl\+Buf, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Ctrl\+Buf\+Size, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Data\+Buf, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Data\+Size, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Data\+Offset)
\begin{DoxyCompactList}\small\item\em Send packet using host interface. \end{DoxyCompactList}\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a8055cbaa8a24b713f6dcec6e9b721674}{hif\+\_\+send\+\_\+optimized} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Gid, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Opcode, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$buffer, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Data\+Size)
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a74395aadf04bddddf9c3cf9e55b9ec58}{hif\+\_\+receive} (\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} u32\+Addr, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Buf, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Sz, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} is\+Done)
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a30fc4f91ec4d7859a4bf165152f1af7f}{hif\+\_\+register\+\_\+cb} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Grp, \hyperlink{m2m__hif_8h_a78a3e5d59cea8566ca5c67c96f2215dc}{tpf\+Hif\+Call\+Back} fn)
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a41d3f660265e122cbd7417ea8754e8dd}{hif\+\_\+chip\+\_\+sleep} (void)
\begin{DoxyCompactList}\small\item\em To make the chip sleep. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a756a9c1154d55efd6c7924ef1ace5e75}{hif\+\_\+chip\+\_\+sleep\+\_\+sc} (void)
\begin{DoxyCompactList}\small\item\em To clear the chip sleep but keep the chip sleep. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_a88c8f023679d14d6866b80c9275db686}{hif\+\_\+chip\+\_\+wake} (void)
\begin{DoxyCompactList}\small\item\em To Wakeup the chip. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} void \hyperlink{m2m__hif_8h_aea14bdeaac412fb26e8a550bbd06ef91}{hif\+\_\+set\+\_\+sleep\+\_\+mode} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Pstype)
\begin{DoxyCompactList}\small\item\em Set the sleep mode of the H\+IF layer. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} \hyperlink{m2m__hif_8h_ad32fe2e6813b9ecfdd54d200e498468c}{hif\+\_\+get\+\_\+sleep\+\_\+mode} (void)
\begin{DoxyCompactList}\small\item\em Get the sleep mode of the H\+IF layer. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_af66b8acfc8e66aae102b56ac84bca50d}{hif\+\_\+handle\+\_\+isr} (void)
\begin{DoxyCompactList}\small\item\em Handle interrupt received from N\+M\+C1500 firmware. \end{DoxyCompactList}\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{m2m__hif_8h_ae2f12ba6f6738b12d291124c8abe2f84}{hif\+\_\+set\+\_\+receive\+\_\+buffer} (void $\ast$pv\+Buffer, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Buffer\+Len)
\begin{DoxyCompactList}\small\item\em Handle interrupt received from N\+M\+C1500 firmware. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
This module contains W\+I\+LC M2M host interface A\+P\+Is implementation. 

Copyright (c) 2016-\/2018 Microchip Technology Inc. and its subsidiaries.

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}\label{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET@{M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET}}
\index{M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET@{M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET}{M2M\_HIF\_HDR\_OFFSET}}
{\footnotesize\ttfamily \#define M2\+M\+\_\+\+H\+I\+F\+\_\+\+H\+D\+R\+\_\+\+O\+F\+F\+S\+ET~(sizeof(\hyperlink{structtstrHifHdr}{tstr\+Hif\+Hdr}) + 4)}



Definition at line 63 of file m2m\+\_\+hif.\+h.

\mbox{\Hypertarget{m2m__hif_8h_a3d3fd9d841573202e949bd931c5faf70}\label{m2m__hif_8h_a3d3fd9d841573202e949bd931c5faf70}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE@{M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}}
\index{M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE@{M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}{M2M\_HIF\_MAX\_PACKET\_SIZE}}
{\footnotesize\ttfamily \#define M2\+M\+\_\+\+H\+I\+F\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE~(1600 -\/ 4)}

$<$ Include depends on U\+NO Board is used or not Maximum size of the buffer could be transferred between Host and Firmware. 

Definition at line 59 of file m2m\+\_\+hif.\+h.



\subsection{Typedef Documentation}
\mbox{\Hypertarget{m2m__hif_8h_a78a3e5d59cea8566ca5c67c96f2215dc}\label{m2m__hif_8h_a78a3e5d59cea8566ca5c67c96f2215dc}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!tpf\+Hif\+Call\+Back@{tpf\+Hif\+Call\+Back}}
\index{tpf\+Hif\+Call\+Back@{tpf\+Hif\+Call\+Back}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{tpf\+Hif\+Call\+Back}{tpfHifCallBack}}
{\footnotesize\ttfamily typedef void($\ast$ tpf\+Hif\+Call\+Back)(\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Op\+Code, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Data\+Size, \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} u32\+Addr)}



used to point to Wi-\/\+Fi call back function depend on Arduino project or other projects. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em u8\+Op\+Code} & H\+IF Opcode type. \\
\hline
\mbox{\tt in}  & {\em u16\+Data\+Size} & H\+IF data length. \\
\hline
\mbox{\tt in}  & {\em pu8\+Buff} & H\+IF Data Buffer. \\
\hline
\mbox{\tt in}  & {\em grp} & H\+IF group type. \\
\hline
\end{DoxyParams}


Definition at line 102 of file m2m\+\_\+hif.\+h.



\subsection{Function Documentation}
\mbox{\Hypertarget{m2m__hif_8h_a41d3f660265e122cbd7417ea8754e8dd}\label{m2m__hif_8h_a41d3f660265e122cbd7417ea8754e8dd}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+chip\+\_\+sleep@{hif\+\_\+chip\+\_\+sleep}}
\index{hif\+\_\+chip\+\_\+sleep@{hif\+\_\+chip\+\_\+sleep}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+chip\+\_\+sleep()}{hif\_chip\_sleep()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+chip\+\_\+sleep (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



To make the chip sleep. 

\begin{DoxyReturn}{Returns}
The function shall return Z\+E\+RO for successful operation and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 227 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
228 \{
229     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
230 
231     \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep} >= 1)
232     \{
233         \hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep}--;
234     \}
235     
236     \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep} == 0)
237     \{
238         \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_ae5f8d9d225a2e36df38feccb9db7384e}{gu8ChipMode} != \hyperlink{group__WlanEnums_ggae6bd0ac78bfca4cda17d9dbedf79ad7ea3981eb69690432d09abdf1c5dd75d435}{M2M\_NO\_PS})
239         \{
240             ret = \hyperlink{nmasic_8c_a624e7923184968631a2eb86938d6f3ba}{chip\_sleep}();
241             \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
242 
243         \}
244         \textcolor{keywordflow}{else}
245         \{
246         \}
247     \}
248 ERR1:
249     \textcolor{keywordflow}{return} ret;
250 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a756a9c1154d55efd6c7924ef1ace5e75}\label{m2m__hif_8h_a756a9c1154d55efd6c7924ef1ace5e75}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+chip\+\_\+sleep\+\_\+sc@{hif\+\_\+chip\+\_\+sleep\+\_\+sc}}
\index{hif\+\_\+chip\+\_\+sleep\+\_\+sc@{hif\+\_\+chip\+\_\+sleep\+\_\+sc}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+chip\+\_\+sleep\+\_\+sc()}{hif\_chip\_sleep\_sc()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+chip\+\_\+sleep\+\_\+sc (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



To clear the chip sleep but keep the chip sleep. 

To clear the chip count only but keep the chip awake.

\begin{DoxyReturn}{Returns}
The function shall return Z\+E\+RO for successful operation and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 213 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
214 \{
215     \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep} >= 1)
216     \{
217         \hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep}--;
218     \}
219     \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
220 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a88c8f023679d14d6866b80c9275db686}\label{m2m__hif_8h_a88c8f023679d14d6866b80c9275db686}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+chip\+\_\+wake@{hif\+\_\+chip\+\_\+wake}}
\index{hif\+\_\+chip\+\_\+wake@{hif\+\_\+chip\+\_\+wake}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+chip\+\_\+wake()}{hif\_chip\_wake()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+chip\+\_\+wake (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



To Wakeup the chip. 

\begin{DoxyReturn}{Returns}
The function shall return Z\+E\+RO for successful operation and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 150 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
151 \{
152     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
153     \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_a68512adc9785897313474136faa20777}{gu8HifSizeDone})
154     \{
155         \textcolor{comment}{/*chip already wake for the rx not done no need to send wake request*/}
156         \textcolor{keywordflow}{return} ret;
157     \}
158     \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep} == 0)
159     \{
160         \textcolor{keywordflow}{if}(\hyperlink{m2m__hif_8c_ae5f8d9d225a2e36df38feccb9db7384e}{gu8ChipMode} != \hyperlink{group__WlanEnums_ggae6bd0ac78bfca4cda17d9dbedf79ad7ea3981eb69690432d09abdf1c5dd75d435}{M2M\_NO\_PS})
161         \{
162             ret = \hyperlink{nmasic_8c_abe05d6f4afa80ace3bd105d63dceda52}{chip\_wake}();
163             \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
164         \}
165         \textcolor{keywordflow}{else}
166         \{
167         \}
168     \}
169     \hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep}++;
170 ERR1:
171     \textcolor{keywordflow}{return} ret;
172 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a297b5d8edbc7f34eedb4992bf20b16ab}\label{m2m__hif_8h_a297b5d8edbc7f34eedb4992bf20b16ab}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+deinit@{hif\+\_\+deinit}}
\index{hif\+\_\+deinit@{hif\+\_\+deinit}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+deinit()}{hif\_deinit()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+deinit (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



To Deinitialize H\+IF layer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em arg} & Pointer to the arguments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function shall return Z\+E\+RO for successful operation and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 282 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
283 \{
284     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
285 \textcolor{preprocessor}{#if 0}
286     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg = 0, cnt=0;
287     \textcolor{keywordflow}{while} (reg != \hyperlink{nmasic_8c_a041fc16e321a3e5fca0c7a58a1974874}{M2M\_DISABLE\_PS})
288     \{
289         \hyperlink{group__NmBspSleepFn_gadbf38ddf0138d8e0a4e4720909a7b081}{nm\_bsp\_sleep}(1);
290         reg = \hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(STATE\_REG);
291         \textcolor{keywordflow}{if}(++cnt > 1000)
292         \{
293             \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"failed to stop power save\(\backslash\)r\(\backslash\)n"});
294             \textcolor{keywordflow}{break};
295         \}
296     \}
297 \textcolor{preprocessor}{#endif}
298     ret = \hyperlink{m2m__hif_8c_a88c8f023679d14d6866b80c9275db686}{hif\_chip\_wake}();
299     
300     \textcolor{keywordflow}{return} ret;
301 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_ad32fe2e6813b9ecfdd54d200e498468c}\label{m2m__hif_8h_ad32fe2e6813b9ecfdd54d200e498468c}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+get\+\_\+sleep\+\_\+mode@{hif\+\_\+get\+\_\+sleep\+\_\+mode}}
\index{hif\+\_\+get\+\_\+sleep\+\_\+mode@{hif\+\_\+get\+\_\+sleep\+\_\+mode}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+get\+\_\+sleep\+\_\+mode()}{hif\_get\_sleep\_mode()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} hif\+\_\+get\+\_\+sleep\+\_\+mode (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Get the sleep mode of the H\+IF layer. 

\begin{DoxyReturn}{Returns}
The function S\+H\+A\+LL return the sleep mode of the H\+IF layer. 
\end{DoxyReturn}


Definition at line 202 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
203 \{
204     \textcolor{keywordflow}{return} \hyperlink{m2m__hif_8c_ae5f8d9d225a2e36df38feccb9db7384e}{gu8ChipMode};
205 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_af66b8acfc8e66aae102b56ac84bca50d}\label{m2m__hif_8h_af66b8acfc8e66aae102b56ac84bca50d}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+handle\+\_\+isr@{hif\+\_\+handle\+\_\+isr}}
\index{hif\+\_\+handle\+\_\+isr@{hif\+\_\+handle\+\_\+isr}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+handle\+\_\+isr()}{hif\_handle\_isr()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+handle\+\_\+isr (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Handle interrupt received from N\+M\+C1500 firmware. 

\begin{DoxyReturn}{Returns}
The function S\+H\+A\+LL return 0 for success and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 601 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
602 \{
603     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
604     
605     \textcolor{keywordflow}{while} (\hyperlink{m2m__hif_8c_a4309a0f46145711222ae72d8971909d9}{gu8Interrupt}) \{
606         \textcolor{comment}{/*must be at that place because of the race of interrupt increment and that decrement*/}
607         \textcolor{comment}{/*when the interrupt enabled*/}
608         \hyperlink{m2m__hif_8c_a4309a0f46145711222ae72d8971909d9}{gu8Interrupt}--;
609         \textcolor{keywordflow}{while}(1)
610         \{
611             ret = \hyperlink{m2m__hif_8c_a1523a85732c699292401c1a6c2f4f33b}{hif\_isr}();
612             \textcolor{keywordflow}{if}(ret == \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
613                 \textcolor{comment}{/*we will try forever untill we get that interrupt*/}
614                 \textcolor{comment}{/*Fail return errors here due to bus errors (reading expected values)*/}
615                 \textcolor{keywordflow}{break};
616             \} \textcolor{keywordflow}{else} \{
617                 \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"(HIF) Fail to handle interrupt %d try Again..\(\backslash\)r\(\backslash\)n"},ret);
618             \}
619         \}
620     \}
621 
622     \textcolor{keywordflow}{return} ret;
623 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a98d80ebd8d05b076ab1dfe4d42d2a1bd}\label{m2m__hif_8h_a98d80ebd8d05b076ab1dfe4d42d2a1bd}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+init@{hif\+\_\+init}}
\index{hif\+\_\+init@{hif\+\_\+init}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+init()}{hif\_init()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+init (\begin{DoxyParamCaption}\item[{\hyperlink{structtstrHifinitParam}{tstr\+Hifinit\+Param} $\ast$}]{pstr\+Init\+Param }\end{DoxyParamCaption})}



Definition at line 259 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
260 \{
261     \hyperlink{m2m__hif_8c_a085d7c2c8a8434a558f7a2f929b27643}{pfWifiCb} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
262     
263     \hyperlink{m2m__hif_8c_adb8704ba7e6d585352a20c499672c922}{gu8ChipSleep} = 0;
264     \hyperlink{m2m__hif_8c_ae5f8d9d225a2e36df38feccb9db7384e}{gu8ChipMode} = \hyperlink{group__WlanEnums_ggae6bd0ac78bfca4cda17d9dbedf79ad7ea3981eb69690432d09abdf1c5dd75d435}{M2M\_NO\_PS};
265 
266     \hyperlink{m2m__hif_8c_a4309a0f46145711222ae72d8971909d9}{gu8Interrupt} = 0;
267     \hyperlink{group__NmBspRegisterFn_ga1b42af0f91da07772d2d5c871c9c3e62}{nm\_bsp\_register\_isr}(\hyperlink{m2m__hif_8c_ad3c50b24a4b59659a8219108a080c7cc}{isr});
268 
269     \hyperlink{m2m__hif_8c_a63f14be680fcf28f96912ee6e6f28be9}{hif\_register\_cb}(\hyperlink{nm__common_8h_a9ab02eb1aea02a75c3f5aade4eef1276a0a1440badab09fd63989415a7b051133}{M2M\_REQ\_GRP\_HIF},\hyperlink{m2m__hif_8c_a586d455672ab6d1c931f14a7a5fb26c2}{m2m\_hif\_cb});
270 
271     \hyperlink{nm__common_8h_a62b30b611dfcc58e190254d1f663470a}{m2m\_memcpy}((\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}*)(&\hyperlink{m2m__hif_8c_a6ae7b8f5c97ebf1c5775d9272af3f9e7}{strHifInitParam}), (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}*)pstrInitParam, \textcolor{keyword}{sizeof}
      (\hyperlink{structtstrHifinitParam}{tstrHifinitParam}));
272     
273     \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
274 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a74395aadf04bddddf9c3cf9e55b9ec58}\label{m2m__hif_8h_a74395aadf04bddddf9c3cf9e55b9ec58}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+receive@{hif\+\_\+receive}}
\index{hif\+\_\+receive@{hif\+\_\+receive}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+receive()}{hif\_receive()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+receive (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}}]{u32\+Addr,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Buf,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Sz,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{is\+Done }\end{DoxyParamCaption})}



Definition at line 637 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
638 \{
639     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} \hyperlink{dhcpv6__common_8h_aaee906fadd211e863c2e29a3690b25c4}{address}, reg;
640     \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} size;
641     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
642 
643     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{m2m__hif_8c_a3ede7567355b40c9565be5b24288122f}{WIFI\_HOST\_RCV\_CTRL\_0},&reg);
644     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1; 
645 
646 
647     size = (\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16})((reg >> 2) & 0xfff);  
648     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{m2m__hif_8c_af8f826d3c40d2cb9ab9bec16a2df81d3}{WIFI\_HOST\_RCV\_CTRL\_1},&address);
649     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1; 
650 
651     \textcolor{comment}{/* Receive the payload */}
652     ret = \hyperlink{nmbus_8c_af1e8ce2caa79fdd112216a9f36f103a0}{nm\_read\_block}(u32Addr, pu8Buf, u16Sz);
653     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
654 
655     \textcolor{keywordflow}{if}(u16Sz > size)
656     \{
657         ret = \hyperlink{nm__common_8h_a39ed05df730834f2255971ca9879996e}{M2M\_ERR\_FAIL};
658         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"APP Requested Size is larger than the recived buffer size <%d><%d>\(\backslash\)r\(\backslash\)n"},u16Sz, size
      );
659         \textcolor{keywordflow}{goto} ERR1;
660     \}
661     \textcolor{keywordflow}{if}((u32Addr < address)||((u32Addr + u16Sz)>(address+size)))
662     \{
663         ret = \hyperlink{nm__common_8h_a39ed05df730834f2255971ca9879996e}{M2M\_ERR\_FAIL};
664         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"APP Requested Address beyond the recived buffer address and length\(\backslash\)r\(\backslash\)n"});
665         \textcolor{keywordflow}{goto} ERR1;
666     \}
667 
668     \textcolor{comment}{/* check if this is the last packet */}
669     \textcolor{keywordflow}{if}((((address+size) - (u32Addr+u16Sz)) < 4) || isDone)
670     \{
671         
672         \textcolor{comment}{/* set RX done */}
673         ret = \hyperlink{m2m__hif_8c_ac7a1ee6393c0c983c391233853164f84}{hif\_set\_rx\_done}();
674     \}
675     
676 
677 
678 ERR1:
679     \textcolor{keywordflow}{return} ret;
680 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a30fc4f91ec4d7859a4bf165152f1af7f}\label{m2m__hif_8h_a30fc4f91ec4d7859a4bf165152f1af7f}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+register\+\_\+cb@{hif\+\_\+register\+\_\+cb}}
\index{hif\+\_\+register\+\_\+cb@{hif\+\_\+register\+\_\+cb}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+register\+\_\+cb()}{hif\_register\_cb()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+register\+\_\+cb (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Grp,  }\item[{\hyperlink{m2m__hif_8h_a78a3e5d59cea8566ca5c67c96f2215dc}{tpf\+Hif\+Call\+Back}}]{fn }\end{DoxyParamCaption})}



Definition at line 692 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
693 \{
694     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
695     \textcolor{keywordflow}{switch}(u8Grp)
696     \{
697         \textcolor{keywordflow}{case} \hyperlink{nm__common_8h_a9ab02eb1aea02a75c3f5aade4eef1276aeb9a7d57324ba4b8a6c2a5f46dd499c2}{M2M\_REQ\_GRP\_WIFI}:
698             \hyperlink{m2m__hif_8c_a085d7c2c8a8434a558f7a2f929b27643}{pfWifiCb} = fn;
699             \textcolor{keywordflow}{break};
700         \textcolor{keywordflow}{case} \hyperlink{nm__common_8h_a9ab02eb1aea02a75c3f5aade4eef1276a0a1440badab09fd63989415a7b051133}{M2M\_REQ\_GRP\_HIF}:
701             \hyperlink{m2m__hif_8c_a41845a0437e3fff496515f04d651af76}{pfHifCb} = fn;
702             \textcolor{keywordflow}{break};
703         \textcolor{keywordflow}{default}:
704             \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"GRp ? %d\(\backslash\)r\(\backslash\)n"},u8Grp);
705             ret = \hyperlink{nm__common_8h_a39ed05df730834f2255971ca9879996e}{M2M\_ERR\_FAIL};
706             \textcolor{keywordflow}{break};
707     \}
708     \textcolor{keywordflow}{return} ret;
709 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a13ba8ad11b2ac39516ca787386d16ce0}\label{m2m__hif_8h_a13ba8ad11b2ac39516ca787386d16ce0}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+send@{hif\+\_\+send}}
\index{hif\+\_\+send@{hif\+\_\+send}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+send()}{hif\_send()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+send (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Gid,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Opcode,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Ctrl\+Buf,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Ctrl\+Buf\+Size,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Data\+Buf,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Data\+Size,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Data\+Offset }\end{DoxyParamCaption})}



Send packet using host interface. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em u8\+Gid} & Group ID. \\
\hline
\mbox{\tt in}  & {\em u8\+Opcode} & Operation ID. \\
\hline
\mbox{\tt in}  & {\em pu8\+Ctrl\+Buf} & Pointer to the Control buffer. \\
\hline
\mbox{\tt in}  & {\em u16\+Ctrl\+Buf\+Size} & Control buffer size. \\
\hline
\mbox{\tt in}  & {\em u16\+Data\+Offset} & Packet Data offset. \\
\hline
\mbox{\tt in}  & {\em pu8\+Data\+Buf} & Packet buffer Allocated by the caller. \\
\hline
\mbox{\tt in}  & {\em u16\+Data\+Size} & Packet buffer size (including the H\+IF header). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function shall return Z\+E\+RO for successful operation and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 324 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
326 \{
327     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8}      ret = \hyperlink{nm__common_8h_a83f12b45e2e04282453990ba8eb9eeb6}{M2M\_ERR\_SEND};
328 \textcolor{preprocessor}{#ifndef INT\_BASED\_TX}
329     \textcolor{keywordtype}{int} count = 0;
330 \textcolor{preprocessor}{#endif}
331     gstrHif.u8Opcode        = u8Opcode&(~\hyperlink{nm__common_8h_a12c8e796d1a5f24bf8d9ae8c25f6cc0c}{NBIT7});
332     gstrHif.u8Gid       = u8Gid;
333     gstrHif.u16Length   = \hyperlink{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}{M2M\_HIF\_HDR\_OFFSET};
334     \textcolor{keywordflow}{if}(pu8DataBuf != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
335     \{
336         gstrHif.u16Length += u16DataOffset + u16DataSize;
337     \}
338     \textcolor{keywordflow}{else}
339     \{
340         gstrHif.u16Length += u16CtrlBufSize;
341     \}
342     ret = \hyperlink{m2m__hif_8c_a88c8f023679d14d6866b80c9275db686}{hif\_chip\_wake}();
343     \textcolor{keywordflow}{if}(ret == \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})
344     \{
345         \textcolor{keyword}{volatile} \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg, dma\_addr = 0;
346 \textcolor{preprocessor}{#ifndef INT\_BASED\_TX}
347         \textcolor{keywordflow}{for} (count = 0; count < 1000 && dma\_addr == 0; count++)
348 #endif
349         \{
350             ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x150400,(\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} *)&dma\_addr);         
351         \}       
352         \textcolor{keywordflow}{if} (dma\_addr != 0) 
353         \{
354             \textcolor{keyword}{volatile} \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}   u32CurrAddr;
355             \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x150400,0);
356             u32CurrAddr = dma\_addr;
357             gstrHif.u16Length=\hyperlink{nm__bsp_8h_a22348273616354c0ac8a3de5ce4fb963}{NM\_BSP\_B\_L\_16}(gstrHif.u16Length);
358             ret = \hyperlink{nmbus_8c_afb924df7f944a8137cd51069512661cf}{nm\_write\_block}(u32CurrAddr, (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}*)&gstrHif, 
      \hyperlink{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}{M2M\_HIF\_HDR\_OFFSET});
359             \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{goto} ERR1;
360             u32CurrAddr += \hyperlink{m2m__hif_8h_a374fe954dffb43612aa5579e1bb340fe}{M2M\_HIF\_HDR\_OFFSET};
361             \textcolor{keywordflow}{if}(pu8CtrlBuf != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
362             \{
363                 ret = \hyperlink{nmbus_8c_afb924df7f944a8137cd51069512661cf}{nm\_write\_block}(u32CurrAddr, pu8CtrlBuf, u16CtrlBufSize);
364                 \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{goto} ERR1;
365                 u32CurrAddr += u16CtrlBufSize;
366             \}
367             \textcolor{keywordflow}{if}(pu8DataBuf != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
368             \{
369                 u32CurrAddr += (u16DataOffset - u16CtrlBufSize);
370                 ret = \hyperlink{nmbus_8c_afb924df7f944a8137cd51069512661cf}{nm\_write\_block}(u32CurrAddr, pu8DataBuf, u16DataSize);
371                 \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{goto} ERR1;
372                 u32CurrAddr += u16DataSize;
373             \}
374             reg = dma\_addr << 2;
375             reg |= (1 << 1);
376             ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{m2m__hif_8c_afe04618587d8661decb3ee50df1b6853}{WIFI\_HOST\_RCV\_CTRL\_3}, reg);
377             \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{goto} ERR1;
378 \textcolor{preprocessor}{#if defined CONF\_WILC\_USE\_3000\_REV\_A}
379             ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(INTERRUPT\_CORTUS\_2\_3000D0, 1);
380             \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{goto} ERR1;
381 \textcolor{preprocessor}{#endif}
382         \}
383         \textcolor{keywordflow}{else}
384         \{
385             ret = \hyperlink{m2m__hif_8c_a41d3f660265e122cbd7417ea8754e8dd}{hif\_chip\_sleep}();
386             \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"Failed to alloc rx size %d\(\backslash\)r\(\backslash\)n"},ret);
387             ret = \hyperlink{nm__common_8h_a819c60cc53e1159dea4754fa4092243b}{M2M\_ERR\_MEM\_ALLOC};
388             \textcolor{keywordflow}{goto} ERR2;
389         \}
390 
391     \}
392     \textcolor{keywordflow}{else}
393     \{
394         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"(HIF)Fail to wakup the chip\(\backslash\)r\(\backslash\)n"});
395         \textcolor{keywordflow}{goto} ERR2;
396     \}
397     \textcolor{comment}{/*actual sleep ret = M2M\_SUCCESS*/}
398     ret = \hyperlink{m2m__hif_8c_a41d3f660265e122cbd7417ea8754e8dd}{hif\_chip\_sleep}();
399     \textcolor{keywordflow}{return} ret;
400 ERR1:
401     \textcolor{comment}{/*reset the count but no actual sleep as it already bus error*/}
402     \hyperlink{m2m__hif_8c_a756a9c1154d55efd6c7924ef1ace5e75}{hif\_chip\_sleep\_sc}();
403 ERR2:
404     \textcolor{comment}{/*logical error*/}
405     \textcolor{keywordflow}{return} ret;
406 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_a8055cbaa8a24b713f6dcec6e9b721674}\label{m2m__hif_8h_a8055cbaa8a24b713f6dcec6e9b721674}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+send\+\_\+optimized@{hif\+\_\+send\+\_\+optimized}}
\index{hif\+\_\+send\+\_\+optimized@{hif\+\_\+send\+\_\+optimized}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+send\+\_\+optimized()}{hif\_send\_optimized()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+send\+\_\+optimized (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Gid,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Opcode,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{buffer,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Data\+Size }\end{DoxyParamCaption})}



Definition at line 427 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
427                                                                                          \{
428     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a83f12b45e2e04282453990ba8eb9eeb6}{M2M\_ERR\_SEND};
429     \textcolor{keyword}{volatile} \hyperlink{structtstrHifHdr}{tstrHifHdr}* strHif = (\hyperlink{structtstrHifHdr}{tstrHifHdr}*) (buffer);
430 \textcolor{preprocessor}{#ifndef INT\_BASED\_TX}
431     \textcolor{keywordtype}{int} count = 0;
432 \textcolor{preprocessor}{#endif}
433     strHif->\hyperlink{structtstrHifHdr_a95b0cece0166052ed10341584a2bda3f}{u8Opcode} = u8Opcode & (~\hyperlink{nm__common_8h_a12c8e796d1a5f24bf8d9ae8c25f6cc0c}{NBIT7});
434     strHif->\hyperlink{structtstrHifHdr_a7a12aaca5b72583aa35959eba923e466}{u8Gid} = u8Gid;
435     strHif->\hyperlink{structtstrHifHdr_a3f30ba8842ea1373d6c1514524704e09}{u16Length} = u16DataSize;
436     ret = \hyperlink{m2m__hif_8c_a88c8f023679d14d6866b80c9275db686}{hif\_chip\_wake}();
437     \textcolor{keywordflow}{if} (ret == \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
438         \textcolor{keyword}{volatile} \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg, dma\_addr = 0;
439 \textcolor{preprocessor}{#ifndef INT\_BASED\_TX}
440         \textcolor{keywordflow}{for} (count = 0; count < 1000 && dma\_addr == 0; count++)
441 #endif
442                 \{
443             ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x150400, (\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} *) &dma\_addr);
444         \}
445         \textcolor{keywordflow}{if} (dma\_addr != 0) \{
446             \textcolor{keyword}{volatile} \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} u32CurrAddr;
447             \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x150400, 0);
448             u32CurrAddr = dma\_addr;
449             strHif->\hyperlink{structtstrHifHdr_a3f30ba8842ea1373d6c1514524704e09}{u16Length} = \hyperlink{nm__bsp_8h_a22348273616354c0ac8a3de5ce4fb963}{NM\_BSP\_B\_L\_16}(strHif->
      \hyperlink{structtstrHifHdr_a3f30ba8842ea1373d6c1514524704e09}{u16Length});
450             ret = \hyperlink{nmbus_8c_afb924df7f944a8137cd51069512661cf}{nm\_write\_block}(u32CurrAddr, buffer, u16DataSize);
451             \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret)
452                 \textcolor{keywordflow}{return} ret;
453             u32CurrAddr += u16DataSize;
454             reg = dma\_addr << 2;
455             reg |= (1 << 1);
456             ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{m2m__hif_8c_afe04618587d8661decb3ee50df1b6853}{WIFI\_HOST\_RCV\_CTRL\_3}, reg);
457             \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret)
458                 \textcolor{keywordflow}{return} ret;
459 \textcolor{preprocessor}{#if defined CONF\_WILC\_USE\_3000\_REV\_A}
460             ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(INTERRUPT\_CORTUS\_2\_3000D0, 1);
461             \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \textcolor{keywordflow}{return} ret;
462 \textcolor{preprocessor}{#endif}
463         \} \textcolor{keywordflow}{else} \{
464             \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"Failed to alloc rx size\(\backslash\)r\(\backslash\)n"});
465             ret = \hyperlink{nm__common_8h_a819c60cc53e1159dea4754fa4092243b}{M2M\_ERR\_MEM\_ALLOC};
466             \textcolor{keywordflow}{return} ret;
467         \}
468     \} \textcolor{keywordflow}{else} \{
469         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"(HIF)Fail to wakup the chip\(\backslash\)r\(\backslash\)n"});
470         \textcolor{keywordflow}{return} ret;
471     \}
472     ret = \hyperlink{m2m__hif_8c_a41d3f660265e122cbd7417ea8754e8dd}{hif\_chip\_sleep}();
473     \textcolor{keywordflow}{return} ret;
474 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_ae2f12ba6f6738b12d291124c8abe2f84}\label{m2m__hif_8h_ae2f12ba6f6738b12d291124c8abe2f84}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+set\+\_\+receive\+\_\+buffer@{hif\+\_\+set\+\_\+receive\+\_\+buffer}}
\index{hif\+\_\+set\+\_\+receive\+\_\+buffer@{hif\+\_\+set\+\_\+receive\+\_\+buffer}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+set\+\_\+receive\+\_\+buffer()}{hif\_set\_receive\_buffer()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} hif\+\_\+set\+\_\+receive\+\_\+buffer (\begin{DoxyParamCaption}\item[{void $\ast$}]{pv\+Buffer,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Buffer\+Len }\end{DoxyParamCaption})}



Handle interrupt received from N\+M\+C1500 firmware. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pv\+Buffer} & Pointer to the buffer. \\
\hline
\mbox{\tt in}  & {\em u16\+Buffer\+Len} & Size of the buffer. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function S\+H\+A\+LL return 0 for success and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 711 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
712 \{
713     \textcolor{keywordflow}{if} ((((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})pvBuffer)%4) != 0) \{
714         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Error: unaligned buffer!\(\backslash\)r\(\backslash\)n"});
715         \textcolor{keywordflow}{return} -1;
716     \}
717     \hyperlink{m2m__hif_8c_a6ae7b8f5c97ebf1c5775d9272af3f9e7}{strHifInitParam}.\hyperlink{structtstrHifinitParam_a8fba7791bb370e1824b8a0d0365c71c5}{pu8RcvBuff} = pvBuffer;
718     \hyperlink{m2m__hif_8c_a6ae7b8f5c97ebf1c5775d9272af3f9e7}{strHifInitParam}.\hyperlink{structtstrHifinitParam_a0a0ef27c7b11c7e708fc4a4e694edec2}{u32RcvBuffSize} = u16BufferLen;
719     \textcolor{keywordflow}{return} 0;
720 \}
\end{DoxyCode}
\mbox{\Hypertarget{m2m__hif_8h_aea14bdeaac412fb26e8a550bbd06ef91}\label{m2m__hif_8h_aea14bdeaac412fb26e8a550bbd06ef91}} 
\index{m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}!hif\+\_\+set\+\_\+sleep\+\_\+mode@{hif\+\_\+set\+\_\+sleep\+\_\+mode}}
\index{hif\+\_\+set\+\_\+sleep\+\_\+mode@{hif\+\_\+set\+\_\+sleep\+\_\+mode}!m2m\+\_\+hif.\+h@{m2m\+\_\+hif.\+h}}
\subsubsection{\texorpdfstring{hif\+\_\+set\+\_\+sleep\+\_\+mode()}{hif\_set\_sleep\_mode()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} void hif\+\_\+set\+\_\+sleep\+\_\+mode (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Pstype }\end{DoxyParamCaption})}



Set the sleep mode of the H\+IF layer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em u8\+Pstype} & Sleep mode.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function S\+H\+A\+LL return 0 for success and a negative value otherwise. 
\end{DoxyReturn}


Definition at line 187 of file m2m\+\_\+hif.\+c.


\begin{DoxyCode}
188 \{
189     \hyperlink{m2m__hif_8c_ae5f8d9d225a2e36df38feccb9db7384e}{gu8ChipMode} = u8Pstype;
190 \}
\end{DoxyCode}
