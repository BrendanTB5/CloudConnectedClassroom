\hypertarget{chacha20__poly1305_8h}{}\section{cyclone\+\_\+crypto/aead/chacha20\+\_\+poly1305.h File Reference}
\label{chacha20__poly1305_8h}\index{cyclone\+\_\+crypto/aead/chacha20\+\_\+poly1305.\+h@{cyclone\+\_\+crypto/aead/chacha20\+\_\+poly1305.\+h}}


Cha\+Cha20\+Poly1305 A\+E\+AD.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{chacha20__poly1305_8h_a8e0dc01ce6f977cc74e07587da869829}{chacha20\+Poly1305\+Encrypt} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{sha512_8c_a3934111e8801bd86b261f4bac043efa6}{k}, size\+\_\+t k\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, size\+\_\+t n\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, size\+\_\+t a\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, size\+\_\+t t\+Len)
\begin{DoxyCompactList}\small\item\em Authenticated encryption using Cha\+Cha20\+Poly1305. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{chacha20__poly1305_8h_a245e54ef105d815882bc64ac713e834f}{chacha20\+Poly1305\+Decrypt} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{sha512_8c_a3934111e8801bd86b261f4bac043efa6}{k}, size\+\_\+t k\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, size\+\_\+t n\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, size\+\_\+t a\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}, size\+\_\+t t\+Len)
\begin{DoxyCompactList}\small\item\em Authenticated decryption using Cha\+Cha20\+Poly1305. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Cha\+Cha20\+Poly1305 A\+E\+AD. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{chacha20__poly1305_8h_a245e54ef105d815882bc64ac713e834f}\label{chacha20__poly1305_8h_a245e54ef105d815882bc64ac713e834f}} 
\index{chacha20\+\_\+poly1305.\+h@{chacha20\+\_\+poly1305.\+h}!chacha20\+Poly1305\+Decrypt@{chacha20\+Poly1305\+Decrypt}}
\index{chacha20\+Poly1305\+Decrypt@{chacha20\+Poly1305\+Decrypt}!chacha20\+\_\+poly1305.\+h@{chacha20\+\_\+poly1305.\+h}}
\subsubsection{\texorpdfstring{chacha20\+Poly1305\+Decrypt()}{chacha20Poly1305Decrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} chacha20\+Poly1305\+Decrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{k,  }\item[{size\+\_\+t}]{k\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{n,  }\item[{size\+\_\+t}]{n\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{size\+\_\+t}]{a\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{size\+\_\+t}]{t\+Len }\end{DoxyParamCaption})}



Authenticated decryption using Cha\+Cha20\+Poly1305. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em k} & key \\
\hline
\mbox{\tt in}  & {\em k\+Len} & Length of the key \\
\hline
\mbox{\tt in}  & {\em n} & Nonce \\
\hline
\mbox{\tt in}  & {\em n\+Len} & Length of the nonce \\
\hline
\mbox{\tt in}  & {\em a} & Additional authenticated data \\
\hline
\mbox{\tt in}  & {\em a\+Len} & Length of the additional data \\
\hline
\mbox{\tt in}  & {\em c} & Ciphertext to be decrypted \\
\hline
\mbox{\tt out}  & {\em p} & Plaintext resulting from the decryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be decrypted \\
\hline
\mbox{\tt in}  & {\em t} & M\+AC to be verified \\
\hline
\mbox{\tt in}  & {\em t\+Len} & Length of the M\+AC \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 165 of file chacha20\+\_\+poly1305.\+c.


\begin{DoxyCode}
168 \{
169    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
170    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{web__socket_8h_a8a74907784be6c7786c2d060c8d7e10b}{mask};
171    \textcolor{keywordtype}{size\_t} i;
172    \textcolor{keywordtype}{size\_t} paddingLen;
173    \hyperlink{structChachaContext}{ChachaContext} chachaContext;
174    \hyperlink{structPoly1305Context}{Poly1305Context} poly1305Context;
175    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} temp[32];
176 
177    \textcolor{comment}{//Check the length of the message-authentication code}
178    \textcolor{keywordflow}{if}(tLen != 16)
179       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
180 
181    \textcolor{comment}{//Initialize ChaCha20 context}
182    error = \hyperlink{chacha_8c_ac2ce3da3f79c749e9d26dc9c802874ae}{chachaInit}(&chachaContext, 20, \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}, kLen, \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, nLen);
183    \textcolor{comment}{//Any error to report?}
184    \textcolor{keywordflow}{if}(error)
185       \textcolor{keywordflow}{return} error;
186 
187    \textcolor{comment}{//First, a Poly1305 one-time key is generated from the 256-bit key}
188    \textcolor{comment}{//and nonce}
189    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, temp, 32);
190 
191    \textcolor{comment}{//The other 256 bits of the Chacha20 block are discarded}
192    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 32);
193 
194    \textcolor{comment}{//Initialize the Poly1305 function with the key calculated above}
195    \hyperlink{poly1305_8c_a0cbf44db09885b116048800e002a7898}{poly1305Init}(&poly1305Context, temp);
196 
197    \textcolor{comment}{//Compute MAC over the AAD}
198    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, aLen);
199 
200    \textcolor{comment}{//If the length of the AAD is not an integral multiple of 16 bytes,}
201    \textcolor{comment}{//then padding is required}
202    \textcolor{keywordflow}{if}((aLen % 16) != 0)
203    \{
204       \textcolor{comment}{//Compute the number of padding bytes}
205       paddingLen = 16 - (aLen % 16);
206 
207       \textcolor{comment}{//The padding is up to 15 zero bytes, and it brings the total length}
208       \textcolor{comment}{//so far to an integral multiple of 16}
209       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(temp, 0, paddingLen);
210 
211       \textcolor{comment}{//Compute MAC over the padding}
212       \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, paddingLen);
213    \}
214 
215    \textcolor{comment}{//Compute MAC over the ciphertext}
216    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
217 
218    \textcolor{comment}{//If the length of the ciphertext is not an integral multiple of 16 bytes,}
219    \textcolor{comment}{//then padding is required}
220    \textcolor{keywordflow}{if}((\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} % 16) != 0)
221    \{
222       \textcolor{comment}{//Compute the number of padding bytes}
223       paddingLen = 16 - (\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} % 16);
224 
225       \textcolor{comment}{//The padding is up to 15 zero bytes, and it brings the total length}
226       \textcolor{comment}{//so far to an integral multiple of 16}
227       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(temp, 0, paddingLen);
228 
229       \textcolor{comment}{//Compute MAC over the padding}
230       \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, paddingLen);
231    \}
232 
233    \textcolor{comment}{//Encode the length of the AAD as a 64-bit little-endian integer}
234    \hyperlink{cpu__endian_8h_a2727c751179f11e6d5a661134a1ad1ff}{STORE64LE}(aLen, temp);
235    \textcolor{comment}{//Compute MAC over the length field}
236    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}));
237 
238    \textcolor{comment}{//Encode the length of the ciphertext as a 64-bit little-endian integer}
239    \hyperlink{cpu__endian_8h_a2727c751179f11e6d5a661134a1ad1ff}{STORE64LE}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, temp);
240    \textcolor{comment}{//Compute MAC over the length field}
241    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}));
242 
243    \textcolor{comment}{//Compute message-authentication code}
244    \hyperlink{poly1305_8c_ac0e870e7907162c666bcd032cf07c204}{poly1305Final}(&poly1305Context, temp);
245 
246    \textcolor{comment}{//Finally, we decrypt the ciphertext}
247    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
248 
249    \textcolor{comment}{//The calculated tag is bitwise compared to the received tag. The}
250    \textcolor{comment}{//message is authenticated if and only if the tags match}
251    \textcolor{keywordflow}{for}(mask = 0, i = 0; i < tLen; i++)
252    \{
253       mask |= temp[i] ^ \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t}[i];
254    \}
255 
256    \textcolor{comment}{//Return status code}
257    \textcolor{keywordflow}{return} (mask == 0) ? \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} : \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
258 \}
\end{DoxyCode}
\mbox{\Hypertarget{chacha20__poly1305_8h_a8e0dc01ce6f977cc74e07587da869829}\label{chacha20__poly1305_8h_a8e0dc01ce6f977cc74e07587da869829}} 
\index{chacha20\+\_\+poly1305.\+h@{chacha20\+\_\+poly1305.\+h}!chacha20\+Poly1305\+Encrypt@{chacha20\+Poly1305\+Encrypt}}
\index{chacha20\+Poly1305\+Encrypt@{chacha20\+Poly1305\+Encrypt}!chacha20\+\_\+poly1305.\+h@{chacha20\+\_\+poly1305.\+h}}
\subsubsection{\texorpdfstring{chacha20\+Poly1305\+Encrypt()}{chacha20Poly1305Encrypt()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} chacha20\+Poly1305\+Encrypt (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{k,  }\item[{size\+\_\+t}]{k\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{n,  }\item[{size\+\_\+t}]{n\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{size\+\_\+t}]{a\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{c,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{t,  }\item[{size\+\_\+t}]{t\+Len }\end{DoxyParamCaption})}



Authenticated encryption using Cha\+Cha20\+Poly1305. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em k} & key \\
\hline
\mbox{\tt in}  & {\em k\+Len} & Length of the key \\
\hline
\mbox{\tt in}  & {\em n} & Nonce \\
\hline
\mbox{\tt in}  & {\em n\+Len} & Length of the nonce \\
\hline
\mbox{\tt in}  & {\em a} & Additional authenticated data \\
\hline
\mbox{\tt in}  & {\em a\+Len} & Length of the additional data \\
\hline
\mbox{\tt in}  & {\em p} & Plaintext to be encrypted \\
\hline
\mbox{\tt out}  & {\em c} & Ciphertext resulting from the encryption \\
\hline
\mbox{\tt in}  & {\em length} & Total number of data bytes to be encrypted \\
\hline
\mbox{\tt out}  & {\em t} & M\+AC resulting from the encryption process \\
\hline
\mbox{\tt in}  & {\em t\+Len} & Length of the M\+AC \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 61 of file chacha20\+\_\+poly1305.\+c.


\begin{DoxyCode}
64 \{
65    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
66    \textcolor{keywordtype}{size\_t} paddingLen;
67    \hyperlink{structChachaContext}{ChachaContext} chachaContext;
68    \hyperlink{structPoly1305Context}{Poly1305Context} poly1305Context;
69    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} temp[32];
70 
71    \textcolor{comment}{//Check the length of the message-authentication code}
72    \textcolor{keywordflow}{if}(tLen != 16)
73       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
74 
75    \textcolor{comment}{//Initialize ChaCha20 context}
76    error = \hyperlink{chacha_8c_ac2ce3da3f79c749e9d26dc9c802874ae}{chachaInit}(&chachaContext, 20, \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}, kLen, \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}, nLen);
77    \textcolor{comment}{//Any error to report?}
78    \textcolor{keywordflow}{if}(error)
79       \textcolor{keywordflow}{return} error;
80 
81    \textcolor{comment}{//First, a Poly1305 one-time key is generated from the 256-bit key}
82    \textcolor{comment}{//and nonce}
83    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, temp, 32);
84 
85    \textcolor{comment}{//The other 256 bits of the Chacha20 block are discarded}
86    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 32);
87 
88    \textcolor{comment}{//Next, the ChaCha20 encryption function is called to encrypt the}
89    \textcolor{comment}{//plaintext, using the same key and nonce}
90    \hyperlink{chacha_8c_a3f6166161f02b55e8eeb2546bf819853}{chachaCipher}(&chachaContext, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
91 
92    \textcolor{comment}{//Initialize the Poly1305 function with the key calculated above}
93    \hyperlink{poly1305_8c_a0cbf44db09885b116048800e002a7898}{poly1305Init}(&poly1305Context, temp);
94 
95    \textcolor{comment}{//Compute MAC over the AAD}
96    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, aLen);
97 
98    \textcolor{comment}{//If the length of the AAD is not an integral multiple of 16 bytes,}
99    \textcolor{comment}{//then padding is required}
100    \textcolor{keywordflow}{if}((aLen % 16) != 0)
101    \{
102       \textcolor{comment}{//Compute the number of padding bytes}
103       paddingLen = 16 - (aLen % 16);
104 
105       \textcolor{comment}{//The padding is up to 15 zero bytes, and it brings the total length}
106       \textcolor{comment}{//so far to an integral multiple of 16}
107       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(temp, 0, paddingLen);
108 
109       \textcolor{comment}{//Compute MAC over the padding}
110       \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, paddingLen);
111    \}
112 
113    \textcolor{comment}{//Compute MAC over the ciphertext}
114    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
115 
116    \textcolor{comment}{//If the length of the ciphertext is not an integral multiple of 16 bytes,}
117    \textcolor{comment}{//then padding is required}
118    \textcolor{keywordflow}{if}((\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} % 16) != 0)
119    \{
120       \textcolor{comment}{//Compute the number of padding bytes}
121       paddingLen = 16 - (\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} % 16);
122 
123       \textcolor{comment}{//The padding is up to 15 zero bytes, and it brings the total length}
124       \textcolor{comment}{//so far to an integral multiple of 16}
125       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(temp, 0, paddingLen);
126 
127       \textcolor{comment}{//Compute MAC over the padding}
128       \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, paddingLen);
129    \}
130 
131    \textcolor{comment}{//Encode the length of the AAD as a 64-bit little-endian integer}
132    \hyperlink{cpu__endian_8h_a2727c751179f11e6d5a661134a1ad1ff}{STORE64LE}(aLen, temp);
133    \textcolor{comment}{//Compute MAC over the length field}
134    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}));
135 
136    \textcolor{comment}{//Encode the length of the ciphertext as a 64-bit little-endian integer}
137    \hyperlink{cpu__endian_8h_a2727c751179f11e6d5a661134a1ad1ff}{STORE64LE}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, temp);
138    \textcolor{comment}{//Compute MAC over the length field}
139    \hyperlink{poly1305_8c_a6492c927f98ec62d800baafdbf5536cf}{poly1305Update}(&poly1305Context, temp, \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}));
140 
141    \textcolor{comment}{//Compute message-authentication code}
142    \hyperlink{poly1305_8c_ac0e870e7907162c666bcd032cf07c204}{poly1305Final}(&poly1305Context, \hyperlink{llmnr__common_8h_a2d03918f4f9edabaf3c9f43abcc2d85b}{t});
143 
144    \textcolor{comment}{//Successful encryption}
145    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
146 \}
\end{DoxyCode}
