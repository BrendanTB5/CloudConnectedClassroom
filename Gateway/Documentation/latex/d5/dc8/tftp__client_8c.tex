\hypertarget{tftp__client_8c}{}\section{cyclone\+\_\+tcp/tftp/tftp\+\_\+client.c File Reference}
\label{tftp__client_8c}\index{cyclone\+\_\+tcp/tftp/tftp\+\_\+client.\+c@{cyclone\+\_\+tcp/tftp/tftp\+\_\+client.\+c}}


T\+F\+TP client.  


{\ttfamily \#include \char`\"{}tftp/tftp\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tftp/tftp\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tftp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ade296bfed5309e0f497d85905610d9a9}{T\+F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a9f45b19270f732a3be43378b96aacebb}{tftp\+Client\+Init} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em T\+F\+TP client initialization. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_afbed869ae5a53f04360e5e3acc38522e}{tftp\+Client\+Bind\+To\+Interface} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context, \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em Bind the T\+F\+TP client to a particular network interface. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a2c67411878d109e642c3ef33211d66dc}{tftp\+Client\+Connect} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$server\+Ip\+Addr, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} server\+Port)
\begin{DoxyCompactList}\small\item\em Specify the address of the T\+F\+TP server. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_ac32913f2f84fc4d81d39f8b715b7cfb5}{tftp\+Client\+Open\+File} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode})
\begin{DoxyCompactList}\small\item\em Open a file for reading or writing. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a16c81e5a63bf1e87442a0e7c318ec653}{tftp\+Client\+Write\+File} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Write data to the file. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a2d6e1fa1a398e420d528ea816a8eafc0}{tftp\+Client\+Flush\+File} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Flush pending write operations. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a254d822eaeef4f95a56d8c40c5e53f21}{tftp\+Client\+Read\+File} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Read data from the file. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__client_8c_a2d23b579ba262f182788c02b9b7db80b}{tftp\+Client\+Close\+File} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Close the file. \end{DoxyCompactList}\item 
void \hyperlink{tftp__client_8c_aa4d1e678f3850aa221a27a82db037e6c}{tftp\+Client\+Deinit} (\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Release T\+F\+TP client context. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
T\+F\+TP client. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
T\+F\+TP is a very simple protocol used to transfer files. Refer to the following R\+F\+Cs for complete details\+:
\begin{DoxyItemize}
\item R\+FC 1123\+: Requirements for Internet Hosts
\item R\+FC 1350\+: The T\+F\+TP Protocol (Revision 2)
\item R\+FC 1782\+: T\+F\+TP Option Extension
\item R\+FC 1783\+: T\+F\+TP Blocksize Option
\item R\+FC 1784\+: T\+F\+TP Timeout Interval and Transfer Size Options
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{tftp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{tftp__client_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ade296bfed5309e0f497d85905610d9a9}{T\+F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 42 of file tftp\+\_\+client.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{tftp__client_8c_afbed869ae5a53f04360e5e3acc38522e}\label{tftp__client_8c_afbed869ae5a53f04360e5e3acc38522e}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Bind\+To\+Interface@{tftp\+Client\+Bind\+To\+Interface}}
\index{tftp\+Client\+Bind\+To\+Interface@{tftp\+Client\+Bind\+To\+Interface}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Bind\+To\+Interface()}{tftpClientBindToInterface()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Bind\+To\+Interface (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



Bind the T\+F\+TP client to a particular network interface. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\mbox{\tt in}  & {\em interface} & Network interface to be used \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 83 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
85 \{
86    \textcolor{comment}{//Make sure the TFTP client context is valid}
87    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
88       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
89 
90    \textcolor{comment}{//Explicitly associate the TFTP client with the specified interface}
91    context->\hyperlink{structTftpClientContext_ad17a07e8c1bfd4a9abaf2dbc46c3049a}{interface} = interface;
92 
93    \textcolor{comment}{//Successful processing}
94    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
95 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a2d23b579ba262f182788c02b9b7db80b}\label{tftp__client_8c_a2d23b579ba262f182788c02b9b7db80b}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Close\+File@{tftp\+Client\+Close\+File}}
\index{tftp\+Client\+Close\+File@{tftp\+Client\+Close\+File}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Close\+File()}{tftpClientCloseFile()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Close\+File (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Close the file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 516 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
517 \{
518    \textcolor{comment}{//Make sure the TFTP client context is valid}
519    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
520       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
521 
522    \textcolor{comment}{//Close connection with the TFTP server}
523    \hyperlink{tftp__client__misc_8c_a31ed2140dbd936f36d4299df5bb4e24e}{tftpClientCloseConnection}(context);
524 
525    \textcolor{comment}{//Back to default state}
526    context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED};
527 
528    \textcolor{comment}{//Successful processing}
529    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
530 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a2c67411878d109e642c3ef33211d66dc}\label{tftp__client_8c_a2c67411878d109e642c3ef33211d66dc}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Connect@{tftp\+Client\+Connect}}
\index{tftp\+Client\+Connect@{tftp\+Client\+Connect}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Connect()}{tftpClientConnect()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Connect (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{server\+Ip\+Addr,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{server\+Port }\end{DoxyParamCaption})}



Specify the address of the T\+F\+TP server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\mbox{\tt in}  & {\em server\+Ip\+Addr} & IP address of the T\+F\+TP server to connect to \\
\hline
\mbox{\tt in}  & {\em server\+Port} & U\+DP port number \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 106 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
108 \{
109    \textcolor{comment}{//Check parameters}
110    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || serverIpAddr == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
111       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
112 
113    \textcolor{comment}{//Check current state}
114    \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} != \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED})
115       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac3190fa1f36c6acf147c7ce453a655e2}{ERROR\_WRONG\_STATE};
116 
117    \textcolor{comment}{//Save the IP address of the remote TFTP server}
118    context->\hyperlink{structTftpClientContext_a961c1849ca6750986224145f8b298001}{serverIpAddr} = *serverIpAddr;
119    \textcolor{comment}{//Save the UDP port number to be used}
120    context->\hyperlink{structTftpClientContext_a4fbd05c69003e22ea5703eabd89ab1c8}{serverPort} = serverPort;
121 
122    \textcolor{comment}{//Successful processing}
123    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
124 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_aa4d1e678f3850aa221a27a82db037e6c}\label{tftp__client_8c_aa4d1e678f3850aa221a27a82db037e6c}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Deinit@{tftp\+Client\+Deinit}}
\index{tftp\+Client\+Deinit@{tftp\+Client\+Deinit}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Deinit()}{tftpClientDeinit()}}
{\footnotesize\ttfamily void tftp\+Client\+Deinit (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Release T\+F\+TP client context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\end{DoxyParams}


Definition at line 538 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
539 \{
540    \textcolor{comment}{//Make sure the TFTP client context is valid}
541    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
542    \{
543       \textcolor{comment}{//Close connection with the TFTP server}
544       \hyperlink{tftp__client__misc_8c_a31ed2140dbd936f36d4299df5bb4e24e}{tftpClientCloseConnection}(context);
545 
546       \textcolor{comment}{//Clear TFTP client context}
547       memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTftpClientContext}{TftpClientContext}));
548    \}
549 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a2d6e1fa1a398e420d528ea816a8eafc0}\label{tftp__client_8c_a2d6e1fa1a398e420d528ea816a8eafc0}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Flush\+File@{tftp\+Client\+Flush\+File}}
\index{tftp\+Client\+Flush\+File@{tftp\+Client\+Flush\+File}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Flush\+File()}{tftpClientFlushFile()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Flush\+File (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Flush pending write operations. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 349 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
350 \{
351    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
352 
353    \textcolor{comment}{//Make sure the TFTP client context is valid}
354    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
355       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
356 
357    \textcolor{comment}{//Initialize status code}
358    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
359 
360    \textcolor{comment}{//Wait for the last DATA packet to be acknowledged}
361    \textcolor{keywordflow}{while}(!error)
362    \{
363       \textcolor{comment}{//Check current state}
364       \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a23af61a007f039e6f75290017d202432}{TFTP\_CLIENT\_STATE\_DATA})
365       \{
366          \textcolor{comment}{//Handle retransmissions}
367          error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
368       \}
369       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a97a847cea55dd8d3fab8a04739c1a433}{TFTP\_CLIENT\_STATE\_ACK})
370       \{
371          \textcolor{comment}{//The block number increases by one for each new block of data}
372          context->\hyperlink{structTftpClientContext_aa037821215c331f9c226c9c076951d3a}{block}++;
373 
374          \textcolor{comment}{//Send DATA packet}
375          \hyperlink{tftp__client__misc_8c_a1cac81f6fea8ca4c996eea9b798ab906}{tftpClientSendDataPacket}(context);
376 
377          \textcolor{comment}{//A data packet of less than 512 bytes signals termination}
378          \textcolor{comment}{//of the transfer}
379          context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a8effc0277fd10027ca691919b5fbfae5}{TFTP\_CLIENT\_STATE\_LAST\_DATA};
380       \}
381       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a8effc0277fd10027ca691919b5fbfae5}{TFTP\_CLIENT\_STATE\_LAST\_DATA})
382       \{
383          \textcolor{comment}{//Handle retransmissions}
384          error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
385       \}
386       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a0a3c7ba0d3e19e5bca9c208ed282c88c}{TFTP\_CLIENT\_STATE\_COMPLETE})
387       \{
388          \textcolor{comment}{//Normal termination of the transfer}
389          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
390          \textcolor{keywordflow}{break};
391       \}
392       \textcolor{keywordflow}{else}
393       \{
394          \textcolor{comment}{//Report an error}
395          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED};
396       \}
397    \}
398 
399    \textcolor{comment}{//Return status code}
400    \textcolor{keywordflow}{return} error;
401 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a9f45b19270f732a3be43378b96aacebb}\label{tftp__client_8c_a9f45b19270f732a3be43378b96aacebb}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Init@{tftp\+Client\+Init}}
\index{tftp\+Client\+Init@{tftp\+Client\+Init}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Init()}{tftpClientInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



T\+F\+TP client initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 59 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
60 \{
61    \textcolor{comment}{//Make sure the TFTP client context is valid}
62    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
63       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
64 
65    \textcolor{comment}{//Initialize context}
66    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{structTftpClientContext}{TftpClientContext}));
67 
68    \textcolor{comment}{//Initialize TFTP client state}
69    context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED};
70 
71    \textcolor{comment}{//Successful initialization}
72    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
73 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_ac32913f2f84fc4d81d39f8b715b7cfb5}\label{tftp__client_8c_ac32913f2f84fc4d81d39f8b715b7cfb5}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Open\+File@{tftp\+Client\+Open\+File}}
\index{tftp\+Client\+Open\+File@{tftp\+Client\+Open\+File}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Open\+File()}{tftpClientOpenFile()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Open\+File (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{filename,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{mode }\end{DoxyParamCaption})}



Open a file for reading or writing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\mbox{\tt in}  & {\em filename} & N\+U\+L\+L-\/terminated string specifying the filename \\
\hline
\mbox{\tt in}  & {\em mode} & File access mode \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 135 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
137 \{
138    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
139 
140    \textcolor{comment}{//Check parameters}
141    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
142       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
143 
144    \textcolor{comment}{//Initialize status code}
145    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
146 
147    \textcolor{comment}{//Read or write access?}
148    \textcolor{keywordflow}{if}(\hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode} & \hyperlink{tftp__client_8h_a94bc5c3f921542f11be6e64af6180246acb370072bae51c487c3614283eca7f41}{TFTP\_FILE\_MODE\_WRITE})
149    \{
150       \textcolor{comment}{//Wait for the WRQ request to be accepted}
151       \textcolor{keywordflow}{while}(!error)
152       \{
153          \textcolor{comment}{//Check current state}
154          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED})
155          \{
156             \textcolor{comment}{//Open connection with the remote TFTP server}
157             error = \hyperlink{tftp__client__misc_8c_a6fac7d316788383548c3235f970ad9a1}{tftpClientOpenConnection}(context);
158 
159             \textcolor{comment}{//Check status code}
160             \textcolor{keywordflow}{if}(!error)
161             \{
162                \textcolor{comment}{//Send WRQ packet}
163                \textcolor{keywordflow}{if}(\hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode} & \hyperlink{tftp__client_8h_a94bc5c3f921542f11be6e64af6180246a713a287694588265c8c4f7075c71fe94}{TFTP\_FILE\_MODE\_NETASCII})
164                   \hyperlink{tftp__client__misc_8c_a03b13f6c2498ea2c106ec5ec1ead798d}{tftpClientSendWrqPacket}(context, 
      \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, \textcolor{stringliteral}{"netascii"});
165                \textcolor{keywordflow}{else}
166                   \hyperlink{tftp__client__misc_8c_a03b13f6c2498ea2c106ec5ec1ead798d}{tftpClientSendWrqPacket}(context, 
      \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, \textcolor{stringliteral}{"octet"});
167 
168                \textcolor{comment}{//Initialize block number}
169                context->\hyperlink{structTftpClientContext_aa037821215c331f9c226c9c076951d3a}{block} = 0;
170                \textcolor{comment}{//The write request has been sent out}
171                context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174ac43016381082a997b4ebd34b0813372f}{TFTP\_CLIENT\_STATE\_WRQ};
172             \}
173          \}
174          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174ac43016381082a997b4ebd34b0813372f}{TFTP\_CLIENT\_STATE\_WRQ})
175          \{
176             \textcolor{comment}{//Wait for an ACK packet to be received}
177             error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
178          \}
179          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a97a847cea55dd8d3fab8a04739c1a433}{TFTP\_CLIENT\_STATE\_ACK})
180          \{
181             \textcolor{comment}{//The write request has been accepted}
182             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
183             \textcolor{comment}{//We are done}
184             \textcolor{keywordflow}{break};
185          \}
186          \textcolor{keywordflow}{else}
187          \{
188             \textcolor{comment}{//Close connection}
189             \hyperlink{tftp__client__misc_8c_a31ed2140dbd936f36d4299df5bb4e24e}{tftpClientCloseConnection}(context);
190             \textcolor{comment}{//Back to default state}
191             context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED};
192             \textcolor{comment}{//The write request has been rejected}
193             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
194          \}
195       \}
196    \}
197    \textcolor{keywordflow}{else}
198    \{
199       \textcolor{comment}{//Wait for the RRQ request to be accepted}
200       \textcolor{keywordflow}{while}(!error)
201       \{
202          \textcolor{comment}{//Check current state}
203          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED})
204          \{
205             \textcolor{comment}{//Open connection with the remote TFTP server}
206             error = \hyperlink{tftp__client__misc_8c_a6fac7d316788383548c3235f970ad9a1}{tftpClientOpenConnection}(context);
207 
208             \textcolor{comment}{//Check status code}
209             \textcolor{keywordflow}{if}(!error)
210             \{
211                \textcolor{comment}{//Send RRQ packet}
212                \textcolor{keywordflow}{if}(\hyperlink{ntp__common_8h_a37e90f5e3bd99fac2021fb3a326607d4}{mode} & \hyperlink{tftp__client_8h_a94bc5c3f921542f11be6e64af6180246a713a287694588265c8c4f7075c71fe94}{TFTP\_FILE\_MODE\_NETASCII})
213                   \hyperlink{tftp__client__misc_8c_adc5e022de95191ad8447a7643773fb8a}{tftpClientSendRrqPacket}(context, 
      \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, \textcolor{stringliteral}{"netascii"});
214                \textcolor{keywordflow}{else}
215                   \hyperlink{tftp__client__misc_8c_adc5e022de95191ad8447a7643773fb8a}{tftpClientSendRrqPacket}(context, 
      \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, \textcolor{stringliteral}{"octet"});
216 
217                \textcolor{comment}{//Initialize block number}
218                context->\hyperlink{structTftpClientContext_aa037821215c331f9c226c9c076951d3a}{block} = 1;
219                \textcolor{comment}{//The read request has been sent out}
220                context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a820100425cc81308389844e42a6634d4}{TFTP\_CLIENT\_STATE\_RRQ};
221             \}
222          \}
223          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a820100425cc81308389844e42a6634d4}{TFTP\_CLIENT\_STATE\_RRQ})
224          \{
225             \textcolor{comment}{//Wait for a DATA packet to be received}
226             error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
227          \}
228          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a23af61a007f039e6f75290017d202432}{TFTP\_CLIENT\_STATE\_DATA})
229          \{
230             \textcolor{comment}{//The read request has been accepted}
231             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
232             \textcolor{comment}{//We are done}
233             \textcolor{keywordflow}{break};
234          \}
235          \textcolor{keywordflow}{else}
236          \{
237             \textcolor{comment}{//Close connection}
238             \hyperlink{tftp__client__misc_8c_a31ed2140dbd936f36d4299df5bb4e24e}{tftpClientCloseConnection}(context);
239             \textcolor{comment}{//Back to default state}
240             context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a625143d22f6b1cf9ae6c7cf5538b1161}{TFTP\_CLIENT\_STATE\_CLOSED};
241             \textcolor{comment}{//The read request has been rejected}
242             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
243          \}
244       \}
245    \}
246 
247    \textcolor{comment}{//Return status code}
248    \textcolor{keywordflow}{return} error;
249 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a254d822eaeef4f95a56d8c40c5e53f21}\label{tftp__client_8c_a254d822eaeef4f95a56d8c40c5e53f21}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Read\+File@{tftp\+Client\+Read\+File}}
\index{tftp\+Client\+Read\+File@{tftp\+Client\+Read\+File}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Read\+File()}{tftpClientReadFile()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Read\+File (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Read data from the file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to the buffer where to copy the data \\
\hline
\mbox{\tt in}  & {\em size} & Size of the buffer, in bytes \\
\hline
\mbox{\tt out}  & {\em received} & Number of data bytes that have been read \\
\hline
\mbox{\tt in}  & {\em flags} & Reserved parameter \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 414 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
416 \{
417    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
418    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
419 
420    \textcolor{comment}{//Check parameters}
421    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || received == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
422       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
423 
424    \textcolor{comment}{//Initialize status code}
425    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
426 
427    \textcolor{comment}{//Total number of bytes that have been received}
428    *received = 0;
429 
430    \textcolor{comment}{//Read as much data as possible}
431    \textcolor{keywordflow}{while}(*received < size && !error)
432    \{
433       \textcolor{comment}{//Check current state}
434       \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a23af61a007f039e6f75290017d202432}{TFTP\_CLIENT\_STATE\_DATA})
435       \{
436          \textcolor{comment}{//Any data pending in the receive buffer?}
437          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_aad31a283211290004f2c304b4e33814c}{inDataPos} < context->\hyperlink{structTftpClientContext_a8d192f64cb73d6fa578e23c8171fee91}{inDataLen})
438          \{
439             \textcolor{comment}{//Compute the number of bytes available for reading}
440             n = context->\hyperlink{structTftpClientContext_a8d192f64cb73d6fa578e23c8171fee91}{inDataLen} - context->\hyperlink{structTftpClientContext_aad31a283211290004f2c304b4e33814c}{inDataPos};
441             \textcolor{comment}{//Limit the number of bytes to copy at a time}
442             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, size - *received);
443 
444             \textcolor{comment}{//Copy data from the receive buffer}
445             memcpy(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, context->\hyperlink{structTftpClientContext_a0eaff236dc4e0bd3455850e76f39a05d}{inPacket} + \textcolor{keyword}{sizeof}(\hyperlink{tftp__common_8h_a72db11cb5bc2afb6305fb3cb0f409eb5}{TftpDataPacket}) +
446                context->\hyperlink{structTftpClientContext_aad31a283211290004f2c304b4e33814c}{inDataPos}, n);
447 
448             \textcolor{comment}{//Advance data pointer}
449             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + n;
450             context->\hyperlink{structTftpClientContext_aad31a283211290004f2c304b4e33814c}{inDataPos} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
451 
452             \textcolor{comment}{//Total number of bytes that have been received}
453             *received += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
454          \}
455 
456          \textcolor{comment}{//Check whether the receive buffer is empty}
457          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_aad31a283211290004f2c304b4e33814c}{inDataPos} >= context->\hyperlink{structTftpClientContext_a8d192f64cb73d6fa578e23c8171fee91}{inDataLen})
458          \{
459             \textcolor{comment}{//Acknowledge the DATA packet}
460             \hyperlink{tftp__client__misc_8c_abf35e4f9e4eb845b30f43be092080ef3}{tftpClientSendAckPacket}(context);
461 
462             \textcolor{comment}{//Increment block number}
463             context->\hyperlink{structTftpClientContext_aa037821215c331f9c226c9c076951d3a}{block}++;
464 
465             \textcolor{comment}{//Check the length of the DATA packet}
466             \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a8d192f64cb73d6fa578e23c8171fee91}{inDataLen} < \hyperlink{tftp__client_8h_afee8b7e4ec17ab2b7db46911b721f700}{TFTP\_CLIENT\_BLOCK\_SIZE})
467             \{
468                \textcolor{comment}{//A data packet of less than 512 bytes signals termination}
469                \textcolor{comment}{//of the transfer}
470                context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a0a3c7ba0d3e19e5bca9c208ed282c88c}{TFTP\_CLIENT\_STATE\_COMPLETE};
471             \}
472             \textcolor{keywordflow}{else}
473             \{
474                \textcolor{comment}{//Wait for the next DATA packet to be received}
475                context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a97a847cea55dd8d3fab8a04739c1a433}{TFTP\_CLIENT\_STATE\_ACK};
476             \}
477          \}
478       \}
479       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a97a847cea55dd8d3fab8a04739c1a433}{TFTP\_CLIENT\_STATE\_ACK})
480       \{
481          \textcolor{comment}{//Handle retransmissions}
482          error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
483       \}
484       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a0a3c7ba0d3e19e5bca9c208ed282c88c}{TFTP\_CLIENT\_STATE\_COMPLETE})
485       \{
486          \textcolor{comment}{//The user must be satisfied with data already on hand}
487          \textcolor{keywordflow}{if}(*received > 0)
488          \{
489             \textcolor{comment}{//Some data are pending in the receive buffer}
490             \textcolor{keywordflow}{break};
491          \}
492          \textcolor{keywordflow}{else}
493          \{
494             \textcolor{comment}{//Normal termination of the transfer}
495             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca8b7223773301a4f3dd811f1d35e13ce4}{ERROR\_END\_OF\_STREAM};
496          \}
497       \}
498       \textcolor{keywordflow}{else}
499       \{
500          \textcolor{comment}{//Report an error}
501          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacf545b4d693b270f9d01d54d86efedc2}{ERROR\_READ\_FAILED};
502       \}
503    \}
504 
505    \textcolor{comment}{//Return status code}
506    \textcolor{keywordflow}{return} error;
507 \}
\end{DoxyCode}
\mbox{\Hypertarget{tftp__client_8c_a16c81e5a63bf1e87442a0e7c318ec653}\label{tftp__client_8c_a16c81e5a63bf1e87442a0e7c318ec653}} 
\index{tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}!tftp\+Client\+Write\+File@{tftp\+Client\+Write\+File}}
\index{tftp\+Client\+Write\+File@{tftp\+Client\+Write\+File}!tftp\+\_\+client.\+c@{tftp\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{tftp\+Client\+Write\+File()}{tftpClientWriteFile()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tftp\+Client\+Write\+File (\begin{DoxyParamCaption}\item[{\hyperlink{structTftpClientContext}{Tftp\+Client\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Write data to the file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+F\+TP client context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be written \\
\hline
\mbox{\tt in}  & {\em length} & Number of data bytes to write \\
\hline
\mbox{\tt in}  & {\em written} & Number of bytes that have been written \\
\hline
\mbox{\tt in}  & {\em flags} & Reserved parameter \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 262 of file tftp\+\_\+client.\+c.


\begin{DoxyCode}
264 \{
265    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
266    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
267    \textcolor{keywordtype}{size\_t} totalLength;
268 
269    \textcolor{comment}{//Make sure the TFTP client context is valid}
270    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
271       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
272 
273    \textcolor{comment}{//Check parameters}
274    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
275       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
276 
277    \textcolor{comment}{//Initialize status code}
278    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
279 
280    \textcolor{comment}{//Actual number of bytes written}
281    totalLength = 0;
282 
283    \textcolor{comment}{//Write as much data as possible}
284    \textcolor{keywordflow}{while}(totalLength < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} && !error)
285    \{
286       \textcolor{comment}{//Check current state}
287       \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a23af61a007f039e6f75290017d202432}{TFTP\_CLIENT\_STATE\_DATA})
288       \{
289          \textcolor{comment}{//Handle retransmissions}
290          error = \hyperlink{tftp__client__misc_8c_ac34a8f159fc0bd86e8a3b960dfdebe86}{tftpClientProcessEvents}(context);
291       \}
292       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} == \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a97a847cea55dd8d3fab8a04739c1a433}{TFTP\_CLIENT\_STATE\_ACK})
293       \{
294          \textcolor{comment}{//Send buffer available for writing?}
295          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a60ec196ee362181351a438d39116b572}{outDataLen} < \hyperlink{tftp__client_8h_afee8b7e4ec17ab2b7db46911b721f700}{TFTP\_CLIENT\_BLOCK\_SIZE})
296          \{
297             \textcolor{comment}{//Compute the number of bytes available}
298             n = \hyperlink{tftp__client_8h_afee8b7e4ec17ab2b7db46911b721f700}{TFTP\_CLIENT\_BLOCK\_SIZE} - context->
      \hyperlink{structTftpClientContext_a60ec196ee362181351a438d39116b572}{outDataLen};
299             \textcolor{comment}{//Limit the number of bytes to copy at a time}
300             n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - totalLength);
301 
302             \textcolor{comment}{//Copy data to the send buffer}
303             memcpy(context->\hyperlink{structTftpClientContext_ad79208d8abaf2c5e951c01f072b5c6e6}{outPacket} + \textcolor{keyword}{sizeof}(\hyperlink{tftp__common_8h_a72db11cb5bc2afb6305fb3cb0f409eb5}{TftpDataPacket}) +
304                context->\hyperlink{structTftpClientContext_a60ec196ee362181351a438d39116b572}{outDataLen}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, n);
305 
306             \textcolor{comment}{//Advance data pointer}
307             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + n;
308             context->\hyperlink{structTftpClientContext_a60ec196ee362181351a438d39116b572}{outDataLen} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
309 
310             \textcolor{comment}{//Total number of bytes that have been written}
311             totalLength += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
312          \}
313 
314          \textcolor{comment}{//Check whether the send buffer is full}
315          \textcolor{keywordflow}{if}(context->\hyperlink{structTftpClientContext_a60ec196ee362181351a438d39116b572}{outDataLen} >= \hyperlink{tftp__client_8h_afee8b7e4ec17ab2b7db46911b721f700}{TFTP\_CLIENT\_BLOCK\_SIZE})
316          \{
317             \textcolor{comment}{//The block number increases by one for each new block of data}
318             context->\hyperlink{structTftpClientContext_aa037821215c331f9c226c9c076951d3a}{block}++;
319 
320             \textcolor{comment}{//Send DATA packet}
321             \hyperlink{tftp__client__misc_8c_a1cac81f6fea8ca4c996eea9b798ab906}{tftpClientSendDataPacket}(context);
322 
323             \textcolor{comment}{//Wait for the DATA packet to be acknowledged}
324             context->\hyperlink{structTftpClientContext_a5458f1f0af1bf1962312b07d364c9d09}{state} = \hyperlink{tftp__client_8h_a309912fa47abe84e19aafb1f1a9e8174a23af61a007f039e6f75290017d202432}{TFTP\_CLIENT\_STATE\_DATA};
325          \}
326       \}
327       \textcolor{keywordflow}{else}
328       \{
329          \textcolor{comment}{//Report an error}
330          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED};
331       \}
332    \}
333 
334    \textcolor{comment}{//Total number of bytes successfully written}
335    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
336       *written = totalLength;
337 
338    \textcolor{comment}{//Return status code}
339    \textcolor{keywordflow}{return} error;
340 \}
\end{DoxyCode}
