\hypertarget{mdns__responder_8c}{}\section{cyclone\+\_\+tcp/mdns/mdns\+\_\+responder.c File Reference}
\label{mdns__responder_8c}\index{cyclone\+\_\+tcp/mdns/mdns\+\_\+responder.\+c@{cyclone\+\_\+tcp/mdns/mdns\+\_\+responder.\+c}}


m\+D\+NS responder (Multicast D\+NS)  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mdns/mdns\+\_\+responder.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mdns/mdns\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dns/dns\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dns\+\_\+sd/dns\+\_\+sd.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{mdns__responder_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a74effafe17f1f16be7e255212b556b54}{M\+D\+N\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{mdns__responder_8c_a40bba4dae706883dd890019d297865b0}{mdns\+Responder\+Get\+Default\+Settings} (\hyperlink{structMdnsResponderSettings}{Mdns\+Responder\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em Initialize settings with default values. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a04960b55c0a62aa10c90794a9f46629b}{mdns\+Responder\+Init} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context, const \hyperlink{structMdnsResponderSettings}{Mdns\+Responder\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em m\+D\+NS responder initialization \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a5950dabe2e7f4d9c439026d529e353f8}{mdns\+Responder\+Start} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Start m\+D\+NS responder. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_adfe40f35242ae26430bbb53b3e0b8378}{mdns\+Responder\+Stop} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Stop m\+D\+NS responder. \end{DoxyCompactList}\item 
\hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3}{Mdns\+State} \hyperlink{mdns__responder_8c_a3910870b4cfecaa20da6535bc14465c5}{mdns\+Responder\+Get\+State} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Retrieve current state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_afa9ff99deaa1f44603d79cf3226c2a7a}{mdns\+Responder\+Set\+Hostname} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{tls_8h_a7126f716c1f4f6978233fe47eb83d2a9}{hostname})
\begin{DoxyCompactList}\small\item\em Set hostname. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a460aaaa48ccde8752f2b02f7a35a1fde}{mdns\+Responder\+Set\+Ipv4\+Reverse\+Name} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate domain name for reverse D\+NS lookup (I\+Pv4) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a627c95ee7f8bc371d5692ac8b0790219}{mdns\+Responder\+Set\+Ipv6\+Reverse\+Name} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate domain name for reverse D\+NS lookup (I\+Pv6) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_ad0aa26e45ce7db6737cb978d4fedea0a}{mdns\+Responder\+Start\+Probing} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Restart probing process. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_a54a08294cdc64f15a41da79a319f6ed5}{mdns\+Responder\+Tick} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em m\+D\+NS responder timer handler \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_aeaff2b8b254457a219a8d19484d94227}{mdns\+Responder\+Link\+Change\+Event} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Callback function for link change event. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdns\+Responder\+Change\+State} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context, \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3}{Mdns\+State} new\+State, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} delay)
\begin{DoxyCompactList}\small\item\em Update F\+SM state. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_a1a8143eafc48f426d554efd9c8841c17}{mdns\+Responder\+Change\+Hostname} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Programmatically change the host name. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_af0353544650bba929c9bbcba3e6b12ee}{mdns\+Responder\+Send\+Probe} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send probe packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a7ae84cb7fe81e99cc89d2cb818826e8e}{mdns\+Responder\+Send\+Announcement} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send announcement packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_aff6e6f4101f0dab8b6a12177c3b79b78}{mdns\+Responder\+Send\+Goodbye} (\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Send goodbye packet. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_a13e701e7094bd3b41bddb0761d5088aa}{mdns\+Responder\+Process\+Query} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$query)
\begin{DoxyCompactList}\small\item\em Process m\+D\+NS query message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_af6209f4b4506659fb5533430b4fce600}{mdns\+Responder\+Parse\+Question} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$query, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, const \hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{Dns\+Question} $\ast$question, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Parse a question. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_afa3cc719b26b1d47ff57da7189f70f32}{mdns\+Responder\+Parse\+Known\+An\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$query, size\+\_\+t query\+Offset, const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$query\+Record, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Parse a resource record from the Known-\/\+Answer Section. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_a4a7956545a437d789872cee46f1773aa}{mdns\+Responder\+Parse\+Ns\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$query, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$record)
\begin{DoxyCompactList}\small\item\em Parse a resource record from the Authority Section. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_a2410b64ea776775499df0053050399c2}{mdns\+Responder\+Parse\+An\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$response, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$record)
\begin{DoxyCompactList}\small\item\em Parse a resource record from the Answer Section. \end{DoxyCompactList}\item 
void \hyperlink{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}{mdns\+Responder\+Generate\+Additional\+Records} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$response, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} legacy\+Unicast)
\begin{DoxyCompactList}\small\item\em Additional record generation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdns\+Responder\+Add\+Ipv4\+Addr\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} cache\+Flush, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl})
\begin{DoxyCompactList}\small\item\em Add A record to a m\+D\+NS message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdns\+Responder\+Add\+Ipv6\+Addr\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} cache\+Flush, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl})
\begin{DoxyCompactList}\small\item\em Add A\+A\+AA record to a m\+D\+NS message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}{mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} cache\+Flush, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl})
\begin{DoxyCompactList}\small\item\em Add reverse address mapping P\+TR record (I\+Pv4) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}{mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} cache\+Flush, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl})
\begin{DoxyCompactList}\small\item\em Add reverse address mapping P\+TR record (I\+Pv6) \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdns\+Responder\+Add\+Nsec\+Record} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} cache\+Flush, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl})
\begin{DoxyCompactList}\small\item\em Add N\+S\+EC record to a m\+D\+NS message. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} \hyperlink{mdns__responder_8c_a1b24a54d278d510b4af4eea8b2f44855}{mdns\+Responder\+Tick\+Counter}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
m\+D\+NS responder (Multicast D\+NS) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{mdns__responder_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{mdns__responder_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a74effafe17f1f16be7e255212b556b54}{M\+D\+N\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file mdns\+\_\+responder.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}\label{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Add\+Ipv4\+Addr\+Record@{mdns\+Responder\+Add\+Ipv4\+Addr\+Record}}
\index{mdns\+Responder\+Add\+Ipv4\+Addr\+Record@{mdns\+Responder\+Add\+Ipv4\+Addr\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Add\+Ipv4\+Addr\+Record()}{mdnsResponderAddIpv4AddrRecord()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Add\+Ipv4\+Addr\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{cache\+Flush,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{ttl }\end{DoxyParamCaption})}



Add A record to a m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em cache\+Flush} & Cache-\/flush bit \\
\hline
\mbox{\tt in}  & {\em ttl} & Resource record T\+TL (cache lifetime) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1886 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1888 \{
1889 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1890    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1891    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1892    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
1893    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1894    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
1895 
1896    \textcolor{comment}{//Point to the mDNS responder context}
1897    context = interface->mdnsResponderContext;
1898 
1899    \textcolor{comment}{//Valid IPv4 host address?}
1900    \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state == \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
1901    \{
1902       \textcolor{comment}{//Check whether the resource record is already present in the Answer}
1903       \textcolor{comment}{//Section of the message}
1904       duplicate = \hyperlink{mdns__common_8c_afaea9bc4752331623276122fd01f6d51}{mdnsCheckDuplicateRecord}(message, context->hostname,
1905          \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A});
1906 
1907       \textcolor{comment}{//The duplicates should be suppressed and the resource record should}
1908       \textcolor{comment}{//appear only once in the list}
1909       \textcolor{keywordflow}{if}(!duplicate)
1910       \{
1911          \textcolor{comment}{//Set the position to the end of the buffer}
1912          offset = message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length};
1913 
1914          \textcolor{comment}{//The first pass calculates the length of the DNS encoded host name}
1915          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1916 
1917          \textcolor{comment}{//Check the length of the resulting mDNS message}
1918          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
1919             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
1920 
1921          \textcolor{comment}{//The second pass encodes the host name using the DNS name notation}
1922          offset += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"},
1923             (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + offset);
1924 
1925          \textcolor{comment}{//Consider the length of the resource record itself}
1926          n = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord}) + \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
1927 
1928          \textcolor{comment}{//Check the length of the resulting mDNS message}
1929          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
1930             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
1931 
1932          \textcolor{comment}{//Point to the corresponding resource record}
1933          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, offset);
1934 
1935          \textcolor{comment}{//Fill in resource record}
1936          record->rtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A});
1937          record->rclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
1938          record->ttl = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(\hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl});
1939          record->rdlength = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}));
1940 
1941          \textcolor{comment}{//Check whether the cache-flush bit should be set}
1942          \textcolor{keywordflow}{if}(cacheFlush)
1943             record->rclass |= \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH});
1944 
1945          \textcolor{comment}{//Copy IPv4 address}
1946          \hyperlink{ipv4_8h_a36a3af47ec7eec9b1781964eb0494b6f}{ipv4CopyAddr}(record->rdata, &interface->ipv4Context.addrList[0].addr);
1947 
1948          \textcolor{comment}{//Number of resource records in the answer section}
1949          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount++;
1950          \textcolor{comment}{//Update the length of the mDNS response message}
1951          message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = offset + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1952       \}
1953    \}
1954 \textcolor{preprocessor}{#endif}
1955 
1956    \textcolor{comment}{//Successful processing}
1957    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1958 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}\label{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record@{mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record}}
\index{mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record@{mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record()}{mdnsResponderAddIpv4ReversePtrRecord()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Add\+Ipv4\+Reverse\+Ptr\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{cache\+Flush,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{ttl }\end{DoxyParamCaption})}



Add reverse address mapping P\+TR record (I\+Pv4) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em cache\+Flush} & Cache-\/flush bit \\
\hline
\mbox{\tt in}  & {\em ttl} & Resource record T\+TL (cache lifetime) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2054 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
2056 \{
2057 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
2058    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2059    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
2060    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
2061    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
2062    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
2063 
2064    \textcolor{comment}{//Point to the mDNS responder context}
2065    context = interface->mdnsResponderContext;
2066 
2067    \textcolor{comment}{//Valid reverse name?}
2068    \textcolor{keywordflow}{if}(context->ipv4ReverseName[0] != \textcolor{charliteral}{'\(\backslash\)0'})
2069    \{
2070       \textcolor{comment}{//Check whether the resource record is already present in the Answer}
2071       \textcolor{comment}{//Section of the message}
2072       duplicate = \hyperlink{mdns__common_8c_afaea9bc4752331623276122fd01f6d51}{mdnsCheckDuplicateRecord}(message, context->ipv4ReverseName,
2073          \textcolor{stringliteral}{"in-addr"}, \textcolor{stringliteral}{".arpa"}, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR});
2074 
2075       \textcolor{comment}{//The duplicates should be suppressed and the resource record should}
2076       \textcolor{comment}{//appear only once in the list}
2077       \textcolor{keywordflow}{if}(!duplicate)
2078       \{
2079          \textcolor{comment}{//Set the position to the end of the buffer}
2080          offset = message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length};
2081 
2082          \textcolor{comment}{//The first pass calculates the length of the DNS encoded reverse name}
2083          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->ipv4ReverseName, \textcolor{stringliteral}{"in-addr"}, \textcolor{stringliteral}{".arpa"}, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2084 
2085          \textcolor{comment}{//Check the length of the resulting mDNS message}
2086          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2087             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2088 
2089          \textcolor{comment}{//The second pass encodes the reverse name using the DNS name notation}
2090          offset += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->ipv4ReverseName, \textcolor{stringliteral}{"in-addr"}, \textcolor{stringliteral}{".arpa"},
2091             (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + offset);
2092 
2093          \textcolor{comment}{//Consider the length of the resource record itself}
2094          n = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord}) + \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
2095 
2096          \textcolor{comment}{//Check the length of the resulting mDNS message}
2097          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2098             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2099 
2100          \textcolor{comment}{//Point to the corresponding resource record}
2101          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, offset);
2102 
2103          \textcolor{comment}{//Fill in resource record}
2104          record->rtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR});
2105          record->rclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
2106          record->ttl = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(\hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl});
2107 
2108          \textcolor{comment}{//Check whether the cache-flush bit should be set}
2109          \textcolor{keywordflow}{if}(cacheFlush)
2110             record->rclass |= \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH});
2111 
2112          \textcolor{comment}{//Advance write index}
2113          offset += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
2114 
2115          \textcolor{comment}{//The first pass calculates the length of the DNS encoded host name}
2116          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(\textcolor{stringliteral}{""}, context->hostname, \textcolor{stringliteral}{".local"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2117 
2118          \textcolor{comment}{//Check the length of the resulting mDNS message}
2119          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2120             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2121 
2122          \textcolor{comment}{//The second pass encodes the host name using DNS notation}
2123          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(\textcolor{stringliteral}{""}, context->hostname, \textcolor{stringliteral}{".local"}, record->rdata);
2124 
2125          \textcolor{comment}{//Convert length field to network byte order}
2126          record->rdlength = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
2127 
2128          \textcolor{comment}{//Number of resource records in the answer section}
2129          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount++;
2130          \textcolor{comment}{//Update the length of the mDNS response message}
2131          message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = offset + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2132       \}
2133    \}
2134 \textcolor{preprocessor}{#endif}
2135 
2136    \textcolor{comment}{//Successful processing}
2137    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2138 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}\label{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Add\+Ipv6\+Addr\+Record@{mdns\+Responder\+Add\+Ipv6\+Addr\+Record}}
\index{mdns\+Responder\+Add\+Ipv6\+Addr\+Record@{mdns\+Responder\+Add\+Ipv6\+Addr\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Add\+Ipv6\+Addr\+Record()}{mdnsResponderAddIpv6AddrRecord()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Add\+Ipv6\+Addr\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{cache\+Flush,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{ttl }\end{DoxyParamCaption})}



Add A\+A\+AA record to a m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em cache\+Flush} & Cache-\/flush bit \\
\hline
\mbox{\tt in}  & {\em ttl} & Resource record T\+TL (cache lifetime) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1970 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1972 \{
1973 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1974    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1975    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1976    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
1977    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1978    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
1979 
1980    \textcolor{comment}{//Point to the mDNS responder context}
1981    context = interface->mdnsResponderContext;
1982 
1983    \textcolor{comment}{//Valid IPv6 link-local address?}
1984    \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
1985    \{
1986       \textcolor{comment}{//Check whether the resource record is already present in the Answer}
1987       \textcolor{comment}{//Section of the message}
1988       duplicate = \hyperlink{mdns__common_8c_afaea9bc4752331623276122fd01f6d51}{mdnsCheckDuplicateRecord}(message, context->hostname,
1989          \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA});
1990 
1991       \textcolor{comment}{//The duplicates should be suppressed and the resource record should}
1992       \textcolor{comment}{//appear only once in the list}
1993       \textcolor{keywordflow}{if}(!duplicate)
1994       \{
1995          \textcolor{comment}{//Set the position to the end of the buffer}
1996          offset = message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length};
1997 
1998          \textcolor{comment}{//The first pass calculates the length of the DNS encoded host name}
1999          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2000 
2001          \textcolor{comment}{//Check the length of the resulting mDNS message}
2002          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2003             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2004 
2005          \textcolor{comment}{//The second pass encodes the host name using the DNS name notation}
2006          offset += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"},
2007             (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + offset);
2008 
2009          \textcolor{comment}{//Consider the length of the resource record itself}
2010          n = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord}) + \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
2011 
2012          \textcolor{comment}{//Check the length of the resulting mDNS message}
2013          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2014             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2015 
2016          \textcolor{comment}{//Point to the corresponding resource record}
2017          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, offset);
2018 
2019          \textcolor{comment}{//Fill in resource record}
2020          record->rtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA});
2021          record->rclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
2022          record->ttl = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(\hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl});
2023          record->rdlength = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr}));
2024 
2025          \textcolor{comment}{//Check whether the cache-flush bit should be set}
2026          \textcolor{keywordflow}{if}(cacheFlush)
2027             record->rclass |= \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH});
2028 
2029          \textcolor{comment}{//Copy IPv6 address}
2030          \hyperlink{ipv6_8h_ac22b1fcd381d1c288e269cb8d164bfec}{ipv6CopyAddr}(record->rdata, &interface->ipv6Context.addrList[0].addr);
2031 
2032          \textcolor{comment}{//Number of resource records in the answer section}
2033          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount++;
2034          \textcolor{comment}{//Update the length of the mDNS response message}
2035          message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = offset + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2036       \}
2037    \}
2038 \textcolor{preprocessor}{#endif}
2039 
2040    \textcolor{comment}{//Successful processing}
2041    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2042 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}\label{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record@{mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record}}
\index{mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record@{mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record()}{mdnsResponderAddIpv6ReversePtrRecord()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Add\+Ipv6\+Reverse\+Ptr\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{cache\+Flush,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{ttl }\end{DoxyParamCaption})}



Add reverse address mapping P\+TR record (I\+Pv6) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em cache\+Flush} & Cache-\/flush bit \\
\hline
\mbox{\tt in}  & {\em ttl} & Resource record T\+TL (cache lifetime) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2150 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
2152 \{
2153 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
2154    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2155    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
2156    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
2157    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
2158    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
2159 
2160    \textcolor{comment}{//Point to the mDNS responder context}
2161    context = interface->mdnsResponderContext;
2162 
2163    \textcolor{comment}{//Valid reverse name?}
2164    \textcolor{keywordflow}{if}(context->ipv6ReverseName[0] != \textcolor{charliteral}{'\(\backslash\)0'})
2165    \{
2166       \textcolor{comment}{//Check whether the resource record is already present in the Answer}
2167       \textcolor{comment}{//Section of the message}
2168       duplicate = \hyperlink{mdns__common_8c_afaea9bc4752331623276122fd01f6d51}{mdnsCheckDuplicateRecord}(message, context->ipv6ReverseName,
2169          \textcolor{stringliteral}{"ip6"}, \textcolor{stringliteral}{".arpa"}, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR});
2170 
2171       \textcolor{comment}{//The duplicates should be suppressed and the resource record should}
2172       \textcolor{comment}{//appear only once in the list}
2173       \textcolor{keywordflow}{if}(!duplicate)
2174       \{
2175          \textcolor{comment}{//Set the position to the end of the buffer}
2176          offset = message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length};
2177 
2178          \textcolor{comment}{//The first pass calculates the length of the DNS encoded reverse name}
2179          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->ipv6ReverseName, \textcolor{stringliteral}{"ip6"}, \textcolor{stringliteral}{".arpa"}, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2180 
2181          \textcolor{comment}{//Check the length of the resulting mDNS message}
2182          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2183             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2184 
2185          \textcolor{comment}{//The second pass encodes the reverse name using the DNS name notation}
2186          offset += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->ipv6ReverseName, \textcolor{stringliteral}{"ip6"}, \textcolor{stringliteral}{".arpa"},
2187             (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + offset);
2188 
2189          \textcolor{comment}{//Consider the length of the resource record itself}
2190          n = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord}) + \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
2191 
2192          \textcolor{comment}{//Check the length of the resulting mDNS message}
2193          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2194             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2195 
2196          \textcolor{comment}{//Point to the corresponding resource record}
2197          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, offset);
2198 
2199          \textcolor{comment}{//Fill in resource record}
2200          record->rtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR});
2201          record->rclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
2202          record->ttl = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(\hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl});
2203 
2204          \textcolor{comment}{//Check whether the cache-flush bit should be set}
2205          \textcolor{keywordflow}{if}(cacheFlush)
2206             record->rclass |= \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH});
2207 
2208          \textcolor{comment}{//Advance write index}
2209          offset += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
2210 
2211          \textcolor{comment}{//The first pass calculates the length of the DNS encoded host name}
2212          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(\textcolor{stringliteral}{""}, context->hostname, \textcolor{stringliteral}{".local"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2213 
2214          \textcolor{comment}{//Check the length of the resulting mDNS message}
2215          \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2216             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2217 
2218          \textcolor{comment}{//The second pass encodes the host name using DNS notation}
2219          n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(\textcolor{stringliteral}{""}, context->hostname, \textcolor{stringliteral}{".local"}, record->rdata);
2220 
2221          \textcolor{comment}{//Convert length field to network byte order}
2222          record->rdlength = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
2223 
2224          \textcolor{comment}{//Number of resource records in the answer section}
2225          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount++;
2226          \textcolor{comment}{//Update the length of the mDNS response message}
2227          message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = offset + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2228       \}
2229    \}
2230 \textcolor{preprocessor}{#endif}
2231 
2232    \textcolor{comment}{//Successful processing}
2233    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2234 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}\label{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Add\+Nsec\+Record@{mdns\+Responder\+Add\+Nsec\+Record}}
\index{mdns\+Responder\+Add\+Nsec\+Record@{mdns\+Responder\+Add\+Nsec\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Add\+Nsec\+Record()}{mdnsResponderAddNsecRecord()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Add\+Nsec\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{cache\+Flush,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{ttl }\end{DoxyParamCaption})}



Add N\+S\+EC record to a m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em cache\+Flush} & Cache-\/flush bit \\
\hline
\mbox{\tt in}  & {\em ttl} & Resource record T\+TL (cache lifetime) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2246 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
2248 \{
2249    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
2250    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
2251    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
2252    \textcolor{keywordtype}{size\_t} bitmapLength;
2253    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} bitmap[8];
2254    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
2255    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
2256 
2257    \textcolor{comment}{//Point to the mDNS responder context}
2258    context = interface->mdnsResponderContext;
2259 
2260    \textcolor{comment}{//Check whether the resource record is already present in the Answer}
2261    \textcolor{comment}{//Section of the message}
2262    duplicate = \hyperlink{mdns__common_8c_afaea9bc4752331623276122fd01f6d51}{mdnsCheckDuplicateRecord}(message, context->hostname,
2263       \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1ae9c0d287d3e1c67403e2dc01928f6e43}{DNS\_RR\_TYPE\_NSEC});
2264 
2265    \textcolor{comment}{//The duplicates should be suppressed and the resource record should}
2266    \textcolor{comment}{//appear only once in the list}
2267    \textcolor{keywordflow}{if}(!duplicate)
2268    \{
2269       \textcolor{comment}{//The bitmap identifies the resource record types that exist}
2270       memset(bitmap, 0, \textcolor{keyword}{sizeof}(bitmap));
2271 
2272 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
2273       \textcolor{comment}{//A resource record is supported}
2274       \hyperlink{dns__common_8h_a13c81542d759522739062dd3e21fff20}{DNS\_SET\_NSEC\_BITMAP}(bitmap, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A});
2275 \textcolor{preprocessor}{#endif}
2276 
2277 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
2278       \textcolor{comment}{//A resource record is supported}
2279       \hyperlink{dns__common_8h_a13c81542d759522739062dd3e21fff20}{DNS\_SET\_NSEC\_BITMAP}(bitmap, \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA});
2280 \textcolor{preprocessor}{#endif}
2281 
2282       \textcolor{comment}{//Compute the length of the bitmap}
2283       \textcolor{keywordflow}{for}(bitmapLength = \textcolor{keyword}{sizeof}(bitmap); bitmapLength > 0; bitmapLength--)
2284       \{
2285          \textcolor{comment}{//Trailing zero octets in the bitmap must be omitted...}
2286          \textcolor{keywordflow}{if}(bitmap[bitmapLength - 1] != 0x00)
2287             \textcolor{keywordflow}{break};
2288       \}
2289 
2290       \textcolor{comment}{//Set the position to the end of the buffer}
2291       offset = message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length};
2292 
2293       \textcolor{comment}{//The first pass calculates the length of the DNS encoded host name}
2294       n = \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
2295 
2296       \textcolor{comment}{//Check the length of the resulting mDNS message}
2297       \textcolor{keywordflow}{if}((offset + n) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2298          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2299 
2300       \textcolor{comment}{//The second pass encodes the host name using the DNS name notation}
2301       offset += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"},
2302          (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + offset);
2303 
2304       \textcolor{comment}{//Consider the length of the resource record itself}
2305       \textcolor{keywordflow}{if}((offset + \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord})) > 
      \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2306          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2307 
2308       \textcolor{comment}{//Point to the corresponding resource record}
2309       record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, offset);
2310 
2311       \textcolor{comment}{//Fill in resource record}
2312       record->rtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1ae9c0d287d3e1c67403e2dc01928f6e43}{DNS\_RR\_TYPE\_NSEC});
2313       record->rclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
2314       record->ttl = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(\hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl});
2315 
2316       \textcolor{comment}{//Check whether the cache-flush bit should be set}
2317       \textcolor{keywordflow}{if}(cacheFlush)
2318          record->rclass |= \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH});
2319 
2320       \textcolor{comment}{//Advance write index}
2321       offset += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
2322 
2323       \textcolor{comment}{//Check the length of the resulting mDNS message}
2324       \textcolor{keywordflow}{if}((offset + n + 2 + bitmapLength) > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
2325          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
2326 
2327       \textcolor{comment}{//The Next Domain Name field contains the record's own name}
2328       \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, record->rdata);
2329 
2330       \textcolor{comment}{//DNS NSEC record is limited to Window Block number zero}
2331       record->rdata[n++] = 0;
2332       \textcolor{comment}{//The Bitmap Length is a value in the range 1-32}
2333       record->rdata[n++] = bitmapLength;
2334 
2335       \textcolor{comment}{//The Bitmap data identifies the resource record types that exist}
2336       memcpy(record->rdata + n, bitmap, bitmapLength);
2337 
2338       \textcolor{comment}{//Convert length field to network byte order}
2339       record->rdlength = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n + bitmapLength);
2340 
2341       \textcolor{comment}{//Number of resource records in the answer section}
2342       message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount++;
2343       \textcolor{comment}{//Update the length of the DNS message}
2344       message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = offset + n + bitmapLength;
2345    \}
2346 
2347    \textcolor{comment}{//Successful processing}
2348    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2349 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a1a8143eafc48f426d554efd9c8841c17}\label{mdns__responder_8c_a1a8143eafc48f426d554efd9c8841c17}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Change\+Hostname@{mdns\+Responder\+Change\+Hostname}}
\index{mdns\+Responder\+Change\+Hostname@{mdns\+Responder\+Change\+Hostname}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Change\+Hostname()}{mdnsResponderChangeHostname()}}
{\footnotesize\ttfamily void mdns\+Responder\+Change\+Hostname (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Programmatically change the host name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}


Definition at line 715 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
716 \{
717    \textcolor{keywordtype}{size\_t} i;
718    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
719    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
720    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} index;
721    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} \hyperlink{md2_8c_adf356ff381033f761b7de5f76e763a45}{s}[16];
722 
723    \textcolor{comment}{//Retrieve the length of the string}
724    n = strlen(context->hostname);
725 
726    \textcolor{comment}{//Parse the string backwards}
727    \textcolor{keywordflow}{for}(i = n; i > 0; i--)
728    \{
729       \textcolor{comment}{//Check whether the current character is a digit}
730       \textcolor{keywordflow}{if}(!isdigit((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) context->hostname[i - 1]))
731          \textcolor{keywordflow}{break};
732    \}
733 
734    \textcolor{comment}{//Any number following the host name?}
735    \textcolor{keywordflow}{if}(context->hostname[i] != \textcolor{charliteral}{'\(\backslash\)0'})
736    \{
737       \textcolor{comment}{//Retrieve the number at the end of the name}
738       index = atoi(context->hostname + i);
739       \textcolor{comment}{//Increment the value}
740       index++;
741 
742       \textcolor{comment}{//Strip the digits}
743       context->hostname[i] = \textcolor{charliteral}{'\(\backslash\)0'};
744    \}
745    \textcolor{keywordflow}{else}
746    \{
747       \textcolor{comment}{//Append the digit "2" to the name}
748       index = 2;
749    \}
750 
751    \textcolor{comment}{//Convert the number to a string of characters}
752    m = sprintf(s, \textcolor{stringliteral}{"%"} PRIu32, index);
753 
754    \textcolor{comment}{//Sanity check}
755    \textcolor{keywordflow}{if}((i + m) <= \hyperlink{net_8h_a3f9223c8ef61451fec92d5354c93b34f}{NET\_MAX\_HOSTNAME\_LEN})
756    \{
757       \textcolor{comment}{//Add padding if necessary}
758       \textcolor{keywordflow}{while}((i + m) < n)
759          context->hostname[i++] = \textcolor{charliteral}{'0'};
760 
761       \textcolor{comment}{//Properly terminate the string}
762       context->hostname[i] = \textcolor{charliteral}{'\(\backslash\)0'};
763       \textcolor{comment}{//Programmatically change the host name}
764       strcat(context->hostname, s);
765    \}
766 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}\label{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Change\+State@{mdns\+Responder\+Change\+State}}
\index{mdns\+Responder\+Change\+State@{mdns\+Responder\+Change\+State}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Change\+State()}{mdnsResponderChangeState()}}
{\footnotesize\ttfamily void mdns\+Responder\+Change\+State (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context,  }\item[{\hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3}{Mdns\+State}}]{new\+State,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{delay }\end{DoxyParamCaption})}



Update F\+SM state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\mbox{\tt in}  & {\em delay} & Initial delay \\
\hline
\end{DoxyParams}


Definition at line 680 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
682 \{
683    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
684 
685    \textcolor{comment}{//Point to the underlying network interface}
686    \textcolor{keyword}{interface }= context->settings.interface;
687 
688    \textcolor{comment}{//Set time stamp}
689    context->timestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
690    \textcolor{comment}{//Set initial delay}
691    context->timeout = delay;
692    \textcolor{comment}{//Reset retransmission counter}
693    context->retransmitCount = 0;
694    \textcolor{comment}{//Switch to the new state}
695    context->state = newState;
696 
697    \textcolor{comment}{//Any registered callback?}
698    \textcolor{keywordflow}{if}(context->settings.stateChangeEvent != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
699    \{
700       \textcolor{comment}{//Release exclusive access}
701       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
702       \textcolor{comment}{//Invoke user callback function}
703       context->settings.stateChangeEvent(context, interface, newState);
704       \textcolor{comment}{//Get exclusive access}
705       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
706    \}
707 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}\label{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Generate\+Additional\+Records@{mdns\+Responder\+Generate\+Additional\+Records}}
\index{mdns\+Responder\+Generate\+Additional\+Records@{mdns\+Responder\+Generate\+Additional\+Records}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Generate\+Additional\+Records()}{mdnsResponderGenerateAdditionalRecords()}}
{\footnotesize\ttfamily void mdns\+Responder\+Generate\+Additional\+Records (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{response,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{legacy\+Unicast }\end{DoxyParamCaption})}



Additional record generation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in,out}  & {\em response} & m\+D\+NS response message \\
\hline
\mbox{\tt in}  & {\em legacy\+Unicast} & This flag is set for legacy unicast responses \\
\hline
\end{DoxyParams}


Definition at line 1715 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1717 \{
1718    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1719    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1720    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1721    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1722    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1723    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dns__common_8h_a2a5577b198ba758438292038bbab5437}{ancount};
1724    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_ab71c0274cba7f2fc8f94ded11b72917a}{rclass};
1725    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl};
1726    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} cacheFlush;
1727    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1728    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
1729 
1730    \textcolor{comment}{//Point to the mDNS responder context}
1731    context = interface->mdnsResponderContext;
1732 
1733    \textcolor{comment}{//mDNS responses must not contain any questions in the Question Section}
1734    \textcolor{keywordflow}{if}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount != 0)
1735       \textcolor{keywordflow}{return};
1736 
1737    \textcolor{comment}{//Get the TTL resource record}
1738    ttl = context->settings.ttl;
1739 
1740    \textcolor{comment}{//Check whether the querier originating the query is a simple resolver}
1741    \textcolor{keywordflow}{if}(legacyUnicast)
1742    \{
1743       \textcolor{comment}{//The resource record TTL given in a legacy unicast response should}
1744       \textcolor{comment}{//not be greater than ten seconds, even if the true TTL of the mDNS}
1745       \textcolor{comment}{//resource record is higher}
1746       ttl = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(ttl, \hyperlink{mdns__common_8h_a909578ac09bb6948e089bece875b866a}{MDNS\_LEGACY\_UNICAST\_RR\_TTL});
1747 
1748       \textcolor{comment}{//The cache-flush bit must not be set in legacy unicast responses}
1749       cacheFlush = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1750    \}
1751    \textcolor{keywordflow}{else}
1752    \{
1753       \textcolor{comment}{//The cache-bit should be set for unique resource records}
1754       cacheFlush = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1755    \}
1756 
1757    \textcolor{comment}{//Point to the first resource record}
1758    offset = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
1759 
1760    \textcolor{comment}{//Save the number of resource records in the Answer Section}
1761    ancount = response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount;
1762 
1763    \textcolor{comment}{//Compute the total number of resource records}
1764    k = response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount + response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount +
1765       response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount;
1766 
1767    \textcolor{comment}{//Loop through the resource records}
1768    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}; i++)
1769    \{
1770       \textcolor{comment}{//Parse resource record name}
1771       n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1772       \textcolor{comment}{//Invalid name?}
1773       \textcolor{keywordflow}{if}(!n)
1774          \textcolor{keywordflow}{break};
1775 
1776       \textcolor{comment}{//Point to the associated resource record}
1777       record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(response->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
1778       \textcolor{comment}{//Point to the resource data}
1779       n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
1780 
1781       \textcolor{comment}{//Make sure the resource record is valid}
1782       \textcolor{keywordflow}{if}(n > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1783          \textcolor{keywordflow}{break};
1784       \textcolor{keywordflow}{if}((n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength)) > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1785          \textcolor{keywordflow}{break};
1786 
1787       \textcolor{comment}{//Convert the record class to host byte order}
1788       rclass = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rclass);
1789       \textcolor{comment}{//Discard the cache-flush bit}
1790       rclass &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
1791 
1792       \textcolor{comment}{//Check the class of the resource record}
1793       \textcolor{keywordflow}{if}(rclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN})
1794       \{
1795          \textcolor{comment}{//A record?}
1796          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A})
1797          \{
1798 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1799             \textcolor{comment}{//When a mDNS responder places an IPv4 address record into a}
1800             \textcolor{comment}{//response message, it should also place any IPv6 address records}
1801             \textcolor{comment}{//with the same name into the Additional Section}
1802             error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
1803                response, cacheFlush, ttl);
1804 \textcolor{preprocessor}{#else}
1805             \textcolor{comment}{//In the event that a device has only IPv4 addresses but no IPv6}
1806             \textcolor{comment}{//addresses, then the appropriate NSEC record should be placed}
1807             \textcolor{comment}{//into the Additional Section}
1808             error = \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdnsResponderAddNsecRecord}(interface,
1809                response, cacheFlush, ttl);
1810 \textcolor{preprocessor}{#endif}
1811             \textcolor{comment}{//Any error to report?}
1812             \textcolor{keywordflow}{if}(error)
1813                \textcolor{keywordflow}{return};
1814          \}
1815          \textcolor{comment}{//AAAA record?}
1816          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA})
1817          \{
1818 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1819             \textcolor{comment}{//When a mDNS responder places an IPv6 address record into a}
1820             \textcolor{comment}{//response message, it should also place any IPv4 address records}
1821             \textcolor{comment}{//with the same name into the Additional Section}
1822             error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
1823                response, cacheFlush, ttl);
1824 \textcolor{preprocessor}{#else}
1825             \textcolor{comment}{//In the event that a device has only IPv6 addresses but no IPv4}
1826             \textcolor{comment}{//addresses, then the appropriate NSEC record should be placed}
1827             \textcolor{comment}{//into the Additional Section}
1828             error = \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdnsResponderAddNsecRecord}(interface,
1829                response, cacheFlush, ttl);
1830 \textcolor{preprocessor}{#endif}
1831             \textcolor{comment}{//Any error to report?}
1832             \textcolor{keywordflow}{if}(error)
1833                \textcolor{keywordflow}{return};
1834          \}
1835          \textcolor{comment}{//SRV record?}
1836          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a2fe0a9e93403ff6c34c4a4ce79e0c13c}{DNS\_RR\_TYPE\_SRV})
1837          \{
1838             \textcolor{comment}{//Format A resource record}
1839             error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
1840                response, cacheFlush, ttl);
1841             \textcolor{comment}{//Any error to report?}
1842             \textcolor{keywordflow}{if}(error)
1843                \textcolor{keywordflow}{return};
1844 
1845             \textcolor{comment}{//Format AAAA resource record}
1846             error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
1847                response, cacheFlush, ttl);
1848             \textcolor{comment}{//Any error to report?}
1849             \textcolor{keywordflow}{if}(error)
1850                \textcolor{keywordflow}{return};
1851 
1852 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == DISABLED || IPV6\_SUPPORT == DISABLED)}
1853             \textcolor{comment}{//In the event that a device has only IPv4 addresses but no IPv6}
1854             \textcolor{comment}{//addresses, or vice versa, then the appropriate NSEC record should}
1855             \textcolor{comment}{//be placed into the additional section, so that queriers can know}
1856             \textcolor{comment}{//with certainty that the device has no addresses of that kind}
1857             error = \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdnsResponderAddNsecRecord}(interface,
1858                response, cacheFlush, ttl);
1859             \textcolor{comment}{//Any error to report?}
1860             \textcolor{keywordflow}{if}(error)
1861                \textcolor{keywordflow}{return};
1862 \textcolor{preprocessor}{#endif}
1863          \}
1864       \}
1865 
1866       \textcolor{comment}{//Point to the next resource record}
1867       offset = n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength);
1868    \}
1869 
1870    \textcolor{comment}{//Number of resource records in the Additional Section}
1871    response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount += response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount - 
      \hyperlink{dns__common_8h_a2a5577b198ba758438292038bbab5437}{ancount};
1872    \textcolor{comment}{//Number of resource records in the Answer Section}
1873    response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount = \hyperlink{dns__common_8h_a2a5577b198ba758438292038bbab5437}{ancount};
1874 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a40bba4dae706883dd890019d297865b0}\label{mdns__responder_8c_a40bba4dae706883dd890019d297865b0}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Get\+Default\+Settings@{mdns\+Responder\+Get\+Default\+Settings}}
\index{mdns\+Responder\+Get\+Default\+Settings@{mdns\+Responder\+Get\+Default\+Settings}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Get\+Default\+Settings()}{mdnsResponderGetDefaultSettings()}}
{\footnotesize\ttfamily void mdns\+Responder\+Get\+Default\+Settings (\begin{DoxyParamCaption}\item[{\hyperlink{structMdnsResponderSettings}{Mdns\+Responder\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



Initialize settings with default values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em settings} & Structure that contains m\+D\+NS responder settings \\
\hline
\end{DoxyParams}


Definition at line 57 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
58 \{
59    \textcolor{comment}{//Use default interface}
60    settings->\hyperlink{structMdnsResponderSettings_a41dce50accdf1d8b755c283ac0e643d4}{interface} = \hyperlink{net_8c_a991aba7eae4de79f30c6889d95cc6870}{netGetDefaultInterface}();
61 
62    \textcolor{comment}{//Number of announcement packets}
63    settings->\hyperlink{structMdnsResponderSettings_a282b3d4be3aed23875ffe59061294fc3}{numAnnouncements} = \hyperlink{mdns__responder_8h_a117e46a43fc28293cad3ebd6efd61072}{MDNS\_ANNOUNCE\_NUM};
64    \textcolor{comment}{//TTL resource record}
65    settings->\hyperlink{structMdnsResponderSettings_a41f33d42f7fe7bd59d99628b64f4f81a}{ttl} = \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL};
66    \textcolor{comment}{//FSM state change event}
67    settings->\hyperlink{structMdnsResponderSettings_a37f9ce82f094fb92d3c7372c02b03bb7}{stateChangeEvent} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
68 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a3910870b4cfecaa20da6535bc14465c5}\label{mdns__responder_8c_a3910870b4cfecaa20da6535bc14465c5}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Get\+State@{mdns\+Responder\+Get\+State}}
\index{mdns\+Responder\+Get\+State@{mdns\+Responder\+Get\+State}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Get\+State()}{mdnsResponderGetState()}}
{\footnotesize\ttfamily \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3}{Mdns\+State} mdns\+Responder\+Get\+State (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Retrieve current state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Current m\+D\+NS responder state 
\end{DoxyReturn}


Definition at line 183 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
184 \{
185    \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3}{MdnsState} state;
186 
187    \textcolor{comment}{//Get exclusive access}
188    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
189    \textcolor{comment}{//Get current state}
190    state = context->state;
191    \textcolor{comment}{//Release exclusive access}
192    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
193 
194    \textcolor{comment}{//Return current state}
195    \textcolor{keywordflow}{return} state;
196 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a04960b55c0a62aa10c90794a9f46629b}\label{mdns__responder_8c_a04960b55c0a62aa10c90794a9f46629b}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Init@{mdns\+Responder\+Init}}
\index{mdns\+Responder\+Init@{mdns\+Responder\+Init}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Init()}{mdnsResponderInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structMdnsResponderSettings}{Mdns\+Responder\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



m\+D\+NS responder initialization 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\mbox{\tt in}  & {\em settings} & m\+D\+NS responder specific settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 78 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
80 \{
81    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
82 
83    \textcolor{comment}{//Debug message}
84    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Initializing mDNS responder...\(\backslash\)r\(\backslash\)n"});
85 
86    \textcolor{comment}{//Ensure the parameters are valid}
87    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || settings == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
88       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
89 
90    \textcolor{comment}{//Invalid network interface?}
91    \textcolor{keywordflow}{if}(settings->\hyperlink{structMdnsResponderSettings_a41dce50accdf1d8b755c283ac0e643d4}{interface} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
92       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
93 
94    \textcolor{comment}{//Point to the underlying network interface}
95    \textcolor{keyword}{interface }= settings->interface;
96 
97    \textcolor{comment}{//Clear the mDNS responder context}
98    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext}));
99    \textcolor{comment}{//Save user settings}
100    context->settings = *settings;
101 
102    \textcolor{comment}{//mDNS responder is currently suspended}
103    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
104    \textcolor{comment}{//Initialize state machine}
105    context->state = \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT};
106 
107    \textcolor{comment}{//Attach the mDNS responder context to the network interface}
108    interface->mdnsResponderContext = context;
109 
110    \textcolor{comment}{//Successful initialization}
111    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
112 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_aeaff2b8b254457a219a8d19484d94227}\label{mdns__responder_8c_aeaff2b8b254457a219a8d19484d94227}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Link\+Change\+Event@{mdns\+Responder\+Link\+Change\+Event}}
\index{mdns\+Responder\+Link\+Change\+Event@{mdns\+Responder\+Link\+Change\+Event}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Link\+Change\+Event()}{mdnsResponderLinkChangeEvent()}}
{\footnotesize\ttfamily void mdns\+Responder\+Link\+Change\+Event (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Callback function for link change event. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}


Definition at line 651 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
652 \{
653    \textcolor{comment}{//Make sure the mDNS responder has been properly instantiated}
654    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
655       \textcolor{keywordflow}{return};
656 
657 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
658    \textcolor{comment}{//Free any response message pending to be sent}
659    \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&context->ipv4Response);
660 \textcolor{preprocessor}{#endif}
661 
662 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
663    \textcolor{comment}{//Free any response message pending to be sent}
664    \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&context->ipv6Response);
665 \textcolor{preprocessor}{#endif}
666 
667    \textcolor{comment}{//Whenever a mDNS responder receives an indication of a link}
668    \textcolor{comment}{//change event, it must perform probing and announcing}
669    \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT}, 0);
670 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a2410b64ea776775499df0053050399c2}\label{mdns__responder_8c_a2410b64ea776775499df0053050399c2}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Parse\+An\+Record@{mdns\+Responder\+Parse\+An\+Record}}
\index{mdns\+Responder\+Parse\+An\+Record@{mdns\+Responder\+Parse\+An\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Parse\+An\+Record()}{mdnsResponderParseAnRecord()}}
{\footnotesize\ttfamily void mdns\+Responder\+Parse\+An\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{response,  }\item[{size\+\_\+t}]{offset,  }\item[{const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$}]{record }\end{DoxyParamCaption})}



Parse a resource record from the Answer Section. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em response} & Incoming m\+D\+NS response message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to first byte of the resource record to be checked \\
\hline
\mbox{\tt in}  & {\em record} & Pointer to the resource record \\
\hline
\end{DoxyParams}


Definition at line 1617 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1619 \{
1620    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} conflict;
1621    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_ab71c0274cba7f2fc8f94ded11b72917a}{rclass};
1622    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1623 
1624    \textcolor{comment}{//Point to the mDNS responder context}
1625    context = interface->mdnsResponderContext;
1626 
1627    \textcolor{comment}{//Check for conflicts}
1628    \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
1629       \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, 0))
1630    \{
1631       \textcolor{comment}{//Convert the class to host byte order}
1632       rclass = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rclass);
1633       \textcolor{comment}{//Discard Cache Flush flag}
1634       rclass &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
1635 
1636       \textcolor{comment}{//Check the class of the resource record}
1637       \textcolor{keywordflow}{if}(rclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN})
1638       \{
1639 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1640          \textcolor{comment}{//A resource record found?}
1641          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A})
1642          \{
1643             \textcolor{comment}{//A conflict occurs when a mDNS responder has a unique record for}
1644             \textcolor{comment}{//which it is currently authoritative, and it receives a mDNS}
1645             \textcolor{comment}{//response message containing a record with the same name, rrtype}
1646             \textcolor{comment}{//and rrclass, but inconsistent rdata}
1647             conflict = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1648 
1649             \textcolor{comment}{//Verify the length of the data field}
1650             \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength) == \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}))
1651             \{
1652                \textcolor{comment}{//Valid host address?}
1653                \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state == 
      \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
1654                \{
1655                   \textcolor{comment}{//Check whether the rdata field is consistent}
1656                   \textcolor{keywordflow}{if}(\hyperlink{ipv4_8h_a98c009c680d3f1f84660d21c62b162d8}{ipv4CompAddr}(&interface->ipv4Context.addrList[0].addr, record->rdata))
1657                      context->conflict = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1658                \}
1659             \}
1660 
1661             \textcolor{comment}{//Check whether the hostname is already in use by some other host}
1662             \textcolor{keywordflow}{if}(conflict)
1663                context->conflict = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1664          \}
1665 \textcolor{preprocessor}{#endif}
1666 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1667          \textcolor{comment}{//AAAA resource record found?}
1668          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA})
1669          \{
1670             \textcolor{comment}{//A conflict occurs when a mDNS responder has a unique record for}
1671             \textcolor{comment}{//which it is currently authoritative, and it receives a mDNS}
1672             \textcolor{comment}{//response message containing a record with the same name, rrtype}
1673             \textcolor{comment}{//and rrclass, but inconsistent rdata}
1674             conflict = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1675 
1676             \textcolor{comment}{//Verify the length of the data field}
1677             \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength) == \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr}))
1678             \{
1679                \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1680                \hyperlink{structIpv6AddrEntry}{Ipv6AddrEntry} *entry;
1681 
1682                \textcolor{comment}{//Loop through the list of IPv6 addresses assigned to the interface}
1683                \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
1684                \{
1685                   \textcolor{comment}{//Point to the current entry}
1686                   entry = &interface->ipv6Context.addrList[i];
1687 
1688                   \textcolor{comment}{//Valid IPv6 address}
1689                   \textcolor{keywordflow}{if}(entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} != \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID})
1690                   \{
1691                      \textcolor{comment}{//Check whether the rdata field is consistent}
1692                      \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_ab1e93bd2152bc3f3b5642fd0216384d7}{ipv6CompAddr}(&interface->ipv6Context.addrList[i].addr, record->rdata))
1693                         conflict = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1694                   \}
1695                \}
1696             \}
1697 
1698             \textcolor{comment}{//Check whether the hostname is already in use by some other host}
1699             \textcolor{keywordflow}{if}(conflict)
1700                context->conflict = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1701          \}
1702 \textcolor{preprocessor}{#endif}
1703       \}
1704    \}
1705 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_afa3cc719b26b1d47ff57da7189f70f32}\label{mdns__responder_8c_afa3cc719b26b1d47ff57da7189f70f32}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Parse\+Known\+An\+Record@{mdns\+Responder\+Parse\+Known\+An\+Record}}
\index{mdns\+Responder\+Parse\+Known\+An\+Record@{mdns\+Responder\+Parse\+Known\+An\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Parse\+Known\+An\+Record()}{mdnsResponderParseKnownAnRecord()}}
{\footnotesize\ttfamily void mdns\+Responder\+Parse\+Known\+An\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{query,  }\item[{size\+\_\+t}]{query\+Offset,  }\item[{const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$}]{query\+Record,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Parse a resource record from the Known-\/\+Answer Section. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em query} & Incoming m\+D\+NS query message \\
\hline
\mbox{\tt in}  & {\em query\+Offset} & Offset to first byte of the resource record \\
\hline
\mbox{\tt in}  & {\em query\+Record} & Pointer to the resource record \\
\hline
\mbox{\tt in,out}  & {\em response} & m\+D\+NS response message \\
\hline
\end{DoxyParams}


Definition at line 1430 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1432 \{
1433    \textcolor{keywordtype}{size\_t} i;
1434    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1435    \textcolor{keywordtype}{size\_t} responseOffset;
1436    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *responseRecord;
1437 
1438    \textcolor{comment}{//mDNS responses must not contain any questions in the Question Section}
1439    \textcolor{keywordflow}{if}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount == 0)
1440    \{
1441       \textcolor{comment}{//Point to the first resource record}
1442       responseOffset = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
1443 
1444       \textcolor{comment}{//Parse the Answer Section of the response}
1445       \textcolor{keywordflow}{for}(i = 0; i < response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount; i++)
1446       \{
1447          \textcolor{comment}{//Parse resource record name}
1448          n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, responseOffset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1449          \textcolor{comment}{//Invalid name?}
1450          \textcolor{keywordflow}{if}(!n)
1451             \textcolor{keywordflow}{break};
1452 
1453          \textcolor{comment}{//Point to the associated resource record}
1454          responseRecord = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(response->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
1455          \textcolor{comment}{//Point to the resource data}
1456          n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
1457 
1458          \textcolor{comment}{//Make sure the resource record is valid}
1459          \textcolor{keywordflow}{if}(n > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1460             \textcolor{keywordflow}{break};
1461 
1462          \textcolor{comment}{//Point to the end of the resource record}
1463          n += \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(responseRecord->rdlength);
1464 
1465          \textcolor{comment}{//Make sure the resource record is valid}
1466          \textcolor{keywordflow}{if}(n > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1467             \textcolor{keywordflow}{break};
1468 
1469          \textcolor{comment}{//Compare resource record names}
1470          \textcolor{keywordflow}{if}(!\hyperlink{dns__common_8c_a5a2a26fa4e4ec615f776176da210541f}{dnsCompareEncodedName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, queryOffset,
1471             response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, responseOffset, 0))
1472          \{
1473             \textcolor{comment}{//Compare the contents of the resource records}
1474             \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_abe6bb283dc2b40749cdecca396ea4809}{mdnsCompareRecord}(query, queryOffset, queryRecord,
1475                response, responseOffset, responseRecord))
1476             \{
1477                \textcolor{comment}{//A mDNS responder must not answer a mDNS query if the answer}
1478                \textcolor{comment}{//it would give is already included in the Answer Section with}
1479                \textcolor{comment}{//an RR TTL at least half the correct value}
1480                \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(queryRecord->ttl) >= (\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(responseRecord->ttl) / 2))
1481                \{
1482                   \textcolor{comment}{//Perform Known-Answer Suppression}
1483                   memmove((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + responseOffset,
1484                      (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} + n, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} - n);
1485 
1486                   \textcolor{comment}{//Update the length of the mDNS response message}
1487                   response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} -= (n - responseOffset);
1488                   \textcolor{comment}{//Update the number of resource records in the Answer Section}
1489                   response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount--;
1490 
1491                   \textcolor{comment}{//Keep at the same position}
1492                   n = responseOffset;
1493                   i--;
1494                \}
1495             \}
1496          \}
1497 
1498          \textcolor{comment}{//Point to the next resource record}
1499          responseOffset = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1500       \}
1501    \}
1502 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a4a7956545a437d789872cee46f1773aa}\label{mdns__responder_8c_a4a7956545a437d789872cee46f1773aa}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Parse\+Ns\+Record@{mdns\+Responder\+Parse\+Ns\+Record}}
\index{mdns\+Responder\+Parse\+Ns\+Record@{mdns\+Responder\+Parse\+Ns\+Record}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Parse\+Ns\+Record()}{mdnsResponderParseNsRecord()}}
{\footnotesize\ttfamily void mdns\+Responder\+Parse\+Ns\+Record (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{query,  }\item[{size\+\_\+t}]{offset,  }\item[{const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$}]{record }\end{DoxyParamCaption})}



Parse a resource record from the Authority Section. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em query} & Incoming m\+D\+NS query message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to first byte of the resource record \\
\hline
\mbox{\tt in}  & {\em record} & Pointer to the resource record \\
\hline
\end{DoxyParams}


Definition at line 1513 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1515 \{
1516    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} tieBreakLost;
1517    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_ab71c0274cba7f2fc8f94ded11b72917a}{rclass};
1518    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1519 
1520    \textcolor{comment}{//Point to the mDNS responder context}
1521    context = interface->mdnsResponderContext;
1522 
1523    \textcolor{comment}{//When a host that is probing for a record sees another host issue a query}
1524    \textcolor{comment}{//for the same record, it consults the Authority Section of that query.}
1525    \textcolor{comment}{//If it finds any resource record there which answers the query, then it}
1526    \textcolor{comment}{//compares the data of that resource record with its own tentative data}
1527    \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
1528       \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, 0))
1529    \{
1530       \textcolor{comment}{//Convert the class to host byte order}
1531       rclass = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rclass);
1532       \textcolor{comment}{//Discard Cache Flush flag}
1533       rclass &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
1534 
1535       \textcolor{comment}{//Check the class of the resource record}
1536       \textcolor{keywordflow}{if}(rclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN})
1537       \{
1538 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1539          \textcolor{comment}{//A resource record found?}
1540          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A})
1541          \{
1542             \textcolor{comment}{//Apply tie-breaking rules}
1543             tieBreakLost = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1544 
1545             \textcolor{comment}{//Verify the length of the data field}
1546             \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength) == \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}))
1547             \{
1548                \textcolor{comment}{//Valid host address?}
1549                \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state == 
      \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
1550                \{
1551                   \textcolor{comment}{//The two records are compared and the lexicographically}
1552                   \textcolor{comment}{//later data wins}
1553                   \textcolor{keywordflow}{if}(memcmp(&interface->ipv4Context.addrList[0].addr, record->rdata,
1554                      \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr})) >= 0)
1555                   \{
1556                      tieBreakLost = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1557                   \}
1558                \}
1559             \}
1560 
1561             \textcolor{comment}{//Check whether the host has lost the tie-break}
1562             \textcolor{keywordflow}{if}(tieBreakLost)
1563                context->tieBreakLost = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1564          \}
1565 \textcolor{preprocessor}{#endif}
1566 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1567          \textcolor{comment}{//AAAA resource record found?}
1568          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA})
1569          \{
1570             \textcolor{comment}{//Apply tie-breaking rules}
1571             tieBreakLost = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1572 
1573             \textcolor{comment}{//Verify the length of the data field}
1574             \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength) == \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr}))
1575             \{
1576                \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1577                \hyperlink{structIpv6AddrEntry}{Ipv6AddrEntry} *entry;
1578 
1579                \textcolor{comment}{//Loop through the list of IPv6 addresses assigned to the interface}
1580                \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
1581                \{
1582                   \textcolor{comment}{//Point to the current entry}
1583                   entry = &interface->ipv6Context.addrList[i];
1584 
1585                   \textcolor{comment}{//Valid IPv6 address}
1586                   \textcolor{keywordflow}{if}(entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} != \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID})
1587                   \{
1588                      \textcolor{comment}{//The two records are compared and the lexicographically}
1589                      \textcolor{comment}{//later data wins}
1590                      \textcolor{keywordflow}{if}(memcmp(&interface->ipv6Context.addrList[i].addr,
1591                         record->rdata, \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr})) >= 0)
1592                      \{
1593                         tieBreakLost = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1594                      \}
1595                   \}
1596                \}
1597             \}
1598 
1599             \textcolor{comment}{//Check whether the host has lost the tie-break}
1600             \textcolor{keywordflow}{if}(tieBreakLost)
1601                context->tieBreakLost = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1602          \}
1603 \textcolor{preprocessor}{#endif}
1604       \}
1605    \}
1606 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_af6209f4b4506659fb5533430b4fce600}\label{mdns__responder_8c_af6209f4b4506659fb5533430b4fce600}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Parse\+Question@{mdns\+Responder\+Parse\+Question}}
\index{mdns\+Responder\+Parse\+Question@{mdns\+Responder\+Parse\+Question}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Parse\+Question()}{mdnsResponderParseQuestion()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Parse\+Question (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{query,  }\item[{size\+\_\+t}]{offset,  }\item[{const \hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{Dns\+Question} $\ast$}]{question,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Parse a question. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em query} & Incoming m\+D\+NS query message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to first byte of the question \\
\hline
\mbox{\tt in}  & {\em question} & Pointer to the question \\
\hline
\mbox{\tt in,out}  & {\em response} & m\+D\+NS response message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1263 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
1265 \{
1266    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1267    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_ac94c665afc6c72c418f3caa344bc480e}{qclass};
1268    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_a92ac313e0c65dcd831a91b495aa7b282}{qtype};
1269    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dns__common_8h_a48b9f3382e0929bbd75cda2bf2838126}{ttl};
1270    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} cacheFlush;
1271    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
1272 
1273    \textcolor{comment}{//Point to the mDNS responder context}
1274    context = interface->mdnsResponderContext;
1275 
1276    \textcolor{comment}{//Check the state of the mDNS responder}
1277    \textcolor{keywordflow}{if}(context->state != \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a5669572319cfacc11b9d9fd5c70a6933}{MDNS\_STATE\_ANNOUNCING} &&
1278       context->state != \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a94d5f006d5512a42d0a63b7cc981b626}{MDNS\_STATE\_IDLE})
1279    \{
1280       \textcolor{comment}{//Do not respond to mDNS queries during probing}
1281       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1282    \}
1283 
1284    \textcolor{comment}{//Convert the query class to host byte order}
1285    qclass = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(question->qclass);
1286    \textcolor{comment}{//Discard QU flag}
1287    qclass &= ~\hyperlink{mdns__common_8h_ac11a61056f0e21d666d58a0e433848df}{MDNS\_QCLASS\_QU};
1288 
1289    \textcolor{comment}{//Convert the query type to host byte order}
1290    qtype = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(question->qtype);
1291 
1292    \textcolor{comment}{//Get the TTL resource record}
1293    ttl = context->settings.ttl;
1294 
1295    \textcolor{comment}{//Check whether the querier originating the query is a simple resolver}
1296    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort) != \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT})
1297    \{
1298       \textcolor{comment}{//The resource record TTL given in a legacy unicast response should}
1299       \textcolor{comment}{//not be greater than ten seconds, even if the true TTL of the mDNS}
1300       \textcolor{comment}{//resource record is higher}
1301       ttl = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(ttl, \hyperlink{mdns__common_8h_a909578ac09bb6948e089bece875b866a}{MDNS\_LEGACY\_UNICAST\_RR\_TTL});
1302 
1303       \textcolor{comment}{//The cache-flush bit must not be set in legacy unicast responses}
1304       cacheFlush = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1305    \}
1306    \textcolor{keywordflow}{else}
1307    \{
1308       \textcolor{comment}{//The cache-bit should be set for unique resource records}
1309       cacheFlush = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1310    \}
1311 
1312    \textcolor{comment}{//Check the class of the query}
1313    \textcolor{keywordflow}{if}(qclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN} || qclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5a5bb41b9beab96e5a78ec7023756e8d3b}{DNS\_RR\_CLASS\_ANY})
1314    \{
1315       \textcolor{comment}{//Compare domain name}
1316       \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
1317          \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, context->hostname, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{".local"}, 0))
1318       \{
1319 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1320          \textcolor{comment}{//A query?}
1321          \textcolor{keywordflow}{if}(qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a420fd47ef427589e0f1961e35b46756b}{DNS\_RR\_TYPE\_A})
1322          \{
1323             \textcolor{comment}{//Format A resource record}
1324             error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
1325                response, cacheFlush, ttl);
1326             \textcolor{comment}{//Any error to report?}
1327             \textcolor{keywordflow}{if}(error)
1328                \textcolor{keywordflow}{return} error;
1329          \}
1330          \textcolor{keywordflow}{else}
1331 \textcolor{preprocessor}{#endif}
1332 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1333          \textcolor{comment}{//AAAA query?}
1334          \textcolor{keywordflow}{if}(qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a4d0fc3b547030a6a0f32b3ca455927fe}{DNS\_RR\_TYPE\_AAAA})
1335          \{
1336             \textcolor{comment}{//Format AAAA resource record}
1337             error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
1338                response, cacheFlush, ttl);
1339             \textcolor{comment}{//Any error to report?}
1340             \textcolor{keywordflow}{if}(error)
1341                \textcolor{keywordflow}{return} error;
1342          \}
1343          \textcolor{keywordflow}{else}
1344 \textcolor{preprocessor}{#endif}
1345          \textcolor{comment}{//ANY query?}
1346          \textcolor{keywordflow}{if}(qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a8f6102b9591501cd59e38352db0f94b0}{DNS\_RR\_TYPE\_ANY})
1347          \{
1348             \textcolor{comment}{//Format A resource record}
1349             error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
1350                response, cacheFlush, ttl);
1351             \textcolor{comment}{//Any error to report?}
1352             \textcolor{keywordflow}{if}(error)
1353                \textcolor{keywordflow}{return} error;
1354 
1355             \textcolor{comment}{//Format AAAA resource record}
1356             error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
1357                response, cacheFlush, ttl);
1358             \textcolor{comment}{//Any error to report?}
1359             \textcolor{keywordflow}{if}(error)
1360                \textcolor{keywordflow}{return} error;
1361 
1362             \textcolor{comment}{//Format NSEC resource record}
1363             error = \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdnsResponderAddNsecRecord}(interface,
1364                response, cacheFlush, ttl);
1365             \textcolor{comment}{//Any error to report?}
1366             \textcolor{keywordflow}{if}(error)
1367                \textcolor{keywordflow}{return} error;
1368          \}
1369          \textcolor{keywordflow}{else}
1370          \{
1371             \textcolor{comment}{//Format NSEC resource record}
1372             error = \hyperlink{mdns__responder_8c_a7aa5374ede603cf28b47bb71be0b9bc5}{mdnsResponderAddNsecRecord}(interface,
1373                response, cacheFlush, ttl);
1374             \textcolor{comment}{//Any error to report?}
1375             \textcolor{keywordflow}{if}(error)
1376                \textcolor{keywordflow}{return} error;
1377          \}
1378       \}
1379 
1380 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1381       \textcolor{comment}{//Reverse DNS lookup?}
1382       \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
1383          \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, context->ipv4ReverseName, \textcolor{stringliteral}{"in-addr"}, \textcolor{stringliteral}{".arpa"}, 0))
1384       \{
1385          \textcolor{comment}{//PTR query?}
1386          \textcolor{keywordflow}{if}(qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR} || qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a8f6102b9591501cd59e38352db0f94b0}{DNS\_RR\_TYPE\_ANY})
1387          \{
1388             \textcolor{comment}{//Format reverse address mapping PTR record (IPv4)}
1389             error = \hyperlink{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}{mdnsResponderAddIpv4ReversePtrRecord}(interface,
1390                response, cacheFlush, ttl);
1391             \textcolor{comment}{//Any error to report?}
1392             \textcolor{keywordflow}{if}(error)
1393                \textcolor{keywordflow}{return} error;
1394          \}
1395       \}
1396 \textcolor{preprocessor}{#endif}
1397 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1398       \textcolor{comment}{//Reverse DNS lookup?}
1399       \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
1400          \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset}, context->ipv6ReverseName, \textcolor{stringliteral}{"ip6"}, \textcolor{stringliteral}{".arpa"}, 0))
1401       \{
1402          \textcolor{comment}{//PTR query?}
1403          \textcolor{keywordflow}{if}(qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR} || qtype == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a8f6102b9591501cd59e38352db0f94b0}{DNS\_RR\_TYPE\_ANY})
1404          \{
1405             \textcolor{comment}{//Format reverse address mapping PTR record (IPv6)}
1406             error = \hyperlink{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}{mdnsResponderAddIpv6ReversePtrRecord}(interface,
1407                response, cacheFlush, ttl);
1408             \textcolor{comment}{//Any error to report?}
1409             \textcolor{keywordflow}{if}(error)
1410                \textcolor{keywordflow}{return} error;
1411          \}
1412       \}
1413 \textcolor{preprocessor}{#endif}
1414    \}
1415 
1416    \textcolor{comment}{//Successful processing}
1417    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1418 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a13e701e7094bd3b41bddb0761d5088aa}\label{mdns__responder_8c_a13e701e7094bd3b41bddb0761d5088aa}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Process\+Query@{mdns\+Responder\+Process\+Query}}
\index{mdns\+Responder\+Process\+Query@{mdns\+Responder\+Process\+Query}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Process\+Query()}{mdnsResponderProcessQuery()}}
{\footnotesize\ttfamily void mdns\+Responder\+Process\+Query (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{query }\end{DoxyParamCaption})}



Process m\+D\+NS query message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em query} & Incoming m\+D\+NS query message \\
\hline
\end{DoxyParams}


Definition at line 978 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
979 \{
980    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
981    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
982    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
983    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
984    \hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion} *question;
985    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
986    \hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{MdnsResponderContext} *context;
987    \hyperlink{structMdnsMessage}{MdnsMessage} *response;
988    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{tcp_8h_af15d713ad2bc92686abfa6ab012b5039}{destPort};
989    \hyperlink{structIpAddr}{IpAddr} \hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{destIpAddr};
990 
991    \textcolor{comment}{//Point to the mDNS responder context}
992    context = interface->mdnsResponderContext;
993    \textcolor{comment}{//Make sure the mDNS responder has been properly instantiated}
994    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
995       \textcolor{keywordflow}{return};
996 
997 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
998    \textcolor{comment}{//IPv4 query received?}
999    \textcolor{keywordflow}{if}(query->\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader}->\hyperlink{structIpPseudoHeader_aeff06b8d9c3e7e2ef3cdb8a3a14e8ad2}{length} == \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4PseudoHeader}))
1000    \{
1001       \textcolor{comment}{//If the source UDP port in a received Multicast DNS query is not port 5353,}
1002       \textcolor{comment}{//this indicates that the querier originating the query is a simple resolver}
1003       \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort) != \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT})
1004       \{
1005          \textcolor{comment}{//The mDNS responder must send a UDP response directly back to the querier,}
1006          \textcolor{comment}{//via unicast, to the query packet's source IP address and port}
1007          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
1008          destIpAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr} = query->\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader}->\hyperlink{structIpPseudoHeader_a4dd0d91580f30918dc7b5d5a430dba6a}{ipv4Data}.srcAddr;
1009       \}
1010       \textcolor{keywordflow}{else}
1011       \{
1012          \textcolor{comment}{//Use mDNS IPv4 multicast address}
1013          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
1014          destIpAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr} = \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{MDNS\_IPV4\_MULTICAST\_ADDR};
1015       \}
1016 
1017       \textcolor{comment}{//Point to the mDNS response message}
1018       response = &context->ipv4Response;
1019    \}
1020    \textcolor{keywordflow}{else}
1021 \textcolor{preprocessor}{#endif}
1022 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1023    \textcolor{comment}{//IPv6 query received?}
1024    \textcolor{keywordflow}{if}(query->\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader}->\hyperlink{structIpPseudoHeader_aeff06b8d9c3e7e2ef3cdb8a3a14e8ad2}{length} == \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_a68061e0a0b502d880cbe60b645cfa2b7}{Ipv6PseudoHeader}))
1025    \{
1026       \textcolor{comment}{//If the source UDP port in a received Multicast DNS query is not port 5353,}
1027       \textcolor{comment}{//this indicates that the querier originating the query is a simple resolver}
1028       \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort) != \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT})
1029       \{
1030          \textcolor{comment}{//The mDNS responder must send a UDP response directly back to the querier,}
1031          \textcolor{comment}{//via unicast, to the query packet's source IP address and port}
1032          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
1033          destIpAddr.\hyperlink{structIpAddr_a9bc2340a9c0bc5a0b8aa9695b74e2ee6}{ipv6Addr} = query->\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader}->\hyperlink{structIpPseudoHeader_a5155846ca7e85218407a8374d035aab7}{ipv6Data}.srcAddr;
1034       \}
1035       \textcolor{keywordflow}{else}
1036       \{
1037          \textcolor{comment}{//Use mDNS IPv6 multicast address}
1038          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
1039          destIpAddr.\hyperlink{structIpAddr_a9bc2340a9c0bc5a0b8aa9695b74e2ee6}{ipv6Addr} = \hyperlink{mdns__common_8c_a74c29f24464b2cbb5c7754c264a462a2}{MDNS\_IPV6\_MULTICAST\_ADDR};
1040       \}
1041 
1042       \textcolor{comment}{//Point to the mDNS response message}
1043       response = &context->ipv6Response;
1044    \}
1045    \textcolor{keywordflow}{else}
1046 \textcolor{preprocessor}{#endif}
1047    \textcolor{comment}{//Invalid query received?}
1048    \{
1049       \textcolor{comment}{//Discard the mDNS query message}
1050       \textcolor{keywordflow}{return};
1051    \}
1052 
1053    \textcolor{comment}{//When possible, a responder should, for the sake of network}
1054    \textcolor{comment}{//efficiency, aggregate as many responses as possible into a}
1055    \textcolor{comment}{//single mDNS response message}
1056    \textcolor{keywordflow}{if}(response->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1057    \{
1058       \textcolor{comment}{//Create an empty mDNS response message}
1059       error = \hyperlink{mdns__common_8c_a5c5005850cf4d8dd089bbd62641aa9ba}{mdnsCreateMessage}(response, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1060       \textcolor{comment}{//Any error to report?}
1061       \textcolor{keywordflow}{if}(error)
1062          \textcolor{keywordflow}{return};
1063    \}
1064 
1065    \textcolor{comment}{//Take the identifier from the query message}
1066    response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->id = query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->id;
1067 
1068    \textcolor{comment}{//Point to the first question}
1069    offset = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
1070 
1071    \textcolor{comment}{//Start of exception handling block}
1072    \textcolor{keywordflow}{do}
1073    \{
1074       \textcolor{comment}{//Parse the Question Section}
1075       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount); i++)
1076       \{
1077          \textcolor{comment}{//Parse resource record name}
1078          n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1079          \textcolor{comment}{//Invalid name?}
1080          \textcolor{keywordflow}{if}(!n)
1081             \textcolor{keywordflow}{break};
1082          \textcolor{comment}{//Malformed mDNS message?}
1083          \textcolor{keywordflow}{if}((n + \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion})) > query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1084             \textcolor{keywordflow}{break};
1085 
1086          \textcolor{comment}{//Point to the corresponding entry}
1087          question = \hyperlink{dns__common_8h_a66ca704f3f850dcbb2f3ceefe90afcc5}{DNS\_GET\_QUESTION}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
1088 
1089          \textcolor{comment}{//Parse question}
1090          error = \hyperlink{mdns__responder_8c_af6209f4b4506659fb5533430b4fce600}{mdnsResponderParseQuestion}(interface, query,
1091             offset, question, response);
1092          \textcolor{comment}{//Any error to report?}
1093          \textcolor{keywordflow}{if}(error)
1094             \textcolor{keywordflow}{break};
1095 
1096 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
1097          \textcolor{comment}{//Parse resource record}
1098          error = \hyperlink{dns__sd_8c_a15ce05880f66f53ee603f6fe4ac15613}{dnsSdParseQuestion}(interface, query, offset,
1099             question, response);
1100          \textcolor{comment}{//Any error to report?}
1101          \textcolor{keywordflow}{if}(error)
1102             \textcolor{keywordflow}{break};
1103 \textcolor{preprocessor}{#endif}
1104          \textcolor{comment}{//Point to the next question}
1105          offset = n + \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion});
1106       \}
1107 
1108       \textcolor{comment}{//Any error while parsing the Question Section?}
1109       \textcolor{keywordflow}{if}(i != \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount))
1110          \textcolor{keywordflow}{break};
1111 
1112       \textcolor{comment}{//Parse the Known-Answer Section}
1113       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount); i++)
1114       \{
1115          \textcolor{comment}{//Parse resource record name}
1116          n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1117          \textcolor{comment}{//Invalid name?}
1118          \textcolor{keywordflow}{if}(!n)
1119             \textcolor{keywordflow}{break};
1120 
1121          \textcolor{comment}{//Point to the associated resource record}
1122          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(query->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
1123          \textcolor{comment}{//Point to the resource data}
1124          n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
1125 
1126          \textcolor{comment}{//Make sure the resource record is valid}
1127          \textcolor{keywordflow}{if}(n > query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1128             \textcolor{keywordflow}{break};
1129          \textcolor{keywordflow}{if}((n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength)) > query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1130             \textcolor{keywordflow}{break};
1131 
1132          \textcolor{comment}{//Parse resource record}
1133          \hyperlink{mdns__responder_8c_afa3cc719b26b1d47ff57da7189f70f32}{mdnsResponderParseKnownAnRecord}(interface, query, offset,
1134             record, response);
1135 
1136          \textcolor{comment}{//Point to the next resource record}
1137          offset = n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength);
1138       \}
1139 
1140       \textcolor{comment}{//Any error while parsing the Answer Section?}
1141       \textcolor{keywordflow}{if}(i != \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount))
1142          \textcolor{keywordflow}{break};
1143 
1144       \textcolor{comment}{//Parse Authority Section}
1145       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount); i++)
1146       \{
1147          \textcolor{comment}{//Parse resource record name}
1148          n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1149          \textcolor{comment}{//Invalid name?}
1150          \textcolor{keywordflow}{if}(!n)
1151             \textcolor{keywordflow}{break};
1152 
1153          \textcolor{comment}{//Point to the associated resource record}
1154          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(query->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
1155          \textcolor{comment}{//Point to the resource data}
1156          n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
1157 
1158          \textcolor{comment}{//Make sure the resource record is valid}
1159          \textcolor{keywordflow}{if}(n > query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1160             \textcolor{keywordflow}{break};
1161          \textcolor{keywordflow}{if}((n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength)) > query->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
1162             \textcolor{keywordflow}{break};
1163 
1164          \textcolor{comment}{//Check for host name conflict}
1165          \hyperlink{mdns__responder_8c_a4a7956545a437d789872cee46f1773aa}{mdnsResponderParseNsRecord}(interface, query, offset, record);
1166 
1167 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
1168          \textcolor{comment}{//Check for service instance name conflict}
1169          \hyperlink{dns__sd_8c_a9c0b0d6f064fa26e94f5396041803fa9}{dnsSdParseNsRecord}(interface, query, offset, record);
1170 \textcolor{preprocessor}{#endif}
1171          \textcolor{comment}{//Point to the next resource record}
1172          offset = n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength);
1173       \}
1174 
1175       \textcolor{comment}{//Any error while parsing the Authority Section?}
1176       \textcolor{keywordflow}{if}(i != \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount))
1177          \textcolor{keywordflow}{break};
1178 
1179       \textcolor{comment}{//End of exception handling block}
1180    \} \textcolor{keywordflow}{while}(0);
1181 
1182    \textcolor{comment}{//Should a mDNS message be send in response to the query?}
1183    \textcolor{keywordflow}{if}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount > 0)
1184    \{
1185       \textcolor{comment}{//If the source UDP port in a received Multicast DNS query is not port 5353,}
1186       \textcolor{comment}{//this indicates that the querier originating the query is a simple resolver}
1187       \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort) != \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT})
1188       \{
1189 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
1190          \textcolor{comment}{//Additional record generation (DNS-SD)}
1191          \hyperlink{dns__sd_8c_a6cbe9ebfd668ed81e14bb040c8ee274c}{dnsSdGenerateAdditionalRecords}(interface, response, 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1192 \textcolor{preprocessor}{#endif}
1193          \textcolor{comment}{//Additional record generation (mDNS)}
1194          \hyperlink{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}{mdnsResponderGenerateAdditionalRecords}(interface, response, 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1195 
1196          \textcolor{comment}{//Destination port}
1197          destPort = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(query->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort);
1198 
1199          \textcolor{comment}{//Send mDNS response message}
1200          \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, response, &destIpAddr, destPort);
1201          \textcolor{comment}{//Free previously allocated memory}
1202          \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(response);
1203       \}
1204       \textcolor{keywordflow}{else}
1205       \{
1206          \textcolor{comment}{//Check whether the answer should be delayed}
1207          \textcolor{keywordflow}{if}(query->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->tc)
1208          \{
1209             \textcolor{comment}{//In the case where the query has the TC (truncated) bit set, indicating}
1210             \textcolor{comment}{//that subsequent Known-Answer packets will follow, responders should}
1211             \textcolor{comment}{//delay their responses by a random amount of time selected with uniform}
1212             \textcolor{comment}{//random distribution in the range 400-500 ms}
1213             response->\hyperlink{structMdnsMessage_a3590edc47336ebe77d2c35ea4adf49ac}{timeout} = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(400, 500);
1214 
1215             \textcolor{comment}{//Save current time}
1216             response->\hyperlink{structMdnsMessage_a525fb8a1b9335c262451c76a22a5883f}{timestamp} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1217          \}
1218          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(response->\hyperlink{structMdnsMessage_a0d87d66898216dc4e73abc9a2189bdde}{sharedRecordCount} > 0)
1219          \{
1220             \textcolor{comment}{//In any case where there may be multiple responses, such as queries}
1221             \textcolor{comment}{//where the answer is a member of a shared resource record set, each}
1222             \textcolor{comment}{//responder should delay its response by a random amount of time}
1223             \textcolor{comment}{//selected with uniform random distribution in the range 20-120 ms}
1224             response->\hyperlink{structMdnsMessage_a3590edc47336ebe77d2c35ea4adf49ac}{timeout} = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(20, 120);
1225 
1226             \textcolor{comment}{//Save current time}
1227             response->\hyperlink{structMdnsMessage_a525fb8a1b9335c262451c76a22a5883f}{timestamp} = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1228          \}
1229          \textcolor{keywordflow}{else}
1230          \{
1231 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
1232             \textcolor{comment}{//Additional record generation (refer to RFC 6763 section 12)}
1233             \hyperlink{dns__sd_8c_a6cbe9ebfd668ed81e14bb040c8ee274c}{dnsSdGenerateAdditionalRecords}(interface, response, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1234 \textcolor{preprocessor}{#endif}
1235             \textcolor{comment}{//Additional record generation (mDNS)}
1236             \hyperlink{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}{mdnsResponderGenerateAdditionalRecords}(interface, 
      response, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1237 
1238             \textcolor{comment}{//Send mDNS response message}
1239             \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, response, &destIpAddr, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
1240             \textcolor{comment}{//Free previously allocated memory}
1241             \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(response);
1242          \}
1243       \}
1244    \}
1245    \textcolor{keywordflow}{else}
1246    \{
1247       \textcolor{comment}{//Free mDNS response message}
1248       \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(response);
1249    \}
1250 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a7ae84cb7fe81e99cc89d2cb818826e8e}\label{mdns__responder_8c_a7ae84cb7fe81e99cc89d2cb818826e8e}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Send\+Announcement@{mdns\+Responder\+Send\+Announcement}}
\index{mdns\+Responder\+Send\+Announcement@{mdns\+Responder\+Send\+Announcement}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Send\+Announcement()}{mdnsResponderSendAnnouncement()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Send\+Announcement (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send announcement packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 850 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
851 \{
852    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
853    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
854    \hyperlink{structMdnsMessage}{MdnsMessage} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
855 
856    \textcolor{comment}{//Point to the underlying network interface}
857    \textcolor{keyword}{interface }= context->settings.interface;
858 
859    \textcolor{comment}{//Create an empty mDNS response message}
860    error = \hyperlink{mdns__common_8c_a5c5005850cf4d8dd089bbd62641aa9ba}{mdnsCreateMessage}(&message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
861    \textcolor{comment}{//Any error to report?}
862    \textcolor{keywordflow}{if}(error)
863       \textcolor{keywordflow}{return} error;
864 
865    \textcolor{comment}{//Start of exception handling block}
866    \textcolor{keywordflow}{do}
867    \{
868       \textcolor{comment}{//Format A resource record}
869       error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
870          &message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
871       \textcolor{comment}{//Any error to report?}
872       \textcolor{keywordflow}{if}(error)
873          \textcolor{keywordflow}{break};
874 
875       \textcolor{comment}{//Format reverse address mapping PTR record (IPv4)}
876       error = \hyperlink{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}{mdnsResponderAddIpv4ReversePtrRecord}(interface,
877          &message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
878       \textcolor{comment}{//Any error to report?}
879       \textcolor{keywordflow}{if}(error)
880          \textcolor{keywordflow}{break};
881 
882       \textcolor{comment}{//Format AAAA resource record}
883       error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
884          &message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
885       \textcolor{comment}{//Any error to report?}
886       \textcolor{keywordflow}{if}(error)
887          \textcolor{keywordflow}{break};
888 
889       \textcolor{comment}{//Format reverse address mapping PTR record (IPv6)}
890       error = \hyperlink{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}{mdnsResponderAddIpv6ReversePtrRecord}(interface,
891          &message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
892       \textcolor{comment}{//Any error to report?}
893       \textcolor{keywordflow}{if}(error)
894          \textcolor{keywordflow}{break};
895 
896       \textcolor{comment}{//Send mDNS message}
897       error = \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, &message, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
898 
899       \textcolor{comment}{//End of exception handling block}
900    \} \textcolor{keywordflow}{while}(0);
901 
902    \textcolor{comment}{//Free previously allocated memory}
903    \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&message);
904 
905    \textcolor{comment}{//Return status code}
906    \textcolor{keywordflow}{return} error;
907 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_aff6e6f4101f0dab8b6a12177c3b79b78}\label{mdns__responder_8c_aff6e6f4101f0dab8b6a12177c3b79b78}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Send\+Goodbye@{mdns\+Responder\+Send\+Goodbye}}
\index{mdns\+Responder\+Send\+Goodbye@{mdns\+Responder\+Send\+Goodbye}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Send\+Goodbye()}{mdnsResponderSendGoodbye()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Send\+Goodbye (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send goodbye packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 916 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
917 \{
918    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
919    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
920    \hyperlink{structMdnsMessage}{MdnsMessage} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
921 
922    \textcolor{comment}{//Point to the underlying network interface}
923    \textcolor{keyword}{interface }= context->settings.interface;
924 
925    \textcolor{comment}{//Create an empty mDNS response message}
926    error = \hyperlink{mdns__common_8c_a5c5005850cf4d8dd089bbd62641aa9ba}{mdnsCreateMessage}(&message, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
927    \textcolor{comment}{//Any error to report?}
928    \textcolor{keywordflow}{if}(error)
929       \textcolor{keywordflow}{return} error;
930 
931    \textcolor{comment}{//Start of exception handling block}
932    \textcolor{keywordflow}{do}
933    \{
934       \textcolor{comment}{//Format A resource record}
935       error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface, &message, 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, 0);
936       \textcolor{comment}{//Any error to report?}
937       \textcolor{keywordflow}{if}(error)
938          \textcolor{keywordflow}{break};
939 
940       \textcolor{comment}{//Format reverse address mapping PTR record (IPv4)}
941       error = \hyperlink{mdns__responder_8c_ab0dc6056b3f7e9d7437b2c816a8f65b5}{mdnsResponderAddIpv4ReversePtrRecord}(interface, &message,
       \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, 0);
942       \textcolor{comment}{//Any error to report?}
943       \textcolor{keywordflow}{if}(error)
944          \textcolor{keywordflow}{break};
945 
946       \textcolor{comment}{//Format AAAA resource record}
947       error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface, &message, 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, 0);
948       \textcolor{comment}{//Any error to report?}
949       \textcolor{keywordflow}{if}(error)
950          \textcolor{keywordflow}{break};
951 
952       \textcolor{comment}{//Format reverse address mapping PTR record (IPv6)}
953       error = \hyperlink{mdns__responder_8c_a929c0bca2b61f5e746bfcdba33c4cee2}{mdnsResponderAddIpv6ReversePtrRecord}(interface, &message,
       \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, 0);
954       \textcolor{comment}{//Any error to report?}
955       \textcolor{keywordflow}{if}(error)
956          \textcolor{keywordflow}{break};
957 
958       \textcolor{comment}{//Send mDNS message}
959       error = \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, &message, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
960 
961       \textcolor{comment}{//End of exception handling block}
962    \} \textcolor{keywordflow}{while}(0);
963 
964    \textcolor{comment}{//Free previously allocated memory}
965    \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&message);
966 
967    \textcolor{comment}{//Return status code}
968    \textcolor{keywordflow}{return} error;
969 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_af0353544650bba929c9bbcba3e6b12ee}\label{mdns__responder_8c_af0353544650bba929c9bbcba3e6b12ee}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Send\+Probe@{mdns\+Responder\+Send\+Probe}}
\index{mdns\+Responder\+Send\+Probe@{mdns\+Responder\+Send\+Probe}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Send\+Probe()}{mdnsResponderSendProbe()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Send\+Probe (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Send probe packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 775 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
776 \{
777    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
778    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
779    \hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion} *dnsQuestion;
780    \hyperlink{structMdnsMessage}{MdnsMessage} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
781 
782    \textcolor{comment}{//Point to the underlying network interface}
783    \textcolor{keyword}{interface }= context->settings.interface;
784 
785    \textcolor{comment}{//Create an empty mDNS query message}
786    error = \hyperlink{mdns__common_8c_a5c5005850cf4d8dd089bbd62641aa9ba}{mdnsCreateMessage}(&message, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
787    \textcolor{comment}{//Any error to report?}
788    \textcolor{keywordflow}{if}(error)
789       \textcolor{keywordflow}{return} error;
790 
791    \textcolor{comment}{//Start of exception handling block}
792    \textcolor{keywordflow}{do}
793    \{
794       \textcolor{comment}{//Encode the host name using the DNS name notation}
795       message.\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} += \hyperlink{mdns__common_8c_a5e982ed651cae31a97f043d2258e3fc0}{mdnsEncodeName}(context->hostname, \textcolor{stringliteral}{""},
796          \textcolor{stringliteral}{".local"}, message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->questions);
797 
798       \textcolor{comment}{//Point to the corresponding question structure}
799       dnsQuestion = \hyperlink{dns__common_8h_a66ca704f3f850dcbb2f3ceefe90afcc5}{DNS\_GET\_QUESTION}(message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message.
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length});
800 
801       \textcolor{comment}{//The probes should be sent as QU questions with the unicast-response}
802       \textcolor{comment}{//bit set, to allow a defending host to respond immediately via unicast}
803       dnsQuestion->qtype = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a8f6102b9591501cd59e38352db0f94b0}{DNS\_RR\_TYPE\_ANY});
804       dnsQuestion->qclass = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{mdns__common_8h_ac11a61056f0e21d666d58a0e433848df}{MDNS\_QCLASS\_QU} | 
      \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN});
805 
806       \textcolor{comment}{//Update the length of the mDNS query message}
807       message.\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion});
808 
809       \textcolor{comment}{//Format A resource record}
810       error = \hyperlink{mdns__responder_8c_a46c6f23b8ed963979704e18af1fbd144}{mdnsResponderAddIpv4AddrRecord}(interface,
811          &message, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
812       \textcolor{comment}{//Any error to report?}
813       \textcolor{keywordflow}{if}(error)
814          \textcolor{keywordflow}{break};
815 
816       \textcolor{comment}{//Format AAAA resource record}
817       error = \hyperlink{mdns__responder_8c_a8d51436368d879f23454941b3e9ef02e}{mdnsResponderAddIpv6AddrRecord}(interface,
818          &message, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{MDNS\_DEFAULT\_RR\_TTL});
819       \textcolor{comment}{//Any error to report?}
820       \textcolor{keywordflow}{if}(error)
821          \textcolor{keywordflow}{break};
822 
823       \textcolor{comment}{//Number of questions in the Question Section}
824       message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount = 1;
825       \textcolor{comment}{//Number of resource records in the Authority Section}
826       message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount = message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount;
827       \textcolor{comment}{//Number of resource records in the Answer Section}
828       message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount = 0;
829 
830       \textcolor{comment}{//Send mDNS message}
831       error = \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, &message, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
832 
833       \textcolor{comment}{//End of exception handling block}
834    \} \textcolor{keywordflow}{while}(0);
835 
836    \textcolor{comment}{//Free previously allocated memory}
837    \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&message);
838 
839    \textcolor{comment}{//Return status code}
840    \textcolor{keywordflow}{return} error;
841 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_afa9ff99deaa1f44603d79cf3226c2a7a}\label{mdns__responder_8c_afa9ff99deaa1f44603d79cf3226c2a7a}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Set\+Hostname@{mdns\+Responder\+Set\+Hostname}}
\index{mdns\+Responder\+Set\+Hostname@{mdns\+Responder\+Set\+Hostname}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Set\+Hostname()}{mdnsResponderSetHostname()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Set\+Hostname (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{hostname }\end{DoxyParamCaption})}



Set hostname. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\mbox{\tt in}  & {\em hostname} & N\+U\+L\+L-\/terminated string that contains the hostname \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 206 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
208 \{
209    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
210 
211    \textcolor{comment}{//Check parameters}
212    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{tls_8h_a7126f716c1f4f6978233fe47eb83d2a9}{hostname} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
213       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
214 
215    \textcolor{comment}{//Get exclusive access}
216    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
217 
218    \textcolor{comment}{//Point to the underlying network interface}
219    \textcolor{keyword}{interface }= context->settings.interface;
220 
221    \textcolor{comment}{//Check whether a hostname is already assigned}
222    \textcolor{keywordflow}{if}(context->hostname[0] != \textcolor{charliteral}{'\(\backslash\)0'})
223    \{
224       \textcolor{comment}{//Check whether the link is up}
225       \textcolor{keywordflow}{if}(interface->linkState)
226       \{
227          \textcolor{comment}{//Send a goodbye packet}
228          \hyperlink{mdns__responder_8c_aff6e6f4101f0dab8b6a12177c3b79b78}{mdnsResponderSendGoodbye}(context);
229       \}
230    \}
231 
232    \textcolor{comment}{//Set hostname}
233    \hyperlink{str_8c_ac10cb0bca1fb0c39b2c765afd068486d}{strSafeCopy}(context->hostname, \hyperlink{tls_8h_a7126f716c1f4f6978233fe47eb83d2a9}{hostname},
234       \hyperlink{mdns__responder_8h_a64d75efcec0851c52a5e19d8ef2b1e1d}{MDNS\_RESPONDER\_MAX\_HOSTNAME\_LEN});
235 
236    \textcolor{comment}{//Restart probing process (hostname)}
237    \hyperlink{mdns__responder_8c_ad0aa26e45ce7db6737cb978d4fedea0a}{mdnsResponderStartProbing}(interface->mdnsResponderContext);
238 
239 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
240    \textcolor{comment}{//Restart probing process (service instance name)}
241    \hyperlink{dns__sd_8c_a1c979323e188c71ba4e21432be27b969}{dnsSdStartProbing}(interface->dnsSdContext);
242 \textcolor{preprocessor}{#endif}
243 
244    \textcolor{comment}{//Release exclusive access}
245    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
246 
247    \textcolor{comment}{//Successful processing}
248    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
249 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a460aaaa48ccde8752f2b02f7a35a1fde}\label{mdns__responder_8c_a460aaaa48ccde8752f2b02f7a35a1fde}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Set\+Ipv4\+Reverse\+Name@{mdns\+Responder\+Set\+Ipv4\+Reverse\+Name}}
\index{mdns\+Responder\+Set\+Ipv4\+Reverse\+Name@{mdns\+Responder\+Set\+Ipv4\+Reverse\+Name}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Set\+Ipv4\+Reverse\+Name()}{mdnsResponderSetIpv4ReverseName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Set\+Ipv4\+Reverse\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate domain name for reverse D\+NS lookup (I\+Pv4) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 258 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
259 \{
260 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
261    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
262    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
263 
264    \textcolor{comment}{//Check whether the mDNS responder has been properly instantiated}
265    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
266       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
267 
268    \textcolor{comment}{//Point to the underlying network interface}
269    \textcolor{keyword}{interface }= context->settings.interface;
270 
271    \textcolor{comment}{//Check whether the host address is valid}
272    \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state == \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
273    \{
274       \textcolor{comment}{//Cast the IPv4 address as byte array}
275       addr = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) &interface->ipv4Context.addrList[0].addr;
276 
277       \textcolor{comment}{//Generate the domain name for reverse DNS lookup}
278       sprintf(context->ipv4ReverseName, \textcolor{stringliteral}{"%"} PRIu8 \textcolor{stringliteral}{".%"} PRIu8 \textcolor{stringliteral}{".%"} PRIu8 \textcolor{stringliteral}{".%"} PRIu8,
279          addr[3], addr[2], addr[1], addr[0]);
280    \}
281    \textcolor{keywordflow}{else}
282    \{
283       \textcolor{comment}{//The host address is not valid}
284       context->ipv4ReverseName[0] = \textcolor{charliteral}{'\(\backslash\)0'};
285    \}
286 \textcolor{preprocessor}{#endif}
287 
288    \textcolor{comment}{//Successful processing}
289    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
290 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a627c95ee7f8bc371d5692ac8b0790219}\label{mdns__responder_8c_a627c95ee7f8bc371d5692ac8b0790219}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Set\+Ipv6\+Reverse\+Name@{mdns\+Responder\+Set\+Ipv6\+Reverse\+Name}}
\index{mdns\+Responder\+Set\+Ipv6\+Reverse\+Name@{mdns\+Responder\+Set\+Ipv6\+Reverse\+Name}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Set\+Ipv6\+Reverse\+Name()}{mdnsResponderSetIpv6ReverseName()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Set\+Ipv6\+Reverse\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate domain name for reverse D\+NS lookup (I\+Pv6) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 299 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
300 \{
301 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
302    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
303    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
304    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
305    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
306    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
307    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
308 
309    \textcolor{comment}{//Check whether the mDNS responder has been properly instantiated}
310    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
311       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
312 
313    \textcolor{comment}{//Point to the underlying network interface}
314    \textcolor{keyword}{interface }= context->settings.interface;
315 
316    \textcolor{comment}{//Point to the buffer where to format the reverse name}
317    p = context->ipv6ReverseName;
318 
319    \textcolor{comment}{//Check whether the link-local address is valid}
320    \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
321    \{
322       \textcolor{comment}{//Cast the IPv4 address as byte array}
323       addr = interface->ipv6Context.addrList[0].addr.b;
324 
325       \textcolor{comment}{//Generate the domain name for reverse DNS lookup}
326       \textcolor{keywordflow}{for}(i = 0; i < 32; i++)
327       \{
328          \textcolor{comment}{//Calculate the shift count}
329          n = (31 - i) / 2;
330          m = (i % 2) * 4;
331 
332          \textcolor{comment}{//Format the current digit}
333          p += sprintf(p, \textcolor{stringliteral}{"%"} PRIx8, (addr[n] >> m) & 0x0F);
334 
335          \textcolor{comment}{//Add a delimiter character}
336          \textcolor{keywordflow}{if}(i != 31)
337             p += sprintf(p, \textcolor{stringliteral}{"."});
338       \}
339    \}
340    \textcolor{keywordflow}{else}
341    \{
342       \textcolor{comment}{//The link-local address is not valid}
343       p[0] = \textcolor{charliteral}{'\(\backslash\)0'};
344    \}
345 \textcolor{preprocessor}{#endif}
346 
347    \textcolor{comment}{//Successful processing}
348    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
349 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a5950dabe2e7f4d9c439026d529e353f8}\label{mdns__responder_8c_a5950dabe2e7f4d9c439026d529e353f8}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Start@{mdns\+Responder\+Start}}
\index{mdns\+Responder\+Start@{mdns\+Responder\+Start}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Start()}{mdnsResponderStart()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Start (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Start m\+D\+NS responder. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 121 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
122 \{
123    \textcolor{comment}{//Check parameter}
124    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
125       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
126 
127    \textcolor{comment}{//Debug message}
128    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Starting mDNS responder...\(\backslash\)r\(\backslash\)n"});
129 
130    \textcolor{comment}{//Get exclusive access}
131    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
132 
133    \textcolor{comment}{//Start mDNS responder}
134    context->running = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
135    \textcolor{comment}{//Initialize state machine}
136    context->state = \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT};
137 
138    \textcolor{comment}{//Release exclusive access}
139    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
140 
141    \textcolor{comment}{//Successful processing}
142    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
143 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_ad0aa26e45ce7db6737cb978d4fedea0a}\label{mdns__responder_8c_ad0aa26e45ce7db6737cb978d4fedea0a}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Start\+Probing@{mdns\+Responder\+Start\+Probing}}
\index{mdns\+Responder\+Start\+Probing@{mdns\+Responder\+Start\+Probing}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Start\+Probing()}{mdnsResponderStartProbing()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Start\+Probing (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Restart probing process. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 358 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
359 \{
360    \textcolor{comment}{//Check whether the mDNS responder has been properly instantiated}
361    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
362       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
363 
364    \textcolor{comment}{//Generate domain names for reverse DNS lookup}
365    \hyperlink{mdns__responder_8c_a460aaaa48ccde8752f2b02f7a35a1fde}{mdnsResponderSetIpv4ReverseName}(context);
366    \hyperlink{mdns__responder_8c_a627c95ee7f8bc371d5692ac8b0790219}{mdnsResponderSetIpv6ReverseName}(context);
367 
368    \textcolor{comment}{//Force mDNS responder to start probing again}
369    context->state = \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT};
370 
371    \textcolor{comment}{//Successful processing}
372    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
373 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_adfe40f35242ae26430bbb53b3e0b8378}\label{mdns__responder_8c_adfe40f35242ae26430bbb53b3e0b8378}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Stop@{mdns\+Responder\+Stop}}
\index{mdns\+Responder\+Stop@{mdns\+Responder\+Stop}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Stop()}{mdnsResponderStop()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Responder\+Stop (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Stop m\+D\+NS responder. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 152 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
153 \{
154    \textcolor{comment}{//Check parameter}
155    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
156       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
157 
158    \textcolor{comment}{//Debug message}
159    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Stopping mDNS responder...\(\backslash\)r\(\backslash\)n"});
160 
161    \textcolor{comment}{//Get exclusive access}
162    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
163 
164    \textcolor{comment}{//Suspend mDNS responder}
165    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
166    \textcolor{comment}{//Reinitialize state machine}
167    context->state = \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT};
168 
169    \textcolor{comment}{//Release exclusive access}
170    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
171 
172    \textcolor{comment}{//Successful processing}
173    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
174 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__responder_8c_a54a08294cdc64f15a41da79a319f6ed5}\label{mdns__responder_8c_a54a08294cdc64f15a41da79a319f6ed5}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Tick@{mdns\+Responder\+Tick}}
\index{mdns\+Responder\+Tick@{mdns\+Responder\+Tick}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Tick()}{mdnsResponderTick()}}
{\footnotesize\ttfamily void mdns\+Responder\+Tick (\begin{DoxyParamCaption}\item[{\hyperlink{mdns__responder_8h_a568880b401f701b835db7d635fb0ea38}{Mdns\+Responder\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



m\+D\+NS responder timer handler 

This routine must be periodically called by the T\+C\+P/\+IP stack to manage m\+D\+NS operation


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the m\+D\+NS responder context \\
\hline
\end{DoxyParams}


Definition at line 385 of file mdns\+\_\+responder.\+c.


\begin{DoxyCode}
386 \{
387    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} valid;
388    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
389    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} delay;
390    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
391    \hyperlink{structIpAddr}{IpAddr} \hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{destIpAddr};
392 
393    \textcolor{comment}{//Make sure the mDNS responder has been properly instantiated}
394    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
395       \textcolor{keywordflow}{return};
396 
397    \textcolor{comment}{//Point to the underlying network interface}
398    \textcolor{keyword}{interface }= context->settings.interface;
399 
400    \textcolor{comment}{//Get current time}
401    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
402 
403    \textcolor{comment}{//Check current state}
404    \textcolor{keywordflow}{if}(context->state == \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a07bf42369da461365aaa364eb11851eb}{MDNS\_STATE\_INIT})
405    \{
406       \textcolor{comment}{//Wait for the link to be up before starting mDNS responder}
407       \textcolor{keywordflow}{if}(context->running && interface->linkState)
408       \{
409          \textcolor{comment}{//Check whether a hostname has been assigned}
410          \textcolor{keywordflow}{if}(context->hostname[0] != \textcolor{charliteral}{'\(\backslash\)0'})
411          \{
412             \textcolor{comment}{//Clear flag}
413             valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
414 
415 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
416             \textcolor{comment}{//Check whether the IPv4 host address is valid}
417             \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state == \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
418                valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
419 \textcolor{preprocessor}{#endif}
420 
421 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
422             \textcolor{comment}{//Check whether the IPv6 link-local address is valid}
423             \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
424                valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
425 \textcolor{preprocessor}{#endif}
426             \textcolor{comment}{//Any valid IP address assigned to the network interface?}
427             \textcolor{keywordflow}{if}(valid)
428             \{
429                \textcolor{comment}{//Wait until both IPv4 and IPv6 addresses are valid}
430                \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a2025260fb4620dcce2b9320cb6735356}{MDNS\_STATE\_WAITING}, 0);
431             \}
432          \}
433       \}
434    \}
435    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a2025260fb4620dcce2b9320cb6735356}{MDNS\_STATE\_WAITING})
436    \{
437       \textcolor{comment}{//Set flag}
438       valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
439 
440       \textcolor{comment}{//Check current time}
441       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + 
      \hyperlink{mdns__responder_8h_a6f9a8265023f1611628a3628b5ce5d96}{MDNS\_MAX\_WAITING\_DELAY}) < 0)
442       \{
443 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
444          \textcolor{comment}{//Check whether the IPv4 host address is valid}
445          \textcolor{keywordflow}{if}(interface->ipv4Context.addrList[0].state != \hyperlink{ipv4_8h_a7bc59b5d625b1217a91f1db3917e8358a10bd90ad767ea6ae259e9016e6186477}{IPV4\_ADDR\_STATE\_VALID})
446             valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
447 \textcolor{preprocessor}{#endif}
448 
449 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
450          \textcolor{comment}{//Check whether the IPv6 link-local address is valid}
451          \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) != 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
452             valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
453 \textcolor{preprocessor}{#endif}
454       \}
455 
456       \textcolor{comment}{//Start probing?}
457       \textcolor{keywordflow}{if}(valid)
458       \{
459          \textcolor{comment}{//Initial random delay}
460          delay = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(\hyperlink{mdns__responder_8h_a7471afd8ab708e1e6f27ca54a41ecc31}{MDNS\_RAND\_DELAY\_MIN}, 
      \hyperlink{mdns__responder_8h_a8e6f1dcd2e7c284c05d3a1369a1b28cb}{MDNS\_RAND\_DELAY\_MAX});
461          \textcolor{comment}{//Perform probing}
462          \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING}, delay);
463       \}
464    \}
465    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING})
466    \{
467       \textcolor{comment}{//Probing failed?}
468       \textcolor{keywordflow}{if}(context->conflict && context->retransmitCount > 0)
469       \{
470          \textcolor{comment}{//Programmatically change the host name}
471          \hyperlink{mdns__responder_8c_a1a8143eafc48f426d554efd9c8841c17}{mdnsResponderChangeHostname}(context);
472          \textcolor{comment}{//Probe again, and repeat as necessary until a unique name is found}
473          \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING}, 0);
474       \}
475       \textcolor{comment}{//Tie-break lost?}
476       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->tieBreakLost && context->retransmitCount > 0)
477       \{
478          \textcolor{comment}{//The host defers to the winning host by waiting one second, and}
479          \textcolor{comment}{//then begins probing for this record again}
480          \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING}, \hyperlink{mdns__responder_8h_a710d6b6bffaacff828baae713ae6702d}{MDNS\_PROBE\_DEFER});
481       \}
482       \textcolor{keywordflow}{else}
483       \{
484          \textcolor{comment}{//Check current time}
485          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
486          \{
487             \textcolor{comment}{//Probing is on-going?}
488             \textcolor{keywordflow}{if}(context->retransmitCount < \hyperlink{mdns__responder_8h_a7c7cd62b00b21fe62a16cf7a04680452}{MDNS\_PROBE\_NUM})
489             \{
490                \textcolor{comment}{//First probe?}
491                \textcolor{keywordflow}{if}(context->retransmitCount == 0)
492                \{
493                   \textcolor{comment}{//Apparently conflicting mDNS responses received before the}
494                   \textcolor{comment}{//first probe packet is sent must be silently ignored}
495                   context->conflict = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
496                   context->tieBreakLost = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
497                \}
498 
499                \textcolor{comment}{//Send probe packet}
500                \hyperlink{mdns__responder_8c_af0353544650bba929c9bbcba3e6b12ee}{mdnsResponderSendProbe}(context);
501 
502                \textcolor{comment}{//Save the time at which the packet was sent}
503                context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
504                \textcolor{comment}{//Time interval between subsequent probe packets}
505                context->timeout = \hyperlink{mdns__responder_8h_a1067b123a81b11edaf8965deddb49215}{MDNS\_PROBE\_DELAY};
506                \textcolor{comment}{//Increment retransmission counter}
507                context->retransmitCount++;
508             \}
509             \textcolor{comment}{//Probing is complete?}
510             \textcolor{keywordflow}{else}
511             \{
512                \textcolor{comment}{//The mDNS responder must send unsolicited mDNS responses}
513                \textcolor{comment}{//containing all of its newly registered resource records}
514                \textcolor{keywordflow}{if}(context->settings.numAnnouncements > 0)
515                   \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a5669572319cfacc11b9d9fd5c70a6933}{MDNS\_STATE\_ANNOUNCING}, 0);
516                \textcolor{keywordflow}{else}
517                   \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a94d5f006d5512a42d0a63b7cc981b626}{MDNS\_STATE\_IDLE}, 0);
518             \}
519          \}
520       \}
521    \}
522    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a5669572319cfacc11b9d9fd5c70a6933}{MDNS\_STATE\_ANNOUNCING})
523    \{
524       \textcolor{comment}{//Whenever a mDNS responder receives any mDNS response (solicited or}
525       \textcolor{comment}{//otherwise) containing a conflicting resource record, the conflict}
526       \textcolor{comment}{//must be resolved}
527       \textcolor{keywordflow}{if}(context->conflict)
528       \{
529          \textcolor{comment}{//Probe again, and repeat as necessary until a unique name is found}
530          \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING}, 0);
531       \}
532       \textcolor{keywordflow}{else}
533       \{
534          \textcolor{comment}{//Check current time}
535          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
536          \{
537             \textcolor{comment}{//Send announcement packet}
538             \hyperlink{mdns__responder_8c_a7ae84cb7fe81e99cc89d2cb818826e8e}{mdnsResponderSendAnnouncement}(context);
539 
540             \textcolor{comment}{//Save the time at which the packet was sent}
541             context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
542             \textcolor{comment}{//Increment retransmission counter}
543             context->retransmitCount++;
544 
545             \textcolor{comment}{//First announcement packet?}
546             \textcolor{keywordflow}{if}(context->retransmitCount == 1)
547             \{
548                \textcolor{comment}{//The mDNS responder must send at least two unsolicited}
549                \textcolor{comment}{//responses, one second apart}
550                context->timeout = \hyperlink{mdns__responder_8h_a1c8efded400eb0e4c9c24628a56a593b}{MDNS\_ANNOUNCE\_DELAY};
551             \}
552             \textcolor{keywordflow}{else}
553             \{
554                \textcolor{comment}{//To provide increased robustness against packet loss, a mDNS}
555                \textcolor{comment}{//responder may send up to eight unsolicited responses, provided}
556                \textcolor{comment}{//that the interval between unsolicited responses increases by}
557                \textcolor{comment}{//at least a factor of two with every response sent}
558                context->timeout *= 2;
559             \}
560 
561             \textcolor{comment}{//Last announcement packet?}
562             \textcolor{keywordflow}{if}(context->retransmitCount >= context->settings.numAnnouncements)
563             \{
564                \textcolor{comment}{//A mDNS responder must not send regular periodic announcements}
565                \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a94d5f006d5512a42d0a63b7cc981b626}{MDNS\_STATE\_IDLE}, 0);
566             \}
567          \}
568       \}
569    \}
570    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3a94d5f006d5512a42d0a63b7cc981b626}{MDNS\_STATE\_IDLE})
571    \{
572       \textcolor{comment}{//Whenever a mDNS responder receives any mDNS response (solicited or}
573       \textcolor{comment}{//otherwise) containing a conflicting resource record, the conflict}
574       \textcolor{comment}{//must be resolved}
575       \textcolor{keywordflow}{if}(context->conflict)
576       \{
577          \textcolor{comment}{//Probe again, and repeat as necessary until a unique name is found}
578          \hyperlink{mdns__responder_8c_add7481fbc1d8c5da014ffb0409bec0f0}{mdnsResponderChangeState}(context, 
      \hyperlink{mdns__responder_8h_a96ee67ecc8252ba576e72c97cd8f7fd3afe2b52e127507e69fe1782db03bc234e}{MDNS\_STATE\_PROBING}, 0);
579       \}
580    \}
581 
582 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
583    \textcolor{comment}{//Any response message pending to be sent?}
584    \textcolor{keywordflow}{if}(context->ipv4Response.buffer != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
585    \{
586       \textcolor{comment}{//Check whether the time delay has elapsed}
587       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->ipv4Response.timestamp +
588          context->ipv4Response.timeout) >= 0)
589       \{
590 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
591          \textcolor{comment}{//Additional record generation (DNS-SD)}
592          \hyperlink{dns__sd_8c_a6cbe9ebfd668ed81e14bb040c8ee274c}{dnsSdGenerateAdditionalRecords}(interface,
593             &context->ipv4Response, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
594 \textcolor{preprocessor}{#endif}
595          \textcolor{comment}{//Additional record generation (mDNS)}
596          \hyperlink{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}{mdnsResponderGenerateAdditionalRecords}(interface,
597             &context->ipv4Response, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
598 
599          \textcolor{comment}{//Use mDNS IPv4 multicast address}
600          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
601          destIpAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr} = \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{MDNS\_IPV4\_MULTICAST\_ADDR};
602 
603          \textcolor{comment}{//Send mDNS response message}
604          \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, &context->ipv4Response,
605             &destIpAddr, \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
606 
607          \textcolor{comment}{//Free previously allocated memory}
608          \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&context->ipv4Response);
609       \}
610    \}
611 \textcolor{preprocessor}{#endif}
612 
613 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
614    \textcolor{comment}{//Any response message pending to be sent?}
615    \textcolor{keywordflow}{if}(context->ipv6Response.buffer != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
616    \{
617       \textcolor{comment}{//Check whether the time delay has elapsed}
618       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->ipv6Response.timestamp +
619          context->ipv6Response.timeout) >= 0)
620       \{
621 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
622          \textcolor{comment}{//Additional record generation (DNS-SD)}
623          \hyperlink{dns__sd_8c_a6cbe9ebfd668ed81e14bb040c8ee274c}{dnsSdGenerateAdditionalRecords}(interface,
624             &context->ipv6Response, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
625 \textcolor{preprocessor}{#endif}
626          \textcolor{comment}{//Additional record generation (mDNS)}
627          \hyperlink{mdns__responder_8c_af9545c0ae77f0bbf420e17339e737667}{mdnsResponderGenerateAdditionalRecords}(interface,
628             &context->ipv6Response, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
629 
630          \textcolor{comment}{//Use mDNS IPv6 multicast address}
631          destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
632          destIpAddr.\hyperlink{structIpAddr_a9bc2340a9c0bc5a0b8aa9695b74e2ee6}{ipv6Addr} = \hyperlink{mdns__common_8c_a74c29f24464b2cbb5c7754c264a462a2}{MDNS\_IPV6\_MULTICAST\_ADDR};
633 
634          \textcolor{comment}{//Send mDNS response message}
635          \hyperlink{mdns__common_8c_ae9c33998a8a019066d4da724a80f6674}{mdnsSendMessage}(interface, &context->ipv6Response,
636             &destIpAddr, \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT});
637 
638          \textcolor{comment}{//Free previously allocated memory}
639          \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(&context->ipv6Response);
640       \}
641    \}
642 \textcolor{preprocessor}{#endif}
643 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{mdns__responder_8c_a1b24a54d278d510b4af4eea8b2f44855}\label{mdns__responder_8c_a1b24a54d278d510b4af4eea8b2f44855}} 
\index{mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}!mdns\+Responder\+Tick\+Counter@{mdns\+Responder\+Tick\+Counter}}
\index{mdns\+Responder\+Tick\+Counter@{mdns\+Responder\+Tick\+Counter}!mdns\+\_\+responder.\+c@{mdns\+\_\+responder.\+c}}
\subsubsection{\texorpdfstring{mdns\+Responder\+Tick\+Counter}{mdnsResponderTickCounter}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} mdns\+Responder\+Tick\+Counter}



Definition at line 49 of file mdns\+\_\+responder.\+c.

