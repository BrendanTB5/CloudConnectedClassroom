\hypertarget{nm__bus__wrapper__stm32h7xx_8c}{}\section{third\+\_\+party/atmel/devices/wilc1000/bus\+\_\+wrapper/source/nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.c File Reference}
\label{nm__bus__wrapper__stm32h7xx_8c}\index{third\+\_\+party/atmel/devices/wilc1000/bus\+\_\+wrapper/source/nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{third\+\_\+party/atmel/devices/wilc1000/bus\+\_\+wrapper/source/nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}


S\+PI bus wrapper for S\+T\+M32\+H7xx microcontrollers.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}stm32h7xx.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp/include/nm\+\_\+bsp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}common/include/nm\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bus\+\_\+wrapper/include/nm\+\_\+bus\+\_\+wrapper.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{nm__bus__wrapper__stm32h7xx_8c_afbc973888cb214292ecd9094a69adf68}{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}~4096
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_ae656e55934eaeffc372287189b5e0d5b}{spi\+\_\+rw} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Mosi, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Miso, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+Sz)
\begin{DoxyCompactList}\small\item\em S\+PI transfer. \end{DoxyCompactList}\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_ac6735b4dcb286ba50ed1b2db8ae04d31}{nm\+\_\+bus\+\_\+init} (void $\ast$pvinit)
\begin{DoxyCompactList}\small\item\em S\+PI bus initialization. \end{DoxyCompactList}\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_aa98500dc13748397906e03440fb3892a}{nm\+\_\+bus\+\_\+ioctl} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Cmd, void $\ast$pv\+Parameter)
\begin{DoxyCompactList}\small\item\em I\+O\+C\+TL command processing. \end{DoxyCompactList}\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a577ad43e9d464f7309b5ffa75f4ae15a}{nm\+\_\+bus\+\_\+deinit} (void)
\begin{DoxyCompactList}\small\item\em S\+PI bus deinitialization. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static S\+P\+I\+\_\+\+Handle\+Type\+Def \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{S\+P\+I\+\_\+\+Handle}
\item 
static \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{tx\+Buffer} \mbox{[}\hyperlink{nm__bus__wrapper__stm32l4xx_8c_afbc973888cb214292ecd9094a69adf68}{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}\mbox{]}
\item 
static \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}{rx\+Buffer} \mbox{[}\hyperlink{nm__bus__wrapper__stm32l4xx_8c_afbc973888cb214292ecd9094a69adf68}{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}\mbox{]}
\item 
\hyperlink{structtstrNmBusCapabilities}{tstr\+Nm\+Bus\+Capabilities} \hyperlink{nm__bus__wrapper__stm32h7xx_8c_ae7dfa29166b4111ca6c3e3bab953eb79}{egstr\+Nm\+Bus\+Capabilities}
\begin{DoxyCompactList}\small\item\em Bus capabilities information. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+PI bus wrapper for S\+T\+M32\+H7xx microcontrollers. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_afbc973888cb214292ecd9094a69adf68}\label{nm__bus__wrapper__stm32h7xx_8c_afbc973888cb214292ecd9094a69adf68}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ@{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}}
\index{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ@{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}{NM\_BUS\_MAX\_TRX\_SZ}}
{\footnotesize\ttfamily \#define N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ~4096}



Definition at line 38 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_a577ad43e9d464f7309b5ffa75f4ae15a}\label{nm__bus__wrapper__stm32h7xx_8c_a577ad43e9d464f7309b5ffa75f4ae15a}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!nm\+\_\+bus\+\_\+deinit@{nm\+\_\+bus\+\_\+deinit}}
\index{nm\+\_\+bus\+\_\+deinit@{nm\+\_\+bus\+\_\+deinit}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+bus\+\_\+deinit()}{nm\_bus\_deinit()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+bus\+\_\+deinit (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



S\+PI bus deinitialization. 

De-\/initialize the bus wrapper.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pvinit} & Unused parameter \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status code (M2\+M\+\_\+\+S\+U\+C\+C\+E\+SS or M2\+M\+\_\+\+E\+R\+R\+\_\+\+B\+U\+S\+\_\+\+F\+A\+IL) 
\end{DoxyReturn}


Definition at line 269 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.


\begin{DoxyCode}
270 \{
271    \textcolor{comment}{//Not implemented}
272    \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
273 \}
\end{DoxyCode}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_ac6735b4dcb286ba50ed1b2db8ae04d31}\label{nm__bus__wrapper__stm32h7xx_8c_ac6735b4dcb286ba50ed1b2db8ae04d31}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!nm\+\_\+bus\+\_\+init@{nm\+\_\+bus\+\_\+init}}
\index{nm\+\_\+bus\+\_\+init@{nm\+\_\+bus\+\_\+init}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+bus\+\_\+init()}{nm\_bus\_init()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+bus\+\_\+init (\begin{DoxyParamCaption}\item[{void $\ast$}]{pvinit }\end{DoxyParamCaption})}



S\+PI bus initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pvinit} & Unused parameter \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status code (M2\+M\+\_\+\+S\+U\+C\+C\+E\+SS or M2\+M\+\_\+\+E\+R\+R\+\_\+\+B\+U\+S\+\_\+\+F\+A\+IL) 
\end{DoxyReturn}


Definition at line 146 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.


\begin{DoxyCode}
147 \{
148    GPIO\_InitTypeDef GPIO\_InitStructure;
149 
150    \textcolor{comment}{//Enable GPIO clocks}
151    CONF\_WILC\_SCK\_GPIO\_CLK\_ENABLE();
152    CONF\_WILC\_MOSI\_GPIO\_CLK\_ENABLE();
153    CONF\_WILC\_MISO\_GPIO\_CLK\_ENABLE();
154 
155    \textcolor{comment}{//Enable SPI clock}
156    CONF\_WILC\_SPI\_CLK\_ENABLE();
157 
158    \textcolor{comment}{//Configure SCK}
159    GPIO\_InitStructure.Pin = CONF\_WILC\_SCK\_PIN;
160    GPIO\_InitStructure.Mode = GPIO\_MODE\_AF\_PP;
161    GPIO\_InitStructure.Pull = GPIO\_NOPULL;
162    GPIO\_InitStructure.Speed = CONF\_WILC\_SCK\_SPEED;
163    GPIO\_InitStructure.Alternate = CONF\_WILC\_SPI\_ALTERNATE;
164    HAL\_GPIO\_Init(CONF\_WILC\_SCK\_GPIO, &GPIO\_InitStructure);
165 
166    \textcolor{comment}{//Configure MOSI}
167    GPIO\_InitStructure.Pin = CONF\_WILC\_MOSI\_PIN;
168    GPIO\_InitStructure.Mode = GPIO\_MODE\_AF\_PP;
169    GPIO\_InitStructure.Pull = GPIO\_NOPULL;
170    GPIO\_InitStructure.Speed = CONF\_WILC\_MOSI\_SPEED;
171    GPIO\_InitStructure.Alternate = CONF\_WILC\_SPI\_ALTERNATE;
172    HAL\_GPIO\_Init(CONF\_WILC\_MOSI\_GPIO, &GPIO\_InitStructure);
173 
174    \textcolor{comment}{//Configure MISO}
175    GPIO\_InitStructure.Pin = CONF\_WILC\_MISO\_PIN;
176    GPIO\_InitStructure.Mode = GPIO\_MODE\_AF\_PP;
177    GPIO\_InitStructure.Pull = GPIO\_NOPULL;
178    GPIO\_InitStructure.Speed = CONF\_WILC\_MISO\_SPEED;
179    GPIO\_InitStructure.Alternate = CONF\_WILC\_SPI\_ALTERNATE;
180    HAL\_GPIO\_Init(CONF\_WILC\_MISO\_GPIO, &GPIO\_InitStructure);
181 
182 \textcolor{preprocessor}{#if 0}
183    \textcolor{comment}{//Configure SPI}
184    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Instance = CONF\_WILC\_SPI;
185    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.Mode = SPI\_MODE\_MASTER;
186    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.Direction = SPI\_DIRECTION\_2LINES;
187    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.DataSize = SPI\_DATASIZE\_8BIT;
188    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.CLKPolarity = SPI\_POLARITY\_LOW;
189    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.CLKPhase = SPI\_PHASE\_1EDGE;
190    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.NSS = SPI\_NSS\_SOFT;
191    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.BaudRatePrescaler = CONF\_WILC\_SPI\_BAUDRATE\_PRE;
192    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.FirstBit = SPI\_FIRSTBIT\_MSB;
193    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.TIMode = SPI\_TIMODE\_DISABLED;
194    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.CRCCalculation = SPI\_CRCCALCULATION\_DISABLED;
195    \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}.Init.CRCPolynomial = 7;
196    HAL\_SPI\_Init(&\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle});
197 
198    \textcolor{comment}{//Enable SPI}
199    \_\_HAL\_SPI\_ENABLE(&\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle});
200 \textcolor{preprocessor}{#else}
201    \textcolor{comment}{//Disable SPI}
202    CONF\_WILC\_SPI->CR1 &= ~SPI\_CR1\_SPE;
203 
204    \textcolor{comment}{//Configure SPI}
205    CONF\_WILC\_SPI->CFG1 = ((3 << 28) & SPI\_CFG1\_MBR) | ((7 << 16) & SPI\_CFG1\_CRCSIZE) | (7 & SPI\_CFG1\_DSIZE)
      ;
206    CONF\_WILC\_SPI->CFG2 = SPI\_CFG2\_MASTER | SPI\_CFG2\_SSOE;
207    CONF\_WILC\_SPI->I2SCFGR = 0;
208    CONF\_WILC\_SPI->CR2 = 0;
209 
210    \textcolor{comment}{//Enable SPI}
211    CONF\_WILC\_SPI->CR1 = SPI\_CR1\_SPE;
212    CONF\_WILC\_SPI->CR1 |= SPI\_CR1\_CSTART;
213 \textcolor{preprocessor}{#endif}
214 
215    \textcolor{comment}{//Reset WILC1000}
216    \hyperlink{group__NmBspResetFn_ga3e540428a9246a27c61999ecb7e13d05}{nm\_bsp\_reset}();
217 
218    \textcolor{comment}{//Successful operation}
219    \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
220 \}
\end{DoxyCode}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_aa98500dc13748397906e03440fb3892a}\label{nm__bus__wrapper__stm32h7xx_8c_aa98500dc13748397906e03440fb3892a}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!nm\+\_\+bus\+\_\+ioctl@{nm\+\_\+bus\+\_\+ioctl}}
\index{nm\+\_\+bus\+\_\+ioctl@{nm\+\_\+bus\+\_\+ioctl}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+bus\+\_\+ioctl()}{nm\_bus\_ioctl()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+bus\+\_\+ioctl (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Cmd,  }\item[{void $\ast$}]{pv\+Parameter }\end{DoxyParamCaption})}



I\+O\+C\+TL command processing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em u8\+Cmd} & Command opcode \\
\hline
\mbox{\tt in}  & {\em pv\+Parameter} & Command parameters \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status code (M2\+M\+\_\+\+S\+U\+C\+C\+E\+SS or M2\+M\+\_\+\+E\+R\+R\+\_\+\+B\+U\+S\+\_\+\+F\+A\+IL) 
\end{DoxyReturn}


Definition at line 230 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.


\begin{DoxyCode}
231 \{
232    \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
233 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SPI}
234    \hyperlink{structtstrNmSpiRw}{tstrNmSpiRw} *spiRwParams;
235 \textcolor{preprocessor}{#endif}
236 
237    \textcolor{comment}{//Check commande opcode}
238    \textcolor{keywordflow}{switch}(u8Cmd)
239    \{
240 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SPI}
241    \textcolor{comment}{//Read/write command?}
242    \textcolor{keywordflow}{case} \hyperlink{nm__bus__wrapper_8h_a7c9c01416493afd57406928672066506}{NM\_BUS\_IOCTL\_RW}:
243       \textcolor{comment}{//Retrieve command parameters}
244       spiRwParams = (\hyperlink{structtstrNmSpiRw}{tstrNmSpiRw} *) pvParameter;
245       \textcolor{comment}{//Perform SPI transfer}
246       ret = \hyperlink{nm__bus__wrapper__stm32h7xx_8c_ae656e55934eaeffc372287189b5e0d5b}{spi\_rw}(spiRwParams->\hyperlink{structtstrNmSpiRw_aa0a0dd7106812c8af780cb0729e2d1ef}{pu8InBuf}, spiRwParams->\hyperlink{structtstrNmSpiRw_a6778f8ba906b9eb363ac0422fca66dd5}{pu8OutBuf}, spiRwParams->
      \hyperlink{structtstrNmSpiRw_a7daa8262b96cb0543eb9189c65622c72}{u16Sz});
247       \textcolor{keywordflow}{break};
248 \textcolor{preprocessor}{#endif}
249    \textcolor{comment}{//Invalid command?}
250    \textcolor{keywordflow}{default}:
251       \textcolor{comment}{//Debug message}
252       \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Invalid IOCTL command!\(\backslash\)r\(\backslash\)n"});
253       \textcolor{comment}{//Report an error}
254       ret = \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
255       \textcolor{keywordflow}{break};
256    \}
257 
258    \textcolor{comment}{//Return status code}
259    \textcolor{keywordflow}{return} ret;
260 \}
\end{DoxyCode}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_ae656e55934eaeffc372287189b5e0d5b}\label{nm__bus__wrapper__stm32h7xx_8c_ae656e55934eaeffc372287189b5e0d5b}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!spi\+\_\+rw@{spi\+\_\+rw}}
\index{spi\+\_\+rw@{spi\+\_\+rw}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{spi\+\_\+rw()}{spi\_rw()}}
{\footnotesize\ttfamily static \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} spi\+\_\+rw (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Mosi,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Miso,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+Sz }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



S\+PI transfer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pu8\+Mosi} & The data to be written to the slave device \\
\hline
\mbox{\tt out}  & {\em pu8\+Miso} & The data received from the slave device \\
\hline
\mbox{\tt in}  & {\em u16\+Sz} & Number of bytes to be transferred \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status code (M2\+M\+\_\+\+S\+U\+C\+C\+E\+SS or M2\+M\+\_\+\+E\+R\+R\+\_\+\+B\+U\+S\+\_\+\+F\+A\+IL) 
\end{DoxyReturn}


Definition at line 67 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.


\begin{DoxyCode}
68 \{
69    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} i;
70    \textcolor{keywordtype}{size\_t} j;
71    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
72 
73    \textcolor{comment}{//Pull the CS pin low}
74    \_\_DSB();
75    HAL\_GPIO\_WritePin(CONF\_WILC\_CS\_GPIO, CONF\_WILC\_CS\_PIN, GPIO\_PIN\_RESET);
76    \_\_DSB();
77 
78 \textcolor{preprocessor}{#if 0}
79    \textcolor{comment}{//Copy data to TX buffer}
80    \textcolor{keywordflow}{if}(pu8Mosi != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
81       memcpy(\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}, pu8Mosi, u16Sz);
82    \textcolor{keywordflow}{else}
83       memset(\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}, 0, u16Sz);
84 
85    \textcolor{comment}{//Perform SPI transfer}
86    HAL\_SPI\_TransmitReceive(&\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}{SPI\_Handle}, \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}, \hyperlink{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}{rxBuffer}, u16Sz, HAL\_MAX\_DELAY)
      ;
87 
88    \textcolor{comment}{//Copy data from RX buffer}
89    \textcolor{keywordflow}{if}(pu8Miso != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
90       memcpy(pu8Miso, \hyperlink{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}{rxBuffer}, u16Sz);
91 \textcolor{preprocessor}{#else}
92    \textcolor{comment}{//Transfer the requested number of bytes}
93    \textcolor{keywordflow}{for}(i = 0; i < u16Sz; i += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n})
94    \{
95       \textcolor{comment}{//Limit the number of bytes to transfer at a time}
96       \textcolor{keywordflow}{if}((u16Sz - i) <= 16)
97          n = u16Sz - i;
98       \textcolor{keywordflow}{else}
99          n = 16;
100 
101       \textcolor{comment}{//Prepare TX buffer}
102       \textcolor{keywordflow}{if}(pu8Mosi != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
103          memcpy(\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}, pu8Mosi + i, n);
104       \textcolor{keywordflow}{else}
105          memset(\hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}, 0, n);
106 
107       \textcolor{comment}{//Wait for the transmitter to be ready}
108       \textcolor{keywordflow}{while}(!(CONF\_WILC\_SPI->SR & SPI\_SR\_TXC));
109 
110       \textcolor{comment}{//Send data}
111       \textcolor{keywordflow}{for}(j = 0; j < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; j++)
112           *((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) &CONF\_WILC\_SPI->TXDR) = \hyperlink{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}{txBuffer}[j];
113 
114       \textcolor{comment}{//Wait for the transfer to complete}
115       \textcolor{keywordflow}{while}(!(CONF\_WILC\_SPI->SR & SPI\_SR\_TXC));
116 
117       \textcolor{comment}{//Receive data}
118       \textcolor{keywordflow}{for}(j = 0; j < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; j++)
119           \hyperlink{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}{rxBuffer}[j] = *((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) &CONF\_WILC\_SPI->RXDR);
120 
121       \textcolor{comment}{//Copy received data to the user buffer}
122       \textcolor{keywordflow}{if}(pu8Miso != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
123          memcpy(pu8Miso + i, \hyperlink{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}{rxBuffer}, n);
124    \}
125 
126    \textcolor{comment}{//Wait for the SPI transfer to complete}
127    \textcolor{keywordflow}{while}(!(CONF\_WILC\_SPI->SR & SPI\_SR\_TXC));
128 \textcolor{preprocessor}{#endif}
129 
130    \textcolor{comment}{//Terminate the operation by raising the CS pin}
131    \_\_DSB();
132    HAL\_GPIO\_WritePin(CONF\_WILC\_CS\_GPIO, CONF\_WILC\_CS\_PIN, GPIO\_PIN\_SET);
133    \_\_DSB();
134 
135    \textcolor{comment}{//Successful operation}
136    \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
137 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_ae7dfa29166b4111ca6c3e3bab953eb79}\label{nm__bus__wrapper__stm32h7xx_8c_ae7dfa29166b4111ca6c3e3bab953eb79}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!egstr\+Nm\+Bus\+Capabilities@{egstr\+Nm\+Bus\+Capabilities}}
\index{egstr\+Nm\+Bus\+Capabilities@{egstr\+Nm\+Bus\+Capabilities}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{egstr\+Nm\+Bus\+Capabilities}{egstrNmBusCapabilities}}
{\footnotesize\ttfamily \hyperlink{structtstrNmBusCapabilities}{tstr\+Nm\+Bus\+Capabilities} egstr\+Nm\+Bus\+Capabilities}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=
\{
   \hyperlink{nm__bus__wrapper__stm32h7xx_8c_afbc973888cb214292ecd9094a69adf68}{NM\_BUS\_MAX\_TRX\_SZ}
\}
\end{DoxyCode}


Bus capabilities information. 

$<$ Bus capabilities. This structure must be declared at platform specific bus wrapper 

Definition at line 53 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.

\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}\label{nm__bus__wrapper__stm32h7xx_8c_af1d8e5f3079139edc69c503e92ab2718}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!rx\+Buffer@{rx\+Buffer}}
\index{rx\+Buffer@{rx\+Buffer}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{rx\+Buffer}{rxBuffer}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} rx\+Buffer\mbox{[}\hyperlink{nm__bus__wrapper__stm32l4xx_8c_afbc973888cb214292ecd9094a69adf68}{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 46 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.

\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}\label{nm__bus__wrapper__stm32h7xx_8c_a74bf1d491d0e4bab9c93d2c5d22e505b}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!S\+P\+I\+\_\+\+Handle@{S\+P\+I\+\_\+\+Handle}}
\index{S\+P\+I\+\_\+\+Handle@{S\+P\+I\+\_\+\+Handle}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{S\+P\+I\+\_\+\+Handle}{SPI\_Handle}}
{\footnotesize\ttfamily S\+P\+I\+\_\+\+Handle\+Type\+Def S\+P\+I\+\_\+\+Handle\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 41 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.

\mbox{\Hypertarget{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}\label{nm__bus__wrapper__stm32h7xx_8c_a38e2250244d3f7799048819b9aed0b1e}} 
\index{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}!tx\+Buffer@{tx\+Buffer}}
\index{tx\+Buffer@{tx\+Buffer}!nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c@{nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c}}
\subsubsection{\texorpdfstring{tx\+Buffer}{txBuffer}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} tx\+Buffer\mbox{[}\hyperlink{nm__bus__wrapper__stm32l4xx_8c_afbc973888cb214292ecd9094a69adf68}{N\+M\+\_\+\+B\+U\+S\+\_\+\+M\+A\+X\+\_\+\+T\+R\+X\+\_\+\+SZ}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 44 of file nm\+\_\+bus\+\_\+wrapper\+\_\+stm32h7xx.\+c.

