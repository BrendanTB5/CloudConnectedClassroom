\hypertarget{snmp__agent__misc_8h}{}\section{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+misc.h File Reference}
\label{snmp__agent__misc_8h}\index{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+misc.\+h@{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+misc.\+h}}


Helper functions for S\+N\+MP agent.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{snmp__agent__misc_8h_a2e6a175c10dbd3b37ae367fb6b27e358}{snmp\+Lock\+Mib} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Lock M\+IB bases. \end{DoxyCompactList}\item 
void \hyperlink{snmp__agent__misc_8h_ab3ae3b7de27641516fee3f8134c85c29}{snmp\+Unlock\+Mib} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Unlock M\+IB bases. \end{DoxyCompactList}\item 
\hyperlink{structSnmpUserEntry}{Snmp\+User\+Entry} $\ast$ \hyperlink{snmp__agent__misc_8h_ad1bc35f9a17a770f8a03e4674f8ebaa5}{snmp\+Create\+Community\+Entry} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Create a new community entry. \end{DoxyCompactList}\item 
\hyperlink{structSnmpUserEntry}{Snmp\+User\+Entry} $\ast$ \hyperlink{snmp__agent__misc_8h_aac1d3ba9a7753dd2afd22d27f199f7a9}{snmp\+Find\+Community\+Entry} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$community, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Search the community table for a given community string. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__misc_8h_a6176abbf69180ffcfd2e3a733ec5cbbc}{snmp\+Parse\+Var\+Binding} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$var, size\+\_\+t $\ast$consumed)
\begin{DoxyCompactList}\small\item\em Parse variable binding. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__misc_8h_a6951ca3653200fad8d6f79300914698d}{snmp\+Write\+Var\+Binding} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, const \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$var)
\begin{DoxyCompactList}\small\item\em Write variable binding. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__misc_8h_ad3578ff92f6cf0c758700c34fca1ca5b}{snmp\+Copy\+Var\+Binding\+List} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Copy the list of variable bindings. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__misc_8h_a8f9f560a07162c5953f105db4e276741}{snmp\+Write\+Trap\+Var\+Binding\+List} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} generic\+Trap\+Type, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} specific\+Trap\+Code, const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$object\+List, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} object\+List\+Size)
\begin{DoxyCompactList}\small\item\em Format the variable binding list for Trap-\/\+P\+DU or S\+N\+M\+Pv2-\/\+Trap-\/\+P\+DU. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__misc_8h_a7a7f8079b21e592ba511a3edb5c11ad1}{snmp\+Translate\+Status\+Code} (\hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} status, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} index)
\begin{DoxyCompactList}\small\item\em Translate status code. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Helper functions for S\+N\+MP agent. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{snmp__agent__misc_8h_ad3578ff92f6cf0c758700c34fca1ca5b}\label{snmp__agent__misc_8h_ad3578ff92f6cf0c758700c34fca1ca5b}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Copy\+Var\+Binding\+List@{snmp\+Copy\+Var\+Binding\+List}}
\index{snmp\+Copy\+Var\+Binding\+List@{snmp\+Copy\+Var\+Binding\+List}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Copy\+Var\+Binding\+List()}{snmpCopyVarBindingList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Copy\+Var\+Binding\+List (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Copy the list of variable bindings. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 449 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
450 \{
451    \textcolor{comment}{//Sanity check}
452    \textcolor{keywordflow}{if}(context->request.varBindListLen > context->response.varBindListMaxLen)
453       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
454 
455    \textcolor{comment}{//Copy the list of variable bindings to the response buffer}
456    memcpy(context->response.varBindList, context->request.varBindList,
457       context->request.varBindListLen);
458 
459    \textcolor{comment}{//Save the length of the list}
460    context->response.varBindListLen = context->request.varBindListLen;
461 
462    \textcolor{comment}{//Successful processing}
463    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
464 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_ad1bc35f9a17a770f8a03e4674f8ebaa5}\label{snmp__agent__misc_8h_ad1bc35f9a17a770f8a03e4674f8ebaa5}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Create\+Community\+Entry@{snmp\+Create\+Community\+Entry}}
\index{snmp\+Create\+Community\+Entry@{snmp\+Create\+Community\+Entry}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Create\+Community\+Entry()}{snmpCreateCommunityEntry()}}
{\footnotesize\ttfamily \hyperlink{structSnmpUserEntry}{Snmp\+User\+Entry}$\ast$ snmp\+Create\+Community\+Entry (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Create a new community entry. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the newly created entry 
\end{DoxyReturn}


Definition at line 147 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
148 \{
149    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
150 
151    \textcolor{comment}{//Initialize pointer}
152    entry = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
153 
154 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED || SNMP\_V2C\_SUPPORT == ENABLED)}
155    \textcolor{comment}{//Sanity check}
156    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
157    \{
158       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
159 
160       \textcolor{comment}{//Loop through the list of community strings}
161       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_ad8464259eef69f485dbcd8c5085a58e8}{SNMP\_AGENT\_MAX\_COMMUNITIES}; i++)
162       \{
163          \textcolor{comment}{//Check current status}
164          \textcolor{keywordflow}{if}(context->communityTable[i].status == \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED})
165          \{
166             \textcolor{comment}{//An unused entry has been found}
167             entry = &context->communityTable[i];
168             \textcolor{comment}{//We are done}
169             \textcolor{keywordflow}{break};
170          \}
171       \}
172 
173       \textcolor{comment}{//Check whether the table runs out of space}
174       \textcolor{keywordflow}{if}(entry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
175       \{
176          \textcolor{comment}{//Loop through the list of community strings}
177          \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_ad8464259eef69f485dbcd8c5085a58e8}{SNMP\_AGENT\_MAX\_COMMUNITIES}; i++)
178          \{
179             \textcolor{comment}{//Check current status}
180             \textcolor{keywordflow}{if}(context->communityTable[i].status == \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097ab6c550e32b731ff9573ce8db2f299a2b}{MIB\_ROW\_STATUS\_NOT\_READY})
181             \{
182                \textcolor{comment}{//Reuse the current entry}
183                entry = &context->communityTable[i];
184                \textcolor{comment}{//We are done}
185                \textcolor{keywordflow}{break};
186             \}
187          \}
188       \}
189    \}
190 \textcolor{preprocessor}{#endif}
191 
192    \textcolor{comment}{//Return a pointer to the newly created entry}
193    \textcolor{keywordflow}{return} entry;
194 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_aac1d3ba9a7753dd2afd22d27f199f7a9}\label{snmp__agent__misc_8h_aac1d3ba9a7753dd2afd22d27f199f7a9}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Find\+Community\+Entry@{snmp\+Find\+Community\+Entry}}
\index{snmp\+Find\+Community\+Entry@{snmp\+Find\+Community\+Entry}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Find\+Community\+Entry()}{snmpFindCommunityEntry()}}
{\footnotesize\ttfamily \hyperlink{structSnmpUserEntry}{Snmp\+User\+Entry}$\ast$ snmp\+Find\+Community\+Entry (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{community,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Search the community table for a given community string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em community} & Pointer to the community string \\
\hline
\mbox{\tt in}  & {\em length} & Length of the community string \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the matching entry 
\end{DoxyReturn}


Definition at line 205 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
207 \{
208    \hyperlink{structSnmpUserEntry}{SnmpUserEntry} *entry;
209 
210    \textcolor{comment}{//Initialize pointer}
211    entry = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
212 
213 \textcolor{preprocessor}{#if (SNMP\_V1\_SUPPORT == ENABLED || SNMP\_V2C\_SUPPORT == ENABLED)}
214    \textcolor{comment}{//Sanity check}
215    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && community != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
216    \{
217       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
218 
219       \textcolor{comment}{//Loop through the list of community string}
220       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_ad8464259eef69f485dbcd8c5085a58e8}{SNMP\_AGENT\_MAX\_COMMUNITIES}; i++)
221       \{
222          \textcolor{comment}{//Check current status}
223          \textcolor{keywordflow}{if}(context->communityTable[i].status != \hyperlink{mib__common_8h_a40ce1ea958f5c3b04f841d76f5557097a23a541b8e284769017711c3c13b9bc87}{MIB\_ROW\_STATUS\_UNUSED})
224          \{
225             \textcolor{comment}{//Check the length of the community string}
226             \textcolor{keywordflow}{if}(strlen(context->communityTable[i].name) == \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
227             \{
228                \textcolor{comment}{//Compare community strings}
229                \textcolor{keywordflow}{if}(!strncmp(context->communityTable[i].name, community, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}))
230                \{
231                   \textcolor{comment}{//A matching entry has been found}
232                   entry = &context->communityTable[i];
233                   \textcolor{comment}{//We are done}
234                   \textcolor{keywordflow}{break};
235                \}
236             \}
237          \}
238       \}
239    \}
240 \textcolor{preprocessor}{#endif}
241 
242    \textcolor{comment}{//Return a pointer to the matching entry}
243    \textcolor{keywordflow}{return} entry;
244 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_a2e6a175c10dbd3b37ae367fb6b27e358}\label{snmp__agent__misc_8h_a2e6a175c10dbd3b37ae367fb6b27e358}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Lock\+Mib@{snmp\+Lock\+Mib}}
\index{snmp\+Lock\+Mib@{snmp\+Lock\+Mib}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Lock\+Mib()}{snmpLockMib()}}
{\footnotesize\ttfamily void snmp\+Lock\+Mib (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Lock M\+IB bases. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}


Definition at line 62 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
63 \{
64    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
65    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} flag;
66 
67    \textcolor{comment}{//Initialize flag}
68    flag = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
69 
70    \textcolor{comment}{//Loop through MIBs}
71    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
72    \{
73       \textcolor{comment}{//Valid MIB?}
74       \textcolor{keywordflow}{if}(context->mibTable[i] != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
75       \{
76          \textcolor{comment}{//Any registered callback?}
77          \textcolor{keywordflow}{if}(context->mibTable[i]->lock != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
78          \{
79             \textcolor{comment}{//Lock access to the MIB}
80             context->mibTable[i]->lock();
81          \}
82          \textcolor{keywordflow}{else}
83          \{
84             \textcolor{comment}{//The MIB does not feature any lock/unlock mechanism}
85             flag = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
86          \}
87       \}
88    \}
89 
90    \textcolor{comment}{//Default lock/unlock sequence?}
91    \textcolor{keywordflow}{if}(flag)
92    \{
93       \textcolor{comment}{//Get exclusive access}
94       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
95    \}
96 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_a6176abbf69180ffcfd2e3a733ec5cbbc}\label{snmp__agent__misc_8h_a6176abbf69180ffcfd2e3a733ec5cbbc}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Parse\+Var\+Binding@{snmp\+Parse\+Var\+Binding}}
\index{snmp\+Parse\+Var\+Binding@{snmp\+Parse\+Var\+Binding}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Parse\+Var\+Binding()}{snmpParseVarBinding()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Parse\+Var\+Binding (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$}]{var,  }\item[{size\+\_\+t $\ast$}]{consumed }\end{DoxyParamCaption})}



Parse variable binding. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em p} & Input stream where to read the variable binding \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em var} & Variable binding \\
\hline
\mbox{\tt out}  & {\em consumed} & Total number of bytes that have been consumed \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 256 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
258 \{
259    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
260    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
261 
262    \textcolor{comment}{//The variable binding is encapsulated within a sequence}
263    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &tag);
264    \textcolor{comment}{//Failed to decode ASN.1 tag?}
265    \textcolor{keywordflow}{if}(error)
266       \textcolor{keywordflow}{return} error;
267 
268    \textcolor{comment}{//Enforce encoding, class and type}
269    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(&tag, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE});
270    \textcolor{comment}{//The tag does not match the criteria?}
271    \textcolor{keywordflow}{if}(error)
272       \textcolor{keywordflow}{return} error;
273 
274    \textcolor{comment}{//Total number of bytes that have been consumed}
275    *consumed = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
276 
277    \textcolor{comment}{//Point to the first item of the sequence}
278    \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} = tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value};
279    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
280 
281    \textcolor{comment}{//Read object name}
282    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &tag);
283    \textcolor{comment}{//Failed to decode ASN.1 tag?}
284    \textcolor{keywordflow}{if}(error)
285       \textcolor{keywordflow}{return} error;
286 
287    \textcolor{comment}{//Enforce encoding, class and type}
288    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER});
289    \textcolor{comment}{//The tag does not match the criteria?}
290    \textcolor{keywordflow}{if}(error)
291       \textcolor{keywordflow}{return} error;
292 
293    \textcolor{comment}{//Save object identifier}
294    var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value};
295    var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
296 
297    \textcolor{comment}{//Point to the next item}
298    \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
299    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
300 
301    \textcolor{comment}{//Read object value}
302    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &tag);
303    \textcolor{comment}{//Failed to decode ASN.1 tag?}
304    \textcolor{keywordflow}{if}(error)
305       \textcolor{keywordflow}{return} error;
306 
307    \textcolor{comment}{//Make sure that the tag is valid}
308    \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed})
309       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
310 
311    \textcolor{comment}{//Save object class}
312    var->\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass};
313    \textcolor{comment}{//Save object type}
314    var->\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType};
315    \textcolor{comment}{//Save object value}
316    var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value} = tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value};
317    var->\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
318 
319    \textcolor{comment}{//Successful processing}
320    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
321 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_a7a7f8079b21e592ba511a3edb5c11ad1}\label{snmp__agent__misc_8h_a7a7f8079b21e592ba511a3edb5c11ad1}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Translate\+Status\+Code@{snmp\+Translate\+Status\+Code}}
\index{snmp\+Translate\+Status\+Code@{snmp\+Translate\+Status\+Code}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Translate\+Status\+Code()}{snmpTranslateStatusCode()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Translate\+Status\+Code (\begin{DoxyParamCaption}\item[{\hyperlink{structSnmpMessage}{Snmp\+Message} $\ast$}]{message,  }\item[{\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t}}]{status,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{index }\end{DoxyParamCaption})}



Translate status code. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em message} & Pointer to the outgoing S\+N\+MP message \\
\hline
\mbox{\tt in}  & {\em status} & Status code \\
\hline
\mbox{\tt in}  & {\em index} & Index of the variable binding in the list that caused an exception \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
error code 
\end{DoxyReturn}


Definition at line 616 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
617 \{
618    \textcolor{comment}{//SNMPv1 version?}
619    \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
620    \{
621       \textcolor{comment}{//Set error-status and error-index fields (refer to RFC 2576, section 4.3)}
622       \textcolor{keywordflow}{switch}(status)
623       \{
624       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}:
625          \textcolor{comment}{//Return noError status code}
626          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2aaf909d71634fc281c206312026fa9a20}{SNMP\_ERROR\_NONE};
627          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = 0;
628          \textcolor{keywordflow}{break};
629 
630       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW}:
631          \textcolor{comment}{//Return tooBig status code}
632          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a0d9699d5036672a19b22b53666667909}{SNMP\_ERROR\_TOO\_BIG};
633          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = 0;
634 
635          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
636          \textcolor{comment}{//entity and for which the value of the error-status field is tooBig}
637          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutTooBigs, 1);
638          \textcolor{keywordflow}{break};
639 
640       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND}:
641       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND}:
642       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED}:
643       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caad7c52cd713fd33a26b64f01377927cf}{ERROR\_AUTHORIZATION\_FAILED}:
644          \textcolor{comment}{//Return noSuchName status code}
645          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a3c4a18c94ed3bd6765a1121b72dac17e}{SNMP\_ERROR\_NO\_SUCH\_NAME};
646          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
647 
648          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
649          \textcolor{comment}{//entity and for which the value of the error-status field is noSuchName}
650          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutNoSuchNames, 1);
651          \textcolor{keywordflow}{break};
652 
653       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca271f27d4fe36c93671fb83dcf2d3cf32}{ERROR\_WRONG\_TYPE}:
654       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5040f7f12c5856b6fa69242813935bad}{ERROR\_WRONG\_LENGTH}:
655       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING}:
656       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa89e595b6b9492cadd1e39bcf6b51255}{ERROR\_WRONG\_VALUE}:
657       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafaae3a6b1efb8378ac642c5670d71885}{ERROR\_INCONSISTENT\_VALUE}:
658          \textcolor{comment}{//Return badValue status code}
659          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2ad12391697a772b9608e6a6e4b7b88d89}{SNMP\_ERROR\_BAD\_VALUE};
660          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
661 
662          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
663          \textcolor{comment}{//entity and for which the value of the error-status field is badValue}
664          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutBadValues, 1);
665          \textcolor{keywordflow}{break};
666 
667       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacf545b4d693b270f9d01d54d86efedc2}{ERROR\_READ\_FAILED}:
668       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED}:
669       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa351a01311bd38606165023d2f01e5aa}{ERROR\_NOT\_WRITABLE}:
670          \textcolor{comment}{//Return genError status code}
671          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a2fa62fb12ecaf0d2b4e4dff847412913}{SNMP\_ERROR\_GENERIC};
672          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
673 
674          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
675          \textcolor{comment}{//entity and for which the value of the error-status field is genError}
676          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutGenErrs, 1);
677          \textcolor{keywordflow}{break};
678 
679       \textcolor{keywordflow}{default}:
680          \textcolor{comment}{//If the parsing of the request fails, the SNMP agent discards}
681          \textcolor{comment}{//the message and performs no further actions}
682          \textcolor{keywordflow}{return} status;
683       \}
684    \}
685    \textcolor{comment}{//SNMPv2c or SNMPv3 version?}
686    \textcolor{keywordflow}{else}
687    \{
688       \textcolor{comment}{//Set error-status and error-index fields}
689       \textcolor{keywordflow}{switch}(status)
690       \{
691       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}:
692          \textcolor{comment}{//Return noError status code}
693          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2aaf909d71634fc281c206312026fa9a20}{SNMP\_ERROR\_NONE};
694          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = 0;
695          \textcolor{keywordflow}{break};
696 
697       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW}:
698          \textcolor{comment}{//Return tooBig status code}
699          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a0d9699d5036672a19b22b53666667909}{SNMP\_ERROR\_TOO\_BIG};
700          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = 0;
701 
702          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
703          \textcolor{comment}{//entity and for which the value of the error-status field is tooBig}
704          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutTooBigs, 1);
705          \textcolor{keywordflow}{break};
706 
707       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacf545b4d693b270f9d01d54d86efedc2}{ERROR\_READ\_FAILED}:
708       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED}:
709          \textcolor{comment}{//Return genError status code}
710          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a2fa62fb12ecaf0d2b4e4dff847412913}{SNMP\_ERROR\_GENERIC};
711          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
712 
713          \textcolor{comment}{//Total number of SNMP PDUs which were generated by the SNMP protocol}
714          \textcolor{comment}{//entity and for which the value of the error-status field is genError}
715          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutGenErrs, 1);
716          \textcolor{keywordflow}{break};
717 
718       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND}:
719       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND}:
720       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED}:
721          \textcolor{comment}{//Return noAccess status code}
722          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a904bf9d010ab4565797eed8262245a47}{SNMP\_ERROR\_NO\_ACCESS};
723          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
724          \textcolor{keywordflow}{break};
725 
726       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca271f27d4fe36c93671fb83dcf2d3cf32}{ERROR\_WRONG\_TYPE}:
727          \textcolor{comment}{//Return wrongType status code}
728          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a327e3080af636e47fa0aecdb53521089}{SNMP\_ERROR\_WRONG\_TYPE};
729          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
730          \textcolor{keywordflow}{break};
731 
732       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5040f7f12c5856b6fa69242813935bad}{ERROR\_WRONG\_LENGTH}:
733          \textcolor{comment}{//Return wrongLength status code}
734          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a5aec7b8f5a255f088dab9987deac3344}{SNMP\_ERROR\_WRONG\_LENGTH};
735          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
736          \textcolor{keywordflow}{break};
737 
738       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING}:
739          \textcolor{comment}{//Return wrongEncoding status code}
740          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a7a05624ce71efb6fb2b91ec7d738315d}{SNMP\_ERROR\_WRONG\_ENCODING};
741          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
742          \textcolor{keywordflow}{break};
743 
744       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa89e595b6b9492cadd1e39bcf6b51255}{ERROR\_WRONG\_VALUE}:
745          \textcolor{comment}{//Return wrongValue status code}
746          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a3086efe8a16388ea12ff5c352e43b36d}{SNMP\_ERROR\_WRONG\_VALUE};
747          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
748          \textcolor{keywordflow}{break};
749 
750       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafaae3a6b1efb8378ac642c5670d71885}{ERROR\_INCONSISTENT\_VALUE}:
751          \textcolor{comment}{//Return inconsistentValue status code}
752          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a023ec8b2a4b2aac5b413c6d17fa2019d}{SNMP\_ERROR\_INCONSISTENT\_VALUE};
753          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
754          \textcolor{keywordflow}{break};
755 
756       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caad7c52cd713fd33a26b64f01377927cf}{ERROR\_AUTHORIZATION\_FAILED}:
757          \textcolor{comment}{//Return authorizationError status code}
758          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2adfde34146c4af0273a0b0cae23e23a7c}{SNMP\_ERROR\_AUTHORIZATION};
759          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = 0;
760          \textcolor{keywordflow}{break};
761 
762       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa351a01311bd38606165023d2f01e5aa}{ERROR\_NOT\_WRITABLE}:
763          \textcolor{comment}{//Return notWritable status code}
764          message->\hyperlink{structSnmpMessage_afb6f5e5cf7da54678aff6c79dd5948ce}{errorStatus} = \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a70bbed9d63cc894ef42afead18b44908}{SNMP\_ERROR\_NOT\_WRITABLE};
765          message->\hyperlink{structSnmpMessage_a6be5f10373d70dd0972a43a24299a8f7}{errorIndex} = index;
766          \textcolor{keywordflow}{break};
767 
768       \textcolor{keywordflow}{default}:
769          \textcolor{comment}{//If the parsing of the request fails, the SNMP agent discards}
770          \textcolor{comment}{//the message and performs no further actions}
771          \textcolor{keywordflow}{return} status;
772       \}
773    \}
774 
775    \textcolor{comment}{//Successful processing}
776    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
777 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_ab3ae3b7de27641516fee3f8134c85c29}\label{snmp__agent__misc_8h_ab3ae3b7de27641516fee3f8134c85c29}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Unlock\+Mib@{snmp\+Unlock\+Mib}}
\index{snmp\+Unlock\+Mib@{snmp\+Unlock\+Mib}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Unlock\+Mib()}{snmpUnlockMib()}}
{\footnotesize\ttfamily void snmp\+Unlock\+Mib (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Unlock M\+IB bases. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}


Definition at line 104 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
105 \{
106    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
107    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} flag;
108 
109    \textcolor{comment}{//Initialize flag}
110    flag = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
111 
112    \textcolor{comment}{//Loop through MIBs}
113    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{snmp__agent_8h_a5d367250fd498e757229b7ab62c3121a}{SNMP\_AGENT\_MAX\_MIBS}; i++)
114    \{
115       \textcolor{comment}{//Valid MIB?}
116       \textcolor{keywordflow}{if}(context->mibTable[i] != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
117       \{
118          \textcolor{comment}{//Any registered callback?}
119          \textcolor{keywordflow}{if}(context->mibTable[i]->unlock != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
120          \{
121             \textcolor{comment}{//Unlock access to the MIB}
122             context->mibTable[i]->unlock();
123          \}
124          \textcolor{keywordflow}{else}
125          \{
126             \textcolor{comment}{//The MIB does not feature any lock/unlock mechanism}
127             flag = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
128          \}
129       \}
130    \}
131 
132    \textcolor{comment}{//Default lock/unlock sequence?}
133    \textcolor{keywordflow}{if}(flag)
134    \{
135       \textcolor{comment}{//Release exclusive access}
136       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
137    \}
138 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_a8f9f560a07162c5953f105db4e276741}\label{snmp__agent__misc_8h_a8f9f560a07162c5953f105db4e276741}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Write\+Trap\+Var\+Binding\+List@{snmp\+Write\+Trap\+Var\+Binding\+List}}
\index{snmp\+Write\+Trap\+Var\+Binding\+List@{snmp\+Write\+Trap\+Var\+Binding\+List}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Write\+Trap\+Var\+Binding\+List()}{snmpWriteTrapVarBindingList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Write\+Trap\+Var\+Binding\+List (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{generic\+Trap\+Type,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{specific\+Trap\+Code,  }\item[{const \hyperlink{structSnmpTrapObject}{Snmp\+Trap\+Object} $\ast$}]{object\+List,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{object\+List\+Size }\end{DoxyParamCaption})}



Format the variable binding list for Trap-\/\+P\+DU or S\+N\+M\+Pv2-\/\+Trap-\/\+P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em generic\+Trap\+Type} & Generic trap type \\
\hline
\mbox{\tt in}  & {\em specific\+Trap\+Code} & Specific code \\
\hline
\mbox{\tt in}  & {\em object\+List} & List of object names \\
\hline
\mbox{\tt in}  & {\em object\+List\+Size} & Number of entries in the list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 477 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
480 \{
481    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
482    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
483    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
484    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
485    \hyperlink{structSnmpMessage}{SnmpMessage} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
486    \hyperlink{structSnmpVarBind}{SnmpVarBind} var;
487 
488    \textcolor{comment}{//Point to the SNMP message}
489    message = &context->response;
490 
491 \textcolor{preprocessor}{#if (SNMP\_V2C\_SUPPORT == ENABLED || SNMP\_V3\_SUPPORT == ENABLED)}
492    \textcolor{comment}{//SNMPv2c or SNMPv3 version?}
493    \textcolor{keywordflow}{if}(message->\hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfaa35575472195d72a958b8482d425c2b5}{SNMP\_VERSION\_2C} || message->
      \hyperlink{structSnmpMessage_a38b300782f7395005708f45f26dae7c1}{version} == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa92886bc76b0167bf8604e3a266c6be9c}{SNMP\_VERSION\_3})
494    \{
495       \textcolor{comment}{//Get current time}
496       time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}() / 10;
497 
498       \textcolor{comment}{//Encode the object value using ASN.1 rules}
499       error = \hyperlink{snmp__agent__message_8c_aac8a5ef4f5de9b431d0f768ab0973d8d}{snmpEncodeUnsignedInt32}(time, message->
      \hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}, &n);
500       \textcolor{comment}{//Any error to report?}
501       \textcolor{keywordflow}{if}(error)
502          \textcolor{keywordflow}{return} error;
503 
504       \textcolor{comment}{//The first two variable bindings in the variable binding list of an}
505       \textcolor{comment}{//SNMPv2-Trap-PDU are sysUpTime.0 and snmpTrapOID.0 respectively}
506       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__misc_8c_ad51ae77ebdc74c9804f0b25d681214f2}{sysUpTimeObject};
507       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__misc_8c_ad51ae77ebdc74c9804f0b25d681214f2}{sysUpTimeObject});
508       var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION};
509       var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa13fd57cc818acf51f5eabb5d0ad6c484}{MIB\_TYPE\_TIME\_TICKS};
510       var.\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value} = message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer};
511       var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
512 
513       \textcolor{comment}{//Append sysUpTime.0 to the variable binding list}
514       error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
515       \textcolor{comment}{//Any error to report?}
516       \textcolor{keywordflow}{if}(error)
517          \textcolor{keywordflow}{return} error;
518 
519       \textcolor{comment}{//Generic or enterprise-specific trap?}
520       \textcolor{keywordflow}{if}(genericTrapType < \hyperlink{snmp__common_8h_affeac524e7824d62d671e7b3e7f3babcaa8b3aaf354d1d61c9a36b721b7c16a27}{SNMP\_TRAP\_ENTERPRISE\_SPECIFIC})
521       \{
522          \textcolor{comment}{//Retrieve the length of the snmpTraps OID}
523          n = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__misc_8c_a3275f0d2af0d7222994d9e80460b8aae}{snmpTrapsObject});
524          \textcolor{comment}{//Copy the OID}
525          memcpy(message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}, \hyperlink{snmp__agent__misc_8c_a3275f0d2af0d7222994d9e80460b8aae}{snmpTrapsObject}, n);
526 
527          \textcolor{comment}{//For generic traps, the SNMPv2 snmpTrapOID parameter shall be}
528          \textcolor{comment}{//the corresponding trap as defined in section 2 of RFC 3418}
529          message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = genericTrapType + 1;
530 
531          \textcolor{comment}{//Update the length of the snmpTrapOID parameter}
532          n++;
533       \}
534       \textcolor{keywordflow}{else}
535       \{
536          \textcolor{comment}{//Retrieve the length of the enterprise OID}
537          n = context->enterpriseOidLen;
538 
539          \textcolor{comment}{//For enterprise specific traps, the SNMPv2 snmpTrapOID parameter shall}
540          \textcolor{comment}{//be the concatenation of the SNMPv1 enterprise OID and two additional}
541          \textcolor{comment}{//sub-identifiers, '0' and the SNMPv1 specific trap parameter. Refer}
542          \textcolor{comment}{//to RFC 3584, section 3.1 and RFC 2578, section 8.5}
543          memcpy(message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}, context->enterpriseOid, n);
544 
545          \textcolor{comment}{//Concatenate the '0' sub-identifier}
546          message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}[n++] = 0;
547 
548          \textcolor{comment}{//Concatenate the specific trap parameter}
549          message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = specificTrapCode % 128;
550 
551          \textcolor{comment}{//Loop as long as necessary}
552          \textcolor{keywordflow}{for}(i = 1; specificTrapCode > 128; i++)
553          \{
554             \textcolor{comment}{//Split the binary representation into 7 bit chunks}
555             specificTrapCode /= 128;
556             \textcolor{comment}{//Make room for the new chunk}
557             memmove(message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer} + n + 1, message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer} + n, i);
558             \textcolor{comment}{//Set the most significant bit in the current chunk}
559             message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer}[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = \hyperlink{oid_8h_a92a39fc5e9b9b348469ed71cedefd90a}{OID\_MORE\_FLAG} | (specificTrapCode % 128);
560          \}
561 
562          \textcolor{comment}{//Update the length of the snmpTrapOID parameter}
563          n += i;
564       \}
565 
566       \textcolor{comment}{//The snmpTrapOID.0 variable occurs as the second variable}
567       \textcolor{comment}{//binding in every SNMPv2-Trap-PDU}
568       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__misc_8c_a02679ba34cab0258e8df6f83dab9fe0b}{snmpTrapOidObject};
569       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__misc_8c_a02679ba34cab0258e8df6f83dab9fe0b}{snmpTrapOidObject});
570       var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
571       var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
572       var.\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value} = message->\hyperlink{structSnmpMessage_a60405510f10de109ac78bf7ae8427f24}{buffer};
573       var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
574 
575       \textcolor{comment}{//Append snmpTrapOID.0 to the variable binding list}
576       error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
577       \textcolor{comment}{//Any error to report?}
578       \textcolor{keywordflow}{if}(error)
579          \textcolor{keywordflow}{return} error;
580    \}
581 \textcolor{preprocessor}{#endif}
582 
583    \textcolor{comment}{//Loop through the list of objects}
584    \textcolor{keywordflow}{for}(i = 0; i < objectListSize; i++)
585    \{
586       \textcolor{comment}{//Get object identifier}
587       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = objectList[i].\hyperlink{structSnmpTrapObject_a1b543e9b2f5f89c9f81cd1308919bad2}{oid};
588       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = objectList[i].\hyperlink{structSnmpTrapObject_aec6db360dc31d119d36e2aced7580e5f}{oidLen};
589 
590       \textcolor{comment}{//Retrieve object value}
591       error = \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmpGetObjectValue}(context, message, &var);
592       \textcolor{comment}{//Any error to report?}
593       \textcolor{keywordflow}{if}(error)
594          \textcolor{keywordflow}{return} error;
595 
596       \textcolor{comment}{//Append variable binding to the list}
597       error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
598       \textcolor{comment}{//Any error to report?}
599       \textcolor{keywordflow}{if}(error)
600          \textcolor{keywordflow}{return} error;
601    \}
602 
603    \textcolor{comment}{//Successful processing}
604    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
605 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__misc_8h_a6951ca3653200fad8d6f79300914698d}\label{snmp__agent__misc_8h_a6951ca3653200fad8d6f79300914698d}} 
\index{snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}!snmp\+Write\+Var\+Binding@{snmp\+Write\+Var\+Binding}}
\index{snmp\+Write\+Var\+Binding@{snmp\+Write\+Var\+Binding}!snmp\+\_\+agent\+\_\+misc.\+h@{snmp\+\_\+agent\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{snmp\+Write\+Var\+Binding()}{snmpWriteVarBinding()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Write\+Var\+Binding (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSnmpVarBind}{Snmp\+Var\+Bind} $\ast$}]{var }\end{DoxyParamCaption})}



Write variable binding. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em var} & Variable binding \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 331 of file snmp\+\_\+agent\+\_\+misc.\+c.


\begin{DoxyCode}
332 \{
333    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
334    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
335    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
336    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
337    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
338 
339    \textcolor{comment}{//The object's name is encoded in ASN.1 format}
340    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
341    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
342    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
343    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen};
344    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid};
345 
346    \textcolor{comment}{//Calculate the total length of the ASN.1 tag}
347    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &m);
348    \textcolor{comment}{//Any error to report?}
349    \textcolor{keywordflow}{if}(error)
350       \textcolor{keywordflow}{return} error;
351 
352    \textcolor{comment}{//The object's value is encoded in ASN.1 format}
353    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
354    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = var->\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass};
355    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = var->\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType};
356    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = var->\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen};
357    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value};
358 
359    \textcolor{comment}{//Calculate the total length of the ASN.1 tag}
360    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &n);
361    \textcolor{comment}{//Any error to report?}
362    \textcolor{keywordflow}{if}(error)
363       \textcolor{keywordflow}{return} error;
364 
365    \textcolor{comment}{//The variable binding is encapsulated within a sequence}
366    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
367    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
368    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
369    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = m + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
370    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
371 
372    \textcolor{comment}{//The first pass computes the total length of the sequence}
373    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
374    \textcolor{comment}{//Any error to report?}
375    \textcolor{keywordflow}{if}(error)
376       \textcolor{keywordflow}{return} error;
377 
378    \textcolor{comment}{//Make sure the buffer is large enough to hold the whole sequence}
379    \textcolor{keywordflow}{if}((context->response.varBindListLen + tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength}) >
380       context->response.varBindListMaxLen)
381    \{
382       \textcolor{comment}{//Report an error}
383       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW};
384    \}
385 
386    \textcolor{comment}{//The second pass encodes the sequence in reverse order}
387    p = context->response.varBindList + context->response.varBindListLen +
388       tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
389 
390    \textcolor{comment}{//Encode the object's value using ASN.1}
391    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
392    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = var->\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass};
393    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = var->\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType};
394    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = var->\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen};
395    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = var->\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value};
396 
397    \textcolor{comment}{//Write the corresponding ASN.1 tag}
398    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, p, &m);
399    \textcolor{comment}{//Any error to report?}
400    \textcolor{keywordflow}{if}(error)
401       \textcolor{keywordflow}{return} error;
402 
403    \textcolor{comment}{//Move backward}
404    p -= \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
405 
406    \textcolor{comment}{//Encode the object's name using ASN.1}
407    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
408    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
409    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER};
410    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = var->\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen};
411    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = var->\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid};
412 
413    \textcolor{comment}{//Write the corresponding ASN.1 tag}
414    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, p, &n);
415    \textcolor{comment}{//Any error to report?}
416    \textcolor{keywordflow}{if}(error)
417       \textcolor{keywordflow}{return} error;
418 
419    \textcolor{comment}{//Move backward}
420    p -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
421 
422    \textcolor{comment}{//The variable binding is encapsulated within a sequence}
423    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
424    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
425    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
426    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = m + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
427    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
428 
429    \textcolor{comment}{//Write the corresponding ASN.1 tag}
430    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, p, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
431    \textcolor{comment}{//Any error to report?}
432    \textcolor{keywordflow}{if}(error)
433       \textcolor{keywordflow}{return} error;
434 
435    \textcolor{comment}{//Update the length of the list}
436    context->response.varBindListLen += tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
437 
438    \textcolor{comment}{//Successful processing}
439    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
440 \}
\end{DoxyCode}
