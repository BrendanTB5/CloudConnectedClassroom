\hypertarget{smtp__client__misc_8c}{}\section{cyclone\+\_\+tcp/smtp/smtp\+\_\+client\+\_\+misc.c File Reference}
\label{smtp__client__misc_8c}\index{cyclone\+\_\+tcp/smtp/smtp\+\_\+client\+\_\+misc.\+c@{cyclone\+\_\+tcp/smtp/smtp\+\_\+client\+\_\+misc.\+c}}


Helper functions for S\+M\+TP client.  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}smtp/smtp\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}smtp/smtp\+\_\+client\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}smtp/smtp\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{smtp__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_af97eea6d840b58cc238cef1f34a39aa0}{S\+M\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{smtp__client__misc_8c_a0b784079ddc4b895d3c299e9d7264c3b}{smtp\+Client\+Change\+State} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, \hyperlink{smtp__client_8h_a02fc964f050527db806d949976661212}{Smtp\+Client\+State} new\+State)
\begin{DoxyCompactList}\small\item\em Update S\+M\+TP client state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_a9a573cb6d178025fe0beb8f8dab70f11}{smtp\+Client\+Send\+Command} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, \hyperlink{smtp__client_8h_a41608593fa8a8f1b06157bd7bb00667d}{Smtp\+Client\+Reply\+Callback} callback)
\begin{DoxyCompactList}\small\item\em Send S\+M\+TP command and wait for a reply. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_ac924542c9a648900a3f6c08f89fca3ab}{smtp\+Client\+Format\+Command} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$command, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$argument)
\begin{DoxyCompactList}\small\item\em Format S\+M\+TP command. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_a90bdd85d7386c059a956d5e186d48d5c}{smtp\+Client\+Parse\+Ehlo\+Reply} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$reply\+Line)
\begin{DoxyCompactList}\small\item\em Parse E\+H\+LO response. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_a1520b2863d298c5b5389a26835899b4e}{smtp\+Client\+Format\+Mail\+Header} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, const \hyperlink{structSmtpMailAddr}{Smtp\+Mail\+Addr} $\ast$from, const \hyperlink{structSmtpMailAddr}{Smtp\+Mail\+Addr} $\ast$recipients, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} num\+Recipients, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subject)
\begin{DoxyCompactList}\small\item\em Format email header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_ad34bfc04a8d65914bfa5916a4620dddd}{smtp\+Client\+Format\+Multipart\+Header} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$content\+Type, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$content\+Transfer\+Encoding, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{ipv6__frag_8h_a7179af054cf318941e1a12e964965935}{last})
\begin{DoxyCompactList}\small\item\em Format multipart header. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{smtp__client__misc_8c_ad78e5cfcbf408a9b9c01c176c016100d}{smtp\+Client\+Check\+Timeout} (\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Determine whether a timeout error has occurred. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Helper functions for S\+M\+TP client. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{smtp__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{smtp__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_af97eea6d840b58cc238cef1f34a39aa0}{S\+M\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file smtp\+\_\+client\+\_\+misc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{smtp__client__misc_8c_a0b784079ddc4b895d3c299e9d7264c3b}\label{smtp__client__misc_8c_a0b784079ddc4b895d3c299e9d7264c3b}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Change\+State@{smtp\+Client\+Change\+State}}
\index{smtp\+Client\+Change\+State@{smtp\+Client\+Change\+State}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Change\+State()}{smtpClientChangeState()}}
{\footnotesize\ttfamily void smtp\+Client\+Change\+State (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{smtp__client_8h_a02fc964f050527db806d949976661212}{Smtp\+Client\+State}}]{new\+State }\end{DoxyParamCaption})}



Update S\+M\+TP client state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\end{DoxyParams}


Definition at line 54 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
56 \{
57    \textcolor{comment}{//Switch to the new state}
58    context->state = newState;
59 
60    \textcolor{comment}{//Save current time}
61    context->timestamp = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
62 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_ad78e5cfcbf408a9b9c01c176c016100d}\label{smtp__client__misc_8c_ad78e5cfcbf408a9b9c01c176c016100d}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Check\+Timeout@{smtp\+Client\+Check\+Timeout}}
\index{smtp\+Client\+Check\+Timeout@{smtp\+Client\+Check\+Timeout}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Check\+Timeout()}{smtpClientCheckTimeout()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Check\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Determine whether a timeout error has occurred. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 584 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
585 \{
586 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == DISABLED)}
587    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
588    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
589 
590    \textcolor{comment}{//Get current time}
591    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
592 
593    \textcolor{comment}{//Check whether the timeout has elapsed}
594    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
595    \{
596       \textcolor{comment}{//Report a timeout error}
597       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
598    \}
599    \textcolor{keywordflow}{else}
600    \{
601       \textcolor{comment}{//The operation would block}
602       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK};
603    \}
604 
605    \textcolor{comment}{//Return status code}
606    \textcolor{keywordflow}{return} error;
607 \textcolor{preprocessor}{#else}
608    \textcolor{comment}{//Report a timeout error}
609    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT};
610 \textcolor{preprocessor}{#endif}
611 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_ac924542c9a648900a3f6c08f89fca3ab}\label{smtp__client__misc_8c_ac924542c9a648900a3f6c08f89fca3ab}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Format\+Command@{smtp\+Client\+Format\+Command}}
\index{smtp\+Client\+Format\+Command@{smtp\+Client\+Format\+Command}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Format\+Command()}{smtpClientFormatCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Format\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{command,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{argument }\end{DoxyParamCaption})}



Format S\+M\+TP command. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em command} & N\+U\+L\+L-\/terminated string containing the S\+M\+TP command \\
\hline
\mbox{\tt in}  & {\em argument} & N\+U\+L\+L-\/terminated string containing the argument \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 190 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
192 \{
193    \textcolor{comment}{//Check SMTP command name}
194    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(command, \textcolor{stringliteral}{"MAIL FROM"}) ||
195       !\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(command, \textcolor{stringliteral}{"RCPT TO"}))
196    \{
197       \textcolor{comment}{//Check whether the address is valid}
198       \textcolor{keywordflow}{if}(argument != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
199       \{
200          \textcolor{comment}{//Format MAIL FROM or RCPT TO command}
201          sprintf(context->buffer, \textcolor{stringliteral}{"%s: <%s>\(\backslash\)r\(\backslash\)n"}, command, argument);
202       \}
203       \textcolor{keywordflow}{else}
204       \{
205          \textcolor{comment}{//A null return path is accepted}
206          sprintf(context->buffer, \textcolor{stringliteral}{"%s: <>\(\backslash\)r\(\backslash\)n"}, command);
207       \}
208 
209       \textcolor{comment}{//Debug message}
210       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"SMTP client: %s"}, context->buffer);
211    \}
212    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(command, \textcolor{stringliteral}{"."}))
213    \{
214       \textcolor{comment}{//SMTP indicates the end of the mail data by sending a line containing}
215       \textcolor{comment}{//only a "." (refer to RFC 5321, section 3.3)}
216       sprintf(context->buffer, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n.\(\backslash\)r\(\backslash\)n"});
217 
218       \textcolor{comment}{//Debug message}
219       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, context->buffer);
220    \}
221    \textcolor{keywordflow}{else}
222    \{
223       \textcolor{comment}{//The argument is optional}
224       \textcolor{keywordflow}{if}(argument != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
225       \{
226          \textcolor{comment}{//Format SMTP command}
227          sprintf(context->buffer, \textcolor{stringliteral}{"%s %s\(\backslash\)r\(\backslash\)n"}, command, argument);
228       \}
229       \textcolor{keywordflow}{else}
230       \{
231          \textcolor{comment}{//Format SMTP command}
232          sprintf(context->buffer, \textcolor{stringliteral}{"%s\(\backslash\)r\(\backslash\)n"}, command);
233       \}
234 
235       \textcolor{comment}{//Debug message}
236       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"SMTP client: %s"}, context->buffer);
237    \}
238 
239    \textcolor{comment}{//Calculate the length of the SMTP command}
240    context->commandLen = strlen(context->buffer);
241 
242    \textcolor{comment}{//Flush receive buffer}
243    context->bufferPos = 0;
244    context->replyLen = 0;
245 
246    \textcolor{comment}{//Successful processing}
247    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
248 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_a1520b2863d298c5b5389a26835899b4e}\label{smtp__client__misc_8c_a1520b2863d298c5b5389a26835899b4e}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Format\+Mail\+Header@{smtp\+Client\+Format\+Mail\+Header}}
\index{smtp\+Client\+Format\+Mail\+Header@{smtp\+Client\+Format\+Mail\+Header}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Format\+Mail\+Header()}{smtpClientFormatMailHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Format\+Mail\+Header (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSmtpMailAddr}{Smtp\+Mail\+Addr} $\ast$}]{from,  }\item[{const \hyperlink{structSmtpMailAddr}{Smtp\+Mail\+Addr} $\ast$}]{recipients,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{num\+Recipients,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subject }\end{DoxyParamCaption})}



Format email header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em from} & Email address of the sender \\
\hline
\mbox{\tt in}  & {\em recipients} & Email addresses of the recipients \\
\hline
\mbox{\tt in}  & {\em num\+Recipients} & Number of email addresses in the list \\
\hline
\mbox{\tt in}  & {\em subject} & N\+U\+L\+L-\/terminsated string containing the email subject \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 339 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
342 \{
343    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
344    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
345    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
346    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} \hyperlink{ipv4__frag_8h_ac641ca9cfab7c4966cdd47e13c7ec87a}{first};
347 
348    \textcolor{comment}{//Point to the buffer}
349    p = context->buffer;
350 
351    \textcolor{comment}{//Valid sender address?}
352    \textcolor{keywordflow}{if}(from->\hyperlink{structSmtpMailAddr_aee3796762170dbb8b894acb870ec2f66}{addr} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
353    \{
354       \textcolor{comment}{//Valid friendly name?}
355       \textcolor{keywordflow}{if}(from->\hyperlink{structSmtpMailAddr_abe3a319474a330d936a68706c96a6035}{name} && from->\hyperlink{structSmtpMailAddr_abe3a319474a330d936a68706c96a6035}{name}[0] != \textcolor{charliteral}{'\(\backslash\)0'})
356       \{
357          \textcolor{comment}{//A friendly name may be associated with the sender address}
358          p += sprintf(p, \textcolor{stringliteral}{"From: \(\backslash\)"%s\(\backslash\)" <%s>\(\backslash\)r\(\backslash\)n"}, from->\hyperlink{structSmtpMailAddr_abe3a319474a330d936a68706c96a6035}{name}, from->\hyperlink{structSmtpMailAddr_aee3796762170dbb8b894acb870ec2f66}{addr});
359       \}
360       \textcolor{keywordflow}{else}
361       \{
362          \textcolor{comment}{//Format sender address}
363          p += sprintf(p, \textcolor{stringliteral}{"From: %s\(\backslash\)r\(\backslash\)n"}, from->\hyperlink{structSmtpMailAddr_aee3796762170dbb8b894acb870ec2f66}{addr});
364       \}
365    \}
366 
367    \textcolor{comment}{//Process TO, CC and BCC recipients}
368    \textcolor{keywordflow}{for}(type = \hyperlink{smtp__client_8h_aeee50722ccc5015c4fdc33b13819126ea47715b8a7f2291a2ba2678871446c1b5}{SMTP\_ADDR\_TYPE\_TO}; type <= \hyperlink{smtp__client_8h_aeee50722ccc5015c4fdc33b13819126ea95b0ff9b31988fa48a06267ed293ae42}{SMTP\_ADDR\_TYPE\_BCC}; type++)
369    \{
370       \textcolor{comment}{//Loop through the list of recipients}
371       \textcolor{keywordflow}{for}(first = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, i = 0; i < numRecipients; i++)
372       \{
373          \textcolor{comment}{//Ensure the current email address is valid}
374          \textcolor{keywordflow}{if}(recipients[i].\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
375          \{
376             \textcolor{comment}{//Check recipient type}
377             \textcolor{keywordflow}{if}(recipients[i].type == type)
378             \{
379                \textcolor{comment}{//The first item of the list requires special handling}
380                \textcolor{keywordflow}{if}(first)
381                \{
382                   \textcolor{comment}{//Check recipient type}
383                   \textcolor{keywordflow}{if}(type == \hyperlink{smtp__client_8h_aeee50722ccc5015c4fdc33b13819126ea47715b8a7f2291a2ba2678871446c1b5}{SMTP\_ADDR\_TYPE\_TO})
384                   \{
385                      \textcolor{comment}{//List of recipients}
386                      p += sprintf(p, \textcolor{stringliteral}{"To: "});
387                   \}
388                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{smtp__client_8h_aeee50722ccc5015c4fdc33b13819126ea378c4ba43e544fb077f60dc92d55832c}{SMTP\_ADDR\_TYPE\_CC})
389                   \{
390                      \textcolor{comment}{//List of recipients which should get a carbon copy (CC)}
391                      \textcolor{comment}{//of the message}
392                      p += sprintf(p, \textcolor{stringliteral}{"Cc: "});
393                   \}
394                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(type == \hyperlink{smtp__client_8h_aeee50722ccc5015c4fdc33b13819126ea95b0ff9b31988fa48a06267ed293ae42}{SMTP\_ADDR\_TYPE\_BCC})
395                   \{
396                      \textcolor{comment}{//List of recipients which should get a blind carbon copy}
397                      \textcolor{comment}{//(BCC) of the message}
398                      p += sprintf(p, \textcolor{stringliteral}{"Bcc: "});
399                   \}
400                   \textcolor{keywordflow}{else}
401                   \{
402                      \textcolor{comment}{//Invalid recipient type}
403                      \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
404                   \}
405                \}
406                \textcolor{keywordflow}{else}
407                \{
408                   \textcolor{comment}{//The addresses are comma-separated}
409                   p += sprintf(p, \textcolor{stringliteral}{", "});
410                \}
411 
412                \textcolor{comment}{//Valid friendly name?}
413                \textcolor{keywordflow}{if}(recipients[i].\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name} && recipients[i].\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[0] != \textcolor{charliteral}{'\(\backslash\)0'})
414                \{
415                   \textcolor{comment}{//A friendly name may be associated with the address}
416                   p += sprintf(p, \textcolor{stringliteral}{"\(\backslash\)"%s\(\backslash\)" <%s>"}, recipients[i].\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name},
417                      recipients[i].\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr});
418                \}
419                \textcolor{keywordflow}{else}
420                \{
421                   \textcolor{comment}{//Add the email address to the list of recipients}
422                   p += sprintf(p, \textcolor{stringliteral}{"%s"}, recipients[i].\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr});
423                \}
424 
425                \textcolor{comment}{//The current recipient is valid}
426                first = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
427             \}
428          \}
429       \}
430 
431       \textcolor{comment}{//Any recipients found?}
432       \textcolor{keywordflow}{if}(!first)
433       \{
434          \textcolor{comment}{//Terminate the line with a CRLF sequence}
435          p += sprintf(p, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
436       \}
437    \}
438 
439    \textcolor{comment}{//Valid subject?}
440    \textcolor{keywordflow}{if}(subject != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && subject[0] != \textcolor{charliteral}{'\(\backslash\)0'})
441    \{
442       \textcolor{comment}{//Format email subject}
443       p += sprintf(p, \textcolor{stringliteral}{"Subject: %s\(\backslash\)r\(\backslash\)n"}, subject);
444    \}
445 
446 \textcolor{preprocessor}{#if (SMTP\_CLIENT\_MIME\_SUPPORT == ENABLED)}
447    \textcolor{comment}{//Valid content type?}
448    \textcolor{keywordflow}{if}(context->contentType[0] != \textcolor{charliteral}{'\(\backslash\)0'})
449    \{
450       \textcolor{comment}{//The presence of this header field indicates the message is}
451       \textcolor{comment}{//MIME-formatted}
452       p += sprintf(p, \textcolor{stringliteral}{"MIME-Version: 1.0\(\backslash\)r\(\backslash\)n"});
453 
454       \textcolor{comment}{//Check whether multipart encoding is being used}
455       \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}(context->contentType, \textcolor{stringliteral}{"multipart/"}, 10))
456       \{
457          \textcolor{comment}{//This Content-Type header field defines the boundary string}
458          p += sprintf(p, \textcolor{stringliteral}{"Content-Type: %s; boundary=%s\(\backslash\)r\(\backslash\)n"},
459             context->contentType, context->boundary);
460       \}
461       \textcolor{keywordflow}{else}
462       \{
463          \textcolor{comment}{//This Content-Type header field indicates the media type of the}
464          \textcolor{comment}{//message content, consisting of a type and subtype}
465          p += sprintf(p, \textcolor{stringliteral}{"Content-Type: %s\(\backslash\)r\(\backslash\)n"}, context->contentType);
466       \}
467    \}
468 \textcolor{preprocessor}{#endif}
469 
470    \textcolor{comment}{//The header and the body are separated by an empty line}
471    sprintf(p, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
472 
473    \textcolor{comment}{//Debug message}
474    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, context->buffer);
475 
476    \textcolor{comment}{//Save the length of the header}
477    context->bufferLen = strlen(context->buffer);
478    context->bufferPos = 0;
479 
480    \textcolor{comment}{//Successful processing}
481    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
482 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_ad34bfc04a8d65914bfa5916a4620dddd}\label{smtp__client__misc_8c_ad34bfc04a8d65914bfa5916a4620dddd}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Format\+Multipart\+Header@{smtp\+Client\+Format\+Multipart\+Header}}
\index{smtp\+Client\+Format\+Multipart\+Header@{smtp\+Client\+Format\+Multipart\+Header}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Format\+Multipart\+Header()}{smtpClientFormatMultipartHeader()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Format\+Multipart\+Header (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{filename,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{content\+Type,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{content\+Transfer\+Encoding,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{last }\end{DoxyParamCaption})}



Format multipart header. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em filename} & N\+U\+L\+L-\/terminated string that holds the file name (optional parameter) \\
\hline
\mbox{\tt in}  & {\em content\+Type} & N\+U\+L\+L-\/terminated string that holds the content type (optional parameter) \\
\hline
\mbox{\tt in}  & {\em content\+Transfer\+Encoding} & N\+U\+L\+L-\/terminated string that holds the content transfer encoding (optional parameter) \\
\hline
\mbox{\tt in}  & {\em last} & This flag indicates whether the multipart header is the final one \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 499 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
502 \{
503 \textcolor{preprocessor}{#if (SMTP\_CLIENT\_MIME\_SUPPORT == ENABLED)}
504    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
505 
506    \textcolor{comment}{//Point to the buffer}
507    p = context->buffer;
508 
509    \textcolor{comment}{//Check whether the multipart header is the final one}
510    \textcolor{keywordflow}{if}(!\hyperlink{ipv4__frag_8h_a7179af054cf318941e1a12e964965935}{last})
511    \{
512       \textcolor{comment}{//The encapsulation boundary is defined as a line consisting entirely}
513       \textcolor{comment}{//of two hyphen characters followed by the boundary parameter value}
514       \textcolor{comment}{//from the Content-Type header field. The encapsulation boundary must}
515       \textcolor{comment}{//occur at the beginning of a line}
516       p += sprintf(p, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n--%s\(\backslash\)r\(\backslash\)n"}, context->boundary);
517 
518       \textcolor{comment}{//Valid file name?}
519       \textcolor{keywordflow}{if}(\hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename}[0] != \textcolor{charliteral}{'\(\backslash\)0'})
520       \{
521          \textcolor{comment}{//The Content-Disposition header field specifies the presentation style}
522          p += sprintf(p, \textcolor{stringliteral}{"Content-Disposition: attachment; filename=\(\backslash\)"%s\(\backslash\)"\(\backslash\)r\(\backslash\)n"},
523             \hyperlink{tftp__common_8h_a054704ecfbf9f8eea80cd1d120b8cf62}{filename});
524       \}
525 
526       \textcolor{comment}{//Valid content type?}
527       \textcolor{keywordflow}{if}(contentType != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && contentType[0] != \textcolor{charliteral}{'\(\backslash\)0'})
528       \{
529          \textcolor{comment}{//This Content-Type header field indicates the media type of the}
530          \textcolor{comment}{//message content, consisting of a type and subtype}
531          p += sprintf(p, \textcolor{stringliteral}{"Content-Type: %s\(\backslash\)r\(\backslash\)n"}, contentType);
532       \}
533 
534       \textcolor{comment}{//Valid content transfer encoding?}
535       \textcolor{keywordflow}{if}(contentTransferEncoding != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && contentTransferEncoding[0] != \textcolor{charliteral}{'\(\backslash\)0'})
536       \{
537          \textcolor{comment}{//The Content-Transfer-Encoding header can be used for representing}
538          \textcolor{comment}{//binary data in formats other than ASCII text format}
539          p += sprintf(p, \textcolor{stringliteral}{"Content-Transfer-Encoding: %s\(\backslash\)r\(\backslash\)n"},
540             contentTransferEncoding);
541 
542          \textcolor{comment}{//Base64 encoding?}
543          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(contentTransferEncoding, \textcolor{stringliteral}{"base64"}))
544          \{
545             context->base64Encoding = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
546          \}
547       \}
548    \}
549    \textcolor{keywordflow}{else}
550    \{
551       \textcolor{comment}{//The encapsulation boundary following the last body part is a}
552       \textcolor{comment}{//distinguished delimiter that indicates that no further body parts}
553       \textcolor{comment}{//will follow. Such a delimiter is identical to the previous}
554       \textcolor{comment}{//delimiters, with the addition of two more hyphens at the end of}
555       \textcolor{comment}{//the line}
556       p += sprintf(p, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n--%s--\(\backslash\)r\(\backslash\)n"}, context->boundary);
557    \}
558 
559    \textcolor{comment}{//Terminate the multipart header with an empty line}
560    sprintf(p, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
561 
562    \textcolor{comment}{//Debug message}
563    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, context->buffer);
564 
565    \textcolor{comment}{//Save the length of the header}
566    context->bufferLen = strlen(context->buffer);
567    context->bufferPos = 0;
568 
569    \textcolor{comment}{//Successful processing}
570    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
571 \textcolor{preprocessor}{#else}
572    \textcolor{comment}{//MIME extension is not implemented}
573    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
574 \textcolor{preprocessor}{#endif}
575 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_a90bdd85d7386c059a956d5e186d48d5c}\label{smtp__client__misc_8c_a90bdd85d7386c059a956d5e186d48d5c}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Parse\+Ehlo\+Reply@{smtp\+Client\+Parse\+Ehlo\+Reply}}
\index{smtp\+Client\+Parse\+Ehlo\+Reply@{smtp\+Client\+Parse\+Ehlo\+Reply}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Parse\+Ehlo\+Reply()}{smtpClientParseEhloReply()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Parse\+Ehlo\+Reply (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{reply\+Line }\end{DoxyParamCaption})}



Parse E\+H\+LO response. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em reply\+Line} & Response line \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 258 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
260 \{
261    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
262    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{coap__common_8h_aaa0137cdddb344591e20a2930a1ba54d}{token};
263 
264    \textcolor{comment}{//The line must be at least 4 characters long}
265    \textcolor{keywordflow}{if}(strlen(replyLine) < 4)
266       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
267 
268    \textcolor{comment}{//Skip the response code and the separator}
269    replyLine += 4;
270 
271    \textcolor{comment}{//Get the first keyword}
272    token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(replyLine, \textcolor{stringliteral}{" "}, &p);
273    \textcolor{comment}{//Check whether the response line is empty}
274    \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
275       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
276 
277    \textcolor{comment}{//The response to EHLO is a multiline reply. Each line of the response}
278    \textcolor{comment}{//contains a keyword}
279    \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"STARTTLS"}))
280    \{
281       \textcolor{comment}{//The STARTTLS keyword is used to tell the SMTP client that the}
282       \textcolor{comment}{//SMTP server allows use of TLS}
283       context->startTlsSupported = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
284    \}
285    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"AUTH"}))
286    \{
287       \textcolor{comment}{//The AUTH keyword contains a space-separated list of names of}
288       \textcolor{comment}{//available authentication mechanisms}
289       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{" "}, &p);
290 
291       \textcolor{comment}{//Parse the list of keywords}
292       \textcolor{keywordflow}{while}(token != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
293       \{
294          \textcolor{comment}{//Check the name of the authentication mechanism}
295          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"LOGIN"}))
296          \{
297             \textcolor{comment}{//LOGIN authentication mechanism is supported}
298             context->authLoginSupported = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
299          \}
300          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"PLAIN"}))
301          \{
302             \textcolor{comment}{//PLAIN authentication mechanism is supported}
303             context->authPlainSupported = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
304          \}
305          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(token, \textcolor{stringliteral}{"CRAM-MD5"}))
306          \{
307             \textcolor{comment}{//CRAM-MD5 authentication mechanism is supported}
308             context->authCramMd5Supported = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
309          \}
310          \textcolor{keywordflow}{else}
311          \{
312             \textcolor{comment}{//Unknown authentication mechanism}
313          \}
314 
315          \textcolor{comment}{//Get the next keyword}
316          token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{" "}, &p);
317       \}
318    \}
319    \textcolor{keywordflow}{else}
320    \{
321       \textcolor{comment}{//Discard unknown keywords}
322    \}
323 
324    \textcolor{comment}{//Successful processing}
325    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
326 \}
\end{DoxyCode}
\mbox{\Hypertarget{smtp__client__misc_8c_a9a573cb6d178025fe0beb8f8dab70f11}\label{smtp__client__misc_8c_a9a573cb6d178025fe0beb8f8dab70f11}} 
\index{smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}!smtp\+Client\+Send\+Command@{smtp\+Client\+Send\+Command}}
\index{smtp\+Client\+Send\+Command@{smtp\+Client\+Send\+Command}!smtp\+\_\+client\+\_\+misc.\+c@{smtp\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{smtp\+Client\+Send\+Command()}{smtpClientSendCommand()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} smtp\+Client\+Send\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{smtp__client_8h_a1d51e1986667e1138d72dec48c441c89}{Smtp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{smtp__client_8h_a41608593fa8a8f1b06157bd7bb00667d}{Smtp\+Client\+Reply\+Callback}}]{callback }\end{DoxyParamCaption})}



Send S\+M\+TP command and wait for a reply. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+M\+TP client context \\
\hline
\mbox{\tt in}  & {\em callback} & Optional callback to parse each line of the reply \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 72 of file smtp\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
74 \{
75    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
76    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
77    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} more;
78    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *reply;
79 
80    \textcolor{comment}{//Initialize status code}
81    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
82 
83    \textcolor{comment}{//Point to the server's response}
84    reply = context->buffer;
85 
86    \textcolor{comment}{//Send SMTP command and wait for the SMTP reply to be received}
87    \textcolor{keywordflow}{while}(!error)
88    \{
89       \textcolor{comment}{//Send SMTP command}
90       \textcolor{keywordflow}{if}(context->bufferPos < context->commandLen)
91       \{
92          \textcolor{comment}{//Send more data}
93          error = \hyperlink{smtp__client__transport_8c_a85898809e400ef6197582909b7534d65}{smtpClientSendData}(context,
94             context->buffer + context->bufferPos,
95             context->commandLen - context->bufferPos, &n, 0);
96 
97          \textcolor{comment}{//Check status code}
98          \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} || error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
99          \{
100             \textcolor{comment}{//Advance data pointer}
101             context->bufferPos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
102          \}
103       \}
104       \textcolor{keywordflow}{else}
105       \{
106          \textcolor{comment}{//Determine whether more data should be collected}
107          \textcolor{keywordflow}{if}(context->replyLen != 0 && reply[context->replyLen - 1] == \textcolor{charliteral}{'\(\backslash\)n'})
108             more = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
109          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->replyLen == (\hyperlink{smtp__client_8h_a55cbd4c03a87f28df130203250a61810}{SMTP\_CLIENT\_BUFFER\_SIZE} - 1))
110             more = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
111          \textcolor{keywordflow}{else}
112             more = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
113 
114          \textcolor{comment}{//Receive SMTP response}
115          \textcolor{keywordflow}{if}(more)
116          \{
117             \textcolor{comment}{//Receive more data}
118             error = \hyperlink{smtp__client__transport_8c_a29ef0dfcee4f5d9435c78ae120617fd5}{smtpClientReceiveData}(context,
119                context->buffer + context->replyLen,
120                \hyperlink{smtp__client_8h_a55cbd4c03a87f28df130203250a61810}{SMTP\_CLIENT\_BUFFER\_SIZE} - 1 - context->replyLen,
121                &n, \hyperlink{socket_8h_a36c1d45d435e2f0ebe609c31d0c2da16a8a9906d4aacdf7dd4b7203c86271006b}{SOCKET\_FLAG\_BREAK\_CRLF});
122 
123             \textcolor{comment}{//Check status code}
124             \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
125             \{
126                \textcolor{comment}{//Advance data pointer}
127                context->replyLen += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
128             \}
129          \}
130          \textcolor{keywordflow}{else}
131          \{
132             \textcolor{comment}{//Properly terminate the response with a NULL character}
133             reply[context->replyLen] = \textcolor{charliteral}{'\(\backslash\)0'};
134 
135             \textcolor{comment}{//Remove trailing whitespace from the response}
136             \hyperlink{str_8c_a213a401a08b4083cbddd0fb4673ba430}{strRemoveTrailingSpace}(reply);
137 
138             \textcolor{comment}{//Debug message}
139             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"SMTP server: %s\(\backslash\)r\(\backslash\)n"}, reply);
140 
141             \textcolor{comment}{//All replies begin with a three digit numeric code}
142             \textcolor{keywordflow}{if}(isdigit((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) reply[0]) &&
143                isdigit((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) reply[1]) &&
144                isdigit((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) reply[2]))
145             \{
146                \textcolor{comment}{//A space character follows the response code for the last line}
147                \textcolor{keywordflow}{if}(reply[3] == \textcolor{charliteral}{' '} || reply[3] == \textcolor{charliteral}{'\(\backslash\)0'})
148                \{
149                   \textcolor{comment}{//Retrieve SMTP reply code}
150                   context->replyCode = strtoul(reply, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 10);
151 
152                   \textcolor{comment}{//A valid SMTP response has been received}
153                   \textcolor{keywordflow}{break};
154                \}
155                \textcolor{keywordflow}{else}
156                \{
157                   \textcolor{comment}{//Any callback function defined?}
158                   \textcolor{keywordflow}{if}(callback)
159                   \{
160                      \textcolor{comment}{//Parse intermediary line}
161                      error = callback(context, reply);
162                   \}
163 
164                   \textcolor{comment}{//Flush receive buffer}
165                   context->replyLen = 0;
166                \}
167             \}
168             \textcolor{keywordflow}{else}
169             \{
170                \textcolor{comment}{//Ignore incorrectly formatted lines}
171                context->replyLen = 0;
172             \}
173          \}
174       \}
175    \}
176 
177    \textcolor{comment}{//Return status code}
178    \textcolor{keywordflow}{return} error;
179 \}
\end{DoxyCode}
