\hypertarget{ppp__misc_8c}{}\section{cyclone\+\_\+tcp/ppp/ppp\+\_\+misc.c File Reference}
\label{ppp__misc_8c}\index{cyclone\+\_\+tcp/ppp/ppp\+\_\+misc.\+c@{cyclone\+\_\+tcp/ppp/ppp\+\_\+misc.\+c}}


P\+PP miscellaneous functions.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ppp\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/lcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipcp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ppp/ipv6cp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ppp__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a3b9675b85f9c68935fdcba6d7c0b262f}{ppp\+Send\+Configure\+Ack\+Nak} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{Ppp\+Configure\+Packet} $\ast$configure\+Req\+Packet, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol}, \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188}{Ppp\+Code} \hyperlink{ppp_8h_a966576744a473fafb7687f8e5649941f}{code})
\begin{DoxyCompactList}\small\item\em Send Configure-\/\+Ack, Nak or Reject packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_aad98bd785df68e1f1067eb190bfc638a}{ppp\+Send\+Terminate\+Req} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier}, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Send Terminate-\/\+Request packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a2bd2959558a1ea861bacb3f481a31a5f}{ppp\+Send\+Terminate\+Ack} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier}, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Send Terminate-\/\+Ack packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a3767bc838defa017dacfee2546714ce1}{ppp\+Send\+Code\+Rej} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{Ppp\+Packet} $\ast$packet, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier}, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Send Code-\/\+Reject packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a92cf229e7981da27c9f38f0c897f0c0a}{ppp\+Send\+Protocol\+Rej} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier}, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$information, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Send Protocol-\/\+Reject packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a4cbc7984e9160392ed3a5b80dc8e974b}{ppp\+Send\+Echo\+Rep} (\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$context, const \hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{Ppp\+Echo\+Packet} $\ast$echo\+Req\+Packet, \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol} \hyperlink{lcp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol})
\begin{DoxyCompactList}\small\item\em Send Echo-\/\+Reply packet. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ppp__misc_8c_a52b0a518f20c37d08e66f8c3b437c74f}{ppp\+Add\+Option} (\hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{Ppp\+Configure\+Packet} $\ast$packet, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} option\+Type, const void $\ast$option\+Value, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} option\+Len)
\begin{DoxyCompactList}\small\item\em Add an option to a Configure packet. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
P\+PP miscellaneous functions. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ppp__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ppp__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~P\+P\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}



Definition at line 32 of file ppp\+\_\+misc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ppp__misc_8c_a52b0a518f20c37d08e66f8c3b437c74f}\label{ppp__misc_8c_a52b0a518f20c37d08e66f8c3b437c74f}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Add\+Option@{ppp\+Add\+Option}}
\index{ppp\+Add\+Option@{ppp\+Add\+Option}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Add\+Option()}{pppAddOption()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Add\+Option (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{Ppp\+Configure\+Packet} $\ast$}]{packet,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{option\+Type,  }\item[{const void $\ast$}]{option\+Value,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{option\+Len }\end{DoxyParamCaption})}



Add an option to a Configure packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em packet} & Pointer to the Configure packet \\
\hline
\mbox{\tt in}  & {\em option\+Type} & Option type \\
\hline
\mbox{\tt in}  & {\em option\+Value} & Option value \\
\hline
\mbox{\tt in}  & {\em option\+Len} & Length of the option value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 448 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
450 \{
451    \hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption} *option;
452 
453    \textcolor{comment}{//Make sure the length is valid}
454    \textcolor{keywordflow}{if}(optionLen > (\hyperlink{stdint_8h_aeb4e270a084ee26fe73e799861bd0252}{UINT8\_MAX} - \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption})))
455       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
456 
457    \textcolor{comment}{//Point to the end of the Configure packet}
458    option = (\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption} *) ((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) packet + packet->length);
459 
460    \textcolor{comment}{//Write specified option at current location}
461    option->type = optionType;
462    option->length = optionLen + \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption});
463    \textcolor{comment}{//Copy option data}
464    memcpy(option->data, optionValue, optionLen);
465 
466    \textcolor{comment}{//Update the length of the Configure packet}
467    packet->length += optionLen + \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption});
468 
469    \textcolor{comment}{//Successful processing}
470    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
471 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_a3767bc838defa017dacfee2546714ce1}\label{ppp__misc_8c_a3767bc838defa017dacfee2546714ce1}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Code\+Rej@{ppp\+Send\+Code\+Rej}}
\index{ppp\+Send\+Code\+Rej@{ppp\+Send\+Code\+Rej}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Code\+Rej()}{pppSendCodeRej()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Code\+Rej (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{Ppp\+Packet} $\ast$}]{packet,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier,  }\item[{\hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol}}]{protocol }\end{DoxyParamCaption})}



Send Code-\/\+Reject packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em packet} & Un-\/interpretable packet received from the peer \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 265 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
267 \{
268    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
269    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
270    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
271    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
272    \hyperlink{ppp_8h_ad05fe14ee4cca32c7b40f2cdf9c48a8d}{PppCodeRejPacket} *codeRejPacket;
273 
274    \textcolor{comment}{//Calculate the length of the Code-Reject packet}
275    length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(packet->length) + \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_ad05fe14ee4cca32c7b40f2cdf9c48a8d}{PppCodeRejPacket});
276 
277    \textcolor{comment}{//The rejected packet must be truncated to comply with}
278    \textcolor{comment}{//the peer's established MRU}
279    length = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(length, context->peerConfig.mru);
280 
281    \textcolor{comment}{//Allocate a buffer memory to hold the Code-Reject packet}
282    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(\textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_ad05fe14ee4cca32c7b40f2cdf9c48a8d}{PppCodeRejPacket}), &offset);
283    \textcolor{comment}{//Failed to allocate memory?}
284    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
285       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
286 
287    \textcolor{comment}{//Point to the Code-Reject packet}
288    codeRejPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
289 
290    \textcolor{comment}{//Format packet header}
291    codeRejPacket->code = \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a7635f2c8a624bbf7fcb8eea300082a7d}{PPP\_CODE\_CODE\_REJ};
292    codeRejPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
293    codeRejPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
294 
295    \textcolor{comment}{//The Rejected-Packet field contains a copy of the packet which is being rejected}
296    error = \hyperlink{net__mem_8c_aceae1188a93321e1d4daed11bb8005df}{netBufferAppend}(buffer, packet, length - \textcolor{keyword}{sizeof}(
      \hyperlink{ppp_8h_ad05fe14ee4cca32c7b40f2cdf9c48a8d}{PppCodeRejPacket}));
297 
298    \textcolor{comment}{//Check status code}
299    \textcolor{keywordflow}{if}(!error)
300    \{
301       \textcolor{comment}{//Debug message}
302       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Code-Reject packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
303 
304       \textcolor{comment}{//Send PPP frame}
305       error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
306    \}
307 
308    \textcolor{comment}{//Free previously allocated memory block}
309    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
310    \textcolor{comment}{//Return status code}
311    \textcolor{keywordflow}{return} error;
312 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_a3b9675b85f9c68935fdcba6d7c0b262f}\label{ppp__misc_8c_a3b9675b85f9c68935fdcba6d7c0b262f}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Configure\+Ack\+Nak@{ppp\+Send\+Configure\+Ack\+Nak}}
\index{ppp\+Send\+Configure\+Ack\+Nak@{ppp\+Send\+Configure\+Ack\+Nak}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Configure\+Ack\+Nak()}{pppSendConfigureAckNak()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Configure\+Ack\+Nak (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{Ppp\+Configure\+Packet} $\ast$}]{configure\+Req\+Packet,  }\item[{\hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol}}]{protocol,  }\item[{\hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188}{Ppp\+Code}}]{code }\end{DoxyParamCaption})}



Send Configure-\/\+Ack, Nak or Reject packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em configure\+Req\+Packet} & Pointer to the incoming Configure-\/\+Request \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field \\
\hline
\mbox{\tt in}  & {\em code} & Code field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 56 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
58 \{
59    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
60    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
61    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
62    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
63    \hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{PppConfigurePacket} *configureAckNakPacket;
64    \hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption} *option;
65 
66    \textcolor{comment}{//Initialize status code}
67    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
68    \textcolor{comment}{//Retrieve the length of the Configure-Request packet}
69    length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(configureReqPacket->length);
70 
71    \textcolor{comment}{//Allocate a buffer memory to hold the Configure-Ack, Nak or Reject packet}
72    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
73    \textcolor{comment}{//Failed to allocate memory?}
74    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
75       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
76 
77    \textcolor{comment}{//Point to the beginning of the packet}
78    configureAckNakPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
79 
80    \textcolor{comment}{//Format packet header}
81    configureAckNakPacket->code = \hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code};
82    configureAckNakPacket->identifier = configureReqPacket->identifier;
83    configureAckNakPacket->length = \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{PppConfigurePacket});
84 
85    \textcolor{comment}{//Retrieve the length of the option list}
86    length -= \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a5f9516e80961edda7e2c0b9b964bdd66}{PppConfigurePacket});
87    \textcolor{comment}{//Point to the first option}
88    option = (\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption} *) configureReqPacket->options;
89 
90    \textcolor{comment}{//Parse configuration options}
91    \textcolor{keywordflow}{while}(length > 0)
92    \{
93       \textcolor{comment}{//LCP protocol?}
94       \textcolor{keywordflow}{if}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2aa16ec94a0acadd78f8c120d8bdd45dc5}{PPP\_PROTOCOL\_LCP})
95       \{
96          \textcolor{comment}{//Parse LCP option}
97          \hyperlink{lcp_8c_a8c5764c60af4de217c8e20c76c75252c}{lcpParseOption}(context, option, length, configureAckNakPacket);
98       \}
99 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
100       \textcolor{comment}{//IPCP protocol?}
101       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2a1dbae0b4db670646438954a53f57254a}{PPP\_PROTOCOL\_IPCP})
102       \{
103          \textcolor{comment}{//Parse IPCP option}
104          \hyperlink{ipcp_8c_ae93349562b71505f9006df727ecc4773}{ipcpParseOption}(context, option, length, configureAckNakPacket);
105       \}
106 \textcolor{preprocessor}{#endif}
107 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
108       \textcolor{comment}{//IPV6CP protocol?}
109       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol} == \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2abc85aaca4959631f37902c4c8f34146a}{PPP\_PROTOCOL\_IPV6CP})
110       \{
111          \textcolor{comment}{//Parse IPV6CP option}
112          \hyperlink{ipv6cp_8c_a7264dc210d753ef484aa5bfa6f5f5a7d}{ipv6cpParseOption}(context, option, length, configureAckNakPacket);
113       \}
114 \textcolor{preprocessor}{#endif}
115 
116       \textcolor{comment}{//Remaining bytes to process}
117       length -= option->length;
118       \textcolor{comment}{//Jump to the next option}
119       option = (\hyperlink{ppp_8h_a531e616dc92a1bc09e2b7596eae470c8}{PppOption} *) ((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) option + option->length);
120    \}
121 
122    \textcolor{comment}{//Adjust the length of the multi-part buffer}
123    \hyperlink{net__mem_8c_ac0a46f396754e069dd1ee65cdc559b28}{netBufferSetLength}(buffer, offset + configureAckNakPacket->length);
124    \textcolor{comment}{//Convert length field to network byte order}
125    configureAckNakPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(configureAckNakPacket->length);
126 
127    \textcolor{comment}{//Debug message}
128    \textcolor{keywordflow}{if}(\hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code} == \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a915e8fc9f7c9bacb22b54dbccd684591}{PPP\_CODE\_CONFIGURE\_ACK})
129    \{
130       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Configure-Ack packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
131          \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(configureAckNakPacket->length));
132    \}
133    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code} == \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188aed576599db22b88142cb2cd4e71986be}{PPP\_CODE\_CONFIGURE\_NAK})
134    \{
135       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Configure-Nak packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
136          \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(configureAckNakPacket->length));
137    \}
138    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{coap__common_8h_a966576744a473fafb7687f8e5649941f}{code} == \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a5bd41f9dd646b4a1dd42c2f98f22cedd}{PPP\_CODE\_CONFIGURE\_REJ})
139    \{
140       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Configure-Reject packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
141          \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(configureAckNakPacket->length));
142    \}
143 
144    \textcolor{comment}{//Dump packet contents for debugging purpose}
145    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) configureAckNakPacket,
146       \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(configureAckNakPacket->length), \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
147 
148    \textcolor{comment}{//Send PPP frame}
149    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
150 
151    \textcolor{comment}{//Free previously allocated memory block}
152    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
153    \textcolor{comment}{//Return status code}
154    \textcolor{keywordflow}{return} error;
155 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_a4cbc7984e9160392ed3a5b80dc8e974b}\label{ppp__misc_8c_a4cbc7984e9160392ed3a5b80dc8e974b}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Echo\+Rep@{ppp\+Send\+Echo\+Rep}}
\index{ppp\+Send\+Echo\+Rep@{ppp\+Send\+Echo\+Rep}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Echo\+Rep()}{pppSendEchoRep()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Echo\+Rep (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{Ppp\+Echo\+Packet} $\ast$}]{echo\+Req\+Packet,  }\item[{\hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol}}]{protocol }\end{DoxyParamCaption})}



Send Echo-\/\+Reply packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em echo\+Req\+Packet} & Echo-\/\+Request packet received from the peer \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 385 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
387 \{
388    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
389    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
390    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
391    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
392    \hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{PppEchoPacket} *echoRepPacket;
393 
394    \textcolor{comment}{//Retrieve the length of the Echo-Request packet}
395    length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(echoReqPacket->length);
396 
397    \textcolor{comment}{//Make sure the length is valid}
398    \textcolor{keywordflow}{if}(length < \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{PppEchoPacket}))
399       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
400    \textcolor{keywordflow}{if}(length > context->peerConfig.mru)
401       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
402 
403    \textcolor{comment}{//Allocate a buffer memory to hold the Echo-Reply packet}
404    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(\textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{PppEchoPacket}), &offset);
405    \textcolor{comment}{//Failed to allocate memory?}
406    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
407       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
408 
409    \textcolor{comment}{//Point to the Echo-Reply packet}
410    echoRepPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
411 
412    \textcolor{comment}{//Format packet header}
413    echoRepPacket->code = \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a4302d5cd359bf94f9af9e413db9bf929}{PPP\_CODE\_ECHO\_REP};
414    echoRepPacket->identifier = echoReqPacket->identifier;
415    echoRepPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
416    echoRepPacket->magicNumber = context->localConfig.magicNumber;
417 
418    \textcolor{comment}{//The data field of the Echo-Request packet is copied into the data}
419    \textcolor{comment}{//field of the Echo-Reply packet}
420    error = \hyperlink{net__mem_8c_aceae1188a93321e1d4daed11bb8005df}{netBufferAppend}(buffer, echoReqPacket->data, length - \textcolor{keyword}{sizeof}(
      \hyperlink{ppp_8h_a32588dc42d7123562908b651a0e6bf13}{PppEchoPacket}));
421 
422    \textcolor{comment}{//Check status code}
423    \textcolor{keywordflow}{if}(!error)
424    \{
425       \textcolor{comment}{//Debug message}
426       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Echo-Reply packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
427 
428       \textcolor{comment}{//Send PPP frame}
429       error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
430    \}
431 
432    \textcolor{comment}{//Free previously allocated memory block}
433    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
434    \textcolor{comment}{//Return status code}
435    \textcolor{keywordflow}{return} error;
436 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_a92cf229e7981da27c9f38f0c897f0c0a}\label{ppp__misc_8c_a92cf229e7981da27c9f38f0c897f0c0a}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Protocol\+Rej@{ppp\+Send\+Protocol\+Rej}}
\index{ppp\+Send\+Protocol\+Rej@{ppp\+Send\+Protocol\+Rej}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Protocol\+Rej()}{pppSendProtocolRej()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Protocol\+Rej (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{protocol,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{information,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Send Protocol-\/\+Reject packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\mbox{\tt in}  & {\em protocol} & Rejected protocol \\
\hline
\mbox{\tt in}  & {\em information} & Rejected information \\
\hline
\mbox{\tt in}  & {\em length} & Length of the rejected information \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 325 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
327 \{
328    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
329    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
330    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
331    \hyperlink{ppp_8h_a39a8996b5c30c18325c8602468e095ca}{PppProtocolRejPacket} *protocolRejPacket;
332 
333    \textcolor{comment}{//Calculate the length of the Protocol-Reject packet}
334    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} += \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a39a8996b5c30c18325c8602468e095ca}{PppProtocolRejPacket});
335 
336    \textcolor{comment}{//The Rejected-Information must be truncated to comply with}
337    \textcolor{comment}{//the peer's established MRU}
338    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, context->peerConfig.mru);
339 
340    \textcolor{comment}{//Allocate a buffer memory to hold the Protocol-Reject packet}
341    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(\textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a39a8996b5c30c18325c8602468e095ca}{PppProtocolRejPacket}), &offset);
342    \textcolor{comment}{//Failed to allocate memory?}
343    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
344       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
345 
346    \textcolor{comment}{//Point to the Protocol-Reject packet}
347    protocolRejPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
348 
349    \textcolor{comment}{//Format packet header}
350    protocolRejPacket->code = \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a5ebc2227db3d6ca6bd25832e59fc9c04}{PPP\_CODE\_PROTOCOL\_REJ};
351    protocolRejPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
352    protocolRejPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
353    protocolRejPacket->rejectedProtocol = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(\hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
354 
355    \textcolor{comment}{//The Rejected-Information field contains a copy of the}
356    \textcolor{comment}{//packet which is being rejected}
357    error = \hyperlink{net__mem_8c_aceae1188a93321e1d4daed11bb8005df}{netBufferAppend}(buffer, information,
358       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a39a8996b5c30c18325c8602468e095ca}{PppProtocolRejPacket}));
359 
360    \textcolor{comment}{//Check status code}
361    \textcolor{keywordflow}{if}(!error)
362    \{
363       \textcolor{comment}{//Debug message}
364       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Protocol-Reject packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
365 
366       \textcolor{comment}{//Send PPP frame}
367       error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, 
      \hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2aa16ec94a0acadd78f8c120d8bdd45dc5}{PPP\_PROTOCOL\_LCP});
368    \}
369 
370    \textcolor{comment}{//Free previously allocated memory block}
371    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
372    \textcolor{comment}{//Return status code}
373    \textcolor{keywordflow}{return} error;
374 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_a2bd2959558a1ea861bacb3f481a31a5f}\label{ppp__misc_8c_a2bd2959558a1ea861bacb3f481a31a5f}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Terminate\+Ack@{ppp\+Send\+Terminate\+Ack}}
\index{ppp\+Send\+Terminate\+Ack@{ppp\+Send\+Terminate\+Ack}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Terminate\+Ack()}{pppSendTerminateAck()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Terminate\+Ack (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier,  }\item[{\hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol}}]{protocol }\end{DoxyParamCaption})}



Send Terminate-\/\+Ack packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 215 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
217 \{
218    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
219    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
220    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
221    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
222    \hyperlink{ppp_8h_a224d9bad9d75f66f3d0284450ddf6fb4}{PppTerminatePacket} *terminateAckPacket;
223 
224    \textcolor{comment}{//Length of the Terminate-Ack packet}
225    length = \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a224d9bad9d75f66f3d0284450ddf6fb4}{PppTerminatePacket});
226 
227    \textcolor{comment}{//Allocate a buffer memory to hold the Terminate-Ack packet}
228    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
229    \textcolor{comment}{//Failed to allocate memory?}
230    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
231       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
232 
233    \textcolor{comment}{//Point to the Terminate-Ack packet}
234    terminateAckPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
235 
236    \textcolor{comment}{//Format packet header}
237    terminateAckPacket->code = \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a6e7e46a330cfb72374afc3d09f275860}{PPP\_CODE\_TERMINATE\_ACK};
238    terminateAckPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
239    terminateAckPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
240 
241    \textcolor{comment}{//Debug message}
242    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Terminate-Ack packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
243    \textcolor{comment}{//Dump packet contents for debugging purpose}
244    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) terminateAckPacket, length, 
      \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
245 
246    \textcolor{comment}{//Send PPP frame}
247    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
248 
249    \textcolor{comment}{//Free previously allocated memory block}
250    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
251    \textcolor{comment}{//Return status code}
252    \textcolor{keywordflow}{return} error;
253 \}
\end{DoxyCode}
\mbox{\Hypertarget{ppp__misc_8c_aad98bd785df68e1f1067eb190bfc638a}\label{ppp__misc_8c_aad98bd785df68e1f1067eb190bfc638a}} 
\index{ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}!ppp\+Send\+Terminate\+Req@{ppp\+Send\+Terminate\+Req}}
\index{ppp\+Send\+Terminate\+Req@{ppp\+Send\+Terminate\+Req}!ppp\+\_\+misc.\+c@{ppp\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{ppp\+Send\+Terminate\+Req()}{pppSendTerminateReq()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ppp\+Send\+Terminate\+Req (\begin{DoxyParamCaption}\item[{\hyperlink{ppp_8h_a896c00dd8ba8bad09b3f442b7aa5ad9c}{Ppp\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{identifier,  }\item[{\hyperlink{ppp_8h_a5d2e3565b503cd5cb131aaff4e0ba9c2}{Ppp\+Protocol}}]{protocol }\end{DoxyParamCaption})}



Send Terminate-\/\+Request packet. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & P\+PP context \\
\hline
\mbox{\tt in}  & {\em identifier} & Identifier field \\
\hline
\mbox{\tt in}  & {\em protocol} & Protocol field \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 166 of file ppp\+\_\+misc.\+c.


\begin{DoxyCode}
168 \{
169    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
170    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
171    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
172    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
173    \hyperlink{ppp_8h_a224d9bad9d75f66f3d0284450ddf6fb4}{PppTerminatePacket} *terminateReqPacket;
174 
175    \textcolor{comment}{//Length of the Terminate-Request packet}
176    length = \textcolor{keyword}{sizeof}(\hyperlink{ppp_8h_a224d9bad9d75f66f3d0284450ddf6fb4}{PppTerminatePacket});
177 
178    \textcolor{comment}{//Allocate a buffer memory to hold the Terminate-Request packet}
179    buffer = \hyperlink{ppp_8c_a9100186e00aec050c4952fd462b035aa}{pppAllocBuffer}(length, &offset);
180    \textcolor{comment}{//Failed to allocate memory?}
181    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
182       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
183 
184    \textcolor{comment}{//Point to the Terminate-Request packet}
185    terminateReqPacket = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
186 
187    \textcolor{comment}{//Format packet header}
188    terminateReqPacket->code = \hyperlink{ppp_8h_a961984e634b12a11d381115a46f14188a7471c8252f420930c98ee6a789724a2d}{PPP\_CODE\_TERMINATE\_REQ};
189    terminateReqPacket->identifier = \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
190    terminateReqPacket->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(length);
191 
192    \textcolor{comment}{//Debug message}
193    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Terminate-Request packet (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
194    \textcolor{comment}{//Dump packet contents for debugging purpose}
195    \hyperlink{ppp__debug_8c_aebeb2591b3799b0ede290881fdd67e78}{pppDumpPacket}((\hyperlink{ppp_8h_aa975a68f06316e1db0de962a31e30c2e}{PppPacket} *) terminateReqPacket, length, 
      \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
196 
197    \textcolor{comment}{//Send PPP frame}
198    error = \hyperlink{ppp_8c_aaacd84d6af940a50fa94b67324b080ea}{pppSendFrame}(context->interface, buffer, offset, \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol});
199 
200    \textcolor{comment}{//Free previously allocated memory block}
201    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
202    \textcolor{comment}{//Return status code}
203    \textcolor{keywordflow}{return} error;
204 \}
\end{DoxyCode}
