\hypertarget{modbus__client__transport_8h}{}\section{cyclone\+\_\+tcp/modbus/modbus\+\_\+client\+\_\+transport.h File Reference}
\label{modbus__client__transport_8h}\index{cyclone\+\_\+tcp/modbus/modbus\+\_\+client\+\_\+transport.\+h@{cyclone\+\_\+tcp/modbus/modbus\+\_\+client\+\_\+transport.\+h}}


Transport protocol abstraction layer.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modbus/modbus\+\_\+client.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{modbus__client__transport_8h_ad230f1f59c93b92e9c3a844e7266f794}{modbus\+Client\+Open\+Connection} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Open network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{modbus__client__transport_8h_a04650caca14a2a8c9511e20a115621a6}{modbus\+Client\+Establish\+Connection} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$server\+Ip\+Addr, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} server\+Port)
\begin{DoxyCompactList}\small\item\em Establish network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{modbus__client__transport_8h_aebfc01985165399ae1c91ae6004da9f8}{modbus\+Client\+Shutdown\+Connection} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Shutdown network connection. \end{DoxyCompactList}\item 
void \hyperlink{modbus__client__transport_8h_a90bc319fe060c033a8d71df5c1650014}{modbus\+Client\+Close\+Connection} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Close network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{modbus__client__transport_8h_a85972acaa06cd757074fcf5fe8f73936}{modbus\+Client\+Send\+Data} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send data using the relevant transport protocol. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{modbus__client__transport_8h_a68d9f4b1a68260fb83012565ae86e94a}{modbus\+Client\+Receive\+Data} (\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$context, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Receive data using the relevant transport protocol. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Transport protocol abstraction layer. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{modbus__client__transport_8h_a90bc319fe060c033a8d71df5c1650014}\label{modbus__client__transport_8h_a90bc319fe060c033a8d71df5c1650014}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Close\+Connection@{modbus\+Client\+Close\+Connection}}
\index{modbus\+Client\+Close\+Connection@{modbus\+Client\+Close\+Connection}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Close\+Connection()}{modbusClientCloseConnection()}}
{\footnotesize\ttfamily void modbus\+Client\+Close\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Close network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\end{DoxyParams}


Definition at line 206 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
207 \{
208 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
209    \textcolor{comment}{//Release TLS context}
210    \textcolor{keywordflow}{if}(context->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
211    \{
212       \hyperlink{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}{tlsFree}(context->tlsContext);
213       context->tlsContext = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
214    \}
215 \textcolor{preprocessor}{#endif}
216 
217    \textcolor{comment}{//Close TCP connection}
218    \textcolor{keywordflow}{if}(context->socket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
219    \{
220       \hyperlink{socket_8c_ac5012e9f71c97e2ea0410f2c5baccb0e}{socketClose}(context->socket);
221       context->socket = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
222    \}
223 \}
\end{DoxyCode}
\mbox{\Hypertarget{modbus__client__transport_8h_a04650caca14a2a8c9511e20a115621a6}\label{modbus__client__transport_8h_a04650caca14a2a8c9511e20a115621a6}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Establish\+Connection@{modbus\+Client\+Establish\+Connection}}
\index{modbus\+Client\+Establish\+Connection@{modbus\+Client\+Establish\+Connection}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Establish\+Connection()}{modbusClientEstablishConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} modbus\+Client\+Establish\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{server\+Ip\+Addr,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{server\+Port }\end{DoxyParamCaption})}



Establish network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\mbox{\tt in}  & {\em server\+Ip\+Addr} & IP address of the Modbus/\+T\+CP server to connect to \\
\hline
\mbox{\tt in}  & {\em server\+Port} & T\+CP port number that will be used to establish the connection \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 129 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
131 \{
132    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
133 
134    \textcolor{comment}{//Establish TCP connection}
135    error = \hyperlink{socket_8c_aff3e3c0abc332f42189fce8f362fbd63}{socketConnect}(context->socket, serverIpAddr, serverPort);
136    \textcolor{comment}{//Any error to report?}
137    \textcolor{keywordflow}{if}(error)
138       \textcolor{keywordflow}{return} error;
139 
140 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
141    \textcolor{comment}{//TLS-secured connection?}
142    \textcolor{keywordflow}{if}(context->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
143    \{
144       \textcolor{comment}{//Establish TLS connection}
145       error = \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(context->tlsContext);
146       \textcolor{comment}{//Any error to report?}
147       \textcolor{keywordflow}{if}(error)
148          \textcolor{keywordflow}{return} error;
149 
150       \textcolor{comment}{//Save TLS session}
151       error = \hyperlink{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}{tlsSaveSessionState}(context->tlsContext, &context->tlsSession);
152       \textcolor{comment}{//Any error to report?}
153       \textcolor{keywordflow}{if}(error)
154          \textcolor{keywordflow}{return} error;
155    \}
156 \textcolor{preprocessor}{#endif}
157 
158    \textcolor{comment}{//Successful processing}
159    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
160 \}
\end{DoxyCode}
\mbox{\Hypertarget{modbus__client__transport_8h_ad230f1f59c93b92e9c3a844e7266f794}\label{modbus__client__transport_8h_ad230f1f59c93b92e9c3a844e7266f794}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Open\+Connection@{modbus\+Client\+Open\+Connection}}
\index{modbus\+Client\+Open\+Connection@{modbus\+Client\+Open\+Connection}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Open\+Connection()}{modbusClientOpenConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} modbus\+Client\+Open\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Open network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 50 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
51 \{
52    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
53 
54    \textcolor{comment}{//Open a TCP socket}
55    context->socket = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a9dab003c4dc9f7279e806241534d4859}{SOCKET\_TYPE\_STREAM}, 
      \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969ae0f38a6f025bce7700b3cf0ddd04bb2a}{SOCKET\_IP\_PROTO\_TCP});
56    \textcolor{comment}{//Failed to open socket?}
57    \textcolor{keywordflow}{if}(context->socket == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
58       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
59 
60    \textcolor{comment}{//Associate the socket with the relevant interface}
61    error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(context->socket, context->interface);
62    \textcolor{comment}{//Any error to report?}
63    \textcolor{keywordflow}{if}(error)
64       \textcolor{keywordflow}{return} error;
65 
66    \textcolor{comment}{//Set timeout}
67    error = \hyperlink{socket_8c_abdd29ac0ba4a644c726f5b1280680099}{socketSetTimeout}(context->socket, context->timeout);
68    \textcolor{comment}{//Any error to report?}
69    \textcolor{keywordflow}{if}(error)
70       \textcolor{keywordflow}{return} error;
71 
72 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
73    \textcolor{comment}{//TLS-secured connection?}
74    \textcolor{keywordflow}{if}(context->tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
75    \{
76       \textcolor{comment}{//Allocate TLS context}
77       context->tlsContext = \hyperlink{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}{tlsInit}();
78       \textcolor{comment}{//Failed to allocate TLS context?}
79       \textcolor{keywordflow}{if}(context->tlsContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
80          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
81 
82       \textcolor{comment}{//Select client operation mode}
83       error = \hyperlink{tls_8c_a8713543db673ee5a36b2fda92e082c6b}{tlsSetConnectionEnd}(context->tlsContext, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT});
84       \textcolor{comment}{//Any error to report?}
85       \textcolor{keywordflow}{if}(error)
86          \textcolor{keywordflow}{return} error;
87 
88       \textcolor{comment}{//Bind TLS to the relevant socket}
89       error = \hyperlink{tls_8h_af918bec8cc034c91ae7cb14a4ab24103}{tlsSetSocket}(context->tlsContext, context->socket);
90       \textcolor{comment}{//Any error to report?}
91       \textcolor{keywordflow}{if}(error)
92          \textcolor{keywordflow}{return} error;
93 
94       \textcolor{comment}{//Set TX and RX buffer size}
95       error = \hyperlink{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}{tlsSetBufferSize}(context->tlsContext,
96          \hyperlink{modbus__client_8h_ad8163b0fdd29a82cdff3af224701ebf0}{MODBUS\_CLIENT\_TLS\_TX\_BUFFER\_SIZE}, 
      \hyperlink{modbus__client_8h_afc0c37f5597d09ae01e0a49dc154c24c}{MODBUS\_CLIENT\_TLS\_RX\_BUFFER\_SIZE});
97       \textcolor{comment}{//Any error to report?}
98       \textcolor{keywordflow}{if}(error)
99          \textcolor{keywordflow}{return} error;
100 
101       \textcolor{comment}{//Restore TLS session}
102       error = \hyperlink{tls_8c_a04094e358f18adc2d7ad8686e3258b93}{tlsRestoreSessionState}(context->tlsContext, &context->tlsSession);
103       \textcolor{comment}{//Any error to report?}
104       \textcolor{keywordflow}{if}(error)
105          \textcolor{keywordflow}{return} error;
106 
107       \textcolor{comment}{//Perform TLS related initialization}
108       error = context->tlsInitCallback(context, context->tlsContext);
109       \textcolor{comment}{//Any error to report?}
110       \textcolor{keywordflow}{if}(error)
111          \textcolor{keywordflow}{return} error;
112    \}
113 \textcolor{preprocessor}{#endif}
114 
115    \textcolor{comment}{//Successful processing}
116    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
117 \}
\end{DoxyCode}
\mbox{\Hypertarget{modbus__client__transport_8h_a68d9f4b1a68260fb83012565ae86e94a}\label{modbus__client__transport_8h_a68d9f4b1a68260fb83012565ae86e94a}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Receive\+Data@{modbus\+Client\+Receive\+Data}}
\index{modbus\+Client\+Receive\+Data@{modbus\+Client\+Receive\+Data}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Receive\+Data()}{modbusClientReceiveData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} modbus\+Client\+Receive\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Receive data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em received} & Number of bytes that have been received \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 270 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
272 \{
273    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
274 
275 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
276    \textcolor{comment}{//TLS-secured connection?}
277    \textcolor{keywordflow}{if}(context->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
278    \{
279       \textcolor{comment}{//Receive TLS-encrypted data}
280       error = \hyperlink{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}{tlsRead}(context->tlsContext, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
281    \}
282    \textcolor{keywordflow}{else}
283 \textcolor{preprocessor}{#endif}
284    \{
285       \textcolor{comment}{//Receive data}
286       error = \hyperlink{socket_8c_a894c7bf0bfd4e3886fc584ed7ebbb087}{socketReceive}(context->socket, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
287    \}
288 
289    \textcolor{comment}{//Return status code}
290    \textcolor{keywordflow}{return} error;
291 \}
\end{DoxyCode}
\mbox{\Hypertarget{modbus__client__transport_8h_a85972acaa06cd757074fcf5fe8f73936}\label{modbus__client__transport_8h_a85972acaa06cd757074fcf5fe8f73936}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Send\+Data@{modbus\+Client\+Send\+Data}}
\index{modbus\+Client\+Send\+Data@{modbus\+Client\+Send\+Data}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Send\+Data()}{modbusClientSendData()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} modbus\+Client\+Send\+Data (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 236 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
238 \{
239    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
240 
241 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
242    \textcolor{comment}{//TLS-secured connection?}
243    \textcolor{keywordflow}{if}(context->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
244    \{
245       \textcolor{comment}{//Send TLS-encrypted data}
246       error = \hyperlink{tls_8c_a1b4b22502217a601f7f094403e700b4b}{tlsWrite}(context->tlsContext, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
247    \}
248    \textcolor{keywordflow}{else}
249 \textcolor{preprocessor}{#endif}
250    \{
251       \textcolor{comment}{//Transmit data}
252       error = \hyperlink{socket_8c_aa4eeb3a3294d14d681675ba9f0d3e568}{socketSend}(context->socket, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
253    \}
254 
255    \textcolor{comment}{//Return status code}
256    \textcolor{keywordflow}{return} error;
257 \}
\end{DoxyCode}
\mbox{\Hypertarget{modbus__client__transport_8h_aebfc01985165399ae1c91ae6004da9f8}\label{modbus__client__transport_8h_aebfc01985165399ae1c91ae6004da9f8}} 
\index{modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}!modbus\+Client\+Shutdown\+Connection@{modbus\+Client\+Shutdown\+Connection}}
\index{modbus\+Client\+Shutdown\+Connection@{modbus\+Client\+Shutdown\+Connection}!modbus\+\_\+client\+\_\+transport.\+h@{modbus\+\_\+client\+\_\+transport.\+h}}
\subsubsection{\texorpdfstring{modbus\+Client\+Shutdown\+Connection()}{modbusClientShutdownConnection()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} modbus\+Client\+Shutdown\+Connection (\begin{DoxyParamCaption}\item[{\hyperlink{modbus__client_8h_afb534cba0b839b960b7afd907b978713}{Modbus\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Shutdown network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Modbus/\+T\+CP client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 169 of file modbus\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
170 \{
171    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
172 
173    \textcolor{comment}{//Initialize status code}
174    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
175 
176 \textcolor{preprocessor}{#if (MODBUS\_CLIENT\_TLS\_SUPPORT == ENABLED)}
177    \textcolor{comment}{//Valid TLS context?}
178    \textcolor{keywordflow}{if}(context->tlsContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
179    \{
180       \textcolor{comment}{//Shutdown TLS session}
181       error = \hyperlink{tls_8c_ae6a631703510008537d2cd97ab3425ef}{tlsShutdown}(context->tlsContext);
182    \}
183 \textcolor{preprocessor}{#endif}
184 
185    \textcolor{comment}{//Check status code}
186    \textcolor{keywordflow}{if}(!error)
187    \{
188       \textcolor{comment}{//Valid TCP socket?}
189       \textcolor{keywordflow}{if}(context->socket != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
190       \{
191          \textcolor{comment}{//Shutdown TCP connection}
192          error = \hyperlink{socket_8c_acc736b53dba4a0d3b11b63f75cdcfffb}{socketShutdown}(context->socket, \hyperlink{socket_8h_a36ee33c18de64f549a6336d1aa7333b7a4c533f4b86ea89dfd6a508bb4262c76d}{SOCKET\_SD\_BOTH});
193       \}
194    \}
195 
196    \textcolor{comment}{//Return status code}
197    \textcolor{keywordflow}{return} error;
198 \}
\end{DoxyCode}
