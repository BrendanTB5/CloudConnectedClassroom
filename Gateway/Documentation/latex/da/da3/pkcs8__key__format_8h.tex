\hypertarget{pkcs8__key__format_8h}{}\section{cyclone\+\_\+crypto/pkix/pkcs8\+\_\+key\+\_\+format.h File Reference}
\label{pkcs8__key__format_8h}\index{cyclone\+\_\+crypto/pkix/pkcs8\+\_\+key\+\_\+format.\+h@{cyclone\+\_\+crypto/pkix/pkcs8\+\_\+key\+\_\+format.\+h}}


P\+K\+CS \#8 key formatting.  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkc/rsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkc/dsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ec.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/eddsa.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkcs8__key__format_8h_a24fd24542b0a86618946c9d9778731b7}{pkcs8\+Format\+Rsa\+Private\+Key} (const \hyperlink{structRsaPrivateKey}{Rsa\+Private\+Key} $\ast$private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format an R\+SA private key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkcs8__key__format_8h_af39c11b90a4a0e2bff19a6ca9786bb67}{pkcs8\+Format\+Dsa\+Private\+Key} (const \hyperlink{structDsaPrivateKey}{Dsa\+Private\+Key} $\ast$private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format a D\+SA private key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkcs8__key__format_8h_a0d227b926309795d53f478e4aa352952}{pkcs8\+Format\+Ec\+Private\+Key} (const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$curve\+Info, const \hyperlink{structMpi}{Mpi} $\ast$private\+Key, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$public\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format an EC private key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkcs8__key__format_8h_af097ca358d54dea46ff7246f57adddc6}{pkcs8\+Format\+Ec\+Public\+Key} (const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$curve\+Info, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$public\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format an EC public key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{pkcs8__key__format_8h_ad6ba9ca375bd5433cf5b3f043efd76d5}{pkcs8\+Format\+Eddsa\+Private\+Key} (const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$curve\+Info, const \hyperlink{structEddsaPrivateKey}{Eddsa\+Private\+Key} $\ast$private\+Key, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format an Ed\+D\+SA private key. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
P\+K\+CS \#8 key formatting. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{pkcs8__key__format_8h_af39c11b90a4a0e2bff19a6ca9786bb67}\label{pkcs8__key__format_8h_af39c11b90a4a0e2bff19a6ca9786bb67}} 
\index{pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}!pkcs8\+Format\+Dsa\+Private\+Key@{pkcs8\+Format\+Dsa\+Private\+Key}}
\index{pkcs8\+Format\+Dsa\+Private\+Key@{pkcs8\+Format\+Dsa\+Private\+Key}!pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}}
\subsubsection{\texorpdfstring{pkcs8\+Format\+Dsa\+Private\+Key()}{pkcs8FormatDsaPrivateKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pkcs8\+Format\+Dsa\+Private\+Key (\begin{DoxyParamCaption}\item[{const \hyperlink{structDsaPrivateKey}{Dsa\+Private\+Key} $\ast$}]{private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format a D\+SA private key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em private\+Key} & Pointer to the R\+SA private key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to store the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 98 of file pkcs8\+\_\+key\+\_\+format.\+c.


\begin{DoxyCode}
100 \{
101    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
102    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
103    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
104 
105    \textcolor{comment}{//Export the DSA private key to ASN.1 format}
106    error = \hyperlink{x509__key__format_8c_a8ee26c8fedba8ce89a2947601f81a5e6}{x509ExportDsaPrivateKey}(privateKey, output, &n);
107    \textcolor{comment}{//Any error to report?}
108    \textcolor{keywordflow}{if}(error)
109       \textcolor{keywordflow}{return} error;
110 
111    \textcolor{comment}{//The DSAPrivateKey structure is encapsulated within an octet string}
112    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
113    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
114    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
115    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
116    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
117 
118    \textcolor{comment}{//Write PrivateKey structure}
119    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
120    \textcolor{comment}{//Any error to report?}
121    \textcolor{keywordflow}{if}(error)
122       \textcolor{keywordflow}{return} error;
123 
124    \textcolor{comment}{//Total number of bytes that have been written}
125    *written = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
126 
127    \textcolor{comment}{//Successful processing}
128    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
129 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkcs8__key__format_8h_a0d227b926309795d53f478e4aa352952}\label{pkcs8__key__format_8h_a0d227b926309795d53f478e4aa352952}} 
\index{pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}!pkcs8\+Format\+Ec\+Private\+Key@{pkcs8\+Format\+Ec\+Private\+Key}}
\index{pkcs8\+Format\+Ec\+Private\+Key@{pkcs8\+Format\+Ec\+Private\+Key}!pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}}
\subsubsection{\texorpdfstring{pkcs8\+Format\+Ec\+Private\+Key()}{pkcs8FormatEcPrivateKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pkcs8\+Format\+Ec\+Private\+Key (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$}]{curve\+Info,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{private\+Key,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{public\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format an EC private key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curve\+Info} & Elliptic curve parameters \\
\hline
\mbox{\tt in}  & {\em private\+Key} & EC private key \\
\hline
\mbox{\tt in}  & {\em public\+Key} & EC public key (optional parameter) \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 142 of file pkcs8\+\_\+key\+\_\+format.\+c.


\begin{DoxyCode}
145 \{
146    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
147    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
148    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
149    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
150    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
151 
152    \textcolor{comment}{//Point to the buffer where to write the ASN.1 structure}
153    p = output;
154    \textcolor{comment}{//Length of the ASN.1 structure}
155    length = 0;
156 
157    \textcolor{comment}{//Format Version field (refer to RFC 5915, section 3)}
158    error = \hyperlink{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}{asn1WriteInt32}(1, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
159    \textcolor{comment}{//Any error to report?}
160    \textcolor{keywordflow}{if}(error)
161       \textcolor{keywordflow}{return} error;
162 
163    \textcolor{comment}{//Update the length of the ECPrivateKey structure}
164    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
165 
166    \textcolor{comment}{//If the output parameter is NULL, then the function calculates the}
167    \textcolor{comment}{//length of the resulting PEM file without copying any data}
168    \textcolor{keywordflow}{if}(output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
169    \{
170       \textcolor{comment}{//Advance data pointer}
171       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
172 
173       \textcolor{comment}{//Write the EC private key}
174       error = \hyperlink{crypto__legacy_8h_ae5151562c07814ce486b94bf0035ad12}{mpiWriteRaw}(privateKey, p, curveInfo->\hyperlink{structEcCurveInfo_ab2badb15f033fc37e697df9247635126}{pLen});
175       \textcolor{comment}{//Any error to report?}
176       \textcolor{keywordflow}{if}(error)
177          \textcolor{keywordflow}{return} error;
178    \}
179 
180    \textcolor{comment}{//Format PrivateKey field}
181    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
182    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
183    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
184    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = curveInfo->\hyperlink{structEcCurveInfo_ab2badb15f033fc37e697df9247635126}{pLen};
185    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
186 
187    \textcolor{comment}{//Write the corresponding ASN.1 tag}
188    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, p, &n);
189    \textcolor{comment}{//Any error to report?}
190    \textcolor{keywordflow}{if}(error)
191       \textcolor{keywordflow}{return} error;
192 
193    \textcolor{comment}{//Update the length of the ECPrivateKey structure}
194    n = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
195    length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
196 
197    \textcolor{comment}{//Advance data pointer}
198    \textcolor{keywordflow}{if}(output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
199       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
200 
201    \textcolor{comment}{//The public key is optional}
202    \textcolor{keywordflow}{if}(publicKey != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
203    \{
204       \textcolor{comment}{//Format PublicKey field}
205       error = \hyperlink{pkcs8__key__format_8c_af097ca358d54dea46ff7246f57adddc6}{pkcs8FormatEcPublicKey}(curveInfo, publicKey, p, &n);
206       \textcolor{comment}{//Any error to report?}
207       \textcolor{keywordflow}{if}(error)
208          \textcolor{keywordflow}{return} error;
209 
210       \textcolor{comment}{//Update the length of the ECPrivateKey structure}
211       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
212 
213       \textcolor{comment}{//Advance data pointer}
214       \textcolor{keywordflow}{if}(output != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
215          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
216    \}
217 
218    \textcolor{comment}{//Format ECPrivateKey field}
219    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
220    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
221    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE};
222    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
223    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
224 
225    \textcolor{comment}{//Write the corresponding ASN.1 tag}
226    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
227    \textcolor{comment}{//Any error to report?}
228    \textcolor{keywordflow}{if}(error)
229       \textcolor{keywordflow}{return} error;
230 
231    \textcolor{comment}{//Get the length of the ECPrivateKey structure}
232    n = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
233 
234    \textcolor{comment}{//The PrivateKey field is an octet string whose contents are the value}
235    \textcolor{comment}{//of the private key}
236    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
237    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
238    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
239    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
240    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
241 
242    \textcolor{comment}{//Write the corresponding ASN.1 tag}
243    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
244    \textcolor{comment}{//Any error to report?}
245    \textcolor{keywordflow}{if}(error)
246       \textcolor{keywordflow}{return} error;
247 
248    \textcolor{comment}{//Total number of bytes that have been written}
249    *written = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
250 
251    \textcolor{comment}{//Successful processing}
252    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
253 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkcs8__key__format_8h_af097ca358d54dea46ff7246f57adddc6}\label{pkcs8__key__format_8h_af097ca358d54dea46ff7246f57adddc6}} 
\index{pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}!pkcs8\+Format\+Ec\+Public\+Key@{pkcs8\+Format\+Ec\+Public\+Key}}
\index{pkcs8\+Format\+Ec\+Public\+Key@{pkcs8\+Format\+Ec\+Public\+Key}!pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}}
\subsubsection{\texorpdfstring{pkcs8\+Format\+Ec\+Public\+Key()}{pkcs8FormatEcPublicKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pkcs8\+Format\+Ec\+Public\+Key (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$}]{curve\+Info,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{public\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format an EC public key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curve\+Info} & Elliptic curve parameters \\
\hline
\mbox{\tt in}  & {\em public\+Key} & EC public key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 265 of file pkcs8\+\_\+key\+\_\+format.\+c.


\begin{DoxyCode}
267 \{
268 \textcolor{preprocessor}{#if (EC\_SUPPORT == ENABLED)}
269    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
270    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
271    \hyperlink{structEcDomainParameters}{EcDomainParameters} params;
272    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
273 
274    \textcolor{comment}{//Initialize EC domain parameters}
275    \hyperlink{ec_8c_a5b5132fb8adf668ffa74ec10e7e63441}{ecInitDomainParameters}(&params);
276 
277    \textcolor{comment}{//The bit string shall contain an initial octet which encodes the number}
278    \textcolor{comment}{//of unused bits in the final subsequent octet}
279    output[0] = 0;
280 
281    \textcolor{comment}{//Load EC domain parameters}
282    error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&params, curveInfo);
283 
284    \textcolor{comment}{//Check status code}
285    \textcolor{keywordflow}{if}(!error)
286    \{
287       \textcolor{comment}{//Format ECPublicKey structure}
288       error = \hyperlink{ec_8c_a5b0e532e196ac4715c98d0946304772c}{ecExport}(&params, publicKey, output + 1, &n);
289    \}
290 
291    \textcolor{comment}{//Check status code}
292    \textcolor{keywordflow}{if}(!error)
293    \{
294       \textcolor{comment}{//The public key is encapsulated within a bit string}
295       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
296       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
297       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab40c213cd2fda439f157e8e4523d020c}{ASN1\_TYPE\_BIT\_STRING};
298       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = n + 1;
299       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
300 
301       \textcolor{comment}{//Write the corresponding ASN.1 tag}
302       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
303    \}
304 
305    \textcolor{comment}{//Check status code}
306    \textcolor{keywordflow}{if}(!error)
307    \{
308       \textcolor{comment}{//Explicit tagging shall be used to encode the public key}
309       tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
310       tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
311       tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = 1;
312       tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
313       tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
314 
315       \textcolor{comment}{//Write the corresponding ASN.1 tag}
316       error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, written);
317    \}
318 
319    \textcolor{comment}{//Release EC domain parameters}
320    \hyperlink{ec_8c_a256993c154cf87c3d9d18138a1365eca}{ecFreeDomainParameters}(&params);
321 
322    \textcolor{comment}{//Return status code}
323    \textcolor{keywordflow}{return} error;
324 \textcolor{preprocessor}{#else}
325    \textcolor{comment}{//Not implemented}
326    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
327 \textcolor{preprocessor}{#endif}
328 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkcs8__key__format_8h_ad6ba9ca375bd5433cf5b3f043efd76d5}\label{pkcs8__key__format_8h_ad6ba9ca375bd5433cf5b3f043efd76d5}} 
\index{pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}!pkcs8\+Format\+Eddsa\+Private\+Key@{pkcs8\+Format\+Eddsa\+Private\+Key}}
\index{pkcs8\+Format\+Eddsa\+Private\+Key@{pkcs8\+Format\+Eddsa\+Private\+Key}!pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}}
\subsubsection{\texorpdfstring{pkcs8\+Format\+Eddsa\+Private\+Key()}{pkcs8FormatEddsaPrivateKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pkcs8\+Format\+Eddsa\+Private\+Key (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$}]{curve\+Info,  }\item[{const \hyperlink{structEddsaPrivateKey}{Eddsa\+Private\+Key} $\ast$}]{private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format an Ed\+D\+SA private key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curve\+Info} & Elliptic curve parameters \\
\hline
\mbox{\tt in}  & {\em private\+Key} & Ed\+D\+SA private key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to format the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 340 of file pkcs8\+\_\+key\+\_\+format.\+c.


\begin{DoxyCode}
342 \{
343    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
344    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
345    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
346 
347    \textcolor{comment}{//Length of the ASN.1 structure}
348    n = 0;
349 
350 \textcolor{preprocessor}{#if (ED25519\_SUPPORT == ENABLED)}
351    \textcolor{comment}{//Ed25519 curve identifier?}
352    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(curveInfo->\hyperlink{structEcCurveInfo_a92a5953e46ab92ae71576c79d225d72e}{oid}, curveInfo->\hyperlink{structEcCurveInfo_aa948a3d595c3de00163f6e4ec47b80a2}{oidSize}, \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID},
353       \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID})))
354    \{
355       \textcolor{comment}{//Export the EdDSA private key to ASN.1 format}
356       error = \hyperlink{x509__key__format_8c_abf998d8a1c7fbd551e9e624d79b9725d}{x509ExportEddsaPrivateKey}(privateKey, 
      \hyperlink{ed25519_8h_aed3a21b9d4421f2fc69bc1dd92af50ab}{ED25519\_PRIVATE\_KEY\_LEN},
357          output, &n);
358    \}
359    \textcolor{keywordflow}{else}
360 \textcolor{preprocessor}{#endif}
361 \textcolor{preprocessor}{#if (ED448\_SUPPORT == ENABLED)}
362    \textcolor{comment}{//Ed448 curve identifier?}
363    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(curveInfo->\hyperlink{structEcCurveInfo_a92a5953e46ab92ae71576c79d225d72e}{oid}, curveInfo->\hyperlink{structEcCurveInfo_aa948a3d595c3de00163f6e4ec47b80a2}{oidSize}, \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID},
364       \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID})))
365    \{
366       \textcolor{comment}{//Export the EdDSA private key to ASN.1 format}
367       error = \hyperlink{x509__key__format_8c_abf998d8a1c7fbd551e9e624d79b9725d}{x509ExportEddsaPrivateKey}(privateKey, 
      \hyperlink{ed448_8h_a26f2969270eebc560926f8bada35cb65}{ED448\_PRIVATE\_KEY\_LEN},
368          output, &n);
369    \}
370    \textcolor{keywordflow}{else}
371 \textcolor{preprocessor}{#endif}
372    \textcolor{comment}{//Unknown curve identifier?}
373    \{
374       \textcolor{comment}{//Report an error}
375       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};;
376    \}
377 
378    \textcolor{comment}{//Any error to report?}
379    \textcolor{keywordflow}{if}(error)
380       \textcolor{keywordflow}{return} error;
381 
382    \textcolor{comment}{//The CurvePrivateKey structure is encapsulated within an octet string}
383    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
384    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
385    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
386    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
387    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
388 
389    \textcolor{comment}{//Write PrivateKey structure}
390    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
391    \textcolor{comment}{//Any error to report?}
392    \textcolor{keywordflow}{if}(error)
393       \textcolor{keywordflow}{return} error;
394 
395    \textcolor{comment}{//Total number of bytes that have been written}
396    *written = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
397 
398    \textcolor{comment}{//Successful processing}
399    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
400 \}
\end{DoxyCode}
\mbox{\Hypertarget{pkcs8__key__format_8h_a24fd24542b0a86618946c9d9778731b7}\label{pkcs8__key__format_8h_a24fd24542b0a86618946c9d9778731b7}} 
\index{pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}!pkcs8\+Format\+Rsa\+Private\+Key@{pkcs8\+Format\+Rsa\+Private\+Key}}
\index{pkcs8\+Format\+Rsa\+Private\+Key@{pkcs8\+Format\+Rsa\+Private\+Key}!pkcs8\+\_\+key\+\_\+format.\+h@{pkcs8\+\_\+key\+\_\+format.\+h}}
\subsubsection{\texorpdfstring{pkcs8\+Format\+Rsa\+Private\+Key()}{pkcs8FormatRsaPrivateKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pkcs8\+Format\+Rsa\+Private\+Key (\begin{DoxyParamCaption}\item[{const \hyperlink{structRsaPrivateKey}{Rsa\+Private\+Key} $\ast$}]{private\+Key,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format an R\+SA private key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em private\+Key} & Pointer to the R\+SA private key \\
\hline
\mbox{\tt out}  & {\em output} & Buffer where to store the A\+S\+N.\+1 structure \\
\hline
\mbox{\tt out}  & {\em written} & Length of the resulting A\+S\+N.\+1 structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 56 of file pkcs8\+\_\+key\+\_\+format.\+c.


\begin{DoxyCode}
58 \{
59    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
60    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
61    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
62 
63    \textcolor{comment}{//Export the RSA private key to ASN.1 format}
64    error = \hyperlink{x509__key__format_8c_ae62741137abd1b7a292ce95cb18a8a23}{x509ExportRsaPrivateKey}(privateKey, output, &n);
65    \textcolor{comment}{//Any error to report?}
66    \textcolor{keywordflow}{if}(error)
67       \textcolor{keywordflow}{return} error;
68 
69    \textcolor{comment}{//The RSAPrivateKey structure is encapsulated within an octet string}
70    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
71    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
72    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING};
73    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
74    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = output;
75 
76    \textcolor{comment}{//Write PrivateKey structure}
77    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, output, &n);
78    \textcolor{comment}{//Any error to report?}
79    \textcolor{keywordflow}{if}(error)
80       \textcolor{keywordflow}{return} error;
81 
82    \textcolor{comment}{//Total number of bytes that have been written}
83    *written = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
84 
85    \textcolor{comment}{//Successful processing}
86    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
87 \}
\end{DoxyCode}
