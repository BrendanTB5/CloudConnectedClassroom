\hypertarget{dhcpv6__client_8c}{}\section{cyclone\+\_\+tcp/dhcpv6/dhcpv6\+\_\+client.c File Reference}
\label{dhcpv6__client_8c}\index{cyclone\+\_\+tcp/dhcpv6/dhcpv6\+\_\+client.\+c@{cyclone\+\_\+tcp/dhcpv6/dhcpv6\+\_\+client.\+c}}


D\+H\+C\+Pv6 client (Dynamic Host Configuration Protocol for I\+Pv6)  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ipv6.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ipv6\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ndp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dhcpv6/dhcpv6\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dhcpv6/dhcpv6\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dhcpv6/dhcpv6\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dns/dns\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}date\+\_\+time.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{dhcpv6__client_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a90777ced99a67be301c4f3de730a8e7d}{D\+H\+C\+P\+V6\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{dhcpv6__client_8c_a4b7c727b671107febadf4731a332bdf2}{dhcpv6\+Client\+Get\+Default\+Settings} (\hyperlink{structDhcpv6ClientSettings}{Dhcpv6\+Client\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em Initialize settings with default values. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_af04f903341a262d1adddbd8e878ed0e5}{dhcpv6\+Client\+Init} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{structDhcpv6ClientSettings}{Dhcpv6\+Client\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em D\+H\+C\+Pv6 client initialization. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_acb9e48f60c43f6fb4c800c16a3efde2b}{dhcpv6\+Client\+Start} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Start D\+H\+C\+Pv6 client. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_a1ad0aeb8db19ae4b1be0285f365dffae}{dhcpv6\+Client\+Stop} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Stop D\+H\+C\+Pv6 client. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_a0d922f9224e11d928ee215334f7f8a99}{dhcpv6\+Client\+Release} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Release D\+H\+C\+Pv6 lease. \end{DoxyCompactList}\item 
\hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9}{Dhcpv6\+State} \hyperlink{dhcpv6__client_8c_aaa4bae0b8198fb1a32bfb99bb9577797}{dhcpv6\+Client\+Get\+State} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Retrieve current state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a0856bc5fef6b68be0c8780ab0b25ae5c}{dhcpv6\+Client\+Tick} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em D\+H\+C\+Pv6 client timer handler. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a9061e440105f4e3ec613078afe8c7fd8}{dhcpv6\+Client\+Link\+Change\+Event} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Callback function for link change event. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a3a68a2c66db4634e60cf22402db2d1c8}{dhcpv6\+Client\+State\+Init} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em I\+N\+IT state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a3f8b9540189d50995763ccef0e89037b}{dhcpv6\+Client\+State\+Solicit} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em S\+O\+L\+I\+C\+IT state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_aa24ccb150ee9615fb89b5dae52b709c5}{dhcpv6\+Client\+State\+Request} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em R\+E\+Q\+U\+E\+ST state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_acc0bcc17a308c4015f93d1413efe6cdc}{dhcpv6\+Client\+State\+Init\+Confirm} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em I\+N\+I\+T-\/\+C\+O\+N\+F\+I\+RM state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a003a5c770aeaf0c5df2bb69afb28e36f}{dhcpv6\+Client\+State\+Confirm} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em C\+O\+N\+F\+I\+RM state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_ac0a432f4acd640a42a731407c81fc6c5}{dhcpv6\+Client\+State\+Dad} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em D\+AD state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a5b7bf9e3e3893c66b1d11f9b1cd8173b}{dhcpv6\+Client\+State\+Bound} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em B\+O\+U\+ND state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a06d1754aad1293f116e268a803f7b9b3}{dhcpv6\+Client\+State\+Renew} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em R\+E\+N\+EW state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a09565760718a3fd8534b6213870106c5}{dhcpv6\+Client\+State\+Rebind} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em R\+E\+B\+I\+ND state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a471ff743a2f7f0ba114d24e21b094207}{dhcpv6\+Client\+State\+Release} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em R\+E\+L\+E\+A\+SE state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a270893a7e759dc1cbbdbf29e4fabd653}{dhcpv6\+Client\+State\+Decline} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em D\+E\+C\+L\+I\+NE state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6\+Client\+Send\+Message} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6c}{Dhcpv6\+Message\+Type} \hyperlink{ppp_8h_a1d127017fb298b889f4ba24752d08b8e}{type})
\begin{DoxyCompactList}\small\item\em Send Solicit message. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_acc731e16386b5bb776b7acbbe58ea2b8}{dhcpv6\+Client\+Process\+Message} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$pseudo\+Header, const \hyperlink{udp_8h_a6877bae1da8326482f5e311875e52bce}{Udp\+Header} $\ast$udp\+Header, const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$buffer, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Process incoming D\+H\+C\+Pv6 message. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_ac0a83fe8f0c247ae596f245e727c56cd}{dhcpv6\+Client\+Parse\+Advertise} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Advertise message. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_ae47455838efddde0bce836e13249c2d0}{dhcpv6\+Client\+Parse\+Reply} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Reply message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_ad68a947419af81c6e478eaa92ae7680e}{dhcpv6\+Client\+Parse\+Ia\+Na\+Option} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$option)
\begin{DoxyCompactList}\small\item\em Parse I\+A\+\_\+\+NA option. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_ac9bbd88ba30bd504ed516714177e2b1d}{dhcpv6\+Client\+Parse\+Ia\+Addr\+Option} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$option)
\begin{DoxyCompactList}\small\item\em Parse IA Address option. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a38390e93bf1378cd3b58f09e58912de3}{dhcpv6\+Client\+Add\+Addr} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} $\ast$\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr}, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{ndp_8h_a5a204ed3be422255e9aa086573667e11}{valid\+Lifetime}, \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{ndp_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferred\+Lifetime})
\begin{DoxyCompactList}\small\item\em Add an I\+Pv6 address to the IA. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a960a1cdb90a7bd9abbf9d2a5bd70fa8d}{dhcpv6\+Client\+Remove\+Addr} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} $\ast$\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr})
\begin{DoxyCompactList}\small\item\em Remove an I\+Pv6 address from the IA. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}{dhcpv6\+Client\+Flush\+Addr\+List} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Flush the list of I\+Pv6 addresses from the IA. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_aebf29ea2ff641b03c1736f386c63e268}{dhcpv6\+Client\+Generate\+Duid} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate client\textquotesingle{}s D\+U\+ID. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_a8759e1d2cf5b1556bfa3d972e70e67e1}{dhcpv6\+Client\+Generate\+Fqdn} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate client\textquotesingle{}s fully qualified domain name. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{dhcpv6__client_8c_a0e2ede14d583dbc040aeecc01b262ec2}{dhcpv6\+Client\+Generate\+Link\+Local\+Addr} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate a link-\/local address. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}{dhcpv6\+Client\+Check\+Server\+Id} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$server\+Id\+Option)
\begin{DoxyCompactList}\small\item\em Check the Server Identifier option. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}{dhcpv6\+Client\+Check\+Timeout} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Manage D\+H\+C\+Pv6 configuration timeout. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{dhcpv6__client_8c_a0c0b3763ac06274d8b68eb5126fb51c8}{dhcpv6\+Client\+Compute\+Elapsed\+Time} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Compute the time elapsed since the client sent the first message. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6\+Client\+Change\+State} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context, \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9}{Dhcpv6\+State} new\+State, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} delay)
\begin{DoxyCompactList}\small\item\em Update D\+H\+C\+Pv6 F\+SM state. \end{DoxyCompactList}\item 
void \hyperlink{dhcpv6__client_8c_a883f4820eaaff34776c31c99c300e3ef}{dhcpv6\+Client\+Dump\+Config} (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Dump D\+H\+C\+Pv6 configuration for debugging purpose. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} \hyperlink{dhcpv6__client_8c_a0ad2c17a8d547e75d579b9763ace80bb}{dhcpv6\+Client\+Tick\+Counter}
\item 
static const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{dhcpv6__client_8c_aab426d22a7b9001f61aab099517cee28}{dhcpv6\+Option\+List} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
D\+H\+C\+Pv6 client (Dynamic Host Configuration Protocol for I\+Pv6) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
The Dynamic Host Configuration Protocol for I\+Pv6 enables D\+H\+CP servers to pass configuration parameters such as I\+Pv6 network addresses to I\+Pv6 nodes. This protocol is a stateful counterpart to I\+Pv6 Stateless Address Autoconfiguration (R\+FC 2462), and can be used separately or concurrently with the latter to obtain configuration parameters. Refer to R\+FC 3315

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{dhcpv6__client_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{dhcpv6__client_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a90777ced99a67be301c4f3de730a8e7d}{D\+H\+C\+P\+V6\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 40 of file dhcpv6\+\_\+client.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{dhcpv6__client_8c_a38390e93bf1378cd3b58f09e58912de3}\label{dhcpv6__client_8c_a38390e93bf1378cd3b58f09e58912de3}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Add\+Addr@{dhcpv6\+Client\+Add\+Addr}}
\index{dhcpv6\+Client\+Add\+Addr@{dhcpv6\+Client\+Add\+Addr}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Add\+Addr()}{dhcpv6ClientAddAddr()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Add\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} $\ast$}]{addr,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{valid\+Lifetime,  }\item[{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}]{preferred\+Lifetime }\end{DoxyParamCaption})}



Add an I\+Pv6 address to the IA. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em addr} & I\+Pv6 address to be added \\
\hline
\mbox{\tt in}  & {\em valid\+Lifetime} & Valid lifetime, in seconds \\
\hline
\mbox{\tt in}  & {\em preferred\+Lifetime} & Preferred lifetime, in seconds \\
\hline
\end{DoxyParams}


Definition at line 2156 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2158 \{
2159    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
2160    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
2161    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *firstFreeEntry;
2162 
2163    \textcolor{comment}{//Keep track of the first free entry}
2164    firstFreeEntry = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
2165 
2166    \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
2167    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
2168    \{
2169       \textcolor{comment}{//Point to the current entry}
2170       entry = &context->ia.addrList[i];
2171 
2172       \textcolor{comment}{//Valid IPv6 address?}
2173       \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
2174       \{
2175          \textcolor{comment}{//Check whether the current entry matches the specified address}
2176          \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_ab1e93bd2152bc3f3b5642fd0216384d7}{ipv6CompAddr}(&entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr}, \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr}))
2177             \textcolor{keywordflow}{break};
2178       \}
2179       \textcolor{keywordflow}{else}
2180       \{
2181          \textcolor{comment}{//Keep track of the first free entry}
2182          \textcolor{keywordflow}{if}(firstFreeEntry == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2183             firstFreeEntry = entry;
2184       \}
2185    \}
2186 
2187    \textcolor{comment}{//No matching entry found?}
2188    \textcolor{keywordflow}{if}(i >= \hyperlink{ipv6_8h_a928a90013c8822cded35706806f00171}{IPV6\_PREFIX\_LIST\_SIZE})
2189       entry = firstFreeEntry;
2190 
2191    \textcolor{comment}{//Update the entry if necessary}
2192    \textcolor{keywordflow}{if}(entry != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2193    \{
2194       \textcolor{comment}{//Save IPv6 address}
2195       entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr} = *\hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
2196 
2197       \textcolor{comment}{//Save lifetimes}
2198       entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} = \hyperlink{dhcpv6__common_8h_a6bcd95080db3b3f2265498723b93d7b2}{validLifetime};
2199       entry->\hyperlink{structDhcpv6ClientAddrEntry_a24e1399fe28c7e13c134de1e2953e051}{preferredLifetime} = \hyperlink{dhcpv6__common_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferredLifetime};
2200    \}
2201 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}\label{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Change\+State@{dhcpv6\+Client\+Change\+State}}
\index{dhcpv6\+Client\+Change\+State@{dhcpv6\+Client\+Change\+State}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Change\+State()}{dhcpv6ClientChangeState()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Change\+State (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9}{Dhcpv6\+State}}]{new\+State,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{delay }\end{DoxyParamCaption})}



Update D\+H\+C\+Pv6 F\+SM state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em new\+State} & New D\+H\+C\+Pv6 state to switch to \\
\hline
\mbox{\tt in}  & {\em delay} & Initial delay \\
\hline
\end{DoxyParams}


Definition at line 2506 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2508 \{
2509    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
2510 
2511    \textcolor{comment}{//Get current time}
2512    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
2513 
2514 \textcolor{preprocessor}{#if (DHCPV6\_TRACE\_LEVEL >= TRACE\_LEVEL\_INFO)}
2515    \textcolor{comment}{//Sanity check}
2516    \textcolor{keywordflow}{if}(newState <= \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a198862c17ecac221d19b82f793b5fff8}{DHCPV6\_STATE\_DECLINE})
2517    \{
2518       \textcolor{comment}{//DHCPv6 FSM states}
2519       \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *stateLabel[] =
2520       \{
2521          \textcolor{stringliteral}{"INIT"},
2522          \textcolor{stringliteral}{"SOLICIT"},
2523          \textcolor{stringliteral}{"REQUEST"},
2524          \textcolor{stringliteral}{"INIT-CONFIRM"},
2525          \textcolor{stringliteral}{"CONFIRM"},
2526          \textcolor{stringliteral}{"DAD"},
2527          \textcolor{stringliteral}{"BOUND"},
2528          \textcolor{stringliteral}{"RENEW"},
2529          \textcolor{stringliteral}{"REBIND"},
2530          \textcolor{stringliteral}{"RELEASE"},
2531          \textcolor{stringliteral}{"DECLINE"}
2532       \};
2533 
2534       \textcolor{comment}{//Debug message}
2535       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"%s: DHCPv6 client %s state\(\backslash\)r\(\backslash\)n"},
2536          \hyperlink{date__time_8c_ae15b3e664208ca7e4d6983921865cd74}{formatSystemTime}(time, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}), stateLabel[newState]);
2537    \}
2538 \textcolor{preprocessor}{#endif}
2539 
2540    \textcolor{comment}{//Set time stamp}
2541    context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
2542    \textcolor{comment}{//Set initial delay}
2543    context->timeout = delay;
2544    \textcolor{comment}{//Reset retransmission counter}
2545    context->retransmitCount = 0;
2546    \textcolor{comment}{//Switch to the new state}
2547    context->state = newState;
2548 
2549    \textcolor{comment}{//Any registered callback?}
2550    \textcolor{keywordflow}{if}(context->settings.stateChangeEvent != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2551    \{
2552       \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2553 
2554       \textcolor{comment}{//Point to the underlying network interface}
2555       \textcolor{keyword}{interface }= context->settings.interface;
2556 
2557       \textcolor{comment}{//Release exclusive access}
2558       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
2559       \textcolor{comment}{//Invoke user callback function}
2560       context->settings.stateChangeEvent(context, interface, newState);
2561       \textcolor{comment}{//Get exclusive access}
2562       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
2563    \}
2564 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}\label{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Check\+Server\+Id@{dhcpv6\+Client\+Check\+Server\+Id}}
\index{dhcpv6\+Client\+Check\+Server\+Id@{dhcpv6\+Client\+Check\+Server\+Id}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Check\+Server\+Id()}{dhcpv6ClientCheckServerId()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} dhcpv6\+Client\+Check\+Server\+Id (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$}]{server\+Id\+Option }\end{DoxyParamCaption})}



Check the Server Identifier option. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em server\+Id\+Option} & Pointer to the Server Identifier option \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the option matches the server’s D\+U\+ID, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 2409 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2411 \{
2412    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2413 
2414    \textcolor{comment}{//Check the length of the Server Identifier option}
2415    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length) == context->serverIdLength)
2416    \{
2417       \textcolor{comment}{//Check whether the Server Identifier option matches the server’s DUID}
2418       \textcolor{keywordflow}{if}(!memcmp(serverIdOption->value, context->serverId, context->serverIdLength))
2419          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2420    \}
2421 
2422    \textcolor{comment}{//Return TRUE if the option matches the server’s DUID}
2423    \textcolor{keywordflow}{return} valid;
2424 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}\label{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Check\+Timeout@{dhcpv6\+Client\+Check\+Timeout}}
\index{dhcpv6\+Client\+Check\+Timeout@{dhcpv6\+Client\+Check\+Timeout}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Check\+Timeout()}{dhcpv6ClientCheckTimeout()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Check\+Timeout (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Manage D\+H\+C\+Pv6 configuration timeout. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 2432 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2433 \{
2434    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
2435    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2436 
2437    \textcolor{comment}{//Point to the underlying network interface}
2438    \textcolor{keyword}{interface }= context->settings.interface;
2439 
2440    \textcolor{comment}{//Get current time}
2441    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
2442 
2443    \textcolor{comment}{//Any registered callback?}
2444    \textcolor{keywordflow}{if}(context->settings.timeoutEvent != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2445    \{
2446       \textcolor{comment}{//DHCPv6 configuration timeout?}
2447       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->configStartTime + context->settings.timeout) >= 0)
2448       \{
2449          \textcolor{comment}{//Ensure the callback function is only called once}
2450          \textcolor{keywordflow}{if}(!context->timeoutEventDone)
2451          \{
2452             \textcolor{comment}{//Release exclusive access}
2453             \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
2454             \textcolor{comment}{//Invoke user callback function}
2455             context->settings.timeoutEvent(context, interface);
2456             \textcolor{comment}{//Get exclusive access}
2457             \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
2458 
2459             \textcolor{comment}{//Set flag}
2460             context->timeoutEventDone = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2461          \}
2462       \}
2463    \}
2464 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a0c0b3763ac06274d8b68eb5126fb51c8}\label{dhcpv6__client_8c_a0c0b3763ac06274d8b68eb5126fb51c8}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Compute\+Elapsed\+Time@{dhcpv6\+Client\+Compute\+Elapsed\+Time}}
\index{dhcpv6\+Client\+Compute\+Elapsed\+Time@{dhcpv6\+Client\+Compute\+Elapsed\+Time}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Compute\+Elapsed\+Time()}{dhcpv6ClientComputeElapsedTime()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} dhcpv6\+Client\+Compute\+Elapsed\+Time (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Compute the time elapsed since the client sent the first message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The elapsed time expressed in hundredths of a second 
\end{DoxyReturn}


Definition at line 2473 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2474 \{
2475    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
2476 
2477    \textcolor{comment}{//Check retransmission counter}
2478    \textcolor{keywordflow}{if}(context->retransmitCount == 0)
2479    \{
2480       \textcolor{comment}{//The elapsed time must be 0 for the first message}
2481       time = 0;
2482    \}
2483    \textcolor{keywordflow}{else}
2484    \{
2485       \textcolor{comment}{//Compute the time elapsed since the client sent the}
2486       \textcolor{comment}{//first message (in hundredths of a second)}
2487       time = (\hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}() - context->exchangeStartTime) / 10;
2488 
2489       \textcolor{comment}{//The value 0xFFFF is used to represent any elapsed time values}
2490       \textcolor{comment}{//greater than the largest time value that can be represented}
2491       time = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(time, 0xFFFF);
2492    \}
2493 
2494    \textcolor{comment}{//Convert the 16-bit value to network byte order}
2495    \textcolor{keywordflow}{return} \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(time);
2496 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a883f4820eaaff34776c31c99c300e3ef}\label{dhcpv6__client_8c_a883f4820eaaff34776c31c99c300e3ef}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Dump\+Config@{dhcpv6\+Client\+Dump\+Config}}
\index{dhcpv6\+Client\+Dump\+Config@{dhcpv6\+Client\+Dump\+Config}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Dump\+Config()}{dhcpv6ClientDumpConfig()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Dump\+Config (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Dump D\+H\+C\+Pv6 configuration for debugging purpose. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 2572 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2573 \{
2574 \textcolor{preprocessor}{#if (DHCPV6\_TRACE\_LEVEL >= TRACE\_LEVEL\_INFO)}
2575    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
2576    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2577    \hyperlink{structIpv6Context}{Ipv6Context} *ipv6Context;
2578 
2579    \textcolor{comment}{//Point to the underlying network interface}
2580    \textcolor{keyword}{interface }= context->settings.interface;
2581    \textcolor{comment}{//Point to the IPv6 context}
2582    ipv6Context = &interface->ipv6Context;
2583 
2584    \textcolor{comment}{//Debug message}
2585    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
2586    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"DHCPv6 configuration:\(\backslash\)r\(\backslash\)n"});
2587 
2588    \textcolor{comment}{//Lease start time}
2589    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Lease Start Time = %s\(\backslash\)r\(\backslash\)n"},
2590       \hyperlink{date__time_8c_ae15b3e664208ca7e4d6983921865cd74}{formatSystemTime}(context->leaseStartTime, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
2591 
2592    \textcolor{comment}{//T1 parameter}
2593    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  T1 = %"} PRIu32 \textcolor{stringliteral}{"s\(\backslash\)r\(\backslash\)n"}, context->ia.t1);
2594    \textcolor{comment}{//T2 parameter}
2595    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  T2 = %"} PRIu32 \textcolor{stringliteral}{"s\(\backslash\)r\(\backslash\)n"}, context->ia.t2);
2596 
2597    \textcolor{comment}{//Global addresses}
2598    \textcolor{keywordflow}{for}(i = 1; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
2599    \{
2600       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Global Address %u = %s\(\backslash\)r\(\backslash\)n"}, i,
2601          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->addrList[i].addr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
2602    \}
2603 
2604    \textcolor{comment}{//DNS servers}
2605    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_a7ef30c7f719916efa14b509b7ef707a1}{IPV6\_DNS\_SERVER\_LIST\_SIZE}; i++)
2606    \{
2607       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  DNS Server %u = %s\(\backslash\)r\(\backslash\)n"}, i + 1,
2608          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->dnsServerList[i], \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
2609    \}
2610 
2611    \textcolor{comment}{//Debug message}
2612    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
2613 \textcolor{preprocessor}{#endif}
2614 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}\label{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Flush\+Addr\+List@{dhcpv6\+Client\+Flush\+Addr\+List}}
\index{dhcpv6\+Client\+Flush\+Addr\+List@{dhcpv6\+Client\+Flush\+Addr\+List}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Flush\+Addr\+List()}{dhcpv6ClientFlushAddrList()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Flush\+Addr\+List (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Flush the list of I\+Pv6 addresses from the IA. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 2248 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2249 \{
2250    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
2251    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2252    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
2253 
2254    \textcolor{comment}{//Point to the underlying network interface}
2255    \textcolor{keyword}{interface }= context->settings.interface;
2256 
2257    \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
2258    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
2259    \{
2260       \textcolor{comment}{//Point to the current entry}
2261       entry = &context->ia.addrList[i];
2262 
2263       \textcolor{comment}{//Valid IPv6 address?}
2264       \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
2265       \{
2266          \textcolor{comment}{//The IPv6 address is no more valid and should be removed from}
2267          \textcolor{comment}{//the list of IPv6 addresses assigned to the interface}
2268          \hyperlink{ipv6__misc_8c_aa72b374b0dba9090d90f799776797452}{ipv6RemoveAddr}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr});
2269 
2270          \textcolor{comment}{//Remove the IPv6 address from the IA}
2271          entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} = 0;
2272       \}
2273    \}
2274 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_aebf29ea2ff641b03c1736f386c63e268}\label{dhcpv6__client_8c_aebf29ea2ff641b03c1736f386c63e268}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Generate\+Duid@{dhcpv6\+Client\+Generate\+Duid}}
\index{dhcpv6\+Client\+Generate\+Duid@{dhcpv6\+Client\+Generate\+Duid}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Generate\+Duid()}{dhcpv6ClientGenerateDuid()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Generate\+Duid (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate client\textquotesingle{}s D\+U\+ID. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2283 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2284 \{
2285    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2286    \hyperlink{dhcpv6__common_8h_a1e86d9754bd194ee54193984b5fe9372}{Dhcpv6DuidLl} *duid;
2287 \textcolor{preprocessor}{#if (ETH\_SUPPORT == ENABLED)}
2288    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *logicalInterface;
2289 \textcolor{preprocessor}{#endif}
2290 
2291    \textcolor{comment}{//Point to the underlying network interface}
2292    \textcolor{keyword}{interface }= context->settings.interface;
2293 
2294    \textcolor{comment}{//Point to the buffer where to format the client's DUID}
2295    duid = (\hyperlink{dhcpv6__common_8h_a1e86d9754bd194ee54193984b5fe9372}{Dhcpv6DuidLl} *) context->clientId;
2296 
2297 #if (\hyperlink{ethernet_8h_a563c35fdc76f8209baf915c87669dc0c}{ETH\_SUPPORT} == \hyperlink{os__port_8h_a73c228f87e038e8295ee8ea8eceaa5ac}{ENABLED})
2298    \textcolor{comment}{//Point to the logical interface}
2299    logicalInterface = \hyperlink{nic_8c_a650d776d6513c3bb88671c3aedd782f0}{nicGetLogicalInterface}(interface);
2300 
2301    \textcolor{comment}{//Generate a DUID-LL from the MAC address}
2302    duid->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_abef597acd1a5942cbc3ed9e9b7b88213a60845b706820247cf51b47ecb1b32ae2}{DHCPV6\_DUID\_LL});
2303    duid->hardwareType = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_a68972e2b17fef68993caa2d2d176093da4425acbe1612f0f72eed4bc27cb00063}{DHCPV6\_HARDWARE\_TYPE\_ETH});
2304    duid->linkLayerAddr = logicalInterface->macAddr;
2305 \textcolor{preprocessor}{#else}
2306    \textcolor{comment}{//Generate a DUID-LL from the EUI-64 identifier}
2307    duid->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_abef597acd1a5942cbc3ed9e9b7b88213a60845b706820247cf51b47ecb1b32ae2}{DHCPV6\_DUID\_LL});
2308    duid->hardwareType = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_a68972e2b17fef68993caa2d2d176093dae3ee83e839a01133618aea5b338d7c5f}{DHCPV6\_HARDWARE\_TYPE\_EUI64});
2309    duid->linkLayerAddr = interface->eui64;
2310 \textcolor{preprocessor}{#endif}
2311 
2312    \textcolor{comment}{//Length of the newly generated DUID}
2313    context->clientIdLength = \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a1e86d9754bd194ee54193984b5fe9372}{Dhcpv6DuidLl});
2314 
2315    \textcolor{comment}{//Successful processing}
2316    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2317 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a8759e1d2cf5b1556bfa3d972e70e67e1}\label{dhcpv6__client_8c_a8759e1d2cf5b1556bfa3d972e70e67e1}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Generate\+Fqdn@{dhcpv6\+Client\+Generate\+Fqdn}}
\index{dhcpv6\+Client\+Generate\+Fqdn@{dhcpv6\+Client\+Generate\+Fqdn}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Generate\+Fqdn()}{dhcpv6ClientGenerateFqdn()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Generate\+Fqdn (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate client\textquotesingle{}s fully qualified domain name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2326 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2327 \{
2328    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2329    \hyperlink{dhcpv6__common_8h_a95a52f48a22c46a8c16f31ae310f29eb}{Dhcpv6FqdnOption} *fqdnOption;
2330 
2331    \textcolor{comment}{//Point to the underlying network interface}
2332    \textcolor{keyword}{interface }= context->settings.interface;
2333 
2334    \textcolor{comment}{//Point to the buffer where to format the client's FQDN}
2335    fqdnOption = (\hyperlink{dhcpv6__common_8h_a95a52f48a22c46a8c16f31ae310f29eb}{Dhcpv6FqdnOption} *) context->clientFqdn;
2336 
2337    \textcolor{comment}{//Set flags}
2338    fqdnOption->mbz = 0;
2339    fqdnOption->n = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2340    fqdnOption->o = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2341    fqdnOption->s = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
2342 
2343    \textcolor{comment}{//Encode client's FQDN}
2344    context->clientFqdnLength = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(interface->hostname,
2345       fqdnOption->domainName);
2346 
2347    \textcolor{comment}{//Successful processing}
2348    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2349 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a0e2ede14d583dbc040aeecc01b262ec2}\label{dhcpv6__client_8c_a0e2ede14d583dbc040aeecc01b262ec2}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Generate\+Link\+Local\+Addr@{dhcpv6\+Client\+Generate\+Link\+Local\+Addr}}
\index{dhcpv6\+Client\+Generate\+Link\+Local\+Addr@{dhcpv6\+Client\+Generate\+Link\+Local\+Addr}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Generate\+Link\+Local\+Addr()}{dhcpv6ClientGenerateLinkLocalAddr()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Generate\+Link\+Local\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate a link-\/local address. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2358 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2359 \{
2360    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2361    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2362    \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr} \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
2363 
2364    \textcolor{comment}{//Point to the underlying network interface}
2365    \textcolor{keyword}{interface }= context->settings.interface;
2366 
2367    \textcolor{comment}{//Check whether a link-local address has been manually assigned}
2368    \textcolor{keywordflow}{if}(interface->ipv6Context.addrList[0].state != \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID} &&
2369       interface->ipv6Context.addrList[0].permanent)
2370    \{
2371       \textcolor{comment}{//Keep using the current link-local address}
2372       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2373    \}
2374    \textcolor{keywordflow}{else}
2375    \{
2376       \textcolor{comment}{//A link-local address is formed by combining the well-known}
2377       \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
2378       \hyperlink{ipv6__misc_8c_a528bfb892811943ea3910ca0e13b0ed1}{ipv6GenerateLinkLocalAddr}(&interface->eui64, &addr);
2379 
2380 \textcolor{preprocessor}{#if (NDP\_SUPPORT == ENABLED)}
2381       \textcolor{comment}{//Check whether Duplicate Address Detection should be performed}
2382       \textcolor{keywordflow}{if}(interface->ndpContext.dupAddrDetectTransmits > 0)
2383       \{
2384          \textcolor{comment}{//Use the link-local address as a tentative address}
2385          error = \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, 0, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE},
2386             \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
2387       \}
2388       \textcolor{keywordflow}{else}
2389 \textcolor{preprocessor}{#endif}
2390       \{
2391          \textcolor{comment}{//The use of the link-local address is now unrestricted}
2392          error = \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, 0, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED},
2393             \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
2394       \}
2395    \}
2396 
2397    \textcolor{comment}{//Return status code}
2398    \textcolor{keywordflow}{return} error;
2399 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a4b7c727b671107febadf4731a332bdf2}\label{dhcpv6__client_8c_a4b7c727b671107febadf4731a332bdf2}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Get\+Default\+Settings@{dhcpv6\+Client\+Get\+Default\+Settings}}
\index{dhcpv6\+Client\+Get\+Default\+Settings@{dhcpv6\+Client\+Get\+Default\+Settings}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Get\+Default\+Settings()}{dhcpv6ClientGetDefaultSettings()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Get\+Default\+Settings (\begin{DoxyParamCaption}\item[{\hyperlink{structDhcpv6ClientSettings}{Dhcpv6\+Client\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



Initialize settings with default values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em settings} & Structure that contains D\+H\+C\+Pv6 client settings \\
\hline
\end{DoxyParams}


Definition at line 75 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
76 \{
77    \textcolor{comment}{//Use default interface}
78    settings->\hyperlink{structDhcpv6ClientSettings_ad74dca8474a1b0f8641dd2395ec910df}{interface} = \hyperlink{net_8c_a991aba7eae4de79f30c6889d95cc6870}{netGetDefaultInterface}();
79 
80    \textcolor{comment}{//Support for quick configuration using rapid commit}
81    settings->\hyperlink{structDhcpv6ClientSettings_af936a8d0ccae32e933868a92b3a58768}{rapidCommit} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
82    \textcolor{comment}{//Use the DNS servers provided by the DHCPv6 server}
83    settings->\hyperlink{structDhcpv6ClientSettings_a12c720ce782bb7124c146e8b5bf19cca}{manualDnsConfig} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
84    \textcolor{comment}{//DHCPv6 configuration timeout}
85    settings->\hyperlink{structDhcpv6ClientSettings_a440db6e60279995a67d8b3d522ca6f92}{timeout} = 0;
86    \textcolor{comment}{//DHCPv6 configuration timeout event}
87    settings->\hyperlink{structDhcpv6ClientSettings_a8ff0d3224eec61ef47ae19eccb8b0026}{timeoutEvent} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
88    \textcolor{comment}{//Link state change event}
89    settings->\hyperlink{structDhcpv6ClientSettings_a89a8117f9bc78b5beeddca6fc6711ac5}{linkChangeEvent} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
90    \textcolor{comment}{//FSM state change event}
91    settings->\hyperlink{structDhcpv6ClientSettings_aff55e81ba995a9eec72e25079de19280}{stateChangeEvent} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
92 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_aaa4bae0b8198fb1a32bfb99bb9577797}\label{dhcpv6__client_8c_aaa4bae0b8198fb1a32bfb99bb9577797}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Get\+State@{dhcpv6\+Client\+Get\+State}}
\index{dhcpv6\+Client\+Get\+State@{dhcpv6\+Client\+Get\+State}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Get\+State()}{dhcpv6ClientGetState()}}
{\footnotesize\ttfamily \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9}{Dhcpv6\+State} dhcpv6\+Client\+Get\+State (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Retrieve current state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Current D\+H\+C\+Pv6 client state 
\end{DoxyReturn}


Definition at line 315 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
316 \{
317    \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9}{Dhcpv6State} state;
318 
319    \textcolor{comment}{//Get exclusive access}
320    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
321    \textcolor{comment}{//Get current state}
322    state = context->state;
323    \textcolor{comment}{//Release exclusive access}
324    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
325 
326    \textcolor{comment}{//Return current state}
327    \textcolor{keywordflow}{return} state;
328 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_af04f903341a262d1adddbd8e878ed0e5}\label{dhcpv6__client_8c_af04f903341a262d1adddbd8e878ed0e5}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Init@{dhcpv6\+Client\+Init}}
\index{dhcpv6\+Client\+Init@{dhcpv6\+Client\+Init}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Init()}{dhcpv6ClientInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structDhcpv6ClientSettings}{Dhcpv6\+Client\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



D\+H\+C\+Pv6 client initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em settings} & D\+H\+C\+Pv6 client specific settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 102 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
103 \{
104    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
105    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
106 
107    \textcolor{comment}{//Debug message}
108    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Initializing DHCPv6 client...\(\backslash\)r\(\backslash\)n"});
109 
110    \textcolor{comment}{//Ensure the parameters are valid}
111    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || settings == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
112       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
113 
114    \textcolor{comment}{//A valid pointer to the interface being configured is required}
115    \textcolor{keywordflow}{if}(settings->\hyperlink{structDhcpv6ClientSettings_ad74dca8474a1b0f8641dd2395ec910df}{interface} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
116       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
117 
118    \textcolor{comment}{//Point to the underlying network interface}
119    \textcolor{keyword}{interface }= settings->interface;
120 
121    \textcolor{comment}{//Clear the DHCPv6 client context}
122    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6ClientContext}));
123    \textcolor{comment}{//Save user settings}
124    context->settings = *settings;
125 
126    \textcolor{comment}{//Generate client's DUID}
127    error = \hyperlink{dhcpv6__client_8c_aebf29ea2ff641b03c1736f386c63e268}{dhcpv6ClientGenerateDuid}(context);
128    \textcolor{comment}{//any error to report?}
129    \textcolor{keywordflow}{if}(error)
130       \textcolor{keywordflow}{return} error;
131 
132    \textcolor{comment}{//Generate client's fully qualified domain name}
133    error = \hyperlink{dhcpv6__client_8c_a8759e1d2cf5b1556bfa3d972e70e67e1}{dhcpv6ClientGenerateFqdn}(context);
134    \textcolor{comment}{//any error to report?}
135    \textcolor{keywordflow}{if}(error)
136       \textcolor{keywordflow}{return} error;
137 
138    \textcolor{comment}{//Callback function to be called when a DHCPv6 message is received}
139    error = \hyperlink{udp_8c_a38370e246c2908c710db4773a6423cee}{udpAttachRxCallback}(interface, \hyperlink{dhcpv6__common_8h_a6802d48c8c3b96baafb23641a82f43a0}{DHCPV6\_CLIENT\_PORT},
140       \hyperlink{dhcpv6__client_8c_acc731e16386b5bb776b7acbbe58ea2b8}{dhcpv6ClientProcessMessage}, context);
141    \textcolor{comment}{//Failed to register callback function?}
142    \textcolor{keywordflow}{if}(error)
143       \textcolor{keywordflow}{return} error;
144 
145    \textcolor{comment}{//DHCPv6 client is currently suspended}
146    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
147    \textcolor{comment}{//Initialize state machine}
148    context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
149 
150    \textcolor{comment}{//Attach the DHCPv6 client context to the network interface}
151    interface->dhcpv6ClientContext = context;
152 
153    \textcolor{comment}{//Successful initialization}
154    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
155 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a9061e440105f4e3ec613078afe8c7fd8}\label{dhcpv6__client_8c_a9061e440105f4e3ec613078afe8c7fd8}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Link\+Change\+Event@{dhcpv6\+Client\+Link\+Change\+Event}}
\index{dhcpv6\+Client\+Link\+Change\+Event@{dhcpv6\+Client\+Link\+Change\+Event}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Link\+Change\+Event()}{dhcpv6ClientLinkChangeEvent()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Link\+Change\+Event (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Callback function for link change event. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 436 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
437 \{
438    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
439 
440    \textcolor{comment}{//Make sure the DHCPv6 client has been properly instantiated}
441    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
442       \textcolor{keywordflow}{return};
443 
444    \textcolor{comment}{//Point to the underlying network interface}
445    \textcolor{keyword}{interface }= context->settings.interface;
446 
447    \textcolor{comment}{//Check whether the DHCPv6 client is running}
448    \textcolor{keywordflow}{if}(context->running)
449    \{
450       \textcolor{comment}{//Automatic DNS server configuration?}
451       \textcolor{keywordflow}{if}(!context->settings.manualDnsConfig)
452       \{
453          \textcolor{comment}{//Clear the list of DNS servers}
454          \hyperlink{ipv6__misc_8c_a4b3ce94edd9cad3fb3269e805a104b97}{ipv6FlushDnsServerList}(interface);
455       \}
456 
457       \textcolor{comment}{//Link-up event?}
458       \textcolor{keywordflow}{if}(interface->linkState)
459       \{
460          \textcolor{comment}{//A link-local address is formed by combining the well-known}
461          \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
462          \hyperlink{dhcpv6__client_8c_a0e2ede14d583dbc040aeecc01b262ec2}{dhcpv6ClientGenerateLinkLocalAddr}(context);
463       \}
464    \}
465 
466    \textcolor{comment}{//Check the state of the DHCPv6 client}
467    \textcolor{keywordflow}{switch}(context->state)
468    \{
469    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a73ca75f9f049c278a5f92b2def686884}{DHCPV6\_STATE\_INIT\_CONFIRM}:
470    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ac0f1f4819e62f2979a26a3654af7e2fc}{DHCPV6\_STATE\_CONFIRM}:
471    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a3b351a49eb0882948f1af86701439abd}{DHCPV6\_STATE\_DAD}:
472    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a49b5f6fffcbc5e9dadbe07ebe2d29535}{DHCPV6\_STATE\_BOUND}:
473    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a28a33f3446b846dc6ed8b728b23a5b70}{DHCPV6\_STATE\_RENEW}:
474    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ae19c57945990feb5d8fd89ae986481b6}{DHCPV6\_STATE\_REBIND}:
475       \textcolor{comment}{//The client already has a valid lease}
476       context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a73ca75f9f049c278a5f92b2def686884}{DHCPV6\_STATE\_INIT\_CONFIRM};
477       \textcolor{keywordflow}{break};
478    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a5c7dfad4462eb1ae1b609e1800f1dc93}{DHCPV6\_STATE\_RELEASE}:
479       \textcolor{comment}{//Stop DHCPv6 client}
480       context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
481       \textcolor{comment}{//Reinitialize state machine}
482       context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
483       \textcolor{keywordflow}{break};
484    \textcolor{keywordflow}{default}:
485       \textcolor{comment}{//Switch to the INIT state}
486       context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
487       \textcolor{keywordflow}{break};
488    \}
489 
490    \textcolor{comment}{//Any registered callback?}
491    \textcolor{keywordflow}{if}(context->settings.linkChangeEvent != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
492    \{
493       \textcolor{comment}{//Release exclusive access}
494       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
495       \textcolor{comment}{//Invoke user callback function}
496       context->settings.linkChangeEvent(context, interface, interface->linkState);
497       \textcolor{comment}{//Get exclusive access}
498       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
499    \}
500 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ac0a83fe8f0c247ae596f245e727c56cd}\label{dhcpv6__client_8c_ac0a83fe8f0c247ae596f245e727c56cd}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Parse\+Advertise@{dhcpv6\+Client\+Parse\+Advertise}}
\index{dhcpv6\+Client\+Parse\+Advertise@{dhcpv6\+Client\+Parse\+Advertise}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Parse\+Advertise()}{dhcpv6ClientParseAdvertise()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Parse\+Advertise (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6\+Message} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Advertise message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the incoming message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Length of the incoming message \\
\hline
\end{DoxyParams}


Definition at line 1497 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1499 \{
1500    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1501    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} serverPreference;
1502    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
1503    \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1}{Dhcpv6StatusCode} status;
1504    \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option} *option;
1505    \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option} *serverIdOption;
1506    \hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption} *iaNaOption;
1507 
1508    \textcolor{comment}{//Point to the underlying network interface}
1509    \textcolor{keyword}{interface }= context->settings.interface;
1510 
1511    \textcolor{comment}{//Make sure that the Advertise message is received in response to}
1512    \textcolor{comment}{//a Solicit message}
1513    \textcolor{keywordflow}{if}(context->state != \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a7bc292bbd95a3839b42102e4f5a57e59}{DHCPV6\_STATE\_SOLICIT})
1514       \textcolor{keywordflow}{return};
1515 
1516    \textcolor{comment}{//Discard any received packet that does not match the transaction ID}
1517    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->transactionId) != context->transactionId)
1518       \textcolor{keywordflow}{return};
1519 
1520    \textcolor{comment}{//Get the length of the Options field}
1521    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message});
1522 
1523    \textcolor{comment}{//Search for the Client Identifier option}
1524    option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a514e3d36a6eed2796997f995b847c4ff}{DHCPV6\_OPTION\_CLIENTID});
1525 
1526    \textcolor{comment}{//Discard any received packet that does not include a Client Identifier option}
1527    \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1528       \textcolor{keywordflow}{return};
1529    \textcolor{comment}{//Check the length of the option}
1530    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) != context->clientIdLength)
1531       \textcolor{keywordflow}{return};
1532    \textcolor{comment}{//Check whether the Client Identifier matches our identifier}
1533    \textcolor{keywordflow}{if}(memcmp(option->value, context->clientId, context->clientIdLength))
1534       \textcolor{keywordflow}{return};
1535 
1536    \textcolor{comment}{//Search for the Server Identifier option}
1537    serverIdOption = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574ae48652f6f207faa0fecc5ba909757672}{DHCPV6\_OPTION\_SERVERID});
1538 
1539    \textcolor{comment}{//Discard any received packet that does not include a Server Identifier option}
1540    \textcolor{keywordflow}{if}(serverIdOption == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1541       \textcolor{keywordflow}{return};
1542    \textcolor{comment}{//Check the length of the server DUID}
1543    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length) == 0)
1544       \textcolor{keywordflow}{return};
1545    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length) > \hyperlink{dhcpv6__common_8h_aa05ad3ad9a83e2486fbb7f86838fffb9}{DHCPV6\_MAX\_DUID\_SIZE})
1546       \textcolor{keywordflow}{return};
1547 
1548    \textcolor{comment}{//Get the status code returned by the server}
1549    status = \hyperlink{dhcpv6__common_8c_a5eafbb8cf026dbdf9df9dd882d4c1713}{dhcpv6GetStatusCode}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1550 
1551    \textcolor{comment}{//If the message contains a Status Code option indicating a failure,}
1552    \textcolor{comment}{//then the Advertise message is discarded by the client}
1553    \textcolor{keywordflow}{if}(status != \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1ae42228ed0a2112512e652d5b51af56fe}{DHCPV6\_STATUS\_SUCCESS})
1554       \textcolor{keywordflow}{return};
1555 
1556    \textcolor{comment}{//Search for the Preference option}
1557    option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a910da2d64590a3f4b7294336b6c2a5c2}{DHCPV6\_OPTION\_PREFERENCE});
1558 
1559    \textcolor{comment}{//Check whether the option has been found}
1560    \textcolor{keywordflow}{if}(option != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) == \textcolor{keyword}{sizeof}(
      \hyperlink{dhcpv6__common_8h_a07cb201db39cd61e5142b2da5a3bad80}{Dhcpv6PreferenceOption}))
1561    \{
1562       \textcolor{comment}{//Server server preference value}
1563       serverPreference = option->value[0];
1564    \}
1565    \textcolor{keywordflow}{else}
1566    \{
1567       \textcolor{comment}{//Any Advertise that does not include a Preference option}
1568       \textcolor{comment}{//is considered to have a preference value of 0}
1569       serverPreference = 0;
1570    \}
1571 
1572    \textcolor{comment}{//Select the Advertise message that offers the highest server preference value}
1573    \textcolor{keywordflow}{if}(serverPreference > context->serverPreference)
1574    \{
1575       \textcolor{comment}{//Save the length of the DUID}
1576       context->serverIdLength = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length);
1577       \textcolor{comment}{//Record the server DUID}
1578       memcpy(context->serverId, serverIdOption->value, context->serverIdLength);
1579 
1580       \textcolor{comment}{//Flush the list of IPv6 addresses from the client's IA}
1581       \hyperlink{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}{dhcpv6ClientFlushAddrList}(context);
1582    \}
1583 
1584    \textcolor{comment}{//Point to the first option}
1585    i = 0;
1586 
1587    \textcolor{comment}{//Loop through DHCPv6 options}
1588    \textcolor{keywordflow}{while}(i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
1589    \{
1590       \textcolor{comment}{//Search for an IA\_NA option}
1591       option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + i, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a03bdde9e8ae8a85d4936efb2f9fbb956}{DHCPV6\_OPTION\_IA\_NA});
1592 
1593       \textcolor{comment}{//Unable to find the specified option?}
1594       \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1595          \textcolor{keywordflow}{break};
1596 
1597       \textcolor{comment}{//Make sure the IA\_NA option is valid}
1598       \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) >= \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption}))
1599       \{
1600          \textcolor{comment}{//Get the parameters associated with the IA\_NA}
1601          iaNaOption = (\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption} *) option->value;
1602 
1603          \textcolor{comment}{//Check the IA identifier}
1604          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->iaId) == interface->id)
1605          \{
1606             \textcolor{comment}{//The client examines the status code in each IA individually}
1607             status = \hyperlink{dhcpv6__common_8c_a5eafbb8cf026dbdf9df9dd882d4c1713}{dhcpv6GetStatusCode}(iaNaOption->options,
1608                \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) - \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption}));
1609 
1610             \textcolor{comment}{//The client must ignore any Advertise message that includes a Status}
1611             \textcolor{comment}{//Code option containing the value NoAddrsAvail}
1612             \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1afa3a49bf50a5777dcad48e8a7f84b576}{DHCPV6\_STATUS\_NO\_ADDRS\_AVAILABLE})
1613                \textcolor{keywordflow}{return};
1614          \}
1615 
1616          \textcolor{comment}{//Check the server preference value}
1617          \textcolor{keywordflow}{if}(serverPreference > context->serverPreference)
1618          \{
1619             \textcolor{comment}{//Parse the contents of the IA\_NA option}
1620             \hyperlink{dhcpv6__client_8c_ad68a947419af81c6e478eaa92ae7680e}{dhcpv6ClientParseIaNaOption}(context, option);
1621          \}
1622       \}
1623 
1624       \textcolor{comment}{//Jump to the next option}
1625       i += \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length);
1626    \}
1627 
1628    \textcolor{comment}{//Record the highest server preference value}
1629    \textcolor{keywordflow}{if}(serverPreference > context->serverPreference)
1630       context->serverPreference = serverPreference;
1631 
1632    \textcolor{comment}{//If the client receives an Advertise message that includes a}
1633    \textcolor{comment}{//Preference option with a preference value of 255, the client}
1634    \textcolor{comment}{//immediately completes the message exchange}
1635    \textcolor{keywordflow}{if}(serverPreference == \hyperlink{dhcpv6__common_8h_af355c5bc4f57ed0a72c0bf1d74182b7a}{DHCPV6\_MAX\_SERVER\_PREFERENCE})
1636    \{
1637       \textcolor{comment}{//Continue configuration procedure}
1638       \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST}, 0);
1639    \}
1640    \textcolor{comment}{//The message exchange is not terminated before the first RT has elapsed}
1641    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->retransmitCount > 1)
1642    \{
1643       \textcolor{comment}{//Continue configuration procedure}
1644       \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST}, 0);
1645    \}
1646 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ac9bbd88ba30bd504ed516714177e2b1d}\label{dhcpv6__client_8c_ac9bbd88ba30bd504ed516714177e2b1d}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Parse\+Ia\+Addr\+Option@{dhcpv6\+Client\+Parse\+Ia\+Addr\+Option}}
\index{dhcpv6\+Client\+Parse\+Ia\+Addr\+Option@{dhcpv6\+Client\+Parse\+Ia\+Addr\+Option}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Parse\+Ia\+Addr\+Option()}{dhcpv6ClientParseIaAddrOption()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Parse\+Ia\+Addr\+Option (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$}]{option }\end{DoxyParamCaption})}



Parse IA Address option. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em option} & Pointer to the IA Address option to parse \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 2094 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2096 \{
2097    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
2098    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dhcpv6__common_8h_a6bcd95080db3b3f2265498723b93d7b2}{validLifetime};
2099    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dhcpv6__common_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferredLifetime};
2100    \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1}{Dhcpv6StatusCode} status;
2101    \hyperlink{dhcpv6__common_8h_a36456b5aa40da69f977e9153d2557714}{Dhcpv6IaAddrOption} *iaAddrOption;
2102 
2103    \textcolor{comment}{//Make sure the IA Address option is valid}
2104    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) < \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a36456b5aa40da69f977e9153d2557714}{Dhcpv6IaAddrOption}))
2105       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
2106 
2107    \textcolor{comment}{//Point to the contents of the IA Address option}
2108    iaAddrOption = (\hyperlink{dhcpv6__common_8h_a36456b5aa40da69f977e9153d2557714}{Dhcpv6IaAddrOption} *) option->value;
2109    \textcolor{comment}{//Compute the length of IA Address Options field}
2110    length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) - \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a36456b5aa40da69f977e9153d2557714}{Dhcpv6IaAddrOption});
2111 
2112    \textcolor{comment}{//Convert lifetimes to host byte order}
2113    validLifetime = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaAddrOption->validLifetime);
2114    preferredLifetime = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaAddrOption->preferredLifetime);
2115 
2116    \textcolor{comment}{//A client discards any addresses for which the preferred lifetime}
2117    \textcolor{comment}{//is greater than the valid lifetime}
2118    \textcolor{keywordflow}{if}(preferredLifetime > validLifetime)
2119       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2120 
2121    \textcolor{comment}{//The client examines the status code in each IA Address}
2122    status = \hyperlink{dhcpv6__common_8c_a5eafbb8cf026dbdf9df9dd882d4c1713}{dhcpv6GetStatusCode}(iaAddrOption->options, length);
2123 
2124    \textcolor{comment}{//Any error to report?}
2125    \textcolor{keywordflow}{if}(status != \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1ae42228ed0a2112512e652d5b51af56fe}{DHCPV6\_STATUS\_SUCCESS})
2126       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
2127 
2128    \textcolor{comment}{//Check the value of the Valid Lifetime}
2129    \textcolor{keywordflow}{if}(iaAddrOption->validLifetime > 0)
2130    \{
2131       \textcolor{comment}{//Add any new addresses in the IA option to the IA as recorded}
2132       \textcolor{comment}{//by the client}
2133       \hyperlink{dhcpv6__client_8c_a38390e93bf1378cd3b58f09e58912de3}{dhcpv6ClientAddAddr}(context, &iaAddrOption->address,
2134          validLifetime, preferredLifetime);
2135    \}
2136    \textcolor{keywordflow}{else}
2137    \{
2138       \textcolor{comment}{//Discard any addresses from the IA, as recorded by the client,}
2139       \textcolor{comment}{//that have a valid lifetime of 0 in the IA Address option}
2140       \hyperlink{dhcpv6__client_8c_a960a1cdb90a7bd9abbf9d2a5bd70fa8d}{dhcpv6ClientRemoveAddr}(context, &iaAddrOption->address);
2141    \}
2142 
2143    \textcolor{comment}{//Successful processing}
2144    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2145 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ad68a947419af81c6e478eaa92ae7680e}\label{dhcpv6__client_8c_ad68a947419af81c6e478eaa92ae7680e}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Parse\+Ia\+Na\+Option@{dhcpv6\+Client\+Parse\+Ia\+Na\+Option}}
\index{dhcpv6\+Client\+Parse\+Ia\+Na\+Option@{dhcpv6\+Client\+Parse\+Ia\+Na\+Option}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Parse\+Ia\+Na\+Option()}{dhcpv6ClientParseIaNaOption()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Parse\+Ia\+Na\+Option (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6\+Option} $\ast$}]{option }\end{DoxyParamCaption})}



Parse I\+A\+\_\+\+NA option. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em option} & Pointer to the I\+A\+\_\+\+NA option to parse \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1981 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1983 \{
1984    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1985    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1986    \textcolor{keywordtype}{size\_t} i;
1987    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1988    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
1989    \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1}{Dhcpv6StatusCode} status;
1990    \hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption} *iaNaOption;
1991 
1992    \textcolor{comment}{//Point to the underlying network interface}
1993    \textcolor{keyword}{interface }= context->settings.interface;
1994 
1995    \textcolor{comment}{//Number of addresses found in the IA\_NA option}
1996    n = 0;
1997 
1998    \textcolor{comment}{//Make sure the IA\_NA option is valid}
1999    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) < \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption}))
2000       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
2001 
2002    \textcolor{comment}{//Get the parameters associated with the IA\_NA}
2003    iaNaOption = (\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption} *) option->value;
2004    \textcolor{comment}{//Compute the length of IA\_NA Options field}
2005    length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) - \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption});
2006 
2007    \textcolor{comment}{//Check the IA identifier}
2008    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->iaId) != interface->id)
2009       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2bc2298123e24e3d82592b5c68c20612}{ERROR\_WRONG\_IDENTIFIER};
2010 
2011    \textcolor{comment}{//If a client receives an IA\_NA with T1 greater than T2, and both T1}
2012    \textcolor{comment}{//and T2 are greater than 0, the client discards the IA\_NA option and}
2013    \textcolor{comment}{//processes the remainder of the message as though the server had not}
2014    \textcolor{comment}{//included the invalid IA\_NA option}
2015    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->t1) > \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->t2) && \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->t2) > 0)
2016       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
2017 
2018    \textcolor{comment}{//The client examines the status code in each IA individually}
2019    status = \hyperlink{dhcpv6__common_8c_a5eafbb8cf026dbdf9df9dd882d4c1713}{dhcpv6GetStatusCode}(iaNaOption->options, length);
2020 
2021    \textcolor{comment}{//Check error code}
2022    \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1afa3a49bf50a5777dcad48e8a7f84b576}{DHCPV6\_STATUS\_NO\_ADDRS\_AVAILABLE})
2023    \{
2024       \textcolor{comment}{//The client has received no usable address in the IA}
2025       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab341b466f058a1fcda38ae5afe2d23c2}{ERROR\_NO\_ADDRESS};
2026    \}
2027    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1a063c73de39e3f9e416ba4436f0b8ed86}{DHCPV6\_STATUS\_NO\_BINDING})
2028    \{
2029       \textcolor{comment}{//Client record (binding) unavailable}
2030       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6242320f68a052402e19292c494c4355}{ERROR\_NO\_BINDING};
2031    \}
2032    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1a1da269e6ebd8b959114717b0b1ea2b9c}{DHCPV6\_STATUS\_NOT\_ON\_LINK})
2033    \{
2034       \textcolor{comment}{//The prefix for the address is not appropriate for the link to which the}
2035       \textcolor{comment}{//client is attached}
2036       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca82e6179d1843086162e4b3171821f0fb}{ERROR\_NOT\_ON\_LINK};
2037    \}
2038    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(status != \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1ae42228ed0a2112512e652d5b51af56fe}{DHCPV6\_STATUS\_SUCCESS})
2039    \{
2040       \textcolor{comment}{//Failure, reason unspecified}
2041       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
2042    \}
2043 
2044    \textcolor{comment}{//Record T1 and T2 times}
2045    context->ia.t1 = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->t1);
2046    context->ia.t2 = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(iaNaOption->t2);
2047 
2048    \textcolor{comment}{//Point to the first option}
2049    i = 0;
2050 
2051    \textcolor{comment}{//Loop through IA\_NA options}
2052    \textcolor{keywordflow}{while}(i < length)
2053    \{
2054       \textcolor{comment}{//Search for an IA Address option}
2055       option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(iaNaOption->options + i, length - i, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574af02fe93475cf23de1d0dcaf371c15af2}{DHCPV6\_OPTION\_IAADDR});
2056 
2057       \textcolor{comment}{//Unable to find the specified option?}
2058       \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2059          \textcolor{keywordflow}{break};
2060 
2061       \textcolor{comment}{//Parse the contents of the IA Address option}
2062       error = \hyperlink{dhcpv6__client_8c_ac9bbd88ba30bd504ed516714177e2b1d}{dhcpv6ClientParseIaAddrOption}(context, option);
2063 
2064       \textcolor{comment}{//Check status code}
2065       \textcolor{keywordflow}{if}(!error)
2066       \{
2067          \textcolor{comment}{//Increment the number of addresses found in the IA\_NA option}
2068          n++;
2069       \}
2070 
2071       \textcolor{comment}{//Jump to the next option}
2072       i += \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length);
2073    \}
2074 
2075    \textcolor{comment}{//No usable addresses in the IA\_NA option?}
2076    \textcolor{keywordflow}{if}(n == 0)
2077    \{
2078       \textcolor{comment}{//Report an error}
2079       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab341b466f058a1fcda38ae5afe2d23c2}{ERROR\_NO\_ADDRESS};
2080    \}
2081 
2082    \textcolor{comment}{//Successful processing}
2083    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2084 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ae47455838efddde0bce836e13249c2d0}\label{dhcpv6__client_8c_ae47455838efddde0bce836e13249c2d0}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Parse\+Reply@{dhcpv6\+Client\+Parse\+Reply}}
\index{dhcpv6\+Client\+Parse\+Reply@{dhcpv6\+Client\+Parse\+Reply}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Parse\+Reply()}{dhcpv6ClientParseReply()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Parse\+Reply (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6\+Message} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Reply message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the incoming message to parse \\
\hline
\mbox{\tt in}  & {\em length} & Length of the incoming message \\
\hline
\end{DoxyParams}


Definition at line 1656 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1658 \{
1659    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1660    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1661    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1662    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1663    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} iaNaOptionFound;
1664    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} minPreferredLifetime;
1665    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
1666    \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1}{Dhcpv6StatusCode} status;
1667    \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option} *option;
1668    \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option} *serverIdOption;
1669    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
1670 
1671    \textcolor{comment}{//Point to the underlying network interface}
1672    \textcolor{keyword}{interface }= context->settings.interface;
1673 
1674    \textcolor{comment}{//Discard any received packet that does not match the transaction ID}
1675    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->transactionId) != context->transactionId)
1676       \textcolor{keywordflow}{return};
1677 
1678    \textcolor{comment}{//Get the length of the Options field}
1679    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message});
1680 
1681    \textcolor{comment}{//Search for the Client Identifier option}
1682    option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a514e3d36a6eed2796997f995b847c4ff}{DHCPV6\_OPTION\_CLIENTID});
1683 
1684    \textcolor{comment}{//Discard any received packet that does not include a Client Identifier option}
1685    \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1686       \textcolor{keywordflow}{return};
1687    \textcolor{comment}{//Check the length of the option}
1688    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) != context->clientIdLength)
1689       \textcolor{keywordflow}{return};
1690    \textcolor{comment}{//Check whether the Client Identifier matches our identifier}
1691    \textcolor{keywordflow}{if}(memcmp(option->value, context->clientId, context->clientIdLength))
1692       \textcolor{keywordflow}{return};
1693 
1694    \textcolor{comment}{//Search for the Server Identifier option}
1695    serverIdOption = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574ae48652f6f207faa0fecc5ba909757672}{DHCPV6\_OPTION\_SERVERID});
1696 
1697    \textcolor{comment}{//Discard any received packet that does not include a Server Identifier option}
1698    \textcolor{keywordflow}{if}(serverIdOption == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1699       \textcolor{keywordflow}{return};
1700    \textcolor{comment}{//Check the length of the server DUID}
1701    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length) == 0)
1702       \textcolor{keywordflow}{return};
1703    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length) > \hyperlink{dhcpv6__common_8h_aa05ad3ad9a83e2486fbb7f86838fffb9}{DHCPV6\_MAX\_DUID\_SIZE})
1704       \textcolor{keywordflow}{return};
1705 
1706    \textcolor{comment}{//Get the status code returned by the server}
1707    status = \hyperlink{dhcpv6__common_8c_a5eafbb8cf026dbdf9df9dd882d4c1713}{dhcpv6GetStatusCode}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
1708 
1709    \textcolor{comment}{//Check current state}
1710    \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a7bc292bbd95a3839b42102e4f5a57e59}{DHCPV6\_STATE\_SOLICIT})
1711    \{
1712       \textcolor{comment}{//A Reply message is not acceptable when rapid commit is disallowed}
1713       \textcolor{keywordflow}{if}(!context->settings.rapidCommit)
1714          \textcolor{keywordflow}{return};
1715 
1716       \textcolor{comment}{//Search for the Rapid Commit option}
1717       option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a8ce7598c8440ec545924bc13b5619944}{DHCPV6\_OPTION\_RAPID\_COMMIT});
1718 
1719       \textcolor{comment}{//The client discards any message that does not include a Rapid Commit option}
1720       \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length) != 0)
1721          \textcolor{keywordflow}{return};
1722    \}
1723    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST})
1724    \{
1725       \textcolor{comment}{//The client must discard the Reply message if the contents of the}
1726       \textcolor{comment}{//Server Identifier option do not match the server’s DUID}
1727       \textcolor{keywordflow}{if}(!\hyperlink{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}{dhcpv6ClientCheckServerId}(context, serverIdOption))
1728          \textcolor{keywordflow}{return};
1729    \}
1730    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ac0f1f4819e62f2979a26a3654af7e2fc}{DHCPV6\_STATE\_CONFIRM})
1731    \{
1732       \textcolor{comment}{//When the client receives a NotOnLink status from the server in response}
1733       \textcolor{comment}{//to a Confirm message, the client performs DHCP server solicitation}
1734       \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1a1da269e6ebd8b959114717b0b1ea2b9c}{DHCPV6\_STATUS\_NOT\_ON\_LINK})
1735       \{
1736          \textcolor{comment}{//Restart the DHCP server discovery process}
1737          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1738 
1739          \textcolor{comment}{//Exit immediately}
1740          \textcolor{keywordflow}{return};
1741       \}
1742    \}
1743    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a28a33f3446b846dc6ed8b728b23a5b70}{DHCPV6\_STATE\_RENEW})
1744    \{
1745       \textcolor{comment}{//The client must discard the Reply message if the contents of the}
1746       \textcolor{comment}{//Server Identifier option do not match the server’s DUID}
1747       \textcolor{keywordflow}{if}(!\hyperlink{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}{dhcpv6ClientCheckServerId}(context, serverIdOption))
1748          \textcolor{keywordflow}{return};
1749    \}
1750    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ae19c57945990feb5d8fd89ae986481b6}{DHCPV6\_STATE\_REBIND})
1751    \{
1752       \textcolor{comment}{//Do not check the server's DUID when the Reply message is}
1753       \textcolor{comment}{//received in response to a Rebind message}
1754    \}
1755    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a5c7dfad4462eb1ae1b609e1800f1dc93}{DHCPV6\_STATE\_RELEASE})
1756    \{
1757       \textcolor{comment}{//The client must discard the Reply message if the contents of the}
1758       \textcolor{comment}{//Server Identifier option do not match the server’s DUID}
1759       \textcolor{keywordflow}{if}(!\hyperlink{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}{dhcpv6ClientCheckServerId}(context, serverIdOption))
1760          \textcolor{keywordflow}{return};
1761 
1762       \textcolor{comment}{//When the client receives a valid Reply message in response to a}
1763       \textcolor{comment}{//Release message, the client considers the Release event completed,}
1764       \textcolor{comment}{//regardless of the Status Code option(s) returned by the server}
1765       context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1766 
1767       \textcolor{comment}{//Reinitialize state machine}
1768       \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1769 
1770       \textcolor{comment}{//Exit immediately}
1771       \textcolor{keywordflow}{return};
1772    \}
1773    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a198862c17ecac221d19b82f793b5fff8}{DHCPV6\_STATE\_DECLINE})
1774    \{
1775       \textcolor{comment}{//The client must discard the Reply message if the contents of the}
1776       \textcolor{comment}{//Server Identifier option do not match the server’s DUID}
1777       \textcolor{keywordflow}{if}(!\hyperlink{dhcpv6__client_8c_ad527db35497d30d495444948bfd93ca7}{dhcpv6ClientCheckServerId}(context, serverIdOption))
1778          \textcolor{keywordflow}{return};
1779 
1780       \textcolor{comment}{//When the client receives a valid Reply message in response to a}
1781       \textcolor{comment}{//Decline message, the client considers the Decline event completed,}
1782       \textcolor{comment}{//regardless of the Status Code option returned by the server}
1783       \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1784 
1785       \textcolor{comment}{//Exit immediately}
1786       \textcolor{keywordflow}{return};
1787    \}
1788    \textcolor{keywordflow}{else}
1789    \{
1790       \textcolor{comment}{//Silently discard the Reply message}
1791       \textcolor{keywordflow}{return};
1792    \}
1793 
1794    \textcolor{comment}{//Check status code}
1795    \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1ae0874bd22dd4b258942c333ed5a28361}{DHCPV6\_STATUS\_USE\_MULTICAST})
1796    \{
1797       \textcolor{comment}{//When the client receives a Reply message with a Status Code option}
1798       \textcolor{comment}{//with the value UseMulticast, the client records the receipt of the}
1799       \textcolor{comment}{//message and sends subsequent messages to the server through the}
1800       \textcolor{comment}{//interface on which the message was received using multicast}
1801       \textcolor{keywordflow}{return};
1802    \}
1803    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(status == \hyperlink{dhcpv6__common_8h_ae3d249bb8993edf1fb41f1ac349078f1a92ef79492ddf1f5f2f56eb0360bd6baf}{DHCPV6\_STATUS\_UNSPEC\_FAILURE})
1804    \{
1805       \textcolor{comment}{//If the client receives a Reply message with a Status Code containing}
1806       \textcolor{comment}{//UnspecFail, the server is indicating that it was unable to process}
1807       \textcolor{comment}{//the message due to an unspecified failure condition}
1808       \textcolor{keywordflow}{return};
1809    \}
1810 
1811    \textcolor{comment}{//This flag will be set if a valid IA\_NA option is found}
1812    iaNaOptionFound = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1813    \textcolor{comment}{//Point to the first option}
1814    i = 0;
1815 
1816    \textcolor{comment}{//Loop through DHCPv6 options}
1817    \textcolor{keywordflow}{while}(i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
1818    \{
1819       \textcolor{comment}{//Search for an IA\_NA option}
1820       option = \hyperlink{dhcpv6__common_8c_a6678e0579ff5fe27d71f2ca45f35b54b}{dhcpv6GetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + i, 
      \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a03bdde9e8ae8a85d4936efb2f9fbb956}{DHCPV6\_OPTION\_IA\_NA});
1821 
1822       \textcolor{comment}{//Unable to find the specified option?}
1823       \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1824          \textcolor{keywordflow}{break};
1825 
1826       \textcolor{comment}{//Parse the contents of the IA\_NA option}
1827       error = \hyperlink{dhcpv6__client_8c_ad68a947419af81c6e478eaa92ae7680e}{dhcpv6ClientParseIaNaOption}(context, option);
1828 
1829       \textcolor{comment}{//Check error code}
1830       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
1831       \{
1832          \textcolor{comment}{//A valid IA\_NA option has been found}
1833          iaNaOptionFound = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1834       \}
1835       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca82e6179d1843086162e4b3171821f0fb}{ERROR\_NOT\_ON\_LINK})
1836       \{
1837          \textcolor{comment}{//When the client receives a NotOnLink status from the server}
1838          \textcolor{comment}{//in response to a Request, the client can either re-issue the}
1839          \textcolor{comment}{//Request without specifying any addresses or restart the DHCP}
1840          \textcolor{comment}{//server discovery process}
1841          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1842 
1843          \textcolor{comment}{//Exit immediately}
1844          \textcolor{keywordflow}{return};
1845       \}
1846       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6242320f68a052402e19292c494c4355}{ERROR\_NO\_BINDING})
1847       \{
1848          \textcolor{comment}{//When the client receives a Reply message in response to a Renew}
1849          \textcolor{comment}{//or Rebind message, the client sends a Request message if any of}
1850          \textcolor{comment}{//the IAs in the Reply message contains the NoBinding status code}
1851          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST}, 0);
1852 
1853          \textcolor{comment}{//Exit immediately}
1854          \textcolor{keywordflow}{return};
1855       \}
1856       \textcolor{keywordflow}{else}
1857       \{
1858          \textcolor{comment}{//If an invalid option is received, the client discards}
1859          \textcolor{comment}{//the option and process the rest of the message...}
1860       \}
1861 
1862       \textcolor{comment}{//Jump to the next option}
1863       i += \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(option->length);
1864    \}
1865 
1866    \textcolor{comment}{//No usable addresses in any of the IAs?}
1867    \textcolor{keywordflow}{if}(!iaNaOptionFound)
1868    \{
1869       \textcolor{comment}{//Check whether the client receives a Reply message in response}
1870       \textcolor{comment}{//to a Renew or Rebind message}
1871       \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a28a33f3446b846dc6ed8b728b23a5b70}{DHCPV6\_STATE\_RENEW} ||
1872          context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ae19c57945990feb5d8fd89ae986481b6}{DHCPV6\_STATE\_REBIND})
1873       \{
1874          \textcolor{comment}{//The client sends a Renew/Rebind if the IA is not in the Reply message}
1875       \}
1876       \textcolor{keywordflow}{else}
1877       \{
1878          \textcolor{comment}{//If the client finds no usable addresses in any of the IAs, it may try}
1879          \textcolor{comment}{//another server (perhaps restarting the DHCP server discovery process)}
1880          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1881       \}
1882 
1883       \textcolor{comment}{//Exit immediately}
1884       \textcolor{keywordflow}{return};
1885    \}
1886 
1887    \textcolor{comment}{//Total number of valid IPv6 in the IA}
1888    n = 0;
1889    \textcolor{comment}{//Number of new IPv6 addresses in the IA}
1890    k = 0;
1891    \textcolor{comment}{//Minimum preferred lifetime observed in the IA}
1892    minPreferredLifetime = 0;
1893 
1894    \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
1895    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
1896    \{
1897       \textcolor{comment}{//Point to the current entry}
1898       entry = &context->ia.addrList[i];
1899 
1900       \textcolor{comment}{//Valid IPv6 address?}
1901       \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
1902       \{
1903          \textcolor{comment}{//Total number of valid IPv6 in the IA}
1904          n++;
1905 
1906          \textcolor{comment}{//Save the minimum preferred lifetime that has been observed so far}
1907          \textcolor{keywordflow}{if}(minPreferredLifetime < entry->\hyperlink{dhcpv6__common_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferredLifetime})
1908             minPreferredLifetime = entry->\hyperlink{structDhcpv6ClientAddrEntry_a24e1399fe28c7e13c134de1e2953e051}{preferredLifetime};
1909 
1910          \textcolor{comment}{//Update lifetimes of the current IPv6 address}
1911          \hyperlink{ipv6__misc_8c_a09293900ef392400821733fd3ef1a66b}{ipv6AddAddr}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr}, entry->
      \hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime},
1912             entry->\hyperlink{structDhcpv6ClientAddrEntry_a24e1399fe28c7e13c134de1e2953e051}{preferredLifetime});
1913 
1914          \textcolor{comment}{//New IPv6 address added?}
1915          \textcolor{keywordflow}{if}(\hyperlink{ipv6__misc_8c_ac635994871aa4238959d1c9488c5c486}{ipv6GetAddrState}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr}) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE})
1916             k++;
1917       \}
1918    \}
1919 
1920    \textcolor{comment}{//Make sure that the IA contains at least one IPv6 address}
1921    \textcolor{keywordflow}{if}(n > 0)
1922    \{
1923       \textcolor{comment}{//Save the length of the DUID}
1924       context->serverIdLength = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverIdOption->length);
1925       \textcolor{comment}{//Record the server DUID}
1926       memcpy(context->serverId, serverIdOption->value, context->serverIdLength);
1927 
1928       \textcolor{comment}{//Save the time a which the lease was obtained}
1929       context->leaseStartTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1930 
1931       \textcolor{comment}{//Check the value of T1}
1932       \textcolor{keywordflow}{if}(context->ia.t1 == 0)
1933       \{
1934          \textcolor{comment}{//If T1 is set to 0 by the server, the client may send}
1935          \textcolor{comment}{//a Renew message at the client's discretion}
1936          \textcolor{keywordflow}{if}(minPreferredLifetime == \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME})
1937             context->ia.t1 = \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME};
1938          \textcolor{keywordflow}{else}
1939             context->ia.t1 = minPreferredLifetime / 2;
1940       \}
1941 
1942       \textcolor{comment}{//Check the value of T2}
1943       \textcolor{keywordflow}{if}(context->ia.t2 == 0)
1944       \{
1945          \textcolor{comment}{//If T2 is set to 0 by the server, the client may send}
1946          \textcolor{comment}{//a Rebind message at the client's discretion}
1947          \textcolor{keywordflow}{if}(context->ia.t1 == \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME})
1948             context->ia.t2 = \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME};
1949          \textcolor{keywordflow}{else}
1950             context->ia.t2 = context->ia.t1 + context->ia.t1 / 2;
1951       \}
1952 
1953       \textcolor{comment}{//Any addresses added in the IA?}
1954       \textcolor{keywordflow}{if}(k > 0)
1955       \{
1956          \textcolor{comment}{//Perform Duplicate Address Detection for the new IPv6 addresses}
1957          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a3b351a49eb0882948f1af86701439abd}{DHCPV6\_STATE\_DAD}, 0);
1958       \}
1959       \textcolor{keywordflow}{else}
1960       \{
1961          \textcolor{comment}{//Switch to the BOUND state}
1962          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a49b5f6fffcbc5e9dadbe07ebe2d29535}{DHCPV6\_STATE\_BOUND}, 0);
1963       \}
1964    \}
1965    \textcolor{keywordflow}{else}
1966    \{
1967       \textcolor{comment}{//If the client finds no usable addresses in any of the IAs, it may try}
1968       \textcolor{comment}{//another server (perhaps restarting the DHCP server discovery process)}
1969       \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1970    \}
1971 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_acc731e16386b5bb776b7acbbe58ea2b8}\label{dhcpv6__client_8c_acc731e16386b5bb776b7acbbe58ea2b8}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Process\+Message@{dhcpv6\+Client\+Process\+Message}}
\index{dhcpv6\+Client\+Process\+Message@{dhcpv6\+Client\+Process\+Message}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Process\+Message()}{dhcpv6ClientProcessMessage()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Process\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$}]{pseudo\+Header,  }\item[{const \hyperlink{udp_8h_a6877bae1da8326482f5e311875e52bce}{Udp\+Header} $\ast$}]{udp\+Header,  }\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{offset,  }\item[{void $\ast$}]{param }\end{DoxyParamCaption})}



Process incoming D\+H\+C\+Pv6 message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em pseudo\+Header} & U\+DP pseudo header \\
\hline
\mbox{\tt in}  & {\em udp\+Header} & U\+DP header \\
\hline
\mbox{\tt in}  & {\em buffer} & Multi-\/part buffer containing the incoming D\+H\+C\+Pv6 message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to the first byte of the D\+H\+C\+Pv6 message \\
\hline
\mbox{\tt in}  & {\em param} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 1441 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1444 \{
1445    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1446    \hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6ClientContext} *context;
1447    \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
1448 
1449    \textcolor{comment}{//Point to the DHCPv6 client context}
1450    context = (\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6ClientContext} *) param;
1451 
1452    \textcolor{comment}{//Retrieve the length of the DHCPv6 message}
1453    length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(buffer) - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1454 
1455    \textcolor{comment}{//Make sure the DHCPv6 message is valid}
1456    \textcolor{keywordflow}{if}(length < \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message}))
1457       \textcolor{keywordflow}{return};
1458 
1459    \textcolor{comment}{//Point to the beginning of the DHCPv6 message}
1460    message = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
1461    \textcolor{comment}{//Sanity check}
1462    \textcolor{keywordflow}{if}(message == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1463       \textcolor{keywordflow}{return};
1464 
1465    \textcolor{comment}{//Debug message}
1466    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n%s: DHCPv6 message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1467       \hyperlink{date__time_8c_ae15b3e664208ca7e4d6983921865cd74}{formatSystemTime}(\hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}(), \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}), length);
1468 
1469    \textcolor{comment}{//Dump the contents of the message for debugging purpose}
1470    \hyperlink{dhcpv6__debug_8c_a36ce435509b18e157c961e1e82ae0e88}{dhcpv6DumpMessage}(message, length);
1471 
1472    \textcolor{comment}{//Check message type}
1473    \textcolor{keywordflow}{switch}(message->msgType)
1474    \{
1475    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf7ed9c8857600d18f63bec24e3df6395}{DHCPV6\_MSG\_TYPE\_ADVERTISE}:
1476       \textcolor{comment}{//Parse Advertise message}
1477       \hyperlink{dhcpv6__client_8c_ac0a83fe8f0c247ae596f245e727c56cd}{dhcpv6ClientParseAdvertise}(context, message, length);
1478       \textcolor{keywordflow}{break};
1479    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cae62b0f8ac95422e019179722183709b4}{DHCPV6\_MSG\_TYPE\_REPLY}:
1480       \textcolor{comment}{//Parse Reply message}
1481       \hyperlink{dhcpv6__client_8c_ae47455838efddde0bce836e13249c2d0}{dhcpv6ClientParseReply}(context, message, length);
1482       \textcolor{keywordflow}{break};
1483    \textcolor{keywordflow}{default}:
1484       \textcolor{comment}{//Silently drop incoming message}
1485       \textcolor{keywordflow}{break};
1486    \}
1487 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a0d922f9224e11d928ee215334f7f8a99}\label{dhcpv6__client_8c_a0d922f9224e11d928ee215334f7f8a99}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Release@{dhcpv6\+Client\+Release}}
\index{dhcpv6\+Client\+Release@{dhcpv6\+Client\+Release}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Release()}{dhcpv6ClientRelease()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Release (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Release D\+H\+C\+Pv6 lease. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 249 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
250 \{
251    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
252    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
253    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
254 
255    \textcolor{comment}{//Check parameter}
256    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
257       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
258 
259    \textcolor{comment}{//Debug message}
260    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Releasing DHCPv6 lease...\(\backslash\)r\(\backslash\)n"});
261 
262    \textcolor{comment}{//Get exclusive access}
263    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
264 
265    \textcolor{comment}{//Point to the underlying network interface}
266    \textcolor{keyword}{interface }= context->settings.interface;
267 
268    \textcolor{comment}{//Check whether the DHCPv6 client is running}
269    \textcolor{keywordflow}{if}(context->running)
270    \{
271       \textcolor{comment}{//BOUND state?}
272       \textcolor{keywordflow}{if}(context->state == \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a49b5f6fffcbc5e9dadbe07ebe2d29535}{DHCPV6\_STATE\_BOUND})
273       \{
274          \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
275          \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
276          \{
277             \textcolor{comment}{//Point to the current entry}
278             entry = &context->ia.addrList[i];
279 
280             \textcolor{comment}{//Valid IPv6 address?}
281             \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
282             \{
283                \textcolor{comment}{//The client must stop using the addresses being released as soon}
284                \textcolor{comment}{//as the client begins the Release message exchange process}
285                \hyperlink{ipv6__misc_8c_aa72b374b0dba9090d90f799776797452}{ipv6RemoveAddr}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr});
286             \}
287          \}
288 
289          \textcolor{comment}{//Switch to the RELEASE state}
290          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a5c7dfad4462eb1ae1b609e1800f1dc93}{DHCPV6\_STATE\_RELEASE}, 0);
291       \}
292       \textcolor{keywordflow}{else}
293       \{
294          \textcolor{comment}{//Stop DHCPv6 client}
295          context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
296          \textcolor{comment}{//Reinitialize state machine}
297          context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
298       \}
299    \}
300 
301    \textcolor{comment}{//Release exclusive access}
302    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
303 
304    \textcolor{comment}{//Successful processing}
305    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
306 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a960a1cdb90a7bd9abbf9d2a5bd70fa8d}\label{dhcpv6__client_8c_a960a1cdb90a7bd9abbf9d2a5bd70fa8d}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Remove\+Addr@{dhcpv6\+Client\+Remove\+Addr}}
\index{dhcpv6\+Client\+Remove\+Addr@{dhcpv6\+Client\+Remove\+Addr}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Remove\+Addr()}{dhcpv6ClientRemoveAddr()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Remove\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} $\ast$}]{addr }\end{DoxyParamCaption})}



Remove an I\+Pv6 address from the IA. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em addr} & I\+Pv6 address to be removed \\
\hline
\end{DoxyParams}


Definition at line 2210 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
2211 \{
2212    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
2213    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
2214    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
2215 
2216    \textcolor{comment}{//Point to the underlying network interface}
2217    \textcolor{keyword}{interface }= context->settings.interface;
2218 
2219    \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
2220    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
2221    \{
2222       \textcolor{comment}{//Point to the current entry}
2223       entry = &context->ia.addrList[i];
2224 
2225       \textcolor{comment}{//Valid IPv6 address?}
2226       \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
2227       \{
2228          \textcolor{comment}{//Check whether the current entry matches the specified address}
2229          \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_ab1e93bd2152bc3f3b5642fd0216384d7}{ipv6CompAddr}(&entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr}, \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr}))
2230          \{
2231             \textcolor{comment}{//The IPv6 address is no more valid and should be removed from}
2232             \textcolor{comment}{//the list of IPv6 addresses assigned to the interface}
2233             \hyperlink{ipv6__misc_8c_aa72b374b0dba9090d90f799776797452}{ipv6RemoveAddr}(interface, \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr});
2234 
2235             \textcolor{comment}{//Remove the IPv6 address from the IA}
2236             entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} = 0;
2237          \}
2238       \}
2239    \}
2240 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}\label{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Send\+Message@{dhcpv6\+Client\+Send\+Message}}
\index{dhcpv6\+Client\+Send\+Message@{dhcpv6\+Client\+Send\+Message}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Send\+Message()}{dhcpv6ClientSendMessage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Send\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6c}{Dhcpv6\+Message\+Type}}]{type }\end{DoxyParamCaption})}



Send Solicit message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\mbox{\tt in}  & {\em type} & D\+H\+C\+Pv6 message type \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1244 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1246 \{
1247    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1248    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1249    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
1250    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
1251    \hyperlink{structNetBuffer}{NetBuffer} *buffer;
1252    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
1253    \hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message} *\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
1254    \hyperlink{dhcpv6__common_8h_a89f7acb5d12dede28c2b98290018051e}{Dhcpv6Option} *option;
1255    \hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption} iaNaOption;
1256    \hyperlink{dhcpv6__common_8h_a36456b5aa40da69f977e9153d2557714}{Dhcpv6IaAddrOption} iaAddrOption;
1257    \hyperlink{dhcpv6__common_8h_a95a52f48a22c46a8c16f31ae310f29eb}{Dhcpv6FqdnOption} *fqdnOption;
1258    \hyperlink{dhcpv6__common_8h_a26afd029729fa68e5bd82ad8a36d90d1}{Dhcpv6ElapsedTimeOption} elapsedTimeOption;
1259    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
1260    \hyperlink{structIpAddr}{IpAddr} \hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{destIpAddr};
1261 
1262    \textcolor{comment}{//Point to the underlying network interface}
1263    \textcolor{keyword}{interface }= context->settings.interface;
1264 
1265    \textcolor{comment}{//Allocate a memory buffer to hold the DHCPv6 message}
1266    buffer = \hyperlink{udp_8c_a2c65cad7c5665fe03f94364e7e52b2be}{udpAllocBuffer}(\hyperlink{dhcpv6__common_8h_a4b2fa99ee47d1cc91da2b57fa69b324f}{DHCPV6\_MAX\_MSG\_SIZE}, &offset);
1267    \textcolor{comment}{//Failed to allocate buffer?}
1268    \textcolor{keywordflow}{if}(buffer == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1269       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1270 
1271    \textcolor{comment}{//Point to the beginning of the DHCPv6 message}
1272    message = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, offset);
1273 
1274    \textcolor{comment}{//Set DHCPv6 message type}
1275    message->msgType = \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type};
1276 
1277    \textcolor{comment}{//The transaction ID is chosen by the client}
1278    \hyperlink{cpu__endian_8h_acba352ed22d98efff17d0374c0790885}{STORE24BE}(context->transactionId, message->transactionId);
1279 
1280    \textcolor{comment}{//Size of the DHCPv6 message}
1281    length = \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a32f2f44ec9a8d2ee5e2977a7fcddaf85}{Dhcpv6Message});
1282 
1283    \textcolor{comment}{//The client must include a Client Identifier option}
1284    \textcolor{comment}{//to identify itself to the server}
1285    \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a514e3d36a6eed2796997f995b847c4ff}{DHCPV6\_OPTION\_CLIENTID},
1286       context->clientId, context->clientIdLength);
1287 
1288    \textcolor{comment}{//Request, Renew, Release or Decline message?}
1289    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST} ||
1290       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf3daa29a1a24a5350cefcfe02eeb6c75}{DHCPV6\_MSG\_TYPE\_RENEW} ||
1291       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cae849f87ed116032b918ad1bbe1f0f069}{DHCPV6\_MSG\_TYPE\_RELEASE} ||
1292       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca831bfe9d5e4626e44a7c3e3a432f2ffc}{DHCPV6\_MSG\_TYPE\_DECLINE})
1293    \{
1294       \textcolor{comment}{//The client places the identifier of the destination}
1295       \textcolor{comment}{//server in a Server Identifier option}
1296       \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574ae48652f6f207faa0fecc5ba909757672}{DHCPV6\_OPTION\_SERVERID},
1297          context->serverId, context->serverIdLength);
1298    \}
1299 
1300    \textcolor{comment}{//Solicit message?}
1301    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cafdc89c929b9b3330a914465fa2032331}{DHCPV6\_MSG\_TYPE\_SOLICIT})
1302    \{
1303       \textcolor{comment}{//Check whether rapid commit is enabled}
1304       \textcolor{keywordflow}{if}(context->settings.rapidCommit)
1305       \{
1306          \textcolor{comment}{//Include the Rapid Commit option if the client is prepared}
1307          \textcolor{comment}{//to perform the Solicit/Reply message exchange}
1308          \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a8ce7598c8440ec545924bc13b5619944}{DHCPV6\_OPTION\_RAPID\_COMMIT}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
1309       \}
1310    \}
1311 
1312    \textcolor{comment}{//Solicit, Request, Confirm, Renew or Rebind message?}
1313    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cafdc89c929b9b3330a914465fa2032331}{DHCPV6\_MSG\_TYPE\_SOLICIT} ||
1314       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST} ||
1315       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM} ||
1316       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf3daa29a1a24a5350cefcfe02eeb6c75}{DHCPV6\_MSG\_TYPE\_RENEW} ||
1317       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca97164d83c790095e8d84307ef58c2cf3}{DHCPV6\_MSG\_TYPE\_REBIND})
1318    \{
1319       \textcolor{comment}{//Point to the client's fully qualified domain name}
1320       fqdnOption = (\hyperlink{dhcpv6__common_8h_a95a52f48a22c46a8c16f31ae310f29eb}{Dhcpv6FqdnOption} *) context->clientFqdn;
1321 
1322       \textcolor{comment}{//The FQDN option can be used by the client to convey its}
1323       \textcolor{comment}{//fully qualified domain name to the server}
1324       \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a8f2c1623a021faec656eb2bcaeb5d367}{DHCPV6\_OPTION\_FQDN},
1325          fqdnOption, \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a95a52f48a22c46a8c16f31ae310f29eb}{Dhcpv6FqdnOption}) + context->clientFqdnLength);
1326 
1327       \textcolor{comment}{//The client should include an Option Request option to indicate}
1328       \textcolor{comment}{//the options the client is interested in receiving}
1329       \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a99150024ead0539700a41eda4792879f}{DHCPV6\_OPTION\_ORO},
1330          &\hyperlink{dhcpv6__client_8c_aab426d22a7b9001f61aab099517cee28}{dhcpv6OptionList}, \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__client_8c_aab426d22a7b9001f61aab099517cee28}{dhcpv6OptionList}));
1331    \}
1332 
1333    \textcolor{comment}{//Prepare an IA\_NA option for a the current interface}
1334    iaNaOption.iaId = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(interface->id);
1335 
1336    \textcolor{comment}{//Solicit, Request or Confirm message?}
1337    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cafdc89c929b9b3330a914465fa2032331}{DHCPV6\_MSG\_TYPE\_SOLICIT} ||
1338       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST} ||
1339       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM})
1340    \{
1341       \textcolor{comment}{//The client should set the T1 and T2 fields in any IA\_NA options to 0}
1342       iaNaOption.t1 = 0;
1343       iaNaOption.t2 = 0;
1344    \}
1345    \textcolor{keywordflow}{else}
1346    \{
1347       \textcolor{comment}{//T1 and T2 are provided as a hint}
1348       iaNaOption.t1 = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(context->ia.t1);
1349       iaNaOption.t2 = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(context->ia.t2);
1350    \}
1351 
1352    \textcolor{comment}{//The client includes IA options for any IAs to which}
1353    \textcolor{comment}{//it wants the server to assign addresses}
1354    option = \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a03bdde9e8ae8a85d4936efb2f9fbb956}{DHCPV6\_OPTION\_IA\_NA},
1355       &iaNaOption, \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a283df3c541c6799826d644800f32079a}{Dhcpv6IaNaOption}));
1356 
1357    \textcolor{comment}{//Request, Confirm, Renew, Rebind, Release or Decline message?}
1358    \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST} ||
1359       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM} ||
1360       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf3daa29a1a24a5350cefcfe02eeb6c75}{DHCPV6\_MSG\_TYPE\_RENEW} ||
1361       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca97164d83c790095e8d84307ef58c2cf3}{DHCPV6\_MSG\_TYPE\_REBIND} ||
1362       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cae849f87ed116032b918ad1bbe1f0f069}{DHCPV6\_MSG\_TYPE\_RELEASE} ||
1363       \hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca831bfe9d5e4626e44a7c3e3a432f2ffc}{DHCPV6\_MSG\_TYPE\_DECLINE})
1364    \{
1365       \textcolor{comment}{//Loop through the IPv6 addresses recorded by the client}
1366       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
1367       \{
1368          \textcolor{comment}{//Point to the current entry}
1369          entry = &context->ia.addrList[i];
1370 
1371          \textcolor{comment}{//Valid IPv6 address?}
1372          \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
1373          \{
1374             \textcolor{comment}{//Prepare an IA Address option}
1375             iaAddrOption.address = entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr};
1376 
1377             \textcolor{comment}{//Confirm message?}
1378             \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a12e46a33bfe90638e58ef067c6fd4a6e}{type} == \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM})
1379             \{
1380                \textcolor{comment}{//The client should set the preferred and valid lifetimes to 0}
1381                iaAddrOption.preferredLifetime = 0;
1382                iaAddrOption.validLifetime = 0;
1383             \}
1384             \textcolor{keywordflow}{else}
1385             \{
1386                \textcolor{comment}{//Preferred and valid lifetimes are provided as a hint}
1387                iaAddrOption.preferredLifetime = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(entry->
      \hyperlink{structDhcpv6ClientAddrEntry_a24e1399fe28c7e13c134de1e2953e051}{preferredLifetime});
1388                iaAddrOption.validLifetime = \hyperlink{cpu__endian_8h_a63baf217625b15caa7246af75b027380}{htonl}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime});
1389             \}
1390 
1391             \textcolor{comment}{//Add the IA Address option}
1392             \hyperlink{dhcpv6__common_8c_a2eb2dd75bbf989d4353b310527465fdc}{dhcpv6AddSubOption}(option, &length, 
      \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574af02fe93475cf23de1d0dcaf371c15af2}{DHCPV6\_OPTION\_IAADDR},
1393                &iaAddrOption, \textcolor{keyword}{sizeof}(iaAddrOption));
1394          \}
1395       \}
1396    \}
1397 
1398    \textcolor{comment}{//Compute the time elapsed since the client sent the first message}
1399    elapsedTimeOption.value = \hyperlink{dhcpv6__client_8c_a0c0b3763ac06274d8b68eb5126fb51c8}{dhcpv6ClientComputeElapsedTime}(context);
1400 
1401    \textcolor{comment}{//The client must include an Elapsed Time option in messages to indicate}
1402    \textcolor{comment}{//how long the client has been trying to complete a DHCP message exchange}
1403    \hyperlink{dhcpv6__common_8c_ac0a7db4b0542d3f4b7270bfb239ce6f0}{dhcpv6AddOption}(message, &length, \hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574af9efb5295b5f1d709ba8d92957915ba1}{DHCPV6\_OPTION\_ELAPSED\_TIME},
1404       &elapsedTimeOption, \textcolor{keyword}{sizeof}(\hyperlink{dhcpv6__common_8h_a26afd029729fa68e5bd82ad8a36d90d1}{Dhcpv6ElapsedTimeOption}));
1405 
1406    \textcolor{comment}{//Adjust the length of the multi-part buffer}
1407    \hyperlink{net__mem_8c_ac0a46f396754e069dd1ee65cdc559b28}{netBufferSetLength}(buffer, offset + length);
1408 
1409    \textcolor{comment}{//Destination address}
1410    destIpAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
1411    destIpAddr.\hyperlink{structIpAddr_a9bc2340a9c0bc5a0b8aa9695b74e2ee6}{ipv6Addr} = \hyperlink{dhcpv6__common_8c_afd1207a3dea473503c7fc4aee69c6213}{DHCPV6\_ALL\_RELAY\_AGENTS\_AND\_SERVERS\_ADDR}
      ;
1412 
1413    \textcolor{comment}{//Debug message}
1414    \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n%s: Sending DHCPv6 message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
1415       \hyperlink{date__time_8c_ae15b3e664208ca7e4d6983921865cd74}{formatSystemTime}(\hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}(), \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}), length);
1416 
1417    \textcolor{comment}{//Dump the contents of the message for debugging purpose}
1418    \hyperlink{dhcpv6__debug_8c_a36ce435509b18e157c961e1e82ae0e88}{dhcpv6DumpMessage}(message, length);
1419 
1420    \textcolor{comment}{//Send DHCPv6 message}
1421    error = \hyperlink{udp_8c_a72a529f723ed1b75bfe98d0708f28eb1}{udpSendDatagramEx}(interface, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{dhcpv6__common_8h_a6802d48c8c3b96baafb23641a82f43a0}{DHCPV6\_CLIENT\_PORT},
1422       &destIpAddr, \hyperlink{dhcpv6__common_8h_ab2fd1889bb669d854b61d4a5fee3e3ec}{DHCPV6\_SERVER\_PORT}, buffer, offset, 0);
1423 
1424    \textcolor{comment}{//Free previously allocated memory}
1425    \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(buffer);
1426    \textcolor{comment}{//Return status code}
1427    \textcolor{keywordflow}{return} error;
1428 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_acb9e48f60c43f6fb4c800c16a3efde2b}\label{dhcpv6__client_8c_acb9e48f60c43f6fb4c800c16a3efde2b}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Start@{dhcpv6\+Client\+Start}}
\index{dhcpv6\+Client\+Start@{dhcpv6\+Client\+Start}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Start()}{dhcpv6ClientStart()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Start (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Start D\+H\+C\+Pv6 client. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 164 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
165 \{
166    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
167 
168    \textcolor{comment}{//Check parameter}
169    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
170       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
171 
172    \textcolor{comment}{//Debug message}
173    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Starting DHCPv6 client...\(\backslash\)r\(\backslash\)n"});
174 
175    \textcolor{comment}{//Get exclusive access}
176    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
177 
178    \textcolor{comment}{//Point to the underlying network interface}
179    \textcolor{keyword}{interface }= context->settings.interface;
180 
181    \textcolor{comment}{//Flush the list of IPv6 addresses from the client's IA}
182    \hyperlink{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}{dhcpv6ClientFlushAddrList}(context);
183 
184    \textcolor{comment}{//Automatic DNS server configuration?}
185    \textcolor{keywordflow}{if}(!context->settings.manualDnsConfig)
186    \{
187       \textcolor{comment}{//Clear the list of DNS servers}
188       \hyperlink{ipv6__misc_8c_a4b3ce94edd9cad3fb3269e805a104b97}{ipv6FlushDnsServerList}(interface);
189    \}
190 
191    \textcolor{comment}{//Check if the link is up?}
192    \textcolor{keywordflow}{if}(interface->linkState)
193    \{
194       \textcolor{comment}{//A link-local address is formed by combining the well-known}
195       \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
196       \hyperlink{dhcpv6__client_8c_a0e2ede14d583dbc040aeecc01b262ec2}{dhcpv6ClientGenerateLinkLocalAddr}(context);
197    \}
198 
199    \textcolor{comment}{//Start DHCPv6 client}
200    context->running = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
201    \textcolor{comment}{//Initialize state machine}
202    context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
203 
204    \textcolor{comment}{//Release exclusive access}
205    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
206 
207    \textcolor{comment}{//Successful processing}
208    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
209 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a5b7bf9e3e3893c66b1d11f9b1cd8173b}\label{dhcpv6__client_8c_a5b7bf9e3e3893c66b1d11f9b1cd8173b}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Bound@{dhcpv6\+Client\+State\+Bound}}
\index{dhcpv6\+Client\+State\+Bound@{dhcpv6\+Client\+State\+Bound}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Bound()}{dhcpv6ClientStateBound()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Bound (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



B\+O\+U\+ND state. 

Client has a valid lease and is in its normal operating state


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 900 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
901 \{
902    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{tiger_8c_a5017152cac85e29a2dc5d8d74de9e07c}{t1};
903    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
904 
905    \textcolor{comment}{//Get current time}
906    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
907 
908    \textcolor{comment}{//A client will never attempt to extend the lifetime of any}
909    \textcolor{comment}{//address in an IA with T1 set to 0xffffffff}
910    \textcolor{keywordflow}{if}(context->ia.t1 != \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME})
911    \{
912       \textcolor{comment}{//Convert T1 to milliseconds}
913       \textcolor{keywordflow}{if}(context->ia.t1 < (\hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY} / 1000))
914          t1 = context->ia.t1 * 1000;
915       \textcolor{keywordflow}{else}
916          t1 = \hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY};
917 
918       \textcolor{comment}{//Check the time elapsed since the lease was obtained}
919       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->leaseStartTime + t1) >= 0)
920       \{
921          \textcolor{comment}{//Record the time at which the client started the address renewal process}
922          context->configStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
923 
924          \textcolor{comment}{//Enter the RENEW state}
925          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a28a33f3446b846dc6ed8b728b23a5b70}{DHCPV6\_STATE\_RENEW}, 0);
926       \}
927    \}
928 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a003a5c770aeaf0c5df2bb69afb28e36f}\label{dhcpv6__client_8c_a003a5c770aeaf0c5df2bb69afb28e36f}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Confirm@{dhcpv6\+Client\+State\+Confirm}}
\index{dhcpv6\+Client\+State\+Confirm@{dhcpv6\+Client\+State\+Confirm}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Confirm()}{dhcpv6ClientStateConfirm()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Confirm (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



C\+O\+N\+F\+I\+RM state. 

Whenever a client may have moved to a new link, the prefixes from the addresses assigned to the interfaces on that link may no longer be appropriate for the link to which the client is attached. In such the client must initiate a Confirm/\+Reply message exchange


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 761 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
762 \{
763    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
764 
765    \textcolor{comment}{//Get current time}
766    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
767 
768    \textcolor{comment}{//Check current time}
769    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
770    \{
771       \textcolor{comment}{//Check retransmission counter}
772       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
773       \{
774          \textcolor{comment}{//Generate a 24-bit transaction ID}
775          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
776 
777          \textcolor{comment}{//Send a Confirm message}
778          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM});
779 
780          \textcolor{comment}{//Save the time at which the client sent the first message}
781          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
782          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
783 
784          \textcolor{comment}{//Initial retransmission timeout}
785          context->timeout = \hyperlink{dhcpv6__client_8h_aa08595ed02f80e2c2e2a0511f2aaab47}{DHCPV6\_CLIENT\_CNF\_TIMEOUT} +
786             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_aa08595ed02f80e2c2e2a0511f2aaab47}{DHCPV6\_CLIENT\_CNF\_TIMEOUT});
787 
788          \textcolor{comment}{//Increment retransmission counter}
789          context->retransmitCount++;
790       \}
791       \textcolor{keywordflow}{else}
792       \{
793          \textcolor{comment}{//Send a Confirm message}
794          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca91b403f91b6637d1f732b4b5f451fa70}{DHCPV6\_MSG\_TYPE\_CONFIRM});
795 
796          \textcolor{comment}{//Save the time at which the message was sent}
797          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
798 
799          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
800          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
801 
802          \textcolor{comment}{//MRT specifies an upper bound on the value of RT}
803          \textcolor{keywordflow}{if}(context->timeout > \hyperlink{dhcpv6__client_8h_ac576a1ddff3f7df551ff128cb556855d}{DHCPV6\_CLIENT\_CNF\_MAX\_RT})
804          \{
805             \textcolor{comment}{//Compute retransmission timeout}
806             context->timeout = \hyperlink{dhcpv6__client_8h_ac576a1ddff3f7df551ff128cb556855d}{DHCPV6\_CLIENT\_CNF\_MAX\_RT} +
807                \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_ac576a1ddff3f7df551ff128cb556855d}{DHCPV6\_CLIENT\_CNF\_MAX\_RT});
808          \}
809 
810          \textcolor{comment}{//Increment retransmission counter}
811          context->retransmitCount++;
812       \}
813    \}
814    \textcolor{keywordflow}{else}
815    \{
816       \textcolor{comment}{//Check retransmission counter}
817       \textcolor{keywordflow}{if}(context->retransmitCount > 0)
818       \{
819          \textcolor{comment}{//The message exchange fails once MRD seconds have elapsed since}
820          \textcolor{comment}{//the client first transmitted the message}
821          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->exchangeStartTime + 
      \hyperlink{dhcpv6__client_8h_aa3bcaa11919677bd2606891e2e620cde}{DHCPV6\_CLIENT\_CNF\_MAX\_RD}) >= 0)
822          \{
823             \textcolor{comment}{//If the client receives no responses before the message transmission}
824             \textcolor{comment}{//process terminates, the client should continue to use any IP}
825             \textcolor{comment}{//addresses using the last known lifetimes for those addresses}
826             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
827          \}
828       \}
829    \}
830 
831    \textcolor{comment}{//Manage DHCPv6 configuration timeout}
832    \hyperlink{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}{dhcpv6ClientCheckTimeout}(context);
833 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_ac0a432f4acd640a42a731407c81fc6c5}\label{dhcpv6__client_8c_ac0a432f4acd640a42a731407c81fc6c5}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Dad@{dhcpv6\+Client\+State\+Dad}}
\index{dhcpv6\+Client\+State\+Dad@{dhcpv6\+Client\+State\+Dad}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Dad()}{dhcpv6ClientStateDad()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Dad (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



D\+AD state. 

The client perform duplicate address detection on each of the addresses in any I\+As it receives in the Reply message before using that address for traffic


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 846 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
847 \{
848    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
849    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
850    \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518d}{Ipv6AddrState} state;
851    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
852 
853    \textcolor{comment}{//Point to the underlying network interface}
854    \textcolor{keyword}{interface }= context->settings.interface;
855 
856    \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
857    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
858    \{
859       \textcolor{comment}{//Point to the current entry}
860       entry = &context->ia.addrList[i];
861 
862       \textcolor{comment}{//Check the IPv6 address is a tentative address?}
863       \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
864       \{
865          \textcolor{comment}{//Get the state of the current IPv6 address}
866          state = \hyperlink{ipv6__misc_8c_ac635994871aa4238959d1c9488c5c486}{ipv6GetAddrState}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr});
867 
868          \textcolor{comment}{//Duplicate Address Detection in progress?}
869          \textcolor{keywordflow}{if}(state == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE})
870          \{
871             \textcolor{comment}{//Exit immediately}
872             \textcolor{keywordflow}{return};
873          \}
874          \textcolor{comment}{//Duplicate Address Detection failed?}
875          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(state == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID})
876          \{
877             \textcolor{comment}{//Switch to the DECLINE state}
878             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a198862c17ecac221d19b82f793b5fff8}{DHCPV6\_STATE\_DECLINE}, 0);
879             \textcolor{comment}{//Exit immediately}
880             \textcolor{keywordflow}{return};
881          \}
882       \}
883    \}
884 
885    \textcolor{comment}{//Dump current DHCPv6 configuration for debugging purpose}
886    \hyperlink{dhcpv6__client_8c_a883f4820eaaff34776c31c99c300e3ef}{dhcpv6ClientDumpConfig}(context);
887    \textcolor{comment}{//Switch to the BOUND state}
888    \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a49b5f6fffcbc5e9dadbe07ebe2d29535}{DHCPV6\_STATE\_BOUND}, 0);
889 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a270893a7e759dc1cbbdbf29e4fabd653}\label{dhcpv6__client_8c_a270893a7e759dc1cbbdbf29e4fabd653}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Decline@{dhcpv6\+Client\+State\+Decline}}
\index{dhcpv6\+Client\+State\+Decline@{dhcpv6\+Client\+State\+Decline}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Decline()}{dhcpv6ClientStateDecline()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Decline (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



D\+E\+C\+L\+I\+NE state. 

If a client detects that one or more addresses assigned to it by a server are already in use by another node, the client sends a Decline message to the server to inform it that the address is suspect


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 1183 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1184 \{
1185    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1186 
1187    \textcolor{comment}{//Get current time}
1188    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1189 
1190    \textcolor{comment}{//Check current time}
1191    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
1192    \{
1193       \textcolor{comment}{//Check retransmission counter}
1194       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
1195       \{
1196          \textcolor{comment}{//Generate a 24-bit transaction ID}
1197          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
1198 
1199          \textcolor{comment}{//Send a Decline message}
1200          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca831bfe9d5e4626e44a7c3e3a432f2ffc}{DHCPV6\_MSG\_TYPE\_DECLINE});
1201 
1202          \textcolor{comment}{//Save the time at which the message was sent}
1203          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1204          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1205 
1206          \textcolor{comment}{//Initial retransmission timeout}
1207          context->timeout = \hyperlink{dhcpv6__client_8h_a8710d99a8e41194acd5c8d086ffbbf47}{DHCPV6\_CLIENT\_DEC\_TIMEOUT} +
1208             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a8710d99a8e41194acd5c8d086ffbbf47}{DHCPV6\_CLIENT\_DEC\_TIMEOUT});
1209 
1210          \textcolor{comment}{//Increment retransmission counter}
1211          context->retransmitCount++;
1212       \}
1213       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->retransmitCount < \hyperlink{dhcpv6__client_8h_aad03fb5c71f075424c37c48318c343c2}{DHCPV6\_CLIENT\_DEC\_MAX\_RC})
1214       \{
1215          \textcolor{comment}{//Send a Decline message}
1216          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca831bfe9d5e4626e44a7c3e3a432f2ffc}{DHCPV6\_MSG\_TYPE\_DECLINE});
1217 
1218          \textcolor{comment}{//Save the time at which the message was sent}
1219          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1220 
1221          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
1222          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
1223 
1224          \textcolor{comment}{//Increment retransmission counter}
1225          context->retransmitCount++;
1226       \}
1227       \textcolor{keywordflow}{else}
1228       \{
1229          \textcolor{comment}{//If the client does not receive a response within a reasonable}
1230          \textcolor{comment}{//period of time, then it restarts the initialization procedure}
1231          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1232       \}
1233    \}
1234 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a3a68a2c66db4634e60cf22402db2d1c8}\label{dhcpv6__client_8c_a3a68a2c66db4634e60cf22402db2d1c8}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Init@{dhcpv6\+Client\+State\+Init}}
\index{dhcpv6\+Client\+State\+Init@{dhcpv6\+Client\+State\+Init}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Init()}{dhcpv6ClientStateInit()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



I\+N\+IT state. 

This is the initialization state, where a client begins the process of acquiring a lease. It also returns here when a lease ends, or when a lease negotiation fails


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 513 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
514 \{
515    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} delay;
516    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
517 
518    \textcolor{comment}{//Point to the underlying network interface}
519    \textcolor{keyword}{interface }= context->settings.interface;
520 
521    \textcolor{comment}{//Check whether the DHCPv6 client is running}
522    \textcolor{keywordflow}{if}(context->running)
523    \{
524       \textcolor{comment}{//Wait for the link to be up before starting DHCPv6 configuration}
525       \textcolor{keywordflow}{if}(interface->linkState)
526       \{
527          \textcolor{comment}{//Make sure that a valid link-local address has been assigned to the interface}
528          \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
529          \{
530             \textcolor{comment}{//Flush the list of IPv6 addresses from the client's IA}
531             \hyperlink{dhcpv6__client_8c_ab03f421bf4324e1426814302b4ef320a}{dhcpv6ClientFlushAddrList}(context);
532 
533             \textcolor{comment}{//The first Solicit message from the client on the interface must be}
534             \textcolor{comment}{//delayed by a random amount of time between 0 and SOL\_MAX\_DELAY}
535             delay = \hyperlink{dhcpv6__common_8c_ac3da027b4816200bf97e015db9e2f512}{dhcpv6RandRange}(0, 
      \hyperlink{dhcpv6__client_8h_a31be3a90bd2cbf05e3a9fa5d9a7e4714}{DHCPV6\_CLIENT\_SOL\_MAX\_DELAY});
536 
537             \textcolor{comment}{//Record the time at which the client started}
538             \textcolor{comment}{//the address acquisition process}
539             context->configStartTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
540             \textcolor{comment}{//Clear flag}
541             context->timeoutEventDone = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
542 
543             \textcolor{comment}{//Switch to the SOLICIT state}
544             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a7bc292bbd95a3839b42102e4f5a57e59}{DHCPV6\_STATE\_SOLICIT}, delay);
545          \}
546       \}
547    \}
548 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_acc0bcc17a308c4015f93d1413efe6cdc}\label{dhcpv6__client_8c_acc0bcc17a308c4015f93d1413efe6cdc}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Init\+Confirm@{dhcpv6\+Client\+State\+Init\+Confirm}}
\index{dhcpv6\+Client\+State\+Init\+Confirm@{dhcpv6\+Client\+State\+Init\+Confirm}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Init\+Confirm()}{dhcpv6ClientStateInitConfirm()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Init\+Confirm (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



I\+N\+I\+T-\/\+C\+O\+N\+F\+I\+RM state. 

When a client that already has a valid lease starts up after a power-\/down or reboot, it starts here instead of the I\+N\+IT state


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 715 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
716 \{
717    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} delay;
718    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
719 
720    \textcolor{comment}{//Point to the underlying network interface}
721    \textcolor{keyword}{interface }= context->settings.interface;
722 
723    \textcolor{comment}{//Check whether the DHCPv6 client is running}
724    \textcolor{keywordflow}{if}(context->running)
725    \{
726       \textcolor{comment}{//Wait for the link to be up before starting DHCPv6 configuration}
727       \textcolor{keywordflow}{if}(interface->linkState)
728       \{
729          \textcolor{comment}{//Make sure that a valid link-local address has been assigned to the interface}
730          \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
731          \{
732             \textcolor{comment}{//The first Confirm message from the client on the interface must be}
733             \textcolor{comment}{//delayed by a random amount of time between 0 and CNF\_MAX\_DELAY}
734             delay = \hyperlink{dhcpv6__common_8c_ac3da027b4816200bf97e015db9e2f512}{dhcpv6RandRange}(0, 
      \hyperlink{dhcpv6__client_8h_a22a23d86625b9e5368c705b81bcff699}{DHCPV6\_CLIENT\_CNF\_MAX\_DELAY});
735 
736             \textcolor{comment}{//Record the time at which the client started}
737             \textcolor{comment}{//the address acquisition process}
738             context->configStartTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
739             \textcolor{comment}{//Clear flag}
740             context->timeoutEventDone = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
741 
742             \textcolor{comment}{//Switch to the CONFIRM state}
743             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ac0f1f4819e62f2979a26a3654af7e2fc}{DHCPV6\_STATE\_CONFIRM}, delay);
744          \}
745       \}
746    \}
747 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a09565760718a3fd8534b6213870106c5}\label{dhcpv6__client_8c_a09565760718a3fd8534b6213870106c5}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Rebind@{dhcpv6\+Client\+State\+Rebind}}
\index{dhcpv6\+Client\+State\+Rebind@{dhcpv6\+Client\+State\+Rebind}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Rebind()}{dhcpv6ClientStateRebind()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Rebind (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



R\+E\+B\+I\+ND state. 

The client sends a Rebind message to any available server to extend the lifetimes on the addresses assigned to the client and to update other configuration parameters. This message is sent after a client receives no response to a Renew message


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 1028 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1029 \{
1030    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1031    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1032    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
1033    \hyperlink{structDhcpv6ClientAddrEntry}{Dhcpv6ClientAddrEntry} *entry;
1034 
1035    \textcolor{comment}{//Point to the underlying network interface}
1036    \textcolor{keyword}{interface }= context->settings.interface;
1037 
1038    \textcolor{comment}{//Get current time}
1039    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1040 
1041    \textcolor{comment}{//Check current time}
1042    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
1043    \{
1044       \textcolor{comment}{//Check retransmission counter}
1045       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
1046       \{
1047          \textcolor{comment}{//Generate a 24-bit transaction ID}
1048          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
1049 
1050          \textcolor{comment}{//Send a Rebind message}
1051          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca97164d83c790095e8d84307ef58c2cf3}{DHCPV6\_MSG\_TYPE\_REBIND});
1052 
1053          \textcolor{comment}{//Save the time at which the message was sent}
1054          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1055          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1056 
1057          \textcolor{comment}{//Initial retransmission timeout}
1058          context->timeout = \hyperlink{dhcpv6__client_8h_a78d5a54a62135ad6fd8c286b54d6b7ce}{DHCPV6\_CLIENT\_REB\_TIMEOUT} +
1059             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a78d5a54a62135ad6fd8c286b54d6b7ce}{DHCPV6\_CLIENT\_REB\_TIMEOUT});
1060       \}
1061       \textcolor{keywordflow}{else}
1062       \{
1063          \textcolor{comment}{//Send a Rebind message}
1064          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6ca97164d83c790095e8d84307ef58c2cf3}{DHCPV6\_MSG\_TYPE\_REBIND});
1065 
1066          \textcolor{comment}{//Save the time at which the message was sent}
1067          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1068 
1069          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
1070          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
1071 
1072          \textcolor{comment}{//MRT specifies an upper bound on the value of RT}
1073          \textcolor{keywordflow}{if}(context->timeout > \hyperlink{dhcpv6__client_8h_a50f4069177062750355dcd9b3ee258d3}{DHCPV6\_CLIENT\_REB\_MAX\_RT})
1074          \{
1075             \textcolor{comment}{//Compute retransmission timeout}
1076             context->timeout = \hyperlink{dhcpv6__client_8h_a50f4069177062750355dcd9b3ee258d3}{DHCPV6\_CLIENT\_REB\_MAX\_RT} +
1077                \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a50f4069177062750355dcd9b3ee258d3}{DHCPV6\_CLIENT\_REB\_MAX\_RT});
1078          \}
1079       \}
1080 
1081       \textcolor{comment}{//Increment retransmission counter}
1082       context->retransmitCount++;
1083    \}
1084    \textcolor{keywordflow}{else}
1085    \{
1086       \textcolor{comment}{//Loop through the IPv6 addresses recorded by the DHCPv6 client}
1087       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__client_8h_a50daf16fa24e452127eef9a801d8f576}{DHCPV6\_CLIENT\_ADDR\_LIST\_SIZE}; i++)
1088       \{
1089          \textcolor{comment}{//Point to the current entry}
1090          entry = &context->ia.addrList[i];
1091 
1092          \textcolor{comment}{//Valid IPv6 address?}
1093          \textcolor{keywordflow}{if}(entry->\hyperlink{structDhcpv6ClientAddrEntry_a975d3431d046a9dadc2e6a6594a09168}{validLifetime} > 0)
1094          \{
1095             \textcolor{comment}{//Check whether the valid lifetime has expired}
1096             \textcolor{keywordflow}{if}(\hyperlink{ipv6__misc_8c_ac635994871aa4238959d1c9488c5c486}{ipv6GetAddrState}(interface, &entry->\hyperlink{structDhcpv6ClientAddrEntry_a3f15eb3e64b43ca99e49e090d3c0eb72}{addr}) == 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID})
1097             \{
1098                \textcolor{comment}{//Restart DHCPv6 configuration}
1099                \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1100             \}
1101          \}
1102       \}
1103    \}
1104 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a471ff743a2f7f0ba114d24e21b094207}\label{dhcpv6__client_8c_a471ff743a2f7f0ba114d24e21b094207}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Release@{dhcpv6\+Client\+State\+Release}}
\index{dhcpv6\+Client\+State\+Release@{dhcpv6\+Client\+State\+Release}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Release()}{dhcpv6ClientStateRelease()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Release (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



R\+E\+L\+E\+A\+SE state. 

To release one or more addresses, a client sends a Release message to the server


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 1116 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
1117 \{
1118    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1119 
1120    \textcolor{comment}{//Get current time}
1121    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
1122 
1123    \textcolor{comment}{//Check current time}
1124    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
1125    \{
1126       \textcolor{comment}{//Check retransmission counter}
1127       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
1128       \{
1129          \textcolor{comment}{//Generate a 24-bit transaction ID}
1130          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
1131 
1132          \textcolor{comment}{//Send a Release message}
1133          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cae849f87ed116032b918ad1bbe1f0f069}{DHCPV6\_MSG\_TYPE\_RELEASE});
1134 
1135          \textcolor{comment}{//Save the time at which the message was sent}
1136          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1137          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1138 
1139          \textcolor{comment}{//Initial retransmission timeout}
1140          context->timeout = \hyperlink{dhcpv6__client_8h_a0718db79190a07fc4d88b3784da95e75}{DHCPV6\_CLIENT\_REL\_TIMEOUT} +
1141             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a0718db79190a07fc4d88b3784da95e75}{DHCPV6\_CLIENT\_REL\_TIMEOUT});
1142 
1143          \textcolor{comment}{//Increment retransmission counter}
1144          context->retransmitCount++;
1145       \}
1146       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->retransmitCount < \hyperlink{dhcpv6__client_8h_aa1b6b3d7f389412a86cdb91b4d22d701}{DHCPV6\_CLIENT\_REL\_MAX\_RC})
1147       \{
1148          \textcolor{comment}{//Send a Release message}
1149          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cae849f87ed116032b918ad1bbe1f0f069}{DHCPV6\_MSG\_TYPE\_RELEASE});
1150 
1151          \textcolor{comment}{//Save the time at which the message was sent}
1152          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
1153 
1154          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
1155          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
1156 
1157          \textcolor{comment}{//Increment retransmission counter}
1158          context->retransmitCount++;
1159       \}
1160       \textcolor{keywordflow}{else}
1161       \{
1162          \textcolor{comment}{//Implementations should retransmit one or more times, but may}
1163          \textcolor{comment}{//choose to terminate the retransmission procedure early}
1164          context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1165 
1166          \textcolor{comment}{//Reinitialize state machine}
1167          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
1168       \}
1169    \}
1170 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a06d1754aad1293f116e268a803f7b9b3}\label{dhcpv6__client_8c_a06d1754aad1293f116e268a803f7b9b3}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Renew@{dhcpv6\+Client\+State\+Renew}}
\index{dhcpv6\+Client\+State\+Renew@{dhcpv6\+Client\+State\+Renew}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Renew()}{dhcpv6ClientStateRenew()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Renew (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



R\+E\+N\+EW state. 

The client sends a Renew message to the server that originally provided the client\textquotesingle{}s addresses and configuration parameters to extend the lifetimes on the addresses assigned to the client and to update other configuration parameters


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 942 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
943 \{
944    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{tiger_8c_a42a80c4c472115c0fcb04a076526ecf5}{t2};
945    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
946 
947    \textcolor{comment}{//Get current time}
948    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
949 
950    \textcolor{comment}{//Check current time}
951    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
952    \{
953       \textcolor{comment}{//Check retransmission counter}
954       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
955       \{
956          \textcolor{comment}{//Generate a 24-bit transaction ID}
957          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
958 
959          \textcolor{comment}{//Send a Renew message}
960          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf3daa29a1a24a5350cefcfe02eeb6c75}{DHCPV6\_MSG\_TYPE\_RENEW});
961 
962          \textcolor{comment}{//Save the time at which the message was sent}
963          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
964          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
965 
966          \textcolor{comment}{//Initial retransmission timeout}
967          context->timeout = \hyperlink{dhcpv6__client_8h_a323354f8835b5e4753deb7d83697ae15}{DHCPV6\_CLIENT\_REN\_TIMEOUT} +
968             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a323354f8835b5e4753deb7d83697ae15}{DHCPV6\_CLIENT\_REN\_TIMEOUT});
969       \}
970       \textcolor{keywordflow}{else}
971       \{
972          \textcolor{comment}{//Send a Renew message}
973          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6caf3daa29a1a24a5350cefcfe02eeb6c75}{DHCPV6\_MSG\_TYPE\_RENEW});
974 
975          \textcolor{comment}{//Save the time at which the message was sent}
976          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
977 
978          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
979          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
980 
981          \textcolor{comment}{//MRT specifies an upper bound on the value of RT}
982          \textcolor{keywordflow}{if}(context->timeout > \hyperlink{dhcpv6__client_8h_a1061db03308a1bd7cb801539b90f5f1a}{DHCPV6\_CLIENT\_REN\_MAX\_RT})
983          \{
984             \textcolor{comment}{//Compute retransmission timeout}
985             context->timeout = \hyperlink{dhcpv6__client_8h_a1061db03308a1bd7cb801539b90f5f1a}{DHCPV6\_CLIENT\_REN\_MAX\_RT} +
986                \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a1061db03308a1bd7cb801539b90f5f1a}{DHCPV6\_CLIENT\_REN\_MAX\_RT});
987          \}
988       \}
989 
990       \textcolor{comment}{//Increment retransmission counter}
991       context->retransmitCount++;
992    \}
993    \textcolor{keywordflow}{else}
994    \{
995       \textcolor{comment}{//A client will never attempt to use a Rebind message to locate a}
996       \textcolor{comment}{//different server to extend the lifetime of any address in an IA}
997       \textcolor{comment}{//with T2 set to 0xffffffff}
998       \textcolor{keywordflow}{if}(context->ia.t2 != \hyperlink{dhcpv6__common_8h_ab9aee2bf751d949dbfa5fb9f58cb84fb}{DHCPV6\_INFINITE\_TIME})
999       \{
1000          \textcolor{comment}{//Convert T2 to milliseconds}
1001          \textcolor{keywordflow}{if}(context->ia.t2 < (\hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY} / 1000))
1002             t2 = context->ia.t2 * 1000;
1003          \textcolor{keywordflow}{else}
1004             t2 = \hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY};
1005 
1006          \textcolor{comment}{//Check whether T2 timer has expired}
1007          \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->leaseStartTime + t2) >= 0)
1008          \{
1009             \textcolor{comment}{//Switch to the REBIND state}
1010             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ae19c57945990feb5d8fd89ae986481b6}{DHCPV6\_STATE\_REBIND}, 0);
1011          \}
1012       \}
1013    \}
1014 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_aa24ccb150ee9615fb89b5dae52b709c5}\label{dhcpv6__client_8c_aa24ccb150ee9615fb89b5dae52b709c5}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Request@{dhcpv6\+Client\+State\+Request}}
\index{dhcpv6\+Client\+State\+Request@{dhcpv6\+Client\+State\+Request}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Request()}{dhcpv6ClientStateRequest()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Request (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



R\+E\+Q\+U\+E\+ST state. 

The client uses a Request message to populate I\+As with addresses and obtain other configuration information. The client includes one or more more IA options in the Request message. The server then returns addresses and other information about the I\+As to the client in IA options in a Reply message


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 641 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
642 \{
643    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
644 
645    \textcolor{comment}{//Get current time}
646    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
647 
648    \textcolor{comment}{//Check current time}
649    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
650    \{
651       \textcolor{comment}{//Check retransmission counter}
652       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
653       \{
654          \textcolor{comment}{//Generate a 24-bit transaction ID}
655          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
656 
657          \textcolor{comment}{//Send a Request message}
658          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST});
659 
660          \textcolor{comment}{//Save the time at which the message was sent}
661          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
662          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
663 
664          \textcolor{comment}{//Initial retransmission timeout}
665          context->timeout = \hyperlink{dhcpv6__client_8h_a67abc24687165b593936ede41179b085}{DHCPV6\_CLIENT\_REQ\_TIMEOUT} +
666             \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a67abc24687165b593936ede41179b085}{DHCPV6\_CLIENT\_REQ\_TIMEOUT});
667 
668          \textcolor{comment}{//Increment retransmission counter}
669          context->retransmitCount++;
670       \}
671       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->retransmitCount < \hyperlink{dhcpv6__client_8h_a5ca9925a207409329227b073df86e5c0}{DHCPV6\_CLIENT\_REQ\_MAX\_RC})
672       \{
673          \textcolor{comment}{//Send a Request message}
674          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cac1ee9533dff4ae432ec3f5213eac19a8}{DHCPV6\_MSG\_TYPE\_REQUEST});
675 
676          \textcolor{comment}{//Save the time at which the message was sent}
677          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
678 
679          \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
680          context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
681 
682          \textcolor{comment}{//MRT specifies an upper bound on the value of RT}
683          \textcolor{keywordflow}{if}(context->timeout > \hyperlink{dhcpv6__client_8h_a4c48ce238cfd17feca1413d6d1c98f10}{DHCPV6\_CLIENT\_REQ\_MAX\_RT})
684          \{
685             \textcolor{comment}{//Compute retransmission timeout}
686             context->timeout = \hyperlink{dhcpv6__client_8h_a4c48ce238cfd17feca1413d6d1c98f10}{DHCPV6\_CLIENT\_REQ\_MAX\_RT} +
687                \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_a4c48ce238cfd17feca1413d6d1c98f10}{DHCPV6\_CLIENT\_REQ\_MAX\_RT});
688          \}
689 
690          \textcolor{comment}{//Increment retransmission counter}
691          context->retransmitCount++;
692       \}
693       \textcolor{keywordflow}{else}
694       \{
695          \textcolor{comment}{//If the client does not receive a response within a reasonable}
696          \textcolor{comment}{//period of time, then it restarts the initialization procedure}
697          \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}, 0);
698       \}
699    \}
700 
701    \textcolor{comment}{//Manage DHCPv6 configuration timeout}
702    \hyperlink{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}{dhcpv6ClientCheckTimeout}(context);
703 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a3f8b9540189d50995763ccef0e89037b}\label{dhcpv6__client_8c_a3f8b9540189d50995763ccef0e89037b}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+State\+Solicit@{dhcpv6\+Client\+State\+Solicit}}
\index{dhcpv6\+Client\+State\+Solicit@{dhcpv6\+Client\+State\+Solicit}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+State\+Solicit()}{dhcpv6ClientStateSolicit()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+State\+Solicit (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



S\+O\+L\+I\+C\+IT state. 

A client uses the Solicit message to discover D\+H\+C\+Pv6 servers


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 559 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
560 \{
561    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
562 
563    \textcolor{comment}{//Get current time}
564    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
565 
566    \textcolor{comment}{//Check current time}
567    \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, context->timestamp + context->timeout) >= 0)
568    \{
569       \textcolor{comment}{//Check retransmission counter}
570       \textcolor{keywordflow}{if}(context->retransmitCount == 0)
571       \{
572          \textcolor{comment}{//Reset server preference value}
573          context->serverPreference = -1;
574          \textcolor{comment}{//Generate a 24-bit transaction ID}
575          context->transactionId = \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}() & 0x00FFFFFF;
576 
577          \textcolor{comment}{//Send a Solicit message}
578          \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cafdc89c929b9b3330a914465fa2032331}{DHCPV6\_MSG\_TYPE\_SOLICIT});
579 
580          \textcolor{comment}{//Save the time at which the message was sent}
581          context->exchangeStartTime = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
582          context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
583 
584          \textcolor{comment}{//If the client is waiting for an Advertise message, the first RT}
585          \textcolor{comment}{//must be selected to be strictly greater than IRT}
586          context->timeout = \hyperlink{dhcpv6__client_8h_acbc33f7b6178e2c6184b860eb110c19f}{DHCPV6\_CLIENT\_SOL\_TIMEOUT} +
587             abs(\hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_acbc33f7b6178e2c6184b860eb110c19f}{DHCPV6\_CLIENT\_SOL\_TIMEOUT}));
588 
589          \textcolor{comment}{//Increment retransmission counter}
590          context->retransmitCount++;
591       \}
592       \textcolor{keywordflow}{else}
593       \{
594          \textcolor{comment}{//Check whether a valid Advertise message has been received}
595          \textcolor{keywordflow}{if}(context->serverPreference >= 0)
596          \{
597             \textcolor{comment}{//Continue configuration procedure}
598             \hyperlink{dhcpv6__client_8c_aafd32758fb24f5bc2267ad372f06545d}{dhcpv6ClientChangeState}(context, 
      \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST}, 0);
599          \}
600          \textcolor{keywordflow}{else}
601          \{
602             \textcolor{comment}{//Send a Solicit message}
603             \hyperlink{dhcpv6__client_8c_ac17d0545676651d297bedbd242ab2289}{dhcpv6ClientSendMessage}(context, 
      \hyperlink{dhcpv6__common_8h_aeca9d54a4001e239844ff0245aaedf6cafdc89c929b9b3330a914465fa2032331}{DHCPV6\_MSG\_TYPE\_SOLICIT});
604 
605             \textcolor{comment}{//Save the time at which the message was sent}
606             context->timestamp = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
607 
608             \textcolor{comment}{//The RT is doubled for each subsequent retransmission}
609             context->timeout = context->timeout * 2 + \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(context->timeout);
610 
611             \textcolor{comment}{//MRT specifies an upper bound on the value of RT}
612             \textcolor{keywordflow}{if}(context->timeout > \hyperlink{dhcpv6__client_8h_ad41aa61ee73646a89f8d4c6a0e10a1f5}{DHCPV6\_CLIENT\_SOL\_MAX\_RT})
613             \{
614                \textcolor{comment}{//Compute retransmission timeout}
615                context->timeout = \hyperlink{dhcpv6__client_8h_ad41aa61ee73646a89f8d4c6a0e10a1f5}{DHCPV6\_CLIENT\_SOL\_MAX\_RT} +
616                   \hyperlink{dhcpv6__common_8c_ae04cea0e44f0c28da17198d59517ac10}{dhcpv6Rand}(\hyperlink{dhcpv6__client_8h_ad41aa61ee73646a89f8d4c6a0e10a1f5}{DHCPV6\_CLIENT\_SOL\_MAX\_RT});
617             \}
618 
619             \textcolor{comment}{//Increment retransmission counter}
620             context->retransmitCount++;
621          \}
622       \}
623    \}
624 
625    \textcolor{comment}{//Manage DHCPv6 configuration timeout}
626    \hyperlink{dhcpv6__client_8c_aaa81ea43e74b44c4bb1c376ee7ddd28b}{dhcpv6ClientCheckTimeout}(context);
627 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a1ad0aeb8db19ae4b1be0285f365dffae}\label{dhcpv6__client_8c_a1ad0aeb8db19ae4b1be0285f365dffae}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Stop@{dhcpv6\+Client\+Stop}}
\index{dhcpv6\+Client\+Stop@{dhcpv6\+Client\+Stop}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Stop()}{dhcpv6ClientStop()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} dhcpv6\+Client\+Stop (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Stop D\+H\+C\+Pv6 client. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 218 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
219 \{
220    \textcolor{comment}{//Check parameter}
221    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
222       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
223 
224    \textcolor{comment}{//Debug message}
225    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Stopping DHCPv6 client...\(\backslash\)r\(\backslash\)n"});
226 
227    \textcolor{comment}{//Get exclusive access}
228    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
229 
230    \textcolor{comment}{//Stop DHCPv6 client}
231    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
232    \textcolor{comment}{//Reinitialize state machine}
233    context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
234 
235    \textcolor{comment}{//Release exclusive access}
236    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
237 
238    \textcolor{comment}{//Successful processing}
239    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
240 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcpv6__client_8c_a0856bc5fef6b68be0c8780ab0b25ae5c}\label{dhcpv6__client_8c_a0856bc5fef6b68be0c8780ab0b25ae5c}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Tick@{dhcpv6\+Client\+Tick}}
\index{dhcpv6\+Client\+Tick@{dhcpv6\+Client\+Tick}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Tick()}{dhcpv6ClientTick()}}
{\footnotesize\ttfamily void dhcpv6\+Client\+Tick (\begin{DoxyParamCaption}\item[{\hyperlink{dhcpv6__client_8h_aac4eb11915c8cf98cce890c9d0270c9b}{Dhcpv6\+Client\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



D\+H\+C\+Pv6 client timer handler. 

This routine must be periodically called by the T\+C\+P/\+IP stack to manage D\+H\+C\+Pv6 client operation


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the D\+H\+C\+Pv6 client context \\
\hline
\end{DoxyParams}


Definition at line 341 of file dhcpv6\+\_\+client.\+c.


\begin{DoxyCode}
342 \{
343    \textcolor{comment}{//Make sure the DHCPv6 client has been properly instantiated}
344    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
345       \textcolor{keywordflow}{return};
346 
347    \textcolor{comment}{//DHCPv6 client finite state machine}
348    \textcolor{keywordflow}{switch}(context->state)
349    \{
350    \textcolor{comment}{//Process INIT state}
351    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT}:
352       \textcolor{comment}{//This is the initialization state, where a client begins the process of}
353       \textcolor{comment}{//acquiring a lease. It also returns here when a lease ends, or when a}
354       \textcolor{comment}{//lease negotiation fails}
355       \hyperlink{dhcpv6__client_8c_a3a68a2c66db4634e60cf22402db2d1c8}{dhcpv6ClientStateInit}(context);
356       \textcolor{keywordflow}{break};
357    \textcolor{comment}{//Process SOLICIT state}
358    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a7bc292bbd95a3839b42102e4f5a57e59}{DHCPV6\_STATE\_SOLICIT}:
359       \textcolor{comment}{//The client sends a Solicit message to locate servers}
360       \hyperlink{dhcpv6__client_8c_a3f8b9540189d50995763ccef0e89037b}{dhcpv6ClientStateSolicit}(context);
361       \textcolor{keywordflow}{break};
362    \textcolor{comment}{//Process REQUEST state}
363    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a4a75d2c1f2fd8684d2a124721935a7d9}{DHCPV6\_STATE\_REQUEST}:
364       \textcolor{comment}{//The client sends a Request message to request configuration}
365       \textcolor{comment}{//parameters, including IP addresses, from a specific server}
366       \hyperlink{dhcpv6__client_8c_aa24ccb150ee9615fb89b5dae52b709c5}{dhcpv6ClientStateRequest}(context);
367       \textcolor{keywordflow}{break};
368    \textcolor{comment}{//Process INIT-CONFIRM state}
369    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a73ca75f9f049c278a5f92b2def686884}{DHCPV6\_STATE\_INIT\_CONFIRM}:
370       \textcolor{comment}{//When a client that already has a valid lease starts up after a}
371       \textcolor{comment}{//power-down or reboot, it starts here instead of the INIT state}
372       \hyperlink{dhcpv6__client_8c_acc0bcc17a308c4015f93d1413efe6cdc}{dhcpv6ClientStateInitConfirm}(context);
373       \textcolor{keywordflow}{break};
374    \textcolor{comment}{//Process CONFIRM state}
375    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ac0f1f4819e62f2979a26a3654af7e2fc}{DHCPV6\_STATE\_CONFIRM}:
376       \textcolor{comment}{//The client sends a Confirm message to any available server}
377       \textcolor{comment}{//to determine whether the addresses it was assigned are still}
378       \textcolor{comment}{//appropriate to the link to which the client is connected}
379       \hyperlink{dhcpv6__client_8c_a003a5c770aeaf0c5df2bb69afb28e36f}{dhcpv6ClientStateConfirm}(context);
380       \textcolor{keywordflow}{break};
381    \textcolor{comment}{//Process DAD state}
382    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a3b351a49eb0882948f1af86701439abd}{DHCPV6\_STATE\_DAD}:
383       \textcolor{comment}{//The client should perform duplicate address detection on each}
384       \textcolor{comment}{//of the addresses in any IAs it receives in the Reply message}
385       \textcolor{comment}{//before using that address for traffic}
386       \hyperlink{dhcpv6__client_8c_ac0a432f4acd640a42a731407c81fc6c5}{dhcpv6ClientStateDad}(context);
387       \textcolor{keywordflow}{break};
388    \textcolor{comment}{//Process BOUND state}
389    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a49b5f6fffcbc5e9dadbe07ebe2d29535}{DHCPV6\_STATE\_BOUND}:
390       \textcolor{comment}{//The client has a valid lease and is in its normal operating state}
391       \hyperlink{dhcpv6__client_8c_a5b7bf9e3e3893c66b1d11f9b1cd8173b}{dhcpv6ClientStateBound}(context);
392       \textcolor{keywordflow}{break};
393    \textcolor{comment}{//Process RENEW state}
394    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a28a33f3446b846dc6ed8b728b23a5b70}{DHCPV6\_STATE\_RENEW}:
395       \textcolor{comment}{//The client sends a Renew message to the server that originally}
396       \textcolor{comment}{//provided the client's addresses and configuration parameters to}
397       \textcolor{comment}{//extend the lifetimes on the addresses assigned to the client}
398       \textcolor{comment}{//and to update other configuration parameters}
399       \hyperlink{dhcpv6__client_8c_a06d1754aad1293f116e268a803f7b9b3}{dhcpv6ClientStateRenew}(context);
400       \textcolor{keywordflow}{break};
401    \textcolor{comment}{//Process REBIND state}
402    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9ae19c57945990feb5d8fd89ae986481b6}{DHCPV6\_STATE\_REBIND}:
403       \textcolor{comment}{//The client sends a Rebind message to any available server to extend}
404       \textcolor{comment}{//the lifetimes on the addresses assigned to the client and to update}
405       \textcolor{comment}{//other configuration parameters. This message is sent after a client}
406       \textcolor{comment}{//receives no response to a Renew message}
407       \hyperlink{dhcpv6__client_8c_a09565760718a3fd8534b6213870106c5}{dhcpv6ClientStateRebind}(context);
408       \textcolor{keywordflow}{break};
409    \textcolor{comment}{//Process RELEASE state}
410    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a5c7dfad4462eb1ae1b609e1800f1dc93}{DHCPV6\_STATE\_RELEASE}:
411       \textcolor{comment}{//To release one or more addresses, a client sends a Release message}
412       \textcolor{comment}{//to the server}
413       \hyperlink{dhcpv6__client_8c_a471ff743a2f7f0ba114d24e21b094207}{dhcpv6ClientStateRelease}(context);
414       \textcolor{keywordflow}{break};
415    \textcolor{comment}{//Process DECLINE state}
416    \textcolor{keywordflow}{case} \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a198862c17ecac221d19b82f793b5fff8}{DHCPV6\_STATE\_DECLINE}:
417       \textcolor{comment}{//If a client detects that one or more addresses assigned to it by a}
418       \textcolor{comment}{//server are already in use by another node, the client sends a Decline}
419       \textcolor{comment}{//message to the server to inform it that the address is suspect}
420       \hyperlink{dhcpv6__client_8c_a270893a7e759dc1cbbdbf29e4fabd653}{dhcpv6ClientStateDecline}(context);
421       \textcolor{keywordflow}{break};
422    \textcolor{comment}{//Invalid state...}
423    \textcolor{keywordflow}{default}:
424       \textcolor{comment}{//Switch to the default state}
425       context->state = \hyperlink{dhcpv6__client_8h_a8610bfd009af9756638a193136ef93f9a017951020877623ce2220289f5c93025}{DHCPV6\_STATE\_INIT};
426       \textcolor{keywordflow}{break};
427    \}
428 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{dhcpv6__client_8c_a0ad2c17a8d547e75d579b9763ace80bb}\label{dhcpv6__client_8c_a0ad2c17a8d547e75d579b9763ace80bb}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Client\+Tick\+Counter@{dhcpv6\+Client\+Tick\+Counter}}
\index{dhcpv6\+Client\+Tick\+Counter@{dhcpv6\+Client\+Tick\+Counter}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Client\+Tick\+Counter}{dhcpv6ClientTickCounter}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} dhcpv6\+Client\+Tick\+Counter}



Definition at line 59 of file dhcpv6\+\_\+client.\+c.

\mbox{\Hypertarget{dhcpv6__client_8c_aab426d22a7b9001f61aab099517cee28}\label{dhcpv6__client_8c_aab426d22a7b9001f61aab099517cee28}} 
\index{dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}!dhcpv6\+Option\+List@{dhcpv6\+Option\+List}}
\index{dhcpv6\+Option\+List@{dhcpv6\+Option\+List}!dhcpv6\+\_\+client.\+c@{dhcpv6\+\_\+client.\+c}}
\subsubsection{\texorpdfstring{dhcpv6\+Option\+List}{dhcpv6OptionList}}
{\footnotesize\ttfamily const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} dhcpv6\+Option\+List\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=
\{
   \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574aa89fd532aa788635b50b90e9b08d2467}{DHCPV6\_OPTION\_DNS\_SERVERS}),
   \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{dhcpv6__common_8h_ace3d7da87df06edf56819a49ebf00574a0d94e5bb20a3a651e5adf6381ee9a0e8}{DHCPV6\_OPTION\_DOMAIN\_LIST}),

\}
\end{DoxyCode}


Definition at line 62 of file dhcpv6\+\_\+client.\+c.

