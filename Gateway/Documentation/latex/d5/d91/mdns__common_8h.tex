\hypertarget{mdns__common_8h}{}\section{cyclone\+\_\+tcp/mdns/mdns\+\_\+common.h File Reference}
\label{mdns__common_8h}\index{cyclone\+\_\+tcp/mdns/mdns\+\_\+common.\+h@{cyclone\+\_\+tcp/mdns/mdns\+\_\+common.\+h}}


Definitions common to m\+D\+NS client and m\+D\+NS responder.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dns/dns\+\_\+common.\+h\char`\"{}}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structMdnsMessage}{Mdns\+Message}
\begin{DoxyCompactList}\small\item\em m\+D\+NS message \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}~1024
\item 
\#define \hyperlink{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL}~120
\item 
\#define \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{M\+D\+N\+S\+\_\+\+P\+O\+RT}~5353
\item 
\#define \hyperlink{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL}~255
\item 
\#define \hyperlink{mdns__common_8h_a909578ac09bb6948e089bece875b866a}{M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL}~10
\item 
\#define \hyperlink{mdns__common_8h_ac11a61056f0e21d666d58a0e433848df}{M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU}~0x8000
\item 
\#define \hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH}~0x8000
\item 
\#define \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}~\hyperlink{ipv4_8h_ad600bf3656435c44c5d656e99a11943f}{I\+P\+V4\+\_\+\+A\+D\+DR}(224, 0, 0, 251)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__common_8h_aeb137e5cf039c0b5effd9ea059e7fc88}{mdns\+Init} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface)
\begin{DoxyCompactList}\small\item\em m\+D\+NS related initialization \end{DoxyCompactList}\item 
void \hyperlink{mdns__common_8h_a252aea5bd3e1234732e974e5c0d6485e}{mdns\+Process\+Message} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$pseudo\+Header, const \hyperlink{udp_8h_a6877bae1da8326482f5e311875e52bce}{Udp\+Header} $\ast$udp\+Header, const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$buffer, size\+\_\+t \hyperlink{pic32mz_2isr__support_8h_ac0542d92dfcd62c19170fd963f9e5052}{offset}, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Process incoming m\+D\+NS message. \end{DoxyCompactList}\item 
void \hyperlink{mdns__common_8h_a23ed025b0ad23410ff4f6bba1529b390}{mdns\+Process\+Response} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Process m\+D\+NS response message. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{mdns__common_8h_aaf99b38b5cd277eebe20ca9650cf9a96}{mdns\+Check\+Source\+Addr} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$pseudo\+Header)
\begin{DoxyCompactList}\small\item\em Source address check. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__common_8h_a5c5005850cf4d8dd089bbd62641aa9ba}{mdns\+Create\+Message} (\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} query\+Response)
\begin{DoxyCompactList}\small\item\em Create an empty m\+D\+NS message. \end{DoxyCompactList}\item 
void \hyperlink{mdns__common_8h_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdns\+Delete\+Message} (\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message})
\begin{DoxyCompactList}\small\item\em release a m\+D\+NS message \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{mdns__common_8h_ae9c33998a8a019066d4da724a80f6674}{mdns\+Send\+Message} (\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$interface, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$\hyperlink{ipcp_8h_a752e1719cf65f78dfec6274352cb56df}{dest\+Ip\+Addr}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{udp_8h_af15d713ad2bc92686abfa6ab012b5039}{dest\+Port})
\begin{DoxyCompactList}\small\item\em Send m\+D\+NS message. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{mdns__common_8h_a5e982ed651cae31a97f043d2258e3fc0}{mdns\+Encode\+Name} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$instance, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$service, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$domain, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$dest)
\begin{DoxyCompactList}\small\item\em Encode instance, service and domain names using the D\+NS name notation. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\+\_\+t} \hyperlink{mdns__common_8h_ae5c1c848e56ea78f8656ce7941251c75}{mdns\+Compare\+Name} (const \hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{Dns\+Header} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t pos, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$instance, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$service, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$domain, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
\begin{DoxyCompactList}\small\item\em Compare instance, service and domain names. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\+\_\+t} \hyperlink{mdns__common_8h_abe6bb283dc2b40749cdecca396ea4809}{mdns\+Compare\+Record} (const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$message1, size\+\_\+t offset1, const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$record1, const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$message2, size\+\_\+t offset2, const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$record2)
\begin{DoxyCompactList}\small\item\em Compare resource records. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{mdns__common_8h_afaea9bc4752331623276122fd01f6d51}{mdns\+Check\+Duplicate\+Record} (const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$instance, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$service, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$domain, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{dns__common_8h_ad2132c3ae5d965be42616e13a24c2b89}{rtype})
\begin{DoxyCompactList}\small\item\em Check for duplicate resource records. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} \hyperlink{mdns__common_8h_a74c29f24464b2cbb5c7754c264a462a2}{M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Definitions common to m\+D\+NS client and m\+D\+NS responder. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}\label{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL}}
\index{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL}{MDNS\_DEFAULT\_IP\_TTL}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+I\+P\+\_\+\+T\+TL~255}



Definition at line 55 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}\label{mdns__common_8h_a9896dc3ce607bb63bdee5f6189a3d9cd}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL}}
\index{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL}{MDNS\_DEFAULT\_RR\_TTL}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+R\+\_\+\+T\+TL~120}



Definition at line 47 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}\label{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR@{M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}}
\index{M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR@{M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}{MDNS\_IPV4\_MULTICAST\_ADDR}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+I\+P\+V4\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR~\hyperlink{ipv4_8h_ad600bf3656435c44c5d656e99a11943f}{I\+P\+V4\+\_\+\+A\+D\+DR}(224, 0, 0, 251)}



Definition at line 65 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_a909578ac09bb6948e089bece875b866a}\label{mdns__common_8h_a909578ac09bb6948e089bece875b866a}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL}}
\index{M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL@{M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL}{MDNS\_LEGACY\_UNICAST\_RR\_TTL}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+U\+N\+I\+C\+A\+S\+T\+\_\+\+R\+R\+\_\+\+T\+TL~10}



Definition at line 57 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}\label{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE@{M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}}
\index{M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE@{M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}{MDNS\_MESSAGE\_MAX\_SIZE}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE~1024}



Definition at line 40 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}\label{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+P\+O\+RT@{M\+D\+N\+S\+\_\+\+P\+O\+RT}}
\index{M\+D\+N\+S\+\_\+\+P\+O\+RT@{M\+D\+N\+S\+\_\+\+P\+O\+RT}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+P\+O\+RT}{MDNS\_PORT}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+P\+O\+RT~5353}



Definition at line 53 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_ac11a61056f0e21d666d58a0e433848df}\label{mdns__common_8h_ac11a61056f0e21d666d58a0e433848df}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU@{M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU}}
\index{M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU@{M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU}{MDNS\_QCLASS\_QU}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+Q\+C\+L\+A\+S\+S\+\_\+\+QU~0x8000}



Definition at line 60 of file mdns\+\_\+common.\+h.

\mbox{\Hypertarget{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}\label{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH@{M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH}}
\index{M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH@{M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH}{MDNS\_RCLASS\_CACHE\_FLUSH}}
{\footnotesize\ttfamily \#define M\+D\+N\+S\+\_\+\+R\+C\+L\+A\+S\+S\+\_\+\+C\+A\+C\+H\+E\+\_\+\+F\+L\+U\+SH~0x8000}



Definition at line 62 of file mdns\+\_\+common.\+h.



\subsection{Function Documentation}
\mbox{\Hypertarget{mdns__common_8h_afaea9bc4752331623276122fd01f6d51}\label{mdns__common_8h_afaea9bc4752331623276122fd01f6d51}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Check\+Duplicate\+Record@{mdns\+Check\+Duplicate\+Record}}
\index{mdns\+Check\+Duplicate\+Record@{mdns\+Check\+Duplicate\+Record}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Check\+Duplicate\+Record()}{mdnsCheckDuplicateRecord()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} mdns\+Check\+Duplicate\+Record (\begin{DoxyParamCaption}\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{instance,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{service,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{domain,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{rtype }\end{DoxyParamCaption})}



Check for duplicate resource records. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em instance} & Instance name \\
\hline
\mbox{\tt in}  & {\em service} & Service name \\
\hline
\mbox{\tt in}  & {\em domain} & Domain name \\
\hline
\mbox{\tt in}  & {\em rtype} & Resource record type \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns T\+R\+UE is the specified resource record is a duplicate. Otherwise F\+A\+L\+SE is returned 
\end{DoxyReturn}


Definition at line 889 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
891 \{
892    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
893    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
894    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
895    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
896    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_ab71c0274cba7f2fc8f94ded11b72917a}{rclass};
897    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} duplicate;
898    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
899 
900    \textcolor{comment}{//Clear flag}
901    duplicate = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
902 
903    \textcolor{comment}{//Point to the first question}
904    offset = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
905 
906    \textcolor{comment}{//Parse the Question Section}
907    \textcolor{keywordflow}{for}(i = 0; i < message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount; i++)
908    \{
909       \textcolor{comment}{//Parse domain name}
910       offset = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
911       \textcolor{comment}{//Invalid name?}
912       \textcolor{keywordflow}{if}(!offset)
913          \textcolor{keywordflow}{break};
914 
915       \textcolor{comment}{//Point to the next question}
916       offset += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion});
917       \textcolor{comment}{//Make sure the mDNS message is valid}
918       \textcolor{keywordflow}{if}(offset > message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
919          \textcolor{keywordflow}{break};
920    \}
921 
922    \textcolor{comment}{//Successful processing?}
923    \textcolor{keywordflow}{if}(i == message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount)
924    \{
925       \textcolor{comment}{//Compute the total number of resource records}
926       k = message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount + message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount +
927          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount;
928 
929       \textcolor{comment}{//Loop through the resource records}
930       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}; i++)
931       \{
932          \textcolor{comment}{//Parse resource record name}
933          n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
934          \textcolor{comment}{//Invalid name?}
935          \textcolor{keywordflow}{if}(!n)
936             \textcolor{keywordflow}{break};
937 
938          \textcolor{comment}{//Point to the associated resource record}
939          record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(message->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
940          \textcolor{comment}{//Point to the resource data}
941          n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
942 
943          \textcolor{comment}{//Make sure the resource record is valid}
944          \textcolor{keywordflow}{if}(n > message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
945             \textcolor{keywordflow}{break};
946          \textcolor{keywordflow}{if}((n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength)) > message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
947             \textcolor{keywordflow}{break};
948 
949          \textcolor{comment}{//Convert the record class to host byte order}
950          rclass = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rclass);
951          \textcolor{comment}{//Discard cache-flush bit}
952          rclass &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
953 
954          \textcolor{comment}{//Check the class and the type of the resource record}
955          \textcolor{keywordflow}{if}(rclass == \hyperlink{dns__common_8h_aa541e7289dae8934f7f37e74c15cc5a5ae4d96c0329f035328ba190627f2782e9}{DNS\_RR\_CLASS\_IN} && \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rtype) == 
      \hyperlink{dns__common_8h_ad2132c3ae5d965be42616e13a24c2b89}{rtype})
956          \{
957             \textcolor{comment}{//Compare resource record name}
958             \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
959                offset, instance, service, domain, 0))
960             \{
961                \textcolor{comment}{//The resource record is already present in the Answer Section}
962                duplicate = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
963                \textcolor{comment}{//We are done}
964                \textcolor{keywordflow}{break};
965             \}
966          \}
967 
968          \textcolor{comment}{//Point to the next resource record}
969          offset = n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength);
970       \}
971    \}
972 
973    \textcolor{comment}{//The function returns TRUE is the specified resource record is a duplicate}
974    \textcolor{keywordflow}{return} duplicate;
975 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_aaf99b38b5cd277eebe20ca9650cf9a96}\label{mdns__common_8h_aaf99b38b5cd277eebe20ca9650cf9a96}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Check\+Source\+Addr@{mdns\+Check\+Source\+Addr}}
\index{mdns\+Check\+Source\+Addr@{mdns\+Check\+Source\+Addr}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Check\+Source\+Addr()}{mdnsCheckSourceAddr()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} mdns\+Check\+Source\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$}]{pseudo\+Header }\end{DoxyParamCaption})}



Source address check. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em pseudo\+Header} & U\+DP pseudo header \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the source address is valid, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 272 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
274 \{
275    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} valid;
276 
277 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
278    \textcolor{comment}{//IPv4 packet received?}
279    \textcolor{keywordflow}{if}(pseudoHeader->\hyperlink{structIpPseudoHeader_aeff06b8d9c3e7e2ef3cdb8a3a14e8ad2}{length} == \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a0e92b64e038199f1bb6383f2a76f30b6}{Ipv4PseudoHeader}))
280    \{
281       \textcolor{comment}{//Perform source address check (refer to RFC 6762 section 11)}
282       \textcolor{keywordflow}{if}(pseudoHeader->\hyperlink{structIpPseudoHeader_a4dd0d91580f30918dc7b5d5a430dba6a}{ipv4Data}.destAddr == \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{MDNS\_IPV4\_MULTICAST\_ADDR})
283       \{
284          \textcolor{comment}{//All responses received with the destination address 224.0.0.251}
285          \textcolor{comment}{//are necessarily deemed to have originated on the local link,}
286          \textcolor{comment}{//regardless of source IP address}
287          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
288       \}
289       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{ipv4_8h_ac05ef077f021f8b032ecd41018de5ea1}{ipv4IsLinkLocalAddr}(pseudoHeader->\hyperlink{structIpPseudoHeader_a4dd0d91580f30918dc7b5d5a430dba6a}{ipv4Data}.srcAddr) ||
290          \hyperlink{ipv4_8h_ac05ef077f021f8b032ecd41018de5ea1}{ipv4IsLinkLocalAddr}(pseudoHeader->\hyperlink{structIpPseudoHeader_a4dd0d91580f30918dc7b5d5a430dba6a}{ipv4Data}.destAddr))
291       \{
292          \textcolor{comment}{//Packets with a link-local source or destination address}
293          \textcolor{comment}{//originate from the local link}
294          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
295       \}
296       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{ipv4__misc_8c_accb4841f1cb2665a6392644031a27713}{ipv4IsOnLink}(interface, pseudoHeader->\hyperlink{structIpPseudoHeader_a4dd0d91580f30918dc7b5d5a430dba6a}{ipv4Data}.srcAddr))
297       \{
298          \textcolor{comment}{//The source IP address is on the local link}
299          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
300       \}
301       \textcolor{keywordflow}{else}
302       \{
303          \textcolor{comment}{//Only accept responses that originate from the local link, and}
304          \textcolor{comment}{//silently discard any other response packets}
305          valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
306       \}
307    \}
308    \textcolor{keywordflow}{else}
309 \textcolor{preprocessor}{#endif}
310 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
311    \textcolor{comment}{//IPv6 packet received?}
312    \textcolor{keywordflow}{if}(pseudoHeader->\hyperlink{structIpPseudoHeader_aeff06b8d9c3e7e2ef3cdb8a3a14e8ad2}{length} == \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_a68061e0a0b502d880cbe60b645cfa2b7}{Ipv6PseudoHeader}))
313    \{
314       \textcolor{comment}{//Perform source address check (refer to RFC 6762 section 11)}
315       \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_ab1e93bd2152bc3f3b5642fd0216384d7}{ipv6CompAddr}(&pseudoHeader->\hyperlink{structIpPseudoHeader_a5155846ca7e85218407a8374d035aab7}{ipv6Data}.destAddr, &
      \hyperlink{mdns__common_8c_a74c29f24464b2cbb5c7754c264a462a2}{MDNS\_IPV6\_MULTICAST\_ADDR}))
316       \{
317          \textcolor{comment}{//All responses received with the destination address ff02::fb}
318          \textcolor{comment}{//are necessarily deemed to have originated on the local link,}
319          \textcolor{comment}{//regardless of source IP address}
320          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
321       \}
322       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{ipv6__misc_8c_ab10ec233f3239c6238bb4f5995543a79}{ipv6IsOnLink}(interface, &pseudoHeader->\hyperlink{structIpPseudoHeader_a5155846ca7e85218407a8374d035aab7}{ipv6Data}.srcAddr))
323       \{
324          \textcolor{comment}{//The source IP address is on the local link}
325          valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
326       \}
327       \textcolor{keywordflow}{else}
328       \{
329          \textcolor{comment}{//Only accept responses that originate from the local link, and}
330          \textcolor{comment}{//silently discard any other response packets}
331          valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
332       \}
333    \}
334    \textcolor{keywordflow}{else}
335 \textcolor{preprocessor}{#endif}
336    \textcolor{comment}{//Invalid packet received?}
337    \{
338       \textcolor{comment}{//Discard the response packet}
339       valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
340    \}
341 
342    \textcolor{comment}{//Return flag value}
343    \textcolor{keywordflow}{return} valid;
344 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_ae5c1c848e56ea78f8656ce7941251c75}\label{mdns__common_8h_ae5c1c848e56ea78f8656ce7941251c75}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Compare\+Name@{mdns\+Compare\+Name}}
\index{mdns\+Compare\+Name@{mdns\+Compare\+Name}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Compare\+Name()}{mdnsCompareName()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\+\_\+t} mdns\+Compare\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{Dns\+Header} $\ast$}]{message,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t}]{pos,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{instance,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{service,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{domain,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{level }\end{DoxyParamCaption})}



Compare instance, service and domain names. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the D\+NS message \\
\hline
\mbox{\tt in}  & {\em length} & Length of the D\+NS message \\
\hline
\mbox{\tt in}  & {\em pos} & Offset of the encoded name \\
\hline
\mbox{\tt in}  & {\em instance} & Instance name \\
\hline
\mbox{\tt in}  & {\em service} & Service name \\
\hline
\mbox{\tt in}  & {\em domain} & Domain name \\
\hline
\mbox{\tt in}  & {\em level} & Current level of recursion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns 0 if the domain names match, -\/1 if the first domain name lexicographically precedes the second name, or 1 if the second domain name lexicographically precedes the first name 
\end{DoxyReturn}


Definition at line 630 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
632 \{
633    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
634    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
635    \textcolor{keywordtype}{size\_t} \hyperlink{icmp_8h_a7d569b4cae06fc4e5b219d6359d5b66b}{pointer};
636    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
637 
638    \textcolor{comment}{//Check parameters}
639    \textcolor{keywordflow}{if}(instance == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || service == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || domain == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
640       \textcolor{keywordflow}{return} -2;
641 
642    \textcolor{comment}{//Recursion limit exceeded?}
643    \textcolor{keywordflow}{if}(\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} >= \hyperlink{dns__common_8h_ad7c564a6c097ccf95320ec6c83e55751}{DNS\_NAME\_MAX\_RECURSION})
644       \textcolor{keywordflow}{return} -2;
645 
646    \textcolor{comment}{//Cast the DNS message to byte array}
647    p = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
648 
649    \textcolor{comment}{//Skip the separator that may precede the domain name}
650    \textcolor{keywordflow}{if}(*domain == \textcolor{charliteral}{'.'})
651       domain++;
652 
653    \textcolor{comment}{//Parse encoded domain name}
654    \textcolor{keywordflow}{while}(pos < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
655    \{
656       \textcolor{comment}{//Retrieve the length of the current label}
657       n = p[pos];
658 
659       \textcolor{comment}{//End marker found?}
660       \textcolor{keywordflow}{if}(n == 0)
661       \{
662          \textcolor{comment}{//The domain name which still has remaining data is deemed}
663          \textcolor{comment}{//lexicographically later}
664          \textcolor{keywordflow}{if}(*instance != \textcolor{charliteral}{'\(\backslash\)0'} || *service != \textcolor{charliteral}{'\(\backslash\)0'} || *domain != \textcolor{charliteral}{'\(\backslash\)0'})
665             \textcolor{keywordflow}{return} -1;
666 
667          \textcolor{comment}{//The domain names match each other}
668          \textcolor{keywordflow}{return} 0;
669       \}
670       \textcolor{comment}{//Compression tag found?}
671       \textcolor{keywordflow}{if}(n >= \hyperlink{dns__common_8h_ab8e2a0ad5aad0d460862627ecee69fdb}{DNS\_COMPRESSION\_TAG})
672       \{
673          \textcolor{comment}{//Malformed DNS message?}
674          \textcolor{keywordflow}{if}((pos + 1) >= \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
675             \textcolor{keywordflow}{return} -2;
676 
677          \textcolor{comment}{//Read the most significant byte of the pointer}
678          pointer = (p[pos] & ~\hyperlink{dns__common_8h_ab8e2a0ad5aad0d460862627ecee69fdb}{DNS\_COMPRESSION\_TAG}) << 8;
679          \textcolor{comment}{//Read the least significant byte of the pointer}
680          pointer |= p[pos + 1];
681 
682          \textcolor{comment}{//Compare the remaining part}
683          res = \hyperlink{mdns__common_8c_ae5c1c848e56ea78f8656ce7941251c75}{mdnsCompareName}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, pointer,
684             instance, service, domain, \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1);
685 
686          \textcolor{comment}{//Return comparison result}
687          \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
688       \}
689       \textcolor{keywordflow}{else}
690       \{
691          \textcolor{comment}{//Advance data pointer}
692          pos++;
693 
694          \textcolor{comment}{//Malformed DNS message?}
695          \textcolor{keywordflow}{if}((pos + n) > \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
696             \textcolor{keywordflow}{return} -2;
697 
698          \textcolor{comment}{//Compare current label}
699          \textcolor{keywordflow}{if}(*instance != \textcolor{charliteral}{'\(\backslash\)0'})
700          \{
701             \textcolor{comment}{//Compare instance name}
702             res = \hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}((\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *) p + pos, instance, n);
703             \textcolor{comment}{//Any mismatch?}
704             \textcolor{keywordflow}{if}(res)
705                \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
706 
707             \textcolor{comment}{//Advance data pointer}
708             instance += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
709 
710             \textcolor{comment}{//The instance name which still has remaining data is deemed}
711             \textcolor{comment}{//lexicographically later}
712             \textcolor{keywordflow}{if}(*instance != \textcolor{charliteral}{'\(\backslash\)0'} && *instance != \textcolor{charliteral}{'.'})
713                \textcolor{keywordflow}{return} -1;
714 
715             \textcolor{comment}{//Skip the separator character, if any}
716             \textcolor{keywordflow}{if}(*instance == \textcolor{charliteral}{'.'})
717                instance++;
718          \}
719          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*service != \textcolor{charliteral}{'\(\backslash\)0'})
720          \{
721             \textcolor{comment}{//Compare service name}
722             res = \hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}((\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *) p + pos, service, n);
723             \textcolor{comment}{//Any mismatch?}
724             \textcolor{keywordflow}{if}(res)
725                \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
726 
727             \textcolor{comment}{//Advance data pointer}
728             service += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
729 
730             \textcolor{comment}{//The service name which still has remaining data is deemed}
731             \textcolor{comment}{//lexicographically later}
732             \textcolor{keywordflow}{if}(*service != \textcolor{charliteral}{'\(\backslash\)0'} && *service != \textcolor{charliteral}{'.'})
733                \textcolor{keywordflow}{return} -1;
734 
735             \textcolor{comment}{//Any separator in service name?}
736             \textcolor{keywordflow}{if}(*service == \textcolor{charliteral}{'.'})
737                service++;
738          \}
739          \textcolor{keywordflow}{else}
740          \{
741             \textcolor{comment}{//Compare domain name}
742             res = \hyperlink{os__port__windows_8h_aba00036f71bb67f8600b239a39cf5ec9}{strncasecmp}((\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *) p + pos, domain, n);
743             \textcolor{comment}{//Any mismatch?}
744             \textcolor{keywordflow}{if}(res)
745                \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
746 
747             \textcolor{comment}{//Advance data pointer}
748             domain += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
749 
750             \textcolor{comment}{//The domain name which still has remaining data is deemed}
751             \textcolor{comment}{//lexicographically later}
752             \textcolor{keywordflow}{if}(*domain != \textcolor{charliteral}{'\(\backslash\)0'} && *domain != \textcolor{charliteral}{'.'})
753                \textcolor{keywordflow}{return} -1;
754 
755             \textcolor{comment}{//Any separator in domain name?}
756             \textcolor{keywordflow}{if}(*domain == \textcolor{charliteral}{'.'})
757                domain++;
758          \}
759 
760          \textcolor{comment}{//Advance data pointer}
761          pos += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
762       \}
763    \}
764 
765    \textcolor{comment}{//Malformed DNS message}
766    \textcolor{keywordflow}{return} -2;
767 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_abe6bb283dc2b40749cdecca396ea4809}\label{mdns__common_8h_abe6bb283dc2b40749cdecca396ea4809}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Compare\+Record@{mdns\+Compare\+Record}}
\index{mdns\+Compare\+Record@{mdns\+Compare\+Record}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Compare\+Record()}{mdnsCompareRecord()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\+\_\+t} mdns\+Compare\+Record (\begin{DoxyParamCaption}\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message1,  }\item[{size\+\_\+t}]{offset1,  }\item[{const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$}]{record1,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message2,  }\item[{size\+\_\+t}]{offset2,  }\item[{const \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{Dns\+Resource\+Record} $\ast$}]{record2 }\end{DoxyParamCaption})}



Compare resource records. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message1} & Pointer to the first m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em offset1} & Offset of the first but of the resource record \\
\hline
\mbox{\tt in}  & {\em record1} & Pointer the first resource record \\
\hline
\mbox{\tt in}  & {\em message2} & Pointer to the second m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em offset2} & Offset of the first but of the resource record \\
\hline
\mbox{\tt in}  & {\em record2} & Pointer the second resource record \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns 0 if the resource records match, -\/1 if the first resource record lexicographically precedes the second one, or 1 if the second resource record lexicographically precedes the first one 
\end{DoxyReturn}


Definition at line 783 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
786 \{
787    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
788    \textcolor{keywordtype}{size\_t} n1;
789    \textcolor{keywordtype}{size\_t} n2;
790    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} value1;
791    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} value2;
792 
793    \textcolor{comment}{//Convert the record class to host byte order}
794    value1 = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record1->rclass);
795    value2 = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record2->rclass);
796 
797    \textcolor{comment}{//Discard cache-flush bit}
798    value1 &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
799    value2 &= ~\hyperlink{mdns__common_8h_ac8f63bafad3fb67887a45586c82f71e9}{MDNS\_RCLASS\_CACHE\_FLUSH};
800 
801    \textcolor{comment}{//The determination of lexicographically later record is performed by}
802    \textcolor{comment}{//first comparing the record class (excluding the cache-flush bit)}
803    \textcolor{keywordflow}{if}(value1 < value2)
804       \textcolor{keywordflow}{return} -1;
805    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(value1 > value2)
806       \textcolor{keywordflow}{return} 1;
807 
808    \textcolor{comment}{//Convert the record type to host byte order}
809    value1 = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record1->rtype);
810    value2 = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record2->rtype);
811 
812    \textcolor{comment}{//Then compare the record type}
813    \textcolor{keywordflow}{if}(value1 < value2)
814       \textcolor{keywordflow}{return} -1;
815    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(value1 > value2)
816       \textcolor{keywordflow}{return} 1;
817 
818    \textcolor{comment}{//If the rrtype and rrclass both match, then the rdata is compared}
819    \textcolor{keywordflow}{if}(value1 == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a97ef561523c7a1f36bc8d9fd566bc7de}{DNS\_RR\_TYPE\_NS} || value1 == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1aea427a3bd906aee39a1ba3c0b051617f}{DNS\_RR\_TYPE\_SOA} ||
820       value1 == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a2656dcebca4f1f2c9db41f034ee75ee4}{DNS\_RR\_TYPE\_CNAME} || value1 == \hyperlink{dns__common_8h_aa24a9fb31b6fb3858a24a8d8682e23d1a23a2ea11b5bb8ab8d6d088de58be553b}{DNS\_RR\_TYPE\_PTR})
821    \{
822       \textcolor{comment}{//Compute the offset of the first byte of the rdata}
823       n1 = record1->rdata - (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message1->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader};
824       n2 = record2->rdata - (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) message2->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader};
825 
826       \textcolor{comment}{//The names must be uncompressed before comparison}
827       res = \hyperlink{dns__common_8c_a5a2a26fa4e4ec615f776176da210541f}{dnsCompareEncodedName}(message1->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message1->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length},
828          n1, message2->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message2->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, n2, 0);
829    \}
830    \textcolor{keywordflow}{else}
831    \{
832       \textcolor{comment}{//Retrieve the length of the rdata fields}
833       n1 = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(record1->rdlength);
834       n2 = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(record2->rdlength);
835 
836       \textcolor{comment}{//The bytes of the raw uncompressed rdata are compared in turn, interpreting}
837       \textcolor{comment}{//the bytes as eight-bit unsigned values, until a byte is found whose value}
838       \textcolor{comment}{//is greater than that of its counterpart (in which case, the rdata whose}
839       \textcolor{comment}{//byte has the greater value is deemed lexicographically later) or one of the}
840       \textcolor{comment}{//resource records runs out of rdata (in which case, the resource record which}
841       \textcolor{comment}{//still has remaining data first is deemed lexicographically later)}
842       \textcolor{keywordflow}{if}(n1 < n2)
843       \{
844          \textcolor{comment}{//Raw comparison of the binary content of the rdata}
845          res = memcmp(record1->rdata, record2->rdata, n1);
846 
847          \textcolor{comment}{//Check comparison result}
848          \textcolor{keywordflow}{if}(!res)
849          \{
850             \textcolor{comment}{//The first resource records runs out of rdata}
851             res = -1;
852          \}
853       \}
854       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n1 > n2)
855       \{
856          \textcolor{comment}{//Raw comparison of the binary content of the rdata}
857          res = memcmp(record1->rdata, record2->rdata, n2);
858 
859          \textcolor{comment}{//Check comparison result}
860          \textcolor{keywordflow}{if}(!res)
861          \{
862             \textcolor{comment}{//The second resource records runs out of rdata}
863             res = 1;
864          \}
865       \}
866       \textcolor{keywordflow}{else}
867       \{
868          \textcolor{comment}{//Raw comparison of the binary content of the rdata}
869          res = memcmp(record1->rdata, record2->rdata, n1);
870       \}
871    \}
872 
873    \textcolor{comment}{//Return comparison result}
874    \textcolor{keywordflow}{return} \hyperlink{resource__manager_8c_a369fab9cf831846ad1a1d6bd33a86fa1}{res};
875 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_a5c5005850cf4d8dd089bbd62641aa9ba}\label{mdns__common_8h_a5c5005850cf4d8dd089bbd62641aa9ba}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Create\+Message@{mdns\+Create\+Message}}
\index{mdns\+Create\+Message@{mdns\+Create\+Message}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Create\+Message()}{mdnsCreateMessage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Create\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{query\+Response }\end{DoxyParamCaption})}



Create an empty m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em message} & Newly created m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em query\+Response} & This flag specifies whether the message is a query or a response \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 354 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
355 \{
356    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
357 
358    \textcolor{comment}{//Allocate a memory buffer to hold the mDNS message}
359    message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} = \hyperlink{udp_8c_a2c65cad7c5665fe03f94364e7e52b2be}{udpAllocBuffer}(\hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE}, &
      message->\hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset});
360 
361    \textcolor{comment}{//Successful memory allocation?}
362    \textcolor{keywordflow}{if}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
363    \{
364       \textcolor{comment}{//Point to the mDNS message header}
365       message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer}, message->
      \hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset});
366 
367       \textcolor{comment}{//Sanity check}
368       \textcolor{keywordflow}{if}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
369       \{
370          \textcolor{comment}{//Format mDNS message header}
371          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->id = 0;
372          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->opcode = \hyperlink{dns__common_8h_a9f7c2277e233fdeda3757e48282d3314af37862c9f8865288e6df0392930ec0a3}{DNS\_OPCODE\_QUERY};
373          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->tc = 0;
374          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->rd = 0;
375          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ra = 0;
376          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->z = 0;
377          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->rcode = \hyperlink{dns__common_8h_a4e14ab5567efbae42f570bc5bbd1d209a3673e53909ca3bf211abc3f0600158e0}{DNS\_RCODE\_NO\_ERROR};
378          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount = 0;
379          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount = 0;
380          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount = 0;
381          message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount = 0;
382 
383          \textcolor{comment}{//Query or response mDNS message?}
384          \textcolor{keywordflow}{if}(!queryResponse)
385          \{
386             \textcolor{comment}{//In query messages, QR and AA bits must be set to zero}
387             message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qr = 0;
388             message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->aa = 0;
389          \}
390          \textcolor{keywordflow}{else}
391          \{
392             \textcolor{comment}{//In response messages, QR and AA bits must be set to one}
393             message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qr = 1;
394             message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->aa = 1;
395          \}
396 
397          \textcolor{comment}{//Number of shared resource records}
398          message->\hyperlink{structMdnsMessage_a0d87d66898216dc4e73abc9a2189bdde}{sharedRecordCount} = 0;
399          \textcolor{comment}{//Length of the mDNS message}
400          message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
401 
402          \textcolor{comment}{//Successful processing}
403          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
404       \}
405       \textcolor{keywordflow}{else}
406       \{
407          \textcolor{comment}{//Clean up side effects}
408          \hyperlink{mdns__common_8c_a07a3be8974e6aa1ec47c6364a9ddaafd}{mdnsDeleteMessage}(message);
409 
410          \textcolor{comment}{//Report an error}
411          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
412       \}
413    \}
414    \textcolor{keywordflow}{else}
415    \{
416       \textcolor{comment}{//Failed to allocate memory}
417       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca528efe91b7a7e4bcc9a6de7d4b778c67}{ERROR\_OUT\_OF\_RESOURCES};
418    \}
419 
420    \textcolor{comment}{//Return status code}
421    \textcolor{keywordflow}{return} error;
422 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_a07a3be8974e6aa1ec47c6364a9ddaafd}\label{mdns__common_8h_a07a3be8974e6aa1ec47c6364a9ddaafd}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Delete\+Message@{mdns\+Delete\+Message}}
\index{mdns\+Delete\+Message@{mdns\+Delete\+Message}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Delete\+Message()}{mdnsDeleteMessage()}}
{\footnotesize\ttfamily void mdns\+Delete\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message }\end{DoxyParamCaption})}



release a m\+D\+NS message 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & m\+D\+NS message to be released \\
\hline
\end{DoxyParams}


Definition at line 430 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
431 \{
432    \textcolor{comment}{//Valid mDNS message?}
433    \textcolor{keywordflow}{if}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
434    \{
435       \textcolor{comment}{//Free previously allocated memory}
436       \hyperlink{net__mem_8c_aa33fc4dd2a71649194052f297c707d08}{netBufferFree}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer});
437 
438       \textcolor{comment}{//The mDNS message is no more valid}
439       message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
440       message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = 0;
441    \}
442 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_a5e982ed651cae31a97f043d2258e3fc0}\label{mdns__common_8h_a5e982ed651cae31a97f043d2258e3fc0}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Encode\+Name@{mdns\+Encode\+Name}}
\index{mdns\+Encode\+Name@{mdns\+Encode\+Name}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Encode\+Name()}{mdnsEncodeName()}}
{\footnotesize\ttfamily size\+\_\+t mdns\+Encode\+Name (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{instance,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{service,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{domain,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{dest }\end{DoxyParamCaption})}



Encode instance, service and domain names using the D\+NS name notation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em instance} & Instance name \\
\hline
\mbox{\tt in}  & {\em service} & Service name \\
\hline
\mbox{\tt in}  & {\em domain} & Domain name \\
\hline
\mbox{\tt out}  & {\em dest} & Pointer to the encoded name (optional parameter) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Length of the encoded domain name 
\end{DoxyReturn}


Definition at line 540 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
542 \{
543    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
544    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
545 
546    \textcolor{comment}{//Total length of the encoded name}
547    length = 0;
548 
549    \textcolor{comment}{//Any instance name?}
550    \textcolor{keywordflow}{if}(*instance != \textcolor{charliteral}{'\(\backslash\)0'})
551    \{
552       \textcolor{comment}{//Encode instance name}
553       n = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(instance, dest);
554 
555       \textcolor{comment}{//Failed to encode instance name?}
556       \textcolor{keywordflow}{if}(!n)
557          \textcolor{keywordflow}{return} 0;
558 
559       \textcolor{comment}{//Update the length of the encoded name}
560       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
561    \}
562 
563    \textcolor{comment}{//Any service name?}
564    \textcolor{keywordflow}{if}(*service != \textcolor{charliteral}{'\(\backslash\)0'})
565    \{
566       \textcolor{comment}{//If an instance name precedes the service name, then}
567       \textcolor{comment}{//remove the null label}
568       \textcolor{keywordflow}{if}(length > 0)
569          length--;
570 
571       \textcolor{comment}{//Encode service name}
572       \textcolor{keywordflow}{if}(dest != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
573          n = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(service, dest + length);
574       \textcolor{keywordflow}{else}
575          n = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(service, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
576 
577       \textcolor{comment}{//Failed to encode instance name?}
578       \textcolor{keywordflow}{if}(!n)
579          \textcolor{keywordflow}{return} 0;
580 
581       \textcolor{comment}{//Update the length of the encoded name}
582       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
583    \}
584 
585    \textcolor{comment}{//Skip the separator that may precede the domain name}
586    \textcolor{keywordflow}{if}(*domain == \textcolor{charliteral}{'.'})
587       domain++;
588 
589    \textcolor{comment}{//Any domain name to encode?}
590    \textcolor{keywordflow}{if}(*domain != \textcolor{charliteral}{'\(\backslash\)0'})
591    \{
592       \textcolor{comment}{//If an instance or a service name precedes the domain name, then}
593       \textcolor{comment}{//remove the null label}
594       \textcolor{keywordflow}{if}(length > 0)
595          length--;
596 
597       \textcolor{comment}{//Encode domain name}
598       \textcolor{keywordflow}{if}(dest != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
599          n = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(domain, dest + length);
600       \textcolor{keywordflow}{else}
601          n = \hyperlink{dns__common_8c_aa375505b90ab1f2473b3084c97ace370}{dnsEncodeName}(domain, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
602 
603       \textcolor{comment}{//Failed to encode instance name?}
604       \textcolor{keywordflow}{if}(!n)
605          \textcolor{keywordflow}{return} 0;
606 
607       \textcolor{comment}{//Update the length of the encoded name}
608       length += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
609    \}
610 
611    \textcolor{comment}{//Return the length of the encoded string}
612    \textcolor{keywordflow}{return} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
613 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_aeb137e5cf039c0b5effd9ea059e7fc88}\label{mdns__common_8h_aeb137e5cf039c0b5effd9ea059e7fc88}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Init@{mdns\+Init}}
\index{mdns\+Init@{mdns\+Init}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Init()}{mdnsInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface }\end{DoxyParamCaption})}



m\+D\+NS related initialization 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 69 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
70 \{
71    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
72 
73 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
74    \textcolor{comment}{//Join the mDNS IPv4 multicast group}
75    error = \hyperlink{ipv4_8c_ab2a827c952b160ccc0afba106e865183}{ipv4JoinMulticastGroup}(interface, 
      \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{MDNS\_IPV4\_MULTICAST\_ADDR});
76    \textcolor{comment}{//Any error to report?}
77    \textcolor{keywordflow}{if}(error)
78       \textcolor{keywordflow}{return} error;
79 \textcolor{preprocessor}{#endif}
80 
81 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
82    \textcolor{comment}{//Join the mDNS IPv6 multicast group}
83    error = \hyperlink{ipv6_8c_abbf3683ee76a53fdf931e58fabe6db6f}{ipv6JoinMulticastGroup}(interface, &
      \hyperlink{mdns__common_8c_a74c29f24464b2cbb5c7754c264a462a2}{MDNS\_IPV6\_MULTICAST\_ADDR});
84    \textcolor{comment}{//Any error to report?}
85    \textcolor{keywordflow}{if}(error)
86       \textcolor{keywordflow}{return} error;
87 \textcolor{preprocessor}{#endif}
88 
89    \textcolor{comment}{//Callback function to be called when a mDNS message is received}
90    error = \hyperlink{udp_8c_a38370e246c2908c710db4773a6423cee}{udpAttachRxCallback}(interface, \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, 
      \hyperlink{mdns__common_8c_a252aea5bd3e1234732e974e5c0d6485e}{mdnsProcessMessage}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
91    \textcolor{comment}{//Any error to report?}
92    \textcolor{keywordflow}{if}(error)
93       \textcolor{keywordflow}{return} error;
94 
95    \textcolor{comment}{//Successful initialization}
96    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
97 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_a252aea5bd3e1234732e974e5c0d6485e}\label{mdns__common_8h_a252aea5bd3e1234732e974e5c0d6485e}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Process\+Message@{mdns\+Process\+Message}}
\index{mdns\+Process\+Message@{mdns\+Process\+Message}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Process\+Message()}{mdnsProcessMessage()}}
{\footnotesize\ttfamily void mdns\+Process\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structIpPseudoHeader}{Ip\+Pseudo\+Header} $\ast$}]{pseudo\+Header,  }\item[{const \hyperlink{udp_8h_a6877bae1da8326482f5e311875e52bce}{Udp\+Header} $\ast$}]{udp\+Header,  }\item[{const \hyperlink{structNetBuffer}{Net\+Buffer} $\ast$}]{buffer,  }\item[{size\+\_\+t}]{offset,  }\item[{void $\ast$}]{param }\end{DoxyParamCaption})}



Process incoming m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em pseudo\+Header} & U\+DP pseudo header \\
\hline
\mbox{\tt in}  & {\em udp\+Header} & U\+DP header \\
\hline
\mbox{\tt in}  & {\em buffer} & Multi-\/part buffer containing the incoming m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em offset} & Offset to the first byte of the m\+D\+NS message \\
\hline
\mbox{\tt in}  & {\em param} & Callback function parameter (not used) \\
\hline
\end{DoxyParams}


Definition at line 110 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
112 \{
113    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
114    \hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader} *dnsHeader;
115    \hyperlink{structMdnsMessage}{MdnsMessage} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
116 
117    \textcolor{comment}{//Retrieve the length of the mDNS message}
118    length = \hyperlink{net__mem_8c_ac9dbcd9e28e61d8f4f6d2e9af2607b68}{netBufferGetLength}(buffer) - \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
119 
120    \textcolor{comment}{//Ensure the mDNS message is valid}
121    \textcolor{keywordflow}{if}(length < \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader}))
122       \textcolor{keywordflow}{return};
123    \textcolor{keywordflow}{if}(length > \hyperlink{mdns__common_8h_abed9326bbb44eaf624d42cea4089f367}{MDNS\_MESSAGE\_MAX\_SIZE})
124       \textcolor{keywordflow}{return};
125 
126    \textcolor{comment}{//Point to the mDNS message header}
127    dnsHeader = \hyperlink{net__mem_8c_a20d30c9db547b3b2743368b589cf482b}{netBufferAt}(buffer, \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset});
128    \textcolor{comment}{//Sanity check}
129    \textcolor{keywordflow}{if}(dnsHeader == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
130       \textcolor{keywordflow}{return};
131 
132    \textcolor{comment}{//Debug message}
133    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"mDNS message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, length);
134    \textcolor{comment}{//Dump message}
135    \hyperlink{dns__debug_8c_aa6a38c4e74d8b059c64c30456d5c26ad}{dnsDumpMessage}(dnsHeader, length);
136 
137    \textcolor{comment}{//mDNS messages received with an opcode other than zero must be silently}
138    \textcolor{comment}{//ignored}
139    \textcolor{keywordflow}{if}(dnsHeader->opcode != \hyperlink{dns__common_8h_a9f7c2277e233fdeda3757e48282d3314af37862c9f8865288e6df0392930ec0a3}{DNS\_OPCODE\_QUERY})
140       \textcolor{keywordflow}{return};
141 
142    \textcolor{comment}{//mDNS messages received with non-zero response codes must be silently}
143    \textcolor{comment}{//ignored}
144    \textcolor{keywordflow}{if}(dnsHeader->rcode != \hyperlink{dns__common_8h_a4e14ab5567efbae42f570bc5bbd1d209a3673e53909ca3bf211abc3f0600158e0}{DNS\_RCODE\_NO\_ERROR})
145       \textcolor{keywordflow}{return};
146 
147    \textcolor{comment}{//Save mDNS message}
148    message.\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} = (\hyperlink{structNetBuffer}{NetBuffer} *) buffer;
149    message.\hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset} = \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
150    message.\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length} = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
151    message.\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader} = pseudoHeader;
152    message.\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader} = udpHeader;
153    message.\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader} = dnsHeader;
154 
155    \textcolor{comment}{//mDNS query received?}
156    \textcolor{keywordflow}{if}(!dnsHeader->qr)
157    \{
158 \textcolor{preprocessor}{#if (MDNS\_RESPONDER\_SUPPORT == ENABLED)}
159       \textcolor{comment}{//Process incoming mDNS query message}
160       \hyperlink{mdns__responder_8c_a13e701e7094bd3b41bddb0761d5088aa}{mdnsResponderProcessQuery}(interface, &message);
161 \textcolor{preprocessor}{#endif}
162    \}
163    \textcolor{comment}{//mDNS response received?}
164    \textcolor{keywordflow}{else}
165    \{
166       \textcolor{comment}{//Process incoming mDNS response message}
167       \hyperlink{mdns__common_8c_a23ed025b0ad23410ff4f6bba1529b390}{mdnsProcessResponse}(interface, &message);
168    \}
169 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_a23ed025b0ad23410ff4f6bba1529b390}\label{mdns__common_8h_a23ed025b0ad23410ff4f6bba1529b390}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Process\+Response@{mdns\+Process\+Response}}
\index{mdns\+Process\+Response@{mdns\+Process\+Response}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Process\+Response()}{mdnsProcessResponse()}}
{\footnotesize\ttfamily void mdns\+Process\+Response (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{\hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Process m\+D\+NS response message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em response} & Incoming m\+D\+NS response message \\
\hline
\end{DoxyParams}


Definition at line 178 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
179 \{
180    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
181    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
182    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
183    \textcolor{keywordtype}{size\_t} \hyperlink{pic32mz_2isr__support_8h_a12a5aed8a193ebbf9a641104a310610d}{offset};
184    \hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord} *record;
185 
186    \textcolor{comment}{//Source address check (refer to RFC 6762 section 11)}
187    \textcolor{keywordflow}{if}(!\hyperlink{mdns__common_8c_aaf99b38b5cd277eebe20ca9650cf9a96}{mdnsCheckSourceAddr}(interface, response->\hyperlink{structMdnsMessage_a8173839436f43ca92bf177cf22e4e61f}{pseudoHeader}))
188       \textcolor{keywordflow}{return};
189 
190    \textcolor{comment}{//mDNS implementations must silently ignore any mDNS responses they}
191    \textcolor{comment}{//receive where the source UDP port is not 5353}
192    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_acd6f1b81f088caf914bbb89240d3f261}{udpHeader}->srcPort) != \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT})
193       \textcolor{keywordflow}{return};
194 
195    \textcolor{comment}{//Point to the question section}
196    offset = \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a5caa7816ce531b3920054e974a0679f3}{DnsHeader});
197 
198    \textcolor{comment}{//Any questions in the question section of a received mDNS response}
199    \textcolor{comment}{//must be silently ignored}
200    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount); i++)
201    \{
202       \textcolor{comment}{//Parse domain name}
203       offset = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
204       \textcolor{comment}{//Invalid name?}
205       \textcolor{keywordflow}{if}(!offset)
206          \textcolor{keywordflow}{break};
207 
208       \textcolor{comment}{//Point to the next question}
209       offset += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_ac1ef063cc8bc932118463092c282f188}{DnsQuestion});
210       \textcolor{comment}{//Make sure the mDNS message is valid}
211       \textcolor{keywordflow}{if}(offset > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
212          \textcolor{keywordflow}{break};
213    \}
214 
215    \textcolor{comment}{//Malformed mDNS message?}
216    \textcolor{keywordflow}{if}(i != \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount))
217       \textcolor{keywordflow}{return};
218 
219    \textcolor{comment}{//Compute the total number of resource records}
220    k = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount) +
221       \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount) +
222       \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount);
223 
224    \textcolor{comment}{//Loop through the resource records}
225    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k}; i++)
226    \{
227       \textcolor{comment}{//Parse resource record name}
228       n = \hyperlink{dns__common_8c_a6a5df1aead8f61467e9bf5e739ea5de0}{dnsParseName}(response->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, response->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length}, offset, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0);
229       \textcolor{comment}{//Invalid name?}
230       \textcolor{keywordflow}{if}(!n)
231          \textcolor{keywordflow}{break};
232 
233       \textcolor{comment}{//Point to the associated resource record}
234       record = \hyperlink{dns__common_8h_a4f1a2722ba292be26060ec5693e1f280}{DNS\_GET\_RESOURCE\_RECORD}(response->
      \hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, n);
235       \textcolor{comment}{//Point to the resource data}
236       n += \textcolor{keyword}{sizeof}(\hyperlink{dns__common_8h_a801d4a933cd802d56c5450013b4c0969}{DnsResourceRecord});
237 
238       \textcolor{comment}{//Make sure the resource record is valid}
239       \textcolor{keywordflow}{if}(n > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
240          \textcolor{keywordflow}{break};
241       \textcolor{keywordflow}{if}((n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength)) > response->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length})
242          \textcolor{keywordflow}{break};
243 
244 \textcolor{preprocessor}{#if (MDNS\_CLIENT\_SUPPORT == ENABLED)}
245       \textcolor{comment}{//Parse the resource record}
246       \hyperlink{mdns__client_8c_a8ed7df3053e1c0197c4b742ed1ea4f3e}{mdnsClientParseAnRecord}(interface, response, offset, record);
247 \textcolor{preprocessor}{#endif}
248 
249 \textcolor{preprocessor}{#if (MDNS\_RESPONDER\_SUPPORT == ENABLED)}
250       \textcolor{comment}{//Parse the resource record}
251       \hyperlink{mdns__responder_8c_a2410b64ea776775499df0053050399c2}{mdnsResponderParseAnRecord}(interface, response, offset, record);
252 \textcolor{preprocessor}{#endif}
253 
254 \textcolor{preprocessor}{#if (DNS\_SD\_SUPPORT == ENABLED)}
255       \textcolor{comment}{//Parse the resource record}
256       \hyperlink{dns__sd_8c_a6798c58627559624f9021f86f95f4ee6}{dnsSdParseAnRecord}(interface, response, offset, record);
257 \textcolor{preprocessor}{#endif}
258 
259       \textcolor{comment}{//Point to the next resource record}
260       offset = n + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(record->rdlength);
261    \}
262 \}
\end{DoxyCode}
\mbox{\Hypertarget{mdns__common_8h_ae9c33998a8a019066d4da724a80f6674}\label{mdns__common_8h_ae9c33998a8a019066d4da724a80f6674}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!mdns\+Send\+Message@{mdns\+Send\+Message}}
\index{mdns\+Send\+Message@{mdns\+Send\+Message}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{mdns\+Send\+Message()}{mdnsSendMessage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mdns\+Send\+Message (\begin{DoxyParamCaption}\item[{\hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{Net\+Interface} $\ast$}]{interface,  }\item[{const \hyperlink{structMdnsMessage}{Mdns\+Message} $\ast$}]{message,  }\item[{const \hyperlink{structIpAddr}{Ip\+Addr} $\ast$}]{dest\+Ip\+Addr,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{dest\+Port }\end{DoxyParamCaption})}



Send m\+D\+NS message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em interface} & Underlying network interface \\
\hline
\mbox{\tt in}  & {\em message} & m\+D\+NS message to be sent \\
\hline
\mbox{\tt in}  & {\em dest\+Ip\+Addr} & Destination IP address (optional parameter) \\
\hline
\mbox{\tt in}  & {\em dest\+Port} & Destination port \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 454 of file mdns\+\_\+common.\+c.


\begin{DoxyCode}
456 \{
457    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
458    \hyperlink{structIpAddr}{IpAddr} \hyperlink{mib__common_8h_a3860e959b1b7dd73686a6e11424805e2}{ipAddr};
459 
460    \textcolor{comment}{//Make sure the mDNS message is valid}
461    \textcolor{keywordflow}{if}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
462       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
463 
464    \textcolor{comment}{//Convert 16-bit values to network byte order}
465    message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->qdcount);
466    message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->nscount);
467    message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->ancount);
468    message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}->arcount);
469 
470    \textcolor{comment}{//Start of exception handling block}
471    \textcolor{keywordflow}{do}
472    \{
473       \textcolor{comment}{//Adjust the length of the multi-part buffer}
474       error = \hyperlink{net__mem_8c_ac0a46f396754e069dd1ee65cdc559b28}{netBufferSetLength}(message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer}, message->
      \hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset} + message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length});
475       \textcolor{comment}{//Any error to report?}
476       \textcolor{keywordflow}{if}(error)
477          \textcolor{keywordflow}{break};
478 
479       \textcolor{comment}{//Debug message}
480       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending mDNS message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"}, message->
      \hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length});
481       \textcolor{comment}{//Dump message}
482       \hyperlink{dns__debug_8c_aa6a38c4e74d8b059c64c30456d5c26ad}{dnsDumpMessage}(message->\hyperlink{structMdnsMessage_ac5ab08c143472d040db637c76c972cab}{dnsHeader}, message->\hyperlink{structMdnsMessage_ad1ebbfad05745924fdeee3389f270e52}{length});
483 
484       \textcolor{comment}{//Check whether the message should be sent to a specific IP address}
485       \textcolor{keywordflow}{if}(destIpAddr != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
486       \{
487          \textcolor{comment}{//All multicast DNS responses should be sent with an IP TTL set to 255}
488          error = \hyperlink{udp_8c_a72a529f723ed1b75bfe98d0708f28eb1}{udpSendDatagramEx}(interface, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, destIpAddr,
489             \hyperlink{tcp_8h_af15d713ad2bc92686abfa6ab012b5039}{destPort}, message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer}, message->\hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset}, 
      \hyperlink{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}{MDNS\_DEFAULT\_IP\_TTL});
490          \textcolor{comment}{//Any error to report?}
491          \textcolor{keywordflow}{if}(error)
492             \textcolor{keywordflow}{break};
493       \}
494       \textcolor{keywordflow}{else}
495       \{
496 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
497          \textcolor{comment}{//Select the relevant multicast address (224.0.0.251)}
498          ipAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
499          ipAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr} = \hyperlink{mdns__common_8h_a7a515a9c0095fb81084930f6174abe77}{MDNS\_IPV4\_MULTICAST\_ADDR};
500 
501          \textcolor{comment}{//All multicast DNS queries should be sent with an IP TTL set to 255}
502          error = \hyperlink{udp_8c_a72a529f723ed1b75bfe98d0708f28eb1}{udpSendDatagramEx}(interface, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, &ipAddr,
503             \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer}, message->\hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset}, 
      \hyperlink{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}{MDNS\_DEFAULT\_IP\_TTL});
504          \textcolor{comment}{//Any error to report?}
505          \textcolor{keywordflow}{if}(error)
506             \textcolor{keywordflow}{break};
507 \textcolor{preprocessor}{#endif}
508 
509 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
510          \textcolor{comment}{//Select the relevant multicast address (ff02::fb)}
511          ipAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
512          ipAddr.\hyperlink{structIpAddr_a9bc2340a9c0bc5a0b8aa9695b74e2ee6}{ipv6Addr} = \hyperlink{mdns__common_8c_a74c29f24464b2cbb5c7754c264a462a2}{MDNS\_IPV6\_MULTICAST\_ADDR};
513 
514          \textcolor{comment}{//All multicast DNS queries should be sent with an IP TTL set to 255}
515          error = \hyperlink{udp_8c_a72a529f723ed1b75bfe98d0708f28eb1}{udpSendDatagramEx}(interface, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
      \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, &ipAddr,
516             \hyperlink{mdns__common_8h_ab16900c77e60e00f401b684c45a37c34}{MDNS\_PORT}, message->\hyperlink{structMdnsMessage_ad8fde78bc679ed4dd16b6bc6ad39b94d}{buffer}, message->\hyperlink{structMdnsMessage_a2d5521f923d6c184a8923827f3cdcc1e}{offset}, 
      \hyperlink{mdns__common_8h_a708ae6fdb21c434dcf809c0a05a56418}{MDNS\_DEFAULT\_IP\_TTL});
517          \textcolor{comment}{//Any error to report?}
518          \textcolor{keywordflow}{if}(error)
519             \textcolor{keywordflow}{break};
520 \textcolor{preprocessor}{#endif}
521       \}
522 
523       \textcolor{comment}{//End of exception handling block}
524    \} \textcolor{keywordflow}{while}(0);
525 
526    \textcolor{comment}{//Return status code}
527    \textcolor{keywordflow}{return} error;
528 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{mdns__common_8h_a74c29f24464b2cbb5c7754c264a462a2}\label{mdns__common_8h_a74c29f24464b2cbb5c7754c264a462a2}} 
\index{mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}!M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR@{M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}}
\index{M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR@{M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}!mdns\+\_\+common.\+h@{mdns\+\_\+common.\+h}}
\subsubsection{\texorpdfstring{M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}{MDNS\_IPV6\_MULTICAST\_ADDR}}
{\footnotesize\ttfamily const \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6\+Addr} M\+D\+N\+S\+\_\+\+I\+P\+V6\+\_\+\+M\+U\+L\+T\+I\+C\+A\+S\+T\+\_\+\+A\+D\+DR}



Definition at line 59 of file mdns\+\_\+common.\+c.

