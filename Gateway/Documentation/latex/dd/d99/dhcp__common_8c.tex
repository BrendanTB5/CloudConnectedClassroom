\hypertarget{dhcp__common_8c}{}\section{cyclone\+\_\+tcp/dhcp/dhcp\+\_\+common.c File Reference}
\label{dhcp__common_8c}\index{cyclone\+\_\+tcp/dhcp/dhcp\+\_\+common.\+c@{cyclone\+\_\+tcp/dhcp/dhcp\+\_\+common.\+c}}


Definitions common to D\+H\+CP client and server.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}dhcp/dhcp\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{dhcp__common_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ae1bb18d3ebb26b8de75fc6572f73f7e9}{D\+H\+C\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{dhcp__common_8c_ac73a9b66a20b04200f4457c70adb2503}{dhcp\+Add\+Option} (\hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{Dhcp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} option\+Code, const void $\ast$option\+Value, size\+\_\+t option\+Len)
\begin{DoxyCompactList}\small\item\em Append an option to a D\+H\+CP message. \end{DoxyCompactList}\item 
\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{Dhcp\+Option} $\ast$ \hyperlink{dhcp__common_8c_afbedc34152186d4b0a559cd1b97db456}{dhcp\+Get\+Option} (const \hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{Dhcp\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} option\+Code)
\begin{DoxyCompactList}\small\item\em Find the specified option in a D\+H\+CP message. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Definitions common to D\+H\+CP client and server. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{dhcp__common_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{dhcp__common_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ae1bb18d3ebb26b8de75fc6572f73f7e9}{D\+H\+C\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file dhcp\+\_\+common.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{dhcp__common_8c_ac73a9b66a20b04200f4457c70adb2503}\label{dhcp__common_8c_ac73a9b66a20b04200f4457c70adb2503}} 
\index{dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}!dhcp\+Add\+Option@{dhcp\+Add\+Option}}
\index{dhcp\+Add\+Option@{dhcp\+Add\+Option}!dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{dhcp\+Add\+Option()}{dhcpAddOption()}}
{\footnotesize\ttfamily void dhcp\+Add\+Option (\begin{DoxyParamCaption}\item[{\hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{Dhcp\+Message} $\ast$}]{message,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{option\+Code,  }\item[{const void $\ast$}]{option\+Value,  }\item[{size\+\_\+t}]{option\+Len }\end{DoxyParamCaption})}



Append an option to a D\+H\+CP message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the D\+H\+CP message \\
\hline
\mbox{\tt in}  & {\em option\+Code} & Option code \\
\hline
\mbox{\tt in}  & {\em option\+Value} & Option value \\
\hline
\mbox{\tt in}  & {\em option\+Len} & Length of the option value \\
\hline
\end{DoxyParams}


Definition at line 51 of file dhcp\+\_\+common.\+c.


\begin{DoxyCode}
53 \{
54    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
55    \hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *option;
56 
57    \textcolor{comment}{//Point to the very first option}
58    n = 0;
59 
60    \textcolor{comment}{//Parse DHCP options}
61    \textcolor{keywordflow}{while}(1)
62    \{
63       \textcolor{comment}{//Point to the current option}
64       option = (\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *) (\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + n);
65 
66       \textcolor{comment}{//End option detected?}
67       \textcolor{keywordflow}{if}(option->code == \hyperlink{dhcp__common_8h_a39fd6c3743d1905cdae40e0756a49c53a16551ffc10c9db2a717bb1514aaddf01}{DHCP\_OPT\_END})
68          \textcolor{keywordflow}{break};
69 
70       \textcolor{comment}{//Jump to next the next option}
71       n += \textcolor{keyword}{sizeof}(\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption}) + option->length;
72    \}
73 
74    \textcolor{comment}{//Sanity check}
75    \textcolor{keywordflow}{if}(optionLen <= \hyperlink{stdint_8h_aeb4e270a084ee26fe73e799861bd0252}{UINT8\_MAX})
76    \{
77       \textcolor{comment}{//Point to the buffer where the option is to be written}
78       option = (\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *) (\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + n);
79 
80       \textcolor{comment}{//Option code}
81       option->code = optionCode;
82       \textcolor{comment}{//Option length}
83       option->length = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) optionLen;
84       \textcolor{comment}{//Option value}
85       memcpy(option->value, optionValue, optionLen);
86 
87       \textcolor{comment}{//Jump to next the next option}
88       n += \textcolor{keyword}{sizeof}(\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption}) + option->length;
89 
90       \textcolor{comment}{//Point to the buffer where the option is to be written}
91       option = (\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *) (\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n});
92 
93       \textcolor{comment}{//Always terminate the options field with 255}
94       option->code = \hyperlink{dhcp__common_8h_a39fd6c3743d1905cdae40e0756a49c53a16551ffc10c9db2a717bb1514aaddf01}{DHCP\_OPT\_END};
95    \}
96 \}
\end{DoxyCode}
\mbox{\Hypertarget{dhcp__common_8c_afbedc34152186d4b0a559cd1b97db456}\label{dhcp__common_8c_afbedc34152186d4b0a559cd1b97db456}} 
\index{dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}!dhcp\+Get\+Option@{dhcp\+Get\+Option}}
\index{dhcp\+Get\+Option@{dhcp\+Get\+Option}!dhcp\+\_\+common.\+c@{dhcp\+\_\+common.\+c}}
\subsubsection{\texorpdfstring{dhcp\+Get\+Option()}{dhcpGetOption()}}
{\footnotesize\ttfamily \hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{Dhcp\+Option}$\ast$ dhcp\+Get\+Option (\begin{DoxyParamCaption}\item[{const \hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{Dhcp\+Message} $\ast$}]{message,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{option\+Code }\end{DoxyParamCaption})}



Find the specified option in a D\+H\+CP message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em message} & Pointer to the D\+H\+CP message \\
\hline
\mbox{\tt in}  & {\em length} & Length of the message \\
\hline
\mbox{\tt in}  & {\em option\+Code} & Code of the option to find \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
If the specified option is found, a pointer to the corresponding option is returned. Otherwise N\+U\+LL pointer is returned 
\end{DoxyReturn}


Definition at line 108 of file dhcp\+\_\+common.\+c.


\begin{DoxyCode}
110 \{
111    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
112    \hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *option;
113 
114    \textcolor{comment}{//Make sure the DHCP header is valid}
115    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < \textcolor{keyword}{sizeof}(\hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{DhcpMessage}))
116       \textcolor{keywordflow}{return} \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
117    \textcolor{comment}{//Get the length of the options field}
118    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{dhcp__common_8h_a7a679c72d82764f76bc4dea42a213e23}{DhcpMessage});
119 
120    \textcolor{comment}{//Parse DHCP options}
121    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i++)
122    \{
123       \textcolor{comment}{//Point to the current option}
124       option = (\hyperlink{dhcp__common_8h_acda8729e2d21674719c0fcd0b67489ca}{DhcpOption} *) (\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + i);
125 
126       \textcolor{comment}{//Pad option detected?}
127       \textcolor{keywordflow}{if}(option->code == \hyperlink{dhcp__common_8h_a39fd6c3743d1905cdae40e0756a49c53aff58b8712a95c99bf4813dddade27233}{DHCP\_OPT\_PAD})
128          \textcolor{keywordflow}{continue};
129       \textcolor{comment}{//End option detected?}
130       \textcolor{keywordflow}{if}(option->code == \hyperlink{dhcp__common_8h_a39fd6c3743d1905cdae40e0756a49c53a16551ffc10c9db2a717bb1514aaddf01}{DHCP\_OPT\_END})
131          \textcolor{keywordflow}{break};
132       \textcolor{comment}{//Check option length}
133       \textcolor{keywordflow}{if}((i + 1) >= length || (i + 1 + option->length) >= length)
134          \textcolor{keywordflow}{break};
135 
136       \textcolor{comment}{//Current option code matches the specified one?}
137       \textcolor{keywordflow}{if}(option->code == optionCode)
138          \textcolor{keywordflow}{return} option;
139 
140       \textcolor{comment}{//Jump to the next option}
141       i += option->length + 1;
142    \}
143 
144    \textcolor{comment}{//Specified option code not found}
145    \textcolor{keywordflow}{return} \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
146 \}
\end{DoxyCode}
