\hypertarget{ftp__client__transport_8c}{}\section{cyclone\+\_\+tcp/ftp/ftp\+\_\+client\+\_\+transport.c File Reference}
\label{ftp__client__transport_8c}\index{cyclone\+\_\+tcp/ftp/ftp\+\_\+client\+\_\+transport.\+c@{cyclone\+\_\+tcp/ftp/ftp\+\_\+client\+\_\+transport.\+c}}


Transport protocol abstraction layer.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+client\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ftp__client__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ae398facab6ce5126fa3b23996aafefa5}{F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_aaa807208fbb7ea7d5c66f81c672f6049}{ftp\+Client\+Open\+Channel} (\hyperlink{ftp__client_8h_a416e53a7e79ecd46ffcbeb50db323252}{Ftp\+Client\+Context} $\ast$context, \hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel, size\+\_\+t tx\+Buffer\+Size, size\+\_\+t rx\+Buffer\+Size)
\begin{DoxyCompactList}\small\item\em Open network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_a4b2ce1a2547da977bc2e8cef2c3bf733}{ftp\+Client\+Open\+Secure\+Channel} (\hyperlink{ftp__client_8h_a416e53a7e79ecd46ffcbeb50db323252}{Ftp\+Client\+Context} $\ast$context, \hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel, size\+\_\+t tx\+Buffer\+Size, size\+\_\+t rx\+Buffer\+Size)
\begin{DoxyCompactList}\small\item\em Open secure connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_abc76a2bf28a5663e909f042693b79fe0}{ftp\+Client\+Establish\+Secure\+Channel} (\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel)
\begin{DoxyCompactList}\small\item\em Establish secure connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_afa869ec7d2815eb9a74ed79022f10369}{ftp\+Client\+Shutdown\+Channel} (\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel)
\begin{DoxyCompactList}\small\item\em Shutdown network connection. \end{DoxyCompactList}\item 
void \hyperlink{ftp__client__transport_8c_afb29bfd2ee65af8f4526777355c3a171}{ftp\+Client\+Close\+Channel} (\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel)
\begin{DoxyCompactList}\small\item\em Close network connection. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_a24f702fa1973795506a38654502758dd}{ftp\+Client\+Write\+Channel} (\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, size\+\_\+t $\ast$written, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Send data using the relevant transport protocol. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{ftp__client__transport_8c_ab044b2eba7eac515c754805151d24176}{ftp\+Client\+Read\+Channel} (\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$channel, void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$received, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{nbns__common_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags})
\begin{DoxyCompactList}\small\item\em Receive data using the relevant transport protocol. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Transport protocol abstraction layer. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ftp__client__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ftp__client__transport_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ae398facab6ce5126fa3b23996aafefa5}{F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file ftp\+\_\+client\+\_\+transport.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ftp__client__transport_8c_afb29bfd2ee65af8f4526777355c3a171}\label{ftp__client__transport_8c_afb29bfd2ee65af8f4526777355c3a171}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Close\+Channel@{ftp\+Client\+Close\+Channel}}
\index{ftp\+Client\+Close\+Channel@{ftp\+Client\+Close\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Close\+Channel()}{ftpClientCloseChannel()}}
{\footnotesize\ttfamily void ftp\+Client\+Close\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel }\end{DoxyParamCaption})}



Close network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\end{DoxyParams}


Definition at line 229 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
230 \{
231 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
232    \textcolor{comment}{//Release TLS context}
233    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
234    \{
235       \hyperlink{tls_8c_aec8c1957ad13f5ad67d07a872d5fe66b}{tlsFree}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext});
236       channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
237    \}
238 \textcolor{preprocessor}{#endif}
239 
240    \textcolor{comment}{//Close TCP connection}
241    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
242    \{
243       \hyperlink{socket_8c_ac5012e9f71c97e2ea0410f2c5baccb0e}{socketClose}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket});
244       channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
245    \}
246 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_abc76a2bf28a5663e909f042693b79fe0}\label{ftp__client__transport_8c_abc76a2bf28a5663e909f042693b79fe0}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Establish\+Secure\+Channel@{ftp\+Client\+Establish\+Secure\+Channel}}
\index{ftp\+Client\+Establish\+Secure\+Channel@{ftp\+Client\+Establish\+Secure\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Establish\+Secure\+Channel()}{ftpClientEstablishSecureChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Establish\+Secure\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel }\end{DoxyParamCaption})}



Establish secure connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 174 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
175 \{
176 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
177    \textcolor{comment}{//Establish TLS connection}
178    \textcolor{keywordflow}{return} \hyperlink{tls_8c_a09ea66af9332cc10296020164428224e}{tlsConnect}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext});
179 \textcolor{preprocessor}{#else}
180    \textcolor{comment}{//Not implemented}
181    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
182 \textcolor{preprocessor}{#endif}
183 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_aaa807208fbb7ea7d5c66f81c672f6049}\label{ftp__client__transport_8c_aaa807208fbb7ea7d5c66f81c672f6049}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Open\+Channel@{ftp\+Client\+Open\+Channel}}
\index{ftp\+Client\+Open\+Channel@{ftp\+Client\+Open\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Open\+Channel()}{ftpClientOpenChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Open\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__client_8h_a416e53a7e79ecd46ffcbeb50db323252}{Ftp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel,  }\item[{size\+\_\+t}]{tx\+Buffer\+Size,  }\item[{size\+\_\+t}]{rx\+Buffer\+Size }\end{DoxyParamCaption})}



Open network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the F\+TP client context \\
\hline
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt in}  & {\em tx\+Buffer\+Size} & TX buffer size \\
\hline
\mbox{\tt in}  & {\em rx\+Buffer\+Size} & RX buffer size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 53 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
55 \{
56    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
57 
58    \textcolor{comment}{//Open a TCP socket}
59    channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket} = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a9dab003c4dc9f7279e806241534d4859}{SOCKET\_TYPE\_STREAM}, 
      \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969ae0f38a6f025bce7700b3cf0ddd04bb2a}{SOCKET\_IP\_PROTO\_TCP});
60    \textcolor{comment}{//Failed to open socket?}
61    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
62       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
63 
64    \textcolor{comment}{//Associate the socket with the relevant interface}
65    error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, context->interface);
66    \textcolor{comment}{//Any error to report?}
67    \textcolor{keywordflow}{if}(error)
68       \textcolor{keywordflow}{return} error;
69 
70    \textcolor{comment}{//Set timeout}
71    error = \hyperlink{socket_8c_abdd29ac0ba4a644c726f5b1280680099}{socketSetTimeout}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, context->timeout);
72    \textcolor{comment}{//Any error to report?}
73    \textcolor{keywordflow}{if}(error)
74       \textcolor{keywordflow}{return} error;
75 
76    \textcolor{comment}{//Specify the size of the send buffer}
77    error = \hyperlink{socket_8c_aedf25ddaf93caf6fb4a9e47dae20c831}{socketSetTxBufferSize}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, txBufferSize);
78    \textcolor{comment}{//Any error to report?}
79    \textcolor{keywordflow}{if}(error)
80       \textcolor{keywordflow}{return} error;
81 
82    \textcolor{comment}{//Specify the size of the receive buffer}
83    error = \hyperlink{socket_8c_ade5d61125056ad265723b44f236bdb20}{socketSetRxBufferSize}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, rxBufferSize);
84    \textcolor{comment}{//Any error to report?}
85    \textcolor{keywordflow}{if}(error)
86       \textcolor{keywordflow}{return} error;
87 
88    \textcolor{comment}{//Successful processing}
89    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
90 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_a4b2ce1a2547da977bc2e8cef2c3bf733}\label{ftp__client__transport_8c_a4b2ce1a2547da977bc2e8cef2c3bf733}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Open\+Secure\+Channel@{ftp\+Client\+Open\+Secure\+Channel}}
\index{ftp\+Client\+Open\+Secure\+Channel@{ftp\+Client\+Open\+Secure\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Open\+Secure\+Channel()}{ftpClientOpenSecureChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Open\+Secure\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__client_8h_a416e53a7e79ecd46ffcbeb50db323252}{Ftp\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel,  }\item[{size\+\_\+t}]{tx\+Buffer\+Size,  }\item[{size\+\_\+t}]{rx\+Buffer\+Size }\end{DoxyParamCaption})}



Open secure connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the F\+TP client context \\
\hline
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt in}  & {\em tx\+Buffer\+Size} & TX buffer size \\
\hline
\mbox{\tt in}  & {\em rx\+Buffer\+Size} & RX buffer size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 102 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
104 \{
105 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
106    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
107 
108    \textcolor{comment}{//Allocate TLS context}
109    channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} = \hyperlink{tls_8c_a5d34d9c0613c57d32b35692a86d5b04f}{tlsInit}();
110    \textcolor{comment}{//Failed to allocate TLS context?}
111    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
112       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
113 
114    \textcolor{comment}{//Select client operation mode}
115    error = \hyperlink{tls_8c_a8713543db673ee5a36b2fda92e082c6b}{tlsSetConnectionEnd}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, 
      \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT});
116    \textcolor{comment}{//Any error to report?}
117    \textcolor{keywordflow}{if}(error)
118       \textcolor{keywordflow}{return} error;
119 
120    \textcolor{comment}{//Bind TLS to the relevant socket}
121    error = \hyperlink{tls_8h_af918bec8cc034c91ae7cb14a4ab24103}{tlsSetSocket}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, channel->
      \hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket});
122    \textcolor{comment}{//Any error to report?}
123    \textcolor{keywordflow}{if}(error)
124       \textcolor{keywordflow}{return} error;
125 
126    \textcolor{comment}{//Set TX and RX buffer size}
127    error = \hyperlink{tls_8c_ac23d9d1f7d44e34b91e0dc56ee8cb95d}{tlsSetBufferSize}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, txBufferSize, rxBufferSize);
128    \textcolor{comment}{//Any error to report?}
129    \textcolor{keywordflow}{if}(error)
130       \textcolor{keywordflow}{return} error;
131 
132    \textcolor{comment}{//Data channel?}
133    \textcolor{keywordflow}{if}(channel == &context->dataChannel)
134    \{
135       \textcolor{comment}{//Save TLS session from control connection}
136       error = \hyperlink{tls_8c_a1685cfa2e5cd4b4d9a212201de0336f4}{tlsSaveSessionState}(context->controlChannel.tlsContext,
137          &context->tlsSession);
138       \textcolor{comment}{//Any error to report?}
139       \textcolor{keywordflow}{if}(error)
140          \textcolor{keywordflow}{return} error;
141    \}
142 
143    \textcolor{comment}{//Restore TLS session}
144    error = \hyperlink{tls_8c_a04094e358f18adc2d7ad8686e3258b93}{tlsRestoreSessionState}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, &context->tlsSession
      );
145    \textcolor{comment}{//Any error to report?}
146    \textcolor{keywordflow}{if}(error)
147       \textcolor{keywordflow}{return} error;
148 
149    \textcolor{comment}{//Invoke user-defined callback, if any}
150    \textcolor{keywordflow}{if}(context->tlsInitCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
151    \{
152       \textcolor{comment}{//Perform TLS related initialization}
153       error = context->tlsInitCallback(context, channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext});
154       \textcolor{comment}{//Any error to report?}
155       \textcolor{keywordflow}{if}(error)
156          \textcolor{keywordflow}{return} error;
157    \}
158 
159    \textcolor{comment}{//Successful processing}
160    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
161 \textcolor{preprocessor}{#else}
162    \textcolor{comment}{//Not implemented}
163    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
164 \textcolor{preprocessor}{#endif}
165 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_ab044b2eba7eac515c754805151d24176}\label{ftp__client__transport_8c_ab044b2eba7eac515c754805151d24176}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Read\+Channel@{ftp\+Client\+Read\+Channel}}
\index{ftp\+Client\+Read\+Channel@{ftp\+Client\+Read\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Read\+Channel()}{ftpClientReadChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Read\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel,  }\item[{void $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{received,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Receive data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt out}  & {\em data} & Buffer into which received data will be placed \\
\hline
\mbox{\tt in}  & {\em size} & Maximum number of bytes that can be received \\
\hline
\mbox{\tt out}  & {\em received} & Number of bytes that have been received \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 293 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
295 \{
296    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
297 
298 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
299    \textcolor{comment}{//TLS-secured connection?}
300    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
301    \{
302       \textcolor{comment}{//Receive TLS-encrypted data}
303       error = \hyperlink{tls_8c_a6aa09693d0cdc6e93d9b88a6331bc247}{tlsRead}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
304    \}
305    \textcolor{keywordflow}{else}
306 \textcolor{preprocessor}{#endif}
307    \{
308       \textcolor{comment}{//Receive data}
309       error = \hyperlink{socket_8c_a894c7bf0bfd4e3886fc584ed7ebbb087}{socketReceive}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size, received, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
310    \}
311 
312    \textcolor{comment}{//Return status code}
313    \textcolor{keywordflow}{return} error;
314 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_afa869ec7d2815eb9a74ed79022f10369}\label{ftp__client__transport_8c_afa869ec7d2815eb9a74ed79022f10369}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Shutdown\+Channel@{ftp\+Client\+Shutdown\+Channel}}
\index{ftp\+Client\+Shutdown\+Channel@{ftp\+Client\+Shutdown\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Shutdown\+Channel()}{ftpClientShutdownChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Shutdown\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel }\end{DoxyParamCaption})}



Shutdown network connection. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 192 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
193 \{
194    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
195 
196    \textcolor{comment}{//Initialize status code}
197    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
198 
199 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
200    \textcolor{comment}{//Valid TLS context?}
201    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
202    \{
203       \textcolor{comment}{//Shutdown TLS session}
204       error = \hyperlink{tls_8c_ae6a631703510008537d2cd97ab3425ef}{tlsShutdown}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext});
205    \}
206 \textcolor{preprocessor}{#endif}
207 
208    \textcolor{comment}{//Check status code}
209    \textcolor{keywordflow}{if}(!error)
210    \{
211       \textcolor{comment}{//Valid TCP socket?}
212       \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
213       \{
214          \textcolor{comment}{//Shutdown TCP connection}
215          error = \hyperlink{socket_8c_acc736b53dba4a0d3b11b63f75cdcfffb}{socketShutdown}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, 
      \hyperlink{socket_8h_a36ee33c18de64f549a6336d1aa7333b7a4c533f4b86ea89dfd6a508bb4262c76d}{SOCKET\_SD\_BOTH});
216       \}
217    \}
218 
219    \textcolor{comment}{//Return status code}
220    \textcolor{keywordflow}{return} error;
221 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__client__transport_8c_a24f702fa1973795506a38654502758dd}\label{ftp__client__transport_8c_a24f702fa1973795506a38654502758dd}} 
\index{ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}!ftp\+Client\+Write\+Channel@{ftp\+Client\+Write\+Channel}}
\index{ftp\+Client\+Write\+Channel@{ftp\+Client\+Write\+Channel}!ftp\+\_\+client\+\_\+transport.\+c@{ftp\+\_\+client\+\_\+transport.\+c}}
\subsubsection{\texorpdfstring{ftp\+Client\+Write\+Channel()}{ftpClientWriteChannel()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ftp\+Client\+Write\+Channel (\begin{DoxyParamCaption}\item[{\hyperlink{structFtpClientChannel}{Ftp\+Client\+Channel} $\ast$}]{channel,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t $\ast$}]{written,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{flags }\end{DoxyParamCaption})}



Send data using the relevant transport protocol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em channel} & Control or data channel \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to a buffer containing the data to be transmitted \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes to be transmitted \\
\hline
\mbox{\tt out}  & {\em written} & Actual number of bytes written (optional parameter) \\
\hline
\mbox{\tt in}  & {\em flags} & Set of flags that influences the behavior of this function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 259 of file ftp\+\_\+client\+\_\+transport.\+c.


\begin{DoxyCode}
261 \{
262    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
263 
264 \textcolor{preprocessor}{#if (FTP\_CLIENT\_TLS\_SUPPORT == ENABLED)}
265    \textcolor{comment}{//TLS-secured connection?}
266    \textcolor{keywordflow}{if}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
267    \{
268       \textcolor{comment}{//Send TLS-encrypted data}
269       error = \hyperlink{tls_8c_a1b4b22502217a601f7f094403e700b4b}{tlsWrite}(channel->\hyperlink{structFtpClientChannel_aac12ca144cff862f259dbb77ee84d9be}{tlsContext}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
270    \}
271    \textcolor{keywordflow}{else}
272 \textcolor{preprocessor}{#endif}
273    \{
274       \textcolor{comment}{//Transmit data}
275       error = \hyperlink{socket_8c_aa4eeb3a3294d14d681675ba9f0d3e568}{socketSend}(channel->\hyperlink{structFtpClientChannel_a41c50a1a7b2155a449f0c2b495563de1}{socket}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, written, 
      \hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags});
276    \}
277 
278    \textcolor{comment}{//Return status code}
279    \textcolor{keywordflow}{return} error;
280 \}
\end{DoxyCode}
