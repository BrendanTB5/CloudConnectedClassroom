\hypertarget{nmasic_8c}{}\section{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmasic.c File Reference}
\label{nmasic_8c}\index{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmasic.\+c@{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmasic.\+c}}


This module contains W\+I\+LC A\+S\+IC specific internal A\+P\+Is.  


{\ttfamily \#include \char`\"{}driver/source/nmbus.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp/include/nm\+\_\+bsp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}driver/source/nmasic.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0}~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x400)
\item 
\#define \hyperlink{nmasic_8c_a659055c215227f5d711c44a6e8cd7d05}{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1}~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x404)
\item 
\#define \hyperlink{nmasic_8c_a3c63d55f6a016b085bbdc2c8c61f60a5}{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}+0xa00)
\item 
\#define \hyperlink{nmasic_8c_adc0c409aa807f45de29d12ed6c356ba0}{N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0}~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x408)
\item 
\#define \hyperlink{nmasic_8c_ac168a3821e02ce17b38192dced94bf28}{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE}~(\hyperlink{nmasic_8c_a3c63d55f6a016b085bbdc2c8c61f60a5}{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE})
\item 
\#define \hyperlink{nmasic_8c_acca244061db9f298d61975163169fb24}{G\+E\+T\+\_\+\+U\+I\+N\+T32}(X,  Y)~(X\mbox{[}0+Y\mbox{]} + ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}1+Y\mbox{]}$<$$<$8) + ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}2+Y\mbox{]}$<$$<$16) +((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}3+Y\mbox{]}$<$$<$24))
\item 
\#define \hyperlink{nmasic_8c_a45ba202b05caf39795aeca91b0ae547e}{T\+I\+M\+E\+O\+UT}~(2000)
\item 
\#define \hyperlink{nmasic_8c_a041fc16e321a3e5fca0c7a58a1974874}{M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS}~0x\+D0\+UL
\item 
\#define \hyperlink{nmasic_8c_a076e0b2fe33a5cbf2689309c34d14016}{W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT}~(10000)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{nmasic_8c_a4ad0396d26275afe21aa2f1f96ae0223}{chip\+\_\+idle} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_af3c5f659f6097d385b50070d4c67fa11}{enable\+\_\+interrupts} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a271a40a292bea52b7b7223738d38d971}{cpu\+\_\+start} (void)
\item 
\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} \hyperlink{nmasic_8c_acc2bfddab3c6641f911ec910d0c2de4f}{nmi\+\_\+get\+\_\+rfrevid} (void)
\item 
void \hyperlink{nmasic_8c_a61fc61a0bf04e075653a3723b4265f19}{restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset} (void)
\item 
void \hyperlink{nmasic_8c_abe3f27561e740f3081472077c2ef78dc}{nmi\+\_\+update\+\_\+pll} (void)
\item 
void \hyperlink{nmasic_8c_a851e84ae0532e94fa356586e0a4fed81}{nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a624e7923184968631a2eb86938d6f3ba}{chip\+\_\+sleep} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_abe05d6f4afa80ace3bd105d63dceda52}{chip\+\_\+wake} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a6a4516bd3101cf65fa64750b98a9a9b9}{chip\+\_\+reset} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a40dd2b726ea75385c90df269f69658f9}{firmware\+\_\+download} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a12d3b4ba49cbe3075b6ecbfe9fb58d4c}{wait\+\_\+for\+\_\+firmware\+\_\+start} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a56e8f10481e53eb5895a15b565f0a40e}{chip\+\_\+deinit} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a9b177001fb5ca10ae842172a684b3f03}{set\+\_\+gpio\+\_\+dir} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} gpio, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} dir)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a7e7f347b408b7d6a05470944bf2f02a6}{set\+\_\+gpio\+\_\+val} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} gpio, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} val)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a3b1a37d1bec560f7b1c5d7f10a7bd193}{get\+\_\+gpio\+\_\+val} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} gpio, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$val)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a35648e4a684b559e78010397691cbd46}{pullup\+\_\+ctrl} (\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} pinmask, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} enable)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a0c4efee10a9beb884eccce4806db78e5}{nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Mac\+Addr, \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Is\+Valid)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_a8efc5d93ac1e9d1acca8761ce4d8eb97}{nmi\+\_\+get\+\_\+mac\+\_\+address} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$pu8\+Mac\+Addr)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmasic_8c_afef9b862e9c9e2069a2092e752ed7f67}{is\+\_\+valid\+\_\+gpio} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} gpio)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This module contains W\+I\+LC A\+S\+IC specific internal A\+P\+Is. 

Copyright (c) 2016-\/2018 Microchip Technology Inc. and its subsidiaries.

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{nmasic_8c_acca244061db9f298d61975163169fb24}\label{nmasic_8c_acca244061db9f298d61975163169fb24}} 
\index{nmasic.\+c@{nmasic.\+c}!G\+E\+T\+\_\+\+U\+I\+N\+T32@{G\+E\+T\+\_\+\+U\+I\+N\+T32}}
\index{G\+E\+T\+\_\+\+U\+I\+N\+T32@{G\+E\+T\+\_\+\+U\+I\+N\+T32}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{G\+E\+T\+\_\+\+U\+I\+N\+T32}{GET\_UINT32}}
{\footnotesize\ttfamily \#define G\+E\+T\+\_\+\+U\+I\+N\+T32(\begin{DoxyParamCaption}\item[{}]{X,  }\item[{}]{Y }\end{DoxyParamCaption})~(X\mbox{[}0+Y\mbox{]} + ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}1+Y\mbox{]}$<$$<$8) + ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}2+Y\mbox{]}$<$$<$16) +((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32})X\mbox{[}3+Y\mbox{]}$<$$<$24))}



Definition at line 47 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a041fc16e321a3e5fca0c7a58a1974874}\label{nmasic_8c_a041fc16e321a3e5fca0c7a58a1974874}} 
\index{nmasic.\+c@{nmasic.\+c}!M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS@{M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS}}
\index{M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS@{M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS}{M2M\_DISABLE\_PS}}
{\footnotesize\ttfamily \#define M2\+M\+\_\+\+D\+I\+S\+A\+B\+L\+E\+\_\+\+PS~0x\+D0\+UL}



Definition at line 50 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}\label{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}} 
\index{nmasic.\+c@{nmasic.\+c}!N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0@{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0}}
\index{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0@{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0}{NMI\_GLB\_RESET\_0}}
{\footnotesize\ttfamily \#define N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+0~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x400)}



Definition at line 42 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a659055c215227f5d711c44a6e8cd7d05}\label{nmasic_8c_a659055c215227f5d711c44a6e8cd7d05}} 
\index{nmasic.\+c@{nmasic.\+c}!N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1@{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1}}
\index{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1@{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1}{NMI\_GLB\_RESET\_1}}
{\footnotesize\ttfamily \#define N\+M\+I\+\_\+\+G\+L\+B\+\_\+\+R\+E\+S\+E\+T\+\_\+1~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x404)}



Definition at line 43 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_ac168a3821e02ce17b38192dced94bf28}\label{nmasic_8c_ac168a3821e02ce17b38192dced94bf28}} 
\index{nmasic.\+c@{nmasic.\+c}!N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE@{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE}}
\index{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE@{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE}{NMI\_INTR\_ENABLE}}
{\footnotesize\ttfamily \#define N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+E\+N\+A\+B\+LE~(\hyperlink{nmasic_8c_a3c63d55f6a016b085bbdc2c8c61f60a5}{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE})}



Definition at line 46 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a3c63d55f6a016b085bbdc2c8c61f60a5}\label{nmasic_8c_a3c63d55f6a016b085bbdc2c8c61f60a5}} 
\index{nmasic.\+c@{nmasic.\+c}!N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE@{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}}
\index{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE@{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}{NMI\_INTR\_REG\_BASE}}
{\footnotesize\ttfamily \#define N\+M\+I\+\_\+\+I\+N\+T\+R\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE}+0xa00)}



Definition at line 44 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_adc0c409aa807f45de29d12ed6c356ba0}\label{nmasic_8c_adc0c409aa807f45de29d12ed6c356ba0}} 
\index{nmasic.\+c@{nmasic.\+c}!N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0@{N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0}}
\index{N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0@{N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0}{NMI\_PIN\_MUX\_0}}
{\footnotesize\ttfamily \#define N\+M\+I\+\_\+\+P\+I\+N\+\_\+\+M\+U\+X\+\_\+0~(\hyperlink{nmasic_8h_a6e1d848a7f388e501b140d35f81bbd9b}{N\+M\+I\+\_\+\+P\+E\+R\+I\+P\+H\+\_\+\+R\+E\+G\+\_\+\+B\+A\+SE} + 0x408)}



Definition at line 45 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a45ba202b05caf39795aeca91b0ae547e}\label{nmasic_8c_a45ba202b05caf39795aeca91b0ae547e}} 
\index{nmasic.\+c@{nmasic.\+c}!T\+I\+M\+E\+O\+UT@{T\+I\+M\+E\+O\+UT}}
\index{T\+I\+M\+E\+O\+UT@{T\+I\+M\+E\+O\+UT}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{T\+I\+M\+E\+O\+UT}{TIMEOUT}}
{\footnotesize\ttfamily \#define T\+I\+M\+E\+O\+UT~(2000)}



Definition at line 49 of file nmasic.\+c.

\mbox{\Hypertarget{nmasic_8c_a076e0b2fe33a5cbf2689309c34d14016}\label{nmasic_8c_a076e0b2fe33a5cbf2689309c34d14016}} 
\index{nmasic.\+c@{nmasic.\+c}!W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT@{W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT}}
\index{W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT@{W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT}{WAKUP\_TRAILS\_TIMEOUT}}
{\footnotesize\ttfamily \#define W\+A\+K\+U\+P\+\_\+\+T\+R\+A\+I\+L\+S\+\_\+\+T\+I\+M\+E\+O\+UT~(10000)}



Definition at line 51 of file nmasic.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{nmasic_8c_a56e8f10481e53eb5895a15b565f0a40e}\label{nmasic_8c_a56e8f10481e53eb5895a15b565f0a40e}} 
\index{nmasic.\+c@{nmasic.\+c}!chip\+\_\+deinit@{chip\+\_\+deinit}}
\index{chip\+\_\+deinit@{chip\+\_\+deinit}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+deinit()}{chip\_deinit()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} chip\+\_\+deinit (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

stop the firmware, need a re-\/download

Definition at line 629 of file nmasic.\+c.


\begin{DoxyCode}
630 \{
631     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg = 0;
632     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
633     \hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} timeout = 10;
634 
638     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, &reg);
639     \textcolor{keywordflow}{if} (ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
640         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"failed to de-initialize\(\backslash\)r\(\backslash\)n"});
641     \}
642     reg &= ~(1 << 10);
643     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, reg);
644 
645     \textcolor{keywordflow}{if} (ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
646         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Error while writing reg\(\backslash\)r\(\backslash\)n"});
647         \textcolor{keywordflow}{return} ret;
648     \}
649 
650     \textcolor{keywordflow}{do} \{
651         ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, &reg);
652         \textcolor{keywordflow}{if} (ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
653             \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Error while reading reg\(\backslash\)r\(\backslash\)n"});
654             \textcolor{keywordflow}{return} ret;
655         \}
656         \textcolor{comment}{/*Workaround to ensure that the chip is actually reset*/}
657         \textcolor{keywordflow}{if} ((reg & (1 << 10))) \{
658             \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"Bit 10 not reset retry %d\(\backslash\)r\(\backslash\)n"}, timeout);
659             reg &= ~(1 << 10);
660             ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, reg);
661             timeout--;
662         \} \textcolor{keywordflow}{else} \{
663             \textcolor{keywordflow}{break};
664         \}
665 
666     \} \textcolor{keywordflow}{while} (timeout);
667     
668     \textcolor{keywordflow}{return} ret;     
669 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a4ad0396d26275afe21aa2f1f96ae0223}\label{nmasic_8c_a4ad0396d26275afe21aa2f1f96ae0223}} 
\index{nmasic.\+c@{nmasic.\+c}!chip\+\_\+idle@{chip\+\_\+idle}}
\index{chip\+\_\+idle@{chip\+\_\+idle}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+idle()}{chip\_idle()}}
{\footnotesize\ttfamily void chip\+\_\+idle (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 53 of file nmasic.\+c.


\begin{DoxyCode}
54 \{
55     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg =0;
56     \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_WAKEUP\_REG, &reg);
57     \textcolor{keywordflow}{if}(reg & WILC\_WAKEUP\_BIT)
58     \{
59         reg &=~WILC\_WAKEUP\_BIT;
60         \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(WILC\_WAKEUP\_REG, reg);
61     \}
62 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a6a4516bd3101cf65fa64750b98a9a9b9}\label{nmasic_8c_a6a4516bd3101cf65fa64750b98a9a9b9}} 
\index{nmasic.\+c@{nmasic.\+c}!chip\+\_\+reset@{chip\+\_\+reset}}
\index{chip\+\_\+reset@{chip\+\_\+reset}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+reset()}{chip\_reset()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} chip\+\_\+reset (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 428 of file nmasic.\+c.


\begin{DoxyCode}
429 \{
430     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
431     
432     \hyperlink{nmasic_8c_a851e84ae0532e94fa356586e0a4fed81}{nmi\_set\_sys\_clk\_src\_to\_xo}();
433 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SPI}
434     ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, 0);
435 \textcolor{preprocessor}{#elif defined CONF\_WILC\_USE\_SDIO}
436  \textcolor{comment}{/* Don't reset the SDIO modules*/}
437     ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, 0x80000301);
438     ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a659055c215227f5d711c44a6e8cd7d05}{NMI\_GLB\_RESET\_1}, 0xFFFFFFFF);
439 \textcolor{preprocessor}{#endif}
440     \hyperlink{group__NmBspSleepFn_gadbf38ddf0138d8e0a4e4720909a7b081}{nm\_bsp\_sleep}(50);
441     \hyperlink{nmasic_8c_a61fc61a0bf04e075653a3723b4265f19}{restore\_pmu\_settings\_after\_global\_reset}();
442 
443     \textcolor{keywordflow}{return} ret;
444 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a624e7923184968631a2eb86938d6f3ba}\label{nmasic_8c_a624e7923184968631a2eb86938d6f3ba}} 
\index{nmasic.\+c@{nmasic.\+c}!chip\+\_\+sleep@{chip\+\_\+sleep}}
\index{chip\+\_\+sleep@{chip\+\_\+sleep}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+sleep()}{chip\_sleep()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} chip\+\_\+sleep (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 340 of file nmasic.\+c.


\begin{DoxyCode}
341 \{
342     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg;
343     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
344     
345 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_1000\_REV\_B}
346     \textcolor{keywordflow}{while}(1)
347     \{
348         ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_TO\_INTERFACE\_FROM\_WF\_REG,&reg);
349         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} ERR1;
350         \textcolor{keywordflow}{if}((reg & WILC\_TO\_INTERFACE\_FROM\_WF\_BIT) == 0) \textcolor{keywordflow}{break};
351     \}
352 \textcolor{preprocessor}{#endif}
353     \textcolor{comment}{/* Clear bit 1 */}
354     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_WAKEUP\_REG, &reg);
355     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
356     \textcolor{keywordflow}{if}(reg & WILC\_WAKEUP\_BIT)
357     \{
358         reg &=~WILC\_WAKEUP\_BIT;
359         ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(WILC\_WAKEUP\_REG, reg);
360         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
361     \}
362 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_1000\_REV\_B}
363     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_FROM\_INTERFACE\_TO\_WF\_REG, &reg);
364     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
365     \textcolor{keywordflow}{if}(reg & WILC\_FROM\_INTERFACE\_TO\_WF\_BIT)
366     \{
367         reg &= ~WILC\_FROM\_INTERFACE\_TO\_WF\_BIT;
368         ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(WILC\_FROM\_INTERFACE\_TO\_WF\_REG, reg);
369         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} ERR1;
370     \}
371 \textcolor{preprocessor}{#endif}
372 ERR1:
373     \textcolor{keywordflow}{return} ret;
374 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_abe05d6f4afa80ace3bd105d63dceda52}\label{nmasic_8c_abe05d6f4afa80ace3bd105d63dceda52}} 
\index{nmasic.\+c@{nmasic.\+c}!chip\+\_\+wake@{chip\+\_\+wake}}
\index{chip\+\_\+wake@{chip\+\_\+wake}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+wake()}{chip\_wake()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} chip\+\_\+wake (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 376 of file nmasic.\+c.


\begin{DoxyCode}
377 \{
378     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
379     \textcolor{keyword}{volatile} \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg = 0, clk\_status\_reg = 0,trials = 0;
380 
381 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_1000\_REV\_B}
382     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_FROM\_INTERFACE\_TO\_WF\_REG, (
      \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}*)&reg);
383     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} \_WAKE\_EXIT;
384     
385     \textcolor{keywordflow}{if}(!(reg & WILC\_FROM\_INTERFACE\_TO\_WF\_BIT))
386     \{
387         \textcolor{comment}{/*USE bit 0 to indicate host wakeup*/}
388         ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(WILC\_FROM\_INTERFACE\_TO\_WF\_REG, reg|WILC\_FROM\_INTERFACE\_TO\_WF\_BIT);
389         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} \_WAKE\_EXIT;
390     \}
391 \textcolor{preprocessor}{#endif}
392     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_WAKEUP\_REG, (\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}*)&reg);
393     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})\textcolor{keywordflow}{goto} \_WAKE\_EXIT;
394     \textcolor{comment}{/* Set bit 1 */}
395     \textcolor{keywordflow}{if}(!(reg & WILC\_WAKEUP\_BIT))
396     \{
397         ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(WILC\_WAKEUP\_REG, reg | WILC\_WAKEUP\_BIT);
398         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_WAKE\_EXIT;  
399     \}
400 
401     \textcolor{keywordflow}{do}
402     \{
403         ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(WILC\_CLK\_STATUS\_REG, (
      \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}*)&clk\_status\_reg);
404         \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
405             \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Bus error (5).%d %lx\(\backslash\)r\(\backslash\)n"},ret,clk\_status\_reg);
406             \textcolor{keywordflow}{goto} \_WAKE\_EXIT;
407         \}
408         \textcolor{keywordflow}{if}(clk\_status\_reg & WILC\_CLK\_STATUS\_BIT) \{
409             \textcolor{keywordflow}{break};
410         \}
411         \textcolor{comment}{//nm\_bsp\_sleep(2);}
412         trials++;
413         \textcolor{keywordflow}{if}(trials > \hyperlink{nmasic_8c_a076e0b2fe33a5cbf2689309c34d14016}{WAKUP\_TRAILS\_TIMEOUT})
414         \{
415             \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Failed to wakup the chip\(\backslash\)r\(\backslash\)n"});
416             ret = \hyperlink{nm__common_8h_ab3b877e1aa11d17e057666d471761eb3}{M2M\_ERR\_TIME\_OUT};
417             \textcolor{keywordflow}{goto} \_WAKE\_EXIT;
418         \}
419     \}\textcolor{keywordflow}{while}(1);
420     
421     \textcolor{comment}{/*workaround sometimes spi fail to read clock regs after reading/writing clockless registers*/}
422     \hyperlink{nmbus_8c_a47e65a88a8262359d46de3cb869f481e}{nm\_bus\_reset}();
423     
424 \_WAKE\_EXIT:
425     \textcolor{keywordflow}{return} ret;
426 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a271a40a292bea52b7b7223738d38d971}\label{nmasic_8c_a271a40a292bea52b7b7223738d38d971}} 
\index{nmasic.\+c@{nmasic.\+c}!cpu\+\_\+start@{cpu\+\_\+start}}
\index{cpu\+\_\+start@{cpu\+\_\+start}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{cpu\+\_\+start()}{cpu\_start()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} cpu\+\_\+start (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

reset regs

Go...

Definition at line 95 of file nmasic.\+c.


\begin{DoxyCode}
95                       \{
96     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
97     
98 \textcolor{preprocessor}{#ifndef CONF\_WILC\_FW\_IN\_FLASH}
99     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg;
103     \textcolor{comment}{/*disable boot rom*/}
104     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0xc0000, 0x71);
105     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_aa3430c78051380c7829522bd94d8657d}{NMI\_STATE\_REG},0);
106     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_abe6eafe9e15a953b72dc1ccb894f175c}{NMI\_REV\_REG},0);
107     
111     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x1118, &reg);
112     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
113         ret = \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
114         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[nmi start]: fail read reg 0x1118 ...\(\backslash\)r\(\backslash\)n"});
115     \}
116     reg |= (1 << 0);
117     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1118, reg);
118 \textcolor{preprocessor}{#if defined CONF\_WILC\_USE\_SPI}
119     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_a559f29b45df9b3535908f99a71df00bf}{NMI\_VMM\_CORE\_CFG}, 1);
120 \textcolor{preprocessor}{#elif defined CONF\_WILC\_USE\_SDIO}
121     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_a559f29b45df9b3535908f99a71df00bf}{NMI\_VMM\_CORE\_CFG}, (1 << 3));
122 \textcolor{preprocessor}{#endif}
123     ret += \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, &reg);
124     \textcolor{keywordflow}{if} ((reg & (1ul << 10)) == (1ul << 10)) \{
125         reg &= ~(1ul << 10);
126         ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, reg);
127     \}
128 
129     reg |= (1ul << 10);
130     ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_a60689e89d394fd70b048383a0a3cb6fa}{NMI\_GLB\_RESET\_0}, reg);
131     \hyperlink{group__NmBspSleepFn_gadbf38ddf0138d8e0a4e4720909a7b081}{nm\_bsp\_sleep}(1); \textcolor{comment}{/* TODO: Why bus error if this delay is not here. */}
132 \textcolor{preprocessor}{#else}
133     
134 \textcolor{preprocessor}{    #if defined CONF\_WILC\_USE\_SPI}
135     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_a559f29b45df9b3535908f99a71df00bf}{NMI\_VMM\_CORE\_CFG}, 1);
136 \textcolor{preprocessor}{    #elif defined CONF\_WILC\_USE\_SDIO}
137     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_a559f29b45df9b3535908f99a71df00bf}{NMI\_VMM\_CORE\_CFG}, (1 << 3));
138 \textcolor{preprocessor}{    #endif}
139 
140 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* CONF\_WILC\_FW\_IN\_FLASH */}\textcolor{preprocessor}{}
141     \textcolor{keywordflow}{return} ret;
142 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_af3c5f659f6097d385b50070d4c67fa11}\label{nmasic_8c_af3c5f659f6097d385b50070d4c67fa11}} 
\index{nmasic.\+c@{nmasic.\+c}!enable\+\_\+interrupts@{enable\+\_\+interrupts}}
\index{enable\+\_\+interrupts@{enable\+\_\+interrupts}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{enable\+\_\+interrupts()}{enable\_interrupts()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} enable\+\_\+interrupts (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

interrupt pin mux select

interrupt enable

Definition at line 64 of file nmasic.\+c.


\begin{DoxyCode}
65 \{
66     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg;
67     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
71     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8c_adc0c409aa807f45de29d12ed6c356ba0}{NMI\_PIN\_MUX\_0}, &reg);
72     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
73         \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
74     \}
75     reg |= ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}) 1 << 8);
76     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_adc0c409aa807f45de29d12ed6c356ba0}{NMI\_PIN\_MUX\_0}, reg);
77     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
78         \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
79     \}
83     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8c_ac168a3821e02ce17b38192dced94bf28}{NMI\_INTR\_ENABLE}, &reg);
84     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
85         \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
86     \}
87     reg |= ((\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}) 1 << 16);
88     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8c_ac168a3821e02ce17b38192dced94bf28}{NMI\_INTR\_ENABLE}, reg);
89     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
90         \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a1337ea19161996276a331dc168c6b24b}{M2M\_ERR\_BUS\_FAIL};
91     \}
92     \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
93 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a40dd2b726ea75385c90df269f69658f9}\label{nmasic_8c_a40dd2b726ea75385c90df269f69658f9}} 
\index{nmasic.\+c@{nmasic.\+c}!firmware\+\_\+download@{firmware\+\_\+download}}
\index{firmware\+\_\+download@{firmware\+\_\+download}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{firmware\+\_\+download()}{firmware\_download()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} firmware\+\_\+download (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 464 of file nmasic.\+c.


\begin{DoxyCode}
465 \{
466     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} s8Ret;
467     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} u32SecSize, u32SecAddress, u32Val;
468     \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}* pu8FirmwareBuffer;
469     \hyperlink{group__DataT_ga426bf55104d8fb3f624c1fc4cd5f2d29}{sint32} BuffIndex = 0, CurrentSecSize = 0;
470     \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} u8TransferChunk[32], ChunkSize = 32;
471     
472     \textcolor{comment}{/* Set Mux Select for Wifi CPU Reset */}
473     s8Ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x1118, &u32Val);
474     u32Val |= 1;
475     s8Ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1118, u32Val);
476     
477     \textcolor{comment}{/* Assert CPU reset */}
478     s8Ret += \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x1400, &u32Val);
479     u32Val &= ~(1ul << 10);
480     s8Ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1400, u32Val);
481 
482     \textcolor{comment}{/* Boot from IRAM, not ROM*/}
483     s8Ret += \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0xc0000,0x71);
484 
485     \textcolor{keywordflow}{if}(s8Ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS})
486         \textcolor{keywordflow}{goto} ERR;
487 
488     pu8FirmwareBuffer = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *)firmware;
489     \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"firmware size = %d\(\backslash\)r\(\backslash\)n"},\textcolor{keyword}{sizeof}(firmware));
490 
491     \textcolor{keywordflow}{while}((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})pu8FirmwareBuffer < (\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(firmware+\textcolor{keyword}{sizeof}(firmware)))
492     \{       
493         \textcolor{comment}{/*get text section address and size*/}   
494         u32SecAddress   = (((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[3]))<<24)|(((
      \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[2]))<<16)|
495         (((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[1]))<<8)|(((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[0]))<<0);
496         u32SecSize  = (((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[7]))<<24)|(((
      \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[6]))<<16)|
497         (((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[5]))<<8)|(((\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t})(pu8FirmwareBuffer[4]))<<0);
498         \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"write sec %lx size %lu\(\backslash\)r\(\backslash\)n"},u32SecAddress,u32SecSize);
499         CurrentSecSize = u32SecSize;        
500         ChunkSize = 32;
501         BuffIndex = 8;
502         \textcolor{keywordflow}{while}(CurrentSecSize>0)
503         \{
504             \textcolor{keywordflow}{if}(CurrentSecSize < ChunkSize)
505                 ChunkSize = CurrentSecSize;
506             
507             \hyperlink{nm__common_8h_a62b30b611dfcc58e190254d1f663470a}{m2m\_memcpy}(u8TransferChunk,pu8FirmwareBuffer+BuffIndex,ChunkSize);
508             \hyperlink{nmbus_8c_afb924df7f944a8137cd51069512661cf}{nm\_write\_block}(u32SecAddress,u8TransferChunk,ChunkSize);
509             u32SecAddress += ChunkSize;
510             BuffIndex += ChunkSize;
511             CurrentSecSize -= ChunkSize;
512         \}       
513         pu8FirmwareBuffer += BuffIndex;
514         
515     \}   
516     
517 ERR:
518     \textcolor{keywordflow}{return} s8Ret;
519 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a3b1a37d1bec560f7b1c5d7f10a7bd193}\label{nmasic_8c_a3b1a37d1bec560f7b1c5d7f10a7bd193}} 
\index{nmasic.\+c@{nmasic.\+c}!get\+\_\+gpio\+\_\+val@{get\+\_\+gpio\+\_\+val}}
\index{get\+\_\+gpio\+\_\+val@{get\+\_\+gpio\+\_\+val}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{get\+\_\+gpio\+\_\+val()}{get\_gpio\_val()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} get\+\_\+gpio\+\_\+val (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{gpio,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{val }\end{DoxyParamCaption})}



Definition at line 710 of file nmasic.\+c.


\begin{DoxyCode}
711 \{
712     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
713     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
714 
715     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x20104, &val32);
716     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_EXIT;
717     
718     *val = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})((val32 >> gpio) & 0x01);
719 
720 \_EXIT:
721     \textcolor{keywordflow}{return} ret;
722 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_afef9b862e9c9e2069a2092e752ed7f67}\label{nmasic_8c_afef9b862e9c9e2069a2092e752ed7f67}} 
\index{nmasic.\+c@{nmasic.\+c}!is\+\_\+valid\+\_\+gpio@{is\+\_\+valid\+\_\+gpio}}
\index{is\+\_\+valid\+\_\+gpio@{is\+\_\+valid\+\_\+gpio}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{is\+\_\+valid\+\_\+gpio()}{is\_valid\_gpio()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} is\+\_\+valid\+\_\+gpio (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{gpio }\end{DoxyParamCaption})}



Definition at line 790 of file nmasic.\+c.


\begin{DoxyCode}
791 \{
792 \textcolor{preprocessor}{#if defined(CONF\_WILC\_USE\_1000\_REV\_B)}
793     \textcolor{keywordflow}{return} (gpio == 0 || gpio == 1 || gpio == 3 || gpio == 4 || gpio == 6);
794 \textcolor{preprocessor}{#elif defined(CONF\_WILC\_USE\_3000\_REV\_A)}
795     \textcolor{keywordflow}{return} (gpio == 0 || gpio == 3 || gpio == 4 ||gpio == 6 ||
796         (gpio >= 17 && gpio <= 20));
797 \textcolor{preprocessor}{#else}
798     \textcolor{keywordflow}{return} 0;
799 \textcolor{preprocessor}{#endif}
800 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a8efc5d93ac1e9d1acca8761ce4d8eb97}\label{nmasic_8c_a8efc5d93ac1e9d1acca8761ce4d8eb97}} 
\index{nmasic.\+c@{nmasic.\+c}!nmi\+\_\+get\+\_\+mac\+\_\+address@{nmi\+\_\+get\+\_\+mac\+\_\+address}}
\index{nmi\+\_\+get\+\_\+mac\+\_\+address@{nmi\+\_\+get\+\_\+mac\+\_\+address}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{nmi\+\_\+get\+\_\+mac\+\_\+address()}{nmi\_get\_mac\_address()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nmi\+\_\+get\+\_\+mac\+\_\+address (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Mac\+Addr }\end{DoxyParamCaption})}



Definition at line 772 of file nmasic.\+c.


\begin{DoxyCode}
773 \{
774     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
775     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}    u32RegValue;
776     
777     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8h_abeb2c5a422e7240315ae32df5aaa3c93}{rNMI\_GP\_REG\_0}, &u32RegValue);
778     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_EXIT\_ERR;
779 
780     \textcolor{comment}{/*WILCBARESW-69*/}
781     u32RegValue &=0x0000ffff;
782     \hyperlink{nmbus_8c_af1e8ce2caa79fdd112216a9f36f103a0}{nm\_read\_block}(u32RegValue|0x30000, pu8MacAddr, 12);
783     
784     \textcolor{keywordflow}{return} ret;
785     
786 \_EXIT\_ERR:
787     \textcolor{keywordflow}{return} ret;
788 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a0c4efee10a9beb884eccce4806db78e5}\label{nmasic_8c_a0c4efee10a9beb884eccce4806db78e5}} 
\index{nmasic.\+c@{nmasic.\+c}!nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address@{nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address}}
\index{nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address@{nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address()}{nmi\_get\_otp\_mac\_address()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nmi\+\_\+get\+\_\+otp\+\_\+mac\+\_\+address (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Mac\+Addr,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} $\ast$}]{pu8\+Is\+Valid }\end{DoxyParamCaption})}



Definition at line 747 of file nmasic.\+c.


\begin{DoxyCode}
748 \{
749     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
750     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}    u32RegValue;
751     
752     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8h_abeb2c5a422e7240315ae32df5aaa3c93}{rNMI\_GP\_REG\_0}, &u32RegValue);
753     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_EXIT\_ERR;
754     
755     \textcolor{keywordflow}{if}(!\hyperlink{nmasic_8h_af8b0066d8246e20c92bf7e690add4f47}{EFUSED\_MAC}(u32RegValue)) \{
756         \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"Default MAC\(\backslash\)r\(\backslash\)n"});
757         \hyperlink{nm__common_8h_ad4de761e451e6416e7e21d6abc4fb776}{m2m\_memset}(pu8MacAddr, 0, 6);
758         \textcolor{keywordflow}{goto} \_EXIT\_ERR;
759     \}
760     
761     \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"OTP MAC\(\backslash\)r\(\backslash\)n"});
762     u32RegValue >>=16;
763     \hyperlink{nmbus_8c_af1e8ce2caa79fdd112216a9f36f103a0}{nm\_read\_block}(u32RegValue|0x30000, pu8MacAddr, 6);
764     \textcolor{keywordflow}{if}(pu8IsValid) *pu8IsValid = 1; 
765     \textcolor{keywordflow}{return} ret;
766 
767 \_EXIT\_ERR:
768     \textcolor{keywordflow}{if}(pu8IsValid) *pu8IsValid = 0;
769     \textcolor{keywordflow}{return} ret;
770 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_acc2bfddab3c6641f911ec910d0c2de4f}\label{nmasic_8c_acc2bfddab3c6641f911ec910d0c2de4f}} 
\index{nmasic.\+c@{nmasic.\+c}!nmi\+\_\+get\+\_\+rfrevid@{nmi\+\_\+get\+\_\+rfrevid}}
\index{nmi\+\_\+get\+\_\+rfrevid@{nmi\+\_\+get\+\_\+rfrevid}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{nmi\+\_\+get\+\_\+rfrevid()}{nmi\_get\_rfrevid()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} nmi\+\_\+get\+\_\+rfrevid (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 292 of file nmasic.\+c.


\begin{DoxyCode}
293 \{
294     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} rfrevid;
295     \textcolor{keywordflow}{if}((\hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x13f4, &rfrevid)) != 
      \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
296         rfrevid = 0;
297         \textcolor{keywordflow}{return} 0;
298     \}
299     \textcolor{keywordflow}{return} rfrevid;
300 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a851e84ae0532e94fa356586e0a4fed81}\label{nmasic_8c_a851e84ae0532e94fa356586e0a4fed81}} 
\index{nmasic.\+c@{nmasic.\+c}!nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo@{nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo}}
\index{nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo@{nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo()}{nmi\_set\_sys\_clk\_src\_to\_xo()}}
{\footnotesize\ttfamily void nmi\+\_\+set\+\_\+sys\+\_\+clk\+\_\+src\+\_\+to\+\_\+xo (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 325 of file nmasic.\+c.


\begin{DoxyCode}
326 \{
327 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_1000\_REV\_B}
328     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
329 
330     \textcolor{comment}{/* Switch system clock source to XO. This will take effect after nmi\_update\_pll(). */}
331     val32 = \hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(0x141c);
332     val32 |= (1 << 2);
333     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x141c, val32);
334     
335     \textcolor{comment}{/* Do PLL update */}
336     \hyperlink{nmasic_8c_abe3f27561e740f3081472077c2ef78dc}{nmi\_update\_pll}();
337 \textcolor{preprocessor}{#endif}
338 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_abe3f27561e740f3081472077c2ef78dc}\label{nmasic_8c_abe3f27561e740f3081472077c2ef78dc}} 
\index{nmasic.\+c@{nmasic.\+c}!nmi\+\_\+update\+\_\+pll@{nmi\+\_\+update\+\_\+pll}}
\index{nmi\+\_\+update\+\_\+pll@{nmi\+\_\+update\+\_\+pll}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{nmi\+\_\+update\+\_\+pll()}{nmi\_update\_pll()}}
{\footnotesize\ttfamily void nmi\+\_\+update\+\_\+pll (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 314 of file nmasic.\+c.


\begin{DoxyCode}
315 \{
316     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} pll;
317 
318     pll = \hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(0x1428);
319     pll &= ~0x1ul;
320     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1428, pll);
321     pll |= 0x1ul;
322     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1428, pll);
323 
324 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a35648e4a684b559e78010397691cbd46}\label{nmasic_8c_a35648e4a684b559e78010397691cbd46}} 
\index{nmasic.\+c@{nmasic.\+c}!pullup\+\_\+ctrl@{pullup\+\_\+ctrl}}
\index{pullup\+\_\+ctrl@{pullup\+\_\+ctrl}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{pullup\+\_\+ctrl()}{pullup\_ctrl()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} pullup\+\_\+ctrl (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}}]{pinmask,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{enable }\end{DoxyParamCaption})}



Definition at line 724 of file nmasic.\+c.


\begin{DoxyCode}
725 \{
726     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} s8Ret;
727     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
728     s8Ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x142c, &val32);
729     \textcolor{keywordflow}{if}(s8Ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
730         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[pullup\_ctrl]: failed to read\(\backslash\)r\(\backslash\)n"});
731         \textcolor{keywordflow}{goto} \_EXIT;
732     \}
733     \textcolor{keywordflow}{if}(enable) \{
734         val32 &= ~pinmask;
735         \} \textcolor{keywordflow}{else} \{
736         val32 |= pinmask;
737     \}
738     s8Ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x142c, val32);
739     \textcolor{keywordflow}{if}(s8Ret  != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
740         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[pullup\_ctrl]: failed to write\(\backslash\)r\(\backslash\)n"});
741         \textcolor{keywordflow}{goto} \_EXIT;
742     \}
743 \_EXIT:
744     \textcolor{keywordflow}{return} s8Ret;
745 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a61fc61a0bf04e075653a3723b4265f19}\label{nmasic_8c_a61fc61a0bf04e075653a3723b4265f19}} 
\index{nmasic.\+c@{nmasic.\+c}!restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset@{restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset}}
\index{restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset@{restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset()}{restore\_pmu\_settings\_after\_global\_reset()}}
{\footnotesize\ttfamily void restore\+\_\+pmu\+\_\+settings\+\_\+after\+\_\+global\+\_\+reset (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 302 of file nmasic.\+c.


\begin{DoxyCode}
303 \{
304     \textcolor{comment}{/* }
305 \textcolor{comment}{    * Must restore PMU register value after }
306 \textcolor{comment}{    * global reset if PMU toggle is done at }
307 \textcolor{comment}{    * least once since the last hard reset.}
308 \textcolor{comment}{    */}
309 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_1000\_REV\_B}
310     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x1e48, 0xb78469ce);
311 \textcolor{preprocessor}{#endif}
312 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a9b177001fb5ca10ae842172a684b3f03}\label{nmasic_8c_a9b177001fb5ca10ae842172a684b3f03}} 
\index{nmasic.\+c@{nmasic.\+c}!set\+\_\+gpio\+\_\+dir@{set\+\_\+gpio\+\_\+dir}}
\index{set\+\_\+gpio\+\_\+dir@{set\+\_\+gpio\+\_\+dir}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{set\+\_\+gpio\+\_\+dir()}{set\_gpio\_dir()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} set\+\_\+gpio\+\_\+dir (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{gpio,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{dir }\end{DoxyParamCaption})}



Definition at line 671 of file nmasic.\+c.


\begin{DoxyCode}
672 \{
673     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
674     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
675 
676     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x20108, &val32);
677     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_EXIT;
678     
679     \textcolor{keywordflow}{if}(dir) \{
680         val32 |= (1ul << gpio);
681     \} \textcolor{keywordflow}{else} \{
682         val32 &= ~(1ul << gpio);
683     \}
684 
685     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x20108, val32);
686 
687 \_EXIT:
688     \textcolor{keywordflow}{return} ret;
689 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a7e7f347b408b7d6a05470944bf2f02a6}\label{nmasic_8c_a7e7f347b408b7d6a05470944bf2f02a6}} 
\index{nmasic.\+c@{nmasic.\+c}!set\+\_\+gpio\+\_\+val@{set\+\_\+gpio\+\_\+val}}
\index{set\+\_\+gpio\+\_\+val@{set\+\_\+gpio\+\_\+val}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{set\+\_\+gpio\+\_\+val()}{set\_gpio\_val()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} set\+\_\+gpio\+\_\+val (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{gpio,  }\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{val }\end{DoxyParamCaption})}



Definition at line 690 of file nmasic.\+c.


\begin{DoxyCode}
691 \{
692     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
693     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
694 
695     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(0x20100, &val32);
696     \textcolor{keywordflow}{if}(ret != \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \textcolor{keywordflow}{goto} \_EXIT;
697     
698     \textcolor{keywordflow}{if}(val) \{
699         val32 |= (1ul << gpio);
700     \} \textcolor{keywordflow}{else} \{
701         val32 &= ~(1ul << gpio);
702     \}
703 
704     ret = \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(0x20100, val32);
705 
706 \_EXIT:
707     \textcolor{keywordflow}{return} ret;
708 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmasic_8c_a12d3b4ba49cbe3075b6ecbfe9fb58d4c}\label{nmasic_8c_a12d3b4ba49cbe3075b6ecbfe9fb58d4c}} 
\index{nmasic.\+c@{nmasic.\+c}!wait\+\_\+for\+\_\+firmware\+\_\+start@{wait\+\_\+for\+\_\+firmware\+\_\+start}}
\index{wait\+\_\+for\+\_\+firmware\+\_\+start@{wait\+\_\+for\+\_\+firmware\+\_\+start}!nmasic.\+c@{nmasic.\+c}}
\subsubsection{\texorpdfstring{wait\+\_\+for\+\_\+firmware\+\_\+start()}{wait\_for\_firmware\_start()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} wait\+\_\+for\+\_\+firmware\+\_\+start (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 607 of file nmasic.\+c.


\begin{DoxyCode}
608 \{
609     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
610     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg = 0, cnt = 0;;
611     
612     \textcolor{keywordflow}{while} (reg != \hyperlink{nmasic_8h_a0360e4558a30733bdb9e151bc7a270fa}{M2M\_FINISH\_INIT\_STATE})
613     \{
614         \hyperlink{group__NmBspSleepFn_gadbf38ddf0138d8e0a4e4720909a7b081}{nm\_bsp\_sleep}(1); \textcolor{comment}{/* TODO: Why bus error if this delay is not here. */}
615         \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"%x %x %x\(\backslash\)r\(\backslash\)n"},(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})\hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(0x108c),(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})
      \hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(0x108c),(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})\hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(0x14A0));
616         reg = \hyperlink{nmbus_8c_a40095d9f8d9cd502b40d93015c93af24}{nm\_read\_reg}(\hyperlink{nmasic_8h_aa3430c78051380c7829522bd94d8657d}{NMI\_STATE\_REG});
617         \textcolor{keywordflow}{if}(++cnt > \hyperlink{nmasic_8c_a45ba202b05caf39795aeca91b0ae547e}{TIMEOUT})
618         \{
619             \hyperlink{nm__common_8h_a8655326906c24b60e7cce33a0f1e932b}{M2M\_DBG}(\textcolor{stringliteral}{"Time out for wait firmware Run\(\backslash\)r\(\backslash\)n"});
620             ret = \hyperlink{nm__common_8h_a6e6f755f4bf0992c3f75c6e7631ba006}{M2M\_ERR\_INIT};
621             \textcolor{keywordflow}{goto} ERR;
622         \}
623     \}
624     \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmasic_8h_aa3430c78051380c7829522bd94d8657d}{NMI\_STATE\_REG},0);
625 ERR:
626     \textcolor{keywordflow}{return} ret;
627 \}
\end{DoxyCode}
