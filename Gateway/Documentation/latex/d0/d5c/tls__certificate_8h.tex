\hypertarget{tls__certificate_8h}{}\section{cyclone\+\_\+ssl/tls\+\_\+certificate.h File Reference}
\label{tls__certificate_8h}\index{cyclone\+\_\+ssl/tls\+\_\+certificate.\+h@{cyclone\+\_\+ssl/tls\+\_\+certificate.\+h}}


Certificate handling.  


{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkix/x509\+\_\+common.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_aef1ffcaaa014634e0e8e21eeb09ecc05}{tls\+Format\+Certificate\+List} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format certificate chain. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_a5f855ef4facdcad83e2b3ef570bafc40}{tls\+Format\+Raw\+Public\+Key} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format raw public key. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_a271d9a0eaaca97bb85f64c7ad176c33e}{tls\+Parse\+Certificate\+List} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse certificate chain. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_aa425ea4126c69179a25b0d4c07049a66}{tls\+Parse\+Raw\+Public\+Key} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse raw public key. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{tls__certificate_8h_a31f6bd0b16ae44ecc92ac37b5eb39d6f}{tls\+Is\+Certificate\+Acceptable} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structTlsCertDesc}{Tls\+Cert\+Desc} $\ast$cert, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$cert\+Types, size\+\_\+t num\+Cert\+Types, const \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{Tls\+Sign\+Hash\+Algos} $\ast$sign\+Hash\+Algos, const \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{Tls\+Sign\+Hash\+Algos} $\ast$cert\+Sign\+Hash\+Algos, const \hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{Tls\+Supported\+Group\+List} $\ast$curve\+List, const \hyperlink{tls_8h_a96ef533723d450ad6c4903a78c756f9e}{Tls\+Cert\+Authorities} $\ast$cert\+Authorities)
\begin{DoxyCompactList}\small\item\em Check whether a certificate is acceptable. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_ae79881159a47eb47b41cb0c2f175839d}{tls\+Validate\+Certificate} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} path\+Len, const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$subject\+Name)
\begin{DoxyCompactList}\small\item\em Verify certificate against root C\+As. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_a87df47b3fef52984054b8e49a72d2224}{tls\+Get\+Certificate\+Type} (const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info, \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffd}{Tls\+Certificate\+Type} $\ast$cert\+Type, \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223}{Tls\+Signature\+Algo} $\ast$cert\+Sign\+Algo, \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156d}{Tls\+Hash\+Algo} $\ast$cert\+Hash\+Algo, \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{Tls\+Named\+Group} $\ast$named\+Curve)
\begin{DoxyCompactList}\small\item\em Retrieve the certificate type. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_ab69e8470ee1ec5b621ca54f7ce93fb9b}{tls\+Read\+Subject\+Public\+Key} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$subject\+Public\+Key\+Info)
\begin{DoxyCompactList}\small\item\em Extract the subject public key from the received certificate. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__certificate_8h_ae59caad5f5a42aa9d869bbd1ff8bbe9e}{tls\+Check\+Key\+Usage} (const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$cert\+Info, \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End} entity, \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75}{Tls\+Key\+Exch\+Method} key\+Exch\+Method)
\begin{DoxyCompactList}\small\item\em Check certificate key usage. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Certificate handling. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{tls__certificate_8h_ae59caad5f5a42aa9d869bbd1ff8bbe9e}\label{tls__certificate_8h_ae59caad5f5a42aa9d869bbd1ff8bbe9e}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Check\+Key\+Usage@{tls\+Check\+Key\+Usage}}
\index{tls\+Check\+Key\+Usage@{tls\+Check\+Key\+Usage}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Check\+Key\+Usage()}{tlsCheckKeyUsage()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Check\+Key\+Usage (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info,  }\item[{\hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End}}]{entity,  }\item[{\hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75}{Tls\+Key\+Exch\+Method}}]{key\+Exch\+Method }\end{DoxyParamCaption})}



Check certificate key usage. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cert\+Info} & Pointer to the X.\+509 certificate \\
\hline
\mbox{\tt in}  & {\em entity} & Specifies whether this entity is considered a client or a server \\
\hline
\mbox{\tt in}  & {\em key\+Exch\+Method} & T\+LS key exchange method \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1964 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
1966 \{
1967 \textcolor{preprocessor}{#if (TLS\_CERT\_KEY\_USAGE\_SUPPORT == ENABLED)}
1968    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1969    \textcolor{keyword}{const} \hyperlink{structX509KeyUsage}{X509KeyUsage} *keyUsage;
1970    \textcolor{keyword}{const} \hyperlink{structX509ExtendedKeyUsage}{X509ExtendedKeyUsage} *extKeyUsage;
1971 
1972    \textcolor{comment}{//Initialize status code}
1973    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1974 
1975    \textcolor{comment}{//Point to the KeyUsage extension}
1976    keyUsage = &certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_aa60d8b8a952d01fd8de02c2da091563e}{extensions}.\hyperlink{structX509Extensions_adc23b201b2f81c036bb2f6fb364af346}{keyUsage};
1977 
1978    \textcolor{comment}{//Check if the KeyUsage extension is present}
1979    \textcolor{keywordflow}{if}(keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} != 0)
1980    \{
1981       \textcolor{comment}{//Check whether TLS operates as a client or a server}
1982       \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1983       \{
1984          \textcolor{comment}{//Check key exchange method}
1985          \textcolor{keywordflow}{if}(keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e}{TLS\_KEY\_EXCH\_RSA} ||
1986             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c}{TLS\_KEY\_EXCH\_RSA\_PSK})
1987          \{
1988             \textcolor{comment}{//The keyEncipherment bit must be asserted when the subject public}
1989             \textcolor{comment}{//key is used for enciphering private or secret keys}
1990             \textcolor{keywordflow}{if}((keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & \hyperlink{certificate_2x509__common_8h_a071feff2befadce3a4fe5b708cdb149ba235244f3bdd6ec49d461cae4b95131a6}{X509\_KEY\_USAGE\_KEY\_ENCIPHERMENT}) ==
       0)
1991                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1992          \}
1993          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4}{TLS\_KEY\_EXCH\_DHE\_RSA} ||
1994             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39}{TLS\_KEY\_EXCH\_DHE\_DSS} ||
1995             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b}{TLS\_KEY\_EXCH\_ECDHE\_RSA} ||
1996             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7}{TLS\_KEY\_EXCH\_ECDHE\_ECDSA} ||
1997             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a73afc728c1b23fef9f03ce4a08d0e20b}{TLS13\_KEY\_EXCH\_DHE} ||
1998             keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a3cde206533769f2a174205875bd0b8da}{TLS13\_KEY\_EXCH\_ECDHE})
1999          \{
2000             \textcolor{comment}{//The digitalSignature bit must be asserted when the subject public}
2001             \textcolor{comment}{//key is used for verifying digital signatures, other than signatures}
2002             \textcolor{comment}{//on certificates and CRLs}
2003             \textcolor{keywordflow}{if}((keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & \hyperlink{certificate_2x509__common_8h_a071feff2befadce3a4fe5b708cdb149ba2ca61ff11b616c19f33151d9a84e539d}{X509\_KEY\_USAGE\_DIGITAL\_SIGNATURE}) 
      == 0)
2004                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
2005          \}
2006          \textcolor{keywordflow}{else}
2007          \{
2008             \textcolor{comment}{//Just for sanity}
2009          \}
2010       \}
2011       \textcolor{keywordflow}{else}
2012       \{
2013          \textcolor{comment}{//The digitalSignature bit must be asserted when the subject public}
2014          \textcolor{comment}{//key is used for verifying digital signatures, other than signatures}
2015          \textcolor{comment}{//on certificates and CRLs}
2016          \textcolor{keywordflow}{if}((keyUsage->\hyperlink{structX509KeyUsage_a36e70866e15b4d2bac5c87bd3f985988}{bitmap} & \hyperlink{certificate_2x509__common_8h_a071feff2befadce3a4fe5b708cdb149ba2ca61ff11b616c19f33151d9a84e539d}{X509\_KEY\_USAGE\_DIGITAL\_SIGNATURE}) == 
      0)
2017             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
2018       \}
2019    \}
2020 
2021    \textcolor{comment}{//Point to the ExtendedKeyUsage extension}
2022    extKeyUsage = &certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_aa60d8b8a952d01fd8de02c2da091563e}{extensions}.\hyperlink{structX509Extensions_afad9dec97dd6bba0297e67efd46ff042}{extKeyUsage};
2023 
2024    \textcolor{comment}{//Check if the ExtendedKeyUsage extension is present}
2025    \textcolor{keywordflow}{if}(extKeyUsage->\hyperlink{structX509ExtendedKeyUsage_ad8972a4feaf8d58626f66650ff9e3ebb}{bitmap} != 0)
2026    \{
2027       \textcolor{comment}{//Check whether TLS operates as a client or a server}
2028       \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
2029       \{
2030          \textcolor{comment}{//Make sure the certificate can be used for server authentication}
2031          \textcolor{keywordflow}{if}((extKeyUsage->\hyperlink{structX509ExtendedKeyUsage_ad8972a4feaf8d58626f66650ff9e3ebb}{bitmap} & \hyperlink{certificate_2x509__common_8h_a14abb74201f358023e263d66316af46ca63ac39e8e01f7523091284efb3735c76}{X509\_EXT\_KEY\_USAGE\_SERVER\_AUTH}) == 0
      )
2032             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
2033       \}
2034       \textcolor{keywordflow}{else}
2035       \{
2036          \textcolor{comment}{//Make sure the certificate can be used for client authentication}
2037          \textcolor{keywordflow}{if}((extKeyUsage->\hyperlink{structX509ExtendedKeyUsage_ad8972a4feaf8d58626f66650ff9e3ebb}{bitmap} & \hyperlink{certificate_2x509__common_8h_a14abb74201f358023e263d66316af46caeb140d0686928e663c22c2e032088713}{X509\_EXT\_KEY\_USAGE\_CLIENT\_AUTH}) == 0
      )
2038             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
2039       \}
2040    \}
2041 
2042    \textcolor{comment}{//Return status code}
2043    \textcolor{keywordflow}{return} error;
2044 \textcolor{preprocessor}{#else}
2045    \textcolor{comment}{//Do not check key usage}
2046    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
2047 \textcolor{preprocessor}{#endif}
2048 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_aef1ffcaaa014634e0e8e21eeb09ecc05}\label{tls__certificate_8h_aef1ffcaaa014634e0e8e21eeb09ecc05}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Format\+Certificate\+List@{tls\+Format\+Certificate\+List}}
\index{tls\+Format\+Certificate\+List@{tls\+Format\+Certificate\+List}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Format\+Certificate\+List()}{tlsFormatCertificateList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Certificate\+List (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format certificate chain. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the certificate chain \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 60 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
62 \{
63    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
64    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
65    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
66    \textcolor{keywordtype}{size\_t} certChainLen;
67    \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *certChain;
68 
69    \textcolor{comment}{//Initialize status code}
70    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
71 
72    \textcolor{comment}{//Length of the certificate list in bytes}
73    *written = 0;
74 
75    \textcolor{comment}{//Check whether a certificate is available}
76    \textcolor{keywordflow}{if}(context->cert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
77    \{
78       \textcolor{comment}{//Point to the certificate chain}
79       certChain = context->cert->certChain;
80       \textcolor{comment}{//Get the total length, in bytes, of the certificate chain}
81       certChainLen = context->cert->certChainLen;
82    \}
83    \textcolor{keywordflow}{else}
84    \{
85       \textcolor{comment}{//If no suitable certificate is available, the message contains an}
86       \textcolor{comment}{//empty certificate list}
87       certChain = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
88       certChainLen = 0;
89    \}
90 
91    \textcolor{comment}{//Parse the certificate chain}
92    \textcolor{keywordflow}{while}(certChainLen > 0)
93    \{
94       \textcolor{comment}{//The first pass calculates the length of the DER-encoded certificate}
95       error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &n, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
96 
97       \textcolor{comment}{//End of file detected?}
98       \textcolor{keywordflow}{if}(error)
99       \{
100          \textcolor{comment}{//Exit immediately}
101          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
102          \textcolor{keywordflow}{break};
103       \}
104 
105       \textcolor{comment}{//Buffer overflow?}
106       \textcolor{keywordflow}{if}((*written + n + 3) > context->txBufferMaxLen)
107       \{
108          \textcolor{comment}{//Report an error}
109          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca67f2e3bde0b243044afa635130f722cf}{ERROR\_MESSAGE\_TOO\_LONG};
110          \textcolor{keywordflow}{break};
111       \}
112 
113       \textcolor{comment}{//Each certificate is preceded by a 3-byte length field}
114       \hyperlink{cpu__endian_8h_acba352ed22d98efff17d0374c0790885}{STORE24BE}(n, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
115 
116       \textcolor{comment}{//The second pass decodes the PEM certificate}
117       error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen, 
      \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} + 3, &n, &m);
118       \textcolor{comment}{//Any error to report?}
119       \textcolor{keywordflow}{if}(error)
120          \textcolor{keywordflow}{break};
121 
122       \textcolor{comment}{//Advance read pointer}
123       certChain += \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
124       certChainLen -= \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
125 
126       \textcolor{comment}{//Advance write pointer}
127       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += n + 3;
128       *written += n + 3;
129 
130 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
131       \textcolor{comment}{//TLS 1.3 currently selected?}
132       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
133       \{
134          \textcolor{comment}{//Format the list of extensions for the current CertificateEntry}
135          error = \hyperlink{tls13__misc_8h_a2c08bc5cc8d04ed36a1ef75363ecd1f7}{tls13FormatCertExtensions}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, &n);
136          \textcolor{comment}{//Any error to report?}
137          \textcolor{keywordflow}{if}(error)
138             \textcolor{keywordflow}{break};
139 
140          \textcolor{comment}{//Advance write pointer}
141          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
142          *written += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
143       \}
144 \textcolor{preprocessor}{#endif}
145    \}
146 
147    \textcolor{comment}{//Return status code}
148    \textcolor{keywordflow}{return} error;
149 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_a5f855ef4facdcad83e2b3ef570bafc40}\label{tls__certificate_8h_a5f855ef4facdcad83e2b3ef570bafc40}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Format\+Raw\+Public\+Key@{tls\+Format\+Raw\+Public\+Key}}
\index{tls\+Format\+Raw\+Public\+Key@{tls\+Format\+Raw\+Public\+Key}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Format\+Raw\+Public\+Key()}{tlsFormatRawPublicKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Raw\+Public\+Key (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format raw public key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the raw public key \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 160 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
162 \{
163    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
164 
165    \textcolor{comment}{//Initialize status code}
166    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
167 
168    \textcolor{comment}{//Length of the certificate list in bytes}
169    *written = 0;
170 
171 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
172    \textcolor{comment}{//Check whether a certificate is available}
173    \textcolor{keywordflow}{if}(context->cert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
174    \{
175       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
176       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *derCert;
177       \textcolor{keywordtype}{size\_t} derCertLen;
178       \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *certInfo;
179 
180       \textcolor{comment}{//Initialize variables}
181       derCert = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
182       certInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
183 
184       \textcolor{comment}{//Start of exception handling block}
185       \textcolor{keywordflow}{do}
186       \{
187          \textcolor{comment}{//The first pass calculates the length of the DER-encoded certificate}
188          error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(context->cert->certChain,
189             context->cert->certChainLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &derCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
190          \textcolor{comment}{//Any error to report?}
191          \textcolor{keywordflow}{if}(error)
192             \textcolor{keywordflow}{break};
193 
194          \textcolor{comment}{//Allocate a memory buffer to hold the DER-encoded certificate}
195          derCert = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(derCertLen);
196          \textcolor{comment}{//Failed to allocate memory?}
197          \textcolor{keywordflow}{if}(derCert == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
198          \{
199             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
200             \textcolor{keywordflow}{break};
201          \}
202 
203          \textcolor{comment}{//The second pass decodes the PEM certificate}
204          error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(context->cert->certChain,
205             context->cert->certChainLen, derCert, &derCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
206          \textcolor{comment}{//Any error to report?}
207          \textcolor{keywordflow}{if}(error)
208             \textcolor{keywordflow}{break};
209 
210          \textcolor{comment}{//Allocate a memory buffer to store X.509 certificate info}
211          certInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
212          \textcolor{comment}{//Failed to allocate memory?}
213          \textcolor{keywordflow}{if}(certInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
214          \{
215             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
216             \textcolor{keywordflow}{break};
217          \}
218 
219          \textcolor{comment}{//Parse X.509 certificate}
220          error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(derCert, derCertLen, certInfo);
221          \textcolor{comment}{//Failed to parse the X.509 certificate?}
222          \textcolor{keywordflow}{if}(error)
223             \textcolor{keywordflow}{break};
224 
225          \textcolor{comment}{//Retrieve the length of the raw public key}
226          n = certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_a1397c8953cfe641fda3a326479b48dbd}{rawDataLen};
227 
228 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
229          \textcolor{comment}{//TLS 1.3 currently selected?}
230          \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
231          \{
232             \textcolor{comment}{//The raw public key is preceded by a 3-byte length field}
233             \hyperlink{cpu__endian_8h_acba352ed22d98efff17d0374c0790885}{STORE24BE}(n, \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
234             \textcolor{comment}{//Copy the raw public key}
235             memcpy(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} + 3, certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_a40099adba11d706e320a0d553b9e2438}{rawData}, n);
236 
237             \textcolor{comment}{//Advance data pointer}
238             \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += n + 3;
239             \textcolor{comment}{//Adjust the length of the certificate list}
240             *written += n + 3;
241 
242             \textcolor{comment}{//Format the list of extensions for the current CertificateEntry}
243             error = \hyperlink{tls13__misc_8h_a2c08bc5cc8d04ed36a1ef75363ecd1f7}{tls13FormatCertExtensions}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, &n);
244             \textcolor{comment}{//Any error to report?}
245             \textcolor{keywordflow}{if}(error)
246                \textcolor{keywordflow}{break};
247 
248             \textcolor{comment}{//Advance data pointer}
249             \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
250             \textcolor{comment}{//Adjust the length of the certificate list}
251             *written += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
252          \}
253          \textcolor{keywordflow}{else}
254 \textcolor{preprocessor}{#endif}
255          \{
256             \textcolor{comment}{//Copy the raw public key}
257             memcpy(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_a40099adba11d706e320a0d553b9e2438}{rawData}, n);
258 
259             \textcolor{comment}{//Advance data pointer}
260             \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
261             \textcolor{comment}{//Adjust the length of the certificate list}
262             *written += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
263          \}
264 
265          \textcolor{comment}{//End of exception handling block}
266       \} \textcolor{keywordflow}{while}(0);
267 
268       \textcolor{comment}{//Release previously allocated memory}
269       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(derCert);
270       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(certInfo);
271    \}
272 \textcolor{preprocessor}{#endif}
273 
274    \textcolor{comment}{//Return status code}
275    \textcolor{keywordflow}{return} error;
276 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_a87df47b3fef52984054b8e49a72d2224}\label{tls__certificate_8h_a87df47b3fef52984054b8e49a72d2224}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Get\+Certificate\+Type@{tls\+Get\+Certificate\+Type}}
\index{tls\+Get\+Certificate\+Type@{tls\+Get\+Certificate\+Type}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Get\+Certificate\+Type()}{tlsGetCertificateType()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Get\+Certificate\+Type (\begin{DoxyParamCaption}\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info,  }\item[{\hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffd}{Tls\+Certificate\+Type} $\ast$}]{cert\+Type,  }\item[{\hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223}{Tls\+Signature\+Algo} $\ast$}]{cert\+Sign\+Algo,  }\item[{\hyperlink{tls_8h_a98b0299cd7e197edc67123642089156d}{Tls\+Hash\+Algo} $\ast$}]{cert\+Hash\+Algo,  }\item[{\hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{Tls\+Named\+Group} $\ast$}]{named\+Curve }\end{DoxyParamCaption})}



Retrieve the certificate type. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cert\+Info} & X.\+509 certificate \\
\hline
\mbox{\tt out}  & {\em cert\+Type} & Certificate type \\
\hline
\mbox{\tt out}  & {\em cert\+Sign\+Algo} & Signature algorithm that has been used to sign the certificate \\
\hline
\mbox{\tt out}  & {\em cert\+Hash\+Algo} & Hash algorithm that has been used to sign the certificate \\
\hline
\mbox{\tt out}  & {\em named\+Curve} & Elliptic curve (only for E\+C\+D\+SA certificates) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1416 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
1419 \{
1420    \textcolor{keywordtype}{size\_t} oidLen;
1421    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid};
1422 
1423    \textcolor{comment}{//Check parameters}
1424    \textcolor{keywordflow}{if}(certInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || certType == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || certSignAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
1425       certHashAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || namedCurve == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1426    \{
1427       \textcolor{comment}{//Report an error}
1428       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
1429    \}
1430 
1431    \textcolor{comment}{//Point to the public key identifier}
1432    oid = certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.\hyperlink{structX509SubjectPublicKeyInfo_a90a8b808782b18de901306acd49b0706}{oid};
1433    oidLen = certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_a7c5d6f507f653f6085ba56e6b4b55912}{oidLen};
1434 
1435 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED || TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
1436    \textcolor{comment}{//RSA public key?}
1437    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID})))
1438    \{
1439       \textcolor{comment}{//Save certificate type}
1440       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN};
1441       \textcolor{comment}{//No named curve applicable}
1442       *namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1443    \}
1444    \textcolor{keywordflow}{else}
1445 \textcolor{preprocessor}{#endif}
1446 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
1447    \textcolor{comment}{//RSA-PSS public key?}
1448    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID})))
1449    \{
1450       \textcolor{comment}{//Save certificate type}
1451       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN};
1452       \textcolor{comment}{//No named curve applicable}
1453       *namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1454    \}
1455    \textcolor{keywordflow}{else}
1456 \textcolor{preprocessor}{#endif}
1457 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
1458    \textcolor{comment}{//DSA public key?}
1459    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{dsa_8c_aec62d423add8486c829eacb574ebe4f3}{DSA\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{dsa_8c_aec62d423add8486c829eacb574ebe4f3}{DSA\_OID})))
1460    \{
1461       \textcolor{comment}{//Save certificate type}
1462       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN};
1463       \textcolor{comment}{//No named curve applicable}
1464       *namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1465    \}
1466    \textcolor{keywordflow}{else}
1467 \textcolor{preprocessor}{#endif}
1468 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
1469    \textcolor{comment}{//EC public key?}
1470    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec_8c_a5ff93c201b1e50b6fda04774a2fa537c}{EC\_PUBLIC\_KEY\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec_8c_a5ff93c201b1e50b6fda04774a2fa537c}{EC\_PUBLIC\_KEY\_OID})))
1471    \{
1472       \textcolor{keyword}{const} \hyperlink{structX509EcParameters}{X509EcParameters} *params;
1473 
1474       \textcolor{comment}{//Point to the EC parameters}
1475       params = &certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo}.
      \hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams};
1476 
1477       \textcolor{comment}{//Save certificate type}
1478       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN};
1479       \textcolor{comment}{//Retrieve the named curve that has been used to generate the EC public key}
1480       *namedCurve = \hyperlink{tls__misc_8c_a3fd967f568e8584bbce1a691a4d8c14d}{tlsGetNamedCurve}(params->\hyperlink{structX509EcParameters_a122c5387fb2f12374a905ecfd2ca4c86}{namedCurve}, params->
      \hyperlink{structX509EcParameters_ac58081bd63ed68d0cb101ff7e65667ec}{namedCurveLen});
1481    \}
1482    \textcolor{keywordflow}{else}
1483 \textcolor{preprocessor}{#endif}
1484 \textcolor{preprocessor}{#if (TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
1485    \textcolor{comment}{//Ed25519 public key?}
1486    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID})))
1487    \{
1488       \textcolor{comment}{//Save certificate type}
1489       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN};
1490       \textcolor{comment}{//No named curve applicable}
1491       *namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1492    \}
1493    \textcolor{keywordflow}{else}
1494    \textcolor{comment}{//Ed448 public key?}
1495    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID})))
1496    \{
1497       \textcolor{comment}{//Save certificate type}
1498       *certType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN};
1499       \textcolor{comment}{//No named curve applicable}
1500       *namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1501    \}
1502    \textcolor{keywordflow}{else}
1503 \textcolor{preprocessor}{#endif}
1504    \textcolor{comment}{//Invalid public key?}
1505    \{
1506       \textcolor{comment}{//The certificate does not contain any valid public key}
1507       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1508    \}
1509 
1510    \textcolor{comment}{//Point to the signature algorithm}
1511    oid = certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}.\hyperlink{structX509SignatureAlgoId_a98ec1f180733e1e0cc22b133f8a23416}{oid};
1512    oidLen = certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}.\hyperlink{structX509SignatureAlgoId_a4a15b78049b8e360a069b72f0c79b0f4}{oidLen};
1513 
1514    \textcolor{comment}{//Retrieve the signature algorithm that has been used to sign the certificate}
1515    \textcolor{keywordflow}{if}(oid == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || oidLen == 0)
1516    \{
1517       \textcolor{comment}{//Invalid certificate}
1518       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1519    \}
1520 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED || TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
1521    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_af19f8c370895ebbb0acbe8da4ef0a0c0}{MD5\_WITH\_RSA\_ENCRYPTION\_OID},
1522       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_af19f8c370895ebbb0acbe8da4ef0a0c0}{MD5\_WITH\_RSA\_ENCRYPTION\_OID})))
1523    \{
1524       \textcolor{comment}{//MD5 with RSA signature algorithm}
1525       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1526       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daa72f43566b2829dd24049126ac7a7392}{TLS\_HASH\_ALGO\_MD5};
1527    \}
1528    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a736d50cd0e106849f68525738a84807d}{SHA1\_WITH\_RSA\_ENCRYPTION\_OID},
1529       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_a736d50cd0e106849f68525738a84807d}{SHA1\_WITH\_RSA\_ENCRYPTION\_OID})))
1530    \{
1531       \textcolor{comment}{//SHA-1 with RSA signature algorithm}
1532       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1533       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1534    \}
1535    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a3f47da029e12f80b24910e857eff27b9}{SHA256\_WITH\_RSA\_ENCRYPTION\_OID},
1536       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_a3f47da029e12f80b24910e857eff27b9}{SHA256\_WITH\_RSA\_ENCRYPTION\_OID})))
1537    \{
1538       \textcolor{comment}{//SHA-256 with RSA signature algorithm}
1539       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1540       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1541    \}
1542    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a3894e84fdea08249ef57afdba18aa380}{SHA384\_WITH\_RSA\_ENCRYPTION\_OID},
1543       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_a3894e84fdea08249ef57afdba18aa380}{SHA384\_WITH\_RSA\_ENCRYPTION\_OID})))
1544    \{
1545       \textcolor{comment}{//SHA-384 with RSA signature algorithm}
1546       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1547       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
1548    \}
1549    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_adf40ca1962295568f78ca0cdcd202971}{SHA512\_WITH\_RSA\_ENCRYPTION\_OID},
1550       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_adf40ca1962295568f78ca0cdcd202971}{SHA512\_WITH\_RSA\_ENCRYPTION\_OID})))
1551    \{
1552       \textcolor{comment}{//SHA-512 with RSA signature algorithm}
1553       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA};
1554       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
1555    \}
1556 \textcolor{preprocessor}{#endif}
1557 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED && X509\_RSA\_PSS\_SUPPORT == ENABLED)}
1558    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID},
1559       \textcolor{keyword}{sizeof}(\hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID})))
1560    \{
1561       \textcolor{keywordtype}{size\_t} hashAlgoLen;
1562       \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *hashAlgo;
1563 
1564       \textcolor{comment}{//Get the OID of the hash algorithm}
1565       hashAlgo = certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}.\hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}.
      \hyperlink{structX509RsaPssParameters_a21f002c671582b73f60617bc23116db3}{hashAlgo};
1566       hashAlgoLen = certInfo->\hyperlink{structX509CertificateInfo_a557f43736fe7dab190eac1cd31559281}{signatureAlgo}.\hyperlink{structX509SignatureAlgoId_aabb448030d8783d06739cdd2c660dde4}{rsaPssParams}.
      \hyperlink{structX509RsaPssParameters_a91b731f749a7d1bfafbb8595f898ff2e}{hashAlgoLen};
1567 
1568 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
1569       \textcolor{comment}{//SHA-256 hash algorithm identifier?}
1570       \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(hashAlgo, hashAlgoLen, \hyperlink{sha256_8h_a0ad39bb0197386687669cb1535a21faf}{SHA256\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{sha256_8h_a0ad39bb0197386687669cb1535a21faf}{SHA256\_OID})))
1571       \{
1572          \textcolor{comment}{//RSA-PSS with SHA-256 signature algorithm}
1573          *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA256};
1574          *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1575       \}
1576       \textcolor{keywordflow}{else}
1577 \textcolor{preprocessor}{#endif}
1578 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
1579       \textcolor{comment}{//SHA-384 hash algorithm identifier?}
1580       \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(hashAlgo, hashAlgoLen, \hyperlink{sha384_8h_a7b87fc3ff3087d1f7d8b128704a89604}{SHA384\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{sha384_8h_a7b87fc3ff3087d1f7d8b128704a89604}{SHA384\_OID})))
1581       \{
1582          \textcolor{comment}{//RSA-PSS with SHA-384 signature algorithm}
1583          *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA384};
1584          *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1585       \}
1586       \textcolor{keywordflow}{else}
1587 \textcolor{preprocessor}{#endif}
1588 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
1589       \textcolor{comment}{//SHA-512 hash algorithm identifier?}
1590       \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(hashAlgo, hashAlgoLen, \hyperlink{sha512_8h_abdcf601286b89e9c252d014eb0b1c1b0}{SHA512\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{sha512_8h_abdcf601286b89e9c252d014eb0b1c1b0}{SHA512\_OID})))
1591       \{
1592          \textcolor{comment}{//RSA-PSS with SHA-512 signature algorithm}
1593          *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a1f76baf2d64af86ca98e164c9089a77c}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA512};
1594          *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1595       \}
1596       \textcolor{keywordflow}{else}
1597 \textcolor{preprocessor}{#endif}
1598       \textcolor{comment}{//Unknown hash algorithm identifier?}
1599       \{
1600          \textcolor{comment}{//The signature algorithm is not supported}
1601          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1602       \}
1603    \}
1604 \textcolor{preprocessor}{#endif}
1605 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
1606    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{dsa_8c_aa08eebc141e54bba0dbfda5c08eb2f6e}{DSA\_WITH\_SHA1\_OID},
1607       \textcolor{keyword}{sizeof}(\hyperlink{dsa_8c_aa08eebc141e54bba0dbfda5c08eb2f6e}{DSA\_WITH\_SHA1\_OID})))
1608    \{
1609       \textcolor{comment}{//DSA with SHA-1 signature algorithm}
1610       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1611       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1612    \}
1613    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{dsa_8c_ae66f1af58648440726b52b520b0a4cd8}{DSA\_WITH\_SHA224\_OID},
1614       \textcolor{keyword}{sizeof}(\hyperlink{dsa_8c_ae66f1af58648440726b52b520b0a4cd8}{DSA\_WITH\_SHA224\_OID})))
1615    \{
1616       \textcolor{comment}{//DSA with SHA-224 signature algorithm}
1617       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1618       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
1619    \}
1620    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{dsa_8c_aff83cbf5cb752485af12bddc1df12938}{DSA\_WITH\_SHA256\_OID},
1621       \textcolor{keyword}{sizeof}(\hyperlink{dsa_8c_aff83cbf5cb752485af12bddc1df12938}{DSA\_WITH\_SHA256\_OID})))
1622    \{
1623       \textcolor{comment}{//DSA with SHA-256 signature algorithm}
1624       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA};
1625       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1626    \}
1627 \textcolor{preprocessor}{#endif}
1628 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
1629    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ecdsa_8c_af020650a7162df3e86dc65f7cc8da14f}{ECDSA\_WITH\_SHA1\_OID},
1630       \textcolor{keyword}{sizeof}(\hyperlink{ecdsa_8c_af020650a7162df3e86dc65f7cc8da14f}{ECDSA\_WITH\_SHA1\_OID})))
1631    \{
1632       \textcolor{comment}{//ECDSA with SHA-1 signature algorithm}
1633       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1634       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1};
1635    \}
1636    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ecdsa_8c_a2c82fe5e3c598e3c764973f22fa53bd0}{ECDSA\_WITH\_SHA224\_OID},
1637       \textcolor{keyword}{sizeof}(\hyperlink{ecdsa_8c_a2c82fe5e3c598e3c764973f22fa53bd0}{ECDSA\_WITH\_SHA224\_OID})))
1638    \{
1639       \textcolor{comment}{//ECDSA with SHA-224 signature algorithm}
1640       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1641       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224};
1642    \}
1643    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ecdsa_8c_a552ef11d006434b7d6302c762d084771}{ECDSA\_WITH\_SHA256\_OID},
1644       \textcolor{keyword}{sizeof}(\hyperlink{ecdsa_8c_a552ef11d006434b7d6302c762d084771}{ECDSA\_WITH\_SHA256\_OID})))
1645    \{
1646       \textcolor{comment}{//ECDSA with SHA-256 signature algorithm}
1647       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1648       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256};
1649    \}
1650    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ecdsa_8c_aa5356473862a85426ad8574589c44b9e}{ECDSA\_WITH\_SHA384\_OID},
1651       \textcolor{keyword}{sizeof}(\hyperlink{ecdsa_8c_aa5356473862a85426ad8574589c44b9e}{ECDSA\_WITH\_SHA384\_OID})))
1652    \{
1653       \textcolor{comment}{//ECDSA with SHA-384 signature algorithm}
1654       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1655       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384};
1656    \}
1657    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ecdsa_8c_ad311e1710697e87730e321b45a5e65e3}{ECDSA\_WITH\_SHA512\_OID},
1658       \textcolor{keyword}{sizeof}(\hyperlink{ecdsa_8c_ad311e1710697e87730e321b45a5e65e3}{ECDSA\_WITH\_SHA512\_OID})))
1659    \{
1660       \textcolor{comment}{//ECDSA with SHA-512 signature algorithm}
1661       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA};
1662       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512};
1663    \}
1664 \textcolor{preprocessor}{#endif}
1665 \textcolor{preprocessor}{#if (TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
1666    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID})))
1667    \{
1668       \textcolor{comment}{//Ed25519 signature algorithm}
1669       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae6cdc4f0c6a497d2bd2c5d15412759ef}{TLS\_SIGN\_ALGO\_ED25519};
1670       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1671    \}
1672    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID})))
1673    \{
1674       \textcolor{comment}{//Ed448 signature algorithm}
1675       *certSignAlgo = \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a6fbbd4136d21496a9053ccca846ecf3f}{TLS\_SIGN\_ALGO\_ED448};
1676       *certHashAlgo = \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC};
1677    \}
1678 \textcolor{preprocessor}{#endif}
1679    \textcolor{keywordflow}{else}
1680    \{
1681       \textcolor{comment}{//The signature algorithm is not supported}
1682       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1683    \}
1684 
1685    \textcolor{comment}{//X.509 certificate successfully parsed}
1686    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1687 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_a31f6bd0b16ae44ecc92ac37b5eb39d6f}\label{tls__certificate_8h_a31f6bd0b16ae44ecc92ac37b5eb39d6f}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Is\+Certificate\+Acceptable@{tls\+Is\+Certificate\+Acceptable}}
\index{tls\+Is\+Certificate\+Acceptable@{tls\+Is\+Certificate\+Acceptable}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Is\+Certificate\+Acceptable()}{tlsIsCertificateAcceptable()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} tls\+Is\+Certificate\+Acceptable (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structTlsCertDesc}{Tls\+Cert\+Desc} $\ast$}]{cert,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{cert\+Types,  }\item[{size\+\_\+t}]{num\+Cert\+Types,  }\item[{const \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{Tls\+Sign\+Hash\+Algos} $\ast$}]{sign\+Hash\+Algos,  }\item[{const \hyperlink{tls_8h_a52f8ea223987ee1e857b6687f38d3888}{Tls\+Sign\+Hash\+Algos} $\ast$}]{cert\+Sign\+Hash\+Algos,  }\item[{const \hyperlink{tls_8h_a697f1e9ded788afc0e198e055676b13c}{Tls\+Supported\+Group\+List} $\ast$}]{curve\+List,  }\item[{const \hyperlink{tls_8h_a96ef533723d450ad6c4903a78c756f9e}{Tls\+Cert\+Authorities} $\ast$}]{cert\+Authorities }\end{DoxyParamCaption})}



Check whether a certificate is acceptable. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cert} & End entity certificate \\
\hline
\mbox{\tt in}  & {\em cert\+Types} & List of supported certificate types \\
\hline
\mbox{\tt in}  & {\em num\+Cert\+Types} & Size of the list that contains the supported certificate types \\
\hline
\mbox{\tt in}  & {\em sign\+Hash\+Algos} & List of signature algorithms that may be used in digital signatures \\
\hline
\mbox{\tt in}  & {\em cert\+Sign\+Hash\+Algos} & List of signature algorithms that may be used in X.\+509 certificates \\
\hline
\mbox{\tt in}  & {\em curve\+List} & List of supported elliptic curves \\
\hline
\mbox{\tt in}  & {\em cert\+Authorities} & List of trusted CA \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the specified certificate conforms to the requirements, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 721 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
725 \{
726    \textcolor{keywordtype}{size\_t} i;
727    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
728    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
729    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} acceptable;
730 
731    \textcolor{comment}{//Make sure that a valid certificate has been loaded}
732    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_ae944e03a44368e92bb4955f890381d3d}{certChain} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || cert->\hyperlink{structTlsCertDesc_a3b679e405c99f9989713292148f36149}{certChainLen} == 0)
733       \textcolor{keywordflow}{return} \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
734 
735 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED || TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
736    \textcolor{comment}{//RSA certificate?}
737    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN})
738    \{
739       \textcolor{comment}{//This flag tells whether the certificate is acceptable}
740       acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
741 
742       \textcolor{comment}{//Version of TLS prior to TLS 1.2?}
743       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
744       \{
745          \textcolor{comment}{//the signing algorithm for the certificate must be the same as the}
746          \textcolor{comment}{//algorithm for the certificate key}
747          \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_a6859e171d20df5e0c0ec12b940d90822}{signAlgo} != \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA})
748             acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
749       \}
750 
751       \textcolor{comment}{//Filter out certificates with unsupported type}
752       \textcolor{keywordflow}{if}(acceptable && certTypes != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
753       \{
754          \textcolor{comment}{//Loop through the list of supported certificate types}
755          \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < numCertTypes && !acceptable; i++)
756          \{
757             \textcolor{comment}{//Check whether the certificate type is acceptable}
758             \textcolor{keywordflow}{if}(certTypes[i] == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN})
759             \{
760                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
761             \}
762          \}
763       \}
764 
765       \textcolor{comment}{//Filter out certificates that are not compatible with the supported}
766       \textcolor{comment}{//signature schemes}
767       \textcolor{keywordflow}{if}(acceptable && signHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
768       \{
769          \textcolor{comment}{//Retrieve the number of items in the list}
770          n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
771 
772          \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
773          \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
774          \{
775             \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} signAlgo;
776             \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} hashAlgo;
777 
778             \textcolor{comment}{//Retrieve signature and hash algorithms}
779             signAlgo = signHashAlgos->value[i].signature;
780             hashAlgo = signHashAlgos->value[i].hash;
781 
782 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED)}
783             \textcolor{comment}{//RSASSA-PKCS1-v1\_5 signature scheme?}
784             \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a84a0f0f40c0affb557a7e5f157b4e1f5}{TLS\_SIGN\_ALGO\_RSA} &&
785                hashAlgo != \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da5f0d1790061632495ba22e58486033a3}{TLS\_HASH\_ALGO\_NONE} &&
786                context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
787             \{
788                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
789             \}
790             \textcolor{keywordflow}{else}
791 \textcolor{preprocessor}{#endif}
792 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED && TLS\_SHA256\_SUPPORT == ENABLED)}
793             \textcolor{comment}{//RSASSA-PSS RSAE signature scheme with SHA-256?}
794             \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae82458ac6b05ba0e3851a5804f7d5e57}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA256} &&
795                hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC} &&
796                context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
797             \{
798                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
799             \}
800             \textcolor{keywordflow}{else}
801 \textcolor{preprocessor}{#endif}
802 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED && TLS\_SHA384\_SUPPORT == ENABLED)}
803             \textcolor{comment}{//RSASSA-PSS RSAE signature scheme with SHA-384?}
804             \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aef95b8f001c19481fef0409a91b56ce4}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA384} &&
805                hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC} &&
806                context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
807             \{
808                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
809             \}
810             \textcolor{keywordflow}{else}
811 \textcolor{preprocessor}{#endif}
812 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED && TLS\_SHA512\_SUPPORT == ENABLED)}
813             \textcolor{comment}{//RSASSA-PSS RSAE signature scheme with SHA-512?}
814             \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a53d5e91921faf4103349e699d188ea5f}{TLS\_SIGN\_ALGO\_RSA\_PSS\_RSAE\_SHA512} &&
815                hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC} &&
816                context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
817             \{
818                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
819             \}
820             \textcolor{keywordflow}{else}
821 \textcolor{preprocessor}{#endif}
822             \textcolor{comment}{//Unknown signature scheme?}
823             \{
824                acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
825             \}
826          \}
827       \}
828    \}
829    \textcolor{keywordflow}{else}
830 \textcolor{preprocessor}{#endif}
831 \textcolor{preprocessor}{#if (TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
832    \textcolor{comment}{//RSA-PSS certificate?}
833    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN})
834    \{
835       \textcolor{comment}{//TLS 1.2 and TLS 1.3 support RSASSA-PSS signature schemes}
836       \textcolor{keywordflow}{if}(context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
837       \{
838          \textcolor{comment}{//Filter out certificates that are not compatible with the supported}
839          \textcolor{comment}{//signature schemes}
840          \textcolor{keywordflow}{if}(signHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
841          \{
842             \textcolor{comment}{//Retrieve the number of items in the list}
843             n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
844 
845             \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
846             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
847             \{
848                \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} signAlgo;
849                \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} hashAlgo;
850 
851                \textcolor{comment}{//Retrieve signature and hash algorithms}
852                signAlgo = signHashAlgos->value[i].signature;
853                hashAlgo = signHashAlgos->value[i].hash;
854 
855 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
856                \textcolor{comment}{//RSASSA-PSS PSS signature scheme with SHA-256?}
857                \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ad23a08f2a2e5d3231cc9c2ce2e223a8d}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA256} &&
858                   hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC})
859                \{
860                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
861                \}
862                \textcolor{keywordflow}{else}
863 \textcolor{preprocessor}{#endif}
864 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
865                \textcolor{comment}{//RSASSA-PSS PSS signature scheme with SHA-384?}
866                \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223aeb67836989d29de8af7c31ea0ddbe1b7}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA384} &&
867                   hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC})
868                \{
869                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
870                \}
871                \textcolor{keywordflow}{else}
872 \textcolor{preprocessor}{#endif}
873 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
874                \textcolor{comment}{//RSASSA-PSS PSS signature scheme with SHA-512?}
875                \textcolor{keywordflow}{if}(signAlgo == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a1f76baf2d64af86ca98e164c9089a77c}{TLS\_SIGN\_ALGO\_RSA\_PSS\_PSS\_SHA512} &&
876                   hashAlgo == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC})
877                \{
878                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
879                \}
880                \textcolor{keywordflow}{else}
881 \textcolor{preprocessor}{#endif}
882                \textcolor{comment}{//Unknown signature scheme?}
883                \{
884                   acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
885                \}
886             \}
887          \}
888          \textcolor{keywordflow}{else}
889          \{
890             \textcolor{comment}{//The SignatureAlgorithms extension must be specified (refer to}
891             \textcolor{comment}{//RFC 8446, section 4.3.2)}
892             acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
893          \}
894       \}
895       \textcolor{keywordflow}{else}
896       \{
897          \textcolor{comment}{//RSA-PSS is not supported by TLS 1.2 and earlier}
898          acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
899       \}
900    \}
901    \textcolor{keywordflow}{else}
902 \textcolor{preprocessor}{#endif}
903 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
904    \textcolor{comment}{//DSA certificate?}
905    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN})
906    \{
907       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
908       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
909       \{
910          \textcolor{comment}{//This flag tells whether the certificate is acceptable}
911          acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
912 
913          \textcolor{comment}{//Version of TLS prior to TLS 1.2?}
914          \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
915          \{
916             \textcolor{comment}{//the signing algorithm for the certificate must be the same as the}
917             \textcolor{comment}{//algorithm for the certificate key}
918             \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_a6859e171d20df5e0c0ec12b940d90822}{signAlgo} != \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA})
919                acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
920          \}
921 
922          \textcolor{comment}{//Filter out certificates with unsupported type}
923          \textcolor{keywordflow}{if}(acceptable && certTypes != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
924          \{
925             \textcolor{comment}{//Loop through the list of supported certificate types}
926             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < numCertTypes && !acceptable; i++)
927             \{
928                \textcolor{comment}{//Check whether the certificate type is acceptable}
929                \textcolor{keywordflow}{if}(certTypes[i] == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN})
930                \{
931                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
932                \}
933             \}
934          \}
935 
936          \textcolor{comment}{//Filter out certificates that are not compatible with the supported}
937          \textcolor{comment}{//signature schemes}
938          \textcolor{keywordflow}{if}(acceptable && signHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
939          \{
940             \textcolor{comment}{//Retrieve the number of items in the list}
941             n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
942 
943             \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
944             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
945             \{
946                \textcolor{comment}{//Check whether DSA signature scheme is supported}
947                \textcolor{keywordflow}{if}(signHashAlgos->value[i].signature == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a8d024e93d33282e5cb2a1665fb69153d}{TLS\_SIGN\_ALGO\_DSA})
948                \{
949                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
950                \}
951             \}
952          \}
953       \}
954       \textcolor{keywordflow}{else}
955       \{
956          \textcolor{comment}{//TLS 1.3 removes support for DSA certificates}
957          acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
958       \}
959    \}
960    \textcolor{keywordflow}{else}
961 \textcolor{preprocessor}{#endif}
962 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
963    \textcolor{comment}{//ECDSA certificate?}
964    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN})
965    \{
966       \textcolor{comment}{//This flag tells whether the certificate is acceptable}
967       acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
968 
969       \textcolor{comment}{//Version of TLS prior to TLS 1.2?}
970       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
971       \{
972          \textcolor{comment}{//the signing algorithm for the certificate must be the same as the}
973          \textcolor{comment}{//algorithm for the certificate key}
974          \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_a6859e171d20df5e0c0ec12b940d90822}{signAlgo} != \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA})
975             acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
976       \}
977 
978       \textcolor{comment}{//Filter out certificates with unsupported type}
979       \textcolor{keywordflow}{if}(acceptable && certTypes != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
980       \{
981          \textcolor{comment}{//Loop through the list of supported certificate types}
982          \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < numCertTypes && !acceptable; i++)
983          \{
984             \textcolor{comment}{//Check whether the certificate type is acceptable}
985             \textcolor{keywordflow}{if}(certTypes[i] == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN})
986             \{
987                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
988             \}
989          \}
990       \}
991 
992       \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
993       \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
994       \{
995          \textcolor{comment}{//In versions of TLS prior to TLS 1.3, the EllipticCurves extension is}
996          \textcolor{comment}{//used to negotiate ECDSA curves (refer to RFC 8446, section 4.2.7)}
997          \textcolor{keywordflow}{if}(acceptable && curveList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
998          \{
999             \textcolor{comment}{//Retrieve the number of items in the list}
1000             n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(curveList->length) / \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t});
1001 
1002             \textcolor{comment}{//Loop through the list of supported elliptic curves}
1003             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
1004             \{
1005                \textcolor{comment}{//Check whether the elliptic curve is supported}
1006                \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(curveList->value[i]) == cert->\hyperlink{structTlsCertDesc_a8b80a193be9a9d1064b2226ce1dce6bd}{namedCurve})
1007                \{
1008                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1009                \}
1010             \}
1011          \}
1012       \}
1013 
1014       \textcolor{comment}{//Filter out certificates that are not compatible with the supported}
1015       \textcolor{comment}{//signature schemes}
1016       \textcolor{keywordflow}{if}(acceptable && signHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1017       \{
1018          \textcolor{comment}{//Retrieve the number of items in the list}
1019          n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
1020 
1021          \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
1022          \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
1023          \{
1024             \textcolor{comment}{//Check whether ECDSA signature scheme is supported}
1025             \textcolor{keywordflow}{if}(signHashAlgos->value[i].signature == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a47f4ec2313cd5ce1755fc2485cfdd49a}{TLS\_SIGN\_ALGO\_ECDSA})
1026             \{
1027                acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1028             \}
1029          \}
1030       \}
1031    \}
1032    \textcolor{keywordflow}{else}
1033 \textcolor{preprocessor}{#endif}
1034 \textcolor{preprocessor}{#if (TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
1035    \textcolor{comment}{//EdDSA certificate?}
1036    \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN} ||
1037       cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN})
1038    \{
1039       \textcolor{comment}{//TLS 1.2 and TLS 1.3 support EdDSA signature schemes}
1040       \textcolor{keywordflow}{if}((context->version >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2} &&
1041          context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER}) ||
1042          (context->version >= \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3} &&
1043          context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT}))
1044       \{
1045          \textcolor{comment}{//This flag tells whether the certificate is acceptable}
1046          acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1047 
1048          \textcolor{comment}{//Filter out certificates with unsupported type}
1049          \textcolor{keywordflow}{if}(certTypes != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1050          \{
1051             \textcolor{comment}{//Loop through the list of supported certificate types}
1052             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < numCertTypes && !acceptable; i++)
1053             \{
1054                \textcolor{comment}{//Check whether the certificate type is acceptable}
1055                \textcolor{keywordflow}{if}(certTypes[i] == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN})
1056                \{
1057                   acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1058                \}
1059             \}
1060          \}
1061 
1062          \textcolor{comment}{//Filter out certificates that are not compatible with the supported}
1063          \textcolor{comment}{//signature schemes}
1064          \textcolor{keywordflow}{if}(acceptable && signHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1065          \{
1066             \textcolor{comment}{//Retrieve the number of items in the list}
1067             n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(signHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
1068 
1069             \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
1070             \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
1071             \{
1072 \textcolor{preprocessor}{#if (TLS\_ED25519\_SUPPORT == ENABLED)}
1073                \textcolor{comment}{//Ed25519 certificate?}
1074                \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN})
1075                \{
1076                   \textcolor{comment}{//Check whether Ed25519 signature scheme is supported}
1077                   \textcolor{keywordflow}{if}(signHashAlgos->value[i].signature == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223ae6cdc4f0c6a497d2bd2c5d15412759ef}{TLS\_SIGN\_ALGO\_ED25519} &&
1078                      signHashAlgos->value[i].hash == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC})
1079                   \{
1080                      acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1081                   \}
1082                \}
1083                \textcolor{keywordflow}{else}
1084 \textcolor{preprocessor}{#endif}
1085 \textcolor{preprocessor}{#if (TLS\_ED448\_SUPPORT == ENABLED)}
1086                \textcolor{comment}{//Ed448 certificate?}
1087                \textcolor{keywordflow}{if}(cert->\hyperlink{structTlsCertDesc_af06c965a4e4273bfb971f6ab67c715a2}{type} == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN})
1088                \{
1089                   \textcolor{comment}{//Check whether Ed448 signature scheme is supported}
1090                   \textcolor{keywordflow}{if}(signHashAlgos->value[i].signature == \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223a6fbbd4136d21496a9053ccca846ecf3f}{TLS\_SIGN\_ALGO\_ED448} &&
1091                      signHashAlgos->value[i].hash == \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156dab77721d4496c39c41f5984cfd7515882}{TLS\_HASH\_ALGO\_INTRINSIC})
1092                   \{
1093                      acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1094                   \}
1095                \}
1096                \textcolor{keywordflow}{else}
1097 \textcolor{preprocessor}{#endif}
1098                \textcolor{comment}{//Unknown certificate type?}
1099                \{
1100                   acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1101                \}
1102             \}
1103          \}
1104          \textcolor{keywordflow}{else}
1105          \{
1106             \textcolor{comment}{//The certificate is not acceptable}
1107             acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1108          \}
1109       \}
1110       \textcolor{keywordflow}{else}
1111       \{
1112          \textcolor{comment}{//EdDSA is not supported by TLS 1.1 and earlier}
1113          acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1114       \}
1115    \}
1116    \textcolor{keywordflow}{else}
1117 \textcolor{preprocessor}{#endif}
1118    \textcolor{comment}{//Unsupported certificate type?}
1119    \{
1120       \textcolor{comment}{//The certificate is not acceptable}
1121       acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1122    \}
1123 
1124    \textcolor{comment}{//Filter out certificates that are signed with an unsupported algorithm}
1125    \textcolor{keywordflow}{if}(acceptable && certSignHashAlgos != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1126    \{
1127       \textcolor{comment}{//Retrieve the number of items in the list}
1128       n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(certSignHashAlgos->length) / \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a5c96bca6675e08f0abe6e3efb0a78eb3}{TlsSignHashAlgo});
1129 
1130       \textcolor{comment}{//Loop through the list of supported hash/signature algorithm pairs}
1131       \textcolor{keywordflow}{for}(i = 0, acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; i < n && !acceptable; i++)
1132       \{
1133          \textcolor{comment}{//The certificate must be signed using a valid hash algorithm}
1134          \textcolor{keywordflow}{if}(certSignHashAlgos->value[i].signature == cert->\hyperlink{structTlsCertDesc_a6859e171d20df5e0c0ec12b940d90822}{signAlgo} &&
1135             certSignHashAlgos->value[i].hash == cert->\hyperlink{structTlsCertDesc_ad579e322e6688389f98141972794e243}{hashAlgo})
1136          \{
1137             acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1138          \}
1139       \}
1140    \}
1141 
1142    \textcolor{comment}{//Filter out certificates that are issued by a non trusted CA}
1143    \textcolor{keywordflow}{if}(acceptable && certAuthorities != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1144    \{
1145       \textcolor{comment}{//Retrieve the length of the list}
1146       length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(certAuthorities->length);
1147 
1148       \textcolor{comment}{//If the certificate authorities list is empty, then the client}
1149       \textcolor{comment}{//may send any certificate of the appropriate type}
1150       \textcolor{keywordflow}{if}(length > 0)
1151       \{
1152          \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1153          \textcolor{keywordtype}{size\_t} pemCertLen;
1154          \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *certChain;
1155          \textcolor{keywordtype}{size\_t} certChainLen;
1156          \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *derCert;
1157          \textcolor{keywordtype}{size\_t} derCertLen;
1158          \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *certInfo;
1159 
1160          \textcolor{comment}{//The list of acceptable certificate authorities describes the}
1161          \textcolor{comment}{//known roots CA}
1162          acceptable = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1163 
1164          \textcolor{comment}{//Point to the end entity certificate}
1165          certChain = cert->\hyperlink{structTlsCertDesc_ae944e03a44368e92bb4955f890381d3d}{certChain};
1166          \textcolor{comment}{//Get the total length, in bytes, of the certificate chain}
1167          certChainLen = cert->\hyperlink{structTlsCertDesc_a3b679e405c99f9989713292148f36149}{certChainLen};
1168 
1169          \textcolor{comment}{//Allocate a memory buffer to store X.509 certificate info}
1170          certInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
1171 
1172          \textcolor{comment}{//Successful memory allocation?}
1173          \textcolor{keywordflow}{if}(certInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1174          \{
1175             \textcolor{comment}{//Parse the certificate chain}
1176             \textcolor{keywordflow}{while}(certChainLen > 0 && !acceptable)
1177             \{
1178                \textcolor{comment}{//The first pass calculates the length of the DER-encoded}
1179                \textcolor{comment}{//certificate}
1180                error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},
1181                   &derCertLen, &pemCertLen);
1182 
1183                \textcolor{comment}{//Check status code}
1184                \textcolor{keywordflow}{if}(!error)
1185                \{
1186                   \textcolor{comment}{//Allocate a memory buffer to hold the DER-encoded certificate}
1187                   derCert = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(derCertLen);
1188 
1189                   \textcolor{comment}{//Successful memory allocation?}
1190                   \textcolor{keywordflow}{if}(derCert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1191                   \{
1192                      \textcolor{comment}{//The second pass decodes the PEM certificate}
1193                      error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(certChain, certChainLen,
1194                         derCert, &derCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1195 
1196                      \textcolor{comment}{//Check status code}
1197                      \textcolor{keywordflow}{if}(!error)
1198                      \{
1199                         \textcolor{comment}{//Parse X.509 certificate}
1200                         error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(derCert, derCertLen,
1201                            certInfo);
1202                      \}
1203 
1204                      \textcolor{comment}{//Check status code}
1205                      \textcolor{keywordflow}{if}(!error)
1206                      \{
1207                         \textcolor{comment}{//Parse each distinguished name of the list}
1208                         \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i += n + 2)
1209                         \{
1210                            \textcolor{comment}{//Sanity check}
1211                            \textcolor{keywordflow}{if}((i + 2) > length)
1212                               \textcolor{keywordflow}{break};
1213 
1214                            \textcolor{comment}{//Each distinguished name is preceded by a 2-byte}
1215                            \textcolor{comment}{//length field}
1216                            n = \hyperlink{cpu__endian_8h_ae21854587c05993c850b537156470088}{LOAD16BE}(certAuthorities->value + i);
1217 
1218                            \textcolor{comment}{//Make sure the length field is valid}
1219                            \textcolor{keywordflow}{if}((i + n + 2) > length)
1220                               \textcolor{keywordflow}{break};
1221 
1222                            \textcolor{comment}{//Check if the distinguished name matches the root CA}
1223                            \textcolor{keywordflow}{if}(\hyperlink{certificate_2x509__cert__validate_8c_ac0134610dc71d5ff612ac1bc609b7981}{x509CompareName}(certAuthorities->value + i + 2, n,
1224                               certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_a8f9e1f73fbccfe993464a10bf6420a69}{issuer}.\hyperlink{structX509Name_a16f889e11f79b38a1ade245692857253}{rawData},
1225                               certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_a8f9e1f73fbccfe993464a10bf6420a69}{issuer}.\hyperlink{structX509Name_a0f57dd73feee5e3a4aa769fa1ecf3766}{rawDataLen}))
1226                            \{
1227                               acceptable = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1228                               \textcolor{keywordflow}{break};
1229                            \}
1230                         \}
1231                      \}
1232 
1233                      \textcolor{comment}{//Free previously allocated memory}
1234                      \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(derCert);
1235                   \}
1236 
1237                   \textcolor{comment}{//Advance read pointer}
1238                   certChain += pemCertLen;
1239                   certChainLen -= pemCertLen;
1240                \}
1241                \textcolor{keywordflow}{else}
1242                \{
1243                   \textcolor{comment}{//No more CA certificates in the list}
1244                   \textcolor{keywordflow}{break};
1245                \}
1246             \}
1247 
1248             \textcolor{comment}{//Free previously allocated memory}
1249             \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(certInfo);
1250          \}
1251       \}
1252    \}
1253 
1254    \textcolor{comment}{//The return value specifies whether all the criteria were matched}
1255    \textcolor{keywordflow}{return} acceptable;
1256 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_a271d9a0eaaca97bb85f64c7ad176c33e}\label{tls__certificate_8h_a271d9a0eaaca97bb85f64c7ad176c33e}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Parse\+Certificate\+List@{tls\+Parse\+Certificate\+List}}
\index{tls\+Parse\+Certificate\+List@{tls\+Parse\+Certificate\+List}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Parse\+Certificate\+List()}{tlsParseCertificateList()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Certificate\+List (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse certificate chain. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Input stream where to read the certificate chain \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 287 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
289 \{
290    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
291    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} certValidResult;
292    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
293    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
294    \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *subjectName;
295    \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *certInfo;
296    \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *issuerCertInfo;
297 
298    \textcolor{comment}{//Initialize X.509 certificates}
299    certInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
300    issuerCertInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
301 
302    \textcolor{comment}{//Start of exception handling block}
303    \textcolor{keywordflow}{do}
304    \{
305       \textcolor{comment}{//Allocate a memory buffer to store X.509 certificate info}
306       certInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
307       \textcolor{comment}{//Failed to allocate memory?}
308       \textcolor{keywordflow}{if}(certInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
309       \{
310          \textcolor{comment}{//Report an error}
311          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
312          \textcolor{keywordflow}{break};
313       \}
314 
315       \textcolor{comment}{//Allocate a memory buffer to store the parent certificate}
316       issuerCertInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
317       \textcolor{comment}{//Failed to allocate memory?}
318       \textcolor{keywordflow}{if}(issuerCertInfo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
319       \{
320          \textcolor{comment}{//Report an error}
321          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
322          \textcolor{keywordflow}{break};
323       \}
324 
325       \textcolor{comment}{//The end-user certificate is preceded by a 3-byte length field}
326       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < 3)
327       \{
328          \textcolor{comment}{//Report an error}
329          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
330          \textcolor{keywordflow}{break};
331       \}
332 
333       \textcolor{comment}{//Get the size occupied by the certificate}
334       n = \hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
335       \textcolor{comment}{//Jump to the beginning of the DER-encoded certificate}
336       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += 3;
337       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 3;
338 
339       \textcolor{comment}{//Malformed Certificate message?}
340       \textcolor{keywordflow}{if}(n > \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
341       \{
342          \textcolor{comment}{//Report an error}
343          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
344          \textcolor{keywordflow}{break};
345       \}
346 
347       \textcolor{comment}{//Display ASN.1 structure}
348       error = \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, n, 0);
349       \textcolor{comment}{//Any error to report?}
350       \textcolor{keywordflow}{if}(error)
351          \textcolor{keywordflow}{break};
352 
353       \textcolor{comment}{//Parse end-user certificate}
354       error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, n, certInfo);
355       \textcolor{comment}{//Failed to parse the X.509 certificate?}
356       \textcolor{keywordflow}{if}(error)
357       \{
358          \textcolor{comment}{//Report an error}
359          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
360          \textcolor{keywordflow}{break};
361       \}
362 
363       \textcolor{comment}{//Check certificate key usage}
364       error = \hyperlink{tls__certificate_8c_ae59caad5f5a42aa9d869bbd1ff8bbe9e}{tlsCheckKeyUsage}(certInfo, context->entity,
365          context->keyExchMethod);
366       \textcolor{comment}{//Any error to report?}
367       \textcolor{keywordflow}{if}(error)
368          \textcolor{keywordflow}{break};
369 
370       \textcolor{comment}{//Extract the public key from the end-user certificate}
371       error = \hyperlink{tls__certificate_8c_ab69e8470ee1ec5b621ca54f7ce93fb9b}{tlsReadSubjectPublicKey}(context,
372          &certInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_ae6d392cbe0fcd240ab1dabaac465ca95}{subjectPublicKeyInfo});
373       \textcolor{comment}{//Any error to report?}
374       \textcolor{keywordflow}{if}(error)
375          \textcolor{keywordflow}{break};
376 
377 \textcolor{preprocessor}{#if (TLS\_CLIENT\_SUPPORT == ENABLED)}
378       \textcolor{comment}{//Client mode?}
379       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
380       \{
381          \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffd}{TlsCertificateType} certType;
382          \hyperlink{tls_8h_abe6ce436cb0d777df29e0af7bf800223}{TlsSignatureAlgo} certSignAlgo;
383          \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156d}{TlsHashAlgo} certHashAlgo;
384          \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{TlsNamedGroup} namedCurve;
385 
386          \textcolor{comment}{//Retrieve the type of the X.509 certificate}
387          error = \hyperlink{tls__certificate_8c_a87df47b3fef52984054b8e49a72d2224}{tlsGetCertificateType}(certInfo, &certType, &certSignAlgo,
388             &certHashAlgo, &namedCurve);
389          \textcolor{comment}{//Unsupported certificate?}
390          \textcolor{keywordflow}{if}(error)
391             \textcolor{keywordflow}{break};
392 
393          \textcolor{comment}{//Version of TLS prior to TLS 1.3?}
394          \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
395          \{
396             \textcolor{comment}{//ECDSA certificate?}
397             \textcolor{keywordflow}{if}(certType == \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN})
398             \{
399                \textcolor{comment}{//Make sure the elliptic curve is supported}
400                \textcolor{keywordflow}{if}(\hyperlink{tls__misc_8c_a1d99ba7208ae993d388e7849fa5dce71}{tlsGetCurveInfo}(context, namedCurve) == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
401                \{
402                   error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
403                   \textcolor{keywordflow}{break};
404                \}
405             \}
406          \}
407 
408          \textcolor{comment}{//Point to the subject name}
409          subjectName = context->serverName;
410 
411          \textcolor{comment}{//Check the subject name in the server certificate against the actual}
412          \textcolor{comment}{//FQDN name that is being requested}
413          error = \hyperlink{certificate_2x509__cert__validate_8c_ac72ef1917acb42ac1e984731723c7e57}{x509CheckSubjectName}(certInfo, subjectName);
414          \textcolor{comment}{//Any error to report?}
415          \textcolor{keywordflow}{if}(error)
416          \{
417             \textcolor{comment}{//Debug message}
418             \hyperlink{debug_8h_a72b9761add7486364dba449091cd2579}{TRACE\_WARNING}(\textcolor{stringliteral}{"Server name mismatch!\(\backslash\)r\(\backslash\)n"});
419 
420             \textcolor{comment}{//Report an error}
421             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
422             \textcolor{keywordflow}{break};
423          \}
424       \}
425       \textcolor{keywordflow}{else}
426 \textcolor{preprocessor}{#endif}
427       \textcolor{comment}{//Server mode?}
428       \{
429          \textcolor{comment}{//Do not check name constraints}
430          subjectName = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
431       \}
432 
433       \textcolor{comment}{//Check if the end-user certificate can be matched with a trusted CA}
434       certValidResult = \hyperlink{tls__certificate_8c_ae79881159a47eb47b41cb0c2f175839d}{tlsValidateCertificate}(context, certInfo, 0,
435          subjectName);
436 
437       \textcolor{comment}{//Check validation result}
438       \textcolor{keywordflow}{if}(certValidResult != \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} && certValidResult != 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA})
439       \{
440          \textcolor{comment}{//Report an error}
441          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
442          \textcolor{keywordflow}{break};
443       \}
444 
445       \textcolor{comment}{//Next certificate}
446       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
447       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
448 
449 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
450       \textcolor{comment}{//TLS 1.3 currently selected?}
451       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
452       \{
453          \textcolor{comment}{//Parse the list of extensions for the current CertificateEntry}
454          error = \hyperlink{tls13__misc_8h_ac8d252b35dc8c97c9661d01dd6ac4ac7}{tls13ParseCertExtensions}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &n);
455          \textcolor{comment}{//Any error to report?}
456          \textcolor{keywordflow}{if}(error)
457             \textcolor{keywordflow}{break};
458 
459          \textcolor{comment}{//Point to the next field}
460          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
461          \textcolor{comment}{//Remaining bytes to process}
462          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
463       \}
464 \textcolor{preprocessor}{#endif}
465 
466       \textcolor{comment}{//PKIX path validation}
467       \textcolor{keywordflow}{for}(i = 0; \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0; i++)
468       \{
469          \textcolor{comment}{//Each intermediate certificate is preceded by a 3-byte length field}
470          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < 3)
471          \{
472             \textcolor{comment}{//Report an error}
473             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
474             \textcolor{keywordflow}{break};
475          \}
476 
477          \textcolor{comment}{//Get the size occupied by the certificate}
478          n = \hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
479          \textcolor{comment}{//Jump to the beginning of the DER-encoded certificate}
480          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += 3;
481          \textcolor{comment}{//Remaining bytes to process}
482          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 3;
483 
484          \textcolor{comment}{//Malformed Certificate message?}
485          \textcolor{keywordflow}{if}(n > \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length})
486          \{
487             \textcolor{comment}{//Report an error}
488             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
489             \textcolor{keywordflow}{break};
490          \}
491 
492          \textcolor{comment}{//Display ASN.1 structure}
493          error = \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, n, 0);
494          \textcolor{comment}{//Any error to report?}
495          \textcolor{keywordflow}{if}(error)
496             \textcolor{keywordflow}{break};
497 
498          \textcolor{comment}{//Parse intermediate certificate}
499          error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, n, issuerCertInfo);
500          \textcolor{comment}{//Failed to parse the X.509 certificate?}
501          \textcolor{keywordflow}{if}(error)
502          \{
503             \textcolor{comment}{//Report an error}
504             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
505             \textcolor{keywordflow}{break};
506          \}
507 
508          \textcolor{comment}{//Certificate chain validation in progress?}
509          \textcolor{keywordflow}{if}(certValidResult == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA})
510          \{
511             \textcolor{comment}{//Validate current certificate}
512             error = \hyperlink{certificate_2x509__cert__validate_8c_a1d829c42c03a21d7d0325d214db51f0d}{x509ValidateCertificate}(certInfo, issuerCertInfo, i);
513             \textcolor{comment}{//Certificate validation failed?}
514             \textcolor{keywordflow}{if}(error)
515                \textcolor{keywordflow}{break};
516 
517             \textcolor{comment}{//Check name constraints}
518             error = \hyperlink{certificate_2x509__cert__validate_8c_aba02729cea03e1500a1839c15d1f1149}{x509CheckNameConstraints}(subjectName, issuerCertInfo);
519             \textcolor{comment}{//Should the application reject the certificate?}
520             \textcolor{keywordflow}{if}(error)
521                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
522 
523             \textcolor{comment}{//Check the version of the certificate}
524             \textcolor{keywordflow}{if}(issuerCertInfo->\hyperlink{structX509CertificateInfo_acfa4445df39031f204f8936a2eec189e}{tbsCert}.\hyperlink{structX509TbsCertificate_a651e18b39b7492e6e739823ea19129d9}{version} < \hyperlink{certificate_2x509__common_8h_a42c631650a1a4fbe9d70d54d99dcac26addaa01d4830baa29e7e19044f0a656eb}{X509\_VERSION\_3})
525             \{
526                \textcolor{comment}{//Conforming implementations may choose to reject all version 1}
527                \textcolor{comment}{//and version 2 intermediate certificates (refer to RFC 5280,}
528                \textcolor{comment}{//section 6.1.4)}
529                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
530                \textcolor{keywordflow}{break};
531             \}
532 
533             \textcolor{comment}{//Check if the intermediate certificate can be matched with a}
534             \textcolor{comment}{//trusted CA}
535             certValidResult = \hyperlink{tls__certificate_8c_ae79881159a47eb47b41cb0c2f175839d}{tlsValidateCertificate}(context, issuerCertInfo,
536                i, subjectName);
537 
538             \textcolor{comment}{//Check validation result}
539             \textcolor{keywordflow}{if}(certValidResult != \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} && certValidResult != 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA})
540             \{
541                \textcolor{comment}{//Report an error}
542                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
543                \textcolor{keywordflow}{break};
544             \}
545          \}
546 
547          \textcolor{comment}{//Keep track of the issuer certificate}
548          *certInfo = *issuerCertInfo;
549 
550          \textcolor{comment}{//Next certificate}
551          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
552          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
553 
554 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
555          \textcolor{comment}{//TLS 1.3 currently selected?}
556          \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
557          \{
558             \textcolor{comment}{//Parse the list of extensions for the current CertificateEntry}
559             error = \hyperlink{tls13__misc_8h_ac8d252b35dc8c97c9661d01dd6ac4ac7}{tls13ParseCertExtensions}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &n);
560             \textcolor{comment}{//Any error to report?}
561             \textcolor{keywordflow}{if}(error)
562                \textcolor{keywordflow}{break};
563 
564             \textcolor{comment}{//Point to the next field}
565             \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
566             \textcolor{comment}{//Remaining bytes to process}
567             \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
568          \}
569 \textcolor{preprocessor}{#endif}
570       \}
571 
572       \textcolor{comment}{//Certificate chain validation failed?}
573       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} && certValidResult != \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
574       \{
575          \textcolor{comment}{//A valid certificate chain or partial chain was received, but the}
576          \textcolor{comment}{//certificate was not accepted because the CA certificate could not}
577          \textcolor{comment}{//be matched with a known, trusted CA}
578          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA};
579       \}
580 
581       \textcolor{comment}{//End of exception handling block}
582    \} \textcolor{keywordflow}{while}(0);
583 
584    \textcolor{comment}{//Free previously allocated memory}
585    \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(certInfo);
586    \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(issuerCertInfo);
587 
588    \textcolor{comment}{//Return status code}
589    \textcolor{keywordflow}{return} error;
590 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_aa425ea4126c69179a25b0d4c07049a66}\label{tls__certificate_8h_aa425ea4126c69179a25b0d4c07049a66}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Parse\+Raw\+Public\+Key@{tls\+Parse\+Raw\+Public\+Key}}
\index{tls\+Parse\+Raw\+Public\+Key@{tls\+Parse\+Raw\+Public\+Key}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Parse\+Raw\+Public\+Key()}{tlsParseRawPublicKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Raw\+Public\+Key (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse raw public key. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Input stream where to read the raw public key \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 601 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
603 \{
604    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
605 
606 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
607    \textcolor{comment}{//Any registered callback?}
608    \textcolor{keywordflow}{if}(context->rpkVerifyCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
609    \{
610       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
611       \textcolor{keywordtype}{size\_t} rawPublicKeyLen;
612       \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *rawPublicKey;
613       \hyperlink{structX509SubjectPublicKeyInfo}{X509SubjectPublicKeyInfo} subjectPublicKeyInfo;
614 
615 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
616       \textcolor{comment}{//TLS 1.3 currently selected?}
617       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
618       \{
619          \textcolor{comment}{//The raw public key is preceded by a 3-byte length field}
620          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < 3)
621             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
622 
623          \textcolor{comment}{//Get the size occupied by the raw public key}
624          rawPublicKeyLen = \hyperlink{cpu__endian_8h_ae0950d84d4cadc7bef52fc340c49c720}{LOAD24BE}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p});
625          \textcolor{comment}{//Advance data pointer}
626          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += 3;
627          \textcolor{comment}{//Remaining bytes to process}
628          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= 3;
629 
630          \textcolor{comment}{//Malformed Certificate message?}
631          \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} < rawPublicKeyLen)
632             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
633       \}
634       \textcolor{keywordflow}{else}
635 \textcolor{preprocessor}{#endif}
636       \{
637          \textcolor{comment}{//The payload of the Certificate message contains a SubjectPublicKeyInfo}
638          \textcolor{comment}{//structure}
639          rawPublicKeyLen = \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
640       \}
641 
642       \textcolor{comment}{//Point to the raw public key}
643       rawPublicKey = \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
644 
645       \textcolor{comment}{//Decode the SubjectPublicKeyInfo structure}
646       error = \hyperlink{certificate_2x509__cert__parse_8c_a17bacf95e872d7fdcd6cec43b1724dd6}{x509ParseSubjectPublicKeyInfo}(rawPublicKey, rawPublicKeyLen, &n,
647          &subjectPublicKeyInfo);
648       \textcolor{comment}{//Any error to report?}
649       \textcolor{keywordflow}{if}(error)
650          \textcolor{keywordflow}{return} error;
651 
652       \textcolor{comment}{//Advance data pointer}
653       \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += rawPublicKeyLen;
654       \textcolor{comment}{//Remaining bytes to process}
655       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= rawPublicKeyLen;
656 
657 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
658       \textcolor{comment}{//TLS 1.3 currently selected?}
659       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
660       \{
661          \textcolor{comment}{//Parse the list of extensions for the current CertificateEntry}
662          error = \hyperlink{tls13__misc_8h_ac8d252b35dc8c97c9661d01dd6ac4ac7}{tls13ParseCertExtensions}(\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &n);
663          \textcolor{comment}{//Any error to report?}
664          \textcolor{keywordflow}{if}(error)
665             \textcolor{keywordflow}{return} error;
666 
667          \textcolor{comment}{//Advance data pointer}
668          \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
669          \textcolor{comment}{//Remaining bytes to process}
670          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
671       \}
672 \textcolor{preprocessor}{#endif}
673 
674       \textcolor{comment}{//If the RawPublicKey certificate type was negotiated, the certificate}
675       \textcolor{comment}{//list must contain no more than one CertificateEntry (refer to RFC 8446,}
676       \textcolor{comment}{//section 4.4.2)}
677       \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} != 0)
678          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
679 
680       \textcolor{comment}{//Extract the public key from the SubjectPublicKeyInfo structure}
681       error = \hyperlink{tls__certificate_8c_ab69e8470ee1ec5b621ca54f7ce93fb9b}{tlsReadSubjectPublicKey}(context, &subjectPublicKeyInfo);
682       \textcolor{comment}{//Any error to report?}
683       \textcolor{keywordflow}{if}(error)
684          \textcolor{keywordflow}{return} error;
685 
686       \textcolor{comment}{//When raw public keys are used, authentication of the peer is supported}
687       \textcolor{comment}{//only through authentication of the received SubjectPublicKeyInfo via an}
688       \textcolor{comment}{//out-of-band method}
689       error = context->rpkVerifyCallback(context, rawPublicKey,
690          rawPublicKeyLen);
691    \}
692    \textcolor{keywordflow}{else}
693 \textcolor{preprocessor}{#endif}
694    \{
695       \textcolor{comment}{//Report an error}
696       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
697    \}
698 
699    \textcolor{comment}{//Return status code}
700    \textcolor{keywordflow}{return} error;
701 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_ab69e8470ee1ec5b621ca54f7ce93fb9b}\label{tls__certificate_8h_ab69e8470ee1ec5b621ca54f7ce93fb9b}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Read\+Subject\+Public\+Key@{tls\+Read\+Subject\+Public\+Key}}
\index{tls\+Read\+Subject\+Public\+Key@{tls\+Read\+Subject\+Public\+Key}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Read\+Subject\+Public\+Key()}{tlsReadSubjectPublicKey()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Read\+Subject\+Public\+Key (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structX509SubjectPublicKeyInfo}{X509\+Subject\+Public\+Key\+Info} $\ast$}]{subject\+Public\+Key\+Info }\end{DoxyParamCaption})}



Extract the subject public key from the received certificate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em subject\+Public\+Key\+Info} & Pointer to the subject\textquotesingle{}s public key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1697 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
1699 \{
1700    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1701    \textcolor{keywordtype}{size\_t} oidLen;
1702    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid};
1703 
1704    \textcolor{comment}{//Retrieve public key identifier}
1705    oid = subjectPublicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_a90a8b808782b18de901306acd49b0706}{oid};
1706    oidLen = subjectPublicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_a7c5d6f507f653f6085ba56e6b4b55912}{oidLen};
1707 
1708 \textcolor{preprocessor}{#if (TLS\_RSA\_SIGN\_SUPPORT == ENABLED || TLS\_RSA\_PSS\_SIGN\_SUPPORT == ENABLED)}
1709    \textcolor{comment}{//RSA public key?}
1710    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID})) ||
1711       !\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID})))
1712    \{
1713       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1714 
1715       \textcolor{comment}{//Import the RSA public key}
1716       error = \hyperlink{x509__key__parse_8c_a46b55059a7e4840fa58c40d2c2b44cd4}{x509ImportRsaPublicKey}(subjectPublicKeyInfo,
1717          &context->peerRsaPublicKey);
1718 
1719       \textcolor{comment}{//Check status code}
1720       \textcolor{keywordflow}{if}(!error)
1721       \{
1722          \textcolor{comment}{//Get the length of the modulus, in bits}
1723          k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&context->peerRsaPublicKey.n);
1724 
1725          \textcolor{comment}{//Applications should also enforce minimum and maximum key sizes (refer}
1726          \textcolor{comment}{//to RFC 8446, appendix C.2)}
1727          \textcolor{keywordflow}{if}(k < TLS\_MIN\_RSA\_MODULUS\_SIZE || k > \hyperlink{tls_8h_ad548e827e25e05aaca6a1a062c5c5c8b}{TLS\_MAX\_RSA\_MODULUS\_SIZE})
1728          \{
1729             \textcolor{comment}{//Report an error}
1730             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1731          \}
1732       \}
1733 
1734       \textcolor{comment}{//Check status code}
1735       \textcolor{keywordflow}{if}(!error)
1736       \{
1737          \textcolor{comment}{//RSA or RSA-PSS certificate?}
1738          \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_a05da0bdcba7d0be3da2cc921a8a0dd50}{RSA\_ENCRYPTION\_OID})))
1739          \{
1740             \textcolor{comment}{//The certificate contains a valid RSA public key}
1741             context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN};
1742          \}
1743          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{rsa_8c_ac136e2cc009f56598c67cf31f37c0d2b}{RSASSA\_PSS\_OID})))
1744          \{
1745             \textcolor{comment}{//The certificate contains a valid RSA-PSS public key}
1746             context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN};
1747          \}
1748          \textcolor{keywordflow}{else}
1749          \{
1750             \textcolor{comment}{//Just for sanity}
1751             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1752          \}
1753       \}
1754    \}
1755    \textcolor{keywordflow}{else}
1756 \textcolor{preprocessor}{#endif}
1757 \textcolor{preprocessor}{#if (TLS\_DSA\_SIGN\_SUPPORT == ENABLED)}
1758    \textcolor{comment}{//DSA public key?}
1759    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{dsa_8c_aec62d423add8486c829eacb574ebe4f3}{DSA\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{dsa_8c_aec62d423add8486c829eacb574ebe4f3}{DSA\_OID})))
1760    \{
1761       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1762 
1763       \textcolor{comment}{//Import the DSA public key}
1764       error = \hyperlink{x509__key__parse_8c_aa028d369d57dd4e935aed069e8274de9}{x509ImportDsaPublicKey}(subjectPublicKeyInfo,
1765          &context->peerDsaPublicKey);
1766 
1767       \textcolor{comment}{//Check status code}
1768       \textcolor{keywordflow}{if}(!error)
1769       \{
1770          \textcolor{comment}{//Get the length of the prime modulus, in bits}
1771          k = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&context->peerDsaPublicKey.p);
1772 
1773          \textcolor{comment}{//Make sure the prime modulus is acceptable}
1774          \textcolor{keywordflow}{if}(k < TLS\_MIN\_DSA\_MODULUS\_SIZE || k > \hyperlink{tls_8h_abbce9f5afb0e8301b492d943a7525b6b}{TLS\_MAX\_DSA\_MODULUS\_SIZE})
1775          \{
1776             \textcolor{comment}{//Report an error}
1777             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1778          \}
1779       \}
1780 
1781       \textcolor{comment}{//Check status code}
1782       \textcolor{keywordflow}{if}(!error)
1783       \{
1784          \textcolor{comment}{//The certificate contains a valid DSA public key}
1785          context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN};
1786       \}
1787    \}
1788    \textcolor{keywordflow}{else}
1789 \textcolor{preprocessor}{#endif}
1790 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
1791    \textcolor{comment}{//EC public key?}
1792    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec_8c_a5ff93c201b1e50b6fda04774a2fa537c}{EC\_PUBLIC\_KEY\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec_8c_a5ff93c201b1e50b6fda04774a2fa537c}{EC\_PUBLIC\_KEY\_OID})))
1793    \{
1794       \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
1795 
1796       \textcolor{comment}{//Retrieve EC domain parameters}
1797       curveInfo = \hyperlink{certificate_2x509__common_8c_a6f6416a69dd75fe6f18aab77a0f7205c}{x509GetCurveInfo}(subjectPublicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.\hyperlink{structX509EcParameters_a122c5387fb2f12374a905ecfd2ca4c86}{namedCurve},
1798          subjectPublicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af45ca47e19db60631c9fdb4d4b62ed10}{ecParams}.\hyperlink{structX509EcParameters_ac58081bd63ed68d0cb101ff7e65667ec}{namedCurveLen});
1799 
1800       \textcolor{comment}{//Make sure the specified elliptic curve is supported}
1801       \textcolor{keywordflow}{if}(curveInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1802       \{
1803          \textcolor{comment}{//Load EC domain parameters}
1804          error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&context->peerEcParams, curveInfo);
1805 
1806          \textcolor{comment}{//Check status code}
1807          \textcolor{keywordflow}{if}(!error)
1808          \{
1809             \textcolor{comment}{//Retrieve the EC public key}
1810             error = \hyperlink{ec_8c_ae707a9a99979ce0b291ac6c0f8d380fd}{ecImport}(&context->peerEcParams, &context->peerEcPublicKey,
1811                subjectPublicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q}, subjectPublicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen});
1812          \}
1813       \}
1814       \textcolor{keywordflow}{else}
1815       \{
1816          \textcolor{comment}{//The specified elliptic curve is not supported}
1817          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1818       \}
1819 
1820       \textcolor{comment}{//Check status code}
1821       \textcolor{keywordflow}{if}(!error)
1822       \{
1823          \textcolor{comment}{//The certificate contains a valid EC public key}
1824          context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN};
1825       \}
1826    \}
1827    \textcolor{keywordflow}{else}
1828 \textcolor{preprocessor}{#endif}
1829 \textcolor{preprocessor}{#if (TLS\_EDDSA\_SIGN\_SUPPORT == ENABLED)}
1830    \textcolor{comment}{//Ed25519 or Ed448 public key?}
1831    \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID})) ||
1832       !\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID})))
1833    \{
1834       \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
1835 
1836       \textcolor{comment}{//Retrieve EC domain parameters}
1837       curveInfo = \hyperlink{certificate_2x509__common_8c_a6f6416a69dd75fe6f18aab77a0f7205c}{x509GetCurveInfo}(oid, oidLen);
1838 
1839       \textcolor{comment}{//Make sure the specified elliptic curve is supported}
1840       \textcolor{keywordflow}{if}(curveInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1841       \{
1842          \textcolor{comment}{//Load EC domain parameters}
1843          error = \hyperlink{ec_8c_ab3d7ebcb8fd2e79990ef25e39a68f4a5}{ecLoadDomainParameters}(&context->peerEcParams, curveInfo);
1844 
1845          \textcolor{comment}{//Check status code}
1846          \textcolor{keywordflow}{if}(!error)
1847          \{
1848             \textcolor{comment}{//Retrieve the EC public key}
1849             error = \hyperlink{ec_8c_ae707a9a99979ce0b291ac6c0f8d380fd}{ecImport}(&context->peerEcParams, &context->peerEcPublicKey,
1850                subjectPublicKeyInfo->\hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a40d2e839059193580054d744529d0131}{q}, subjectPublicKeyInfo->
      \hyperlink{structX509SubjectPublicKeyInfo_af9b3b1e9d01c44192f01edbf14001622}{ecPublicKey}.\hyperlink{structX509EcPublicKey_a62e05abdaa08ec4418a624e44b84a5b8}{qLen});
1851          \}
1852       \}
1853       \textcolor{keywordflow}{else}
1854       \{
1855          \textcolor{comment}{//The specified elliptic curve is not supported}
1856          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1857       \}
1858 
1859       \textcolor{comment}{//Check status code}
1860       \textcolor{keywordflow}{if}(!error)
1861       \{
1862          \textcolor{comment}{//Ed25519 or Ed448 certificate?}
1863          \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a0c0db5ac9072998c05e021d51fd03992}{ED25519\_OID})))
1864          \{
1865             \textcolor{comment}{//The certificate contains a valid Ed25519 public key}
1866             context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN};
1867          \}
1868          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(oid, oidLen, \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ad355985d25e281438e8d813c171aea13}{ED448\_OID})))
1869          \{
1870             \textcolor{comment}{//The certificate contains a valid Ed448 public key}
1871             context->peerCertType = \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN};
1872          \}
1873          \textcolor{keywordflow}{else}
1874          \{
1875             \textcolor{comment}{//Just for sanity}
1876             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE};
1877          \}
1878       \}
1879    \}
1880    \textcolor{keywordflow}{else}
1881 \textcolor{preprocessor}{#endif}
1882    \textcolor{comment}{//Invalid public key?}
1883    \{
1884       \textcolor{comment}{//The certificate does not contain any valid public key}
1885       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1886    \}
1887 
1888 \textcolor{preprocessor}{#if (TLS\_CLIENT\_SUPPORT == ENABLED)}
1889    \textcolor{comment}{//Check status code}
1890    \textcolor{keywordflow}{if}(!error)
1891    \{
1892       \textcolor{comment}{//Client mode?}
1893       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
1894       \{
1895          \textcolor{comment}{//Check key exchange method}
1896          \textcolor{keywordflow}{if}(context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a01c48fe0c56e76f59032069e7c7da49e}{TLS\_KEY\_EXCH\_RSA} ||
1897             context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a01660ec1808dd6a8b5250b16d81502e4}{TLS\_KEY\_EXCH\_DHE\_RSA} ||
1898             context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75ad9ebbdd436027753829ea5b6cd4b810b}{TLS\_KEY\_EXCH\_ECDHE\_RSA} ||
1899             context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a38a6d0551d2fbd9480b6c233c1242d4c}{TLS\_KEY\_EXCH\_RSA\_PSK})
1900          \{
1901             \textcolor{comment}{//The client expects a valid RSA certificate whenever the agreed-}
1902             \textcolor{comment}{//upon key exchange method uses RSA certificates for authentication}
1903             \textcolor{keywordflow}{if}(context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN} &&
1904                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN})
1905             \{
1906                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1907             \}
1908          \}
1909          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75ac256323d1e243a2e7a435abce34dbd39}{TLS\_KEY\_EXCH\_DHE\_DSS})
1910          \{
1911             \textcolor{comment}{//The client expects a valid DSA certificate whenever the agreed-}
1912             \textcolor{comment}{//upon key exchange method uses DSA certificates for authentication}
1913             \textcolor{keywordflow}{if}(context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda925aea3c96483609ae2867b10693b4c4}{TLS\_CERT\_DSS\_SIGN})
1914             \{
1915                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1916             \}
1917          \}
1918          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a14c521a28278eecd181953c37b784cb7}{TLS\_KEY\_EXCH\_ECDHE\_ECDSA})
1919          \{
1920             \textcolor{comment}{//The client expects a valid ECDSA certificate whenever the agreed-}
1921             \textcolor{comment}{//upon key exchange method uses ECDSA certificates for authentication}
1922             \textcolor{keywordflow}{if}(context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN} &&
1923                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN} &&
1924                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN})
1925             \{
1926                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1927             \}
1928          \}
1929          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a73afc728c1b23fef9f03ce4a08d0e20b}{TLS13\_KEY\_EXCH\_DHE} ||
1930             context->keyExchMethod == \hyperlink{tls_8h_a10c9078f6485419c2b8644b573ef0b75a3cde206533769f2a174205875bd0b8da}{TLS13\_KEY\_EXCH\_ECDHE})
1931          \{
1932             \textcolor{comment}{//TLS 1.3 removes support for DSA certificates}
1933             \textcolor{keywordflow}{if}(context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda3a76023fc80c787bffed357a4560351b}{TLS\_CERT\_RSA\_SIGN} &&
1934                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda99a10e4ee12c5c331833b13d5a145480}{TLS\_CERT\_RSA\_PSS\_SIGN} &&
1935                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffdab47f2dd2c4d36761f920f8a1af97f6ec}{TLS\_CERT\_ECDSA\_SIGN} &&
1936                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda949e4ce74babee5ea5e6a01282283512}{TLS\_CERT\_ED25519\_SIGN} &&
1937                context->peerCertType != \hyperlink{tls_8h_a9bd45859e2bffbd3edb8beff07240ffda07a1b669a85b822306b5a95aa069ed27}{TLS\_CERT\_ED448\_SIGN})
1938             \{
1939                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1940             \}
1941          \}
1942          \textcolor{keywordflow}{else}
1943          \{
1944             \textcolor{comment}{//Just for sanity}
1945             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1946          \}
1947       \}
1948    \}
1949 \textcolor{preprocessor}{#endif}
1950 
1951    \textcolor{comment}{//Return status code}
1952    \textcolor{keywordflow}{return} error;
1953 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__certificate_8h_ae79881159a47eb47b41cb0c2f175839d}\label{tls__certificate_8h_ae79881159a47eb47b41cb0c2f175839d}} 
\index{tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}!tls\+Validate\+Certificate@{tls\+Validate\+Certificate}}
\index{tls\+Validate\+Certificate@{tls\+Validate\+Certificate}!tls\+\_\+certificate.\+h@{tls\+\_\+certificate.\+h}}
\subsubsection{\texorpdfstring{tls\+Validate\+Certificate()}{tlsValidateCertificate()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Validate\+Certificate (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structX509CertificateInfo}{X509\+Certificate\+Info} $\ast$}]{cert\+Info,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{path\+Len,  }\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{subject\+Name }\end{DoxyParamCaption})}



Verify certificate against root C\+As. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em cert\+Info} & X.\+509 certificate to be verified \\
\hline
\mbox{\tt in}  & {\em path\+Len} & Certificate path length \\
\hline
\mbox{\tt in}  & {\em subject\+Name} & Subject name (optional parameter) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1268 of file tls\+\_\+certificate.\+c.


\begin{DoxyCode}
1271 \{
1272    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1273    \textcolor{keywordtype}{size\_t} pemCertLen;
1274    \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_a52d999bffef4c5d89345bd0ce7d91042}{trustedCaList};
1275    \textcolor{keywordtype}{size\_t} trustedCaListLen;
1276    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *derCert;
1277    \textcolor{keywordtype}{size\_t} derCertLen;
1278    \hyperlink{structX509CertificateInfo}{X509CertificateInfo} *caCertInfo;
1279 
1280    \textcolor{comment}{//Initialize status code}
1281    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA};
1282 
1283    \textcolor{comment}{//Any registered callback?}
1284    \textcolor{keywordflow}{if}(context->certVerifyCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1285    \{
1286       \textcolor{comment}{//Invoke user callback function}
1287       error = context->certVerifyCallback(context, certInfo, pathLen,
1288          context->certVerifyParam);
1289    \}
1290 
1291    \textcolor{comment}{//Unknown certification authority?}
1292    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA})
1293    \{
1294       \textcolor{comment}{//Check whether the certificate should be checked against root CAs}
1295       \textcolor{keywordflow}{if}(context->trustedCaListLen > 0)
1296       \{
1297          \textcolor{comment}{//Point to the first trusted CA certificate}
1298          trustedCaList = context->trustedCaList;
1299          \textcolor{comment}{//Get the total length, in bytes, of the trusted CA list}
1300          trustedCaListLen = context->trustedCaListLen;
1301 
1302          \textcolor{comment}{//Allocate a memory buffer to store X.509 certificate info}
1303          caCertInfo = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structX509CertificateInfo}{X509CertificateInfo}));
1304 
1305          \textcolor{comment}{//Successful memory allocation?}
1306          \textcolor{keywordflow}{if}(caCertInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1307          \{
1308             \textcolor{comment}{//Loop through the list of trusted CA certificates}
1309             \textcolor{keywordflow}{while}(trustedCaListLen > 0 && error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA})
1310             \{
1311                \textcolor{comment}{//The first pass calculates the length of the DER-encoded}
1312                \textcolor{comment}{//certificate}
1313                error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(trustedCaList, trustedCaListLen,
1314                   \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &derCertLen, &pemCertLen);
1315 
1316                \textcolor{comment}{//Check status code}
1317                \textcolor{keywordflow}{if}(!error)
1318                \{
1319                   \textcolor{comment}{//Allocate a memory buffer to hold the DER-encoded certificate}
1320                   derCert = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(derCertLen);
1321 
1322                   \textcolor{comment}{//Successful memory allocation?}
1323                   \textcolor{keywordflow}{if}(derCert != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1324                   \{
1325                      \textcolor{comment}{//The second pass decodes the PEM certificate}
1326                      error = \hyperlink{certificate_2pem__import_8c_a861695b3eda2ba8ca5ea2a5b2715c152}{pemImportCertificate}(trustedCaList,
1327                         trustedCaListLen, derCert, &derCertLen, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1328 
1329                      \textcolor{comment}{//Check status code}
1330                      \textcolor{keywordflow}{if}(!error)
1331                      \{
1332                         \textcolor{comment}{//Parse X.509 certificate}
1333                         error = \hyperlink{certificate_2x509__cert__parse_8c_a0c8997b0f608c1fee25bdd281e7c4acb}{x509ParseCertificate}(derCert, derCertLen,
1334                            caCertInfo);
1335                      \}
1336 
1337                      \textcolor{comment}{//Check status code}
1338                      \textcolor{keywordflow}{if}(!error)
1339                      \{
1340                         \textcolor{comment}{//Validate the certificate with the current CA}
1341                         error = \hyperlink{certificate_2x509__cert__validate_8c_a1d829c42c03a21d7d0325d214db51f0d}{x509ValidateCertificate}(certInfo, caCertInfo,
1342                            pathLen);
1343                      \}
1344 
1345                      \textcolor{comment}{//Check status code}
1346                      \textcolor{keywordflow}{if}(!error)
1347                      \{
1348                         \textcolor{comment}{//Check name constraints}
1349                         error = \hyperlink{certificate_2x509__cert__validate_8c_aba02729cea03e1500a1839c15d1f1149}{x509CheckNameConstraints}(subjectName, caCertInfo);
1350                      \}
1351 
1352                      \textcolor{comment}{//Check status code}
1353                      \textcolor{keywordflow}{if}(!error)
1354                      \{
1355                         \textcolor{comment}{//The certificate is issued by a trusted CA}
1356                         error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1357                      \}
1358                      \textcolor{keywordflow}{else}
1359                      \{
1360                         \textcolor{comment}{//The certificate cannot be matched with the current CA}
1361                         error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA};
1362                      \}
1363 
1364                      \textcolor{comment}{//Free previously allocated memory}
1365                      \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(derCert);
1366                   \}
1367                   \textcolor{keywordflow}{else}
1368                   \{
1369                      \textcolor{comment}{//Failed to allocate memory}
1370                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1371                   \}
1372 
1373                   \textcolor{comment}{//Advance read pointer}
1374                   trustedCaList += pemCertLen;
1375                   trustedCaListLen -= pemCertLen;
1376                \}
1377                \textcolor{keywordflow}{else}
1378                \{
1379                   \textcolor{comment}{//No more CA certificates in the list}
1380                   trustedCaListLen = 0;
1381                   error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA};
1382                \}
1383             \}
1384 
1385             \textcolor{comment}{//Free previously allocated memory}
1386             \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(caCertInfo);
1387          \}
1388          \textcolor{keywordflow}{else}
1389          \{
1390             \textcolor{comment}{//Failed to allocate memory}
1391             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
1392          \}
1393       \}
1394       \textcolor{keywordflow}{else}
1395       \{
1396          \textcolor{comment}{//Do not check the certificate against root CAs}
1397          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1398       \}  
1399    \}
1400 
1401    \textcolor{comment}{//Return status code}
1402    \textcolor{keywordflow}{return} error;
1403 \}
\end{DoxyCode}
