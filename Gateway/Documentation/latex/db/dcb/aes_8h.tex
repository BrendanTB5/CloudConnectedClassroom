\hypertarget{aes_8h}{}\section{cyclone\+\_\+crypto/cipher/aes.h File Reference}
\label{aes_8h}\index{cyclone\+\_\+crypto/cipher/aes.\+h@{cyclone\+\_\+crypto/cipher/aes.\+h}}


A\+ES (Advanced Encryption Standard)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structAesContext}{Aes\+Context}
\begin{DoxyCompactList}\small\item\em A\+ES algorithm context. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{aes_8h_af19ab913a847ad1e91c5291215116de1}{A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}~16
\item 
\#define \hyperlink{aes_8h_ae075f5718fa6cdcfd6227f301c2ea202}{A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO}~(\&\hyperlink{aes_8h_a7990fc0fb5988ad3d893ae079644d32e}{aes\+Cipher\+Algo})
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{aes_8h_a1786debf48f536d5dd454e4a8f7ecd0f}{aes\+Init} (\hyperlink{structAesContext}{Aes\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$key, size\+\_\+t key\+Len)
\begin{DoxyCompactList}\small\item\em Key expansion. \end{DoxyCompactList}\item 
void \hyperlink{aes_8h_aa524ebbb575c847bcceb7260d3da9245}{aes\+Encrypt\+Block} (\hyperlink{structAesContext}{Aes\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$input, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output)
\begin{DoxyCompactList}\small\item\em Encrypt a 16-\/byte block using A\+ES algorithm. \end{DoxyCompactList}\item 
void \hyperlink{aes_8h_a885ae24ee80d48243736f06d6abcae0a}{aes\+Decrypt\+Block} (\hyperlink{structAesContext}{Aes\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$input, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$output)
\begin{DoxyCompactList}\small\item\em Decrypt a 16-\/byte block using A\+ES algorithm. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \hyperlink{structCipherAlgo}{Cipher\+Algo} \hyperlink{aes_8h_a7990fc0fb5988ad3d893ae079644d32e}{aes\+Cipher\+Algo}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
A\+ES (Advanced Encryption Standard) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{aes_8h_af19ab913a847ad1e91c5291215116de1}\label{aes_8h_af19ab913a847ad1e91c5291215116de1}} 
\index{aes.\+h@{aes.\+h}!A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE@{A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}}
\index{A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE@{A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}{AES\_BLOCK\_SIZE}}
{\footnotesize\ttfamily \#define A\+E\+S\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE~16}



Definition at line 38 of file aes.\+h.

\mbox{\Hypertarget{aes_8h_ae075f5718fa6cdcfd6227f301c2ea202}\label{aes_8h_ae075f5718fa6cdcfd6227f301c2ea202}} 
\index{aes.\+h@{aes.\+h}!A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO@{A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO}}
\index{A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO@{A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO}{AES\_CIPHER\_ALGO}}
{\footnotesize\ttfamily \#define A\+E\+S\+\_\+\+C\+I\+P\+H\+E\+R\+\_\+\+A\+L\+GO~(\&\hyperlink{aes_8h_a7990fc0fb5988ad3d893ae079644d32e}{aes\+Cipher\+Algo})}



Definition at line 40 of file aes.\+h.



\subsection{Function Documentation}
\mbox{\Hypertarget{aes_8h_a885ae24ee80d48243736f06d6abcae0a}\label{aes_8h_a885ae24ee80d48243736f06d6abcae0a}} 
\index{aes.\+h@{aes.\+h}!aes\+Decrypt\+Block@{aes\+Decrypt\+Block}}
\index{aes\+Decrypt\+Block@{aes\+Decrypt\+Block}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{aes\+Decrypt\+Block()}{aesDecryptBlock()}}
{\footnotesize\ttfamily void aes\+Decrypt\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{structAesContext}{Aes\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{input,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output }\end{DoxyParamCaption})}



Decrypt a 16-\/byte block using A\+ES algorithm. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the A\+ES context \\
\hline
\mbox{\tt in}  & {\em input} & Ciphertext block to decrypt \\
\hline
\mbox{\tt out}  & {\em output} & Plaintext block resulting from decryption \\
\hline
\end{DoxyParams}


Definition at line 420 of file aes.\+c.


\begin{DoxyCode}
421 \{
422    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
423    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s0;
424    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s1;
425    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s2;
426    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s3;
427    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{pic32mx_2isr__support_8h_ae498df5bf6f1a461a5434c073031e229}{t0};
428    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a5017152cac85e29a2dc5d8d74de9e07c}{t1};
429    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a42a80c4c472115c0fcb04a076526ecf5}{t2};
430    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a275db56faf9780608afff7d4fb462caf}{t3};
431    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} temp;
432 
433    \textcolor{comment}{//Copy the ciphertext to the state array}
434    s0 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 0);
435    s1 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 4);
436    s2 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 8);
437    s3 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 12);
438 
439    \textcolor{comment}{//Initial round key addition}
440    s0 ^= context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4];
441    s1 ^= context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 1];
442    s2 ^= context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 2];
443    s3 ^= context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 3];
444 
445    \textcolor{comment}{//The number of rounds depends on the key length}
446    \textcolor{keywordflow}{for}(i = context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} - 1; i >= 1; i--)
447    \{
448       \textcolor{comment}{//Apply round function}
449       t0 = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[s0 & 0xFF];
450       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s3 >> 8) & 0xFF];
451       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
452       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s2 >> 16) & 0xFF];
453       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
454       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s1 >> 24) & 0xFF];
455       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
456 
457       t1 = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[s1 & 0xFF];
458       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s0 >> 8) & 0xFF];
459       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
460       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s3 >> 16) & 0xFF];
461       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
462       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s2 >> 24) & 0xFF];
463       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
464 
465       t2 = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[s2 & 0xFF];
466       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s1 >> 8) & 0xFF];
467       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
468       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s0 >> 16) & 0xFF];
469       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
470       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s3 >> 24) & 0xFF];
471       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
472 
473       t3 = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[s3 & 0xFF];
474       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s2 >> 8) & 0xFF];
475       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
476       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s1 >> 16) & 0xFF];
477       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
478       temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[(s0 >> 24) & 0xFF];
479       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
480 
481       \textcolor{comment}{//Round key addition}
482       s0 = t0 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i * 4];
483       s1 = t1 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i * 4 + 1];
484       s2 = t2 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i * 4 + 2];
485       s3 = t3 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i * 4 + 3];
486    \}
487 
488    \textcolor{comment}{//The last round differs slightly from the first rounds}
489    t0 = \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[s0 & 0xFF];
490    t0 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s3 >> 8) & 0xFF] << 8;
491    t0 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s2 >> 16) & 0xFF] << 16;
492    t0 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s1 >> 24) & 0xFF] << 24;
493 
494    t1 = \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[s1 & 0xFF];
495    t1 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s0 >> 8) & 0xFF] << 8;
496    t1 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s3 >> 16) & 0xFF] << 16;
497    t1 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s2 >> 24) & 0xFF] << 24;
498 
499    t2 = \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[s2 & 0xFF];
500    t2 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s1 >> 8) & 0xFF] << 8;
501    t2 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s0 >> 16) & 0xFF] << 16;
502    t2 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s3 >> 24) & 0xFF] << 24;
503 
504    t3 = \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[s3 & 0xFF];
505    t3 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s2 >> 8) & 0xFF] << 8;
506    t3 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s1 >> 16) & 0xFF] << 16;
507    t3 |= \hyperlink{aes_8c_a7937f1040dcd7aea8595768cc6d95e8e}{isbox}[(s0 >> 24) & 0xFF] << 24;
508 
509    \textcolor{comment}{//Last round key addition}
510    s0 = t0 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[0];
511    s1 = t1 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[1];
512    s2 = t2 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[2];
513    s3 = t3 ^ context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[3];
514 
515    \textcolor{comment}{//The final state is then copied to the output}
516    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s0, output + 0);
517    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s1, output + 4);
518    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s2, output + 8);
519    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s3, output + 12);
520 \}
\end{DoxyCode}
\mbox{\Hypertarget{aes_8h_aa524ebbb575c847bcceb7260d3da9245}\label{aes_8h_aa524ebbb575c847bcceb7260d3da9245}} 
\index{aes.\+h@{aes.\+h}!aes\+Encrypt\+Block@{aes\+Encrypt\+Block}}
\index{aes\+Encrypt\+Block@{aes\+Encrypt\+Block}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{aes\+Encrypt\+Block()}{aesEncryptBlock()}}
{\footnotesize\ttfamily void aes\+Encrypt\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{structAesContext}{Aes\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{input,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{output }\end{DoxyParamCaption})}



Encrypt a 16-\/byte block using A\+ES algorithm. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the A\+ES context \\
\hline
\mbox{\tt in}  & {\em input} & Plaintext block to encrypt \\
\hline
\mbox{\tt out}  & {\em output} & Ciphertext block resulting from encryption \\
\hline
\end{DoxyParams}


Definition at line 310 of file aes.\+c.


\begin{DoxyCode}
311 \{
312    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
313    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s0;
314    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s1;
315    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s2;
316    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} s3;
317    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{pic32mx_2isr__support_8h_ae498df5bf6f1a461a5434c073031e229}{t0};
318    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a5017152cac85e29a2dc5d8d74de9e07c}{t1};
319    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a42a80c4c472115c0fcb04a076526ecf5}{t2};
320    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{tiger_8c_a275db56faf9780608afff7d4fb462caf}{t3};
321    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} temp;
322 
323    \textcolor{comment}{//Copy the plaintext to the state array}
324    s0 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 0);
325    s1 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 4);
326    s2 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 8);
327    s3 = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(input + 12);
328 
329    \textcolor{comment}{//Initial round key addition}
330    s0 ^= context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[0];
331    s1 ^= context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[1];
332    s2 ^= context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[2];
333    s3 ^= context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[3];
334 
335    \textcolor{comment}{//The number of rounds depends on the key length}
336    \textcolor{keywordflow}{for}(i = 1; i < context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr}; i++)
337    \{
338       \textcolor{comment}{//Apply round function}
339       t0 = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[s0 & 0xFF];
340       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s1 >> 8) & 0xFF];
341       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
342       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s2 >> 16) & 0xFF];
343       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
344       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s3 >> 24) & 0xFF];
345       t0 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
346 
347       t1 = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[s1 & 0xFF];
348       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s2 >> 8) & 0xFF];
349       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
350       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s3 >> 16) & 0xFF];
351       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
352       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s0 >> 24) & 0xFF];
353       t1 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
354 
355       t2 = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[s2 & 0xFF];
356       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s3 >> 8) & 0xFF];
357       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
358       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s0 >> 16) & 0xFF];
359       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
360       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s1 >> 24) & 0xFF];
361       t2 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
362 
363       t3 = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[s3 & 0xFF];
364       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s0 >> 8) & 0xFF];
365       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
366       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s1 >> 16) & 0xFF];
367       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
368       temp = \hyperlink{aes_8c_ad449d120251b159561b8af081db6ab10}{te}[(s2 >> 24) & 0xFF];
369       t3 ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
370 
371       \textcolor{comment}{//Round key addition}
372       s0 = t0 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i * 4];
373       s1 = t1 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i * 4 + 1];
374       s2 = t2 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i * 4 + 2];
375       s3 = t3 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i * 4 + 3];
376    \}
377 
378    \textcolor{comment}{//The last round differs slightly from the first rounds}
379    t0 = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[s0 & 0xFF];
380    t0 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s1 >> 8) & 0xFF] << 8;
381    t0 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s2 >> 16) & 0xFF] << 16;
382    t0 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s3 >> 24) & 0xFF] << 24;
383 
384    t1 = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[s1 & 0xFF];
385    t1 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s2 >> 8) & 0xFF] << 8;
386    t1 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s3 >> 16) & 0xFF] << 16;
387    t1 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s0 >> 24) & 0xFF] << 24;
388 
389    t2 = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[s2 & 0xFF];
390    t2 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s3 >> 8) & 0xFF] << 8;
391    t2 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s0 >> 16) & 0xFF] << 16;
392    t2 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s1 >> 24) & 0xFF] << 24;
393 
394    t3 = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[s3 & 0xFF];
395    t3 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s0 >> 8) & 0xFF] << 8;
396    t3 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s1 >> 16) & 0xFF] << 16;
397    t3 |= \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(s2 >> 24) & 0xFF] << 24;
398 
399    \textcolor{comment}{//Last round key addition}
400    s0 = t0 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4];
401    s1 = t1 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 1];
402    s2 = t2 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 2];
403    s3 = t3 ^ context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} * 4 + 3];
404 
405    \textcolor{comment}{//The final state is then copied to the output}
406    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s0, output + 0);
407    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s1, output + 4);
408    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s2, output + 8);
409    \hyperlink{cpu__endian_8h_a9dc2aacccbeaa4c76dc3870ef4486a88}{STORE32LE}(s3, output + 12);
410 \}
\end{DoxyCode}
\mbox{\Hypertarget{aes_8h_a1786debf48f536d5dd454e4a8f7ecd0f}\label{aes_8h_a1786debf48f536d5dd454e4a8f7ecd0f}} 
\index{aes.\+h@{aes.\+h}!aes\+Init@{aes\+Init}}
\index{aes\+Init@{aes\+Init}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{aes\+Init()}{aesInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} aes\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structAesContext}{Aes\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{key,  }\item[{size\+\_\+t}]{key\+Len }\end{DoxyParamCaption})}



Key expansion. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the A\+ES context to initialize \\
\hline
\mbox{\tt in}  & {\em key} & Pointer to the key \\
\hline
\mbox{\tt in}  & {\em key\+Len} & Length of the key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 202 of file aes.\+c.


\begin{DoxyCode}
203 \{
204    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
205    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} temp;
206    \textcolor{keywordtype}{size\_t} keyScheduleSize;
207 
208    \textcolor{comment}{//Check parameters}
209    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || key == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
210       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
211 
212    \textcolor{comment}{//Check the length of the key}
213    \textcolor{keywordflow}{if}(keyLen == 16)
214    \{
215       \textcolor{comment}{//10 rounds are required for 128-bit key}
216       context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} = 10;
217    \}
218    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyLen == 24)
219    \{
220       \textcolor{comment}{//12 rounds are required for 192-bit key}
221       context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} = 12;
222    \}
223    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyLen == 32)
224    \{
225       \textcolor{comment}{//14 rounds are required for 256-bit key}
226       context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} = 14;
227    \}
228    \textcolor{keywordflow}{else}
229    \{
230       \textcolor{comment}{//Report an error}
231       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3764b2929469f1eb1bf7af50b40df62f}{ERROR\_INVALID\_KEY\_LENGTH};
232    \}
233 
234    \textcolor{comment}{//Determine the number of 32-bit words in the key}
235    keyLen /= 4;
236 
237    \textcolor{comment}{//Copy the original key}
238    \textcolor{keywordflow}{for}(i = 0; i < keyLen; i++)
239    \{
240       context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] = \hyperlink{cpu__endian_8h_a7a6ecaee0bc600cae5a7dead20594920}{LOAD32LE}(key + (i * 4));
241    \}
242 
243    \textcolor{comment}{//The size of the key schedule depends on the number of rounds}
244    keyScheduleSize = 4 * (context->\hyperlink{structAesContext_aabd0cf2167c7b59f419dda6d0ed9c9ad}{nr} + 1);
245 
246    \textcolor{comment}{//Generate the key schedule (encryption)}
247    \textcolor{keywordflow}{for}(i = keyLen; i < keyScheduleSize; i++)
248    \{
249       \textcolor{comment}{//Save previous word}
250       temp = context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i - 1];
251 
252       \textcolor{comment}{//Apply transformation}
253       \textcolor{keywordflow}{if}((i % keyLen) == 0)
254       \{
255          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 8) & 0xFF];
256          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 16) & 0xFF] << 8);
257          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 24) & 0xFF] << 16);
258          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[temp & 0xFF] << 24);
259          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] ^= \hyperlink{aes_8c_a5cac100dab65b0797627a0d31b5bc5f2}{rcon}[i / keyLen];
260       \}
261       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(keyLen > 6 && (i % keyLen) == 4)
262       \{
263          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] = \hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[temp & 0xFF];
264          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 8) & 0xFF] << 8);
265          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 16) & 0xFF] << 16);
266          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] |= (\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(temp >> 24) & 0xFF] << 24);
267       \}
268       \textcolor{keywordflow}{else}
269       \{
270          context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] = temp;
271       \}
272 
273       \textcolor{comment}{//Update the key schedule}
274       context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] ^= context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i - keyLen];
275    \}
276 
277    \textcolor{comment}{//Generate the key schedule (decryption)}
278    \textcolor{keywordflow}{for}(i = 0; i < keyScheduleSize; i++)
279    \{
280       \textcolor{comment}{//Apply the InvMixColumns transformation to all round keys}
281       \textcolor{comment}{//but the first and the last}
282       \textcolor{keywordflow}{if}(i < 4 || i >= (keyScheduleSize - 4))
283       \{
284          context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i] = context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i];
285       \}
286       \textcolor{keywordflow}{else}
287       \{
288          context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i] = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] & 0xFF]];
289          temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] >> 8) & 0xFF]];
290          context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i] ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 8);
291          temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] >> 16) & 0xFF]];
292          context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i] ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 16);
293          temp = \hyperlink{aes_8c_a8aa09d2cb5b9d58af1cf9b65cef9a86c}{td}[\hyperlink{aes_8c_adc15aeb43c81de1162045eedf437f407}{sbox}[(context->\hyperlink{structAesContext_ad8944ec0ee52c01192e26e18120dfab4}{ek}[i] >> 24) & 0xFF]];
294          context->\hyperlink{structAesContext_a39944caefcfd380dd50aa6a089c981e6}{dk}[i] ^= \hyperlink{cyclone__crypto_2core_2crypto_8h_ad5e52b5ea688101f11d0bf34dc3a8b4b}{ROL32}(temp, 24);
295       \}
296    \}
297 
298    \textcolor{comment}{//No error to report}
299    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
300 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{aes_8h_a7990fc0fb5988ad3d893ae079644d32e}\label{aes_8h_a7990fc0fb5988ad3d893ae079644d32e}} 
\index{aes.\+h@{aes.\+h}!aes\+Cipher\+Algo@{aes\+Cipher\+Algo}}
\index{aes\+Cipher\+Algo@{aes\+Cipher\+Algo}!aes.\+h@{aes.\+h}}
\subsubsection{\texorpdfstring{aes\+Cipher\+Algo}{aesCipherAlgo}}
{\footnotesize\ttfamily const \hyperlink{structCipherAlgo}{Cipher\+Algo} aes\+Cipher\+Algo}



Definition at line 180 of file aes.\+c.

