\hypertarget{nmdrv_8c}{}\section{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmdrv.c File Reference}
\label{nmdrv_8c}\index{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmdrv.\+c@{third\+\_\+party/atmel/devices/wilc1000/driver/source/nmdrv.\+c}}


This module contains W\+I\+LC M2M driver A\+P\+Is implementation.  


{\ttfamily \#include \char`\"{}driver/source/nmbus.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp/include/nm\+\_\+bsp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}driver/source/nmdrv.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}driver/source/nmasic.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{nmdrv_8c_a1a5b1ded422e69d2ed99fc8c35d7aa96}{r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1}~(0x14a0)
\item 
\#define \hyperlink{nmdrv_8c_a290fe72d3e9e22f740711645567772d4}{r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT}~(\hyperlink{nm__common_8h_adde51a0ad3552901278c63d59789036f}{N\+B\+I\+T0})
\item 
\#define \hyperlink{nmdrv_8c_a9ea61605237c0fe091646a1e98cfb426}{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT}~(\hyperlink{nm__common_8h_af021c93c599e04152158eda1e92275d9}{N\+B\+I\+T2})
\item 
\#define \hyperlink{nmdrv_8c_a46773729582f5014adc8a908fd691807}{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT}~(\hyperlink{nm__common_8h_a7356dbabfb7d381f9ee73b843e26c9bf}{N\+B\+I\+T3})
\item 
\#define \hyperlink{nmdrv_8c_a9c7bb0fbc8bfea1602b7c728fd60c25e}{r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS}~(\hyperlink{nm__common_8h_aa447022b23aa3a674e2d86ea1b139083}{N\+B\+I\+T5})
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmdrv_8c_a4b54fcde1c6d7a97c831cea8af5a27ef}{nm\+\_\+get\+\_\+firmware\+\_\+info} (\hyperlink{structtstrM2mRev}{tstr\+M2m\+Rev} $\ast$M2m\+Rev)
\begin{DoxyCompactList}\small\item\em Get Firmware version info. \end{DoxyCompactList}\item 
static void \hyperlink{nmdrv_8c_ac2d1015fb5134b5bc114ecb6af839f89}{chip\+\_\+apply\+\_\+conf} (void)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmdrv_8c_a5b11f44fa8edd600cccd32ece263e3eb}{nm\+\_\+drv\+\_\+init} (void $\ast$arg)
\item 
\hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{nmdrv_8c_a444c8058e44c2381fcceac93a5f53a3c}{nm\+\_\+drv\+\_\+deinit} (void $\ast$arg)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This module contains W\+I\+LC M2M driver A\+P\+Is implementation. 

Copyright (c) 2016-\/2018 Microchip Technology Inc. and its subsidiaries.

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{nmdrv_8c_a9c7bb0fbc8bfea1602b7c728fd60c25e}\label{nmdrv_8c_a9c7bb0fbc8bfea1602b7c728fd60c25e}} 
\index{nmdrv.\+c@{nmdrv.\+c}!r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS@{r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS}}
\index{r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS@{r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS}{rHAVE\_LEGACY\_RF\_SETTINGS}}
{\footnotesize\ttfamily \#define r\+H\+A\+V\+E\+\_\+\+L\+E\+G\+A\+C\+Y\+\_\+\+R\+F\+\_\+\+S\+E\+T\+T\+I\+N\+GS~(\hyperlink{nm__common_8h_aa447022b23aa3a674e2d86ea1b139083}{N\+B\+I\+T5})}



Definition at line 54 of file nmdrv.\+c.

\mbox{\Hypertarget{nmdrv_8c_a290fe72d3e9e22f740711645567772d4}\label{nmdrv_8c_a290fe72d3e9e22f740711645567772d4}} 
\index{nmdrv.\+c@{nmdrv.\+c}!r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT}}
\index{r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT}{rHAVE\_SDIO\_IRQ\_GPIO\_BIT}}
{\footnotesize\ttfamily \#define r\+H\+A\+V\+E\+\_\+\+S\+D\+I\+O\+\_\+\+I\+R\+Q\+\_\+\+G\+P\+I\+O\+\_\+\+B\+IT~(\hyperlink{nm__common_8h_adde51a0ad3552901278c63d59789036f}{N\+B\+I\+T0})}



Definition at line 51 of file nmdrv.\+c.

\mbox{\Hypertarget{nmdrv_8c_a9ea61605237c0fe091646a1e98cfb426}\label{nmdrv_8c_a9ea61605237c0fe091646a1e98cfb426}} 
\index{nmdrv.\+c@{nmdrv.\+c}!r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT}}
\index{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT}{rHAVE\_SLEEP\_CLK\_SRC\_RTC\_BIT}}
{\footnotesize\ttfamily \#define r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+R\+T\+C\+\_\+\+B\+IT~(\hyperlink{nm__common_8h_af021c93c599e04152158eda1e92275d9}{N\+B\+I\+T2})}



Definition at line 52 of file nmdrv.\+c.

\mbox{\Hypertarget{nmdrv_8c_a46773729582f5014adc8a908fd691807}\label{nmdrv_8c_a46773729582f5014adc8a908fd691807}} 
\index{nmdrv.\+c@{nmdrv.\+c}!r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT}}
\index{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT@{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT}{rHAVE\_SLEEP\_CLK\_SRC\_XO\_BIT}}
{\footnotesize\ttfamily \#define r\+H\+A\+V\+E\+\_\+\+S\+L\+E\+E\+P\+\_\+\+C\+L\+K\+\_\+\+S\+R\+C\+\_\+\+X\+O\+\_\+\+B\+IT~(\hyperlink{nm__common_8h_a7356dbabfb7d381f9ee73b843e26c9bf}{N\+B\+I\+T3})}



Definition at line 53 of file nmdrv.\+c.

\mbox{\Hypertarget{nmdrv_8c_a1a5b1ded422e69d2ed99fc8c35d7aa96}\label{nmdrv_8c_a1a5b1ded422e69d2ed99fc8c35d7aa96}} 
\index{nmdrv.\+c@{nmdrv.\+c}!r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1@{r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1}}
\index{r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1@{r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1}{rNMI\_GP\_REG\_1}}
{\footnotesize\ttfamily \#define r\+N\+M\+I\+\_\+\+G\+P\+\_\+\+R\+E\+G\+\_\+1~(0x14a0)}



Definition at line 49 of file nmdrv.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{nmdrv_8c_ac2d1015fb5134b5bc114ecb6af839f89}\label{nmdrv_8c_ac2d1015fb5134b5bc114ecb6af839f89}} 
\index{nmdrv.\+c@{nmdrv.\+c}!chip\+\_\+apply\+\_\+conf@{chip\+\_\+apply\+\_\+conf}}
\index{chip\+\_\+apply\+\_\+conf@{chip\+\_\+apply\+\_\+conf}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{chip\+\_\+apply\+\_\+conf()}{chip\_apply\_conf()}}
{\footnotesize\ttfamily static void chip\+\_\+apply\+\_\+conf (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 62 of file nmdrv.\+c.


\begin{DoxyCode}
63 \{
64     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
65     
66     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} val32;
67     val32 = 0;
68 
69 \textcolor{preprocessor}{#ifdef \_\_ENABLE\_SLEEP\_CLK\_SRC\_RTC\_\_}
70     val32 |= rHAVE\_SLEEP\_CLK\_SRC\_RTC;
71 \textcolor{preprocessor}{#elif defined \_\_ENABLE\_SLEEP\_CLK\_SRC\_XO\_\_}
72     val32 |= rHAVE\_SLEEP\_CLK\_SRC\_XO;
73 \textcolor{preprocessor}{#endif}
74 \textcolor{preprocessor}{#ifdef \_\_ENABLE\_LEGACY\_RF\_SETTINGS\_\_}
75     val32 |= \hyperlink{nmdrv_8c_a9c7bb0fbc8bfea1602b7c728fd60c25e}{rHAVE\_LEGACY\_RF\_SETTINGS};
76 \textcolor{preprocessor}{#endif}
77 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SDIO\_EXT\_IRQ}
78     val32 |= \hyperlink{nmdrv_8c_a290fe72d3e9e22f740711645567772d4}{rHAVE\_SDIO\_IRQ\_GPIO\_BIT};
79 \textcolor{preprocessor}{#endif}
80     \textcolor{keywordflow}{do}  \{
81         \hyperlink{nmbus_8c_a6a7d6b943cea86630575707ef80e09f9}{nm\_write\_reg}(\hyperlink{nmdrv_8c_a1a5b1ded422e69d2ed99fc8c35d7aa96}{rNMI\_GP\_REG\_1}, val32);
82         \textcolor{keywordflow}{if}(val32 != 0) \{        
83             \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32} reg = 0;
84             ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmdrv_8c_a1a5b1ded422e69d2ed99fc8c35d7aa96}{rNMI\_GP\_REG\_1}, &reg);
85             \textcolor{keywordflow}{if}(ret == \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS}) \{
86                 \textcolor{keywordflow}{if}(reg == val32)
87                     \textcolor{keywordflow}{break};
88             \}
89         \} \textcolor{keywordflow}{else} \{
90             \textcolor{keywordflow}{break};
91         \}
92     \} \textcolor{keywordflow}{while}(1);
93 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmdrv_8c_a444c8058e44c2381fcceac93a5f53a3c}\label{nmdrv_8c_a444c8058e44c2381fcceac93a5f53a3c}} 
\index{nmdrv.\+c@{nmdrv.\+c}!nm\+\_\+drv\+\_\+deinit@{nm\+\_\+drv\+\_\+deinit}}
\index{nm\+\_\+drv\+\_\+deinit@{nm\+\_\+drv\+\_\+deinit}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+drv\+\_\+deinit()}{nm\_drv\_deinit()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+drv\+\_\+deinit (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



Definition at line 198 of file nmdrv.\+c.


\begin{DoxyCode}
199 \{
200     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret;
201     
202     ret = \hyperlink{nmasic_8c_a56e8f10481e53eb5895a15b565f0a40e}{chip\_deinit}();
203     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
204         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[nmi stop]: chip\_deinit fail\(\backslash\)r\(\backslash\)n"});
205         \textcolor{keywordflow}{goto} ERR1;
206     \}
207 
208 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SDIO}
209     \hyperlink{nmsdio_8h_a5b8a1a0a1d47fd9ed7e4d2a6e53d4e9d}{nm\_sdio\_init}();
210 \textcolor{preprocessor}{#endif}
211 
212     ret = \hyperlink{nmbus_8c_afd8c7289de1cbf00464909c5c491b088}{nm\_bus\_iface\_deinit}();
213     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
214         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[nmi stop]: fail init bus\(\backslash\)r\(\backslash\)n"});
215         \textcolor{keywordflow}{goto} ERR1;
216     \}
217 
218 ERR1:
219     \textcolor{keywordflow}{return} ret;
220 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmdrv_8c_a5b11f44fa8edd600cccd32ece263e3eb}\label{nmdrv_8c_a5b11f44fa8edd600cccd32ece263e3eb}} 
\index{nmdrv.\+c@{nmdrv.\+c}!nm\+\_\+drv\+\_\+init@{nm\+\_\+drv\+\_\+init}}
\index{nm\+\_\+drv\+\_\+init@{nm\+\_\+drv\+\_\+init}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+drv\+\_\+init()}{nm\_drv\_init()}}
{\footnotesize\ttfamily \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+drv\+\_\+init (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



Definition at line 105 of file nmdrv.\+c.


\begin{DoxyCode}
106 \{
107     \hyperlink{structtstrM2mRev}{tstrM2mRev} strtmp;
108     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
109     
110     ret = \hyperlink{nmbus_8c_aaafc1bd52ccd798c512173f18543b966}{nm\_bus\_iface\_init}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
111     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
112         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"[nmi start]: fail init bus\(\backslash\)r\(\backslash\)n"});
113         \textcolor{keywordflow}{goto} ERR1;
114     \}
115 
116 \textcolor{preprocessor}{#ifdef BUS\_ONLY}
117     \textcolor{keywordflow}{return};
118 \textcolor{preprocessor}{#endif}
119 
120 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SPI}
121     \hyperlink{nmspi_8h_ad47b5973430e547dd904b98a542b9ece}{nm\_spi\_init}();
122 \textcolor{preprocessor}{#elif defined CONF\_WILC\_USE\_SDIO}
123     \hyperlink{nmsdio_8h_a5b8a1a0a1d47fd9ed7e4d2a6e53d4e9d}{nm\_sdio\_init}();
124 \textcolor{preprocessor}{#endif}
125 
126 \textcolor{preprocessor}{#ifdef WILC\_SERIAL\_BRIDGE\_INTERFACE}
127     \textcolor{keywordflow}{return} \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
128 \textcolor{preprocessor}{#endif}
129     \hyperlink{nm__common_8h_a84108eca2655e811179386a39c62acf2}{M2M\_INFO}(\textcolor{stringliteral}{"Chip ID %lx\(\backslash\)r\(\backslash\)n"}, \hyperlink{nmasic_8h_a2325ac5878275e4ca3f99675cf78be72}{nmi\_get\_chipid}());
130 \textcolor{preprocessor}{#ifndef CONF\_WILC\_FW\_IN\_FLASH}
131     ret = \hyperlink{nmasic_8c_a40dd2b726ea75385c90df269f69658f9}{firmware\_download}();
132     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
133         \textcolor{keywordflow}{goto} ERR2;
134     \}
135 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* CONF\_WILC\_FW\_IN\_FLASH */}\textcolor{preprocessor}{}
136     \hyperlink{nmdrv_8c_ac2d1015fb5134b5bc114ecb6af839f89}{chip\_apply\_conf}();
137 
138     ret = \hyperlink{nmasic_8c_a271a40a292bea52b7b7223738d38d971}{cpu\_start}();
139     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
140         \textcolor{keywordflow}{goto} ERR2;
141     \}
142 
143 \textcolor{preprocessor}{#ifdef CONF\_WILC\_FW\_IN\_FLASH}
144     ret = \hyperlink{nmasic_8h_ae0e326b339c77bdea4a3c6feac778e2e}{wait\_for\_bootrom}();
145     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
146         \textcolor{keywordflow}{goto} ERR2;
147     \}
148 \textcolor{preprocessor}{#endif }\textcolor{comment}{/*CONF\_WILC\_FW\_IN\_FLASH */}\textcolor{preprocessor}{}
149     ret = \hyperlink{nmasic_8c_a12d3b4ba49cbe3075b6ecbfe9fb58d4c}{wait\_for\_firmware\_start}();
150     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
151         \textcolor{keywordflow}{goto} ERR2;
152     \}
153 
154 \textcolor{preprocessor}{#if (defined CONF\_WILC\_USE\_3000\_REV\_A && !defined WILC\_SERIAL\_BRIDGE\_INTERFACE)}
155 \textcolor{preprocessor}{#ifndef CONF\_WILC\_FW\_IN\_FLASH}
156     ret = firmware\_download\_bt();
157     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
158         \textcolor{keywordflow}{goto} ERR2;
159     \}
160 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* CONF\_WILC\_FW\_IN\_FLASH */}\textcolor{preprocessor}{}
161     ret = cpu\_start\_bt();
162     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
163         \textcolor{keywordflow}{goto} ERR2;
164     \}
165 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* (defined CONF\_WILC\_USE\_3000\_REV\_A && !defined WILC\_SERIAL\_BRIDGE\_INTERFACE) */}\textcolor{preprocessor}{}
166     ret = \hyperlink{nmasic_8c_af3c5f659f6097d385b50070d4c67fa11}{enable\_interrupts}();
167     \textcolor{keywordflow}{if} (\hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS} != ret) \{
168         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"failed to enable interrupts..\(\backslash\)r\(\backslash\)n"});
169         \textcolor{keywordflow}{goto} ERR2;
170     \}
171         
172     \textcolor{keywordflow}{if}(\hyperlink{nm__common_8h_a589113b133769b3e1ef49b515d85364c}{M2M\_ERR\_FW\_VER\_MISMATCH} == \hyperlink{nmdrv_8c_a4b54fcde1c6d7a97c831cea8af5a27ef}{nm\_get\_firmware\_info}(&strtmp))
173     \{
174         ret = \hyperlink{nm__common_8h_a589113b133769b3e1ef49b515d85364c}{M2M\_ERR\_FW\_VER\_MISMATCH};
175         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Mismatch Firmawre Version\(\backslash\)r\(\backslash\)n"});
176         \hyperlink{nm__common_8h_a84108eca2655e811179386a39c62acf2}{M2M\_INFO}(\textcolor{stringliteral}{"Firmware ver   : %u.%u.%u\(\backslash\)r\(\backslash\)n"}, strtmp.\hyperlink{structtstrM2mRev_af17c74f7ee2a0612a3321fd3d1297e8e}{u8FirmwareMajor}, strtmp.
      \hyperlink{structtstrM2mRev_a9647011c59d10a38acd1ab70c26353aa}{u8FirmwareMinor}, strtmp.\hyperlink{structtstrM2mRev_ad67217ead03e5230092147bea0d8e9d3}{u8DriverPatch});
177         \hyperlink{nm__common_8h_a84108eca2655e811179386a39c62acf2}{M2M\_INFO}(\textcolor{stringliteral}{"Min driver ver : %u.%u.%u\(\backslash\)r\(\backslash\)n"}, strtmp.\hyperlink{structtstrM2mRev_aec68edb68ce1a472a6703ed709f7ae30}{u8DriverMajor}, strtmp.
      \hyperlink{structtstrM2mRev_a8e1f683bdcfc41fc133cecc73e9de4ed}{u8DriverMinor}, strtmp.\hyperlink{structtstrM2mRev_ad67217ead03e5230092147bea0d8e9d3}{u8DriverPatch});
178         \hyperlink{nm__common_8h_a84108eca2655e811179386a39c62acf2}{M2M\_INFO}(\textcolor{stringliteral}{"Curr driver ver: %u.%u.%u\(\backslash\)r\(\backslash\)n"}, 
      \hyperlink{group__WlanDefines_ga841654a809488d03e49e3ae02435751f}{M2M\_DRIVER\_VERSION\_MAJOR\_NO}, 
      \hyperlink{group__WlanDefines_ga9165dca612db5f17f11e9a5b2abe1290}{M2M\_DRIVER\_VERSION\_MINOR\_NO}, 
      \hyperlink{group__WlanDefines_ga57f6c956ee5e267cd064d281bc1df051}{M2M\_DRIVER\_VERSION\_PATCH\_NO});
179     \}
180 
181     \textcolor{keywordflow}{return} ret;
182 ERR2:
183 \textcolor{preprocessor}{#ifdef CONF\_WILC\_USE\_SDIO}
184     \hyperlink{nmsdio_8h_a41ac9842a605667de142f1e75651d9cb}{nm\_sdio\_deinit}();
185 \textcolor{preprocessor}{#endif}
186     \hyperlink{nmbus_8c_afd8c7289de1cbf00464909c5c491b088}{nm\_bus\_iface\_deinit}();
187 ERR1:   
188     \textcolor{keywordflow}{return} ret;
189 \}
\end{DoxyCode}
\mbox{\Hypertarget{nmdrv_8c_a4b54fcde1c6d7a97c831cea8af5a27ef}\label{nmdrv_8c_a4b54fcde1c6d7a97c831cea8af5a27ef}} 
\index{nmdrv.\+c@{nmdrv.\+c}!nm\+\_\+get\+\_\+firmware\+\_\+info@{nm\+\_\+get\+\_\+firmware\+\_\+info}}
\index{nm\+\_\+get\+\_\+firmware\+\_\+info@{nm\+\_\+get\+\_\+firmware\+\_\+info}!nmdrv.\+c@{nmdrv.\+c}}
\subsubsection{\texorpdfstring{nm\+\_\+get\+\_\+firmware\+\_\+info()}{nm\_get\_firmware\_info()}}
{\footnotesize\ttfamily static \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} nm\+\_\+get\+\_\+firmware\+\_\+info (\begin{DoxyParamCaption}\item[{\hyperlink{structtstrM2mRev}{tstr\+M2m\+Rev} $\ast$}]{M2m\+Rev }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Get Firmware version info. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em M2m\+Rev} & pointer holds address of structure \char`\"{}tstr\+M2m\+Rev\char`\"{} that contains the firmware version parameters \\
\hline
\end{DoxyParams}
\begin{DoxyAuthor}{Author}
Ahmad.\+Mohammad.\+Yahya 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
27 M\+A\+R\+CH 2013 
\end{DoxyDate}
\begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}


Definition at line 231 of file nmdrv.\+c.


\begin{DoxyCode}
232 \{
233     \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}  curr\_drv\_ver, min\_req\_drv\_ver;
234     \hyperlink{group__DataT_ga100e7c691a47d6978527c479a0158245}{uint32}    reg = 0;
235     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8}  ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
236 
237     ret = \hyperlink{nmbus_8c_a475d273d8342f3f5c2a00e2887bf1b4f}{nm\_read\_reg\_with\_ret}(\hyperlink{nmasic_8h_abe6eafe9e15a953b72dc1ccb894f175c}{NMI\_REV\_REG}, &reg);
238 
239     M2mRev->\hyperlink{structtstrM2mRev_aec68edb68ce1a472a6703ed709f7ae30}{u8DriverMajor}  = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg >> 24)&0xff;
240     M2mRev->\hyperlink{structtstrM2mRev_a8e1f683bdcfc41fc133cecc73e9de4ed}{u8DriverMinor}   = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg >> 20)&0x0f;
241     M2mRev->\hyperlink{structtstrM2mRev_ad67217ead03e5230092147bea0d8e9d3}{u8DriverPatch}  = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg >> 16)&0x0f;
242     M2mRev->\hyperlink{structtstrM2mRev_af17c74f7ee2a0612a3321fd3d1297e8e}{u8FirmwareMajor}  = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg >> 8)&0xff;
243     M2mRev->\hyperlink{structtstrM2mRev_a9647011c59d10a38acd1ab70c26353aa}{u8FirmwareMinor} = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg >> 4)&0x0f;   
244     M2mRev->\hyperlink{structtstrM2mRev_aa8be74043435e22e858ffb916abd83c2}{u8FirmwarePatch} = (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8})(reg)&0x0f;    
245     M2mRev->\hyperlink{structtstrM2mRev_a3c347a43e00bcdfa90011826c6b5ea75}{u32Chipid}  = \hyperlink{nmasic_8h_a2325ac5878275e4ca3f99675cf78be72}{nmi\_get\_chipid}();
246     
247     curr\_drv\_ver    = \hyperlink{group__WlanDefines_gaedb42f7681d2a954c9ada2752b362544}{MAKE\_VERSION}(\hyperlink{group__WlanDefines_ga841654a809488d03e49e3ae02435751f}{M2M\_DRIVER\_VERSION\_MAJOR\_NO}, 
      \hyperlink{group__WlanDefines_ga9165dca612db5f17f11e9a5b2abe1290}{M2M\_DRIVER\_VERSION\_MINOR\_NO}, 
      \hyperlink{group__WlanDefines_ga57f6c956ee5e267cd064d281bc1df051}{M2M\_DRIVER\_VERSION\_PATCH\_NO});
248     min\_req\_drv\_ver = \hyperlink{group__WlanDefines_gaedb42f7681d2a954c9ada2752b362544}{MAKE\_VERSION}(M2mRev->\hyperlink{structtstrM2mRev_aec68edb68ce1a472a6703ed709f7ae30}{u8DriverMajor}, M2mRev->
      \hyperlink{structtstrM2mRev_a8e1f683bdcfc41fc133cecc73e9de4ed}{u8DriverMinor},M2mRev->\hyperlink{structtstrM2mRev_ad67217ead03e5230092147bea0d8e9d3}{u8DriverPatch});
249     \textcolor{keywordflow}{if}((curr\_drv\_ver <  min\_req\_drv\_ver) || M2mRev->\hyperlink{structtstrM2mRev_aec68edb68ce1a472a6703ed709f7ae30}{u8DriverMajor} == 18 ) \{
250         ret = \hyperlink{nm__common_8h_a589113b133769b3e1ef49b515d85364c}{M2M\_ERR\_FW\_VER\_MISMATCH};
251     \}
252     \textcolor{keywordflow}{return} ret;
253 \}
\end{DoxyCode}
