\hypertarget{tls__misc_8h}{}\section{cyclone\+\_\+ssl/tls\+\_\+misc.h File Reference}
\label{tls__misc_8h}\index{cyclone\+\_\+ssl/tls\+\_\+misc.\+h@{cyclone\+\_\+ssl/tls\+\_\+misc.\+h}}


T\+LS helper functions.  


{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tls__misc_8h_ae43b7ef806126baf125c46cdb9424e87}{tls\+Process\+Error} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tftp__common_8h_a78abca92c8fa2790c1d32470831537e8}{error\+Code})
\begin{DoxyCompactList}\small\item\em Translate an error code to an alert message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_a316db53174c47a590bc25a2aadae6af6}{tls\+Generate\+Random\+Value} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tls13__misc_8h_a6120afe912430104573286fe328768c9}{random})
\begin{DoxyCompactList}\small\item\em Generate client or server random value. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_a62b0052733220e9ec9fee8ff5e8e5dab}{tls\+Select\+Version} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version})
\begin{DoxyCompactList}\small\item\em Set the T\+LS version to be used. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_a2ba32c2ad10fd77d5947387e6753210d}{tls\+Select\+Cipher\+Suite} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{ppp_8h_ad32b92787990885a72c7ea9451ec0ebf}{identifier})
\begin{DoxyCompactList}\small\item\em Set cipher suite. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_a4162f3ce7f2e32575f8f6a011b8502ce}{tls\+Init\+Encryption\+Engine} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$encryption\+Engine, \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End} entity, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$secret)
\begin{DoxyCompactList}\small\item\em Initialize encryption engine. \end{DoxyCompactList}\item 
void \hyperlink{tls__misc_8h_a4b2ee57846957d64f8cae5cd6408f3fc}{tls\+Free\+Encryption\+Engine} (\hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$encryption\+Engine)
\begin{DoxyCompactList}\small\item\em Release encryption engine. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_acdc0bb8b49d6c596ba176a5757b0fc7e}{tls\+Write\+Mpi} (const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Encode a multiple precision integer to an opaque vector. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_ac339933c6e9abec0ad7758fb4000673e}{tls\+Read\+Mpi} (\hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Read a multiple precision integer from an opaque vector. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_ae1d6ad23621c58ee4fe6954521e1cb34}{tls\+Write\+Ec\+Point} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$params, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Encode an EC point to an opaque vector. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__misc_8h_ac6d7ad566c151d978f10283c3e6710ff}{tls\+Read\+Ec\+Point} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$params, \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t size, size\+\_\+t $\ast$\hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Read an EC point from an opaque vector. \end{DoxyCompactList}\item 
const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$ \hyperlink{tls__misc_8h_ae9e2241e80727e56d419facaeb83b91e}{tls\+Get\+Version\+Name} (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{coap__common_8h_ab22abc2906422da61885ac6c8e6a1a59}{version})
\begin{DoxyCompactList}\small\item\em Convert T\+LS version to string representation. \end{DoxyCompactList}\item 
const \hyperlink{structHashAlgo}{Hash\+Algo} $\ast$ \hyperlink{tls__misc_8h_a0540f6f41d033803f8c6b9f5efe391e8}{tls\+Get\+Hash\+Algo} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} hash\+Algo\+Id)
\begin{DoxyCompactList}\small\item\em Get the hash algorithm that matches the specified identifier. \end{DoxyCompactList}\item 
const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info} $\ast$ \hyperlink{tls__misc_8h_a1d99ba7208ae993d388e7849fa5dce71}{tls\+Get\+Curve\+Info} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} named\+Curve)
\begin{DoxyCompactList}\small\item\em Get the EC domain parameters that match the specified named curve. \end{DoxyCompactList}\item 
\hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{Tls\+Named\+Group} \hyperlink{tls__misc_8h_a3fd967f568e8584bbce1a691a4d8c14d}{tls\+Get\+Named\+Curve} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Get the named curve that matches the specified O\+ID. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{tls__misc_8h_ab7117ba59f59a625f7509f61e4ce7352}{tls\+Compute\+Encryption\+Overhead} (\hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$encryption\+Engine, size\+\_\+t \hyperlink{web__socket_8h_ae4d38aba40b6dddf544612da0726cd7e}{payload\+Len})
\begin{DoxyCompactList}\small\item\em Compute overhead caused by encryption. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{tls__misc_8h_a821d4cff18a6ac6efc5079ccba1836cc}{tls\+Check\+Dns\+Hostname} (const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em D\+NS hostname verification. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
T\+LS helper functions. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{tls__misc_8h_a821d4cff18a6ac6efc5079ccba1836cc}\label{tls__misc_8h_a821d4cff18a6ac6efc5079ccba1836cc}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Check\+Dns\+Hostname@{tls\+Check\+Dns\+Hostname}}
\index{tls\+Check\+Dns\+Hostname@{tls\+Check\+Dns\+Hostname}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Check\+Dns\+Hostname()}{tlsCheckDnsHostname()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} tls\+Check\+Dns\+Hostname (\begin{DoxyParamCaption}\item[{const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{name,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



D\+NS hostname verification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em name} & Pointer to the hostname \\
\hline
\mbox{\tt in}  & {\em length} & Length of the hostname \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The function returns T\+R\+UE is the name is a valid D\+NS hostname 
\end{DoxyReturn}


Definition at line 1219 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
1220 \{
1221    \textcolor{keywordtype}{size\_t} i;
1222    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} valid;
1223 
1224    \textcolor{comment}{//Initialize flag}
1225    valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1226 
1227    \textcolor{comment}{//Loop through the hostname}
1228    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} && valid; i++)
1229    \{
1230       \textcolor{comment}{//DNS hostnames must start with a letter, end with a letter or}
1231       \textcolor{comment}{//digit, and have as interior characters only letters, digits,}
1232       \textcolor{comment}{//and hyphen (refer to RFC 1034, section 3.5)}
1233       \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] == \textcolor{charliteral}{'-'} || \hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] == \textcolor{charliteral}{'.'})
1234       \{
1235          \textcolor{comment}{//Valid character}
1236       \}
1237       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] >= \textcolor{charliteral}{'0'} && \hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] <= \textcolor{charliteral}{'9'})
1238       \{
1239          \textcolor{comment}{//Valid character}
1240       \}
1241       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] >= \textcolor{charliteral}{'A'} && \hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] <= \textcolor{charliteral}{'Z'})
1242       \{
1243          \textcolor{comment}{//Valid character}
1244       \}
1245       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] >= \textcolor{charliteral}{'a'} && \hyperlink{resource__manager_8h_a26532d7194d592ae8da35222073f36d6}{name}[i] <= \textcolor{charliteral}{'z'})
1246       \{
1247          \textcolor{comment}{//Valid character}
1248       \}
1249       \textcolor{keywordflow}{else}
1250       \{
1251          \textcolor{comment}{//Invalid character}
1252          valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1253       \}
1254    \}
1255 
1256    \textcolor{comment}{//Return TRUE is the name is a valid DNS hostname}
1257    \textcolor{keywordflow}{return} valid;
1258 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ab7117ba59f59a625f7509f61e4ce7352}\label{tls__misc_8h_ab7117ba59f59a625f7509f61e4ce7352}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Compute\+Encryption\+Overhead@{tls\+Compute\+Encryption\+Overhead}}
\index{tls\+Compute\+Encryption\+Overhead@{tls\+Compute\+Encryption\+Overhead}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Compute\+Encryption\+Overhead()}{tlsComputeEncryptionOverhead()}}
{\footnotesize\ttfamily size\+\_\+t tls\+Compute\+Encryption\+Overhead (\begin{DoxyParamCaption}\item[{\hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$}]{encryption\+Engine,  }\item[{size\+\_\+t}]{payload\+Len }\end{DoxyParamCaption})}



Compute overhead caused by encryption. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em encryption\+Engine} & Pointer to the encryption engine \\
\hline
\mbox{\tt in}  & {\em payload\+Len} & Length of the payload, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Overhead, in bytes, caused by encryption 
\end{DoxyReturn}


Definition at line 1167 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
1169 \{
1170    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1171 
1172    \textcolor{comment}{//Initialize variable}
1173    n = 0;
1174 
1175    \textcolor{comment}{//Message authentication?}
1176    \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a879e3f9933f7d2bf140e1eb8696d4abd}{hashAlgo} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1177       n += encryptionEngine->\hyperlink{structTlsEncryptionEngine_a879e3f9933f7d2bf140e1eb8696d4abd}{hashAlgo}->\hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize};
1178 
1179    \textcolor{comment}{//Check cipher mode}
1180    \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a7c82e8aeb1e9badb0c083823b5b14eaa}{CIPHER\_MODE\_CBC})
1181    \{
1182       \textcolor{comment}{//TLS 1.1 and 1.2 use an explicit IV}
1183       \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aa340a0b969c2b0f795556e66a68fae27}{version} >= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
1184          n += encryptionEngine->\hyperlink{structTlsEncryptionEngine_a9b9d6c4c5f58c7dd0e040818fe6a2681}{recordIvLen};
1185 
1186       \textcolor{comment}{//Padding is added to force the length of the plaintext to be an}
1187       \textcolor{comment}{//integral multiple of the cipher's block length}
1188       n += encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ba455619112e97e419c3c51de90b0ca}{cipherAlgo}->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} -
1189          ((\hyperlink{ipv6_8h_ae4d38aba40b6dddf544612da0726cd7e}{payloadLen} + \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}) % encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ba455619112e97e419c3c51de90b0ca}{cipherAlgo}->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
1190    \}
1191    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a42db5b52a68da8ba71735ac7248f7401}{CIPHER\_MODE\_CCM} ||
1192       encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5af09ab2345f2ff996cf47696f7540fe7a}{CIPHER\_MODE\_GCM})
1193    \{
1194       \textcolor{comment}{//Consider the explicit nonce and the authentication tag}
1195       n += encryptionEngine->\hyperlink{structTlsEncryptionEngine_a9b9d6c4c5f58c7dd0e040818fe6a2681}{recordIvLen} + encryptionEngine->
      \hyperlink{structTlsEncryptionEngine_aef28b3fa8d6ac0147cdc47db9a642fc7}{authTagLen};
1196    \}
1197    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == 
      \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a0a78e04fbee5d777bfd542b085003855}{CIPHER\_MODE\_CHACHA20\_POLY1305})
1198    \{
1199       \textcolor{comment}{//Consider the authentication tag only}
1200       n += encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef28b3fa8d6ac0147cdc47db9a642fc7}{authTagLen};
1201    \}
1202    \textcolor{keywordflow}{else}
1203    \{
1204       \textcolor{comment}{//Stream ciphers do not cause any overhead}
1205    \}
1206 
1207    \textcolor{comment}{//Return the total overhead caused by encryption}
1208    \textcolor{keywordflow}{return} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1209 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a4b2ee57846957d64f8cae5cd6408f3fc}\label{tls__misc_8h_a4b2ee57846957d64f8cae5cd6408f3fc}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Free\+Encryption\+Engine@{tls\+Free\+Encryption\+Engine}}
\index{tls\+Free\+Encryption\+Engine@{tls\+Free\+Encryption\+Engine}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Free\+Encryption\+Engine()}{tlsFreeEncryptionEngine()}}
{\footnotesize\ttfamily void tls\+Free\+Encryption\+Engine (\begin{DoxyParamCaption}\item[{\hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$}]{encryption\+Engine }\end{DoxyParamCaption})}



Release encryption engine. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em encryption\+Engine} & Pointer to the encryption/decryption engine \\
\hline
\end{DoxyParams}


Definition at line 593 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
594 \{
595    \textcolor{comment}{//Valid cipher context?}
596    \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
597    \{
598       \textcolor{comment}{//Erase cipher context}
599       memset(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext}, 0,
600          encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ba455619112e97e419c3c51de90b0ca}{cipherAlgo}->\hyperlink{structCipherAlgo_a79c74860795d2bf2ef6bff7885a33666}{contextSize});
601 
602       \textcolor{comment}{//Release memory}
603       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext});
604       encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
605    \}
606 
607 \textcolor{preprocessor}{#if (TLS\_GCM\_CIPHER\_SUPPORT == ENABLED)}
608    \textcolor{comment}{//Valid GCM context?}
609    \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
610    \{
611       \textcolor{comment}{//Erase GCM context}
612       memset(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext}, 0, \textcolor{keyword}{sizeof}(\hyperlink{structGcmContext}{GcmContext}));
613 
614       \textcolor{comment}{//Release memory}
615       \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext});
616       encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
617    \}
618 \textcolor{preprocessor}{#endif}
619 
620    \textcolor{comment}{//Reset encryption parameters}
621    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ba455619112e97e419c3c51de90b0ca}{cipherAlgo} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
622    encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} = \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5af2b260457a3fa53d37ac1701c7b6502e}{CIPHER\_MODE\_NULL};
623    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a879e3f9933f7d2bf140e1eb8696d4abd}{hashAlgo} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
624 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a316db53174c47a590bc25a2aadae6af6}\label{tls__misc_8h_a316db53174c47a590bc25a2aadae6af6}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Generate\+Random\+Value@{tls\+Generate\+Random\+Value}}
\index{tls\+Generate\+Random\+Value@{tls\+Generate\+Random\+Value}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Generate\+Random\+Value()}{tlsGenerateRandomValue()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Generate\+Random\+Value (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{random }\end{DoxyParamCaption})}



Generate client or server random value. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt out}  & {\em random} & Pointer to the random value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 165 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
166 \{
167    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
168 
169    \textcolor{comment}{//Verify that the pseudorandom number generator is properly configured}
170    \textcolor{keywordflow}{if}(context->prngAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->prngContext != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
171    \{
172       \textcolor{comment}{//Generate a 32-byte random value using a cryptographically-safe}
173       \textcolor{comment}{//pseudorandom number generator}
174       error = context->prngAlgo->read(context->prngContext, \hyperlink{tls_8h_a6120afe912430104573286fe328768c9}{random}, 32);
175    \}
176    \textcolor{keywordflow}{else}
177    \{
178       \textcolor{comment}{//Report an error}
179       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87925068eccab5b84c3b48065f3bf5b7}{ERROR\_NOT\_CONFIGURED};
180    \}
181 
182 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
183    \textcolor{comment}{//Check status code}
184    \textcolor{keywordflow}{if}(!error)
185    \{
186       \textcolor{comment}{//TLS 1.3 has a downgrade protection mechanism embedded in the server's}
187       \textcolor{comment}{//random value}
188       \textcolor{keywordflow}{if}(context->entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba3ddde9cb0be1b78b5b7e1e2ba1704a44}{TLS\_CONNECTION\_END\_SERVER})
189       \{
190          \textcolor{comment}{//Check negotiated version}
191          \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1} &&
192             context->versionMax >= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
193          \{
194             \textcolor{comment}{//If negotiating TLS 1.1 or below, TLS 1.3 servers must, and TLS 1.2}
195             \textcolor{comment}{//servers should, set the last eight bytes of their random value to}
196             \textcolor{comment}{//the bytes 44 4F 57 4E 47 52 44 00}
197             memcpy(\hyperlink{tls_8h_a6120afe912430104573286fe328768c9}{random} + 24, \hyperlink{tls13__misc_8h_a9b4390bb11b13bb7563bd50c066c25d0}{tls11DowngradeRandom}, 8);
198          \}
199          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2} &&
200             context->versionMax >= \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
201          \{
202             \textcolor{comment}{//If negotiating TLS 1.2, TLS 1.3 servers must set the last eight}
203             \textcolor{comment}{//bytes of their random value to the bytes 44 4F 57 4E 47 52 44 01}
204             memcpy(\hyperlink{tls_8h_a6120afe912430104573286fe328768c9}{random} + 24, \hyperlink{tls13__misc_8h_a752eea5f23b9d45d5c02db53fff7c27e}{tls12DowngradeRandom}, 8);
205          \}
206          \textcolor{keywordflow}{else}
207          \{
208             \textcolor{comment}{//No downgrade protection mechanism}
209          \}
210       \}
211    \}
212 \textcolor{preprocessor}{#endif}
213 
214    \textcolor{comment}{//Return status code}
215    \textcolor{keywordflow}{return} error;
216 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a1d99ba7208ae993d388e7849fa5dce71}\label{tls__misc_8h_a1d99ba7208ae993d388e7849fa5dce71}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Get\+Curve\+Info@{tls\+Get\+Curve\+Info}}
\index{tls\+Get\+Curve\+Info@{tls\+Get\+Curve\+Info}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Get\+Curve\+Info()}{tlsGetCurveInfo()}}
{\footnotesize\ttfamily const \hyperlink{structEcCurveInfo}{Ec\+Curve\+Info}$\ast$ tls\+Get\+Curve\+Info (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{named\+Curve }\end{DoxyParamCaption})}



Get the EC domain parameters that match the specified named curve. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em named\+Curve} & Elliptic curve identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Elliptic curve domain parameters 
\end{DoxyReturn}


Definition at line 891 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
892 \{
893    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
894    \textcolor{keyword}{const} \hyperlink{structEcCurveInfo}{EcCurveInfo} *curveInfo;
895 
896    \textcolor{comment}{//Default elliptic curve domain parameters}
897    curveInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
898 
899 \textcolor{preprocessor}{#if (TLS\_ECDH\_SUPPORT == ENABLED)}
900    \textcolor{comment}{//Check named curve}
901    \textcolor{keywordflow}{switch}(namedCurve)
902    \{
903 \textcolor{preprocessor}{#if (TLS\_SECP160K1\_SUPPORT == ENABLED)}
904    \textcolor{comment}{//secp160k1 elliptic curve?}
905    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51acda583efe5af2da9fa9e96856eb3b1bf}{TLS\_GROUP\_SECP160K1}:
906       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_ae83e3a05836b71a795e65cab85156508}{SECP160K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae83e3a05836b71a795e65cab85156508}{SECP160K1\_OID}));
907       \textcolor{keywordflow}{break};
908 \textcolor{preprocessor}{#endif}
909 \textcolor{preprocessor}{#if (TLS\_SECP160R1\_SUPPORT == ENABLED)}
910    \textcolor{comment}{//secp160r1 elliptic curve?}
911    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7e9442965686929d4e9f4f7f4980307d}{TLS\_GROUP\_SECP160R1}:
912       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a0a23c244c61e369561fc18d1842385fa}{SECP160R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a0a23c244c61e369561fc18d1842385fa}{SECP160R1\_OID}));
913       \textcolor{keywordflow}{break};
914 \textcolor{preprocessor}{#endif}
915 \textcolor{preprocessor}{#if (TLS\_SECP160R2\_SUPPORT == ENABLED)}
916    \textcolor{comment}{//secp160r2 elliptic curve?}
917    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a41fa96f8032730b6632a20641bead61a}{TLS\_GROUP\_SECP160R2}:
918       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a1b4e393e8e835a01b8a1130dce9dee81}{SECP160R2\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a1b4e393e8e835a01b8a1130dce9dee81}{SECP160R2\_OID}));
919       \textcolor{keywordflow}{break};
920 \textcolor{preprocessor}{#endif}
921 \textcolor{preprocessor}{#if (TLS\_SECP192K1\_SUPPORT == ENABLED)}
922    \textcolor{comment}{//secp192k1 elliptic curve?}
923    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aeb5261018b0e2fffc11bdd6f48acee6e}{TLS\_GROUP\_SECP192K1}:
924       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a1b6b6fce82f3a93530e008d4bec7aafc}{SECP192K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a1b6b6fce82f3a93530e008d4bec7aafc}{SECP192K1\_OID}));
925       \textcolor{keywordflow}{break};
926 \textcolor{preprocessor}{#endif}
927 \textcolor{preprocessor}{#if (TLS\_SECP192R1\_SUPPORT == ENABLED)}
928    \textcolor{comment}{//secp192r1 elliptic curve?}
929    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a336d7e6e339c51072d8a1f98e9d64f5c}{TLS\_GROUP\_SECP192R1}:
930       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a3649e278e4db5b569148637d893c3109}{SECP192R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a3649e278e4db5b569148637d893c3109}{SECP192R1\_OID}));
931       \textcolor{keywordflow}{break};
932 \textcolor{preprocessor}{#endif}
933 \textcolor{preprocessor}{#if (TLS\_SECP224K1\_SUPPORT == ENABLED)}
934    \textcolor{comment}{//secp224k1 elliptic curve?}
935    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51ad40acaf7b2a81365c26fa61c659cba0b}{TLS\_GROUP\_SECP224K1}:
936       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_ae26369d1d4ae68d6e0437aedb0a889b1}{SECP224K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae26369d1d4ae68d6e0437aedb0a889b1}{SECP224K1\_OID}));
937       \textcolor{keywordflow}{break};
938 \textcolor{preprocessor}{#endif}
939 \textcolor{preprocessor}{#if (TLS\_SECP224R1\_SUPPORT == ENABLED)}
940    \textcolor{comment}{//secp224r1 elliptic curve?}
941    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51af96d8fee1c1205fbcfe35c1d634336ee}{TLS\_GROUP\_SECP224R1}:
942       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_af2d74880bd21f7e6fd5594eff3680eaf}{SECP224R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_af2d74880bd21f7e6fd5594eff3680eaf}{SECP224R1\_OID}));
943       \textcolor{keywordflow}{break};
944 \textcolor{preprocessor}{#endif}
945 \textcolor{preprocessor}{#if (TLS\_SECP256K1\_SUPPORT == ENABLED)}
946    \textcolor{comment}{//secp256k1 elliptic curve?}
947    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7ff3c5404b50d700d0d4c0602bb1ef0c}{TLS\_GROUP\_SECP256K1}:
948       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_af67de35881355f34e5b1815786d18dd7}{SECP256K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_af67de35881355f34e5b1815786d18dd7}{SECP256K1\_OID}));
949       \textcolor{keywordflow}{break};
950 \textcolor{preprocessor}{#endif}
951 \textcolor{preprocessor}{#if (TLS\_SECP256R1\_SUPPORT == ENABLED)}
952    \textcolor{comment}{//secp256r1 elliptic curve?}
953    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a754392bfe03e9ee5988cebb5c8466df2}{TLS\_GROUP\_SECP256R1}:
954       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_acd07372943f27b81d1e10e86f62c04f9}{SECP256R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_acd07372943f27b81d1e10e86f62c04f9}{SECP256R1\_OID}));
955       \textcolor{keywordflow}{break};
956 \textcolor{preprocessor}{#endif}
957 \textcolor{preprocessor}{#if (TLS\_SECP384R1\_SUPPORT == ENABLED)}
958    \textcolor{comment}{//secp384r1 elliptic curve?}
959    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7b115315b032f03ca3df4c5c81481922}{TLS\_GROUP\_SECP384R1}:
960       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_ae1fc4150f9a7963b9479caf37f8d6ebc}{SECP384R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae1fc4150f9a7963b9479caf37f8d6ebc}{SECP384R1\_OID}));
961       \textcolor{keywordflow}{break};
962 \textcolor{preprocessor}{#endif}
963 \textcolor{preprocessor}{#if (TLS\_SECP521R1\_SUPPORT == ENABLED)}
964    \textcolor{comment}{//secp521r1 elliptic curve?}
965    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a3d705e99288a83f62e76b79bef246c59}{TLS\_GROUP\_SECP521R1}:
966       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a06210f1480b1ea674b59500c3cc466b0}{SECP521R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a06210f1480b1ea674b59500c3cc466b0}{SECP521R1\_OID}));
967       \textcolor{keywordflow}{break};
968 \textcolor{preprocessor}{#endif}
969 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP256R1\_SUPPORT == ENABLED)}
970    \textcolor{comment}{//brainpoolP256r1 elliptic curve?}
971    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51abfd48f53149db8cd2ba58aac9ce04576}{TLS\_GROUP\_BRAINPOOLP256R1}:
972    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51abd44ea9cdea162a266e7bc6491c18cd6}{TLS\_GROUP\_BRAINPOOLP256R1\_TLS13}:
973       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a6d07d7a0e087492bbdf4bf0afcf62311}{BRAINPOOLP256R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a6d07d7a0e087492bbdf4bf0afcf62311}{BRAINPOOLP256R1\_OID}));
974       \textcolor{keywordflow}{break};
975 \textcolor{preprocessor}{#endif}
976 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP384R1\_SUPPORT == ENABLED)}
977    \textcolor{comment}{//brainpoolP384r1 elliptic curve?}
978    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51af83ccdc3b5a7a8d1181c82c04f3d4a63}{TLS\_GROUP\_BRAINPOOLP384R1}:
979    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a2c9daa74e357c7a2a30d51bb3e5f1652}{TLS\_GROUP\_BRAINPOOLP384R1\_TLS13}:
980       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_ae9b6dd9f8b29fe8b38dec0423b55a78f}{BRAINPOOLP384R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae9b6dd9f8b29fe8b38dec0423b55a78f}{BRAINPOOLP384R1\_OID}));
981       \textcolor{keywordflow}{break};
982 \textcolor{preprocessor}{#endif}
983 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP512R1\_SUPPORT == ENABLED)}
984    \textcolor{comment}{//brainpoolP512r1 elliptic curve?}
985    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a9350ef65a54e72d15d6d46061e96463f}{TLS\_GROUP\_BRAINPOOLP512R1}:
986    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a530032ac26122cafd094d2fe00277112}{TLS\_GROUP\_BRAINPOOLP512R1\_TLS13}:
987       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a5c304dd54bc16f9363e4ff147224a150}{BRAINPOOLP512R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a5c304dd54bc16f9363e4ff147224a150}{BRAINPOOLP512R1\_OID}));
988       \textcolor{keywordflow}{break};
989 \textcolor{preprocessor}{#endif}
990 \textcolor{preprocessor}{#if (TLS\_X25519\_SUPPORT == ENABLED)}
991    \textcolor{comment}{//Curve25519 elliptic curve?}
992    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51ad4a4ff2936f581ed7959e911941efd22}{TLS\_GROUP\_ECDH\_X25519}:
993       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_ab59e2fc8d4de54edaf7bb4866a57beae}{X25519\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ab59e2fc8d4de54edaf7bb4866a57beae}{X25519\_OID}));
994       \textcolor{keywordflow}{break};
995 \textcolor{preprocessor}{#endif}
996 \textcolor{preprocessor}{#if (TLS\_X448\_SUPPORT == ENABLED)}
997    \textcolor{comment}{//Curve448 elliptic curve?}
998    \textcolor{keywordflow}{case} \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51abfbc2dfae92c12e6ee8f33e2e2ededab}{TLS\_GROUP\_ECDH\_X448}:
999       curveInfo = \hyperlink{ec__curves_8c_a0e60cf6994283f6bf5bcf56e86f9adbe}{ecGetCurveInfo}(\hyperlink{ec__curves_8c_a6f5d28c07c26ec1d021c2eb40067a892}{X448\_OID}, \textcolor{keyword}{sizeof}(\hyperlink{ec__curves_8c_a6f5d28c07c26ec1d021c2eb40067a892}{X448\_OID}));
1000       \textcolor{keywordflow}{break};
1001 \textcolor{preprocessor}{#endif}
1002    \textcolor{comment}{//Unknown elliptic curve identifier?}
1003    \textcolor{keywordflow}{default}:
1004       curveInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1005       \textcolor{keywordflow}{break};
1006    \}
1007 \textcolor{preprocessor}{#endif}
1008 
1009    \textcolor{comment}{//Restrict the use of certain elliptic curves}
1010    \textcolor{keywordflow}{if}(context->numSupportedGroups > 0)
1011    \{
1012       \textcolor{comment}{//Loop through the list of allowed named groups}
1013       \textcolor{keywordflow}{for}(i = 0; i < context->numSupportedGroups; i++)
1014       \{
1015          \textcolor{comment}{//Compare named groups}
1016          \textcolor{keywordflow}{if}(context->supportedGroups[i] == namedCurve)
1017             \textcolor{keywordflow}{break};
1018       \}
1019 
1020       \textcolor{comment}{//Check whether the use of the elliptic curve is restricted}
1021       \textcolor{keywordflow}{if}(i >= context->numSupportedGroups)
1022          curveInfo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1023    \}
1024 
1025    \textcolor{comment}{//Return elliptic curve domain parameters, if any}
1026    \textcolor{keywordflow}{return} curveInfo;
1027 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a0540f6f41d033803f8c6b9f5efe391e8}\label{tls__misc_8h_a0540f6f41d033803f8c6b9f5efe391e8}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Get\+Hash\+Algo@{tls\+Get\+Hash\+Algo}}
\index{tls\+Get\+Hash\+Algo@{tls\+Get\+Hash\+Algo}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Get\+Hash\+Algo()}{tlsGetHashAlgo()}}
{\footnotesize\ttfamily const \hyperlink{structHashAlgo}{Hash\+Algo}$\ast$ tls\+Get\+Hash\+Algo (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}]{hash\+Algo\+Id }\end{DoxyParamCaption})}



Get the hash algorithm that matches the specified identifier. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em hash\+Algo\+Id} & Hash algorithm identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the hash algorithm 
\end{DoxyReturn}


Definition at line 830 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
831 \{
832    \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
833 
834    \textcolor{comment}{//Check hash algorithm identifier}
835    \textcolor{keywordflow}{switch}(hashAlgoId)
836    \{
837 \textcolor{preprocessor}{#if (TLS\_MD5\_SUPPORT == ENABLED)}
838    \textcolor{comment}{//MD5 hash identifier?}
839    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daa72f43566b2829dd24049126ac7a7392}{TLS\_HASH\_ALGO\_MD5}:
840       hashAlgo = \hyperlink{md5_8h_adcb5ecbd7a360856b056f053b0d8343d}{MD5\_HASH\_ALGO};
841       \textcolor{keywordflow}{break};
842 \textcolor{preprocessor}{#endif}
843 \textcolor{preprocessor}{#if (TLS\_SHA1\_SUPPORT == ENABLED)}
844    \textcolor{comment}{//SHA-1 hash identifier?}
845    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156daf10e82baa9d43e28ef949fd55fcfb65f}{TLS\_HASH\_ALGO\_SHA1}:
846       hashAlgo = \hyperlink{sha1_8h_a2529d805a2d0a0ca32114c810cc6cb1b}{SHA1\_HASH\_ALGO};
847       \textcolor{keywordflow}{break};
848 \textcolor{preprocessor}{#endif}
849 \textcolor{preprocessor}{#if (TLS\_SHA224\_SUPPORT == ENABLED)}
850    \textcolor{comment}{//SHA-224 hash identifier?}
851    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da38b1e0d9cbc63a8a2ce2babe9aee4eba}{TLS\_HASH\_ALGO\_SHA224}:
852       hashAlgo = \hyperlink{sha224_8h_a2a0e1f6abfdc1d572f55478719815b94}{SHA224\_HASH\_ALGO};
853       \textcolor{keywordflow}{break};
854 \textcolor{preprocessor}{#endif}
855 \textcolor{preprocessor}{#if (TLS\_SHA256\_SUPPORT == ENABLED)}
856    \textcolor{comment}{//SHA-256 hash identifier?}
857    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da7912aa0ea6b40af839a3d4be331fe182}{TLS\_HASH\_ALGO\_SHA256}:
858       hashAlgo = \hyperlink{sha256_8h_ac65e86d6ed85707af5486ff4d9f87c71}{SHA256\_HASH\_ALGO};
859       \textcolor{keywordflow}{break};
860 \textcolor{preprocessor}{#endif}
861 \textcolor{preprocessor}{#if (TLS\_SHA384\_SUPPORT == ENABLED)}
862    \textcolor{comment}{//SHA-384 hash identifier?}
863    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da53b125010bbd797aa333a41bd1264edb}{TLS\_HASH\_ALGO\_SHA384}:
864       hashAlgo = \hyperlink{sha384_8h_a3dd6226e61249284db3162706a53ea39}{SHA384\_HASH\_ALGO};
865       \textcolor{keywordflow}{break};
866 \textcolor{preprocessor}{#endif}
867 \textcolor{preprocessor}{#if (TLS\_SHA512\_SUPPORT == ENABLED)}
868    \textcolor{comment}{//SHA-512 hash identifier?}
869    \textcolor{keywordflow}{case} \hyperlink{tls_8h_a98b0299cd7e197edc67123642089156da81cc682c95330532471fe9b48fed6acf}{TLS\_HASH\_ALGO\_SHA512}:
870       hashAlgo = \hyperlink{sha512_8h_a0dcb3e237be5f42423ad3a3868ad2b26}{SHA512\_HASH\_ALGO};
871       \textcolor{keywordflow}{break};
872 \textcolor{preprocessor}{#endif}
873    \textcolor{comment}{//Unknown hash identifier?}
874    \textcolor{keywordflow}{default}:
875       hashAlgo = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
876       \textcolor{keywordflow}{break};
877    \}
878 
879    \textcolor{comment}{//Return a pointer to the corresponding hash algorithm}
880    \textcolor{keywordflow}{return} hashAlgo;
881 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a3fd967f568e8584bbce1a691a4d8c14d}\label{tls__misc_8h_a3fd967f568e8584bbce1a691a4d8c14d}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Get\+Named\+Curve@{tls\+Get\+Named\+Curve}}
\index{tls\+Get\+Named\+Curve@{tls\+Get\+Named\+Curve}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Get\+Named\+Curve()}{tlsGetNamedCurve()}}
{\footnotesize\ttfamily \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{Tls\+Named\+Group} tls\+Get\+Named\+Curve (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{oid,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Get the named curve that matches the specified O\+ID. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em oid} & Object identifier \\
\hline
\mbox{\tt in}  & {\em length} & O\+ID length \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Named curve 
\end{DoxyReturn}


Definition at line 1037 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
1038 \{
1039    \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51}{TlsNamedGroup} namedCurve;
1040 
1041    \textcolor{comment}{//Default named curve}
1042    namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1043 
1044 \textcolor{preprocessor}{#if (TLS\_ECDSA\_SIGN\_SUPPORT == ENABLED)}
1045    \textcolor{comment}{//Invalid parameters?}
1046    \textcolor{keywordflow}{if}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == 0)
1047    \{
1048       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1049    \}
1050 \textcolor{preprocessor}{#if (TLS\_SECP160K1\_SUPPORT == ENABLED)}
1051    \textcolor{comment}{//secp160k1 elliptic curve?}
1052    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_ae83e3a05836b71a795e65cab85156508}{SECP160K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae83e3a05836b71a795e65cab85156508}{SECP160K1\_OID})))
1053    \{
1054       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51acda583efe5af2da9fa9e96856eb3b1bf}{TLS\_GROUP\_SECP160K1};
1055    \}
1056 \textcolor{preprocessor}{#endif}
1057 \textcolor{preprocessor}{#if (TLS\_SECP160R1\_SUPPORT == ENABLED)}
1058    \textcolor{comment}{//secp160r1 elliptic curve?}
1059    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a0a23c244c61e369561fc18d1842385fa}{SECP160R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a0a23c244c61e369561fc18d1842385fa}{SECP160R1\_OID})))
1060    \{
1061       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7e9442965686929d4e9f4f7f4980307d}{TLS\_GROUP\_SECP160R1};
1062    \}
1063 \textcolor{preprocessor}{#endif}
1064 \textcolor{preprocessor}{#if (TLS\_SECP160R2\_SUPPORT == ENABLED)}
1065    \textcolor{comment}{//secp160r2 elliptic curve?}
1066    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a1b4e393e8e835a01b8a1130dce9dee81}{SECP160R2\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a1b4e393e8e835a01b8a1130dce9dee81}{SECP160R2\_OID})))
1067    \{
1068       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a41fa96f8032730b6632a20641bead61a}{TLS\_GROUP\_SECP160R2};
1069    \}
1070 \textcolor{preprocessor}{#endif}
1071 \textcolor{preprocessor}{#if (TLS\_SECP192K1\_SUPPORT == ENABLED)}
1072    \textcolor{comment}{//secp192k1 elliptic curve?}
1073    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a1b6b6fce82f3a93530e008d4bec7aafc}{SECP192K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a1b6b6fce82f3a93530e008d4bec7aafc}{SECP192K1\_OID})))
1074    \{
1075       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aeb5261018b0e2fffc11bdd6f48acee6e}{TLS\_GROUP\_SECP192K1};
1076    \}
1077 \textcolor{preprocessor}{#endif}
1078 \textcolor{preprocessor}{#if (TLS\_SECP192R1\_SUPPORT == ENABLED)}
1079    \textcolor{comment}{//secp192r1 elliptic curve?}
1080    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a3649e278e4db5b569148637d893c3109}{SECP192R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a3649e278e4db5b569148637d893c3109}{SECP192R1\_OID})))
1081    \{
1082       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a336d7e6e339c51072d8a1f98e9d64f5c}{TLS\_GROUP\_SECP192R1};
1083    \}
1084 \textcolor{preprocessor}{#endif}
1085 \textcolor{preprocessor}{#if (TLS\_SECP224K1\_SUPPORT == ENABLED)}
1086    \textcolor{comment}{//secp224k1 elliptic curve?}
1087    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_ae26369d1d4ae68d6e0437aedb0a889b1}{SECP224K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae26369d1d4ae68d6e0437aedb0a889b1}{SECP224K1\_OID})))
1088    \{
1089       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51ad40acaf7b2a81365c26fa61c659cba0b}{TLS\_GROUP\_SECP224K1};
1090    \}
1091 \textcolor{preprocessor}{#endif}
1092 \textcolor{preprocessor}{#if (TLS\_SECP224R1\_SUPPORT == ENABLED)}
1093    \textcolor{comment}{//secp224r1 elliptic curve?}
1094    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_af2d74880bd21f7e6fd5594eff3680eaf}{SECP224R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_af2d74880bd21f7e6fd5594eff3680eaf}{SECP224R1\_OID})))
1095    \{
1096       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51af96d8fee1c1205fbcfe35c1d634336ee}{TLS\_GROUP\_SECP224R1};
1097    \}
1098 \textcolor{preprocessor}{#endif}
1099 \textcolor{preprocessor}{#if (TLS\_SECP256K1\_SUPPORT == ENABLED)}
1100    \textcolor{comment}{//secp256k1 elliptic curve?}
1101    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_af67de35881355f34e5b1815786d18dd7}{SECP256K1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_af67de35881355f34e5b1815786d18dd7}{SECP256K1\_OID})))
1102    \{
1103       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7ff3c5404b50d700d0d4c0602bb1ef0c}{TLS\_GROUP\_SECP256K1};
1104    \}
1105 \textcolor{preprocessor}{#endif}
1106 \textcolor{preprocessor}{#if (TLS\_SECP256R1\_SUPPORT == ENABLED)}
1107    \textcolor{comment}{//secp256r1 elliptic curve?}
1108    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_acd07372943f27b81d1e10e86f62c04f9}{SECP256R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_acd07372943f27b81d1e10e86f62c04f9}{SECP256R1\_OID})))
1109    \{
1110       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a754392bfe03e9ee5988cebb5c8466df2}{TLS\_GROUP\_SECP256R1};
1111    \}
1112 \textcolor{preprocessor}{#endif}
1113 \textcolor{preprocessor}{#if (TLS\_SECP384R1\_SUPPORT == ENABLED)}
1114    \textcolor{comment}{//secp384r1 elliptic curve?}
1115    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_ae1fc4150f9a7963b9479caf37f8d6ebc}{SECP384R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae1fc4150f9a7963b9479caf37f8d6ebc}{SECP384R1\_OID})))
1116    \{
1117       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a7b115315b032f03ca3df4c5c81481922}{TLS\_GROUP\_SECP384R1};
1118    \}
1119 \textcolor{preprocessor}{#endif}
1120 \textcolor{preprocessor}{#if (TLS\_SECP521R1\_SUPPORT == ENABLED)}
1121    \textcolor{comment}{//secp521r1 elliptic curve?}
1122    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a06210f1480b1ea674b59500c3cc466b0}{SECP521R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a06210f1480b1ea674b59500c3cc466b0}{SECP521R1\_OID})))
1123    \{
1124       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a3d705e99288a83f62e76b79bef246c59}{TLS\_GROUP\_SECP521R1};
1125    \}
1126 \textcolor{preprocessor}{#endif}
1127 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP256R1\_SUPPORT == ENABLED)}
1128    \textcolor{comment}{//brainpoolP256r1 elliptic curve?}
1129    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a6d07d7a0e087492bbdf4bf0afcf62311}{BRAINPOOLP256R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a6d07d7a0e087492bbdf4bf0afcf62311}{BRAINPOOLP256R1\_OID})))
1130    \{
1131       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51abfd48f53149db8cd2ba58aac9ce04576}{TLS\_GROUP\_BRAINPOOLP256R1};
1132    \}
1133 \textcolor{preprocessor}{#endif}
1134 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP384R1\_SUPPORT == ENABLED)}
1135    \textcolor{comment}{//brainpoolP384r1 elliptic curve?}
1136    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_ae9b6dd9f8b29fe8b38dec0423b55a78f}{BRAINPOOLP384R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_ae9b6dd9f8b29fe8b38dec0423b55a78f}{BRAINPOOLP384R1\_OID})))
1137    \{
1138       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51af83ccdc3b5a7a8d1181c82c04f3d4a63}{TLS\_GROUP\_BRAINPOOLP384R1};
1139    \}
1140 \textcolor{preprocessor}{#endif}
1141 \textcolor{preprocessor}{#if (TLS\_BRAINPOOLP512R1\_SUPPORT == ENABLED)}
1142    \textcolor{comment}{//brainpoolP512r1 elliptic curve?}
1143    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, \hyperlink{ec__curves_8c_a5c304dd54bc16f9363e4ff147224a150}{BRAINPOOLP512R1\_OID}, \textcolor{keyword}{sizeof}(
      \hyperlink{ec__curves_8c_a5c304dd54bc16f9363e4ff147224a150}{BRAINPOOLP512R1\_OID})))
1144    \{
1145       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51a9350ef65a54e72d15d6d46061e96463f}{TLS\_GROUP\_BRAINPOOLP512R1};
1146    \}
1147 \textcolor{preprocessor}{#endif}
1148    \textcolor{comment}{//Unknown identifier?}
1149    \textcolor{keywordflow}{else}
1150    \{
1151       namedCurve = \hyperlink{tls_8h_ae51675bb94f1945c0eed549ef93e6b51aee79345f691598413b1506c1a2f22548}{TLS\_GROUP\_NONE};
1152    \}
1153 \textcolor{preprocessor}{#endif}
1154 
1155    \textcolor{comment}{//Return the corresponding named curve}
1156    \textcolor{keywordflow}{return} namedCurve;
1157 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ae9e2241e80727e56d419facaeb83b91e}\label{tls__misc_8h_ae9e2241e80727e56d419facaeb83b91e}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Get\+Version\+Name@{tls\+Get\+Version\+Name}}
\index{tls\+Get\+Version\+Name@{tls\+Get\+Version\+Name}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Get\+Version\+Name()}{tlsGetVersionName()}}
{\footnotesize\ttfamily const \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t}$\ast$ tls\+Get\+Version\+Name (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{version }\end{DoxyParamCaption})}



Convert T\+LS version to string representation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em version} & Version number \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Cipher suite name 
\end{DoxyReturn}


Definition at line 789 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
790 \{
791    \textcolor{comment}{//TLS versions}
792    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *label[] =
793    \{
794       \textcolor{stringliteral}{"SSL 3.0"},
795       \textcolor{stringliteral}{"TLS 1.0"},
796       \textcolor{stringliteral}{"TLS 1.1"},
797       \textcolor{stringliteral}{"TLS 1.2"},
798       \textcolor{stringliteral}{"TLS 1.3"},
799       \textcolor{stringliteral}{"DTLS 1.0"},
800       \textcolor{stringliteral}{"DTLS 1.2"},
801       \textcolor{stringliteral}{"Unknown"}
802    \};
803 
804    \textcolor{comment}{//Check current version}
805    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
806       \textcolor{keywordflow}{return} label[0];
807    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_adcc8f4321c8f3b847fbea16ca0ff337e}{TLS\_VERSION\_1\_0})
808       \textcolor{keywordflow}{return} label[1];
809    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
810       \textcolor{keywordflow}{return} label[2];
811    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
812       \textcolor{keywordflow}{return} label[3];
813    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
814       \textcolor{keywordflow}{return} label[4];
815    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{dtls__misc_8h_afcf6494322cd28c6fc73db506ad03ba9}{DTLS\_VERSION\_1\_0})
816       \textcolor{keywordflow}{return} label[5];
817    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} == \hyperlink{dtls__misc_8h_a18aa230c9e3a222d1566d74f15f13818}{DTLS\_VERSION\_1\_2})
818       \textcolor{keywordflow}{return} label[6];
819    \textcolor{keywordflow}{else}
820       \textcolor{keywordflow}{return} label[7];
821 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a4162f3ce7f2e32575f8f6a011b8502ce}\label{tls__misc_8h_a4162f3ce7f2e32575f8f6a011b8502ce}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Init\+Encryption\+Engine@{tls\+Init\+Encryption\+Engine}}
\index{tls\+Init\+Encryption\+Engine@{tls\+Init\+Encryption\+Engine}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Init\+Encryption\+Engine()}{tlsInitEncryptionEngine()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Init\+Encryption\+Engine (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{structTlsEncryptionEngine}{Tls\+Encryption\+Engine} $\ast$}]{encryption\+Engine,  }\item[{\hyperlink{tls_8h_acb21bc158664d823d899d760edd8135b}{Tls\+Connection\+End}}]{entity,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{secret }\end{DoxyParamCaption})}



Initialize encryption engine. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em encryption\+Engine} & Pointer to the encryption/decryption engine to be initialized \\
\hline
\mbox{\tt in}  & {\em entity} & Specifies whether client or server write keys shall be used \\
\hline
\mbox{\tt in}  & {\em secret} & Pointer to the secret value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 355 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
358 \{
359    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
360    \textcolor{keyword}{const} \hyperlink{structCipherAlgo}{CipherAlgo} *cipherAlgo;
361    \hyperlink{structTlsCipherSuiteInfo}{TlsCipherSuiteInfo} *\hyperlink{tls13__misc_8h_ac4845d111b268869455afbd35c5f477b}{cipherSuite};
362 
363    \textcolor{comment}{//Point to the negotiated cipher suite}
364    cipherSuite = &context->cipherSuite;
365    \textcolor{comment}{//Point to the cipher algorithm}
366    cipherAlgo = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a98bbb77e510d4841cf2b25e337f93233}{cipherAlgo};
367 
368    \textcolor{comment}{//Save the negotiated TLS version}
369    encryptionEngine->\hyperlink{structTlsEncryptionEngine_aa340a0b969c2b0f795556e66a68fae27}{version} = context->version;
370 
371    \textcolor{comment}{//The sequence number is set to zero at the beginning of a connection}
372    \textcolor{comment}{//and whenever the key is changed}
373    memset(&encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ab9706be268c77258f4c7238721793c}{seqNum}, 0, \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_aadbcbb634b990da0c6d0d07fe08e9f89}{TlsSequenceNumber}));
374 
375 \textcolor{preprocessor}{#if (DTLS\_SUPPORT == ENABLED)}
376    \textcolor{comment}{//The epoch number is initially zero and is incremented each time a}
377    \textcolor{comment}{//ChangeCipherSpec message is sent}
378    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a7c88a932eb88fccdae6829f18709b1b6}{epoch}++;
379 
380    \textcolor{comment}{//Sequence numbers are maintained separately for each epoch, with each}
381    \textcolor{comment}{//sequence number initially being 0 for each epoch}
382    memset(&encryptionEngine->\hyperlink{structTlsEncryptionEngine_a5b11eabf56e10b96ec3c1879a422b1fe}{dtlsSeqNum}, 0, \textcolor{keyword}{sizeof}(\hyperlink{dtls__misc_8h_a900105a81f878731b46d80a2cde979aa}{DtlsSequenceNumber}));
383 \textcolor{preprocessor}{#endif}
384 
385 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
386    \textcolor{comment}{//The value of RecordSizeLimit is used to limit the size of records}
387    \textcolor{comment}{//that are created when encoding application data and the protected}
388    \textcolor{comment}{//handshake message into records (refer to RFC 8449, section 4)}
389    \textcolor{keywordflow}{if}(entity == context->entity)
390    \{
391       encryptionEngine->\hyperlink{structTlsEncryptionEngine_a5191d4d46b33d01d0128e3ef42d73920}{recordSizeLimit} = context->recordSizeLimit;
392    \}
393    \textcolor{keywordflow}{else}
394    \{
395       encryptionEngine->\hyperlink{structTlsEncryptionEngine_a5191d4d46b33d01d0128e3ef42d73920}{recordSizeLimit} = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(context->rxBufferMaxLen,
396          \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH});
397    \}
398 \textcolor{preprocessor}{#endif}
399 
400    \textcolor{comment}{//Set appropriate length for MAC key, encryption key, authentication}
401    \textcolor{comment}{//tag and IV}
402    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a26e44e1dbfb86e7a0f118dc4d859d7ab}{macKeyLen} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen};
403    encryptionEngine->\hyperlink{structTlsEncryptionEngine_ad657d271cd7780efcb7d2005737256dd}{encKeyLen} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen};
404    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a40318ca61231c157990a287f4a9c0e2a}{fixedIvLen} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen};
405    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a9b9d6c4c5f58c7dd0e040818fe6a2681}{recordIvLen} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a9be693ee50a842c085ca12cbe170cfcf}{recordIvLen};
406    encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef28b3fa8d6ac0147cdc47db9a642fc7}{authTagLen} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a133e585a8f9034be939c5b79f1243278}{authTagLen};
407 
408    \textcolor{comment}{//Set cipher and hash algorithms}
409    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a2ba455619112e97e419c3c51de90b0ca}{cipherAlgo} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a98bbb77e510d4841cf2b25e337f93233}{cipherAlgo};
410    encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a0c97190e410a53e9d5aa83d1350b967e}{cipherMode};
411    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a879e3f9933f7d2bf140e1eb8696d4abd}{hashAlgo} = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a3386dc6ed6d7e5ed8b5cb9f233de1fa0}{hashAlgo};
412 
413    \textcolor{comment}{//Initialize cipher context}
414    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
415 
416 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
417    \textcolor{comment}{//Initialize HMAC context}
418    encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6e659b6a95474feec4ee46f40c7b92e4}{hmacContext} = &context->hmacContext;
419 \textcolor{preprocessor}{#endif}
420 
421 \textcolor{preprocessor}{#if (TLS\_GCM\_CIPHER\_SUPPORT == ENABLED)}
422    \textcolor{comment}{//Initialize GCM context}
423    encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
424 \textcolor{preprocessor}{#endif}
425 
426 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
427    \textcolor{comment}{//SSL 3.0, TLS 1.0, TLS 1.1 or TLS 1.2 currently selected?}
428    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
429    \{
430       \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
431 
432       \textcolor{comment}{//Check whether client or server write keys shall be used}
433       \textcolor{keywordflow}{if}(entity == \hyperlink{tls_8h_acb21bc158664d823d899d760edd8135ba7f216418b2d898ed01cf9376fd9b3d6d}{TLS\_CONNECTION\_END\_CLIENT})
434       \{
435          \textcolor{comment}{//Point to the key material}
436          p = context->keyBlock;
437          \textcolor{comment}{//Save MAC key}
438          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_addc5682b60f0e934f1b838909b8aea7c}{macKey}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen});
439 
440          \textcolor{comment}{//Advance current position in the key block}
441          p += 2 * cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen};
442          \textcolor{comment}{//Save encryption key}
443          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac52797db6bbb0e89321c969292dfddd6}{encKey}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen});
444 
445          \textcolor{comment}{//Advance current position in the key block}
446          p += 2 * cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen};
447          \textcolor{comment}{//Save initialization vector}
448          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_af7dda7e3510e4e13458a16c5357143f7}{iv}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen});
449       \}
450       \textcolor{keywordflow}{else}
451       \{
452          \textcolor{comment}{//Point to the key material}
453          p = context->keyBlock + cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen};
454          \textcolor{comment}{//Save MAC key}
455          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_addc5682b60f0e934f1b838909b8aea7c}{macKey}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen});
456 
457          \textcolor{comment}{//Advance current position in the key block}
458          p += cipherSuite->\hyperlink{structTlsCipherSuiteInfo_af6b9870391d1a8e12094db880597d48a}{macKeyLen} + cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen};
459          \textcolor{comment}{//Save encryption key}
460          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac52797db6bbb0e89321c969292dfddd6}{encKey}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen});
461 
462          \textcolor{comment}{//Advance current position in the key block}
463          p += cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen} + cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen};
464          \textcolor{comment}{//Save initialization vector}
465          memcpy(encryptionEngine->\hyperlink{structTlsEncryptionEngine_af7dda7e3510e4e13458a16c5357143f7}{iv}, p, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen});
466       \}
467 
468       \textcolor{comment}{//Successful processing}
469       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
470    \}
471    \textcolor{keywordflow}{else}
472 \textcolor{preprocessor}{#endif}
473 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= TLS\_VERSION\_1\_3 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_3)}
474    \textcolor{comment}{//TLS 1.3 currently selected?}
475    \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
476    \{
477       \textcolor{keyword}{const} \hyperlink{structHashAlgo}{HashAlgo} *hashAlgo;
478 
479       \textcolor{comment}{//The hash function used by HKDF is the cipher suite hash algorithm}
480       hashAlgo = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a12b0a5d8b68b1641a1800a9a469a515a}{prfHashAlgo};
481 
482       \textcolor{comment}{//Make sure the hash algorithm is valid}
483       \textcolor{keywordflow}{if}(hashAlgo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
484       \{
485          \textcolor{comment}{//Calculate the write key}
486          error = \hyperlink{tls13__key__material_8h_ae6c9a07034fb5ca2dcaaef6ac2aa88e9}{tls13HkdfExpandLabel}(hashAlgo, secret, hashAlgo->
      \hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
487             \textcolor{stringliteral}{"key"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac52797db6bbb0e89321c969292dfddd6}{encKey}, cipherSuite->
      \hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen});
488 
489          \textcolor{comment}{//Debug message}
490          \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"Write Key:\(\backslash\)r\(\backslash\)n"});
491          \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac52797db6bbb0e89321c969292dfddd6}{encKey}, cipherSuite->
      \hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen});
492 
493          \textcolor{comment}{//Check status code}
494          \textcolor{keywordflow}{if}(!error)
495          \{
496             \textcolor{comment}{//Calculate the write IV}
497             error = \hyperlink{tls13__key__material_8h_ae6c9a07034fb5ca2dcaaef6ac2aa88e9}{tls13HkdfExpandLabel}(hashAlgo, secret, hashAlgo->
      \hyperlink{structHashAlgo_a0c8ccdb22ea395ccdd8decd06401d22e}{digestSize},
498                \textcolor{stringliteral}{"iv"}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, encryptionEngine->\hyperlink{structTlsEncryptionEngine_af7dda7e3510e4e13458a16c5357143f7}{iv}, cipherSuite->
      \hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen});
499          \}
500 
501          \textcolor{comment}{//Debug message}
502          \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"Write IV:\(\backslash\)r\(\backslash\)n"});
503          \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(\textcolor{stringliteral}{"  "}, encryptionEngine->\hyperlink{structTlsEncryptionEngine_af7dda7e3510e4e13458a16c5357143f7}{iv}, cipherSuite->
      \hyperlink{structTlsCipherSuiteInfo_a2c6a2507984b67e38c6550630a20faef}{fixedIvLen});
504       \}
505       \textcolor{keywordflow}{else}
506       \{
507          \textcolor{comment}{//Invalid HKDF hash algorithm}
508          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
509       \}
510    \}
511    \textcolor{keywordflow}{else}
512 \textcolor{preprocessor}{#endif}
513    \textcolor{comment}{//Invalid TLS version?}
514    \{
515       \textcolor{comment}{//Report an error}
516       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafc403a048723cbb5e5ade33caa70c48b}{ERROR\_INVALID\_VERSION};
517    \}
518 
519    \textcolor{comment}{//Check status code}
520    \textcolor{keywordflow}{if}(!error)
521    \{
522       \textcolor{comment}{//Check cipher mode of operation}
523       \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a97fe9f5ed79394865625397eb96140ee}{CIPHER\_MODE\_STREAM} ||
524          encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a7c82e8aeb1e9badb0c083823b5b14eaa}{CIPHER\_MODE\_CBC} ||
525          encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a42db5b52a68da8ba71735ac7248f7401}{CIPHER\_MODE\_CCM} ||
526          encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5af09ab2345f2ff996cf47696f7540fe7a}{CIPHER\_MODE\_GCM})
527       \{
528          \textcolor{comment}{//Allocate encryption context}
529          encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext} = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(cipherAlgo->
      \hyperlink{structCipherAlgo_a79c74860795d2bf2ef6bff7885a33666}{contextSize});
530 
531          \textcolor{comment}{//Successful memory allocation?}
532          \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
533          \{
534             \textcolor{comment}{//Configure the encryption engine with the write key}
535             error = cipherAlgo->\hyperlink{structCipherAlgo_a5c1fa3eb89f3d31f01c2c501b94fdd79}{init}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext},
536                encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac52797db6bbb0e89321c969292dfddd6}{encKey}, cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a2cd8770a9ef763ba4e67d2b128007cd8}{encKeyLen});
537          \}
538          \textcolor{keywordflow}{else}
539          \{
540             \textcolor{comment}{//Failed to allocate memory}
541             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
542          \}
543       \}
544       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5af2b260457a3fa53d37ac1701c7b6502e}{CIPHER\_MODE\_NULL} ||
545          encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5a0a78e04fbee5d777bfd542b085003855}{CIPHER\_MODE\_CHACHA20\_POLY1305}
      )
546       \{
547          \textcolor{comment}{//No need to allocate an encryption context}
548          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
549       \}
550       \textcolor{keywordflow}{else}
551       \{
552          \textcolor{comment}{//Unsupported mode of operation}
553          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
554       \}
555    \}
556 
557 \textcolor{preprocessor}{#if (TLS\_GCM\_CIPHER\_SUPPORT == ENABLED)}
558    \textcolor{comment}{//Check status code}
559    \textcolor{keywordflow}{if}(!error)
560    \{
561       \textcolor{comment}{//GCM cipher mode?}
562       \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_ac7326a9b894b4447ed52df0baa65b294}{cipherMode} == \hyperlink{cyclone__crypto_2core_2crypto_8h_ac3adaabf9bad553901589ddf3de6daf5af09ab2345f2ff996cf47696f7540fe7a}{CIPHER\_MODE\_GCM})
563       \{
564          \textcolor{comment}{//Allocate a memory buffer to hold the GCM context}
565          encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext} = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(\textcolor{keyword}{sizeof}(
      \hyperlink{structGcmContext}{GcmContext}));
566 
567          \textcolor{comment}{//Successful memory allocation?}
568          \textcolor{keywordflow}{if}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
569          \{
570             \textcolor{comment}{//Initialize GCM context}
571             error = \hyperlink{gcm_8c_abc76ae24190694f6db77a7dc195072f9}{gcmInit}(encryptionEngine->\hyperlink{structTlsEncryptionEngine_aef9d3f24e20174d9493d919ec8964b7c}{gcmContext}, cipherAlgo,
572                encryptionEngine->\hyperlink{structTlsEncryptionEngine_a6fb752231a2f6d7d6789c35481af0559}{cipherContext});
573          \}
574          \textcolor{keywordflow}{else}
575          \{
576             \textcolor{comment}{//Failed to allocate memory}
577             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
578          \}
579       \}
580    \}
581 \textcolor{preprocessor}{#endif}
582 
583    \textcolor{comment}{//Return status code}
584    \textcolor{keywordflow}{return} error;
585 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ae43b7ef806126baf125c46cdb9424e87}\label{tls__misc_8h_ae43b7ef806126baf125c46cdb9424e87}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Process\+Error@{tls\+Process\+Error}}
\index{tls\+Process\+Error@{tls\+Process\+Error}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Process\+Error()}{tlsProcessError()}}
{\footnotesize\ttfamily void tls\+Process\+Error (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t}}]{error\+Code }\end{DoxyParamCaption})}



Translate an error code to an alert message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em error\+Code} & Internal error code \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 56 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
57 \{
58    \textcolor{comment}{//Check current state}
59    \textcolor{keywordflow}{if}(context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da91123cf9d82ef3aac68e9e091ef5c9f9}{TLS\_STATE\_INIT} &&
60       context->state != \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED})
61    \{
62       \textcolor{comment}{//Check status code}
63       \textcolor{keywordflow}{switch}(\hyperlink{tftp__common_8h_a78abca92c8fa2790c1d32470831537e8}{errorCode})
64       \{
65       \textcolor{comment}{//The timeout interval has elapsed}
66       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT}:
67          \textcolor{keywordflow}{break};
68       \textcolor{comment}{//The read/write operation would have blocked}
69       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK}:
70          \textcolor{keywordflow}{break};
71       \textcolor{comment}{//Failed to allocate memory}
72       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY}:
73          \textcolor{keywordflow}{break};
74       \textcolor{comment}{//The read/write operation has failed}
75       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7446f962c635e715f75bc4aff05feb77}{ERROR\_WRITE\_FAILED}:
76       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacf545b4d693b270f9d01d54d86efedc2}{ERROR\_READ\_FAILED}:
77          context->state = \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da182b100e092b0058c72d76006b7981fd}{TLS\_STATE\_CLOSED};
78          \textcolor{keywordflow}{break};
79       \textcolor{comment}{//An inappropriate message was received}
80       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE}:
81          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba180d0bdb58c4abb6571cdbb6718c5287}{TLS\_ALERT\_UNEXPECTED\_MESSAGE});
82          \textcolor{keywordflow}{break};
83       \textcolor{comment}{//A record is received with an incorrect MAC}
84       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5e1d50ad3e2e1310d0414656ca3e7bde}{ERROR\_BAD\_RECORD\_MAC}:
85          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbaa30d3c93d78ca206a13167a70a326c7f}{TLS\_ALERT\_BAD\_RECORD\_MAC});
86          \hyperlink{debug_8h_aaf9a5c67ad0ffd97cfca6d77c6af536f}{TRACE\_ERROR}(\textcolor{stringliteral}{"BAD MAC? TLS\_MISC\(\backslash\)r\(\backslash\)n"});
87          \textcolor{keywordflow}{break};
88       \textcolor{comment}{//Invalid record length}
89       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cacb4ee8addfac0a3444278066663c368a}{ERROR\_RECORD\_OVERFLOW}:
90          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbadf2f6d79c7b24277aefcc9f6d8bee8c8}{TLS\_ALERT\_RECORD\_OVERFLOW});
91          \textcolor{keywordflow}{break};
92       \textcolor{comment}{//Unable to negotiate an acceptable set of security parameters}
93       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED}:
94          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbad5196d2f42445cd72f5dfa905f23d2d5}{TLS\_ALERT\_HANDSHAKE\_FAILURE});
95          \textcolor{keywordflow}{break};
96       \textcolor{comment}{//A certificate was corrupt}
97       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac22a1806531a09ab25cc2ef268b2eeb0}{ERROR\_BAD\_CERTIFICATE}:
98          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba0a774985b70e0ad89b058e6927c356b2}{TLS\_ALERT\_BAD\_CERTIFICATE});
99          \textcolor{keywordflow}{break};
100       \textcolor{comment}{//A certificate was of an unsupported type}
101       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE}:
102          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbaea98ef959d4e8db5fd082cfb6ddb09e2}{TLS\_ALERT\_UNSUPPORTED\_CERTIFICATE});
103          \textcolor{keywordflow}{break};
104       \textcolor{comment}{//A certificate has expired or is not currently valid}
105       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caa2946c553fc62b37757e42e1995d17e3}{ERROR\_CERTIFICATE\_EXPIRED}:
106          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbabc0a2a4c0062e1d818e13c67c14907fc}{TLS\_ALERT\_CERTIFICATE\_EXPIRED});
107          \textcolor{keywordflow}{break};
108       \textcolor{comment}{//A field in the handshake was out of range or inconsistent with other fields}
109       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER}:
110          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbac829387e5c9946151e986f8850ddb9c6}{TLS\_ALERT\_ILLEGAL\_PARAMETER});
111          \textcolor{keywordflow}{break};
112       \textcolor{comment}{//The certificate could not be matched with a known, trusted CA}
113       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca3e2d265eb201636dd171c203a9adf1de}{ERROR\_UNKNOWN\_CA}:
114          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba7dd0b1c75ecbe89fcdc4ef4923386528}{TLS\_ALERT\_UNKNOWN\_CA});
115          \textcolor{keywordflow}{break};
116       \textcolor{comment}{//A message could not be decoded because some field was incorrect}
117       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED}:
118          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba5520702a71852fd106726d1cbc312293}{TLS\_ALERT\_DECODE\_ERROR});
119          \textcolor{keywordflow}{break};
120       \textcolor{comment}{//A handshake cryptographic operation failed}
121       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca42ac4eb97a02112d45b5f0405c0393c1}{ERROR\_DECRYPTION\_FAILED}:
122       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE}:
123          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbafdd6ddf720efabef66dfe7eaabdbcdd8}{TLS\_ALERT\_DECRYPT\_ERROR});
124          \textcolor{keywordflow}{break};
125       \textcolor{comment}{//The protocol version the client has attempted to negotiate is not supported}
126       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca20a00b499b03770ffd859e78470c278f}{ERROR\_VERSION\_NOT\_SUPPORTED}:
127          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba9311b8ac2b641915809932cc30335a55}{TLS\_ALERT\_PROTOCOL\_VERSION});
128          \textcolor{keywordflow}{break};
129       \textcolor{comment}{//Inappropriate fallback detected by the server}
130       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca425a82f41b6a546698868167c341ef1c}{ERROR\_INAPPROPRIATE\_FALLBACK}:
131          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba87f52c6dd84c66435bf859eb29a317f0}{TLS\_ALERT\_INAPPROPRIATE\_FALLBACK});
132          \textcolor{keywordflow}{break};
133       \textcolor{comment}{//Handshake message not containing an extension that is mandatory}
134       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2077bd85b4a42b704992210364bfb334}{ERROR\_MISSING\_EXTENSION}:
135          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba4fef9692e1afb02fde8788b4f45cd246}{TLS\_ALERT\_MISSING\_EXTENSION});
136          \textcolor{keywordflow}{break};
137       \textcolor{comment}{//The ServerHello contains an extension not present in the ClientHello}
138       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca0024b1359f3a168578a6cf9da0ca4564}{ERROR\_UNSUPPORTED\_EXTENSION}:
139          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba0be528a9012250bc8e9c96bc96c50484}{TLS\_ALERT\_UNSUPPORTED\_EXTENSION});
140          \textcolor{keywordflow}{break};
141       \textcolor{comment}{//A client certificate is desired but none was provided by the client}
142       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac9ea6c354e68dee76c22d47d620f7718}{ERROR\_CERTIFICATE\_REQUIRED}:
143          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba919807f1b8f61236b77d9e4a77891e57}{TLS\_ALERT\_CERTIFICATE\_REQUIRED});
144          \textcolor{keywordflow}{break};
145       \textcolor{comment}{//No application protocol supported by the server}
146       \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabccb26e28d44e4c860d43cb6bd9dcc6d}{ERROR\_NO\_APPLICATION\_PROTOCOL}:
147          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dba60b6267055e896bcb82cff50b48cf61b}{TLS\_ALERT\_NO\_APPLICATION\_PROTOCOL});
148          \textcolor{keywordflow}{break};
149       \textcolor{comment}{//Internal error}
150       \textcolor{keywordflow}{default}:
151          \hyperlink{tls__common_8c_a8ce30f40a9d800f679d6fa948993a7e5}{tlsSendAlert}(context, \hyperlink{tls_8h_ac8e8e96f1ba392878e3630791353d202adfdcd7c054d6ad81223ced6d22195bf5}{TLS\_ALERT\_LEVEL\_FATAL}, 
      \hyperlink{tls_8h_a1c40e8edb44cd99ad7f67b97690aa8dbaec3cf3ccc22e00c52491429d10375394}{TLS\_ALERT\_INTERNAL\_ERROR});
152          \textcolor{keywordflow}{break};
153       \}
154    \}
155 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ac6d7ad566c151d978f10283c3e6710ff}\label{tls__misc_8h_ac6d7ad566c151d978f10283c3e6710ff}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Read\+Ec\+Point@{tls\+Read\+Ec\+Point}}
\index{tls\+Read\+Ec\+Point@{tls\+Read\+Ec\+Point}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Read\+Ec\+Point()}{tlsReadEcPoint()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Read\+Ec\+Point (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{params,  }\item[{\hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Read an EC point from an opaque vector. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em params} & EC domain parameters \\
\hline
\mbox{\tt out}  & {\em a} & Resulting EC point \\
\hline
\mbox{\tt in}  & {\em data} & Buffer where to read the opaque vector \\
\hline
\mbox{\tt in}  & {\em size} & Total number of bytes available in the buffer \\
\hline
\mbox{\tt out}  & {\em length} & Total number of bytes that have been read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 743 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
745 \{
746 \textcolor{preprocessor}{#if (TLS\_ECDH\_ANON\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_RSA\_KE\_SUPPORT == ENABLED || \(\backslash\)}
747 \textcolor{preprocessor}{   TLS\_ECDHE\_ECDSA\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_PSK\_KE\_SUPPORT == ENABLED)}
748    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
749    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
750 
751    \textcolor{comment}{//Buffer underrun?}
752    \textcolor{keywordflow}{if}(size < 1)
753       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
754 
755    \textcolor{comment}{//The EC point representation is preceded by a length field}
756    n = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0];
757 
758    \textcolor{comment}{//Invalid EC point representation?}
759    \textcolor{keywordflow}{if}(n == 0)
760       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
761 
762    \textcolor{comment}{//Buffer underrun?}
763    \textcolor{keywordflow}{if}(size < (n + 1))
764       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
765 
766    \textcolor{comment}{//Convert the octet string to an EC point}
767    error = \hyperlink{ec_8c_ae707a9a99979ce0b291ac6c0f8d380fd}{ecImport}(params, a, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + 1, n);
768    \textcolor{comment}{//Any error to report?}
769    \textcolor{keywordflow}{if}(error)
770       \textcolor{keywordflow}{return} error;
771 
772    \textcolor{comment}{//Return the total number of bytes that have been read}
773    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = n + 1;
774    \textcolor{comment}{//Successful processing}
775    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
776 \textcolor{preprocessor}{#else}
777    \textcolor{comment}{//Not implemented}
778    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
779 \textcolor{preprocessor}{#endif}
780 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ac339933c6e9abec0ad7758fb4000673e}\label{tls__misc_8h_ac339933c6e9abec0ad7758fb4000673e}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Read\+Mpi@{tls\+Read\+Mpi}}
\index{tls\+Read\+Mpi@{tls\+Read\+Mpi}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Read\+Mpi()}{tlsReadMpi()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Read\+Mpi (\begin{DoxyParamCaption}\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Read a multiple precision integer from an opaque vector. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em a} & Resulting multiple precision integer \\
\hline
\mbox{\tt in}  & {\em data} & Buffer where to read the opaque vector \\
\hline
\mbox{\tt in}  & {\em size} & Total number of bytes available in the buffer \\
\hline
\mbox{\tt out}  & {\em length} & Total number of bytes that have been read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 668 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
669 \{
670    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
671    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
672 
673    \textcolor{comment}{//Buffer underrun?}
674    \textcolor{keywordflow}{if}(size < 2)
675       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
676 
677    \textcolor{comment}{//Decode the length field}
678    n = \hyperlink{cpu__endian_8h_ae21854587c05993c850b537156470088}{LOAD16BE}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data});
679 
680    \textcolor{comment}{//Buffer underrun?}
681    \textcolor{keywordflow}{if}(size < (n + 2))
682       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
683 
684    \textcolor{comment}{//Convert the octet string to a multiple precision integer}
685    error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(a, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + 2, n, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa0912b5922ecee206ec51e40d5285f77e}{MPI\_FORMAT\_BIG\_ENDIAN});
686    \textcolor{comment}{//Any error to report?}
687    \textcolor{keywordflow}{if}(error)
688       \textcolor{keywordflow}{return} error;
689 
690    \textcolor{comment}{//Return the total number of bytes that have been read}
691    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = n + 2;
692    \textcolor{comment}{//Successful processing}
693    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
694 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a2ba32c2ad10fd77d5947387e6753210d}\label{tls__misc_8h_a2ba32c2ad10fd77d5947387e6753210d}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Select\+Cipher\+Suite@{tls\+Select\+Cipher\+Suite}}
\index{tls\+Select\+Cipher\+Suite@{tls\+Select\+Cipher\+Suite}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Select\+Cipher\+Suite()}{tlsSelectCipherSuite()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Select\+Cipher\+Suite (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{identifier }\end{DoxyParamCaption})}



Set cipher suite. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em identifier} & Cipher suite identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 254 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
255 \{
256    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
257    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
258    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
259    \textcolor{keyword}{const} \hyperlink{structTlsCipherSuiteInfo}{TlsCipherSuiteInfo} *\hyperlink{tls13__misc_8h_ac4845d111b268869455afbd35c5f477b}{cipherSuite};
260 
261    \textcolor{comment}{//Initialize status code}
262    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
263 
264    \textcolor{comment}{//Determine the number of supported cipher suites}
265    n = \hyperlink{tls__cipher__suites_8c_a90cd4f4fa1b90998f05cf0586f8b9bb1}{tlsGetNumSupportedCipherSuites}();
266 
267    \textcolor{comment}{//Loop through the list of supported cipher suites}
268    \textcolor{keywordflow}{for}(cipherSuite = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
269    \{
270       \textcolor{comment}{//Compare cipher suite identifiers}
271       \textcolor{keywordflow}{if}(\hyperlink{tls__cipher__suites_8c_af2867fd066cb5cb528d6d9358fa499d6}{tlsSupportedCipherSuites}[i].\hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier} == 
      \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier})
272       \{
273          \textcolor{comment}{//The cipher suite is supported}
274          cipherSuite = &\hyperlink{tls__cipher__suites_8c_af2867fd066cb5cb528d6d9358fa499d6}{tlsSupportedCipherSuites}[i];
275          \textcolor{keywordflow}{break};
276       \}
277    \}
278 
279    \textcolor{comment}{//Restrict the use of certain cipher suites}
280    \textcolor{keywordflow}{if}(context->numCipherSuites > 0)
281    \{
282       \textcolor{comment}{//Loop through the list of allowed cipher suites}
283       \textcolor{keywordflow}{for}(i = 0; i < context->numCipherSuites; i++)
284       \{
285          \textcolor{comment}{//Compare cipher suite identifiers}
286          \textcolor{keywordflow}{if}(context->cipherSuites[i] == \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier})
287             \textcolor{keywordflow}{break};
288       \}
289 
290       \textcolor{comment}{//Check whether the use of the cipher suite is restricted}
291       \textcolor{keywordflow}{if}(i >= context->numCipherSuites)
292          cipherSuite = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
293    \}
294 
295    \textcolor{comment}{//Acceptable cipher suite?}
296    \textcolor{keywordflow}{if}(cipherSuite != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
297    \{
298       \textcolor{comment}{//Check whether the cipher suite can be negotiated with the negotiated}
299       \textcolor{comment}{//protocol version}
300       \textcolor{keywordflow}{if}(!\hyperlink{tls__cipher__suites_8c_ac2870fccdebcb69b96b732397206d175}{tlsIsCipherSuiteAcceptable}(cipherSuite, context->version,
301          context->version, context->transportProtocol))
302       \{
303          cipherSuite = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
304       \}
305    \}
306 
307    \textcolor{comment}{//Ensure that the selected cipher suite matches all the criteria}
308    \textcolor{keywordflow}{if}(cipherSuite != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
309    \{
310       \textcolor{comment}{//Save the negotiated cipher suite}
311       context->cipherSuite = *\hyperlink{tls13__misc_8h_ac4845d111b268869455afbd35c5f477b}{cipherSuite};
312       \textcolor{comment}{//Set the key exchange method to be used}
313       context->keyExchMethod = cipherSuite->\hyperlink{structTlsCipherSuiteInfo_a79b95a8e28593fdb1981bd8bf50b3d22}{keyExchMethod};
314 
315       \textcolor{comment}{//PRF with the SHA-256 is used for all cipher suites published prior}
316       \textcolor{comment}{//than TLS 1.2 when TLS 1.2 is negotiated}
317       \textcolor{keywordflow}{if}(context->cipherSuite.prfHashAlgo == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
318          context->cipherSuite.prfHashAlgo = \hyperlink{sha256_8h_ac65e86d6ed85707af5486ff4d9f87c71}{SHA256\_HASH\_ALGO};
319 
320       \textcolor{comment}{//The length of the verify data depends on the TLS version currently used}
321       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
322       \{
323          \textcolor{comment}{//Verify data is always 36-byte long for SSL 3.0}
324          context->cipherSuite.verifyDataLen = 36;
325       \}
326       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1})
327       \{
328          \textcolor{comment}{//Verify data is always 12-byte long for TLS 1.0 and 1.1}
329          context->cipherSuite.verifyDataLen = 12;
330       \}
331       \textcolor{keywordflow}{else}
332       \{
333          \textcolor{comment}{//The length of the verify data depends on the cipher suite for TLS 1.2}
334       \}
335 
336       \textcolor{comment}{//The specified cipher suite is acceptable}
337       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
338    \}
339 
340    \textcolor{comment}{//Return status code}
341    \textcolor{keywordflow}{return} error;
342 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_a62b0052733220e9ec9fee8ff5e8e5dab}\label{tls__misc_8h_a62b0052733220e9ec9fee8ff5e8e5dab}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Select\+Version@{tls\+Select\+Version}}
\index{tls\+Select\+Version@{tls\+Select\+Version}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Select\+Version()}{tlsSelectVersion()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Select\+Version (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{version }\end{DoxyParamCaption})}



Set the T\+LS version to be used. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em version} & T\+LS version \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 226 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
227 \{
228    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
229 
230    \textcolor{comment}{//Initialize status code}
231    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca20a00b499b03770ffd859e78470c278f}{ERROR\_VERSION\_NOT\_SUPPORTED};
232 
233    \textcolor{comment}{//Check TLS version}
234    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version} >= context->versionMin && version <= context->versionMax)
235    \{
236       \textcolor{comment}{//Save the TLS protocol version to be used}
237       context->version = \hyperlink{dtls__misc_8h_ab6d7b6f8c2ceaba7acda80aaf05f4899}{version};
238       \textcolor{comment}{//The specified TLS version is acceptable}
239       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
240    \}
241 
242    \textcolor{comment}{//Return status code}
243    \textcolor{keywordflow}{return} error;
244 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_ae1d6ad23621c58ee4fe6954521e1cb34}\label{tls__misc_8h_ae1d6ad23621c58ee4fe6954521e1cb34}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Write\+Ec\+Point@{tls\+Write\+Ec\+Point}}
\index{tls\+Write\+Ec\+Point@{tls\+Write\+Ec\+Point}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Write\+Ec\+Point()}{tlsWriteEcPoint()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Write\+Ec\+Point (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{params,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{a,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Encode an EC point to an opaque vector. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em params} & EC domain parameters \\
\hline
\mbox{\tt in}  & {\em a} & Pointer to an EC point \\
\hline
\mbox{\tt out}  & {\em data} & Buffer where to store the opaque vector \\
\hline
\mbox{\tt out}  & {\em length} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 706 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
708 \{
709 \textcolor{preprocessor}{#if (TLS\_ECDH\_ANON\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_RSA\_KE\_SUPPORT == ENABLED || \(\backslash\)}
710 \textcolor{preprocessor}{   TLS\_ECDHE\_ECDSA\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_PSK\_KE\_SUPPORT == ENABLED)}
711    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
712 
713    \textcolor{comment}{//Convert the EC point to an octet string}
714    error = \hyperlink{ec_8c_a5b0e532e196ac4715c98d0946304772c}{ecExport}(params, a, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + 1, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
715    \textcolor{comment}{//Any error to report?}
716    \textcolor{keywordflow}{if}(error)
717       \textcolor{keywordflow}{return} error;
718 
719    \textcolor{comment}{//Set the length of the opaque vector}
720    \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) (*\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
721 
722    \textcolor{comment}{//Return the total number of bytes that have been written}
723    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} += 1;
724    \textcolor{comment}{//Successful processing}
725    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
726 \textcolor{preprocessor}{#else}
727    \textcolor{comment}{//Not implemented}
728    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
729 \textcolor{preprocessor}{#endif}
730 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__misc_8h_acdc0bb8b49d6c596ba176a5757b0fc7e}\label{tls__misc_8h_acdc0bb8b49d6c596ba176a5757b0fc7e}} 
\index{tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}!tls\+Write\+Mpi@{tls\+Write\+Mpi}}
\index{tls\+Write\+Mpi@{tls\+Write\+Mpi}!tls\+\_\+misc.\+h@{tls\+\_\+misc.\+h}}
\subsubsection{\texorpdfstring{tls\+Write\+Mpi()}{tlsWriteMpi()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Write\+Mpi (\begin{DoxyParamCaption}\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t $\ast$}]{length }\end{DoxyParamCaption})}



Encode a multiple precision integer to an opaque vector. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & Pointer to a multiple precision integer \\
\hline
\mbox{\tt out}  & {\em data} & Buffer where to store the opaque vector \\
\hline
\mbox{\tt out}  & {\em length} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 635 of file tls\+\_\+misc.\+c.


\begin{DoxyCode}
636 \{
637    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
638    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
639 
640    \textcolor{comment}{//Retrieve the actual size of the integer}
641    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
642 
643    \textcolor{comment}{//The data is preceded by a 2-byte length field}
644    \hyperlink{cpu__endian_8h_a8e657bcdf3842380d2d0006859029240}{STORE16BE}(n, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data});
645 
646    \textcolor{comment}{//Convert the integer to an octet string}
647    error = \hyperlink{mpi_8c_aad846b0b5a3560243e1bf8601ad1b6a5}{mpiExport}(a, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + 2, n, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa0912b5922ecee206ec51e40d5285f77e}{MPI\_FORMAT\_BIG\_ENDIAN});
648    \textcolor{comment}{//Conversion failed?}
649    \textcolor{keywordflow}{if}(error)
650       \textcolor{keywordflow}{return} error;
651 
652    \textcolor{comment}{//Return the total number of bytes that have been written}
653    *\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} = n + 2;
654    \textcolor{comment}{//Successful processing}
655    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
656 \}
\end{DoxyCode}
