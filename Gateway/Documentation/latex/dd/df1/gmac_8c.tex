\hypertarget{gmac_8c}{}\section{cyclone\+\_\+crypto/mac/gmac.c File Reference}
\label{gmac_8c}\index{cyclone\+\_\+crypto/mac/gmac.\+c@{cyclone\+\_\+crypto/mac/gmac.\+c}}


G\+M\+AC (Galois Message Authentication Code)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mac/gmac.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{gmac_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gmac_8c_a5ebf0cb5106aaae9cc5650c6d0a5a886}{gmac\+Compute} (const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, const void $\ast$key, size\+\_\+t key\+Len, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, size\+\_\+t iv\+Len, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t data\+Len, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$mac, size\+\_\+t mac\+Len)
\begin{DoxyCompactList}\small\item\em Compute G\+M\+AC using the specified cipher algorithm. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gmac_8c_a097682e77d25dd376743f99c8b9fb365}{gmac\+Init} (\hyperlink{structGmacContext}{Gmac\+Context} $\ast$context, const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$cipher, const void $\ast$key, size\+\_\+t key\+Len)
\begin{DoxyCompactList}\small\item\em Initialize G\+M\+AC calculation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gmac_8c_af948cbb3a0abe58f89d5920490b16114}{gmac\+Reset} (\hyperlink{structGmacContext}{Gmac\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{blake2s_8c_aec72267c81ad465adfa55640a636cd0b}{iv}, size\+\_\+t iv\+Len)
\begin{DoxyCompactList}\small\item\em Reset G\+M\+AC context. \end{DoxyCompactList}\item 
void \hyperlink{gmac_8c_ad15ac2514c6e774ce85589bbf5964a15}{gmac\+Update} (\hyperlink{structGmacContext}{Gmac\+Context} $\ast$context, const void $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t data\+Len)
\begin{DoxyCompactList}\small\item\em Update the G\+M\+AC context with a portion of the message being hashed. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{gmac_8c_a78750a5fcd3207e3aab8e09cfe990f46}{gmac\+Final} (\hyperlink{structGmacContext}{Gmac\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$mac, size\+\_\+t mac\+Len)
\begin{DoxyCompactList}\small\item\em Finish the G\+M\+AC calculation. \end{DoxyCompactList}\item 
void \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmac\+Mul} (\hyperlink{structGmacContext}{Gmac\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x)
\begin{DoxyCompactList}\small\item\em Multiplication operation in G\+F(2$^\wedge$128) \end{DoxyCompactList}\item 
void \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmac\+Xor\+Block} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b}, size\+\_\+t \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n})
\begin{DoxyCompactList}\small\item\em X\+OR operation. \end{DoxyCompactList}\item 
void \hyperlink{gmac_8c_aacf03353337eaa6b77a4273bd18981a0}{gmac\+Inc\+Counter} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$x)
\begin{DoxyCompactList}\small\item\em Increment counter block. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} \hyperlink{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r} \mbox{[}16\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
G\+M\+AC (Galois Message Authentication Code) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
G\+M\+AC is a message authentication code (M\+AC) based on G\+CM. Refer to SP 800-\/38D for more details

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{gmac_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{gmac_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{gmac.\+c@{gmac.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 37 of file gmac.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{gmac_8c_a5ebf0cb5106aaae9cc5650c6d0a5a886}\label{gmac_8c_a5ebf0cb5106aaae9cc5650c6d0a5a886}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Compute@{gmac\+Compute}}
\index{gmac\+Compute@{gmac\+Compute}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Compute()}{gmacCompute()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gmac\+Compute (\begin{DoxyParamCaption}\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{const void $\ast$}]{key,  }\item[{size\+\_\+t}]{key\+Len,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{size\+\_\+t}]{iv\+Len,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{data\+Len,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{mac,  }\item[{size\+\_\+t}]{mac\+Len }\end{DoxyParamCaption})}



Compute G\+M\+AC using the specified cipher algorithm. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cipher} & Cipher algorithm used to compute G\+M\+AC \\
\hline
\mbox{\tt in}  & {\em key} & Pointer to the secret key \\
\hline
\mbox{\tt in}  & {\em key\+Len} & Length of the secret key \\
\hline
\mbox{\tt in}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em iv\+Len} & Length of the initialization vector \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to the input message \\
\hline
\mbox{\tt in}  & {\em data\+Len} & Length of the input data \\
\hline
\mbox{\tt out}  & {\em mac} & Calculated M\+AC value \\
\hline
\mbox{\tt in}  & {\em mac\+Len} & Expected length of the M\+AC \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 82 of file gmac.\+c.


\begin{DoxyCode}
85 \{
86    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
87    \hyperlink{structGmacContext}{GmacContext} *context;
88 
89    \textcolor{comment}{//Allocate a memory buffer to hold the GMAC context}
90    context = \hyperlink{cyclone__crypto_2core_2crypto_8h_a48b53d16f66d31e5dcf82db3c1b882ba}{cryptoAllocMem}(\textcolor{keyword}{sizeof}(\hyperlink{structGmacContext}{GmacContext}));
91 
92    \textcolor{comment}{//Successful memory allocation?}
93    \textcolor{keywordflow}{if}(context != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
94    \{
95       \textcolor{comment}{//Initialize the GMAC context}
96       error = \hyperlink{gmac_8c_a097682e77d25dd376743f99c8b9fb365}{gmacInit}(context, cipher, key, keyLen);
97 
98       \textcolor{comment}{//Check status code}
99       \textcolor{keywordflow}{if}(!error)
100       \{
101          \textcolor{comment}{//Reset GMAC context}
102          error = \hyperlink{gmac_8c_af948cbb3a0abe58f89d5920490b16114}{gmacReset}(context, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, ivLen);
103       \}
104 
105       \textcolor{comment}{//Check status code}
106       \textcolor{keywordflow}{if}(!error)
107       \{
108          \textcolor{comment}{//Digest the message}
109          \hyperlink{gmac_8c_ad15ac2514c6e774ce85589bbf5964a15}{gmacUpdate}(context, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, dataLen);
110          \textcolor{comment}{//Finalize the GMAC computation}
111          error = \hyperlink{gmac_8c_a78750a5fcd3207e3aab8e09cfe990f46}{gmacFinal}(context, mac, macLen);
112       \}
113 
114       \textcolor{comment}{//Free previously allocated memory}
115       \hyperlink{cyclone__crypto_2core_2crypto_8h_ac8a223b176683db4e9eed4162774f870}{cryptoFreeMem}(context);
116    \}
117    \textcolor{keywordflow}{else}
118    \{
119       \textcolor{comment}{//Failed to allocate memory}
120       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
121    \}
122 
123    \textcolor{comment}{//Return status code}
124    \textcolor{keywordflow}{return} error;
125 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_a78750a5fcd3207e3aab8e09cfe990f46}\label{gmac_8c_a78750a5fcd3207e3aab8e09cfe990f46}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Final@{gmac\+Final}}
\index{gmac\+Final@{gmac\+Final}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Final()}{gmacFinal()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gmac\+Final (\begin{DoxyParamCaption}\item[{\hyperlink{structGmacContext}{Gmac\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{mac,  }\item[{size\+\_\+t}]{mac\+Len }\end{DoxyParamCaption})}



Finish the G\+M\+AC calculation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+M\+AC context \\
\hline
\mbox{\tt out}  & {\em mac} & Calculated M\+AC value \\
\hline
\mbox{\tt in}  & {\em mac\+Len} & Expected length of the M\+AC \\
\hline
\end{DoxyParams}


Definition at line 378 of file gmac.\+c.


\begin{DoxyCode}
379 \{
380    \textcolor{comment}{//Check the length of the MAC}
381    \textcolor{keywordflow}{if}(macLen < 4 || macLen > 16)
382       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
383 
384    \textcolor{comment}{//Process the last block of the message}
385    \textcolor{keywordflow}{if}(context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} > 0)
386    \{
387       \textcolor{comment}{//Apply GHASH function}
388       \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer}, context->
      \hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength});
389       \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmacMul}(context, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s});
390    \}
391 
392    \textcolor{comment}{//Append the 64-bit representation of the length of the message followed}
393    \textcolor{comment}{//by 64 additional 0 bits}
394    \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(context->\hyperlink{structGmacContext_aefe7162a28878d28b4298b87d1e69922}{totalLength} * 8, context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer});
395    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer} + 8, 0, 8);
396 
397    \textcolor{comment}{//The GHASH function is applied to the result to produce a single output block S}
398    \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer}, 16);
399    \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmacMul}(context, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s});
400 
401    \textcolor{comment}{//Let T = GCTR(J(0), S)}
402    \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(context->\hyperlink{structGmacContext_adfb28cc9aa3f86ca3b0d2a294a5eeaf1}{mac}, context->\hyperlink{structGmacContext_adfb28cc9aa3f86ca3b0d2a294a5eeaf1}{mac}, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, 16);
403 
404    \textcolor{comment}{//Copy the resulting MAC value}
405    \textcolor{keywordflow}{if}(mac != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
406    \{
407       \textcolor{comment}{//Output MSB(T)}
408       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(mac, context->\hyperlink{structGmacContext_adfb28cc9aa3f86ca3b0d2a294a5eeaf1}{mac}, macLen);
409    \}
410 
411    \textcolor{comment}{//Successful processing}
412    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
413 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_aacf03353337eaa6b77a4273bd18981a0}\label{gmac_8c_aacf03353337eaa6b77a4273bd18981a0}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Inc\+Counter@{gmac\+Inc\+Counter}}
\index{gmac\+Inc\+Counter@{gmac\+Inc\+Counter}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Inc\+Counter()}{gmacIncCounter()}}
{\footnotesize\ttfamily void gmac\+Inc\+Counter (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x }\end{DoxyParamCaption})}



Increment counter block. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em x} & Pointer to the counter block \\
\hline
\end{DoxyParams}


Definition at line 508 of file gmac.\+c.


\begin{DoxyCode}
509 \{
510    \textcolor{keywordtype}{size\_t} i;
511 
512    \textcolor{comment}{//The function increments the right-most 32 bits of the block. The remaining}
513    \textcolor{comment}{//left-most 96 bits remain unchanged}
514    \textcolor{keywordflow}{for}(i = 0; i < 4; i++)
515    \{
516       \textcolor{comment}{//Increment the current byte and propagate the carry if necessary}
517       \textcolor{keywordflow}{if}(++(x[15 - i]) != 0)
518       \{
519          \textcolor{keywordflow}{break};
520       \}
521    \}
522 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_a097682e77d25dd376743f99c8b9fb365}\label{gmac_8c_a097682e77d25dd376743f99c8b9fb365}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Init@{gmac\+Init}}
\index{gmac\+Init@{gmac\+Init}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Init()}{gmacInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gmac\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{structGmacContext}{Gmac\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structCipherAlgo}{Cipher\+Algo} $\ast$}]{cipher,  }\item[{const void $\ast$}]{key,  }\item[{size\+\_\+t}]{key\+Len }\end{DoxyParamCaption})}



Initialize G\+M\+AC calculation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+M\+AC context to initialize \\
\hline
\mbox{\tt in}  & {\em cipher} & Cipher algorithm used to compute G\+M\+AC \\
\hline
\mbox{\tt in}  & {\em key} & Pointer to the secret key \\
\hline
\mbox{\tt in}  & {\em key\+Len} & Length of the secret key \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 137 of file gmac.\+c.


\begin{DoxyCode}
139 \{
140    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
141    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
142    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
143    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
144    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{ndp_8h_a1f1dfeb2f802fe99f37fe91867b84456}{h}[4];
145 
146    \textcolor{comment}{//GMAC supports only symmetric block ciphers whose block size is 128 bits}
147    \textcolor{keywordflow}{if}(cipher->\hyperlink{structCipherAlgo_a840c614fa1ae0f98a9350bc4f040dc7a}{type} != \hyperlink{cyclone__crypto_2core_2crypto_8h_ae03a6c8f32ed798857924d908aacc49bac347f6aa82618d4d57fe85cba6520ce9}{CIPHER\_ALGO\_TYPE\_BLOCK} || cipher->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize} != 16)
148       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
149 
150    \textcolor{comment}{//Cipher algorithm used to compute GMAC}
151    context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher} = cipher;
152 
153    \textcolor{comment}{//Initialize cipher context}
154    error = cipher->\hyperlink{structCipherAlgo_a5c1fa3eb89f3d31f01c2c501b94fdd79}{init}(context->\hyperlink{structGmacContext_a5e191ffa77ad12e87ef45bf73d63fd9c}{cipherContext}, key, keyLen);
155    \textcolor{comment}{//Any error to report?}
156    \textcolor{keywordflow}{if}(error)
157       \textcolor{keywordflow}{return} error;
158 
159    \textcolor{comment}{//Let H = 0}
160    h[0] = 0;
161    h[1] = 0;
162    h[2] = 0;
163    h[3] = 0;
164 
165    \textcolor{comment}{//Generate the hash subkey H}
166    context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->\hyperlink{structGmacContext_a5e191ffa77ad12e87ef45bf73d63fd9c}{cipherContext},
167       (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) h, (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) h);
168 
169    \textcolor{comment}{//Pre-compute M(0) = H * 0}
170    j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(0);
171    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0] = 0;
172    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1] = 0;
173    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2] = 0;
174    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3] = 0;
175 
176    \textcolor{comment}{//Pre-compute M(1) = H * 1}
177    j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1);
178    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[3]);
179    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[2]);
180    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[1]);
181    context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3] = \hyperlink{cpu__endian_8h_a1f0e86c75b9c4d1fc0850a4762eb2148}{betoh32}(h[0]);
182 
183    \textcolor{comment}{//Pre-compute all 4-bit multiples of H}
184    \textcolor{keywordflow}{for}(i = 2; i < 16; i++)
185    \{
186       \textcolor{comment}{//Odd value?}
187       \textcolor{keywordflow}{if}(i & 1)
188       \{
189          \textcolor{comment}{//Compute M(i) = M(i - 1) + H}
190          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i - 1);
191          h[0] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0];
192          h[1] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1];
193          h[2] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2];
194          h[3] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3];
195 
196          \textcolor{comment}{//An addition in GF(2^128) is identical to a bitwise}
197          \textcolor{comment}{//exclusive-OR operation}
198          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1);
199          h[0] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0];
200          h[1] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1];
201          h[2] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2];
202          h[3] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3];
203       \}
204       \textcolor{comment}{//Even value?}
205       \textcolor{keywordflow}{else}
206       \{
207          \textcolor{comment}{//Compute M(i) = M(i / 2) * x}
208          j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i / 2);
209          h[0] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0];
210          h[1] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1];
211          h[2] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2];
212          h[3] = context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3];
213 
214          \textcolor{comment}{//The multiplication of a polynomial by x in GF(2^128) corresponds}
215          \textcolor{comment}{//to a shift of indices}
216          c = h[0] & 0x01;
217          h[0] = (h[0] >> 1) | (h[1] << 31);
218          h[1] = (h[1] >> 1) | (h[2] << 31);
219          h[2] = (h[2] >> 1) | (h[3] << 31);
220          h[3] >>= 1;
221 
222          \textcolor{comment}{//If the highest term of the result is equal to one, then perform}
223          \textcolor{comment}{//reduction}
224          h[3] ^= \hyperlink{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(1)] & ~(c - 1);
225       \}
226 
227       \textcolor{comment}{//Save M(i)}
228       j = \hyperlink{cpu__endian_8c_a813f83da76dbc75def429589f4b8a093}{reverseInt4}(i);
229       context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][0] = h[0];
230       context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][1] = h[1];
231       context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][2] = h[2];
232       context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[j][3] = h[3];
233    \}
234 
235    \textcolor{comment}{//Clear input buffer}
236    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer}, 0, context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher}->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
237    \textcolor{comment}{//Number of bytes in the buffer}
238    context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} = 0;
239    \textcolor{comment}{//Total number of bytes}
240    context->\hyperlink{structGmacContext_aefe7162a28878d28b4298b87d1e69922}{totalLength} = 0;
241 
242    \textcolor{comment}{//Initialize MAC value}
243    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(context->\hyperlink{structGmacContext_adfb28cc9aa3f86ca3b0d2a294a5eeaf1}{mac}, 0, context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher}->\hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
244 
245    \textcolor{comment}{//Successful initialization}
246    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
247 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}\label{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Mul@{gmac\+Mul}}
\index{gmac\+Mul@{gmac\+Mul}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Mul()}{gmacMul()}}
{\footnotesize\ttfamily void gmac\+Mul (\begin{DoxyParamCaption}\item[{\hyperlink{structGmacContext}{Gmac\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x }\end{DoxyParamCaption})}



Multiplication operation in G\+F(2$^\wedge$128) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+M\+AC context \\
\hline
\mbox{\tt in,out}  & {\em x} & 16-\/byte block to be multiplied by H \\
\hline
\end{DoxyParams}


Definition at line 422 of file gmac.\+c.


\begin{DoxyCode}
423 \{
424    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} i;
425    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b};
426    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c};
427    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dns__common_8h_ab3539ae3820541b70d17c66cfc5a0e3f}{z}[4];
428 
429    \textcolor{comment}{//Let Z = 0}
430    z[0] = 0;
431    z[1] = 0;
432    z[2] = 0;
433    z[3] = 0;
434 
435    \textcolor{comment}{//Fast table-driven implementation}
436    \textcolor{keywordflow}{for}(i = 15; i >= 0; i--)
437    \{
438       \textcolor{comment}{//Get the lower nibble}
439       b = x[i] & 0x0F;
440 
441       \textcolor{comment}{//Multiply 4 bits at a time}
442       c = z[0] & 0x0F;
443       z[0] = (z[0] >> 4) | (z[1] << 28);
444       z[1] = (z[1] >> 4) | (z[2] << 28);
445       z[2] = (z[2] >> 4) | (z[3] << 28);
446       z[3] >>= 4;
447 
448       z[0] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][0];
449       z[1] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][1];
450       z[2] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][2];
451       z[3] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][3];
452 
453       \textcolor{comment}{//Perform reduction}
454       z[3] ^= \hyperlink{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
455 
456       \textcolor{comment}{//Get the upper nibble}
457       b = (x[i] >> 4) & 0x0F;
458 
459       \textcolor{comment}{//Multiply 4 bits at a time}
460       c = z[0] & 0x0F;
461       z[0] = (z[0] >> 4) | (z[1] << 28);
462       z[1] = (z[1] >> 4) | (z[2] << 28);
463       z[2] = (z[2] >> 4) | (z[3] << 28);
464       z[3] >>= 4;
465 
466       z[0] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][0];
467       z[1] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][1];
468       z[2] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][2];
469       z[3] ^= context->\hyperlink{structGmacContext_aee713037ed85ba9ec892d297044a1d1a}{m}[\hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}][3];
470 
471       \textcolor{comment}{//Perform reduction}
472       z[3] ^= \hyperlink{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}{r}[\hyperlink{aria_8c_a5dadc28804036d1b82e1dc027e95c9a6}{c}];
473    \}
474 
475    \textcolor{comment}{//Save the result}
476    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[3], x);
477    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[2], x + 4);
478    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[1], x + 8);
479    \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(z[0], x + 12);
480 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_af948cbb3a0abe58f89d5920490b16114}\label{gmac_8c_af948cbb3a0abe58f89d5920490b16114}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Reset@{gmac\+Reset}}
\index{gmac\+Reset@{gmac\+Reset}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Reset()}{gmacReset()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} gmac\+Reset (\begin{DoxyParamCaption}\item[{\hyperlink{structGmacContext}{Gmac\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{iv,  }\item[{size\+\_\+t}]{iv\+Len }\end{DoxyParamCaption})}



Reset G\+M\+AC context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+M\+AC context \\
\hline
\mbox{\tt in}  & {\em iv} & Initialization vector \\
\hline
\mbox{\tt in}  & {\em iv\+Len} & Length of the initialization vector \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 258 of file gmac.\+c.


\begin{DoxyCode}
259 \{
260    \textcolor{keywordtype}{size\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
261    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
262    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[16];
263    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} j[16];
264 
265    \textcolor{comment}{//The length of the IV shall meet SP 800-38D requirements}
266    \textcolor{keywordflow}{if}(ivLen < 1)
267       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
268 
269    \textcolor{comment}{//Check whether the length of the IV is 96 bits}
270    \textcolor{keywordflow}{if}(ivLen == 12)
271    \{
272       \textcolor{comment}{//When the length of the IV is 96 bits, the padding string is}
273       \textcolor{comment}{//appended to the IV to form the pre-counter block}
274       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, 12);
275       \hyperlink{cpu__endian_8h_a8663906e08e818efa91dd6f65a7e636d}{STORE32BE}(1, j + 12);
276    \}
277    \textcolor{keywordflow}{else}
278    \{
279       \textcolor{comment}{//Initialize GHASH calculation}
280       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(j, 0, 16);
281 
282       \textcolor{comment}{//Length of the IV}
283       n = ivLen;
284 
285       \textcolor{comment}{//Process the initialization vector}
286       \textcolor{keywordflow}{while}(n > 0)
287       \{
288          \textcolor{comment}{//The IV processed in a block-by-block fashion}
289          k = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, 16);
290 
291          \textcolor{comment}{//Apply GHASH function}
292          \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(j, j, \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv}, k);
293          \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmacMul}(context, j);
294 
295          \textcolor{comment}{//Next block}
296          \hyperlink{blake2b_8c_a7776c99735c5a9d93817d8f7bd33d8e6}{iv} += \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
297          n -= \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
298       \}
299 
300       \textcolor{comment}{//The string is appended with 64 additional 0 bits, followed by the}
301       \textcolor{comment}{//64-bit representation of the length of the IV}
302       \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(b, 0, 8);
303       \hyperlink{cpu__endian_8h_abd64119985555609ad9c94eed4c96e0f}{STORE64BE}(ivLen * 8, b + 8);
304 
305       \textcolor{comment}{//The GHASH function is applied to the resulting string to form the}
306       \textcolor{comment}{//pre-counter block}
307       \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(j, j, b, 16);
308       \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmacMul}(context, j);
309    \}
310 
311    \textcolor{comment}{//Compute MSB(CIPH(J(0)))}
312    context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher}->\hyperlink{structCipherAlgo_a61360848127c17c27fe5304588f7f211}{encryptBlock}(context->\hyperlink{structGmacContext_a5e191ffa77ad12e87ef45bf73d63fd9c}{cipherContext}, j, b);
313    \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(context->\hyperlink{structGmacContext_adfb28cc9aa3f86ca3b0d2a294a5eeaf1}{mac}, b, 16);
314 
315    \textcolor{comment}{//Initialize GHASH calculation}
316    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, 0, 16);
317 
318    \textcolor{comment}{//Clear input buffer}
319    \hyperlink{cyclone__crypto_2core_2crypto_8h_ad4465436e4ff353300fba4896012e18b}{cryptoMemset}(context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer}, 0, context->\hyperlink{structGmacContext_a1fd83571a16fb7cf5ab884599319839e}{cipher}->
      \hyperlink{structCipherAlgo_a1f318963e641736f3c5836274ef758f1}{blockSize});
320    \textcolor{comment}{//Number of bytes in the buffer}
321    context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} = 0;
322 
323    \textcolor{comment}{//Successful processing}
324    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
325 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_ad15ac2514c6e774ce85589bbf5964a15}\label{gmac_8c_ad15ac2514c6e774ce85589bbf5964a15}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Update@{gmac\+Update}}
\index{gmac\+Update@{gmac\+Update}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Update()}{gmacUpdate()}}
{\footnotesize\ttfamily void gmac\+Update (\begin{DoxyParamCaption}\item[{\hyperlink{structGmacContext}{Gmac\+Context} $\ast$}]{context,  }\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{data\+Len }\end{DoxyParamCaption})}



Update the G\+M\+AC context with a portion of the message being hashed. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the G\+M\+AC context \\
\hline
\mbox{\tt in}  & {\em data} & Pointer to the input data \\
\hline
\mbox{\tt in}  & {\em data\+Len} & Length of the buffer \\
\hline
\end{DoxyParams}


Definition at line 335 of file gmac.\+c.


\begin{DoxyCode}
336 \{
337    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
338 
339    \textcolor{comment}{//Process the incoming data}
340    \textcolor{keywordflow}{while}(dataLen > 0)
341    \{
342       \textcolor{comment}{//The message is partitioned into complete blocks}
343       n = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(dataLen, 16 - context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength});
344 
345       \textcolor{comment}{//Copy the data to the buffer}
346       \hyperlink{cyclone__crypto_2core_2crypto_8h_a6724616c4014bb7e21f2660bd7b88be8}{cryptoMemcpy}(context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer} + context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength}, 
      \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, n);
347       \textcolor{comment}{//Update the length of the buffer}
348       context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
349       \textcolor{comment}{//Update the total number of bytes}
350       context->\hyperlink{structGmacContext_aefe7162a28878d28b4298b87d1e69922}{totalLength} += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
351 
352       \textcolor{comment}{//Advance the data pointer}
353       \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + n;
354       \textcolor{comment}{//Remaining bytes to process}
355       dataLen -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
356 
357       \textcolor{comment}{//Process message block by block}
358       \textcolor{keywordflow}{if}(context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} == 16)
359       \{
360          \textcolor{comment}{//Apply GHASH function}
361          \hyperlink{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}{gmacXorBlock}(context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s}, context->\hyperlink{structGmacContext_ac0106d4b7496e620f9d6f354345bac2c}{buffer}, 16);
362          \hyperlink{gmac_8c_ab70398631b4582807f02fe1e9c7d2ed0}{gmacMul}(context, context->\hyperlink{structGmacContext_aba6a64b74fb0cf05d78d759257ab8c2b}{s});
363 
364          \textcolor{comment}{//Empty the buffer}
365          context->\hyperlink{structGmacContext_a751b0d43545dad89b8714d3584514ede}{bufferLength} = 0;
366       \}
367    \}
368 \}
\end{DoxyCode}
\mbox{\Hypertarget{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}\label{gmac_8c_a8ea105d8aa225620ea38118df5b27ad2}} 
\index{gmac.\+c@{gmac.\+c}!gmac\+Xor\+Block@{gmac\+Xor\+Block}}
\index{gmac\+Xor\+Block@{gmac\+Xor\+Block}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{gmac\+Xor\+Block()}{gmacXorBlock()}}
{\footnotesize\ttfamily void gmac\+Xor\+Block (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{x,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{a,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{b,  }\item[{size\+\_\+t}]{n }\end{DoxyParamCaption})}



X\+OR operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em x} & Block resulting from the X\+OR operation \\
\hline
\mbox{\tt in}  & {\em a} & First block \\
\hline
\mbox{\tt in}  & {\em b} & Second block \\
\hline
\mbox{\tt in}  & {\em n} & Size of the block \\
\hline
\end{DoxyParams}


Definition at line 491 of file gmac.\+c.


\begin{DoxyCode}
492 \{
493    \textcolor{keywordtype}{size\_t} i;
494 
495    \textcolor{comment}{//Perform XOR operation}
496    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
497    \{
498       x[i] = \hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}[i] ^ \hyperlink{dtls__misc_8h_ab590318ac859d0e57e15c3dd6c62a605}{b}[i];
499    \}
500 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}\label{gmac_8c_ab3cb85efc04902cdf0c2d96f5d5ec902}} 
\index{gmac.\+c@{gmac.\+c}!r@{r}}
\index{r@{r}!gmac.\+c@{gmac.\+c}}
\subsubsection{\texorpdfstring{r}{r}}
{\footnotesize\ttfamily const \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t} r\mbox{[}16\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=
\{
   0x00000000,
   0x1C200000,
   0x38400000,
   0x24600000,
   0x70800000,
   0x6CA00000,
   0x48C00000,
   0x54E00000,
   0xE1000000,
   0xFD200000,
   0xD9400000,
   0xC5600000,
   0x91800000,
   0x8DA00000,
   0xA9C00000,
   0xB5E00000
\}
\end{DoxyCode}


Definition at line 47 of file gmac.\+c.

