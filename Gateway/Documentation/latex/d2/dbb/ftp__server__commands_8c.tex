\hypertarget{ftp__server__commands_8c}{}\section{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+commands.c File Reference}
\label{ftp__server__commands_8c}\index{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+commands.\+c@{cyclone\+\_\+tcp/ftp/ftp\+\_\+server\+\_\+commands.\+c}}


F\+TP server (command processing)  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}ipv4/ipv4\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+server.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+server\+\_\+commands.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+server\+\_\+data.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ftp/ftp\+\_\+server\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}str.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}path.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ftp__server__commands_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ae398facab6ce5126fa3b23996aafefa5}{F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{ftp__server__commands_8c_a97fa2c87e8d0c233cfd6b38885449b77}{ftp\+Server\+Process\+Command} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection)
\begin{DoxyCompactList}\small\item\em F\+TP command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_aab5c5467d29c2026ddbc271c0ff43acf}{ftp\+Server\+Process\+Noop} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em N\+O\+OP command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ac4261d58c3ef2b697287b9723bc9ccf6}{ftp\+Server\+Process\+Syst} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em S\+Y\+ST command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a42bb11a0ce2adce71a44b5ef6ba4fe12}{ftp\+Server\+Process\+Feat} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em F\+E\+AT command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ac3b397f111c91ec28aef25ae5f0b297c}{ftp\+Server\+Process\+Auth} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em A\+U\+TH command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a458fc55190e092e18b5ae0fa5b173090}{ftp\+Server\+Process\+Pbsz} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+B\+SZ command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ae98efd39f6b27c691a7e3dc47de03ad9}{ftp\+Server\+Process\+Prot} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+R\+OT command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a184556f9caab0164751538758f4bda6f}{ftp\+Server\+Process\+Type} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em T\+Y\+PE command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_af5886d31c42c6557632dc31d5dd795e4}{ftp\+Server\+Process\+Stru} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em S\+T\+RU command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a537336be6e588e1ce0adb45533d0e0ab}{ftp\+Server\+Process\+Mode} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em M\+O\+DE command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a6f62bccd354f8fc1ccf6f32b13bcd816}{ftp\+Server\+Process\+User} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em U\+S\+ER command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_abcde173a5fc291f981606422e9850571}{ftp\+Server\+Process\+Pass} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+A\+SS command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a1fda318076a5e8105b6bfc3651686a84}{ftp\+Server\+Process\+Rein} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em R\+E\+IN command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ab1ee63edded186edbdfbafed1b28bc1b}{ftp\+Server\+Process\+Quit} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em Q\+U\+IT command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a031959972f3be4911b6d827d7b25b142}{ftp\+Server\+Process\+Port} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+O\+RT command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_abe3f69562a19ecb312d8f9fc1fd37d51}{ftp\+Server\+Process\+Eprt} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em E\+P\+RT command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a2adf3ae2b167d0c4edfd8512628b72b0}{ftp\+Server\+Process\+Pasv} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+A\+SV command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_abca32c6fc5aafb5da965f1c1f70738c8}{ftp\+Server\+Process\+Epsv} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em E\+P\+SV command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ab9488bc8b2b4b0c042277849745e7c32}{ftp\+Server\+Process\+Abor} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em A\+B\+OR command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a20e092ea6ec68374264ba75f270316ce}{ftp\+Server\+Process\+Pwd} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em P\+WD command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a5bc28e408c3c18f6aeecfd225423caad}{ftp\+Server\+Process\+Cwd} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em C\+WD command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a8dace1f76f9697255e81dba466b2a56f}{ftp\+Server\+Process\+Cdup} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em C\+D\+UP command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_aceeab3e5cb48a14066e8cad2a71bedec}{ftp\+Server\+Process\+List} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em L\+I\+ST command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ad9df18a1487a9ca866786ce5b9baa1c8}{ftp\+Server\+Process\+Mkd} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em M\+KD command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a0fe03287becff141ff842ee8246900f7}{ftp\+Server\+Process\+Rmd} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em R\+MD command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_afcd7f15bff2ba102182942120de5be71}{ftp\+Server\+Process\+Size} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em S\+I\+ZE command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_af7da020b24a02335365c7bf6887cf439}{ftp\+Server\+Process\+Retr} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em R\+E\+TR command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_aa10926e2d656e6c64463cadd2506600b}{ftp\+Server\+Process\+Stor} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em S\+T\+OR command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_af6162c874554119c3e78ed2602ca29a4}{ftp\+Server\+Process\+Appe} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em A\+P\+PE command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_a711f302d07d9bab1dce7afe79131f51a}{ftp\+Server\+Process\+Rnfr} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em R\+N\+FR command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ae2d679d5293b6e3f18b6dede8b982902}{ftp\+Server\+Process\+Rnto} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em R\+N\+TO command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_ae535cf5388ce6abe686982930e0558d7}{ftp\+Server\+Process\+Dele} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em D\+E\+LE command processing. \end{DoxyCompactList}\item 
void \hyperlink{ftp__server__commands_8c_aab77468d3da39862ad4b6314c571bf14}{ftp\+Server\+Process\+Unknown\+Cmd} (\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$connection, \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em Unknown command processing. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
F\+TP server (command processing) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{ftp__server__commands_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{ftp__server__commands_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ae398facab6ce5126fa3b23996aafefa5}{F\+T\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file ftp\+\_\+server\+\_\+commands.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{ftp__server__commands_8c_ab9488bc8b2b4b0c042277849745e7c32}\label{ftp__server__commands_8c_ab9488bc8b2b4b0c042277849745e7c32}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Abor@{ftp\+Server\+Process\+Abor}}
\index{ftp\+Server\+Process\+Abor@{ftp\+Server\+Process\+Abor}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Abor()}{ftpServerProcessAbor()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Abor (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



A\+B\+OR command processing. 

The A\+B\+OR command tells the server to abort the previous F\+TP service command and any associated transfer of data


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1450 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1451 \{
1452    \textcolor{comment}{//There are two cases to consider upon receipt of this command}
1453    \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bab3165039e718584ac932b07402ac08f2}{FTP\_CHANNEL\_STATE\_CLOSED})
1454    \{
1455       \textcolor{comment}{//If the FTP service command was already completed, the server closes}
1456       \textcolor{comment}{//the data connection (if it is open)...}
1457       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1458 
1459       \textcolor{comment}{//...and responds with a 226 reply, indicating that the abort command}
1460       \textcolor{comment}{//was successfully processed}
1461       strcpy(connection->response, \textcolor{stringliteral}{"226 Abort command successful\(\backslash\)r\(\backslash\)n"});
1462    \}
1463    \textcolor{keywordflow}{else}
1464    \{
1465       \textcolor{comment}{//If the FTP service command is still in progress, the server aborts}
1466       \textcolor{comment}{//the FTP service in progress and closes the data connection...}
1467       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1468 
1469       \textcolor{comment}{//...returning a 426 reply to indicate that the service request}
1470       \textcolor{comment}{//terminated abnormally}
1471       strcpy(connection->response, \textcolor{stringliteral}{"426 Connection closed; transfer aborted\(\backslash\)r\(\backslash\)n"});
1472 
1473       \textcolor{comment}{//The server then sends a 226 reply, indicating that the abort command}
1474       \textcolor{comment}{//was successfully processed}
1475       strcat(connection->response, \textcolor{stringliteral}{"226 Abort command successful\(\backslash\)r\(\backslash\)n"});
1476    \}
1477 
1478    \textcolor{comment}{//Release previously allocated resources}
1479    \textcolor{keywordflow}{if}(connection->file != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1480    \{
1481       \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
1482       connection->file = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1483    \}
1484 
1485    \textcolor{keywordflow}{if}(connection->dir != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1486    \{
1487       \hyperlink{fs__port__fatfs_8c_a94bfd6c1ae79880d0a5cbe3b491368f2}{fsCloseDir}(connection->dir);
1488       connection->dir = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
1489    \}
1490 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_af6162c874554119c3e78ed2602ca29a4}\label{ftp__server__commands_8c_af6162c874554119c3e78ed2602ca29a4}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Appe@{ftp\+Server\+Process\+Appe}}
\index{ftp\+Server\+Process\+Appe@{ftp\+Server\+Process\+Appe}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Appe()}{ftpServerProcessAppe()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Appe (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



A\+P\+PE command processing. 

The A\+P\+PE command is used to append data to the specified file


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2212 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2213 \{
2214    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2215    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
2216 
2217    \textcolor{comment}{//Ensure the user is logged in}
2218    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2219    \{
2220       \textcolor{comment}{//Format response message}
2221       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2222       \textcolor{comment}{//Exit immediately}
2223       \textcolor{keywordflow}{return};
2224    \}
2225 
2226    \textcolor{comment}{//The argument specifies the pathname of the file to written}
2227    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2228    \{
2229       \textcolor{comment}{//The argument is missing}
2230       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2231       \textcolor{comment}{//Exit immediately}
2232       \textcolor{keywordflow}{return};
2233    \}
2234 
2235    \textcolor{comment}{//Retrieve the full pathname}
2236    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2237       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2238 
2239    \textcolor{comment}{//Any error to report?}
2240    \textcolor{keywordflow}{if}(error)
2241    \{
2242       \textcolor{comment}{//The specified pathname is not valid...}
2243       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2244       \textcolor{comment}{//Exit immediately}
2245       \textcolor{keywordflow}{return};
2246    \}
2247 
2248    \textcolor{comment}{//Retrieve permissions for the specified directory}
2249    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
2250 
2251    \textcolor{comment}{//Insufficient access rights?}
2252    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
2253    \{
2254       \textcolor{comment}{//Report an error}
2255       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2256       \textcolor{comment}{//Exit immediately}
2257       \textcolor{keywordflow}{return};
2258    \}
2259 
2260    \textcolor{comment}{//Open specified file for writing}
2261    connection->file = \hyperlink{fs__port__fatfs_8c_aba7fcc4f174dcf4652a8b84cdfff22b5}{fsOpenFile}(connection->path,
2262       \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51caed4c8b2994951eeb8d60d929444fb8cb}{FS\_FILE\_MODE\_WRITE} | \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51ca59f9749189b0706360c6c117fd3ba104}{FS\_FILE\_MODE\_CREATE});
2263 
2264    \textcolor{comment}{//Failed to open the file?}
2265    \textcolor{keywordflow}{if}(!connection->file)
2266    \{
2267       \textcolor{comment}{//Report an error}
2268       strcpy(connection->response, \textcolor{stringliteral}{"550 File not found\(\backslash\)r\(\backslash\)n"});
2269       \textcolor{comment}{//Exit immediately}
2270       \textcolor{keywordflow}{return};
2271    \}
2272 
2273    \textcolor{comment}{//Move to the end of the file}
2274    error = \hyperlink{fs__port__fatfs_8c_a08306362eac6d9e1bf1c7f2a0f622597}{fsSeekFile}(connection->file, 0, \hyperlink{fs__port_8h_a96b63216b3c538b63de1928e54b5d013a36dd416e193650f2c191423d3e3dad6d}{FS\_SEEK\_END});
2275 
2276    \textcolor{comment}{//Any error to report?}
2277    \textcolor{keywordflow}{if}(error)
2278    \{
2279       \textcolor{comment}{//Clean up side effects}
2280       \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
2281       \textcolor{comment}{//Format response}
2282       strcpy(connection->response, \textcolor{stringliteral}{"550 File unavailable\(\backslash\)r\(\backslash\)n"});
2283    \}
2284 
2285    \textcolor{comment}{//Check current data transfer mode}
2286    \textcolor{keywordflow}{if}(connection->passiveMode)
2287    \{
2288       \textcolor{comment}{//Check whether the data connection is already opened}
2289       \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE})
2290          connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba1da5754390026467598643916c13c5e9}{FTP\_CHANNEL\_STATE\_RECEIVE};
2291    \}
2292    \textcolor{keywordflow}{else}
2293    \{
2294       \textcolor{comment}{//Open the data connection}
2295       error = \hyperlink{ftp__server__data_8c_a1897b513ba9ce04dc3a4a9be61445b54}{ftpServerOpenDataChannel}(connection);
2296 
2297       \textcolor{comment}{//Any error to report?}
2298       \textcolor{keywordflow}{if}(error)
2299       \{
2300          \textcolor{comment}{//Clean up side effects}
2301          \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
2302          \textcolor{comment}{//Format response}
2303          strcpy(connection->response, \textcolor{stringliteral}{"450 Can't open data connection\(\backslash\)r\(\backslash\)n"});
2304          \textcolor{comment}{//Exit immediately}
2305          \textcolor{keywordflow}{return};
2306       \}
2307 
2308       \textcolor{comment}{//The data connection is ready to receive data}
2309       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba1da5754390026467598643916c13c5e9}{FTP\_CHANNEL\_STATE\_RECEIVE};
2310    \}
2311 
2312    \textcolor{comment}{//Flush reception buffer}
2313    connection->bufferLength = 0;
2314    connection->bufferPos = 0;
2315 
2316    \textcolor{comment}{//APPE command is being processed}
2317    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156baae63a24a943e513d5ac6f9c8bfa448ad}{FTP\_CHANNEL\_STATE\_APPE};
2318 
2319    \textcolor{comment}{//Format response message}
2320    strcpy(connection->response, \textcolor{stringliteral}{"150 Opening data connection\(\backslash\)r\(\backslash\)n"});
2321 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ac3b397f111c91ec28aef25ae5f0b297c}\label{ftp__server__commands_8c_ac3b397f111c91ec28aef25ae5f0b297c}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Auth@{ftp\+Server\+Process\+Auth}}
\index{ftp\+Server\+Process\+Auth@{ftp\+Server\+Process\+Auth}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Auth()}{ftpServerProcessAuth()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Auth (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



A\+U\+TH command processing. 

The A\+U\+TH command specifies the security mechanism


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 377 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
378 \{
379 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
380    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
381 
382    \textcolor{comment}{//Point to the FTP server context}
383    context = connection->context;
384 
385    \textcolor{comment}{//TLS security mode supported by the server?}
386    \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa0bc8c34044e4a31f671148f1870902e2}{FTP\_SERVER\_MODE\_IMPLICIT\_TLS}) != 0)
387    \{
388       \textcolor{comment}{//When using implicit FTPS, a TLS connection is immediately established}
389       \textcolor{comment}{//via port 990 before any command is exchanged}
390       strcpy(connection->response, \textcolor{stringliteral}{"534 Secure connection already negotiated\(\backslash\)r\(\backslash\)n"});
391    \}
392    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa8a932ad0b475652b069318fe7ef39207}{FTP\_SERVER\_MODE\_EXPLICIT\_TLS}) != 0)
393    \{
394       \textcolor{comment}{//The argument specifies the security mechanism}
395       \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
396       \{
397          \textcolor{comment}{//TLS security mechanism?}
398          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"TLS"}))
399          \{
400             \textcolor{comment}{//If the server is willing to accept the named security mechanism,}
401             \textcolor{comment}{//and does not require any security data, it must respond with reply}
402             \textcolor{comment}{//code 234}
403             strcpy(connection->response, \textcolor{stringliteral}{"234 AUTH TLS OK\(\backslash\)r\(\backslash\)n"});
404 
405             \textcolor{comment}{//Establish a protected session}
406             connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bafa58da332449ebb0a0f04e4e6ed0dc1a}{FTP\_CHANNEL\_STATE\_AUTH\_TLS\_1};
407          \}
408          \textcolor{keywordflow}{else}
409          \{
410             \textcolor{comment}{//The security mechanism is unknown}
411             strcpy(connection->response, \textcolor{stringliteral}{"504 Unknown security scheme\(\backslash\)r\(\backslash\)n"});
412          \}
413       \}
414       \textcolor{keywordflow}{else}
415       \{
416          \textcolor{comment}{//The argument is missing}
417          strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
418       \}
419    \}
420    \textcolor{keywordflow}{else}
421 \textcolor{preprocessor}{#endif}
422    \{
423       \textcolor{comment}{//TLS security mode is not supported}
424       strcpy(connection->response, \textcolor{stringliteral}{"502 Command not implemented\(\backslash\)r\(\backslash\)n"});
425    \}
426 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a8dace1f76f9697255e81dba466b2a56f}\label{ftp__server__commands_8c_a8dace1f76f9697255e81dba466b2a56f}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Cdup@{ftp\+Server\+Process\+Cdup}}
\index{ftp\+Server\+Process\+Cdup@{ftp\+Server\+Process\+Cdup}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Cdup()}{ftpServerProcessCdup()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Cdup (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



C\+D\+UP command processing. 

The C\+D\+UP command allows the user to change to the parent directory


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1605 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1606 \{
1607    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1608 
1609    \textcolor{comment}{//Ensure the user is logged in}
1610    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1611    \{
1612       \textcolor{comment}{//Format response message}
1613       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1614       \textcolor{comment}{//Exit immediately}
1615       \textcolor{keywordflow}{return};
1616    \}
1617 
1618    \textcolor{comment}{//Get current directory}
1619    strcpy(connection->path, connection->currentDir);
1620 
1621    \textcolor{comment}{//Change to the parent directory}
1622    \hyperlink{path_8c_a38625df4e9abd106fb932b8ff308adc3}{pathCombine}(connection->path, \textcolor{stringliteral}{".."}, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1623    \hyperlink{path_8c_a64519f81386b6ece797fb51f06e3052d}{pathCanonicalize}(connection->path);
1624 
1625    \textcolor{comment}{//Retrieve permissions for the directory}
1626    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1627 
1628    \textcolor{comment}{//Check access rights}
1629    \textcolor{keywordflow}{if}(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5ea2f3957b04a30fc147df1c3818e26fe1b}{FTP\_FILE\_PERM\_READ})
1630    \{
1631       \textcolor{comment}{//Update current directory}
1632       strcpy(connection->currentDir, connection->path);
1633    \}
1634 
1635    \textcolor{comment}{//A successful PWD command uses the 250 reply code}
1636    sprintf(connection->response, \textcolor{stringliteral}{"250 Directory changed to %s\(\backslash\)r\(\backslash\)n"},
1637       \hyperlink{ftp__server__misc_8c_a60770197d5fe8d7b61246dcec3b70af7}{ftpServerStripHomeDir}(connection, connection->currentDir));
1638 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a97fa2c87e8d0c233cfd6b38885449b77}\label{ftp__server__commands_8c_a97fa2c87e8d0c233cfd6b38885449b77}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Command@{ftp\+Server\+Process\+Command}}
\index{ftp\+Server\+Process\+Command@{ftp\+Server\+Process\+Command}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Command()}{ftpServerProcessCommand()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Command (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection }\end{DoxyParamCaption})}



F\+TP command processing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\end{DoxyParams}


Definition at line 54 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
55 \{
56    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
57    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
58 
59    \textcolor{comment}{//The CRLF sequence should be used to terminate the command line}
60    \textcolor{keywordflow}{for}(n = 0; n < connection->commandLen; n++)
61    \{
62       \textcolor{keywordflow}{if}(connection->command[n] == \textcolor{charliteral}{'\(\backslash\)n'})
63          \textcolor{keywordflow}{break};
64    \}
65 
66    \textcolor{comment}{//Any command to process?}
67    \textcolor{keywordflow}{if}(n < connection->commandLen)
68    \{
69       \textcolor{comment}{//Properly terminate the string with a NULL character}
70       connection->command[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = \textcolor{charliteral}{'\(\backslash\)0'};
71       \textcolor{comment}{//Remove trailing whitespace from the command line}
72       \hyperlink{str_8c_a213a401a08b4083cbddd0fb4673ba430}{strRemoveTrailingSpace}(connection->command);
73 
74       \textcolor{comment}{//Debug message}
75       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"FTP client: %s\(\backslash\)r\(\backslash\)n"}, connection->command);
76 
77       \textcolor{comment}{//Command line too long?}
78       \textcolor{keywordflow}{if}(connection->controlChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba6cc85b8705b6fedf2ca6f277f2c916c5}{FTP\_CHANNEL\_STATE\_DISCARD})
79       \{
80          \textcolor{comment}{//Switch to idle state}
81          connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE};
82          \textcolor{comment}{//Format response message}
83          strcpy(connection->response, \textcolor{stringliteral}{"500 Command line too long\(\backslash\)r\(\backslash\)n"});
84       \}
85       \textcolor{keywordflow}{else}
86       \{
87          \textcolor{comment}{//The command name and the arguments are separated by one or more}
88          \textcolor{comment}{//spaces}
89          \textcolor{keywordflow}{for}(p = connection->command; *p != \textcolor{charliteral}{'\(\backslash\)0'} && *p != \textcolor{charliteral}{' '}; p++)
90          \{
91          \}
92 
93          \textcolor{comment}{//Space character found?}
94          \textcolor{keywordflow}{if}(*p == \textcolor{charliteral}{' '})
95          \{
96             \textcolor{comment}{//Split the string at the first occurrence of the space character}
97             *(p++) = \textcolor{charliteral}{'\(\backslash\)0'};
98 
99             \textcolor{comment}{//Skip extra whitespace}
100             \textcolor{keywordflow}{while}(*p == \textcolor{charliteral}{' '})
101             \{
102                p++;
103             \}
104          \}
105 
106          \textcolor{comment}{//NOOP command received?}
107          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"NOOP"}))
108          \{
109             \hyperlink{ftp__server__commands_8c_aab5c5467d29c2026ddbc271c0ff43acf}{ftpServerProcessNoop}(connection, p);
110          \}
111          \textcolor{comment}{//SYST command received?}
112          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"SYST"}))
113          \{
114             \hyperlink{ftp__server__commands_8c_ac4261d58c3ef2b697287b9723bc9ccf6}{ftpServerProcessSyst}(connection, p);
115          \}
116          \textcolor{comment}{//FEAT command received?}
117          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"FEAT"}))
118          \{
119             \hyperlink{ftp__server__commands_8c_a42bb11a0ce2adce71a44b5ef6ba4fe12}{ftpServerProcessFeat}(connection, p);
120          \}
121 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
122          \textcolor{comment}{//AUTH command received?}
123          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"AUTH"}))
124          \{
125             \hyperlink{ftp__server__commands_8c_ac3b397f111c91ec28aef25ae5f0b297c}{ftpServerProcessAuth}(connection, p);
126          \}
127          \textcolor{comment}{//PBSZ command received?}
128          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PBSZ"}))
129          \{
130             \hyperlink{ftp__server__commands_8c_a458fc55190e092e18b5ae0fa5b173090}{ftpServerProcessPbsz}(connection, p);
131          \}
132          \textcolor{comment}{//PROT command received?}
133          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PROT"}))
134          \{
135             \hyperlink{ftp__server__commands_8c_ae98efd39f6b27c691a7e3dc47de03ad9}{ftpServerProcessProt}(connection, p);
136          \}
137 \textcolor{preprocessor}{#endif}
138          \textcolor{comment}{//TYPE command received?}
139          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"TYPE"}))
140          \{
141             \hyperlink{ftp__server__commands_8c_a184556f9caab0164751538758f4bda6f}{ftpServerProcessType}(connection, p);
142          \}
143          \textcolor{comment}{//STRU command received?}
144          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"STRU"}))
145          \{
146             \hyperlink{ftp__server__commands_8c_af5886d31c42c6557632dc31d5dd795e4}{ftpServerProcessStru}(connection, p);
147          \}
148          \textcolor{comment}{//MODE command received?}
149          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"MODE"}))
150          \{
151             \hyperlink{ftp__server__commands_8c_a537336be6e588e1ce0adb45533d0e0ab}{ftpServerProcessMode}(connection, p);
152          \}
153          \textcolor{comment}{//USER command received?}
154          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"USER"}))
155          \{
156             \hyperlink{ftp__server__commands_8c_a6f62bccd354f8fc1ccf6f32b13bcd816}{ftpServerProcessUser}(connection, p);
157          \}
158          \textcolor{comment}{//PASS command received?}
159          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PASS"}))
160          \{
161             \hyperlink{ftp__server__commands_8c_abcde173a5fc291f981606422e9850571}{ftpServerProcessPass}(connection, p);
162          \}
163          \textcolor{comment}{//REIN command received?}
164          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"REIN"}))
165          \{
166             \hyperlink{ftp__server__commands_8c_a1fda318076a5e8105b6bfc3651686a84}{ftpServerProcessRein}(connection, p);
167          \}
168          \textcolor{comment}{//QUIT command received?}
169          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"QUIT"}))
170          \{
171             \hyperlink{ftp__server__commands_8c_ab1ee63edded186edbdfbafed1b28bc1b}{ftpServerProcessQuit}(connection, p);
172          \}
173          \textcolor{comment}{//PORT command received?}
174          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PORT"}))
175          \{
176             \hyperlink{ftp__server__commands_8c_a031959972f3be4911b6d827d7b25b142}{ftpServerProcessPort}(connection, p);
177          \}
178          \textcolor{comment}{//EPRT command received?}
179          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"EPRT"}))
180          \{
181             \hyperlink{ftp__server__commands_8c_abe3f69562a19ecb312d8f9fc1fd37d51}{ftpServerProcessEprt}(connection, p);
182          \}
183          \textcolor{comment}{//PASV command received?}
184          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PASV"}))
185          \{
186             \hyperlink{ftp__server__commands_8c_a2adf3ae2b167d0c4edfd8512628b72b0}{ftpServerProcessPasv}(connection, p);
187          \}
188          \textcolor{comment}{//EPSV command received?}
189          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"EPSV"}))
190          \{
191             \hyperlink{ftp__server__commands_8c_abca32c6fc5aafb5da965f1c1f70738c8}{ftpServerProcessEpsv}(connection, p);
192          \}
193          \textcolor{comment}{//ABOR command received?}
194          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"ABOR"}))
195          \{
196             \hyperlink{ftp__server__commands_8c_ab9488bc8b2b4b0c042277849745e7c32}{ftpServerProcessAbor}(connection, p);
197          \}
198          \textcolor{comment}{//PWD command received?}
199          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"PWD"}))
200          \{
201             \hyperlink{ftp__server__commands_8c_a20e092ea6ec68374264ba75f270316ce}{ftpServerProcessPwd}(connection, p);
202          \}
203          \textcolor{comment}{//LIST command received?}
204          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"LIST"}))
205          \{
206             \hyperlink{ftp__server__commands_8c_aceeab3e5cb48a14066e8cad2a71bedec}{ftpServerProcessList}(connection, p);
207          \}
208          \textcolor{comment}{//CWD command received?}
209          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"CWD"}))
210          \{
211             \hyperlink{ftp__server__commands_8c_a5bc28e408c3c18f6aeecfd225423caad}{ftpServerProcessCwd}(connection, p);
212          \}
213          \textcolor{comment}{//CDUP command received?}
214          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"CDUP"}))
215          \{
216             \hyperlink{ftp__server__commands_8c_a8dace1f76f9697255e81dba466b2a56f}{ftpServerProcessCdup}(connection, p);
217          \}
218          \textcolor{comment}{//MKD command received?}
219          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"MKD"}))
220          \{
221             \hyperlink{ftp__server__commands_8c_ad9df18a1487a9ca866786ce5b9baa1c8}{ftpServerProcessMkd}(connection, p);
222          \}
223          \textcolor{comment}{//RMD command received?}
224          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"RMD"}))
225          \{
226             \hyperlink{ftp__server__commands_8c_a0fe03287becff141ff842ee8246900f7}{ftpServerProcessRmd}(connection, p);
227          \}
228          \textcolor{comment}{//SIZE command received?}
229          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"SIZE"}))
230          \{
231             \hyperlink{ftp__server__commands_8c_afcd7f15bff2ba102182942120de5be71}{ftpServerProcessSize}(connection, p);
232          \}
233          \textcolor{comment}{//RETR command received?}
234          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"RETR"}))
235          \{
236             \hyperlink{ftp__server__commands_8c_af7da020b24a02335365c7bf6887cf439}{ftpServerProcessRetr}(connection, p);
237          \}
238          \textcolor{comment}{//STOR command received?}
239          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"STOR"}))
240          \{
241             \hyperlink{ftp__server__commands_8c_aa10926e2d656e6c64463cadd2506600b}{ftpServerProcessStor}(connection, p);
242          \}
243          \textcolor{comment}{//APPE command received?}
244          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"APPE"}))
245          \{
246             \hyperlink{ftp__server__commands_8c_af6162c874554119c3e78ed2602ca29a4}{ftpServerProcessAppe}(connection, p);
247          \}
248          \textcolor{comment}{//RNFR command received?}
249          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"RNFR"}))
250          \{
251             \hyperlink{ftp__server__commands_8c_a711f302d07d9bab1dce7afe79131f51a}{ftpServerProcessRnfr}(connection, p);
252          \}
253          \textcolor{comment}{//RNTO command received?}
254          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"RNTO"}))
255          \{
256             \hyperlink{ftp__server__commands_8c_ae2d679d5293b6e3f18b6dede8b982902}{ftpServerProcessRnto}(connection, p);
257          \}
258          \textcolor{comment}{//DELE command received?}
259          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(connection->command, \textcolor{stringliteral}{"DELE"}))
260          \{
261             \hyperlink{ftp__server__commands_8c_ae535cf5388ce6abe686982930e0558d7}{ftpServerProcessDele}(connection, p);
262          \}
263          \textcolor{comment}{//Unknown command received?}
264          \textcolor{keywordflow}{else}
265          \{
266             \hyperlink{ftp__server__commands_8c_aab77468d3da39862ad4b6314c571bf14}{ftpServerProcessUnknownCmd}(connection, p);
267          \}
268       \}
269 
270       \textcolor{comment}{//Debug message}
271       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"FTP server: %s"}, connection->response);
272 
273       \textcolor{comment}{//Number of bytes in the response buffer}
274       connection->responseLen = strlen(connection->response);
275       connection->responsePos = 0;
276    \}
277    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(connection->commandLen >= \hyperlink{ftp__server_8h_a311e12601252dc2319ee256bb6e714ba}{FTP\_SERVER\_MAX\_LINE\_LEN})
278    \{
279       \textcolor{comment}{//Drop incoming data}
280       connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba6cc85b8705b6fedf2ca6f277f2c916c5}{FTP\_CHANNEL\_STATE\_DISCARD};
281    \}
282 
283    \textcolor{comment}{//Flush command line}
284    connection->commandLen = 0;
285 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a5bc28e408c3c18f6aeecfd225423caad}\label{ftp__server__commands_8c_a5bc28e408c3c18f6aeecfd225423caad}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Cwd@{ftp\+Server\+Process\+Cwd}}
\index{ftp\+Server\+Process\+Cwd@{ftp\+Server\+Process\+Cwd}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Cwd()}{ftpServerProcessCwd()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Cwd (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



C\+WD command processing. 

The C\+WD command allows the user to work with a different directory


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1530 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1531 \{
1532    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1533    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1534 
1535    \textcolor{comment}{//Ensure the user is logged in}
1536    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1537    \{
1538       \textcolor{comment}{//Format response message}
1539       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1540       \textcolor{comment}{//Exit immediately}
1541       \textcolor{keywordflow}{return};
1542    \}
1543 
1544    \textcolor{comment}{//The argument specifies the pathname}
1545    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1546    \{
1547       \textcolor{comment}{//The argument is missing}
1548       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
1549       \textcolor{comment}{//Exit immediately}
1550       \textcolor{keywordflow}{return};
1551    \}
1552 
1553    \textcolor{comment}{//Retrieve the full pathname}
1554    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
1555       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1556 
1557    \textcolor{comment}{//Make sure the pathname is valid}
1558    \textcolor{keywordflow}{if}(error)
1559    \{
1560       \textcolor{comment}{//Report an error}
1561       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
1562       \textcolor{comment}{//Exit immediately}
1563       \textcolor{keywordflow}{return};
1564    \}
1565 
1566    \textcolor{comment}{//Retrieve permissions for the specified directory}
1567    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1568 
1569    \textcolor{comment}{//Insufficient access rights?}
1570    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5ea2f3957b04a30fc147df1c3818e26fe1b}{FTP\_FILE\_PERM\_READ}))
1571    \{
1572       \textcolor{comment}{//Report an error}
1573       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
1574       \textcolor{comment}{//Exit immediately}
1575       \textcolor{keywordflow}{return};
1576    \}
1577 
1578    \textcolor{comment}{//Make sure the specified directory exists}
1579    \textcolor{keywordflow}{if}(!\hyperlink{fs__port__fatfs_8c_a3c2f29449435d964e8526e891a256d6b}{fsDirExists}(connection->path))
1580    \{
1581       \textcolor{comment}{//Report an error}
1582       strcpy(connection->response, \textcolor{stringliteral}{"550 Directory not found\(\backslash\)r\(\backslash\)n"});
1583       \textcolor{comment}{//Exit immediately}
1584       \textcolor{keywordflow}{return};
1585    \}
1586 
1587    \textcolor{comment}{//Change current working directory}
1588    strcpy(connection->currentDir, connection->path);
1589 
1590    \textcolor{comment}{//A successful PWD command uses the 250 reply code}
1591    sprintf(connection->response, \textcolor{stringliteral}{"250 Directory changed to %s\(\backslash\)r\(\backslash\)n"},
1592       \hyperlink{ftp__server__misc_8c_a60770197d5fe8d7b61246dcec3b70af7}{ftpServerStripHomeDir}(connection, connection->currentDir));
1593 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ae535cf5388ce6abe686982930e0558d7}\label{ftp__server__commands_8c_ae535cf5388ce6abe686982930e0558d7}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Dele@{ftp\+Server\+Process\+Dele}}
\index{ftp\+Server\+Process\+Dele@{ftp\+Server\+Process\+Dele}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Dele()}{ftpServerProcessDele()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Dele (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



D\+E\+LE command processing. 

The D\+E\+LE command causes the file specified in the pathname to be deleted at the server site


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2507 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2508 \{
2509    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2510    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
2511 
2512    \textcolor{comment}{//Ensure the user is logged in}
2513    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2514    \{
2515       \textcolor{comment}{//Format response message}
2516       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2517       \textcolor{comment}{//Exit immediately}
2518       \textcolor{keywordflow}{return};
2519    \}
2520 
2521    \textcolor{comment}{//The argument specifies the file to be deleted}
2522    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2523    \{
2524       \textcolor{comment}{//The argument is missing}
2525       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2526       \textcolor{comment}{//Exit immediately}
2527       \textcolor{keywordflow}{return};
2528    \}
2529 
2530    \textcolor{comment}{//Retrieve the full pathname of the file}
2531    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2532       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2533 
2534    \textcolor{comment}{//Any error to report?}
2535    \textcolor{keywordflow}{if}(error)
2536    \{
2537       \textcolor{comment}{//The specified pathname is not valid...}
2538       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2539       \textcolor{comment}{//Exit immediately}
2540       \textcolor{keywordflow}{return};
2541    \}
2542 
2543    \textcolor{comment}{//Retrieve permissions for the specified directory}
2544    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
2545 
2546    \textcolor{comment}{//Insufficient access rights?}
2547    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
2548    \{
2549       \textcolor{comment}{//Report an error}
2550       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2551       \textcolor{comment}{//Exit immediately}
2552       \textcolor{keywordflow}{return};
2553    \}
2554 
2555    \textcolor{comment}{//Delete the specified file}
2556    error = \hyperlink{fs__port__fatfs_8c_a38d6ddafe3180ad55d036e2d0d86f230}{fsDeleteFile}(connection->path);
2557 
2558    \textcolor{comment}{//Any error to report?}
2559    \textcolor{keywordflow}{if}(error)
2560    \{
2561       \textcolor{comment}{//The specified file cannot be deleted...}
2562       strcpy(connection->response, \textcolor{stringliteral}{"550 Can't delete file\(\backslash\)r\(\backslash\)n"});
2563       \textcolor{comment}{//Exit immediately}
2564       \textcolor{keywordflow}{return};
2565    \}
2566 
2567    \textcolor{comment}{//The specified file was successfully deleted}
2568    strcpy(connection->response, \textcolor{stringliteral}{"250 File deleted\(\backslash\)r\(\backslash\)n"});
2569 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_abe3f69562a19ecb312d8f9fc1fd37d51}\label{ftp__server__commands_8c_abe3f69562a19ecb312d8f9fc1fd37d51}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Eprt@{ftp\+Server\+Process\+Eprt}}
\index{ftp\+Server\+Process\+Eprt@{ftp\+Server\+Process\+Eprt}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Eprt()}{ftpServerProcessEprt()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Eprt (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



E\+P\+RT command processing. 

The E\+P\+RT command allows for the specification of an extended address for the data connection


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1021 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1022 \{
1023    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1024    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_ad124d3d2e02c729afa303c775295278e}{protocol};
1025    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1026    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{coap__common_8h_aaa0137cdddb344591e20a2930a1ba54d}{token};
1027    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *end;
1028    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} delimiter[2];
1029 
1030    \textcolor{comment}{//Ensure the user is logged in}
1031    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1032    \{
1033       \textcolor{comment}{//Format response message}
1034       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1035       \textcolor{comment}{//Exit immediately}
1036       \textcolor{keywordflow}{return};
1037    \}
1038 
1039    \textcolor{comment}{//The extended address must consist of the network protocol}
1040    \textcolor{comment}{//as well as the IP address and the 16-bit port number}
1041    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1042    \{
1043       \textcolor{comment}{//The argument is missing}
1044       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
1045       \textcolor{comment}{//Exit immediately}
1046       \textcolor{keywordflow}{return};
1047    \}
1048 
1049    \textcolor{comment}{//Close the data connection, if any}
1050    \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1051 
1052    \textcolor{comment}{//Start of exception handling block}
1053    \textcolor{keywordflow}{do}
1054    \{
1055       \textcolor{comment}{//A delimiter character must be specified}
1056       delimiter[0] = param[0];
1057       delimiter[1] = \textcolor{charliteral}{'\(\backslash\)0'};
1058       \textcolor{comment}{//Skip delimiter character}
1059       param++;
1060 
1061       \textcolor{comment}{//Assume an error condition...}
1062       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
1063 
1064       \textcolor{comment}{//Retrieve the network protocol to be used}
1065       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(param, delimiter, &p);
1066       \textcolor{comment}{//Syntax error?}
1067       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1068          \textcolor{keywordflow}{break};
1069 
1070       \textcolor{comment}{//Convert the string representation to integer}
1071       protocol = strtoul(token, &end, 10);
1072       \textcolor{comment}{//Syntax error?}
1073       \textcolor{keywordflow}{if}(*end != \textcolor{charliteral}{'\(\backslash\)0'})
1074          \textcolor{keywordflow}{break};
1075 
1076       \textcolor{comment}{//Get the IP address to be used}
1077       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, delimiter, &p);
1078       \textcolor{comment}{//Syntax error?}
1079       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1080          \textcolor{keywordflow}{break};
1081 
1082 \textcolor{preprocessor}{#if (IPV4\_SUPPORT == ENABLED)}
1083       \textcolor{comment}{//IPv4 address family?}
1084       \textcolor{keywordflow}{if}(protocol == 1)
1085       \{
1086          \textcolor{comment}{//IPv4 addresses are 4-byte long}
1087          connection->remoteIpAddr.length = \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr});
1088          \textcolor{comment}{//Convert the string to IPv4 address}
1089          error = \hyperlink{ipv4_8c_a9315bca33ed7faace2bebcf6e96f8847}{ipv4StringToAddr}(token, &connection->remoteIpAddr.ipv4Addr);
1090          \textcolor{comment}{//Invalid IP address?}
1091          \textcolor{keywordflow}{if}(error)
1092             \textcolor{keywordflow}{break};
1093       \}
1094       \textcolor{keywordflow}{else}
1095 \textcolor{preprocessor}{#endif}
1096 \textcolor{preprocessor}{#if (IPV6\_SUPPORT == ENABLED)}
1097       \textcolor{comment}{//IPv6 address family?}
1098       \textcolor{keywordflow}{if}(protocol == 2)
1099       \{
1100          \textcolor{comment}{//IPv6 addresses are 16-byte long}
1101          connection->remoteIpAddr.length = \textcolor{keyword}{sizeof}(\hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr});
1102          \textcolor{comment}{//Convert the string to IPv6 address}
1103          error = \hyperlink{ipv6_8c_a89a8cf0be05e4f9ff083e6e345b52c5f}{ipv6StringToAddr}(token, &connection->remoteIpAddr.ipv6Addr);
1104          \textcolor{comment}{//Invalid IP address?}
1105          \textcolor{keywordflow}{if}(error)
1106             \textcolor{keywordflow}{break};
1107       \}
1108       \textcolor{keywordflow}{else}
1109 \textcolor{preprocessor}{#endif}
1110       \textcolor{comment}{//Unknown address family?}
1111       \{
1112          \textcolor{comment}{//Report an error}
1113          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca21cbabf2c791471c05a9bc2710638aec}{ERROR\_INVALID\_ADDRESS};
1114          \textcolor{comment}{//Exit immediately}
1115          \textcolor{keywordflow}{break};
1116       \}
1117 
1118       \textcolor{comment}{//Assume an error condition...}
1119       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
1120 
1121       \textcolor{comment}{//Get the port number to be used}
1122       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, delimiter, &p);
1123       \textcolor{comment}{//Syntax error?}
1124       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1125          \textcolor{keywordflow}{break};
1126 
1127       \textcolor{comment}{//Convert the string representation to integer}
1128       connection->remotePort = (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}) strtoul(token, &end, 10);
1129       \textcolor{comment}{//Syntax error?}
1130       \textcolor{keywordflow}{if}(*end != \textcolor{charliteral}{'\(\backslash\)0'})
1131          \textcolor{keywordflow}{break};
1132 
1133       \textcolor{comment}{//Successful processing}
1134       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1135 
1136       \textcolor{comment}{//End of exception handling block}
1137    \} \textcolor{keywordflow}{while}(0);
1138 
1139    \textcolor{comment}{//Any error to report?}
1140    \textcolor{keywordflow}{if}(error)
1141    \{
1142       \textcolor{comment}{//Re initialize data connection}
1143       connection->passiveMode = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1144       connection->remotePort = 0;
1145 
1146       \textcolor{comment}{//Format response message}
1147       strcpy(connection->response, \textcolor{stringliteral}{"501 Syntax error in parameters or arguments\(\backslash\)r\(\backslash\)n"});
1148       \textcolor{comment}{//Exit immediately}
1149       \textcolor{keywordflow}{return};
1150    \}
1151 
1152    \textcolor{comment}{//Successful processing}
1153    strcpy(connection->response, \textcolor{stringliteral}{"200 Command okay\(\backslash\)r\(\backslash\)n"});
1154 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_abca32c6fc5aafb5da965f1c1f70738c8}\label{ftp__server__commands_8c_abca32c6fc5aafb5da965f1c1f70738c8}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Epsv@{ftp\+Server\+Process\+Epsv}}
\index{ftp\+Server\+Process\+Epsv@{ftp\+Server\+Process\+Epsv}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Epsv()}{ftpServerProcessEpsv()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Epsv (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



E\+P\+SV command processing. 

The E\+P\+SV command requests that a server listen on a data port and wait for a connection


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1335 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1336 \{
1337    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1338    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1339    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
1340 
1341    \textcolor{comment}{//Point to the FTP server context}
1342    context = connection->context;
1343 
1344    \textcolor{comment}{//Ensure the user is logged in}
1345    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1346    \{
1347       \textcolor{comment}{//Format response message}
1348       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1349       \textcolor{comment}{//Exit immediately}
1350       \textcolor{keywordflow}{return};
1351    \}
1352 
1353    \textcolor{comment}{//Close the data connection, if any}
1354    \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1355 
1356    \textcolor{comment}{//Get the next passive port number to be used}
1357    port = \hyperlink{ftp__server__misc_8c_aa10a2ae6c1b6a6f25fdab668be0415c3}{ftpServerGetPassivePort}(context);
1358 
1359    \textcolor{comment}{//Start of exception handling block}
1360    \textcolor{keywordflow}{do}
1361    \{
1362       \textcolor{comment}{//Open data socket}
1363       connection->dataChannel.socket = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a9dab003c4dc9f7279e806241534d4859}{SOCKET\_TYPE\_STREAM},
1364          \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969ae0f38a6f025bce7700b3cf0ddd04bb2a}{SOCKET\_IP\_PROTO\_TCP});
1365       \textcolor{comment}{//Failed to open socket?}
1366       \textcolor{keywordflow}{if}(!connection->dataChannel.socket)
1367       \{
1368          \textcolor{comment}{//Report an error}
1369          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
1370          \textcolor{comment}{//Exit immediately}
1371          \textcolor{keywordflow}{break};
1372       \}
1373 
1374       \textcolor{comment}{//Force the socket to operate in non-blocking mode}
1375       error = \hyperlink{socket_8c_abdd29ac0ba4a644c726f5b1280680099}{socketSetTimeout}(connection->dataChannel.socket, 0);
1376       \textcolor{comment}{//Any error to report?}
1377       \textcolor{keywordflow}{if}(error)
1378          \textcolor{keywordflow}{break};
1379 
1380       \textcolor{comment}{//Adjust the size of the TX buffer}
1381       error = \hyperlink{socket_8c_aedf25ddaf93caf6fb4a9e47dae20c831}{socketSetTxBufferSize}(connection->dataChannel.socket,
1382          \hyperlink{ftp__server_8h_a483d36c0b3d4b60e0af026e64fd8ff26}{FTP\_SERVER\_MAX\_TCP\_BUFFER\_SIZE});
1383       \textcolor{comment}{//Any error to report?}
1384       \textcolor{keywordflow}{if}(error)
1385          \textcolor{keywordflow}{break};
1386 
1387       \textcolor{comment}{//Adjust the size of the RX buffer}
1388       error = \hyperlink{socket_8c_ade5d61125056ad265723b44f236bdb20}{socketSetRxBufferSize}(connection->dataChannel.socket,
1389          \hyperlink{ftp__server_8h_a483d36c0b3d4b60e0af026e64fd8ff26}{FTP\_SERVER\_MAX\_TCP\_BUFFER\_SIZE});
1390       \textcolor{comment}{//Any error to report?}
1391       \textcolor{keywordflow}{if}(error)
1392          \textcolor{keywordflow}{break};
1393 
1394       \textcolor{comment}{//Associate the socket with the relevant interface}
1395       error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(connection->dataChannel.socket,
1396          connection->interface);
1397       \textcolor{comment}{//Unable to bind the socket to the desired interface?}
1398       \textcolor{keywordflow}{if}(error)
1399          \textcolor{keywordflow}{break};
1400 
1401       \textcolor{comment}{//Bind the socket to the passive port number}
1402       error = \hyperlink{socket_8c_a56de93ca9f66782811dbe151d6da0b9c}{socketBind}(connection->dataChannel.socket, &\hyperlink{ip_8c_a132481a9d89ddf554ea8bbbe342e5d5a}{IP\_ADDR\_ANY}, port);
1403       \textcolor{comment}{//Failed to bind the socket to the desired port?}
1404       \textcolor{keywordflow}{if}(error)
1405          \textcolor{keywordflow}{break};
1406 
1407       \textcolor{comment}{//Place the data socket in the listening state}
1408       error = \hyperlink{socket_8c_a96b275d0dd033cf5fc36ba1a9c4543e3}{socketListen}(connection->dataChannel.socket, 1);
1409       \textcolor{comment}{//Any error to report?}
1410       \textcolor{keywordflow}{if}(error)
1411          \textcolor{keywordflow}{break};
1412 
1413       \textcolor{comment}{//End of exception handling block}
1414    \} \textcolor{keywordflow}{while}(0);
1415 
1416    \textcolor{comment}{//Check status code}
1417    \textcolor{keywordflow}{if}(!error)
1418    \{
1419       \textcolor{comment}{//Use passive data transfer}
1420       connection->passiveMode = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1421       \textcolor{comment}{//Update data connection state}
1422       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156baa0e05b7dd100973e72279fe8b12d5393}{FTP\_CHANNEL\_STATE\_LISTEN};
1423 
1424       \textcolor{comment}{//The response code for entering passive mode using an extended address}
1425       \textcolor{comment}{//must be 229}
1426       sprintf(connection->response, \textcolor{stringliteral}{"229 Entering extended passive mode (|||"}
1427          \textcolor{stringliteral}{"%"} PRIu16 \textcolor{stringliteral}{"|)\(\backslash\)r\(\backslash\)n"}, port);
1428    \}
1429    \textcolor{keywordflow}{else}
1430    \{
1431       \textcolor{comment}{//Clean up side effects}
1432       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1433 
1434       \textcolor{comment}{//Format response message}
1435       strcpy(connection->response, \textcolor{stringliteral}{"425 Can't enter passive mode\(\backslash\)r\(\backslash\)n"});
1436    \}
1437 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a42bb11a0ce2adce71a44b5ef6ba4fe12}\label{ftp__server__commands_8c_a42bb11a0ce2adce71a44b5ef6ba4fe12}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Feat@{ftp\+Server\+Process\+Feat}}
\index{ftp\+Server\+Process\+Feat@{ftp\+Server\+Process\+Feat}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Feat()}{ftpServerProcessFeat()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Feat (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



F\+E\+AT command processing. 

The F\+E\+AT command allows a client to discover which optional commands a server supports


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 332 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
333 \{
334 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
335    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
336 
337    \textcolor{comment}{//Point to the FTP server context}
338    context = connection->context;
339 \textcolor{preprocessor}{#endif}
340 
341    \textcolor{comment}{//Format the response to the FEAT command}
342    strcpy(connection->response, \textcolor{stringliteral}{"211-Extensions supported:\(\backslash\)r\(\backslash\)n"});
343 
344    \textcolor{comment}{//Each extension supported must be listed on a separate line}
345    strcat(connection->response, \textcolor{stringliteral}{" SIZE\(\backslash\)r\(\backslash\)n"});
346    strcat(connection->response, \textcolor{stringliteral}{" EPRT\(\backslash\)r\(\backslash\)n"});
347    strcat(connection->response, \textcolor{stringliteral}{" EPSV\(\backslash\)r\(\backslash\)n"});
348 
349 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
350    \textcolor{comment}{//TLS security mode supported by the server?}
351    \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa0bc8c34044e4a31f671148f1870902e2}{FTP\_SERVER\_MODE\_IMPLICIT\_TLS}) != 0 ||
352       (context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa8a932ad0b475652b069318fe7ef39207}{FTP\_SERVER\_MODE\_EXPLICIT\_TLS}) != 0)
353    \{
354       \textcolor{comment}{//If a server supports the FEAT command, then it must advertise}
355       \textcolor{comment}{//supported AUTH, PBSZ, and PROT commands in the reply (refer to}
356       \textcolor{comment}{//RFC 4217, section 6)}
357       strcat(connection->response, \textcolor{stringliteral}{" AUTH TLS\(\backslash\)r\(\backslash\)n"});
358       strcat(connection->response, \textcolor{stringliteral}{" PBSZ\(\backslash\)r\(\backslash\)n"});
359       strcat(connection->response, \textcolor{stringliteral}{" PROT\(\backslash\)r\(\backslash\)n"});
360    \}
361 \textcolor{preprocessor}{#endif}
362 
363    \textcolor{comment}{//Terminate feature listing}
364    strcat(connection->response, \textcolor{stringliteral}{"211 End\(\backslash\)r\(\backslash\)n"});
365 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_aceeab3e5cb48a14066e8cad2a71bedec}\label{ftp__server__commands_8c_aceeab3e5cb48a14066e8cad2a71bedec}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+List@{ftp\+Server\+Process\+List}}
\index{ftp\+Server\+Process\+List@{ftp\+Server\+Process\+List}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+List()}{ftpServerProcessList()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+List (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



L\+I\+ST command processing. 

The L\+I\+ST command is used to list the content of a directory


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1650 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1651 \{
1652    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1653    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1654 
1655    \textcolor{comment}{//Ensure the user is logged in}
1656    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1657    \{
1658       \textcolor{comment}{//Format response message}
1659       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1660       \textcolor{comment}{//Exit immediately}
1661       \textcolor{keywordflow}{return};
1662    \}
1663 
1664    \textcolor{comment}{//Any option flags}
1665    \textcolor{keywordflow}{while}(*param == \textcolor{charliteral}{'-'})
1666    \{
1667       \textcolor{comment}{//Skip option flags}
1668       \textcolor{keywordflow}{while}(*param != \textcolor{charliteral}{' '} && *param != \textcolor{charliteral}{'\(\backslash\)0'})
1669          param++;
1670       \textcolor{comment}{//Skip whitespace characters}
1671       \textcolor{keywordflow}{while}(*param == \textcolor{charliteral}{' '})
1672          param++;
1673    \}
1674 
1675    \textcolor{comment}{//The pathname is optional}
1676    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1677    \{
1678       \textcolor{comment}{//Use current directory if no pathname is specified}
1679       strcpy(connection->path, connection->currentDir);
1680    \}
1681    \textcolor{keywordflow}{else}
1682    \{
1683       \textcolor{comment}{//Retrieve the full pathname}
1684       error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
1685          connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1686 
1687       \textcolor{comment}{//Any error to report?}
1688       \textcolor{keywordflow}{if}(error)
1689       \{
1690          \textcolor{comment}{//The specified pathname is not valid...}
1691          strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
1692          \textcolor{comment}{//Exit immediately}
1693          \textcolor{keywordflow}{return};
1694       \}
1695    \}
1696 
1697    \textcolor{comment}{//Retrieve permissions for the specified directory}
1698    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1699 
1700    \textcolor{comment}{//Insufficient access rights?}
1701    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5ea2f3957b04a30fc147df1c3818e26fe1b}{FTP\_FILE\_PERM\_READ}))
1702    \{
1703       \textcolor{comment}{//Report an error}
1704       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
1705       \textcolor{comment}{//Exit immediately}
1706       \textcolor{keywordflow}{return};
1707    \}
1708 
1709    \textcolor{comment}{//Open the specified directory for reading}
1710    connection->dir = \hyperlink{fs__port__fatfs_8c_a7a412e5f03b92f85eb09448b72c46cc9}{fsOpenDir}(connection->path);
1711 
1712    \textcolor{comment}{//Failed to open the directory?}
1713    \textcolor{keywordflow}{if}(!connection->dir)
1714    \{
1715       \textcolor{comment}{//Report an error}
1716       strcpy(connection->response, \textcolor{stringliteral}{"550 Directory not found\(\backslash\)r\(\backslash\)n"});
1717       \textcolor{comment}{//Exit immediately}
1718       \textcolor{keywordflow}{return};
1719    \}
1720 
1721    \textcolor{comment}{//Check current data transfer mode}
1722    \textcolor{keywordflow}{if}(connection->passiveMode)
1723    \{
1724       \textcolor{comment}{//Check whether the data connection is already opened}
1725       \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE})
1726          connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bafebec00ae2eeb6b0629d749c38932e8b}{FTP\_CHANNEL\_STATE\_SEND};
1727    \}
1728    \textcolor{keywordflow}{else}
1729    \{
1730       \textcolor{comment}{//Open the data connection}
1731       error = \hyperlink{ftp__server__data_8c_a1897b513ba9ce04dc3a4a9be61445b54}{ftpServerOpenDataChannel}(connection);
1732 
1733       \textcolor{comment}{//Any error to report?}
1734       \textcolor{keywordflow}{if}(error)
1735       \{
1736          \textcolor{comment}{//Clean up side effects}
1737          \hyperlink{fs__port__fatfs_8c_a94bfd6c1ae79880d0a5cbe3b491368f2}{fsCloseDir}(connection->dir);
1738          \textcolor{comment}{//Format response}
1739          strcpy(connection->response, \textcolor{stringliteral}{"450 Can't open data connection\(\backslash\)r\(\backslash\)n"});
1740          \textcolor{comment}{//Exit immediately}
1741          \textcolor{keywordflow}{return};
1742       \}
1743 
1744       \textcolor{comment}{//The data connection is ready to send data}
1745       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bafebec00ae2eeb6b0629d749c38932e8b}{FTP\_CHANNEL\_STATE\_SEND};
1746    \}
1747 
1748    \textcolor{comment}{//Flush transmission buffer}
1749    connection->bufferLength = 0;
1750    connection->bufferPos = 0;
1751 
1752    \textcolor{comment}{//LIST command is being processed}
1753    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156baa81832bd77a10a26025024723d496568}{FTP\_CHANNEL\_STATE\_LIST};
1754 
1755    \textcolor{comment}{//Format response message}
1756    strcpy(connection->response, \textcolor{stringliteral}{"150 Opening data connection\(\backslash\)r\(\backslash\)n"});
1757 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ad9df18a1487a9ca866786ce5b9baa1c8}\label{ftp__server__commands_8c_ad9df18a1487a9ca866786ce5b9baa1c8}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Mkd@{ftp\+Server\+Process\+Mkd}}
\index{ftp\+Server\+Process\+Mkd@{ftp\+Server\+Process\+Mkd}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Mkd()}{ftpServerProcessMkd()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Mkd (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



M\+KD command processing. 

The M\+KD command causes the directory specified in the pathname to be created as a directory


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1770 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1771 \{
1772    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1773    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1774 
1775    \textcolor{comment}{//Ensure the user is logged in}
1776    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1777    \{
1778       \textcolor{comment}{//Format response message}
1779       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1780       \textcolor{comment}{//Exit immediately}
1781       \textcolor{keywordflow}{return};
1782    \}
1783 
1784    \textcolor{comment}{//The argument specifies the pathname}
1785    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1786    \{
1787       \textcolor{comment}{//The argument is missing}
1788       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
1789       \textcolor{comment}{//Exit immediately}
1790       \textcolor{keywordflow}{return};
1791    \}
1792 
1793    \textcolor{comment}{//Retrieve the full pathname}
1794    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
1795       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1796 
1797    \textcolor{comment}{//Any error to report?}
1798    \textcolor{keywordflow}{if}(error)
1799    \{
1800       \textcolor{comment}{//The specified pathname is not valid...}
1801       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
1802       \textcolor{comment}{//Exit immediately}
1803       \textcolor{keywordflow}{return};
1804    \}
1805 
1806    \textcolor{comment}{//Retrieve permissions for the specified directory}
1807    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1808 
1809    \textcolor{comment}{//Insufficient access rights?}
1810    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
1811    \{
1812       \textcolor{comment}{//Report an error}
1813       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
1814       \textcolor{comment}{//Exit immediately}
1815       \textcolor{keywordflow}{return};
1816    \}
1817 
1818    \textcolor{comment}{//Create the specified directory}
1819    error = \hyperlink{fs__port__fatfs_8c_a8d60b93ce5be8adc8e376cc514c3bfe7}{fsCreateDir}(connection->path);
1820 
1821    \textcolor{comment}{//Any error to report?}
1822    \textcolor{keywordflow}{if}(error)
1823    \{
1824       \textcolor{comment}{//The specified pathname is not valid...}
1825       strcpy(connection->response, \textcolor{stringliteral}{"550 Can't create directory\(\backslash\)r\(\backslash\)n"});
1826       \textcolor{comment}{//Exit immediately}
1827       \textcolor{keywordflow}{return};
1828    \}
1829 
1830    \textcolor{comment}{//The specified directory was successfully created}
1831    sprintf(connection->response, \textcolor{stringliteral}{"257 \(\backslash\)"%s\(\backslash\)" created\(\backslash\)r\(\backslash\)n"},
1832       \hyperlink{ftp__server__misc_8c_a60770197d5fe8d7b61246dcec3b70af7}{ftpServerStripHomeDir}(connection, connection->path));
1833 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a537336be6e588e1ce0adb45533d0e0ab}\label{ftp__server__commands_8c_a537336be6e588e1ce0adb45533d0e0ab}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Mode@{ftp\+Server\+Process\+Mode}}
\index{ftp\+Server\+Process\+Mode@{ftp\+Server\+Process\+Mode}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Mode()}{ftpServerProcessMode()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Mode (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



M\+O\+DE command processing. 

The M\+O\+DE command specifies the data transfer mode


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 611 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
612 \{
613    \textcolor{comment}{//The argument specifies the data transfer mode}
614    \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
615    \{
616       \textcolor{comment}{//Stream mode?}
617       \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"S"}))
618       \{
619          \textcolor{comment}{//Format the response to the MODE command}
620          strcpy(connection->response, \textcolor{stringliteral}{"200 Mode set to S\(\backslash\)r\(\backslash\)n"});
621       \}
622       \textcolor{comment}{//Unknown data transfer mode?}
623       \textcolor{keywordflow}{else}
624       \{
625          \textcolor{comment}{//Report an error}
626          strcpy(connection->response, \textcolor{stringliteral}{"504 Unknown mode\(\backslash\)r\(\backslash\)n"});
627       \}
628    \}
629    \textcolor{keywordflow}{else}
630    \{
631       \textcolor{comment}{//The argument is missing}
632       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
633    \}
634 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_aab5c5467d29c2026ddbc271c0ff43acf}\label{ftp__server__commands_8c_aab5c5467d29c2026ddbc271c0ff43acf}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Noop@{ftp\+Server\+Process\+Noop}}
\index{ftp\+Server\+Process\+Noop@{ftp\+Server\+Process\+Noop}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Noop()}{ftpServerProcessNoop()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Noop (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



N\+O\+OP command processing. 

The N\+O\+OP command does not affect any parameters or previously entered commands. It specifies no action other than that the server send an OK reply


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 298 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
299 \{
300    \textcolor{comment}{//Send an OK reply}
301    strcpy(connection->response, \textcolor{stringliteral}{"200 Command okay\(\backslash\)r\(\backslash\)n"});
302 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_abcde173a5fc291f981606422e9850571}\label{ftp__server__commands_8c_abcde173a5fc291f981606422e9850571}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Pass@{ftp\+Server\+Process\+Pass}}
\index{ftp\+Server\+Process\+Pass@{ftp\+Server\+Process\+Pass}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Pass()}{ftpServerProcessPass()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Pass (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+A\+SS command processing. 

The U\+S\+ER command specifies the user\textquotesingle{}s password


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 742 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
743 \{
744    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} status;
745    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
746 
747    \textcolor{comment}{//Point to the FTP server context}
748    context = connection->context;
749 
750    \textcolor{comment}{//This command must immediately follow a USER command}
751    \textcolor{keywordflow}{if}(connection->controlChannel.state != \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba26130f3f841cf54050461a6b268880ae}{FTP\_CHANNEL\_STATE\_USER})
752    \{
753       \textcolor{comment}{//Switch to idle state}
754       connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE};
755       \textcolor{comment}{//Report an error}
756       strcpy(connection->response, \textcolor{stringliteral}{"503 Bad sequence of commands\(\backslash\)r\(\backslash\)n"});
757       \textcolor{comment}{//Exit immediately}
758       \textcolor{keywordflow}{return};
759    \}
760 
761    \textcolor{comment}{//Switch to idle state}
762    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE};
763 
764    \textcolor{comment}{//The argument specifies the password}
765    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
766    \{
767       \textcolor{comment}{//The argument is missing}
768       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
769       \textcolor{comment}{//Exit immediately}
770       \textcolor{keywordflow}{return};
771    \}
772 
773    \textcolor{comment}{//Invoke user-defined callback, if any}
774    \textcolor{keywordflow}{if}(context->settings.checkPasswordCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
775    \{
776       status = context->settings.checkPasswordCallback(connection,
777          connection->user, param);
778    \}
779    \textcolor{keywordflow}{else}
780    \{
781       status = \hyperlink{ftp__server_8h_a5dbd0a7220ef810657b702bd72626ac4a94cd35a81778e25f22f741cd41168b68}{FTP\_ACCESS\_ALLOWED};
782    \}
783 
784    \textcolor{comment}{//Access allowed?}
785    \textcolor{keywordflow}{if}(status == \hyperlink{ftp__server_8h_a5dbd0a7220ef810657b702bd72626ac4a94cd35a81778e25f22f741cd41168b68}{FTP\_ACCESS\_ALLOWED})
786    \{
787       \textcolor{comment}{//The user is now logged in}
788       connection->userLoggedIn = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
789       \textcolor{comment}{//Format response message}
790       strcpy(connection->response, \textcolor{stringliteral}{"230 User logged in, proceed\(\backslash\)r\(\backslash\)n"});
791    \}
792    \textcolor{comment}{//Access denied?}
793    \textcolor{keywordflow}{else}
794    \{
795       \textcolor{comment}{//Format response message}
796       strcpy(connection->response, \textcolor{stringliteral}{"530 Login authentication failed\(\backslash\)r\(\backslash\)n"});
797    \}
798 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a2adf3ae2b167d0c4edfd8512628b72b0}\label{ftp__server__commands_8c_a2adf3ae2b167d0c4edfd8512628b72b0}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Pasv@{ftp\+Server\+Process\+Pasv}}
\index{ftp\+Server\+Process\+Pasv@{ftp\+Server\+Process\+Pasv}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Pasv()}{ftpServerProcessPasv()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Pasv (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+A\+SV command processing. 

The P\+A\+SV command requests the server to listen on a data port and to wait for a connection rather than initiate one upon receipt of a transfer command


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1168 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1169 \{
1170    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1171    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1172    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
1173    \hyperlink{structIpAddr}{IpAddr} \hyperlink{mib__common_8h_a3860e959b1b7dd73686a6e11424805e2}{ipAddr};
1174    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dns__common_8h_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1175    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
1176 
1177    \textcolor{comment}{//Point to the FTP server context}
1178    context = connection->context;
1179 
1180    \textcolor{comment}{//Ensure the user is logged in}
1181    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1182    \{
1183       \textcolor{comment}{//Format response message}
1184       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1185       \textcolor{comment}{//Exit immediately}
1186       \textcolor{keywordflow}{return};
1187    \}
1188 
1189    \textcolor{comment}{//Close the data connection, if any}
1190    \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1191 
1192    \textcolor{comment}{//Get the next passive port number to be used}
1193    port = \hyperlink{ftp__server__misc_8c_aa10a2ae6c1b6a6f25fdab668be0415c3}{ftpServerGetPassivePort}(context);
1194 
1195    \textcolor{comment}{//Start of exception handling block}
1196    \textcolor{keywordflow}{do}
1197    \{
1198       \textcolor{comment}{//Open data socket}
1199       connection->dataChannel.socket = \hyperlink{socket_8c_aa139bbf42b326b52eb08cf52771ac337}{socketOpen}(\hyperlink{socket_8h_aa78c7398fa81f7f62aa233159d4d8d97a9dab003c4dc9f7279e806241534d4859}{SOCKET\_TYPE\_STREAM},
1200          \hyperlink{socket_8h_a56eb0e60bda5d1d8a2e702228405d969ae0f38a6f025bce7700b3cf0ddd04bb2a}{SOCKET\_IP\_PROTO\_TCP});
1201       \textcolor{comment}{//Failed to open socket?}
1202       \textcolor{keywordflow}{if}(!connection->dataChannel.socket)
1203       \{
1204          \textcolor{comment}{//Report an error}
1205          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab721230e985e398cc0977dd729a12c61}{ERROR\_OPEN\_FAILED};
1206          \textcolor{keywordflow}{break};
1207       \}
1208 
1209       \textcolor{comment}{//Force the socket to operate in non-blocking mode}
1210       error = \hyperlink{socket_8c_abdd29ac0ba4a644c726f5b1280680099}{socketSetTimeout}(connection->dataChannel.socket, 0);
1211       \textcolor{comment}{//Any error to report?}
1212       \textcolor{keywordflow}{if}(error)
1213          \textcolor{keywordflow}{break};
1214 
1215       \textcolor{comment}{//Adjust the size of the TX buffer}
1216       error = \hyperlink{socket_8c_aedf25ddaf93caf6fb4a9e47dae20c831}{socketSetTxBufferSize}(connection->dataChannel.socket,
1217          \hyperlink{ftp__server_8h_a483d36c0b3d4b60e0af026e64fd8ff26}{FTP\_SERVER\_MAX\_TCP\_BUFFER\_SIZE});
1218       \textcolor{comment}{//Any error to report?}
1219       \textcolor{keywordflow}{if}(error)
1220          \textcolor{keywordflow}{break};
1221 
1222       \textcolor{comment}{//Adjust the size of the RX buffer}
1223       error = \hyperlink{socket_8c_ade5d61125056ad265723b44f236bdb20}{socketSetRxBufferSize}(connection->dataChannel.socket,
1224          \hyperlink{ftp__server_8h_a483d36c0b3d4b60e0af026e64fd8ff26}{FTP\_SERVER\_MAX\_TCP\_BUFFER\_SIZE});
1225       \textcolor{comment}{//Any error to report?}
1226       \textcolor{keywordflow}{if}(error)
1227          \textcolor{keywordflow}{break};
1228 
1229       \textcolor{comment}{//Associate the socket with the relevant interface}
1230       error = \hyperlink{net__legacy_8h_a80bc49fa99e5654d8c345cd5c70d36d3}{socketBindToInterface}(connection->dataChannel.socket,
1231          connection->interface);
1232       \textcolor{comment}{//Unable to bind the socket to the desired interface?}
1233       \textcolor{keywordflow}{if}(error)
1234          \textcolor{keywordflow}{break};
1235 
1236       \textcolor{comment}{//Bind the socket to the passive port number}
1237       error = \hyperlink{socket_8c_a56de93ca9f66782811dbe151d6da0b9c}{socketBind}(connection->dataChannel.socket, &\hyperlink{ip_8c_a132481a9d89ddf554ea8bbbe342e5d5a}{IP\_ADDR\_ANY},
1238          port);
1239       \textcolor{comment}{//Failed to bind the socket to the desired port?}
1240       \textcolor{keywordflow}{if}(error)
1241          \textcolor{keywordflow}{break};
1242 
1243       \textcolor{comment}{//Place the data socket in the listening state}
1244       error = \hyperlink{socket_8c_a96b275d0dd033cf5fc36ba1a9c4543e3}{socketListen}(connection->dataChannel.socket, 1);
1245       \textcolor{comment}{//Any error to report?}
1246       \textcolor{keywordflow}{if}(error)
1247          \textcolor{keywordflow}{break};
1248 
1249       \textcolor{comment}{//Retrieve the IP address of the client}
1250       error = \hyperlink{socket_8c_aeb04e3b375708898d2330e9c67c4e1a9}{socketGetRemoteAddr}(connection->controlChannel.socket, &ipAddr,
1251          \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1252       \textcolor{comment}{//Any error to report?}
1253       \textcolor{keywordflow}{if}(error)
1254          \textcolor{keywordflow}{break};
1255 
1256       \textcolor{comment}{//PASV command is limited to IPv4}
1257       \textcolor{keywordflow}{if}(ipAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} != \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}))
1258       \{
1259          \textcolor{comment}{//Report an error}
1260          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca21cbabf2c791471c05a9bc2710638aec}{ERROR\_INVALID\_ADDRESS};
1261          \textcolor{keywordflow}{break};
1262       \}
1263 
1264       \textcolor{comment}{//If the server is behind a NAT router, make sure the server knows}
1265       \textcolor{comment}{//its external IP address}
1266       \textcolor{keywordflow}{if}(!\hyperlink{ipv4__misc_8c_accb4841f1cb2665a6392644031a27713}{ipv4IsOnLink}(connection->interface, ipAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr}) &&
1267          context->settings.publicIpv4Addr != \hyperlink{ipv4_8h_aa9d277a6ff68d361eaf48d6af73e78e8}{IPV4\_UNSPECIFIED\_ADDR})
1268       \{
1269          \textcolor{comment}{//The server must return the public IP address in the PASV reply}
1270          ipAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr} = context->settings.publicIpv4Addr;
1271       \}
1272       \textcolor{keywordflow}{else}
1273       \{
1274          \textcolor{comment}{//The server must return its own IP address in the PASV reply}
1275          error = \hyperlink{socket_8c_aee73814e98b4258f707284521341420a}{socketGetLocalAddr}(connection->controlChannel.socket,
1276             &ipAddr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
1277          \textcolor{comment}{//Any error to report?}
1278          \textcolor{keywordflow}{if}(error)
1279             \textcolor{keywordflow}{break};
1280 
1281          \textcolor{comment}{//PASV command is limited to IPv4}
1282          \textcolor{keywordflow}{if}(ipAddr.\hyperlink{structIpAddr_ae61478bd1e79361fca7dd04a21aeb2f8}{length} != \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}))
1283          \{
1284             \textcolor{comment}{//Report an error}
1285             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca21cbabf2c791471c05a9bc2710638aec}{ERROR\_INVALID\_ADDRESS};
1286             \textcolor{keywordflow}{break};
1287          \}
1288       \}
1289 
1290       \textcolor{comment}{//End of exception handling block}
1291    \} \textcolor{keywordflow}{while}(0);
1292 
1293    \textcolor{comment}{//Check status code}
1294    \textcolor{keywordflow}{if}(!error)
1295    \{
1296       \textcolor{comment}{//Use passive data transfer}
1297       connection->passiveMode = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1298       \textcolor{comment}{//Update data connection state}
1299       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156baa0e05b7dd100973e72279fe8b12d5393}{FTP\_CHANNEL\_STATE\_LISTEN};
1300 
1301       \textcolor{comment}{//Format response message}
1302       n = sprintf(connection->response, \textcolor{stringliteral}{"227 Entering passive mode ("});
1303 
1304       \textcolor{comment}{//Append host address}
1305       \hyperlink{ipv4_8c_a6d826409fb54a5cc0ce23c5f88f5c7c1}{ipv4AddrToString}(ipAddr.\hyperlink{structIpAddr_a8de6f49cb0461f57c1eda49bb1088916}{ipv4Addr}, connection->response + n);
1306       \textcolor{comment}{//Change dots to commas}
1307       \hyperlink{str_8c_aaef0a79f30913d2fb6025453ad2b9d69}{strReplaceChar}(connection->response, \textcolor{charliteral}{'.'}, \textcolor{charliteral}{','});
1308 
1309       \textcolor{comment}{//Point to the end of the resulting string}
1310       p = connection->response + strlen(connection->response);
1311       \textcolor{comment}{//Append port number}
1312       sprintf(p, \textcolor{stringliteral}{",%"} PRIu8 \textcolor{stringliteral}{",%"} PRIu8 \textcolor{stringliteral}{")\(\backslash\)r\(\backslash\)n"}, \hyperlink{os__port_8h_aeb61a4e8fff2f4624a632a3189cbd3a0}{MSB}(port), \hyperlink{os__port_8h_a34a3aa6cbadec6a80ab1eae8efd0083d}{LSB}(port));
1313    \}
1314    \textcolor{keywordflow}{else}
1315    \{
1316       \textcolor{comment}{//Clean up side effects}
1317       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
1318 
1319       \textcolor{comment}{//Format response message}
1320       strcpy(connection->response, \textcolor{stringliteral}{"425 Can't enter passive mode\(\backslash\)r\(\backslash\)n"});
1321    \}
1322 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a458fc55190e092e18b5ae0fa5b173090}\label{ftp__server__commands_8c_a458fc55190e092e18b5ae0fa5b173090}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Pbsz@{ftp\+Server\+Process\+Pbsz}}
\index{ftp\+Server\+Process\+Pbsz@{ftp\+Server\+Process\+Pbsz}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Pbsz()}{ftpServerProcessPbsz()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Pbsz (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+B\+SZ command processing. 

The P\+B\+SZ command specifies the maximum size, in bytes, of the encoded data blocks to be sent or received during file transfer


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 439 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
440 \{
441 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
442    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
443 
444    \textcolor{comment}{//Point to the FTP server context}
445    context = connection->context;
446 
447    \textcolor{comment}{//TLS security mode supported by the server?}
448    \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa0bc8c34044e4a31f671148f1870902e2}{FTP\_SERVER\_MODE\_IMPLICIT\_TLS}) != 0 ||
449       (context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa8a932ad0b475652b069318fe7ef39207}{FTP\_SERVER\_MODE\_EXPLICIT\_TLS}) != 0)
450    \{
451       \textcolor{comment}{//The argument specifies the maximum size of the encoded data blocks}
452       \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
453       \{
454          \textcolor{comment}{//Format the response to the PBSZ command}
455          strcpy(connection->response, \textcolor{stringliteral}{"200 PBSZ=0\(\backslash\)r\(\backslash\)n"});
456       \}
457       \textcolor{keywordflow}{else}
458       \{
459          \textcolor{comment}{//The argument is missing}
460          strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
461       \}
462    \}
463    \textcolor{keywordflow}{else}
464 \textcolor{preprocessor}{#endif}
465    \{
466       \textcolor{comment}{//TLS security mode is not supported}
467       strcpy(connection->response, \textcolor{stringliteral}{"502 Command not implemented\(\backslash\)r\(\backslash\)n"});
468    \}
469 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a031959972f3be4911b6d827d7b25b142}\label{ftp__server__commands_8c_a031959972f3be4911b6d827d7b25b142}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Port@{ftp\+Server\+Process\+Port}}
\index{ftp\+Server\+Process\+Port@{ftp\+Server\+Process\+Port}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Port()}{ftpServerProcessPort()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Port (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+O\+RT command processing. 

The P\+O\+RT command specifies the data port to be used for the data connection


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 900 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
901 \{
902    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
903    \textcolor{keywordtype}{size\_t} i;
904    \textcolor{keywordtype}{size\_t} j;
905    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
906    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{coap__common_8h_aaa0137cdddb344591e20a2930a1ba54d}{token};
907    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *end;
908 
909    \textcolor{comment}{//Ensure the user is logged in}
910    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
911    \{
912       \textcolor{comment}{//Format response message}
913       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
914       \textcolor{comment}{//Exit immediately}
915       \textcolor{keywordflow}{return};
916    \}
917 
918    \textcolor{comment}{//The argument is the concatenation of the IP address and the 16-bit}
919    \textcolor{comment}{//port number}
920    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
921    \{
922       \textcolor{comment}{//The argument is missing}
923       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
924       \textcolor{comment}{//Exit immediately}
925       \textcolor{keywordflow}{return};
926    \}
927 
928    \textcolor{comment}{//Close the data connection, if any}
929    \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
930 
931    \textcolor{comment}{//Start of exception handling block}
932    \textcolor{keywordflow}{do}
933    \{
934       \textcolor{comment}{//Assume an error condition...}
935       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
936 
937       \textcolor{comment}{//Parse the string}
938       \textcolor{keywordflow}{for}(i = 0, j = 1; param[i] != \textcolor{charliteral}{'\(\backslash\)0'}; i++)
939       \{
940          \textcolor{comment}{//Change commas to dots}
941          \textcolor{keywordflow}{if}(param[i] == \textcolor{charliteral}{','} && j < \textcolor{keyword}{sizeof}(\hyperlink{ipv4_8h_a411debb3d770caa0c06d3f73367da37f}{Ipv4Addr}))
942          \{
943             param[i] = \textcolor{charliteral}{'.'};
944             j++;
945          \}
946       \}
947 
948       \textcolor{comment}{//Get the IP address to be used}
949       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(param, \textcolor{stringliteral}{","}, &p);
950       \textcolor{comment}{//Syntax error?}
951       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
952          \textcolor{keywordflow}{break};
953 
954       \textcolor{comment}{//Convert the dot-decimal string to a binary IP address}
955       error = \hyperlink{ip_8c_abb33f7bf7752d5465c08a873fe040b03}{ipStringToAddr}(token, &connection->remoteIpAddr);
956       \textcolor{comment}{//Invalid IP address?}
957       \textcolor{keywordflow}{if}(error)
958          \textcolor{keywordflow}{break};
959 
960       \textcolor{comment}{//Assume an error condition...}
961       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
962 
963       \textcolor{comment}{//Get the most significant byte of the port number}
964       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{","}, &p);
965       \textcolor{comment}{//Syntax error?}
966       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
967          \textcolor{keywordflow}{break};
968 
969       \textcolor{comment}{//Convert the string representation to integer}
970       connection->remotePort = (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}) strtoul(token, &end, 10) << 8;
971       \textcolor{comment}{//Syntax error?}
972       \textcolor{keywordflow}{if}(*end != \textcolor{charliteral}{'\(\backslash\)0'})
973          \textcolor{keywordflow}{break};
974 
975       \textcolor{comment}{//Get the least significant byte of the port number}
976       token = \hyperlink{strtok__r_8c_af18c3fca5cc30bc1313728d45c031ae9}{strtok\_r}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{","}, &p);
977       \textcolor{comment}{//Syntax error?}
978       \textcolor{keywordflow}{if}(token == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
979          \textcolor{keywordflow}{break};
980 
981       \textcolor{comment}{//Convert the string representation to integer}
982       connection->remotePort |= strtoul(token, &end, 10) & 0xFF;
983       \textcolor{comment}{//Syntax error?}
984       \textcolor{keywordflow}{if}(*end != \textcolor{charliteral}{'\(\backslash\)0'})
985          \textcolor{keywordflow}{break};
986 
987       \textcolor{comment}{//Successful processing}
988       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
989 
990       \textcolor{comment}{//End of exception handling block}
991    \} \textcolor{keywordflow}{while}(0);
992 
993    \textcolor{comment}{//Any error to report?}
994    \textcolor{keywordflow}{if}(error)
995    \{
996       \textcolor{comment}{//Re initialize data connection}
997       connection->passiveMode = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
998       connection->remotePort = 0;
999 
1000       \textcolor{comment}{//Format response message}
1001       strcpy(connection->response, \textcolor{stringliteral}{"501 Syntax error in parameters or arguments\(\backslash\)r\(\backslash\)n"});
1002       \textcolor{comment}{//Exit immediately}
1003       \textcolor{keywordflow}{return};
1004    \}
1005 
1006    \textcolor{comment}{//Successful processing}
1007    strcpy(connection->response, \textcolor{stringliteral}{"200 Command okay\(\backslash\)r\(\backslash\)n"});
1008 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ae98efd39f6b27c691a7e3dc47de03ad9}\label{ftp__server__commands_8c_ae98efd39f6b27c691a7e3dc47de03ad9}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Prot@{ftp\+Server\+Process\+Prot}}
\index{ftp\+Server\+Process\+Prot@{ftp\+Server\+Process\+Prot}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Prot()}{ftpServerProcessProt()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Prot (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+R\+OT command processing. 

The P\+R\+OT command specifies the data channel protection level


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 481 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
482 \{
483 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
484    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
485 
486    \textcolor{comment}{//Point to the FTP server context}
487    context = connection->context;
488 
489    \textcolor{comment}{//TLS security mode supported by the server?}
490    \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa0bc8c34044e4a31f671148f1870902e2}{FTP\_SERVER\_MODE\_IMPLICIT\_TLS}) != 0 ||
491       (context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa8a932ad0b475652b069318fe7ef39207}{FTP\_SERVER\_MODE\_EXPLICIT\_TLS}) != 0)
492    \{
493       \textcolor{comment}{//The argument specifies the data protection level}
494       \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
495       \{
496          \textcolor{comment}{//Private protection level?}
497          \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"P"}))
498          \{
499             \textcolor{comment}{//The server must reply with a 200 reply code to indicate that the}
500             \textcolor{comment}{//specified protection level is accepted}
501             strcpy(connection->response, \textcolor{stringliteral}{"200 Data protection level set to P\(\backslash\)r\(\backslash\)n"});
502          \}
503          \textcolor{comment}{//Unknown security mechanism?}
504          \textcolor{keywordflow}{else}
505          \{
506             \textcolor{comment}{//If the server does not understand the specified protection level,}
507             \textcolor{comment}{//it should respond with reply code 504}
508             strcpy(connection->response, \textcolor{stringliteral}{"504 Unknown protection level\(\backslash\)r\(\backslash\)n"});
509          \}
510       \}
511       \textcolor{keywordflow}{else}
512       \{
513          \textcolor{comment}{//The argument is missing}
514          strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
515       \}
516    \}
517    \textcolor{keywordflow}{else}
518 \textcolor{preprocessor}{#endif}
519    \{
520       \textcolor{comment}{//TLS security mode is not supported}
521       strcpy(connection->response, \textcolor{stringliteral}{"502 Command not implemented\(\backslash\)r\(\backslash\)n"});
522    \}
523 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a20e092ea6ec68374264ba75f270316ce}\label{ftp__server__commands_8c_a20e092ea6ec68374264ba75f270316ce}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Pwd@{ftp\+Server\+Process\+Pwd}}
\index{ftp\+Server\+Process\+Pwd@{ftp\+Server\+Process\+Pwd}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Pwd()}{ftpServerProcessPwd()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Pwd (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



P\+WD command processing. 

The P\+WD command causes the name of the current working directory to be returned in the reply


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1503 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1504 \{
1505    \textcolor{comment}{//Ensure the user is logged in}
1506    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1507    \{
1508       \textcolor{comment}{//Format response message}
1509       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1510       \textcolor{comment}{//Exit immediately}
1511       \textcolor{keywordflow}{return};
1512    \}
1513 
1514    \textcolor{comment}{//A successful PWD command uses the 257 reply code}
1515    sprintf(connection->response, \textcolor{stringliteral}{"257 \(\backslash\)"%s\(\backslash\)" is current directory\(\backslash\)r\(\backslash\)n"},
1516       \hyperlink{ftp__server__misc_8c_a60770197d5fe8d7b61246dcec3b70af7}{ftpServerStripHomeDir}(connection, connection->currentDir));
1517 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ab1ee63edded186edbdfbafed1b28bc1b}\label{ftp__server__commands_8c_ab1ee63edded186edbdfbafed1b28bc1b}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Quit@{ftp\+Server\+Process\+Quit}}
\index{ftp\+Server\+Process\+Quit@{ftp\+Server\+Process\+Quit}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Quit()}{ftpServerProcessQuit()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Quit (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



Q\+U\+IT command processing. 

The Q\+U\+IT command is used to terminate a user session


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 845 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
846 \{
847    \textcolor{comment}{//There are two cases to consider upon receipt of this command}
848    \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bab3165039e718584ac932b07402ac08f2}{FTP\_CHANNEL\_STATE\_CLOSED})
849    \{
850       \textcolor{comment}{//If the FTP service command was already completed, the server closes}
851       \textcolor{comment}{//the data connection (if it is open)...}
852       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
853 
854       \textcolor{comment}{//...and responds with a 221 reply}
855       strcpy(connection->response, \textcolor{stringliteral}{"221 Service closing control connection\(\backslash\)r\(\backslash\)n"});
856    \}
857    \textcolor{keywordflow}{else}
858    \{
859       \textcolor{comment}{//If the FTP service command is still in progress, the server aborts}
860       \textcolor{comment}{//the FTP service in progress and closes the data connection...}
861       \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
862 
863       \textcolor{comment}{//...returning a 426 reply to indicate that the service request}
864       \textcolor{comment}{//terminated abnormally}
865       strcpy(connection->response, \textcolor{stringliteral}{"426 Connection closed; transfer aborted\(\backslash\)r\(\backslash\)n"});
866 
867       \textcolor{comment}{//The server then sends a 221 reply}
868       strcat(connection->response, \textcolor{stringliteral}{"221 Service closing control connection\(\backslash\)r\(\backslash\)n"});
869    \}
870 
871    \textcolor{comment}{//Release previously allocated resources}
872    \textcolor{keywordflow}{if}(connection->file != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
873    \{
874       \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
875       connection->file = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
876    \}
877 
878    \textcolor{keywordflow}{if}(connection->dir != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
879    \{
880       \hyperlink{fs__port__fatfs_8c_a94bfd6c1ae79880d0a5cbe3b491368f2}{fsCloseDir}(connection->dir);
881       connection->dir = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
882    \}
883 
884    \textcolor{comment}{//Clear account information}
885    connection->userLoggedIn = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
886    \textcolor{comment}{//Gracefully disconnect from the remote host}
887    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba8c20866e8b647211dfdcf92b8549a603}{FTP\_CHANNEL\_STATE\_WAIT\_ACK};
888 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a1fda318076a5e8105b6bfc3651686a84}\label{ftp__server__commands_8c_a1fda318076a5e8105b6bfc3651686a84}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Rein@{ftp\+Server\+Process\+Rein}}
\index{ftp\+Server\+Process\+Rein@{ftp\+Server\+Process\+Rein}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Rein()}{ftpServerProcessRein()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Rein (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



R\+E\+IN command processing. 

The R\+E\+IN command is used to reinitialize a user session


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 810 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
811 \{
812    \textcolor{comment}{//Close data connection}
813    \hyperlink{ftp__server__data_8c_a62d97804710ebb11e8a1814fba4158a1}{ftpServerCloseDataChannel}(connection);
814 
815    \textcolor{comment}{//Release previously allocated resources}
816    \textcolor{keywordflow}{if}(connection->file != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
817    \{
818       \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
819       connection->file = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
820    \}
821 
822    \textcolor{keywordflow}{if}(connection->dir != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
823    \{
824       \hyperlink{fs__port__fatfs_8c_a94bfd6c1ae79880d0a5cbe3b491368f2}{fsCloseDir}(connection->dir);
825       connection->dir = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
826    \}
827 
828    \textcolor{comment}{//Clear account information}
829    connection->userLoggedIn = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
830 
831    \textcolor{comment}{//Format response message}
832    strcpy(connection->response, \textcolor{stringliteral}{"220 Service ready for new user\(\backslash\)r\(\backslash\)n"});
833 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_af7da020b24a02335365c7bf6887cf439}\label{ftp__server__commands_8c_af7da020b24a02335365c7bf6887cf439}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Retr@{ftp\+Server\+Process\+Retr}}
\index{ftp\+Server\+Process\+Retr@{ftp\+Server\+Process\+Retr}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Retr()}{ftpServerProcessRetr()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Retr (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



R\+E\+TR command processing. 

The R\+E\+TR command is used to retrieve the content of the specified file


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1995 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1996 \{
1997    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1998    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1999 
2000    \textcolor{comment}{//Ensure the user is logged in}
2001    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2002    \{
2003       \textcolor{comment}{//Format response message}
2004       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2005       \textcolor{comment}{//Exit immediately}
2006       \textcolor{keywordflow}{return};
2007    \}
2008 
2009    \textcolor{comment}{//The argument specifies the pathname of the file to read}
2010    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2011    \{
2012       \textcolor{comment}{//The argument is missing}
2013       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2014       \textcolor{comment}{//Exit immediately}
2015       \textcolor{keywordflow}{return};
2016    \}
2017 
2018    \textcolor{comment}{//Retrieve the full pathname}
2019    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2020       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2021 
2022    \textcolor{comment}{//Any error to report?}
2023    \textcolor{keywordflow}{if}(error)
2024    \{
2025       \textcolor{comment}{//The specified pathname is not valid...}
2026       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2027       \textcolor{comment}{//Exit immediately}
2028       \textcolor{keywordflow}{return};
2029    \}
2030 
2031    \textcolor{comment}{//Retrieve permissions for the specified directory}
2032    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
2033 
2034    \textcolor{comment}{//Insufficient access rights?}
2035    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5ea2f3957b04a30fc147df1c3818e26fe1b}{FTP\_FILE\_PERM\_READ}))
2036    \{
2037       \textcolor{comment}{//Report an error}
2038       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2039       \textcolor{comment}{//Exit immediately}
2040       \textcolor{keywordflow}{return};
2041    \}
2042 
2043    \textcolor{comment}{//Open specified file for reading}
2044    connection->file = \hyperlink{fs__port__fatfs_8c_aba7fcc4f174dcf4652a8b84cdfff22b5}{fsOpenFile}(connection->path, \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51cadf6c1e1805f97fa4f535acbdc2d943db}{FS\_FILE\_MODE\_READ});
2045 
2046    \textcolor{comment}{//Failed to open the file?}
2047    \textcolor{keywordflow}{if}(!connection->file)
2048    \{
2049       \textcolor{comment}{//Report an error}
2050       strcpy(connection->response, \textcolor{stringliteral}{"550 File not found\(\backslash\)r\(\backslash\)n"});
2051       \textcolor{comment}{//Exit immediately}
2052       \textcolor{keywordflow}{return};
2053    \}
2054 
2055    \textcolor{comment}{//Check current data transfer mode}
2056    \textcolor{keywordflow}{if}(connection->passiveMode)
2057    \{
2058       \textcolor{comment}{//Check whether the data connection is already opened}
2059       \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE})
2060          connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bafebec00ae2eeb6b0629d749c38932e8b}{FTP\_CHANNEL\_STATE\_SEND};
2061    \}
2062    \textcolor{keywordflow}{else}
2063    \{
2064       \textcolor{comment}{//Open the data connection}
2065       error = \hyperlink{ftp__server__data_8c_a1897b513ba9ce04dc3a4a9be61445b54}{ftpServerOpenDataChannel}(connection);
2066 
2067       \textcolor{comment}{//Any error to report?}
2068       \textcolor{keywordflow}{if}(error)
2069       \{
2070          \textcolor{comment}{//Clean up side effects}
2071          \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
2072          \textcolor{comment}{//Format response}
2073          strcpy(connection->response, \textcolor{stringliteral}{"450 Can't open data connection\(\backslash\)r\(\backslash\)n"});
2074          \textcolor{comment}{//Exit immediately}
2075          \textcolor{keywordflow}{return};
2076       \}
2077 
2078       \textcolor{comment}{//The data connection is ready to send data}
2079       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bafebec00ae2eeb6b0629d749c38932e8b}{FTP\_CHANNEL\_STATE\_SEND};
2080    \}
2081 
2082    \textcolor{comment}{//Flush transmission buffer}
2083    connection->bufferLength = 0;
2084    connection->bufferPos = 0;
2085 
2086    \textcolor{comment}{//RETR command is being processed}
2087    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba4c5afb19eec32c28176cb73346a9742c}{FTP\_CHANNEL\_STATE\_RETR};
2088 
2089    \textcolor{comment}{//Format response message}
2090    strcpy(connection->response, \textcolor{stringliteral}{"150 Opening data connection\(\backslash\)r\(\backslash\)n"});
2091 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a0fe03287becff141ff842ee8246900f7}\label{ftp__server__commands_8c_a0fe03287becff141ff842ee8246900f7}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Rmd@{ftp\+Server\+Process\+Rmd}}
\index{ftp\+Server\+Process\+Rmd@{ftp\+Server\+Process\+Rmd}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Rmd()}{ftpServerProcessRmd()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Rmd (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



R\+MD command processing. 

The R\+MD command causes the directory specified in the pathname to be removed


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1846 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1847 \{
1848    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1849    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1850 
1851    \textcolor{comment}{//Ensure the user is logged in}
1852    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1853    \{
1854       \textcolor{comment}{//Format response message}
1855       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1856       \textcolor{comment}{//Exit immediately}
1857       \textcolor{keywordflow}{return};
1858    \}
1859 
1860    \textcolor{comment}{//The argument specifies the directory to be removed}
1861    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1862    \{
1863       \textcolor{comment}{//The argument is missing}
1864       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
1865       \textcolor{comment}{//Exit immediately}
1866       \textcolor{keywordflow}{return};
1867    \}
1868 
1869    \textcolor{comment}{//Retrieve the full pathname of the directory}
1870    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
1871       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1872 
1873    \textcolor{comment}{//Any error to report?}
1874    \textcolor{keywordflow}{if}(error)
1875    \{
1876       \textcolor{comment}{//The specified pathname is not valid...}
1877       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
1878       \textcolor{comment}{//Exit immediately}
1879       \textcolor{keywordflow}{return};
1880    \}
1881 
1882    \textcolor{comment}{//Retrieve permissions for the specified directory}
1883    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1884 
1885    \textcolor{comment}{//Insufficient access rights?}
1886    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
1887    \{
1888       \textcolor{comment}{//Report an error}
1889       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
1890       \textcolor{comment}{//Exit immediately}
1891       \textcolor{keywordflow}{return};
1892    \}
1893 
1894    \textcolor{comment}{//Remove the specified directory}
1895    error = \hyperlink{fs__port__fatfs_8c_a2bb050753f999ec003b278fa58730e7f}{fsRemoveDir}(connection->path);
1896 
1897    \textcolor{comment}{//Any error to report?}
1898    \textcolor{keywordflow}{if}(error)
1899    \{
1900       \textcolor{comment}{//The specified directory cannot be deleted...}
1901       strcpy(connection->response, \textcolor{stringliteral}{"550 Can't remove directory\(\backslash\)r\(\backslash\)n"});
1902       \textcolor{comment}{//Exit immediately}
1903       \textcolor{keywordflow}{return};
1904    \}
1905 
1906    \textcolor{comment}{//The specified directory was successfully removed}
1907    strcpy(connection->response, \textcolor{stringliteral}{"250 Directory removed\(\backslash\)r\(\backslash\)n"});
1908 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a711f302d07d9bab1dce7afe79131f51a}\label{ftp__server__commands_8c_a711f302d07d9bab1dce7afe79131f51a}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Rnfr@{ftp\+Server\+Process\+Rnfr}}
\index{ftp\+Server\+Process\+Rnfr@{ftp\+Server\+Process\+Rnfr}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Rnfr()}{ftpServerProcessRnfr()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Rnfr (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



R\+N\+FR command processing. 

The R\+N\+FR command specifies the old pathname of the file which is to be renamed


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2334 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2335 \{
2336    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2337    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
2338 
2339    \textcolor{comment}{//Ensure the user is logged in}
2340    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2341    \{
2342       \textcolor{comment}{//Format response message}
2343       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2344       \textcolor{comment}{//Exit immediately}
2345       \textcolor{keywordflow}{return};
2346    \}
2347 
2348    \textcolor{comment}{//The argument specifies the file to be renamed}
2349    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2350    \{
2351       \textcolor{comment}{//The argument is missing}
2352       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2353       \textcolor{comment}{//Exit immediately}
2354       \textcolor{keywordflow}{return};
2355    \}
2356 
2357    \textcolor{comment}{//Retrieve the full pathname}
2358    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2359       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2360 
2361    \textcolor{comment}{//Any error to report?}
2362    \textcolor{keywordflow}{if}(error)
2363    \{
2364       \textcolor{comment}{//The specified pathname is not valid...}
2365       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2366       \textcolor{comment}{//Exit immediately}
2367       \textcolor{keywordflow}{return};
2368    \}
2369 
2370    \textcolor{comment}{//Retrieve permissions for the specified directory}
2371    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
2372 
2373    \textcolor{comment}{//Insufficient access rights?}
2374    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
2375    \{
2376       \textcolor{comment}{//Report an error}
2377       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2378       \textcolor{comment}{//Exit immediately}
2379       \textcolor{keywordflow}{return};
2380    \}
2381 
2382    \textcolor{comment}{//Make sure the file exists}
2383    \textcolor{keywordflow}{if}(!\hyperlink{fs__port__fatfs_8c_a0f43e535a49aaffcf54631257427f8d5}{fsFileExists}(connection->path) && !\hyperlink{fs__port__fatfs_8c_a3c2f29449435d964e8526e891a256d6b}{fsDirExists}(connection->path))
2384    \{
2385       \textcolor{comment}{//No such file or directory...}
2386       strcpy(connection->response, \textcolor{stringliteral}{"550 File not found\(\backslash\)r\(\backslash\)n"});
2387       \textcolor{comment}{//Exit immediately}
2388       \textcolor{keywordflow}{return};
2389    \}
2390 
2391    \textcolor{comment}{//This command must be immediately followed by a RNTO command}
2392    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba41c53af609e255b1223f6b453f9f05fe}{FTP\_CHANNEL\_STATE\_RNFR};
2393    \textcolor{comment}{//Format the response message}
2394    strcpy(connection->response, \textcolor{stringliteral}{"350 File exists, ready for destination name\(\backslash\)r\(\backslash\)n"});
2395 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ae2d679d5293b6e3f18b6dede8b982902}\label{ftp__server__commands_8c_ae2d679d5293b6e3f18b6dede8b982902}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Rnto@{ftp\+Server\+Process\+Rnto}}
\index{ftp\+Server\+Process\+Rnto@{ftp\+Server\+Process\+Rnto}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Rnto()}{ftpServerProcessRnto()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Rnto (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



R\+N\+TO command processing. 

The R\+N\+TO command specifies the new pathname of the file specified in the immediately preceding R\+N\+FR command


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2408 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2409 \{
2410    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2411    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
2412    \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} newPath[\hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN}];
2413 
2414    \textcolor{comment}{//Ensure the user is logged in}
2415    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2416    \{
2417       \textcolor{comment}{//Format response message}
2418       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2419       \textcolor{comment}{//Exit immediately}
2420       \textcolor{keywordflow}{return};
2421    \}
2422 
2423    \textcolor{comment}{//This command must immediately follow a RNFR command}
2424    \textcolor{keywordflow}{if}(connection->controlChannel.state != \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba41c53af609e255b1223f6b453f9f05fe}{FTP\_CHANNEL\_STATE\_RNFR})
2425    \{
2426       \textcolor{comment}{//Switch to idle state}
2427       connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE};
2428       \textcolor{comment}{//Report an error}
2429       strcpy(connection->response, \textcolor{stringliteral}{"503 Bad sequence of commands\(\backslash\)r\(\backslash\)n"});
2430       \textcolor{comment}{//Exit immediately}
2431       \textcolor{keywordflow}{return};
2432    \}
2433 
2434    \textcolor{comment}{//Switch to idle state}
2435    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE};
2436 
2437    \textcolor{comment}{//The argument specifies the new pathname}
2438    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2439    \{
2440       \textcolor{comment}{//The argument is missing}
2441       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2442       \textcolor{comment}{//Exit immediately}
2443       \textcolor{keywordflow}{return};
2444    \}
2445 
2446    \textcolor{comment}{//Retrieve the full pathname}
2447    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2448       newPath, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2449 
2450    \textcolor{comment}{//Any error to report?}
2451    \textcolor{keywordflow}{if}(error)
2452    \{
2453       \textcolor{comment}{//The specified pathname is not valid...}
2454       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2455       \textcolor{comment}{//Exit immediately}
2456       \textcolor{keywordflow}{return};
2457    \}
2458 
2459    \textcolor{comment}{//Retrieve permissions for the specified directory}
2460    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, newPath);
2461 
2462    \textcolor{comment}{//Insufficient access rights?}
2463    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
2464    \{
2465       \textcolor{comment}{//Report an error}
2466       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2467       \textcolor{comment}{//Exit immediately}
2468       \textcolor{keywordflow}{return};
2469    \}
2470 
2471    \textcolor{comment}{//Check whether the file name already exists}
2472    \textcolor{keywordflow}{if}(\hyperlink{fs__port__fatfs_8c_a0f43e535a49aaffcf54631257427f8d5}{fsFileExists}(newPath) || \hyperlink{fs__port__fatfs_8c_a3c2f29449435d964e8526e891a256d6b}{fsDirExists}(newPath))
2473    \{
2474       \textcolor{comment}{//Report an error}
2475       strcpy(connection->response, \textcolor{stringliteral}{"550 File already exists\(\backslash\)r\(\backslash\)n"});
2476       \textcolor{comment}{//Exit immediately}
2477       \textcolor{keywordflow}{return};
2478    \}
2479 
2480    \textcolor{comment}{//Rename the specified file}
2481    error = \hyperlink{fs__port__fatfs_8c_a6fcffd5686bb23325786719055d4e5fd}{fsRenameFile}(connection->path, newPath);
2482 
2483    \textcolor{comment}{//Any error to report?}
2484    \textcolor{keywordflow}{if}(error)
2485    \{
2486       \textcolor{comment}{//The specified file cannot be renamed}
2487       strcpy(connection->response, \textcolor{stringliteral}{"550 Can't rename file\(\backslash\)r\(\backslash\)n"});
2488       \textcolor{comment}{//Exit immediately}
2489       \textcolor{keywordflow}{return};
2490    \}
2491 
2492    \textcolor{comment}{//The specified file was successfully deleted}
2493    strcpy(connection->response, \textcolor{stringliteral}{"250 File renamed\(\backslash\)r\(\backslash\)n"});
2494 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_afcd7f15bff2ba102182942120de5be71}\label{ftp__server__commands_8c_afcd7f15bff2ba102182942120de5be71}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Size@{ftp\+Server\+Process\+Size}}
\index{ftp\+Server\+Process\+Size@{ftp\+Server\+Process\+Size}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Size()}{ftpServerProcessSize()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Size (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



S\+I\+ZE command processing. 

The S\+I\+ZE command is used to obtain the transfer size of the specified file


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 1920 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
1921 \{
1922    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1923    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
1924    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} size;
1925 
1926    \textcolor{comment}{//Ensure the user is logged in}
1927    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
1928    \{
1929       \textcolor{comment}{//Format response message}
1930       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
1931       \textcolor{comment}{//Exit immediately}
1932       \textcolor{keywordflow}{return};
1933    \}
1934 
1935    \textcolor{comment}{//The argument specifies the pathname of the file}
1936    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
1937    \{
1938       \textcolor{comment}{//The argument is missing}
1939       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
1940       \textcolor{comment}{//Exit immediately}
1941       \textcolor{keywordflow}{return};
1942    \}
1943 
1944    \textcolor{comment}{//Retrieve the full pathname}
1945    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
1946       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
1947 
1948    \textcolor{comment}{//Any error to report?}
1949    \textcolor{keywordflow}{if}(error)
1950    \{
1951       \textcolor{comment}{//The specified pathname is not valid...}
1952       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
1953       \textcolor{comment}{//Exit immediately}
1954       \textcolor{keywordflow}{return};
1955    \}
1956 
1957    \textcolor{comment}{//Retrieve permissions for the specified directory}
1958    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
1959 
1960    \textcolor{comment}{//Insufficient access rights?}
1961    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eaeede2660186e1e3800757ec2c6744df6}{FTP\_FILE\_PERM\_LIST}) && !(perm & 
      \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5ea2f3957b04a30fc147df1c3818e26fe1b}{FTP\_FILE\_PERM\_READ}))
1962    \{
1963       \textcolor{comment}{//Report an error}
1964       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
1965       \textcolor{comment}{//Exit immediately}
1966       \textcolor{keywordflow}{return};
1967    \}
1968 
1969    \textcolor{comment}{//Retrieve the size of the specified file}
1970    error = \hyperlink{fs__port__fatfs_8c_a468b8c15424a76f8f28be14d37a1fc6f}{fsGetFileSize}(connection->path, &size);
1971 
1972    \textcolor{comment}{//Any error to report?}
1973    \textcolor{keywordflow}{if}(error)
1974    \{
1975       \textcolor{comment}{//Report an error}
1976       strcpy(connection->response, \textcolor{stringliteral}{"550 File not found\(\backslash\)r\(\backslash\)n"});
1977       \textcolor{comment}{//Exit immediately}
1978       \textcolor{keywordflow}{return};
1979    \}
1980 
1981    \textcolor{comment}{//Format response message}
1982    sprintf(connection->response, \textcolor{stringliteral}{"213 %"} PRIu32 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, size);
1983 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_aa10926e2d656e6c64463cadd2506600b}\label{ftp__server__commands_8c_aa10926e2d656e6c64463cadd2506600b}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Stor@{ftp\+Server\+Process\+Stor}}
\index{ftp\+Server\+Process\+Stor@{ftp\+Server\+Process\+Stor}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Stor()}{ftpServerProcessStor()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Stor (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



S\+T\+OR command processing. 

The S\+T\+OR command is used to store data to the specified file


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2103 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2104 \{
2105    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2106    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} perm;
2107 
2108    \textcolor{comment}{//Ensure the user is logged in}
2109    \textcolor{keywordflow}{if}(!connection->userLoggedIn)
2110    \{
2111       \textcolor{comment}{//Format response message}
2112       strcpy(connection->response, \textcolor{stringliteral}{"530 Not logged in\(\backslash\)r\(\backslash\)n"});
2113       \textcolor{comment}{//Exit immediately}
2114       \textcolor{keywordflow}{return};
2115    \}
2116 
2117    \textcolor{comment}{//The argument specifies the pathname of the file to written}
2118    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
2119    \{
2120       \textcolor{comment}{//The argument is missing}
2121       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
2122       \textcolor{comment}{//Exit immediately}
2123       \textcolor{keywordflow}{return};
2124    \}
2125 
2126    \textcolor{comment}{//Retrieve the full pathname}
2127    error = \hyperlink{ftp__server__misc_8c_af55d165aa46a6edf5f8f603cc4671075}{ftpServerGetPath}(connection, param,
2128       connection->path, \hyperlink{ftp__server_8h_ade570d175c68d8272bc482bf337af10f}{FTP\_SERVER\_MAX\_PATH\_LEN});
2129 
2130    \textcolor{comment}{//Any error to report?}
2131    \textcolor{keywordflow}{if}(error)
2132    \{
2133       \textcolor{comment}{//The specified pathname is not valid...}
2134       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
2135       \textcolor{comment}{//Exit immediately}
2136       \textcolor{keywordflow}{return};
2137    \}
2138 
2139    \textcolor{comment}{//Retrieve permissions for the specified directory}
2140    perm = \hyperlink{ftp__server__misc_8c_a5c8fef27bdd37ac48d983912577b8ac3}{ftpServerGetFilePermissions}(connection, connection->path);
2141 
2142    \textcolor{comment}{//Insufficient access rights?}
2143    \textcolor{keywordflow}{if}(!(perm & \hyperlink{ftp__server_8h_aa941a819cc54df0f491b11d56ebe4a5eab2002a5415790b9b7318f8067f623ff0}{FTP\_FILE\_PERM\_WRITE}))
2144    \{
2145       \textcolor{comment}{//Report an error}
2146       strcpy(connection->response, \textcolor{stringliteral}{"550 Access denied\(\backslash\)r\(\backslash\)n"});
2147       \textcolor{comment}{//Exit immediately}
2148       \textcolor{keywordflow}{return};
2149    \}
2150 
2151    \textcolor{comment}{//Open specified file for writing}
2152    connection->file = \hyperlink{fs__port__fatfs_8c_aba7fcc4f174dcf4652a8b84cdfff22b5}{fsOpenFile}(connection->path,
2153       \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51caed4c8b2994951eeb8d60d929444fb8cb}{FS\_FILE\_MODE\_WRITE} | \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51ca59f9749189b0706360c6c117fd3ba104}{FS\_FILE\_MODE\_CREATE} | 
      \hyperlink{fs__port_8h_a086887b0800535e5a06340d3fc76c51cae281d66b3b573b40eb7dc9bbae4bdfc3}{FS\_FILE\_MODE\_TRUNC});
2154 
2155    \textcolor{comment}{//Failed to open the file?}
2156    \textcolor{keywordflow}{if}(!connection->file)
2157    \{
2158       \textcolor{comment}{//Report an error}
2159       strcpy(connection->response, \textcolor{stringliteral}{"550 File not found\(\backslash\)r\(\backslash\)n"});
2160       \textcolor{comment}{//Exit immediately}
2161       \textcolor{keywordflow}{return};
2162    \}
2163 
2164    \textcolor{comment}{//Check current data transfer mode}
2165    \textcolor{keywordflow}{if}(connection->passiveMode)
2166    \{
2167       \textcolor{comment}{//Check whether the data connection is already opened}
2168       \textcolor{keywordflow}{if}(connection->dataChannel.state == \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae764f1c2df0975ec9cd81a77639e8e9a}{FTP\_CHANNEL\_STATE\_IDLE})
2169          connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba1da5754390026467598643916c13c5e9}{FTP\_CHANNEL\_STATE\_RECEIVE};
2170    \}
2171    \textcolor{keywordflow}{else}
2172    \{
2173       \textcolor{comment}{//Open the data connection}
2174       error = \hyperlink{ftp__server__data_8c_a1897b513ba9ce04dc3a4a9be61445b54}{ftpServerOpenDataChannel}(connection);
2175 
2176       \textcolor{comment}{//Any error to report?}
2177       \textcolor{keywordflow}{if}(error)
2178       \{
2179          \textcolor{comment}{//Clean up side effects}
2180          \hyperlink{fs__port__fatfs_8c_a563173066eb2924f61e00e87fbf9d0bc}{fsCloseFile}(connection->file);
2181          \textcolor{comment}{//Format response}
2182          strcpy(connection->response, \textcolor{stringliteral}{"450 Can't open data connection\(\backslash\)r\(\backslash\)n"});
2183          \textcolor{comment}{//Exit immediately}
2184          \textcolor{keywordflow}{return};
2185       \}
2186 
2187       \textcolor{comment}{//The data connection is ready to receive data}
2188       connection->dataChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba1da5754390026467598643916c13c5e9}{FTP\_CHANNEL\_STATE\_RECEIVE};
2189    \}
2190 
2191    \textcolor{comment}{//Flush reception buffer}
2192    connection->bufferLength = 0;
2193    connection->bufferPos = 0;
2194 
2195    \textcolor{comment}{//STOR command is being processed}
2196    connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156bae38b71c4f0fb9b2bfe19bed29dc18fab}{FTP\_CHANNEL\_STATE\_STOR};
2197 
2198    \textcolor{comment}{//Format response message}
2199    strcpy(connection->response, \textcolor{stringliteral}{"150 Opening data connection\(\backslash\)r\(\backslash\)n"});
2200 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_af5886d31c42c6557632dc31d5dd795e4}\label{ftp__server__commands_8c_af5886d31c42c6557632dc31d5dd795e4}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Stru@{ftp\+Server\+Process\+Stru}}
\index{ftp\+Server\+Process\+Stru@{ftp\+Server\+Process\+Stru}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Stru()}{ftpServerProcessStru()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Stru (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



S\+T\+RU command processing. 

The S\+T\+RU command specifies the file structure


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 576 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
577 \{
578    \textcolor{comment}{//The argument specifies the file structure}
579    \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
580    \{
581       \textcolor{comment}{//No record structure?}
582       \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"F"}))
583       \{
584          \textcolor{comment}{//Format the response to the STRU command}
585          strcpy(connection->response, \textcolor{stringliteral}{"200 Structure set to F\(\backslash\)r\(\backslash\)n"});
586       \}
587       \textcolor{comment}{//Unknown file structure?}
588       \textcolor{keywordflow}{else}
589       \{
590          \textcolor{comment}{//Report an error}
591          strcpy(connection->response, \textcolor{stringliteral}{"504 Unknown structure\(\backslash\)r\(\backslash\)n"});
592       \}
593    \}
594    \textcolor{keywordflow}{else}
595    \{
596       \textcolor{comment}{//The argument is missing}
597       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
598    \}
599 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_ac4261d58c3ef2b697287b9723bc9ccf6}\label{ftp__server__commands_8c_ac4261d58c3ef2b697287b9723bc9ccf6}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Syst@{ftp\+Server\+Process\+Syst}}
\index{ftp\+Server\+Process\+Syst@{ftp\+Server\+Process\+Syst}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Syst()}{ftpServerProcessSyst()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Syst (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



S\+Y\+ST command processing. 

The S\+Y\+ST command is used to find out the type of operating system at the server side


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 315 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
316 \{
317    \textcolor{comment}{//Format the response to the SYST command}
318    strcpy(connection->response, \textcolor{stringliteral}{"215 UNIX Type: L8\(\backslash\)r\(\backslash\)n"});
319 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a184556f9caab0164751538758f4bda6f}\label{ftp__server__commands_8c_a184556f9caab0164751538758f4bda6f}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Type@{ftp\+Server\+Process\+Type}}
\index{ftp\+Server\+Process\+Type@{ftp\+Server\+Process\+Type}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Type()}{ftpServerProcessType()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Type (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



T\+Y\+PE command processing. 

The T\+Y\+PE command specifies the representation type


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 535 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
536 \{
537    \textcolor{comment}{//The argument specifies the representation type}
538    \textcolor{keywordflow}{if}(*param != \textcolor{charliteral}{'\(\backslash\)0'})
539    \{
540       \textcolor{comment}{//ASCII type?}
541       \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"A"}))
542       \{
543          \textcolor{comment}{//Format the response to the TYPE command}
544          strcpy(connection->response, \textcolor{stringliteral}{"200 Type set to A\(\backslash\)r\(\backslash\)n"});
545       \}
546       \textcolor{comment}{//Image type?}
547       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{os__port__windows_8h_ac99ec3f1036620727a68aa8c25a8963c}{strcasecmp}(param, \textcolor{stringliteral}{"I"}))
548       \{
549          \textcolor{comment}{//Format the response to the TYPE command}
550          strcpy(connection->response, \textcolor{stringliteral}{"200 Type set to I\(\backslash\)r\(\backslash\)n"});
551       \}
552       \textcolor{comment}{//Unknown type?}
553       \textcolor{keywordflow}{else}
554       \{
555          \textcolor{comment}{//Report an error}
556          strcpy(connection->response, \textcolor{stringliteral}{"504 Unknown type\(\backslash\)r\(\backslash\)n"});
557       \}
558    \}
559    \textcolor{keywordflow}{else}
560    \{
561       \textcolor{comment}{//The argument is missing}
562       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
563    \}
564 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_aab77468d3da39862ad4b6314c571bf14}\label{ftp__server__commands_8c_aab77468d3da39862ad4b6314c571bf14}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+Unknown\+Cmd@{ftp\+Server\+Process\+Unknown\+Cmd}}
\index{ftp\+Server\+Process\+Unknown\+Cmd@{ftp\+Server\+Process\+Unknown\+Cmd}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+Unknown\+Cmd()}{ftpServerProcessUnknownCmd()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+Unknown\+Cmd (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



Unknown command processing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 2578 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
2579 \{
2580    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
2581    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
2582 
2583    \textcolor{comment}{//Point to the FTP server context}
2584    context = connection->context;
2585 
2586    \textcolor{comment}{//Invoke user-defined callback, if any}
2587    \textcolor{keywordflow}{if}(context->settings.unknownCommandCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
2588    \{
2589       \textcolor{comment}{//Custom command processing}
2590       error = context->settings.unknownCommandCallback(connection,
2591          connection->command, param);
2592    \}
2593    \textcolor{keywordflow}{else}
2594    \{
2595       \textcolor{comment}{//Report an error}
2596       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab608340a5abe5f1881f2db8f81cdd30d}{ERROR\_INVALID\_COMMAND};
2597    \}
2598 
2599    \textcolor{comment}{//Invalid command received?}
2600    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab608340a5abe5f1881f2db8f81cdd30d}{ERROR\_INVALID\_COMMAND})
2601    \{
2602       \textcolor{comment}{//Format response message}
2603       strcpy(connection->response, \textcolor{stringliteral}{"500 Command unrecognized\(\backslash\)r\(\backslash\)n"});
2604    \}
2605 \}
\end{DoxyCode}
\mbox{\Hypertarget{ftp__server__commands_8c_a6f62bccd354f8fc1ccf6f32b13bcd816}\label{ftp__server__commands_8c_a6f62bccd354f8fc1ccf6f32b13bcd816}} 
\index{ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}!ftp\+Server\+Process\+User@{ftp\+Server\+Process\+User}}
\index{ftp\+Server\+Process\+User@{ftp\+Server\+Process\+User}!ftp\+\_\+server\+\_\+commands.\+c@{ftp\+\_\+server\+\_\+commands.\+c}}
\subsubsection{\texorpdfstring{ftp\+Server\+Process\+User()}{ftpServerProcessUser()}}
{\footnotesize\ttfamily void ftp\+Server\+Process\+User (\begin{DoxyParamCaption}\item[{\hyperlink{ftp__server_8h_ab682699c15473841571a42c3df57e9d2}{Ftp\+Client\+Connection} $\ast$}]{connection,  }\item[{\hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



U\+S\+ER command processing. 

The U\+S\+ER command is used to identify the user


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em connection} & Pointer to the client connection \\
\hline
\mbox{\tt in}  & {\em param} & Command line parameters \\
\hline
\end{DoxyParams}


Definition at line 646 of file ftp\+\_\+server\+\_\+commands.\+c.


\begin{DoxyCode}
647 \{
648    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} status;
649    \hyperlink{ftp__server_8h_af7294ff4e42ca4befb7414ce9fd6f287}{FtpServerContext} *context;
650 
651    \textcolor{comment}{//Point to the FTP server context}
652    context = connection->context;
653 
654    \textcolor{comment}{//The argument specifies the user name}
655    \textcolor{keywordflow}{if}(*param == \textcolor{charliteral}{'\(\backslash\)0'})
656    \{
657       \textcolor{comment}{//The argument is missing}
658       strcpy(connection->response, \textcolor{stringliteral}{"501 Missing parameter\(\backslash\)r\(\backslash\)n"});
659       \textcolor{comment}{//Exit immediately}
660       \textcolor{keywordflow}{return};
661    \}
662 
663    \textcolor{comment}{//Check the length of the user name}
664    \textcolor{keywordflow}{if}(strlen(param) > \hyperlink{ftp__server_8h_a214093e595eff13cf5dde31875678cb4}{FTP\_SERVER\_MAX\_USERNAME\_LEN})
665    \{
666       \textcolor{comment}{//The specified user name is not valid...}
667       strcpy(connection->response, \textcolor{stringliteral}{"501 Invalid parameter\(\backslash\)r\(\backslash\)n"});
668       \textcolor{comment}{//Exit immediately}
669       \textcolor{keywordflow}{return};
670    \}
671 
672 \textcolor{preprocessor}{#if (FTP\_SERVER\_TLS\_SUPPORT == ENABLED)}
673    \textcolor{comment}{//Cleartext FTP session?}
674    \textcolor{keywordflow}{if}(connection->controlChannel.tlsContext == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
675    \{
676       \textcolor{comment}{//If the server needs AUTH, then it refuses to accept certain commands}
677       \textcolor{comment}{//until it gets a successfully protected session (refer to RFC 4217,}
678       \textcolor{comment}{//section 11.1)}
679       \textcolor{keywordflow}{if}((context->settings.mode & \hyperlink{ftp__server_8h_a8ae7b1433220e89fb8719e2a0117150aa498a88d4d99d76660ef0980ddf6e475c}{FTP\_SERVER\_MODE\_PLAINTEXT}) == 0)
680       \{
681          \textcolor{comment}{//Format response message}
682          strcpy(connection->response, \textcolor{stringliteral}{"421 Cleartext sessions are not accepted\(\backslash\)r\(\backslash\)n"});
683          \textcolor{comment}{//Exit immediately}
684          \textcolor{keywordflow}{return};
685       \}
686    \}
687 \textcolor{preprocessor}{#endif}
688 
689    \textcolor{comment}{//Save user name}
690    strcpy(connection->user, param);
691    \textcolor{comment}{//Log out the user}
692    connection->userLoggedIn = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
693    \textcolor{comment}{//Set home directory}
694    strcpy(connection->homeDir, context->settings.rootDir);
695    \textcolor{comment}{//Set current directory}
696    strcpy(connection->currentDir, context->settings.rootDir);
697 
698    \textcolor{comment}{//Invoke user-defined callback, if any}
699    \textcolor{keywordflow}{if}(context->settings.checkUserCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
700    \{
701       status = context->settings.checkUserCallback(connection, param);
702    \}
703    \textcolor{keywordflow}{else}
704    \{
705       status = \hyperlink{ftp__server_8h_a5dbd0a7220ef810657b702bd72626ac4a94cd35a81778e25f22f741cd41168b68}{FTP\_ACCESS\_ALLOWED};
706    \}
707 
708    \textcolor{comment}{//Access allowed?}
709    \textcolor{keywordflow}{if}(status == \hyperlink{ftp__server_8h_a5dbd0a7220ef810657b702bd72626ac4a94cd35a81778e25f22f741cd41168b68}{FTP\_ACCESS\_ALLOWED})
710    \{
711       \textcolor{comment}{//The user is now logged in}
712       connection->userLoggedIn = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
713       \textcolor{comment}{//Format response message}
714       strcpy(connection->response, \textcolor{stringliteral}{"230 User logged in, proceed\(\backslash\)r\(\backslash\)n"});
715    \}
716    \textcolor{comment}{//Password required?}
717    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(status == \hyperlink{ftp__server_8h_a5dbd0a7220ef810657b702bd72626ac4ac8d37cf2d7c80097f4c096e313b9baa6}{FTP\_PASSWORD\_REQUIRED})
718    \{
719       \textcolor{comment}{//This command must be immediately followed by a PASS command}
720       connection->controlChannel.state = \hyperlink{ftp__server_8h_a925bb5abc66ff43f81be2420bd31156ba26130f3f841cf54050461a6b268880ae}{FTP\_CHANNEL\_STATE\_USER};
721       \textcolor{comment}{//Format response message}
722       strcpy(connection->response, \textcolor{stringliteral}{"331 User name okay, need password\(\backslash\)r\(\backslash\)n"});
723    \}
724    \textcolor{comment}{//Access denied?}
725    \textcolor{keywordflow}{else}
726    \{
727       \textcolor{comment}{//Format response message}
728       strcpy(connection->response, \textcolor{stringliteral}{"530 Login authentication failed\(\backslash\)r\(\backslash\)n"});
729    \}
730 \}
\end{DoxyCode}
