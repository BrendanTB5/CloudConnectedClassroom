\hypertarget{asn1_8c}{}\section{cyclone\+\_\+crypto/encoding/asn1.c File Reference}
\label{asn1_8c}\index{cyclone\+\_\+crypto/encoding/asn1.\+c@{cyclone\+\_\+crypto/encoding/asn1.\+c}}


A\+S\+N.\+1 (Abstract Syntax Notation One)  


{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/asn1.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}encoding/oid.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{asn1_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1\+Read\+Tag} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag)
\begin{DoxyCompactList}\small\item\em Read an A\+S\+N.\+1 tag from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a5df4a5a14b22837b3dea3525608a9122}{asn1\+Read\+Sequence} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag)
\begin{DoxyCompactList}\small\item\em Read an A\+S\+N.\+1 sequence from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a08b7995f0473e1ff62a9061f31410b2f}{asn1\+Read\+Octet\+String} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag)
\begin{DoxyCompactList}\small\item\em Read an octet string from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a842c029a80fcf3c0c1a2a8bf1ba2d96c}{asn1\+Read\+Oid} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag)
\begin{DoxyCompactList}\small\item\em Read an object identifier from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_aa482426b7298d8eca286aae3c466d680}{asn1\+Read\+Boolean} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Read a boolean from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_aca52b824f6c2dd7f97747606d325e154}{asn1\+Read\+Int32} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, \hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Read a 32-\/bit integer from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_aa73309637560abf8e42288890c19d641}{asn1\+Read\+Mpi} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value})
\begin{DoxyCompactList}\small\item\em Read a multiple-\/precision integer from the input stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1\+Write\+Tag} (\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} reverse, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Write an A\+S\+N.\+1 tag. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}{asn1\+Write\+Int32} (\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} \hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} reverse, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Write a 32-\/bit integer to the output stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a2232296cd470abd4077f4e61f102473f}{asn1\+Write\+Mpi} (const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{chap_8h_adfa040d04d16520129a735fff8fb1628}{value}, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} reverse, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Write a multiple-\/precision integer from the output stream. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1\+Check\+Tag} (const \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} constructed, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} obj\+Class, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} obj\+Type)
\begin{DoxyCompactList}\small\item\em Enforce the type of a specified tag. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_a565e797369dd4ec4b722954715507907}{asn1\+Check\+Oid} (const \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$tag, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Check A\+S\+N.\+1 tag against a specified O\+ID. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1\+Dump\+Object} (const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{tftp__common_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length}, \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t} \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level})
\begin{DoxyCompactList}\small\item\em Display an A\+S\+N.\+1 data object. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
A\+S\+N.\+1 (Abstract Syntax Notation One) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{asn1_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{asn1_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{asn1.\+c@{asn1.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file asn1.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{asn1_8c_a565e797369dd4ec4b722954715507907}\label{asn1_8c_a565e797369dd4ec4b722954715507907}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Check\+Oid@{asn1\+Check\+Oid}}
\index{asn1\+Check\+Oid@{asn1\+Check\+Oid}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Check\+Oid()}{asn1CheckOid()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Check\+Oid (\begin{DoxyParamCaption}\item[{const \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{oid,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Check A\+S\+N.\+1 tag against a specified O\+ID. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em tag} & Pointer to an A\+S\+N.\+1 tag \\
\hline
\mbox{\tt in}  & {\em oid} & Expected object identifier (O\+ID) \\
\hline
\mbox{\tt in}  & {\em length} & Length of the O\+ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 663 of file asn1.\+c.


\begin{DoxyCode}
664 \{
665    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
666 
667    \textcolor{comment}{//Enforce encoding, class and type}
668    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER});
669    \textcolor{comment}{//Any error to report?}
670    \textcolor{keywordflow}{if}(error)
671       \textcolor{keywordflow}{return} error;
672 
673    \textcolor{comment}{//Compare OID against the specified value}
674    \textcolor{keywordflow}{if}(\hyperlink{oid_8c_a3f24a7995a2a7aa587379ec6e1922e36}{oidComp}(tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}, \hyperlink{mib__common_8h_a5d78f42b3545deb9bbd305138506c7a7}{oid}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}))
675       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2bc2298123e24e3d82592b5c68c20612}{ERROR\_WRONG\_IDENTIFIER};
676 
677    \textcolor{comment}{//The tag matches all the criteria}
678    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
679 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}\label{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Check\+Tag@{asn1\+Check\+Tag}}
\index{asn1\+Check\+Tag@{asn1\+Check\+Tag}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Check\+Tag()}{asn1CheckTag()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Check\+Tag (\begin{DoxyParamCaption}\item[{const \hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{constructed,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{obj\+Class,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{obj\+Type }\end{DoxyParamCaption})}



Enforce the type of a specified tag. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em tag} & Pointer to an A\+S\+N.\+1 tag \\
\hline
\mbox{\tt in}  & {\em constructed} & Expected encoding (T\+R\+UE for constructed, F\+A\+L\+SE for primitive) \\
\hline
\mbox{\tt in}  & {\em obj\+Class} & Expected tag class \\
\hline
\mbox{\tt in}  & {\em obj\+Type} & Expected tag type \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 637 of file asn1.\+c.


\begin{DoxyCode}
639 \{
640    \textcolor{comment}{//Check encoding}
641    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} != constructed)
642       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
643    \textcolor{comment}{//Enforce class}
644    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} != objClass)
645       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca43454cea92ccd5499886077a93f63d08}{ERROR\_INVALID\_CLASS};
646    \textcolor{comment}{//Enforce type}
647    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} != objType)
648       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2daa3c161edaa4477d1ae954c2136008}{ERROR\_INVALID\_TYPE};
649 
650    \textcolor{comment}{//The tag matches all the criteria}
651    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
652 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}\label{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Dump\+Object@{asn1\+Dump\+Object}}
\index{asn1\+Dump\+Object@{asn1\+Dump\+Object}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Dump\+Object()}{asn1DumpObject()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Dump\+Object (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\+\_\+t}}]{level }\end{DoxyParamCaption})}



Display an A\+S\+N.\+1 data object. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Pointer to the A\+S\+N.\+1 object to dump \\
\hline
\mbox{\tt in}  & {\em length} & Length of the A\+S\+N.\+1 object \\
\hline
\mbox{\tt in}  & {\em level} & Current level of recursion (this parameter shall be set to 0) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 690 of file asn1.\+c.


\begin{DoxyCode}
691 \{
692 \textcolor{comment}{//Check debugging level}
693 \textcolor{preprocessor}{#if (TRACE\_LEVEL >= TRACE\_LEVEL\_DEBUG)}
694    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
695    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
696    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
697 
698    \textcolor{comment}{//ASN.1 universal types}
699    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *label[32] =
700    \{
701       \textcolor{stringliteral}{"[0]"},
702       \textcolor{stringliteral}{"BOOLEAN"},
703       \textcolor{stringliteral}{"INTEGER"},
704       \textcolor{stringliteral}{"BIT STRING"},
705       \textcolor{stringliteral}{"OCTET STRING"},
706       \textcolor{stringliteral}{"NULL"},
707       \textcolor{stringliteral}{"OBJECT IDENTIFIER"},
708       \textcolor{stringliteral}{"OBJECT DESCRIPTOR"},
709       \textcolor{stringliteral}{"EXTERNAL"},
710       \textcolor{stringliteral}{"REAL"},
711       \textcolor{stringliteral}{"ENUMERATED"},
712       \textcolor{stringliteral}{"[11]"},
713       \textcolor{stringliteral}{"UTF8 STRING"},
714       \textcolor{stringliteral}{"[13]"},
715       \textcolor{stringliteral}{"[14]"},
716       \textcolor{stringliteral}{"[15]"},
717       \textcolor{stringliteral}{"SEQUENCE"},
718       \textcolor{stringliteral}{"SET"},
719       \textcolor{stringliteral}{"NUMERIC STRING"},
720       \textcolor{stringliteral}{"PRINTABLE STRING"},
721       \textcolor{stringliteral}{"TELETEX STRING"},
722       \textcolor{stringliteral}{"VIDEOTEX STRING"},
723       \textcolor{stringliteral}{"IA5 STRING"},
724       \textcolor{stringliteral}{"UTC TIME"},
725       \textcolor{stringliteral}{"GENERALIZED TIME"},
726       \textcolor{stringliteral}{"GRAPHIC STRING"},
727       \textcolor{stringliteral}{"VISIBLE STRING"},
728       \textcolor{stringliteral}{"GENERAL STRING"},
729       \textcolor{stringliteral}{"UNIVERSAL STRING"},
730       \textcolor{stringliteral}{"[29]"},
731       \textcolor{stringliteral}{"BMP STRING"},
732       \textcolor{stringliteral}{"[31]"}
733    \};
734 
735    \textcolor{comment}{//Prefix used to format the structure}
736    \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{compiler__port_8h_a40bb5262bf908c328fbcfbe5d29d0201}{char\_t} *\hyperlink{dhcpv6__common_8h_a82020d9f611b297873f5caeecb4e93c1}{prefix}[10] =
737    \{
738       \textcolor{stringliteral}{""},
739       \textcolor{stringliteral}{"  "},
740       \textcolor{stringliteral}{"    "},
741       \textcolor{stringliteral}{"      "},
742       \textcolor{stringliteral}{"        "},
743       \textcolor{stringliteral}{"          "},
744       \textcolor{stringliteral}{"            "},
745       \textcolor{stringliteral}{"              "},
746       \textcolor{stringliteral}{"                "},
747       \textcolor{stringliteral}{"                  "}
748    \};
749 
750    \textcolor{comment}{//Parse ASN.1 object}
751    \textcolor{keywordflow}{while}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} > 0)
752    \{
753       \textcolor{comment}{//Decode current ASN.1 tag}
754       error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, &tag);
755       \textcolor{comment}{//Decoding failed?}
756       \textcolor{keywordflow}{if}(error)
757          \textcolor{keywordflow}{return} error;
758 
759       \textcolor{comment}{//Point to the next field}
760       \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} += tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
761       \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
762 
763       \textcolor{comment}{//Dump tag number, tag class, and contents length fields}
764       \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 32 && (tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} & \hyperlink{asn1_8h_a3cbaaf76e31a93d527889e750b735772}{ASN1\_CLASS\_MASK}) == 
      \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL})
765          \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s%s (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)\(\backslash\)r\(\backslash\)n"}, prefix[
      \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level}], label[tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType}], tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
766       \textcolor{keywordflow}{else}
767          \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s[%u] (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)\(\backslash\)r\(\backslash\)n"}, prefix[
      \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level}], tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType}, tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
768 
769       \textcolor{comment}{//Constructed type?}
770       \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed})
771       \{
772          \textcolor{comment}{//Check whether the maximum level of recursion is reached}
773          \textcolor{keywordflow}{if}(\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} < 8)
774          \{
775             \textcolor{comment}{//Recursive decoding of the ASN.1 tag}
776             error = \hyperlink{asn1_8c_adfebd6c0e21cc4d23414ff98aa9e9a69}{asn1DumpObject}(tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}, 
      \hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1);
777             \textcolor{comment}{//Decoding failed?}
778             \textcolor{keywordflow}{if}(error)
779                \textcolor{keywordflow}{return} error;
780          \}
781          \textcolor{keywordflow}{else}
782          \{
783             \textcolor{comment}{//If the maximum level of recursion is reached, then dump contents}
784             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag.
      \hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
785          \}
786       \}
787       \textcolor{comment}{//Primitive type?}
788       \textcolor{keywordflow}{else}
789       \{
790          \textcolor{comment}{//Check the type of the current tag}
791          \textcolor{keywordflow}{switch}(tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType})
792          \{
793          \textcolor{comment}{//OID?}
794          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER}:
795             \textcolor{comment}{//Append prefix}
796             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1]);
797             \textcolor{comment}{//Print OID}
798             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, \hyperlink{oid_8c_afd6abfd7bdf7b14b9ca45ff051f3134e}{oidToString}(tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag.
      \hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0));
799             \textcolor{comment}{//Add a line feed}
800             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
801             \textcolor{keywordflow}{break};
802 
803          \textcolor{comment}{//String?}
804          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad9fab7a20a7fdeb187457a9a3d3e6e5d}{ASN1\_TYPE\_UTF8\_STRING}:
805          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa6c647c8daf9c7ee9529bc7aae8fa5dff}{ASN1\_TYPE\_NUMERIC\_STRING}:
806          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfab8c073a8ddd8bb70bf652a5c3366319e}{ASN1\_TYPE\_PRINTABLE\_STRING}:
807          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfac3079ebed2b6bdbc5b8eea93be510589}{ASN1\_TYPE\_TELETEX\_STRING}:
808          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa54c5e53b29df9a9b344cfa625ca244f3}{ASN1\_TYPE\_VIDEOTEX\_STRING}:
809          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfad887e79aeb6c291ce2c631405bb8d060}{ASN1\_TYPE\_IA5\_STRING}:
810          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6b701ec6b1cfc22611849ec06551bfb}{ASN1\_TYPE\_GRAPHIC\_STRING}:
811          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa17ac0ac523d1af8cc8937d8c1ba56cd9}{ASN1\_TYPE\_VISIBLE\_STRING}:
812          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa0008de8819d540635767d9551a9d7de3}{ASN1\_TYPE\_GENERAL\_STRING}:
813          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa82f2d4d9558ff67dc371fd42628f6793}{ASN1\_TYPE\_UNIVERSAL\_STRING}:
814          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa1bbb04b430e3bbbc1484761ae48dc095}{ASN1\_TYPE\_BMP\_STRING}:
815             \textcolor{comment}{//Append prefix}
816             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1]);
817 
818             \textcolor{comment}{//Dump the entire string}
819             \textcolor{keywordflow}{for}(i = 0; i < tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}; i++)
820             \{
821                \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%c"}, tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[i]);
822             \}
823 
824             \textcolor{comment}{//Add a line feed}
825             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
826             \textcolor{keywordflow}{break};
827 
828          \textcolor{comment}{//UTC time?}
829          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa9f9c0acd29e300911008f2f14d38603d}{ASN1\_TYPE\_UTC\_TIME}:
830             \textcolor{comment}{//Check length}
831             \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} != 13)
832                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
833             \textcolor{comment}{//The encoding shall terminate with a "Z"}
834             \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} - 1] != \textcolor{charliteral}{'Z'})
835                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
836 
837             \textcolor{comment}{//Append prefix}
838             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1]);
839             \textcolor{comment}{//Display date}
840             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%c%c/%c%c/%c%c "}, tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[0], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[1],
841                tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[2], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[3], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[4], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[5]);
842             \textcolor{comment}{//Display time}
843             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%c%c:%c%c:%c%c"}, tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[6], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[7],
844                tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[8], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[9], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[10], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[11]);
845             \textcolor{comment}{//Add a line feed}
846             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
847             \textcolor{keywordflow}{break};
848 
849          \textcolor{comment}{//Generalized time?}
850          \textcolor{keywordflow}{case} \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa27cd934568bfa45864e37d5ba434b3f9}{ASN1\_TYPE\_GENERALIZED\_TIME}:
851             \textcolor{comment}{//Check length}
852             \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} != 15)
853                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
854             \textcolor{comment}{//The encoding shall terminate with a "Z"}
855             \textcolor{keywordflow}{if}(tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} - 1] != \textcolor{charliteral}{'Z'})
856                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca502c4621b59b0b51a9f8337d6a902c9c}{ERROR\_WRONG\_ENCODING};
857 
858             \textcolor{comment}{//Append prefix}
859             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%s"}, prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1]);
860             \textcolor{comment}{//Display date}
861             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%c%c%c%c/%c%c/%c%c "}, tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[0], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[1], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[2],
862                tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[3], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[4], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[5], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[6], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[7]);
863             \textcolor{comment}{//Display time}
864             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"%c%c:%c%c:%c%c"}, tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[8], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[9],
865                tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[10], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[11], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[12], tag.
      \hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[13]);
866             \textcolor{comment}{//Add a line feed}
867             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
868             \textcolor{keywordflow}{break};
869 
870          \textcolor{comment}{//Any other type?}
871          \textcolor{keywordflow}{default}:
872             \textcolor{comment}{//Dump the contents of the tag}
873             \hyperlink{debug_8h_a1f71019169d85407d8827300ed43bdf0}{TRACE\_DEBUG\_ARRAY}(prefix[\hyperlink{tls_8h_abbb6c7c49508c1ac374683f2d1159e08}{level} + 1], tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag.
      \hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
874             \textcolor{keywordflow}{break};
875          \}
876       \}
877    \}
878 \textcolor{preprocessor}{#endif}
879 
880    \textcolor{comment}{//ASN.1 object successfully decoded}
881    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
882 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_aa482426b7298d8eca286aae3c466d680}\label{asn1_8c_aa482426b7298d8eca286aae3c466d680}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Boolean@{asn1\+Read\+Boolean}}
\index{asn1\+Read\+Boolean@{asn1\+Read\+Boolean}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Boolean()}{asn1ReadBoolean()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Boolean (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Read a boolean from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\mbox{\tt out}  & {\em value} & Boolean value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 247 of file asn1.\+c.


\begin{DoxyCode}
249 \{
250    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
251 
252    \textcolor{comment}{//Read ASN.1 tag}
253    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
254    \textcolor{comment}{//Failed to decode ASN.1 tag?}
255    \textcolor{keywordflow}{if}(error)
256       \textcolor{keywordflow}{return} error;
257 
258    \textcolor{comment}{//Enforce encoding, class and type}
259    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa6e8bd3d6d3cfdc39ccc2891743560462}{ASN1\_TYPE\_BOOLEAN});
260    \textcolor{comment}{//Invalid tag?}
261    \textcolor{keywordflow}{if}(error)
262       \textcolor{keywordflow}{return} error;
263 
264    \textcolor{comment}{//Make sure the length of the boolean is valid}
265    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} != 1)
266       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
267 
268    \textcolor{comment}{//Read the value of the boolean}
269    *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} = tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[0] ? \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} : \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
270 
271    \textcolor{comment}{//ASN.1 tag successfully decoded}
272    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
273 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_aca52b824f6c2dd7f97747606d325e154}\label{asn1_8c_aca52b824f6c2dd7f97747606d325e154}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Int32@{asn1\+Read\+Int32}}
\index{asn1\+Read\+Int32@{asn1\+Read\+Int32}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Int32()}{asn1ReadInt32()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Int32 (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Read a 32-\/bit integer from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\mbox{\tt out}  & {\em value} & Integer value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 285 of file asn1.\+c.


\begin{DoxyCode}
287 \{
288    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
289    \textcolor{keywordtype}{size\_t} i;
290 
291    \textcolor{comment}{//Read ASN.1 tag}
292    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
293    \textcolor{comment}{//Failed to decode ASN.1 tag?}
294    \textcolor{keywordflow}{if}(error)
295       \textcolor{keywordflow}{return} error;
296 
297    \textcolor{comment}{//Enforce encoding, class and type}
298    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER});
299    \textcolor{comment}{//Invalid tag?}
300    \textcolor{keywordflow}{if}(error)
301       \textcolor{keywordflow}{return} error;
302 
303    \textcolor{comment}{//The contents shall consist of one or more octets}
304    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} < 1 || tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} > 4)
305       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
306 
307    \textcolor{comment}{//The contents octets shall be a two's complement binary}
308    \textcolor{comment}{//number equal to the integer value}
309    *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} = (tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[0] & 0x80) ? -1 : 0;
310 
311    \textcolor{comment}{//Process contents octets}
312    \textcolor{keywordflow}{for}(i = 0; i < tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}; i++)
313    \{
314       \textcolor{comment}{//Rotate left operation}
315       *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} <<= 8;
316       \textcolor{comment}{//Reconstruct integer value}
317       *\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} |= tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[i];
318    \}
319 
320    \textcolor{comment}{//ASN.1 tag successfully decoded}
321    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
322 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_aa73309637560abf8e42288890c19d641}\label{asn1_8c_aa73309637560abf8e42288890c19d641}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Mpi@{asn1\+Read\+Mpi}}
\index{asn1\+Read\+Mpi@{asn1\+Read\+Mpi}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Mpi()}{asn1ReadMpi()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Mpi (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{value }\end{DoxyParamCaption})}



Read a multiple-\/precision integer from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\mbox{\tt out}  & {\em value} & Integer value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 334 of file asn1.\+c.


\begin{DoxyCode}
336 \{
337 \textcolor{preprocessor}{#if (MPI\_SUPPORT == ENABLED)}
338    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
339 
340    \textcolor{comment}{//Read ASN.1 tag}
341    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
342    \textcolor{comment}{//Failed to decode ASN.1 tag?}
343    \textcolor{keywordflow}{if}(error)
344       \textcolor{keywordflow}{return} error;
345 
346    \textcolor{comment}{//Enforce encoding, class and type}
347    error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER});
348    \textcolor{comment}{//Invalid tag?}
349    \textcolor{keywordflow}{if}(error)
350       \textcolor{keywordflow}{return} error;
351 
352    \textcolor{comment}{//Negative integer?}
353    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} > 0 && (tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}[0] & 0x80) != 0)
354       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca92e7b26953f11d1bc4f4526fad39aed0}{ERROR\_INVALID\_SYNTAX};
355 
356    \textcolor{comment}{//Convert the octet string to a multiple precision integer}
357    error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(value, tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}, 
      \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa0912b5922ecee206ec51e40d5285f77e}{MPI\_FORMAT\_BIG\_ENDIAN});
358 
359    \textcolor{comment}{//Return status code}
360    \textcolor{keywordflow}{return} error;
361 \textcolor{preprocessor}{#else}
362    \textcolor{comment}{//Not implemented}
363    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
364 \textcolor{preprocessor}{#endif}
365 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a08b7995f0473e1ff62a9061f31410b2f}\label{asn1_8c_a08b7995f0473e1ff62a9061f31410b2f}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Octet\+String@{asn1\+Read\+Octet\+String}}
\index{asn1\+Read\+Octet\+String@{asn1\+Read\+Octet\+String}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Octet\+String()}{asn1ReadOctetString()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Octet\+String (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag }\end{DoxyParamCaption})}



Read an octet string from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 190 of file asn1.\+c.


\begin{DoxyCode}
191 \{
192    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
193 
194    \textcolor{comment}{//Read ASN.1 tag}
195    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
196 
197    \textcolor{comment}{//Check status code}
198    \textcolor{keywordflow}{if}(!error)
199    \{
200       \textcolor{comment}{//Enforce encoding, class and type}
201       error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL},
202          \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfacdfe5b0b233bce2f5388d3693bf7b602}{ASN1\_TYPE\_OCTET\_STRING});
203    \}
204 
205    \textcolor{comment}{//Return status code}
206    \textcolor{keywordflow}{return} error;
207 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a842c029a80fcf3c0c1a2a8bf1ba2d96c}\label{asn1_8c_a842c029a80fcf3c0c1a2a8bf1ba2d96c}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Oid@{asn1\+Read\+Oid}}
\index{asn1\+Read\+Oid@{asn1\+Read\+Oid}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Oid()}{asn1ReadOid()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Oid (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag }\end{DoxyParamCaption})}



Read an object identifier from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 218 of file asn1.\+c.


\begin{DoxyCode}
219 \{
220    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
221 
222    \textcolor{comment}{//Read ASN.1 tag}
223    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
224 
225    \textcolor{comment}{//Check status code}
226    \textcolor{keywordflow}{if}(!error)
227    \{
228       \textcolor{comment}{//Enforce encoding, class and type}
229       error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL},
230          \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfa586ebdd8b160ea2185cff78381dfe4b0}{ASN1\_TYPE\_OBJECT\_IDENTIFIER});
231    \}
232 
233    \textcolor{comment}{//Return status code}
234    \textcolor{keywordflow}{return} error;
235 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a5df4a5a14b22837b3dea3525608a9122}\label{asn1_8c_a5df4a5a14b22837b3dea3525608a9122}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Sequence@{asn1\+Read\+Sequence}}
\index{asn1\+Read\+Sequence@{asn1\+Read\+Sequence}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Sequence()}{asn1ReadSequence()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Sequence (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag }\end{DoxyParamCaption})}



Read an A\+S\+N.\+1 sequence from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 163 of file asn1.\+c.


\begin{DoxyCode}
164 \{
165    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
166 
167    \textcolor{comment}{//Read ASN.1 tag}
168    error = \hyperlink{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}{asn1ReadTag}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}, tag);
169 
170    \textcolor{comment}{//Check status code}
171    \textcolor{keywordflow}{if}(!error)
172    \{
173       \textcolor{comment}{//Enforce encoding, class and type}
174       error = \hyperlink{asn1_8c_a73fa06e5d71abe974aa6ad8fb53ecaa2}{asn1CheckTag}(tag, \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL}, 
      \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf6223adf2132054146cf838b14c593ea}{ASN1\_TYPE\_SEQUENCE});
175    \}
176 
177    \textcolor{comment}{//Return status code}
178    \textcolor{keywordflow}{return} error;
179 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}\label{asn1_8c_a1abd5e2bb0488ff85fb1d94392f80dc4}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Read\+Tag@{asn1\+Read\+Tag}}
\index{asn1\+Read\+Tag@{asn1\+Read\+Tag}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Read\+Tag()}{asn1ReadTag()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Read\+Tag (\begin{DoxyParamCaption}\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag }\end{DoxyParamCaption})}



Read an A\+S\+N.\+1 tag from the input stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & Input stream where to read the tag \\
\hline
\mbox{\tt in}  & {\em length} & Number of bytes available in the input stream \\
\hline
\mbox{\tt out}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 52 of file asn1.\+c.


\begin{DoxyCode}
53 \{
54    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
55    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
56 
57    \textcolor{comment}{//Make sure the identifier octet is present}
58    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} == 0)
59       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
60 
61    \textcolor{comment}{//Save the class of the ASN.1 tag}
62    tag->\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] & \hyperlink{asn1_8h_a3cbaaf76e31a93d527889e750b735772}{ASN1\_CLASS\_MASK};
63    \textcolor{comment}{//Primitive or constructed encoding?}
64    tag->\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = (\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] & \hyperlink{asn1_8h_a333f7702ca4c67a7bb95c03bbe3d55c0}{ASN1\_ENCODING\_CONSTRUCTED}) ? 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} : \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
65 
66    \textcolor{comment}{//Check the tag number}
67    \textcolor{keywordflow}{if}((\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] & \hyperlink{asn1_8h_a7aa147efdcd5b769739472d91d26dafb}{ASN1\_TAG\_NUMBER\_MASK}) < 31)
68    \{
69       \textcolor{comment}{//Tag number is in the range 0 to 30}
70       tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] & \hyperlink{asn1_8h_a7aa147efdcd5b769739472d91d26dafb}{ASN1\_TAG\_NUMBER\_MASK};
71       \textcolor{comment}{//Point to the tag length field}
72       i = 1;
73    \}
74    \textcolor{keywordflow}{else}
75    \{
76       \textcolor{comment}{//If the tag number is greater than or equal to 31,}
77       \textcolor{comment}{//the subsequent octets will encode the tag number}
78       tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = 0;
79 
80       \textcolor{comment}{//Decode the tag number}
81       \textcolor{keywordflow}{for}(i = 1; ; i++)
82       \{
83          \textcolor{comment}{//The field cannot exceed 5 bytes}
84          \textcolor{keywordflow}{if}(i > (\textcolor{keyword}{sizeof}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType}) + 1))
85             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
86          \textcolor{comment}{//Insufficient number of bytes to decode the tag number?}
87          \textcolor{keywordflow}{if}(!(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i))
88             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
89 
90          \textcolor{comment}{//Update the tag number with bits 7 to 1}
91          tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = (tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} << 7) | (\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] & 0x7F);
92 
93          \textcolor{comment}{//Bit 8 shall be set unless it is the last octet}
94          \textcolor{keywordflow}{if}(!(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] & 0x80))
95             \textcolor{keywordflow}{break};
96       \}
97       \textcolor{comment}{//Point to the tag length field}
98       i++;
99    \}
100 
101    \textcolor{comment}{//Insufficient number of bytes to decode the tag length?}
102    \textcolor{keywordflow}{if}(!(\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i))
103       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
104 
105    \textcolor{comment}{//Short form is used?}
106    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] < 128)
107    \{
108       \textcolor{comment}{//Bits 7 to 1 encode the number of bytes in the contents}
109       tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i];
110       \textcolor{comment}{//Point to the contents of the tag}
111       i++;
112    \}
113    \textcolor{comment}{//Long form is used?}
114    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] > 128 && \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] < 255)
115    \{
116       \textcolor{comment}{//Bits 7 to 1 encode the number of octets in the length field}
117       n = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i] & 0x7F;
118 
119       \textcolor{comment}{//The field cannot exceed 4 bytes}
120       \textcolor{keywordflow}{if}(n > \textcolor{keyword}{sizeof}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length}))
121          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
122       \textcolor{comment}{//Insufficient number of bytes to decode the tag length?}
123       \textcolor{keywordflow}{if}((\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i) < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n})
124          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
125 
126       \textcolor{comment}{//Clear the tag length}
127       tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = 0;
128 
129       \textcolor{comment}{//Read the subsequent octets}
130       \textcolor{keywordflow}{for}(i++; n > 0; n--)
131       \{
132          tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = (tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} << 8) | \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[i++];
133       \}
134    \}
135    \textcolor{comment}{//Indefinite form is used?}
136    \textcolor{keywordflow}{else}
137    \{
138       \textcolor{comment}{//Indefinite form is not supported}
139       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
140    \}
141 
142    \textcolor{comment}{//Save the pointer to the tag contents}
143    tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + i;
144    \textcolor{comment}{//Check the length of tag}
145    \textcolor{keywordflow}{if}((\hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - i) < tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length})
146       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caf1442b36897b28194c3faa9d716ff808}{ERROR\_INVALID\_TAG};
147 
148    \textcolor{comment}{//Total length occupied by the ASN.1 tag in the input stream}
149    tag->\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength} = i + tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
150    \textcolor{comment}{//ASN.1 tag successfully decoded}
151    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
152 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}\label{asn1_8c_a150ad7208a84f75148cee37c949cc9d5}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Write\+Int32@{asn1\+Write\+Int32}}
\index{asn1\+Write\+Int32@{asn1\+Write\+Int32}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Write\+Int32()}{asn1WriteInt32()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Write\+Int32 (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\+\_\+t}}]{value,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{reverse,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Write a 32-\/bit integer to the output stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em value} & Integer value \\
\hline
\mbox{\tt in}  & {\em reverse} & Use reverse encoding \\
\hline
\mbox{\tt out}  & {\em data} & Output stream where to write the tag (optional parameter) \\
\hline
\mbox{\tt out}  & {\em written} & Number of bytes written to the output stream \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 516 of file asn1.\+c.


\begin{DoxyCode}
518 \{
519    \textcolor{keywordtype}{size\_t} i;
520    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
521    \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} msb;
522 
523    \textcolor{comment}{//An integer value is always encoded in the smallest possible number of}
524    \textcolor{comment}{//octets}
525    \textcolor{keywordflow}{for}(n = 4; n > 1; n--)
526    \{
527       \textcolor{comment}{//Retrieve the upper 9 bits}
528       msb = (\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} >> (n * 8 - 9)) & 0x01FF;
529 
530       \textcolor{comment}{//The upper 9 bits shall not have the same value (all 0 or all 1)}
531       \textcolor{keywordflow}{if}(msb != 0x0000 && msb != 0x01FF)
532          \textcolor{keywordflow}{break};
533    \}
534 
535    \textcolor{comment}{//Valid output stream?}
536    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
537    \{
538       \textcolor{comment}{//Use reverse encoding?}
539       \textcolor{keywordflow}{if}(reverse)
540          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} -= n + 2;
541 
542       \textcolor{comment}{//Write tag type}
543       \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL} | \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER};
544       \textcolor{comment}{//Write tag length}
545       \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[1] = n & 0xFF;
546 
547       \textcolor{comment}{//Write contents octets}
548       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
549       \{
550          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[1 + n - i] = (\hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value} >> (i * 8)) & 0xFF;
551       \}
552    \}
553 
554    \textcolor{comment}{//Number of bytes written to the output stream}
555    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
556       *written = n + 2;
557 
558    \textcolor{comment}{//Successful processing}
559    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
560 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a2232296cd470abd4077f4e61f102473f}\label{asn1_8c_a2232296cd470abd4077f4e61f102473f}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Write\+Mpi@{asn1\+Write\+Mpi}}
\index{asn1\+Write\+Mpi@{asn1\+Write\+Mpi}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Write\+Mpi()}{asn1WriteMpi()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Write\+Mpi (\begin{DoxyParamCaption}\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{value,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{reverse,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Write a multiple-\/precision integer from the output stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em value} & Integer value \\
\hline
\mbox{\tt in}  & {\em reverse} & Use reverse encoding \\
\hline
\mbox{\tt out}  & {\em data} & Output stream where to write the tag (optional parameter) \\
\hline
\mbox{\tt out}  & {\em written} & Number of bytes written to the output stream \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 572 of file asn1.\+c.


\begin{DoxyCode}
574 \{
575 \textcolor{preprocessor}{#if (MPI\_SUPPORT == ENABLED)}
576    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
577    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
578    \hyperlink{structAsn1Tag}{Asn1Tag} tag;
579 
580    \textcolor{comment}{//Retrieve the length of the multiple precision integer}
581    n = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(value);
582 
583    \textcolor{comment}{//An integer value is always encoded in the smallest possible number of}
584    \textcolor{comment}{//octets}
585    n = (n / 8) + 1;
586 
587    \textcolor{comment}{//Valid output stream?}
588    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
589    \{
590       \textcolor{comment}{//Use reverse encoding?}
591       \textcolor{keywordflow}{if}(reverse)
592          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
593 
594       \textcolor{comment}{//The value of the multiple precision integer is encoded MSB first}
595       error = \hyperlink{mpi_8c_aad846b0b5a3560243e1bf8601ad1b6a5}{mpiExport}(value, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, n, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa0912b5922ecee206ec51e40d5285f77e}{MPI\_FORMAT\_BIG\_ENDIAN});
596       \textcolor{comment}{//Any error to report?}
597       \textcolor{keywordflow}{if}(error)
598          \textcolor{keywordflow}{return} error;
599    \}
600 
601    \textcolor{comment}{//The integer is encapsulated within an ASN.1 structure}
602    tag.\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
603    tag.\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass} = \hyperlink{asn1_8h_ab3589ac11c049bfda069aa3ecf683578}{ASN1\_CLASS\_UNIVERSAL};
604    tag.\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} = \hyperlink{asn1_8h_a1b0f39cb3d87e425703ba389df9da1dfaf49fe8465a80ebfbe92fe0f0622ec994}{ASN1\_TYPE\_INTEGER};
605    tag.\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
606    tag.\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} = \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data};
607 
608    \textcolor{comment}{//Compute the length of the corresponding ASN.1 structure}
609    error = \hyperlink{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}{asn1WriteTag}(&tag, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
610    \textcolor{comment}{//Any error to report?}
611    \textcolor{keywordflow}{if}(error)
612       \textcolor{keywordflow}{return} error;
613 
614    \textcolor{comment}{//Number of bytes written to the output stream}
615    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
616       *written = tag.\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength};
617 
618    \textcolor{comment}{//Successful processing}
619    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
620 \textcolor{preprocessor}{#else}
621    \textcolor{comment}{//Not implemented}
622    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
623 \textcolor{preprocessor}{#endif}
624 \}
\end{DoxyCode}
\mbox{\Hypertarget{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}\label{asn1_8c_a246f5e4192e8f064bd28d519a89d0207}} 
\index{asn1.\+c@{asn1.\+c}!asn1\+Write\+Tag@{asn1\+Write\+Tag}}
\index{asn1\+Write\+Tag@{asn1\+Write\+Tag}!asn1.\+c@{asn1.\+c}}
\subsubsection{\texorpdfstring{asn1\+Write\+Tag()}{asn1WriteTag()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} asn1\+Write\+Tag (\begin{DoxyParamCaption}\item[{\hyperlink{structAsn1Tag}{Asn1\+Tag} $\ast$}]{tag,  }\item[{\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t}}]{reverse,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{data,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Write an A\+S\+N.\+1 tag. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em tag} & Structure describing the A\+S\+N.\+1 tag \\
\hline
\mbox{\tt in}  & {\em reverse} & Use reverse encoding \\
\hline
\mbox{\tt out}  & {\em data} & Output stream where to write the tag (optional parameter) \\
\hline
\mbox{\tt out}  & {\em written} & Number of bytes written to the output stream (optional parameter) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 377 of file asn1.\+c.


\begin{DoxyCode}
379 \{
380    \textcolor{keywordtype}{size\_t} i;
381    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
382    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
383 
384    \textcolor{comment}{//Compute the number of octets that are necessary to encode the tag number}
385    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 31)
386       m = 0;
387    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 128)
388       m = 1;
389    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 16384)
390       m = 2;
391    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 2097152)
392       m = 3;
393    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} < 268435456)
394       m = 4;
395    \textcolor{keywordflow}{else}
396       m = 5;
397 
398    \textcolor{comment}{//Compute the number of octets that are necessary to encode the length field}
399    \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} < 128)
400       n = 0;
401    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} < 256)
402       n = 1;
403    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} < 65536)
404       n = 2;
405    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} < 16777216)
406       n = 3;
407    \textcolor{keywordflow}{else}
408       n = 4;
409 
410    \textcolor{comment}{//Valid output stream?}
411    \textcolor{keywordflow}{if}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
412    \{
413       \textcolor{comment}{//Use reverse encoding?}
414       \textcolor{keywordflow}{if}(reverse)
415       \{
416          \textcolor{comment}{//Any data to copy?}
417          \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} > 0)
418          \{
419             \textcolor{comment}{//Make room for the data}
420             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} -= tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
421             \textcolor{comment}{//Copy data}
422             \hyperlink{cyclone__crypto_2core_2crypto_8h_ad9bc988e3454b747101a8163dfdc1618}{cryptoMemmove}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}, tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
423          \}
424 
425          \textcolor{comment}{//Move backward}
426          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} -= m + n + 2;
427       \}
428       \textcolor{keywordflow}{else}
429       \{
430          \textcolor{comment}{//Any data to copy?}
431          \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} > 0)
432          \{
433             \textcolor{comment}{//Copy data}
434             \hyperlink{cyclone__crypto_2core_2crypto_8h_ad9bc988e3454b747101a8163dfdc1618}{cryptoMemmove}(\hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + m + n + 2, tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value}, tag->
      \hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length});
435          \}
436       \}
437 
438       \textcolor{comment}{//Save the class of the ASN.1 tag}
439       \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] = tag->\hyperlink{structAsn1Tag_a9f35c291ffa22d903d9c66638bb225ea}{objClass};
440 
441       \textcolor{comment}{//Primitive or constructed encoding?}
442       \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a93c64e611d57dfb59e6ebafe938f28c1}{constructed})
443          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] |= \hyperlink{asn1_8h_a333f7702ca4c67a7bb95c03bbe3d55c0}{ASN1\_ENCODING\_CONSTRUCTED};
444 
445       \textcolor{comment}{//Encode the tag number}
446       \textcolor{keywordflow}{if}(m == 0)
447       \{
448          \textcolor{comment}{//Tag number is in the range 0 to 30}
449          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] |= tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType};
450       \}
451       \textcolor{keywordflow}{else}
452       \{
453          \textcolor{comment}{//The tag number is greater than or equal to 31}
454          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[0] |= \hyperlink{asn1_8h_a7aa147efdcd5b769739472d91d26dafb}{ASN1\_TAG\_NUMBER\_MASK};
455 
456          \textcolor{comment}{//The subsequent octets will encode the tag number}
457          \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}; i++)
458          \{
459             \textcolor{comment}{//Bits 7 to 1 encode the tag number}
460             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[m - i] = (tag->\hyperlink{structAsn1Tag_a3ecdc4bbf328b5216521cb2114f45935}{objType} >> (i * 7)) & 0x7F;
461 
462             \textcolor{comment}{//Bit 8 of each octet shall be set to one unless it is the}
463             \textcolor{comment}{//last octet of the identifier octets}
464             \textcolor{keywordflow}{if}(i != 0)
465                \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[m - i] |= 0x80;
466          \}
467       \}
468 
469       \textcolor{comment}{//Encode the length field}
470       \textcolor{keywordflow}{if}(n == 0)
471       \{
472          \textcolor{comment}{//Use short form encoding}
473          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[1 + \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}] = tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} & 0x7F;
474       \}
475       \textcolor{keywordflow}{else}
476       \{
477          \textcolor{comment}{//Bits 7 to 1 encode the number of octets in the length field}
478          \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[1 + \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m}] = 0x80 | (n & 0x7F);
479 
480          \textcolor{comment}{//The subsequent octets will encode the length field}
481          \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}; i++)
482          \{
483             \hyperlink{dtls__misc_8h_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data}[1 + m + n - i] = (tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} >> (i * 8)) & 0xFF;
484          \}
485       \}
486    \}
487 
488    \textcolor{comment}{//Total length occupied by the ASN.1 tag}
489    tag->\hyperlink{structAsn1Tag_a27df45a2d65de5a2a1289a64e43149bf}{totalLength} = tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length} + m + n + 2;
490 
491    \textcolor{comment}{//The last parameter is optional}
492    \textcolor{keywordflow}{if}(written != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
493    \{
494       \textcolor{comment}{//Number of bytes written to the output stream}
495       *written = m + n + 2;
496 
497       \textcolor{comment}{//Any data copied?}
498       \textcolor{keywordflow}{if}(tag->\hyperlink{structAsn1Tag_a90f3832fa59c62feb4fb8be9d8b11b29}{value} != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
499          *written += tag->\hyperlink{structAsn1Tag_a5131e751817ae2cbfdaf031c2ce97f3d}{length};
500    \}
501 
502    \textcolor{comment}{//Successful processing}
503    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
504 \}
\end{DoxyCode}
