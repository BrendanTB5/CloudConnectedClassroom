\hypertarget{snmp__agent__pdu_8h}{}\section{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+pdu.h File Reference}
\label{snmp__agent__pdu_8h}\index{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+pdu.\+h@{cyclone\+\_\+tcp/snmp/snmp\+\_\+agent\+\_\+pdu.\+h}}


S\+N\+MP agent (P\+DU processing)  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}snmp/snmp\+\_\+agent.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__pdu_8h_a06e8ee51730d690fa823f52a33531093}{snmp\+Process\+Pdu} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Process P\+DU. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__pdu_8h_a3a0d922fc849515908837e6b8944f089}{snmp\+Process\+Get\+Request\+Pdu} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Process Get\+Request-\/\+P\+DU or Get\+Next\+Request-\/\+P\+DU. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__pdu_8h_aeb64b1a444d164946558e7f40bdd9f66}{snmp\+Process\+Get\+Bulk\+Request\+Pdu} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Process Get\+Bulk\+Request-\/\+P\+DU. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__pdu_8h_aa1ffa9d829759350be71d3d4b8364e37}{snmp\+Process\+Set\+Request\+Pdu} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Process Set\+Request-\/\+P\+DU. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{snmp__agent__pdu_8h_aedc6c41f8217dc9f61809e09f4b99d62}{snmp\+Format\+Report\+Pdu} (\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$context, \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} error\+Indication)
\begin{DoxyCompactList}\small\item\em Format Report-\/\+P\+DU. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+N\+MP agent (P\+DU processing) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{snmp__agent__pdu_8h_aedc6c41f8217dc9f61809e09f4b99d62}\label{snmp__agent__pdu_8h_aedc6c41f8217dc9f61809e09f4b99d62}} 
\index{snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}!snmp\+Format\+Report\+Pdu@{snmp\+Format\+Report\+Pdu}}
\index{snmp\+Format\+Report\+Pdu@{snmp\+Format\+Report\+Pdu}!snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}}
\subsubsection{\texorpdfstring{snmp\+Format\+Report\+Pdu()}{snmpFormatReportPdu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Format\+Report\+Pdu (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context,  }\item[{\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t}}]{error\+Indication }\end{DoxyParamCaption})}



Format Report-\/\+P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\mbox{\tt in}  & {\em error\+Indication} & Error indication \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 702 of file snmp\+\_\+agent\+\_\+pdu.\+c.


\begin{DoxyCode}
703 \{
704    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
705 
706 \textcolor{preprocessor}{#if (SNMP\_V3\_SUPPORT == ENABLED)}
707    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
708    \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} counter;
709    \hyperlink{structSnmpVarBind}{SnmpVarBind} var;
710 
711    \textcolor{comment}{//Initialize SNMP message}
712    \hyperlink{snmp__agent__message_8c_a0371fc59a7828dbd4b15565d83078837}{snmpInitMessage}(&context->response);
713 
714    \textcolor{comment}{//SNMP version identifier}
715    context->response.version = context->request.version;
716 
717    \textcolor{comment}{//Message identifier}
718    context->response.msgId = context->request.msgId;
719    \textcolor{comment}{//Maximum message size supported by the sender}
720    context->response.msgMaxSize = \hyperlink{snmp__common_8h_af5a22cbaa4973c106e664d5d01316fae}{SNMP\_MAX\_MSG\_SIZE};
721    \textcolor{comment}{//Bit fields which control processing of the message}
722    context->response.msgFlags = 0;
723    \textcolor{comment}{//Security model used by the sender}
724    context->response.msgSecurityModel = \hyperlink{snmp__agent__usm_8h_a59354ab45890b9da1b27d44f88193695a21c6309103699e29211c87fd78c79521}{SNMP\_SECURITY\_MODEL\_USM};
725 
726    \textcolor{comment}{//Authoritative engine identifier}
727    context->response.msgAuthEngineId = context->contextEngine;
728    context->response.msgAuthEngineIdLen = context->contextEngineLen;
729 
730    \textcolor{comment}{//Number of times the SNMP engine has rebooted}
731    context->response.msgAuthEngineBoots = context->engineBoots;
732    \textcolor{comment}{//Number of seconds since last reboot}
733    context->response.msgAuthEngineTime = context->engineTime;
734 
735    \textcolor{comment}{//Context engine identifier}
736    context->response.contextEngineId = context->contextEngine;
737    context->response.contextEngineIdLen = context->contextEngineLen;
738 
739    \textcolor{comment}{//Context name}
740    context->response.contextName = context->contextName;
741    context->response.contextNameLen = strlen(context->contextName);
742 
743    \textcolor{comment}{//PDU type}
744    context->response.pduType = \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aaae8744a84989fc7505be8d6a41914943}{SNMP\_PDU\_REPORT};
745    \textcolor{comment}{//Request identifier}
746    context->response.requestId = context->request.requestId;
747 
748    \textcolor{comment}{//If the message is considered to be outside of the time window, the error}
749    \textcolor{comment}{//must be reported with a securityLevel of authNoPriv (refer to RFC 3414,}
750    \textcolor{comment}{//section 3.2)}
751    \textcolor{keywordflow}{if}(errorIndication == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5a869df5965a4b8665581bb828471f02}{ERROR\_NOT\_IN\_TIME\_WINDOW})
752    \{
753       \textcolor{comment}{//Bit fields which control processing of the message}
754       context->response.msgFlags = context->request.msgFlags &
755          (\hyperlink{snmp__agent__usm_8h_aee33010d6b1b02fc5ceef6aad55044b0a8b9b4731d377864f4e13821af7cd3329}{SNMP\_MSG\_FLAG\_AUTH} | \hyperlink{snmp__agent__usm_8h_aee33010d6b1b02fc5ceef6aad55044b0a09a0d3b1da3227488bf9ccc2cc8a48e2}{SNMP\_MSG\_FLAG\_PRIV});
756 
757       \textcolor{comment}{//User name}
758       context->response.msgUserName = context->request.msgUserName;
759       context->response.msgUserNameLen = context->request.msgUserNameLen;
760 
761       \textcolor{comment}{//Authentication parameters}
762       context->response.msgAuthParameters = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
763       context->response.msgAuthParametersLen = context->request.msgAuthParametersLen;
764 
765       \textcolor{comment}{//Privacy parameters}
766       context->response.msgPrivParameters = context->privParameters;
767       context->response.msgPrivParametersLen = context->request.msgPrivParametersLen;
768    \}
769 
770    \textcolor{comment}{//Make room for the message header at the beginning of the buffer}
771    error = \hyperlink{snmp__agent__message_8c_a804b9d2437d32dbc6c85f1b7769e727d}{snmpComputeMessageOverhead}(&context->response);
772    \textcolor{comment}{//Any error to report?}
773    \textcolor{keywordflow}{if}(error)
774       \textcolor{keywordflow}{return} error;
775 
776    \textcolor{comment}{//Initialize counter value}
777    counter = 1;
778 
779    \textcolor{comment}{//Check error indication}
780    \textcolor{keywordflow}{switch}(errorIndication)
781    \{
782    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6c9048c086c34674d0a711081c88c96a}{ERROR\_UNSUPPORTED\_SECURITY\_LEVEL}:
783       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
784       \textcolor{comment}{//because they requested a securityLevel that was unknown to the SNMP}
785       \textcolor{comment}{//engine or otherwise unavailable}
786       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsUnsupportedSecLevels , 1);
787       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsUnsupportedSecLevels);
788 
789       \textcolor{comment}{//Add the usmStatsUnsupportedSecLevels counter in the varBindList}
790       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_a5d76db11e21399c72fd61262f5e6e612}{usmStatsUnsupportedSecLevelsObject};
791       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_a5d76db11e21399c72fd61262f5e6e612}{usmStatsUnsupportedSecLevelsObject});
792       \textcolor{keywordflow}{break};
793 
794    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca5a869df5965a4b8665581bb828471f02}{ERROR\_NOT\_IN\_TIME\_WINDOW}:
795       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
796       \textcolor{comment}{//because they appeared outside of the authoritative SNMP engine's window}
797       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsNotInTimeWindows , 1);
798       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsNotInTimeWindows);
799 
800       \textcolor{comment}{//Add the usmStatsNotInTimeWindows counter in the varBindList}
801       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_a6478c64a4ad158f78f425c05bdb04de2}{usmStatsNotInTimeWindowsObject};
802       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_a6478c64a4ad158f78f425c05bdb04de2}{usmStatsNotInTimeWindowsObject});
803       \textcolor{keywordflow}{break};
804 
805    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cadd2abf704c42af2698ebeccb4dd2bf85}{ERROR\_UNKNOWN\_USER\_NAME}:
806       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
807       \textcolor{comment}{//because they referenced a user that was not known to the SNMP engine}
808       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsUnknownUserNames , 1);
809       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsUnknownUserNames);
810 
811       \textcolor{comment}{//Add the usmStatsUnknownUserNames counter in the varBindList}
812       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_a28a41d2c18565ef5cf40dbaa5e722f9e}{usmStatsUnknownUserNamesObject};
813       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_a28a41d2c18565ef5cf40dbaa5e722f9e}{usmStatsUnknownUserNamesObject});
814       \textcolor{keywordflow}{break};
815 
816    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca308d5e2919a0cf0081bfc0e024a1bc4a}{ERROR\_UNKNOWN\_ENGINE\_ID}:
817       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
818       \textcolor{comment}{//because they referenced an snmpEngineID that was not known to the SNMP}
819       \textcolor{comment}{//engine}
820       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsUnknownEngineIDs , 1);
821       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsUnknownEngineIDs);
822 
823       \textcolor{comment}{//Add the usmStatsUnknownEngineIDs counter in the varBindList}
824       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_a951a44e648083d6ca8c598b66d2c9e95}{usmStatsUnknownEngineIdsObject};
825       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_a951a44e648083d6ca8c598b66d2c9e95}{usmStatsUnknownEngineIdsObject});
826       \textcolor{keywordflow}{break};
827 
828    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca87e6ef81b46229cb03ed0a27e7f45c6e}{ERROR\_AUTHENTICATION\_FAILED}:
829       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
830       \textcolor{comment}{//because they didn't contain the expected digest value}
831       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsWrongDigests , 1);
832       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsWrongDigests);
833 
834       \textcolor{comment}{//Add the usmStatsWrongDigests counter in the varBindList}
835       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_ae5a8d4dd03f5da308589c11989af6b71}{usmStatsWrongDigestsObject};
836       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_ae5a8d4dd03f5da308589c11989af6b71}{usmStatsWrongDigestsObject});
837       \textcolor{keywordflow}{break};
838 
839    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca42ac4eb97a02112d45b5f0405c0393c1}{ERROR\_DECRYPTION\_FAILED}:
840       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
841       \textcolor{comment}{//because they could not be decrypted}
842       \hyperlink{snmp__usm__mib__module_8h_afcac9d23df3afd920edcec11332a7ad0}{SNMP\_USM\_MIB\_INC\_COUNTER32}(usmStatsDecryptionErrors , 1);
843       \hyperlink{snmp__usm__mib__module_8h_a22483b079077a24d00441389f773569d}{SNMP\_USM\_MIB\_GET\_COUNTER32}(counter, usmStatsDecryptionErrors);
844 
845       \textcolor{comment}{//Add the usmStatsDecryptionErrors counter in the varBindList}
846       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__usm_8c_ab7cb3fcbc10139e322fd5764fc476b83}{usmStatsDecryptionErrorsObject};
847       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__usm_8c_ab7cb3fcbc10139e322fd5764fc476b83}{usmStatsDecryptionErrorsObject});
848       \textcolor{keywordflow}{break};
849 
850    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca482602f6e1c8673549b5ef13cc5cee61}{ERROR\_UNAVAILABLE\_CONTEXT}:
851       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
852       \textcolor{comment}{//because the context contained in the message was unavailable}
853       counter = 1;
854 
855       \textcolor{comment}{//Add the snmpUnavailableContexts counter in the varBindList}
856       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__pdu_8c_a4b5d8cab197b7fc0998bdd54f7dd4a35}{snmpUnavailableContextsObject};
857       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__pdu_8c_a4b5d8cab197b7fc0998bdd54f7dd4a35}{snmpUnavailableContextsObject});
858       \textcolor{keywordflow}{break};
859 
860    \textcolor{keywordflow}{case} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca487819dd3b521f88c597e47c4d6c1255}{ERROR\_UNKNOWN\_CONTEXT}:
861       \textcolor{comment}{//Total number of packets received by the SNMP engine which were dropped}
862       \textcolor{comment}{//because the context contained in the message was unknown}
863       counter = 1;
864 
865       \textcolor{comment}{//Add the snmpUnknownContexts counter in the varBindList}
866       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{snmp__agent__pdu_8c_ae843aac1e273e0d8f4c4f0d2ad463ea1}{snmpUnknownContextsObject};
867       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = \textcolor{keyword}{sizeof}(\hyperlink{snmp__agent__pdu_8c_ae843aac1e273e0d8f4c4f0d2ad463ea1}{snmpUnknownContextsObject});
868       \textcolor{keywordflow}{break};
869 
870    \textcolor{keywordflow}{default}:
871       \textcolor{comment}{//Just for sanity's sake...}
872       var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
873       var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen} = 0;
874       \textcolor{keywordflow}{break};
875    \}
876 
877    \textcolor{comment}{//Encode the object value using ASN.1 rules}
878    error = \hyperlink{snmp__agent__message_8c_aac8a5ef4f5de9b431d0f768ab0973d8d}{snmpEncodeUnsignedInt32}(counter, context->response.buffer, &n);
879    \textcolor{comment}{//Any error to report?}
880    \textcolor{keywordflow}{if}(error)
881       \textcolor{keywordflow}{return} error;
882 
883    \textcolor{comment}{//The counter is encoded in ASN.1 format}
884    var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_a3e5b654afb75017df541bd2ce5dbf9cc}{ASN1\_CLASS\_APPLICATION};
885    var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{mib__common_8h_a990c41dc57823de6a945221194bdefffa2cdb81533548328e7c049535c88425d6}{MIB\_TYPE\_COUNTER32};
886    var.\hyperlink{structSnmpVarBind_aabc0d16bdeda309727b03a0ef6a5e02e}{value} = context->response.buffer;
887    var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
888 
889    \textcolor{comment}{//Append the variable binding list to the varBindList}
890    error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
891    \textcolor{comment}{//Any error to report?}
892    \textcolor{keywordflow}{if}(error)
893       \textcolor{keywordflow}{return} error;
894 
895    \textcolor{comment}{//Format PDU header}
896    error = \hyperlink{snmp__agent__message_8c_a8b5e6d1e43fef67326204bf6999d9b18}{snmpWritePduHeader}(&context->response);
897 \textcolor{preprocessor}{#else}
898    \textcolor{comment}{//SNMPv3 is not supported}
899    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
900 \textcolor{preprocessor}{#endif}
901 
902    \textcolor{comment}{//Return status code}
903    \textcolor{keywordflow}{return} error;
904 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__pdu_8h_aeb64b1a444d164946558e7f40bdd9f66}\label{snmp__agent__pdu_8h_aeb64b1a444d164946558e7f40bdd9f66}} 
\index{snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}!snmp\+Process\+Get\+Bulk\+Request\+Pdu@{snmp\+Process\+Get\+Bulk\+Request\+Pdu}}
\index{snmp\+Process\+Get\+Bulk\+Request\+Pdu@{snmp\+Process\+Get\+Bulk\+Request\+Pdu}!snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}}
\subsubsection{\texorpdfstring{snmp\+Process\+Get\+Bulk\+Request\+Pdu()}{snmpProcessGetBulkRequestPdu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Process\+Get\+Bulk\+Request\+Pdu (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Process Get\+Bulk\+Request-\/\+P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 360 of file snmp\+\_\+agent\+\_\+pdu.\+c.


\begin{DoxyCode}
361 \{
362 \textcolor{preprocessor}{#if (SNMP\_V2C\_SUPPORT == ENABLED || SNMP\_V3\_SUPPORT == ENABLED)}
363    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
364    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} index;
365    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
366    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
367    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
368    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} endOfMibView;
369    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
370    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ipv4__frag_8h_a31925c52841f891fabf5043c49d0306b}{next};
371    \hyperlink{structSnmpVarBind}{SnmpVarBind} var;
372 
373    \textcolor{comment}{//Debug message}
374    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Parsing GetBulkRequest-PDU...\(\backslash\)r\(\backslash\)n"});
375 
376    \textcolor{comment}{//Make sure the SNMP version identifier is valid}
377    \textcolor{keywordflow}{if}(context->request.version == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
378    \{
379       \textcolor{comment}{//The SNMP version is not acceptable}
380       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2daa3c161edaa4477d1ae954c2136008}{ERROR\_INVALID\_TYPE};
381    \}
382 
383    \textcolor{comment}{//Enforce access policy}
384    \textcolor{keywordflow}{if}(context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caa5f7f742a44c4431f1eb3082b0f460185}{SNMP\_ACCESS\_READ\_ONLY} &&
385       context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caace57b275f5ae1547ebcb27a6f5959548}{SNMP\_ACCESS\_READ\_WRITE})
386    \{
387       \textcolor{comment}{//Total number of SNMP messages delivered to the SNMP protocol entity}
388       \textcolor{comment}{//which represented an SNMP operation which was not allowed by the SNMP}
389       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
390       \hyperlink{snmp__mib__module_8h_a3cdbaaf290c386162780e68e496151b8}{SNMP\_MIB\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
391 
392       \textcolor{comment}{//Report an error}
393       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED};
394    \}
395 
396    \textcolor{comment}{//Initialize response message}
397    error = \hyperlink{snmp__agent__message_8c_ad2dc2a16291cb8620fce860e1fe3c606}{snmpInitResponse}(context);
398    \textcolor{comment}{//Any error to report?}
399    \textcolor{keywordflow}{if}(error)
400       \textcolor{keywordflow}{return} error;
401 
402    \textcolor{comment}{//Point to the first variable binding of the request}
403    p = context->request.varBindList;
404    length = context->request.varBindListLen;
405 
406    \textcolor{comment}{//Lock access to MIB bases}
407    \hyperlink{snmp__agent__misc_8c_a2e6a175c10dbd3b37ae367fb6b27e358}{snmpLockMib}(context);
408 
409    \textcolor{comment}{//Loop through the list}
410    \textcolor{keywordflow}{for}(index = 1; length > 0; index++)
411    \{
412       \textcolor{comment}{//The non-repeaters field specifies the number of non-repeating objects}
413       \textcolor{comment}{//at the start of the variable binding list}
414       \textcolor{keywordflow}{if}((index - 1) == context->request.nonRepeaters)
415       \{
416          \textcolor{comment}{//Pointer to the first variable binding that will be processed during}
417          \textcolor{comment}{//the next iteration}
418          next = context->response.varBindList + context->response.varBindListLen;
419 
420          \textcolor{comment}{//Actual size of the variable binding list}
421          m = context->response.varBindListLen;
422 
423          \textcolor{comment}{//This flag tells whether all variable bindings have the value field}
424          \textcolor{comment}{//set to endOfMibView for a given iteration}
425          endOfMibView = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
426 
427          \textcolor{comment}{//If the max-repetitions field is zero, the list is trimmed to the}
428          \textcolor{comment}{//first non-repeating variable bindings}
429          \textcolor{keywordflow}{if}(context->request.maxRepetitions == 0)
430             \textcolor{keywordflow}{break};
431       \}
432 
433       \textcolor{comment}{//Parse variable binding}
434       error = \hyperlink{snmp__agent__misc_8c_a6176abbf69180ffcfd2e3a733ec5cbbc}{snmpParseVarBinding}(p, length, &var, &n);
435       \textcolor{comment}{//Failed to parse variable binding?}
436       \textcolor{keywordflow}{if}(error)
437          \textcolor{keywordflow}{break};
438 
439       \textcolor{comment}{//Make sure that the object identifier is valid}
440       error = \hyperlink{oid_8c_a80ab34e995a15107af8975514a03efbb}{oidCheck}(var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen});
441       \textcolor{comment}{//Invalid object identifier?}
442       \textcolor{keywordflow}{if}(error)
443          \textcolor{keywordflow}{break};
444 
445       \textcolor{comment}{//Search the MIB for the next object}
446       error = \hyperlink{snmp__agent__object_8c_a01bc5ecdf62fb0da7ef4fd888e87adb6}{snmpGetNextObject}(context, &context->request, &var);
447 
448       \textcolor{comment}{//Check status code}
449       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
450       \{
451          \textcolor{comment}{//Next object found}
452          endOfMibView = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
453          \textcolor{comment}{//Retrieve object value}
454          error = \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmpGetObjectValue}(context, &context->request, &var);
455       \}
456       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND})
457       \{
458          \textcolor{comment}{//The variable binding's value field is set to endOfMibView}
459          var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
460          var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a3cbba34b46e0d3e02e5299202e77719e}{SNMP\_EXCEPTION\_END\_OF\_MIB\_VIEW};
461          var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
462 
463          \textcolor{comment}{//Catch exception}
464          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
465       \}
466       \textcolor{keywordflow}{else}
467       \{
468          \textcolor{comment}{//Stop immediately}
469          \textcolor{keywordflow}{break};
470       \}
471 
472       \textcolor{comment}{//Failed to retrieve object value?}
473       \textcolor{keywordflow}{if}(error)
474       \{
475          \textcolor{comment}{//Catch exception}
476          \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED} ||
477             error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND})
478          \{
479             \textcolor{comment}{//The variable binding's value field is set to noSuchObject}
480             var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
481             var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a1007af266662dcf706b93a34780a8d61}{SNMP\_EXCEPTION\_NO\_SUCH\_OBJECT};
482             var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
483          \}
484          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND})
485          \{
486             \textcolor{comment}{//The variable binding's value field is set to noSuchInstance}
487             var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
488             var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a994cc4457e1926184bf88d162186499c}{SNMP\_EXCEPTION\_NO\_SUCH\_INSTANCE};
489             var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
490          \}
491          \textcolor{keywordflow}{else}
492          \{
493             \textcolor{comment}{//Stop immediately}
494             \textcolor{keywordflow}{break};
495          \}
496       \}
497       \textcolor{keywordflow}{else}
498       \{
499          \textcolor{comment}{//Total number of MIB objects which have been retrieved successfully}
500          \textcolor{comment}{//by the SNMP protocol entity as the result of receiving valid SNMP}
501          \textcolor{comment}{//Get-Request and Get-NextRequest PDUs}
502          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInTotalReqVars, 1);
503       \}
504 
505       \textcolor{comment}{//Append variable binding to the list}
506       error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
507       \textcolor{comment}{//Any error to report?}
508       \textcolor{keywordflow}{if}(error)
509          \textcolor{keywordflow}{break};
510 
511       \textcolor{comment}{//Advance data pointer}
512       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
513       length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
514 
515       \textcolor{comment}{//Next iteration?}
516       \textcolor{keywordflow}{if}(length == 0 && index > context->request.nonRepeaters)
517       \{
518          \textcolor{comment}{//Decrement repeat counter}
519          context->request.maxRepetitions--;
520 
521          \textcolor{comment}{//Last iteration?}
522          \textcolor{keywordflow}{if}(!context->request.maxRepetitions)
523             \textcolor{keywordflow}{break};
524          \textcolor{comment}{//All variable bindings have the value field set to endOfMibView?}
525          \textcolor{keywordflow}{if}(endOfMibView)
526             \textcolor{keywordflow}{break};
527 
528          \textcolor{comment}{//Point to the first variable binding to be processed}
529          p = \hyperlink{ipv4__frag_8h_a31925c52841f891fabf5043c49d0306b}{next};
530          \textcolor{comment}{//Number of bytes to be processed}
531          length = context->response.varBindListLen - \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
532          \textcolor{comment}{//Rewind index}
533          index = context->request.nonRepeaters;
534       \}
535    \}
536 
537    \textcolor{comment}{//Unlock access to MIB bases}
538    \hyperlink{snmp__agent__misc_8c_ab3ae3b7de27641516fee3f8134c85c29}{snmpUnlockMib}(context);
539 
540    \textcolor{comment}{//Check status code}
541    \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf3f6e48b0cfaea7cac34f4223cd8a57}{ERROR\_BUFFER\_OVERFLOW})
542    \{
543       \textcolor{comment}{//If the size of the message containing the requested number of variable}
544       \textcolor{comment}{//bindings would be greater than the maximum message size, then the}
545       \textcolor{comment}{//response is generated with a lesser number of variable bindings}
546    \}
547    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error)
548    \{
549       \textcolor{comment}{//Set error-status and error-index fields}
550       error = \hyperlink{snmp__agent__misc_8c_a7a7f8079b21e592ba511a3edb5c11ad1}{snmpTranslateStatusCode}(&context->response, error, index);
551       \textcolor{comment}{//If the parsing of the request fails, the SNMP agent discards the message}
552       \textcolor{keywordflow}{if}(error)
553          \textcolor{keywordflow}{return} error;
554 
555       \textcolor{comment}{//The Response-PDU is re-formatted with the same values in its request-id}
556       \textcolor{comment}{//and variable-bindings fields as the received GetRequest-PDU}
557       error = \hyperlink{snmp__agent__misc_8c_ad3578ff92f6cf0c758700c34fca1ca5b}{snmpCopyVarBindingList}(context);
558       \textcolor{comment}{//Any error to report?}
559       \textcolor{keywordflow}{if}(error)
560          \textcolor{keywordflow}{return} error;
561    \}
562 
563    \textcolor{comment}{//Successful processing}
564    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
565 \textcolor{preprocessor}{#else}
566    \textcolor{comment}{//Not implemented}
567    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
568 \textcolor{preprocessor}{#endif}
569 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__pdu_8h_a3a0d922fc849515908837e6b8944f089}\label{snmp__agent__pdu_8h_a3a0d922fc849515908837e6b8944f089}} 
\index{snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}!snmp\+Process\+Get\+Request\+Pdu@{snmp\+Process\+Get\+Request\+Pdu}}
\index{snmp\+Process\+Get\+Request\+Pdu@{snmp\+Process\+Get\+Request\+Pdu}!snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}}
\subsubsection{\texorpdfstring{snmp\+Process\+Get\+Request\+Pdu()}{snmpProcessGetRequestPdu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Process\+Get\+Request\+Pdu (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Process Get\+Request-\/\+P\+DU or Get\+Next\+Request-\/\+P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 139 of file snmp\+\_\+agent\+\_\+pdu.\+c.


\begin{DoxyCode}
140 \{
141    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
142    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} index;
143    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
144    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
145    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
146    \hyperlink{structSnmpVarBind}{SnmpVarBind} var;
147 
148    \textcolor{comment}{//Check PDU type}
149    \textcolor{keywordflow}{if}(context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa2c6d80868e156130b005e1d303f1672a}{SNMP\_PDU\_GET\_REQUEST})
150    \{
151       \textcolor{comment}{//Debug message}
152       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Parsing GetRequest-PDU...\(\backslash\)r\(\backslash\)n"});
153 
154       \textcolor{comment}{//Total number of SNMP Get-Request PDUs which have been accepted and}
155       \textcolor{comment}{//processed by the SNMP protocol entity}
156       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInGetRequests, 1);
157    \}
158    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa7328c19405381fe928ea69ef52ddb5c7}{SNMP\_PDU\_GET\_NEXT\_REQUEST})
159    \{
160       \textcolor{comment}{//Debug message}
161       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Parsing GetNextRequest-PDU...\(\backslash\)r\(\backslash\)n"});
162 
163       \textcolor{comment}{//Total number of SNMP Get-NextRequest PDUs which have been accepted}
164       \textcolor{comment}{//and processed by the SNMP protocol entity}
165       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInGetNexts, 1);
166    \}
167 
168    \textcolor{comment}{//Enforce access policy}
169    \textcolor{keywordflow}{if}(context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caa5f7f742a44c4431f1eb3082b0f460185}{SNMP\_ACCESS\_READ\_ONLY} &&
170       context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caace57b275f5ae1547ebcb27a6f5959548}{SNMP\_ACCESS\_READ\_WRITE})
171    \{
172       \textcolor{comment}{//Total number of SNMP messages delivered to the SNMP protocol entity}
173       \textcolor{comment}{//which represented an SNMP operation which was not allowed by the SNMP}
174       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
175       \hyperlink{snmp__mib__module_8h_a3cdbaaf290c386162780e68e496151b8}{SNMP\_MIB\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
176 
177       \textcolor{comment}{//Report an error}
178       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED};
179    \}
180 
181    \textcolor{comment}{//Initialize response message}
182    error = \hyperlink{snmp__agent__message_8c_ad2dc2a16291cb8620fce860e1fe3c606}{snmpInitResponse}(context);
183    \textcolor{comment}{//Any error to report?}
184    \textcolor{keywordflow}{if}(error)
185       \textcolor{keywordflow}{return} error;
186 
187    \textcolor{comment}{//Point to the first variable binding of the request}
188    p = context->request.varBindList;
189    length = context->request.varBindListLen;
190 
191    \textcolor{comment}{//Lock access to MIB bases}
192    \hyperlink{snmp__agent__misc_8c_a2e6a175c10dbd3b37ae367fb6b27e358}{snmpLockMib}(context);
193 
194    \textcolor{comment}{//Loop through the list}
195    \textcolor{keywordflow}{for}(index = 1; length > 0; index++)
196    \{
197       \textcolor{comment}{//Parse variable binding}
198       error = \hyperlink{snmp__agent__misc_8c_a6176abbf69180ffcfd2e3a733ec5cbbc}{snmpParseVarBinding}(p, length, &var, &n);
199       \textcolor{comment}{//Failed to parse variable binding?}
200       \textcolor{keywordflow}{if}(error)
201          \textcolor{keywordflow}{break};
202 
203       \textcolor{comment}{//Make sure that the object identifier is valid}
204       error = \hyperlink{oid_8c_a80ab34e995a15107af8975514a03efbb}{oidCheck}(var.\hyperlink{structSnmpVarBind_a04320e45559a3eb7c9855714f5b513cf}{oid}, var.\hyperlink{structSnmpVarBind_a503daac7f1d394bfcdba2d5edadfe65e}{oidLen});
205       \textcolor{comment}{//Invalid object identifier?}
206       \textcolor{keywordflow}{if}(error)
207          \textcolor{keywordflow}{break};
208 
209       \textcolor{comment}{//GetRequest-PDU?}
210       \textcolor{keywordflow}{if}(context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa2c6d80868e156130b005e1d303f1672a}{SNMP\_PDU\_GET\_REQUEST})
211       \{
212          \textcolor{comment}{//Retrieve object value}
213          error = \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmpGetObjectValue}(context, &context->request, &var);
214       \}
215       \textcolor{comment}{//GetNextRequest-PDU?}
216       \textcolor{keywordflow}{else}
217       \{
218          \textcolor{comment}{//Search the MIB for the next object}
219          error = \hyperlink{snmp__agent__object_8c_a01bc5ecdf62fb0da7ef4fd888e87adb6}{snmpGetNextObject}(context, &context->request, &var);
220 
221          \textcolor{comment}{//SNMPv1 version?}
222          \textcolor{keywordflow}{if}(context->request.version == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
223          \{
224             \textcolor{comment}{//Check status code}
225             \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
226             \{
227                \textcolor{comment}{//Retrieve object value}
228                error = \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmpGetObjectValue}(context, &context->request, &var);
229             \}
230             \textcolor{keywordflow}{else}
231             \{
232                \textcolor{comment}{//Stop immediately}
233                \textcolor{keywordflow}{break};
234             \}
235          \}
236          \textcolor{comment}{//SNMPv2c or SNMPv3 version?}
237          \textcolor{keywordflow}{else}
238          \{
239             \textcolor{comment}{//Check status code}
240             \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
241             \{
242                \textcolor{comment}{//Retrieve object value}
243                error = \hyperlink{snmp__agent__object_8c_aa342e5839247ba853f266cfe7cde9669}{snmpGetObjectValue}(context, &context->request, &var);
244             \}
245             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND})
246             \{
247                \textcolor{comment}{//The variable binding's value field is set to endOfMibView}
248                var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
249                var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a3cbba34b46e0d3e02e5299202e77719e}{SNMP\_EXCEPTION\_END\_OF\_MIB\_VIEW};
250                var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
251 
252                \textcolor{comment}{//Catch exception}
253                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
254             \}
255             \textcolor{keywordflow}{else}
256             \{
257                \textcolor{comment}{//Stop immediately}
258                \textcolor{keywordflow}{break};
259             \}
260          \}
261       \}
262 
263       \textcolor{comment}{//Failed to retrieve object value?}
264       \textcolor{keywordflow}{if}(error)
265       \{
266          \textcolor{comment}{//SNMPv1 version?}
267          \textcolor{keywordflow}{if}(context->request.version == \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1})
268          \{
269             \textcolor{comment}{//Stop immediately}
270             \textcolor{keywordflow}{break};
271          \}
272          \textcolor{comment}{//SNMPv2c or SNMPv3 version?}
273          \textcolor{keywordflow}{else}
274          \{
275             \textcolor{comment}{//Catch exception}
276             \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED} ||
277                error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca7c3779a9c0fe7d65f66367f176dee6d7}{ERROR\_OBJECT\_NOT\_FOUND})
278             \{
279                \textcolor{comment}{//The variable binding's value field is set to noSuchObject}
280                var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
281                var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a1007af266662dcf706b93a34780a8d61}{SNMP\_EXCEPTION\_NO\_SUCH\_OBJECT};
282                var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
283             \}
284             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca805a80fe68633921ca43149789f4c3eb}{ERROR\_INSTANCE\_NOT\_FOUND})
285             \{
286                \textcolor{comment}{//The variable binding's value field is set to noSuchInstance}
287                var.\hyperlink{structSnmpVarBind_af6a7d27ceaf1a3856327bd6d9f191a7d}{objClass} = \hyperlink{asn1_8h_aed381d50c77b8c9f962b5359d6115c97}{ASN1\_CLASS\_CONTEXT\_SPECIFIC};
288                var.\hyperlink{structSnmpVarBind_afdac7f883345297a480ccc1f10f7fa59}{objType} = \hyperlink{snmp__common_8h_a6795bda1d3a86b37a9c807171f513110a994cc4457e1926184bf88d162186499c}{SNMP\_EXCEPTION\_NO\_SUCH\_INSTANCE};
289                var.\hyperlink{structSnmpVarBind_aaace175470aa86de3efbf635f0fcd06f}{valueLen} = 0;
290             \}
291             \textcolor{keywordflow}{else}
292             \{
293                \textcolor{comment}{//Stop immediately}
294                \textcolor{keywordflow}{break};
295             \}
296          \}
297       \}
298       \textcolor{keywordflow}{else}
299       \{
300          \textcolor{comment}{//Total number of MIB objects which have been retrieved successfully}
301          \textcolor{comment}{//by the SNMP protocol entity as the result of receiving valid SNMP}
302          \textcolor{comment}{//Get-Request and Get-NextRequest PDUs}
303          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInTotalReqVars, 1);
304       \}
305 
306       \textcolor{comment}{//Append variable binding to the list}
307       error = \hyperlink{snmp__agent__misc_8c_a6951ca3653200fad8d6f79300914698d}{snmpWriteVarBinding}(context, &var);
308       \textcolor{comment}{//Any error to report?}
309       \textcolor{keywordflow}{if}(error)
310          \textcolor{keywordflow}{break};
311 
312       \textcolor{comment}{//Advance data pointer}
313       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
314       length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
315    \}
316 
317    \textcolor{comment}{//Unlock access to MIB bases}
318    \hyperlink{snmp__agent__misc_8c_ab3ae3b7de27641516fee3f8134c85c29}{snmpUnlockMib}(context);
319 
320    \textcolor{comment}{//Check status code}
321    \textcolor{keywordflow}{if}(error)
322    \{
323       \textcolor{comment}{//Set error-status and error-index fields}
324       error = \hyperlink{snmp__agent__misc_8c_a7a7f8079b21e592ba511a3edb5c11ad1}{snmpTranslateStatusCode}(&context->response, error, index);
325       \textcolor{comment}{//If the parsing of the request fails, the SNMP agent discards the message}
326       \textcolor{keywordflow}{if}(error)
327          \textcolor{keywordflow}{return} error;
328 
329       \textcolor{comment}{//Check whether an alternate Response-PDU should be sent}
330       \textcolor{keywordflow}{if}(context->response.version != \hyperlink{snmp__common_8h_a80164b0cc3de6c48aad6917f79ee95dfa3dfaf92130ae745ea9945787a64458a7}{SNMP\_VERSION\_1} &&
331          context->response.errorStatus == \hyperlink{snmp__common_8h_afec1d446e343fe7cfe268cf4b7753fd2a0d9699d5036672a19b22b53666667909}{SNMP\_ERROR\_TOO\_BIG})
332       \{
333          \textcolor{comment}{//The alternate Response-PDU is formatted with the same value in its}
334          \textcolor{comment}{//request-id field as the received GetRequest-PDU and an empty}
335          \textcolor{comment}{//variable-bindings field}
336          context->response.varBindListLen = 0;
337       \}
338       \textcolor{keywordflow}{else}
339       \{
340          \textcolor{comment}{//The Response-PDU is re-formatted with the same values in its request-id}
341          \textcolor{comment}{//and variable-bindings fields as the received GetRequest-PDU}
342          error = \hyperlink{snmp__agent__misc_8c_ad3578ff92f6cf0c758700c34fca1ca5b}{snmpCopyVarBindingList}(context);
343          \textcolor{comment}{//Any error to report?}
344          \textcolor{keywordflow}{if}(error)
345             \textcolor{keywordflow}{return} error;
346       \}
347    \}
348 
349    \textcolor{comment}{//Successful processing}
350    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
351 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__pdu_8h_a06e8ee51730d690fa823f52a33531093}\label{snmp__agent__pdu_8h_a06e8ee51730d690fa823f52a33531093}} 
\index{snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}!snmp\+Process\+Pdu@{snmp\+Process\+Pdu}}
\index{snmp\+Process\+Pdu@{snmp\+Process\+Pdu}!snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}}
\subsubsection{\texorpdfstring{snmp\+Process\+Pdu()}{snmpProcessPdu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Process\+Pdu (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Process P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 63 of file snmp\+\_\+agent\+\_\+pdu.\+c.


\begin{DoxyCode}
64 \{
65    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
66 
67    \textcolor{comment}{//Parse PDU header}
68    error = \hyperlink{snmp__agent__message_8c_ad9655d8d1cbaed7edb34ee76a2987cae}{snmpParsePduHeader}(&context->request);
69    \textcolor{comment}{//Any error to report?}
70    \textcolor{keywordflow}{if}(error)
71       \textcolor{keywordflow}{return} error;
72 
73    \textcolor{comment}{//Initialize response message}
74    \hyperlink{snmp__agent__message_8c_a0371fc59a7828dbd4b15565d83078837}{snmpInitMessage}(&context->response);
75 
76    \textcolor{comment}{//Check PDU type}
77    \textcolor{keywordflow}{switch}(context->request.pduType)
78    \{
79    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa2c6d80868e156130b005e1d303f1672a}{SNMP\_PDU\_GET\_REQUEST}:
80    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa7328c19405381fe928ea69ef52ddb5c7}{SNMP\_PDU\_GET\_NEXT\_REQUEST}:
81       \textcolor{comment}{//Process GetRequest-PDU or GetNextRequest-PDU}
82       error = \hyperlink{snmp__agent__pdu_8c_a3a0d922fc849515908837e6b8944f089}{snmpProcessGetRequestPdu}(context);
83       \textcolor{keywordflow}{break};
84    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aae1b25cf12cf1954685f1f7e8d36670ed}{SNMP\_PDU\_GET\_BULK\_REQUEST}:
85       \textcolor{comment}{//Process GetBulkRequest-PDU}
86       error = \hyperlink{snmp__agent__pdu_8c_aeb64b1a444d164946558e7f40bdd9f66}{snmpProcessGetBulkRequestPdu}(context);
87       \textcolor{keywordflow}{break};
88    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aae8884442d7acf5f3b17ae435af6879a8}{SNMP\_PDU\_SET\_REQUEST}:
89       \textcolor{comment}{//Process SetRequest-PDU}
90       error = \hyperlink{snmp__agent__pdu_8c_aa1ffa9d829759350be71d3d4b8364e37}{snmpProcessSetRequestPdu}(context);
91       \textcolor{keywordflow}{break};
92 \textcolor{preprocessor}{#if (SNMP\_AGENT\_INFORM\_SUPPORT == ENABLED)}
93    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa3e99f6cb071a2b5a8e8b840ec30e8de2}{SNMP\_PDU\_GET\_RESPONSE}:
94       \textcolor{comment}{//Process GetResponse-PDU}
95       error = \hyperlink{snmp__agent__inform_8c_aed61e23f69d2a95582c4bc5eef684c3a}{snmpProcessGetResponsePdu}(context);
96       \textcolor{keywordflow}{break};
97    \textcolor{keywordflow}{case} \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aaae8744a84989fc7505be8d6a41914943}{SNMP\_PDU\_REPORT}:
98       \textcolor{comment}{//Process Report-PDU}
99       error = \hyperlink{snmp__agent__inform_8c_aae2be915291db87bf2947f45f971cdd7}{snmpProcessReportPdu}(context);
100       \textcolor{keywordflow}{break};
101 \textcolor{preprocessor}{#endif}
102    \textcolor{keywordflow}{default}:
103       \textcolor{comment}{//Invalid PDU type}
104       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2daa3c161edaa4477d1ae954c2136008}{ERROR\_INVALID\_TYPE};
105       \textcolor{keywordflow}{break};
106    \}
107 
108    \textcolor{comment}{//Check status code}
109    \textcolor{keywordflow}{if}(!error)
110    \{
111       \textcolor{comment}{//A GetResponse-PDU is generated by a protocol entity only upon receipt}
112       \textcolor{comment}{//of the GetRequest-PDU, GetNextRequest-PDU, GetBulkRequest-PDU or}
113       \textcolor{comment}{//SetRequest-PDU}
114       \textcolor{keywordflow}{if}(context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa2c6d80868e156130b005e1d303f1672a}{SNMP\_PDU\_GET\_REQUEST} ||
115          context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aa7328c19405381fe928ea69ef52ddb5c7}{SNMP\_PDU\_GET\_NEXT\_REQUEST} ||
116          context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aae1b25cf12cf1954685f1f7e8d36670ed}{SNMP\_PDU\_GET\_BULK\_REQUEST} ||
117          context->request.pduType == \hyperlink{snmp__common_8h_a3c16ad3ed681ee8a30c429d490f9299aae8884442d7acf5f3b17ae435af6879a8}{SNMP\_PDU\_SET\_REQUEST})
118       \{
119          \textcolor{comment}{//Total number of SNMP Get-Response PDUs which have been generated}
120          \textcolor{comment}{//by the SNMP protocol entity}
121          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpOutGetResponses, 1);
122 
123          \textcolor{comment}{//Format PDU header}
124          error = \hyperlink{snmp__agent__message_8c_a8b5e6d1e43fef67326204bf6999d9b18}{snmpWritePduHeader}(&context->response);
125       \}
126    \}
127 
128    \textcolor{comment}{//Return status code}
129    \textcolor{keywordflow}{return} error;
130 \}
\end{DoxyCode}
\mbox{\Hypertarget{snmp__agent__pdu_8h_aa1ffa9d829759350be71d3d4b8364e37}\label{snmp__agent__pdu_8h_aa1ffa9d829759350be71d3d4b8364e37}} 
\index{snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}!snmp\+Process\+Set\+Request\+Pdu@{snmp\+Process\+Set\+Request\+Pdu}}
\index{snmp\+Process\+Set\+Request\+Pdu@{snmp\+Process\+Set\+Request\+Pdu}!snmp\+\_\+agent\+\_\+pdu.\+h@{snmp\+\_\+agent\+\_\+pdu.\+h}}
\subsubsection{\texorpdfstring{snmp\+Process\+Set\+Request\+Pdu()}{snmpProcessSetRequestPdu()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} snmp\+Process\+Set\+Request\+Pdu (\begin{DoxyParamCaption}\item[{\hyperlink{snmp__agent_8h_a4c68afef83114acf80065b64191bfdac}{Snmp\+Agent\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Process Set\+Request-\/\+P\+DU. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+N\+MP agent context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 578 of file snmp\+\_\+agent\+\_\+pdu.\+c.


\begin{DoxyCode}
579 \{
580    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
581    \hyperlink{compiler__port_8h_a022c65af7f6c8d3947e8a37d64db6ad6}{int\_t} index;
582    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
583    \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
584    \textcolor{keyword}{const} \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
585    \hyperlink{structSnmpVarBind}{SnmpVarBind} var;
586 
587    \textcolor{comment}{//Debug message}
588    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Parsing SetRequest-PDU...\(\backslash\)r\(\backslash\)n"});
589 
590    \textcolor{comment}{//Total number of SNMP Set-Request PDUs which have been accepted and}
591    \textcolor{comment}{//processed by the SNMP protocol entity}
592    \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInSetRequests, 1);
593 
594    \textcolor{comment}{//Enforce access policy}
595    \textcolor{keywordflow}{if}(context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caa6ff12f2ad320ff3beef159c80348a4c4}{SNMP\_ACCESS\_WRITE\_ONLY} &&
596       context->user.mode != \hyperlink{snmp__agent__usm_8h_a45fe7ae59b303bb7c3a6067ffe2ed5caace57b275f5ae1547ebcb27a6f5959548}{SNMP\_ACCESS\_READ\_WRITE})
597    \{
598       \textcolor{comment}{//Total number of SNMP messages delivered to the SNMP protocol entity}
599       \textcolor{comment}{//which represented an SNMP operation which was not allowed by the SNMP}
600       \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
601       \hyperlink{snmp__mib__module_8h_a3cdbaaf290c386162780e68e496151b8}{SNMP\_MIB\_INC\_COUNTER32}(snmpGroup.snmpInBadCommunityUses, 1);
602 
603       \textcolor{comment}{//Report an error}
604       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab2ad5fd7f964111e682dab2f8411902a}{ERROR\_ACCESS\_DENIED};
605    \}
606 
607    \textcolor{comment}{//Initialize response message}
608    error = \hyperlink{snmp__agent__message_8c_ad2dc2a16291cb8620fce860e1fe3c606}{snmpInitResponse}(context);
609    \textcolor{comment}{//Any error to report?}
610    \textcolor{keywordflow}{if}(error)
611       \textcolor{keywordflow}{return} error;
612 
613    \textcolor{comment}{//The variable bindings are processed as a two phase operation. In the}
614    \textcolor{comment}{//first phase, each variable binding is validated}
615    p = context->request.varBindList;
616    length = context->request.varBindListLen;
617 
618    \textcolor{comment}{//Lock access to MIB bases}
619    \hyperlink{snmp__agent__misc_8c_a2e6a175c10dbd3b37ae367fb6b27e358}{snmpLockMib}(context);
620 
621    \textcolor{comment}{//Loop through the list}
622    \textcolor{keywordflow}{for}(index = 1; length > 0; index++)
623    \{
624       \textcolor{comment}{//Parse variable binding}
625       error = \hyperlink{snmp__agent__misc_8c_a6176abbf69180ffcfd2e3a733ec5cbbc}{snmpParseVarBinding}(p, length, &var, &n);
626       \textcolor{comment}{//Failed to parse variable binding?}
627       \textcolor{keywordflow}{if}(error)
628          \textcolor{keywordflow}{break};
629 
630       \textcolor{comment}{//Assign object value}
631       error = \hyperlink{snmp__agent__object_8c_a7e9ab6bc8e4deb43d557591b0c4f987c}{snmpSetObjectValue}(context, &context->request, &var, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
632       \textcolor{comment}{//Any error to report?}
633       \textcolor{keywordflow}{if}(error)
634          \textcolor{keywordflow}{break};
635 
636       \textcolor{comment}{//Advance data pointer}
637       p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
638       length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
639    \}
640 
641    \textcolor{comment}{//If all validations are successful, then each variable is altered in}
642    \textcolor{comment}{//the second phase}
643    \textcolor{keywordflow}{if}(!error)
644    \{
645       \textcolor{comment}{//The changes are committed to the MIB base during the second phase}
646       p = context->request.varBindList;
647       length = context->request.varBindListLen;
648 
649       \textcolor{comment}{//Loop through the list}
650       \textcolor{keywordflow}{for}(index = 1; length > 0; index++)
651       \{
652          \textcolor{comment}{//Parse variable binding}
653          error = \hyperlink{snmp__agent__misc_8c_a6176abbf69180ffcfd2e3a733ec5cbbc}{snmpParseVarBinding}(p, length, &var, &n);
654          \textcolor{comment}{//Failed to parse variable binding?}
655          \textcolor{keywordflow}{if}(error)
656             \textcolor{keywordflow}{break};
657 
658          \textcolor{comment}{//Assign object value}
659          error = \hyperlink{snmp__agent__object_8c_a7e9ab6bc8e4deb43d557591b0c4f987c}{snmpSetObjectValue}(context, &context->request, &var, 
      \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
660          \textcolor{comment}{//Any error to report?}
661          \textcolor{keywordflow}{if}(error)
662             \textcolor{keywordflow}{break};
663 
664          \textcolor{comment}{//Total number of MIB objects which have been altered successfully}
665          \textcolor{comment}{//by the SNMP protocol entity as the result of receiving valid}
666          \textcolor{comment}{//SNMP Set-Request PDUs}
667          \hyperlink{mib2__module_8h_abac73a39224e47d597f3b461620d2119}{MIB2\_INC\_COUNTER32}(snmpGroup.snmpInTotalSetVars, 1);
668 
669          \textcolor{comment}{//Advance data pointer}
670          p += \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
671          length -= \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
672       \}
673    \}
674 
675    \textcolor{comment}{//Unlock access to MIB bases}
676    \hyperlink{snmp__agent__misc_8c_ab3ae3b7de27641516fee3f8134c85c29}{snmpUnlockMib}(context);
677 
678    \textcolor{comment}{//Any error to report?}
679    \textcolor{keywordflow}{if}(error)
680    \{
681       \textcolor{comment}{//Set error-status and error-index fields}
682       error = \hyperlink{snmp__agent__misc_8c_a7a7f8079b21e592ba511a3edb5c11ad1}{snmpTranslateStatusCode}(&context->response, error, index);
683       \textcolor{comment}{//If the parsing of the request fails, the SNMP agent discards the message}
684       \textcolor{keywordflow}{if}(error)
685          \textcolor{keywordflow}{return} error;
686    \}
687 
688    \textcolor{comment}{//The SNMP agent sends back a GetResponse-PDU of identical form}
689    error = \hyperlink{snmp__agent__misc_8c_ad3578ff92f6cf0c758700c34fca1ca5b}{snmpCopyVarBindingList}(context);
690    \textcolor{comment}{//Return status code}
691    \textcolor{keywordflow}{return} error;
692 \}
\end{DoxyCode}
