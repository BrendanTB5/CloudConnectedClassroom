\hypertarget{slaac_8c}{}\section{cyclone\+\_\+tcp/ipv6/slaac.c File Reference}
\label{slaac_8c}\index{cyclone\+\_\+tcp/ipv6/slaac.\+c@{cyclone\+\_\+tcp/ipv6/slaac.\+c}}


I\+Pv6 Stateless Address Autoconfiguration.  


{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}core/ethernet.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ipv6.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ipv6\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/slaac.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ndp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ipv6/ndp\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{slaac_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_ac69eb090d316e3e22b8d7edcdae579d2}{S\+L\+A\+A\+C\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{slaac_8c_a4c4f0f4064a1ef8aa40421d19779c057}{slaac\+Get\+Default\+Settings} (\hyperlink{structSlaacSettings}{Slaac\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em Initialize settings with default values. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{slaac_8c_a2ead275e73e7158997b383af80cdcf69}{slaac\+Init} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context, const \hyperlink{structSlaacSettings}{Slaac\+Settings} $\ast$settings)
\begin{DoxyCompactList}\small\item\em S\+L\+A\+AC initialization. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{slaac_8c_a16bfb2d1d2413ec6a9d41829874fb69f}{slaac\+Start} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Start S\+L\+A\+AC process. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{slaac_8c_ad805b651713d1070adf0f4c17346dcdd}{slaac\+Stop} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Stop S\+L\+A\+AC process. \end{DoxyCompactList}\item 
void \hyperlink{slaac_8c_a2dabf2bea06920c7ff5fa0fcba72170f}{slaac\+Link\+Change\+Event} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Callback function for link change event. \end{DoxyCompactList}\item 
void \hyperlink{slaac_8c_a0ffa11d5c7d2e2a92c2e99336c1863c3}{slaac\+Parse\+Router\+Adv} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context, \hyperlink{ndp_8h_ad4e8bce6eb079bfe6e7681a6f6488c1e}{Ndp\+Router\+Adv\+Message} $\ast$\hyperlink{pap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, size\+\_\+t \hyperlink{ppp_8h_ab2b3adeb2a67e656ff030b56727fd0ac}{length})
\begin{DoxyCompactList}\small\item\em Parse Router Advertisement message. \end{DoxyCompactList}\item 
void \hyperlink{slaac_8c_ae32b109335af168f014070a0d139203b}{slaac\+Parse\+Prefix\+Info\+Option} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context, \hyperlink{ndp_8h_a7da4a31f2fe9a81aabb5dfd8979ec3a6}{Ndp\+Prefix\+Info\+Option} $\ast$option)
\begin{DoxyCompactList}\small\item\em Parse Prefix Information Option. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{slaac_8c_a29114ac0ba9fd8aad8e622083c031234}{slaac\+Generate\+Link\+Local\+Addr} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Generate a link-\/local address. \end{DoxyCompactList}\item 
void \hyperlink{slaac_8c_a60554ee8fa715f5eff42dad6332224fa}{slaac\+Dump\+Config} (\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$context)
\begin{DoxyCompactList}\small\item\em Dump I\+Pv6 configuration for debugging purpose. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
I\+Pv6 Stateless Address Autoconfiguration. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.\hypertarget{tftp__server_8c_Description}{}\subsection{Description}\label{tftp__server_8c_Description}
Stateless Address Autoconfiguration is a facility to allow devices to configure themselves independently. Refer to the following R\+F\+Cs for complete details\+:
\begin{DoxyItemize}
\item R\+FC 4862\+: I\+Pv6 Stateless Address Autoconfiguration
\item R\+FC 6106\+: I\+Pv6 Router Advertisement Options for D\+NS Configuration
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{slaac_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{slaac_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{slaac.\+c@{slaac.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_ac69eb090d316e3e22b8d7edcdae579d2}{S\+L\+A\+A\+C\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 40 of file slaac.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{slaac_8c_a60554ee8fa715f5eff42dad6332224fa}\label{slaac_8c_a60554ee8fa715f5eff42dad6332224fa}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Dump\+Config@{slaac\+Dump\+Config}}
\index{slaac\+Dump\+Config@{slaac\+Dump\+Config}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Dump\+Config()}{slaacDumpConfig()}}
{\footnotesize\ttfamily void slaac\+Dump\+Config (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Dump I\+Pv6 configuration for debugging purpose. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\end{DoxyParams}


Definition at line 616 of file slaac.\+c.


\begin{DoxyCode}
617 \{
618 \textcolor{preprocessor}{#if (SLAAC\_TRACE\_LEVEL >= TRACE\_LEVEL\_INFO)}
619    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
620    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
621    \hyperlink{structIpv6Context}{Ipv6Context} *ipv6Context;
622 
623    \textcolor{comment}{//Point to the underlying network interface}
624    \textcolor{keyword}{interface }= context->settings.interface;
625    \textcolor{comment}{//Point to the IPv6 context}
626    ipv6Context = &interface->ipv6Context;
627 
628    \textcolor{comment}{//Debug message}
629    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
630    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"SLAAC configuration:\(\backslash\)r\(\backslash\)n"});
631 
632    \textcolor{comment}{//Link-local address}
633    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Link-local Address = %s\(\backslash\)r\(\backslash\)n"},
634       \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->addrList[0].addr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
635 
636    \textcolor{comment}{//Global addresses}
637    \textcolor{keywordflow}{for}(i = 1; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
638    \{
639       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Global Address %u = %s\(\backslash\)r\(\backslash\)n"}, i,
640          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->addrList[i].addr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
641    \}
642 
643    \textcolor{comment}{//IPv6 prefixes}
644    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_a928a90013c8822cded35706806f00171}{IPV6\_PREFIX\_LIST\_SIZE}; i++)
645    \{
646       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Prefix %u = %s/%"} PRIu8 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, i + 1,
647          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->prefixList[i].prefix, 
      \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}),
648          ipv6Context->prefixList[i].prefixLen);
649    \}
650 
651    \textcolor{comment}{//Default routers}
652    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_af61cd2a89ea067f9ecd5a7f7d9649bba}{IPV6\_ROUTER\_LIST\_SIZE}; i++)
653    \{
654       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  Default Router %u = %s\(\backslash\)r\(\backslash\)n"}, i + 1,
655          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->routerList[i].addr, \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
656    \}
657 
658    \textcolor{comment}{//DNS servers}
659    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{ipv6_8h_a7ef30c7f719916efa14b509b7ef707a1}{IPV6\_DNS\_SERVER\_LIST\_SIZE}; i++)
660    \{
661       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  DNS Server %u = %s\(\backslash\)r\(\backslash\)n"}, i + 1,
662          \hyperlink{ipv6_8c_a96e27d88ffdf1b2ca6fca448dc6b4e7e}{ipv6AddrToString}(&ipv6Context->dnsServerList[i], \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}));
663    \}
664 
665    \textcolor{comment}{//Maximum transmit unit}
666    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"  MTU = %"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}, ipv6Context->linkMtu);
667    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
668 \textcolor{preprocessor}{#endif}
669 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a29114ac0ba9fd8aad8e622083c031234}\label{slaac_8c_a29114ac0ba9fd8aad8e622083c031234}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Generate\+Link\+Local\+Addr@{slaac\+Generate\+Link\+Local\+Addr}}
\index{slaac\+Generate\+Link\+Local\+Addr@{slaac\+Generate\+Link\+Local\+Addr}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Generate\+Link\+Local\+Addr()}{slaacGenerateLinkLocalAddr()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} slaac\+Generate\+Link\+Local\+Addr (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Generate a link-\/local address. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 565 of file slaac.\+c.


\begin{DoxyCode}
566 \{
567    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
568    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
569    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *logicalInterface;
570    \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr} \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
571 
572    \textcolor{comment}{//Point to the underlying network interface}
573    \textcolor{keyword}{interface }= context->settings.interface;
574 
575    \textcolor{comment}{//Point to the logical interface}
576    logicalInterface = \hyperlink{nic_8c_a650d776d6513c3bb88671c3aedd782f0}{nicGetLogicalInterface}(interface);
577 
578    \textcolor{comment}{//Check whether a link-local address has been manually assigned}
579    \textcolor{keywordflow}{if}(interface->ipv6Context.addrList[0].state != \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID} &&
580       interface->ipv6Context.addrList[0].permanent)
581    \{
582       \textcolor{comment}{//Keep using the current link-local address}
583       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
584    \}
585    \textcolor{keywordflow}{else}
586    \{
587       \textcolor{comment}{//A link-local address is formed by combining the well-known}
588       \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
589       \hyperlink{ipv6__misc_8c_a528bfb892811943ea3910ca0e13b0ed1}{ipv6GenerateLinkLocalAddr}(&logicalInterface->eui64, &addr);
590 
591       \textcolor{comment}{//Check whether Duplicate Address Detection should be performed}
592       \textcolor{keywordflow}{if}(interface->ndpContext.dupAddrDetectTransmits > 0)
593       \{
594          \textcolor{comment}{//Use the link-local address as a tentative address}
595          error = \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, 0, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE},
596             \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
597       \}
598       \textcolor{keywordflow}{else}
599       \{
600          \textcolor{comment}{//The use of the link-local address is now unrestricted}
601          error = \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, 0, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED},
602             \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME}, 
      \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
603       \}
604    \}
605 
606    \textcolor{comment}{//Return status code}
607    \textcolor{keywordflow}{return} error;
608 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a4c4f0f4064a1ef8aa40421d19779c057}\label{slaac_8c_a4c4f0f4064a1ef8aa40421d19779c057}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Get\+Default\+Settings@{slaac\+Get\+Default\+Settings}}
\index{slaac\+Get\+Default\+Settings@{slaac\+Get\+Default\+Settings}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Get\+Default\+Settings()}{slaacGetDefaultSettings()}}
{\footnotesize\ttfamily void slaac\+Get\+Default\+Settings (\begin{DoxyParamCaption}\item[{\hyperlink{structSlaacSettings}{Slaac\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



Initialize settings with default values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em settings} & Structure that contains S\+L\+A\+AC settings \\
\hline
\end{DoxyParams}


Definition at line 61 of file slaac.\+c.


\begin{DoxyCode}
62 \{
63    \textcolor{comment}{//Use default interface}
64    settings->\hyperlink{structSlaacSettings_a28e99b4d9e098adc42fb1d29e8137977}{interface} = \hyperlink{net_8c_a991aba7eae4de79f30c6889d95cc6870}{netGetDefaultInterface}();
65 
66    \textcolor{comment}{//Use the DNS servers specified by the RDNSS option}
67    settings->\hyperlink{structSlaacSettings_acf5b3baa56cbba942f4de3d80858c1c7}{manualDnsConfig} = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
68    \textcolor{comment}{//Link state change event}
69    settings->\hyperlink{structSlaacSettings_a5fe65a555b650fac3bc027f55b99151f}{linkChangeEvent} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
70    \textcolor{comment}{//Router Advertisement parsing callback}
71    settings->\hyperlink{structSlaacSettings_ad2dd037086f07cb77cd6ec8cc57a4414}{parseRouterAdvCallback} = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
72 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a2ead275e73e7158997b383af80cdcf69}\label{slaac_8c_a2ead275e73e7158997b383af80cdcf69}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Init@{slaac\+Init}}
\index{slaac\+Init@{slaac\+Init}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Init()}{slaacInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} slaac\+Init (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structSlaacSettings}{Slaac\+Settings} $\ast$}]{settings }\end{DoxyParamCaption})}



S\+L\+A\+AC initialization. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\mbox{\tt in}  & {\em settings} & S\+L\+A\+AC specific settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 82 of file slaac.\+c.


\begin{DoxyCode}
83 \{
84    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
85 
86    \textcolor{comment}{//Debug message}
87    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Initializing SLAAC...\(\backslash\)r\(\backslash\)n"});
88 
89    \textcolor{comment}{//Ensure the parameters are valid}
90    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || settings == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
91       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
92 
93    \textcolor{comment}{//A valid pointer to the interface being configured is required}
94    \textcolor{keywordflow}{if}(settings->\hyperlink{structSlaacSettings_a28e99b4d9e098adc42fb1d29e8137977}{interface} == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
95       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
96 
97    \textcolor{comment}{//Point to the underlying network interface}
98    \textcolor{keyword}{interface }= settings->interface;
99 
100    \textcolor{comment}{//Clear the SLAAC context}
101    memset(context, 0, \textcolor{keyword}{sizeof}(\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{SlaacContext}));
102    \textcolor{comment}{//Save user settings}
103    context->settings = *settings;
104 
105    \textcolor{comment}{//SLAAC operation is currently suspended}
106    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
107 
108    \textcolor{comment}{//Attach the SLAAC context to the network interface}
109    interface->slaacContext = context;
110 
111    \textcolor{comment}{//Successful initialization}
112    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
113 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a2dabf2bea06920c7ff5fa0fcba72170f}\label{slaac_8c_a2dabf2bea06920c7ff5fa0fcba72170f}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Link\+Change\+Event@{slaac\+Link\+Change\+Event}}
\index{slaac\+Link\+Change\+Event@{slaac\+Link\+Change\+Event}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Link\+Change\+Event()}{slaacLinkChangeEvent()}}
{\footnotesize\ttfamily void slaac\+Link\+Change\+Event (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Callback function for link change event. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\end{DoxyParams}


Definition at line 202 of file slaac.\+c.


\begin{DoxyCode}
203 \{
204    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
205 
206    \textcolor{comment}{//Make sure the SLAAC service has been properly instantiated}
207    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
208       \textcolor{keywordflow}{return};
209 
210    \textcolor{comment}{//Point to the underlying network interface}
211    \textcolor{keyword}{interface }= context->settings.interface;
212 
213    \textcolor{comment}{//Check whether SLAAC is enabled}
214    \textcolor{keywordflow}{if}(context->running)
215    \{
216       \textcolor{comment}{//Automatic DNS server configuration?}
217       \textcolor{keywordflow}{if}(!context->settings.manualDnsConfig)
218       \{
219          \textcolor{comment}{//Clear the list of DNS servers}
220          \hyperlink{ipv6__misc_8c_a4b3ce94edd9cad3fb3269e805a104b97}{ipv6FlushDnsServerList}(interface);
221       \}
222 
223       \textcolor{comment}{//Link-up event?}
224       \textcolor{keywordflow}{if}(interface->linkState)
225       \{
226          \textcolor{comment}{//A link-local address is formed by combining the well-known}
227          \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
228          \hyperlink{slaac_8c_a29114ac0ba9fd8aad8e622083c031234}{slaacGenerateLinkLocalAddr}(context);
229       \}
230    \}
231 
232    \textcolor{comment}{//Any registered callback?}
233    \textcolor{keywordflow}{if}(context->settings.linkChangeEvent != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
234    \{
235       \textcolor{comment}{//Release exclusive access}
236       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
237       \textcolor{comment}{//Invoke user callback function}
238       context->settings.linkChangeEvent(context, interface, interface->linkState);
239       \textcolor{comment}{//Get exclusive access}
240       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
241    \}
242 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_ae32b109335af168f014070a0d139203b}\label{slaac_8c_ae32b109335af168f014070a0d139203b}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Parse\+Prefix\+Info\+Option@{slaac\+Parse\+Prefix\+Info\+Option}}
\index{slaac\+Parse\+Prefix\+Info\+Option@{slaac\+Parse\+Prefix\+Info\+Option}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Parse\+Prefix\+Info\+Option()}{slaacParsePrefixInfoOption()}}
{\footnotesize\ttfamily void slaac\+Parse\+Prefix\+Info\+Option (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context,  }\item[{\hyperlink{ndp_8h_a7da4a31f2fe9a81aabb5dfd8979ec3a6}{Ndp\+Prefix\+Info\+Option} $\ast$}]{option }\end{DoxyParamCaption})}



Parse Prefix Information Option. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\mbox{\tt in}  & {\em option} & Pointer to the Prefix Information option \\
\hline
\end{DoxyParams}


Definition at line 345 of file slaac.\+c.


\begin{DoxyCode}
347 \{
348    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
349    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} found;
350    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
351    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_a6bcd95080db3b3f2265498723b93d7b2}{validLifetime};
352    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferredLifetime};
353    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} remainingLifetime;
354    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
355    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *logicalInterface;
356    \hyperlink{structIpv6AddrEntry}{Ipv6AddrEntry} *entry;
357    \hyperlink{ipv6_8h_aed0cbc40c61ed5b4fb681ebc55237e89}{Ipv6Addr} \hyperlink{nbns__common_8h_ac597eaa9711dfbc34f49d506132e85cd}{addr};
358 
359    \textcolor{comment}{//Make sure the Prefix Information option is valid}
360    \textcolor{keywordflow}{if}(option == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || option->length != 4)
361       \textcolor{keywordflow}{return};
362 
363    \textcolor{comment}{//If the Autonomous flag is not set, silently ignore the Prefix}
364    \textcolor{comment}{//Information option}
365    \textcolor{keywordflow}{if}(!option->a)
366       \textcolor{keywordflow}{return};
367 
368    \textcolor{comment}{//If the prefix is the link-local prefix, silently ignore the}
369    \textcolor{comment}{//Prefix Information option}
370    \textcolor{keywordflow}{if}(\hyperlink{ipv6__misc_8c_a6cf8eae90cab177c8b32b1bf1709952b}{ipv6CompPrefix}(&option->prefix, &\hyperlink{ipv6_8c_a99dbd3de4e61de432b438d8e581c2cf1}{IPV6\_LINK\_LOCAL\_ADDR\_PREFIX}
      , 10))
371       \textcolor{keywordflow}{return};
372 
373    \textcolor{comment}{//Check whether the valid lifetime is zero}
374    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(option->validLifetime) == 0)
375       \textcolor{keywordflow}{return};
376 
377    \textcolor{comment}{//If the preferred lifetime is greater than the valid lifetime,}
378    \textcolor{comment}{//silently ignore the Prefix Information option}
379    \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(option->preferredLifetime) > \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(option->validLifetime))
380       \textcolor{keywordflow}{return};
381 
382    \textcolor{comment}{//If the sum of the prefix length and interface identifier length does}
383    \textcolor{comment}{//not equal 128 bits, the Prefix Information option must be ignored}
384    \textcolor{keywordflow}{if}(option->prefixLength != 64)
385       \textcolor{keywordflow}{return};
386 
387    \textcolor{comment}{//Get current time}
388    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
389 
390    \textcolor{comment}{//Point to the underlying network interface}
391    \textcolor{keyword}{interface }= context->settings.interface;
392 
393    \textcolor{comment}{//Point to the logical interface}
394    logicalInterface = \hyperlink{nic_8c_a650d776d6513c3bb88671c3aedd782f0}{nicGetLogicalInterface}(interface);
395 
396    \textcolor{comment}{//Form an address by combining the advertised prefix with the interface}
397    \textcolor{comment}{//identifier}
398    addr.w[0] = option->prefix.w[0];
399    addr.w[1] = option->prefix.w[1];
400    addr.w[2] = option->prefix.w[2];
401    addr.w[3] = option->prefix.w[3];
402    addr.w[4] = logicalInterface->eui64.w[0];
403    addr.w[5] = logicalInterface->eui64.w[1];
404    addr.w[6] = logicalInterface->eui64.w[2];
405    addr.w[7] = logicalInterface->eui64.w[3];
406 
407    \textcolor{comment}{//Convert Valid Lifetime to host byte order}
408    validLifetime = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(option->validLifetime);
409 
410    \textcolor{comment}{//Check the valid lifetime}
411    \textcolor{keywordflow}{if}(validLifetime != \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME})
412    \{
413       \textcolor{comment}{//The length of time in seconds that the prefix is valid for the}
414       \textcolor{comment}{//purpose of on-link determination}
415       \textcolor{keywordflow}{if}(validLifetime < (\hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY} / 1000))
416          validLifetime *= 1000;
417       \textcolor{keywordflow}{else}
418          validLifetime = \hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY};
419    \}
420    \textcolor{keywordflow}{else}
421    \{
422       \textcolor{comment}{//A value of all one bits (0xffffffff) represents infinity}
423       validLifetime = \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY};
424    \}
425 
426    \textcolor{comment}{//Convert Preferred Lifetime to host byte order}
427    preferredLifetime = \hyperlink{cpu__endian_8h_a22f92ea3318059b7d88dfbd98d0cbc3e}{ntohl}(option->preferredLifetime);
428 
429    \textcolor{comment}{//Check the preferred lifetime}
430    \textcolor{keywordflow}{if}(preferredLifetime != \hyperlink{ndp_8h_a96fa12d04b522371a81350239b9e2d11}{NDP\_INFINITE\_LIFETIME})
431    \{
432       \textcolor{comment}{//The length of time in seconds that addresses generated from the}
433       \textcolor{comment}{//prefix via stateless address autoconfiguration remain preferred}
434       \textcolor{keywordflow}{if}(preferredLifetime < (\hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY} / 1000))
435          preferredLifetime *= 1000;
436       \textcolor{keywordflow}{else}
437          preferredLifetime = \hyperlink{os__port_8h_a16027d8acc5301e440cefa086eb9db2a}{MAX\_DELAY};
438    \}
439    \textcolor{keywordflow}{else}
440    \{
441       \textcolor{comment}{//A value of all one bits (0xffffffff) represents infinity}
442       preferredLifetime = \hyperlink{os__port_8h_ab893de6f8a0ec8b0e6dd8097ff398019}{INFINITE\_DELAY};
443    \}
444 
445    \textcolor{comment}{//This flag will be set if the advertised prefix matches an address}
446    \textcolor{comment}{//assigned to the interface}
447    found = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
448 
449    \textcolor{comment}{//Loop through the list of IPv6 addresses}
450    \textcolor{keywordflow}{for}(i = 1; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
451    \{
452       \textcolor{comment}{//Point to the current entry}
453       entry = &interface->ipv6Context.addrList[i];
454 
455       \textcolor{comment}{//Check whether the advertised prefix is equal to the prefix of an}
456       \textcolor{comment}{//address configured by stateless autoconfiguration in the list}
457       \textcolor{keywordflow}{if}(\hyperlink{ipv6__misc_8c_a6cf8eae90cab177c8b32b1bf1709952b}{ipv6CompPrefix}(&entry->\hyperlink{structIpv6AddrEntry_a55b2d1238731a3b4ffca6928ebb52fe0}{addr}, &option->prefix, option->prefixLength))
458       \{
459          \textcolor{comment}{//Valid address?}
460          \textcolor{keywordflow}{if}(entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED} ||
461             entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518da4cd161ce2c979312f91a8f3e946acec6}{IPV6\_ADDR\_STATE\_DEPRECATED})
462          \{
463             \textcolor{comment}{//Set flag}
464             found = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
465 
466             \textcolor{comment}{//The preferred lifetime of the address is reset to the Preferred}
467             \textcolor{comment}{//Lifetime in the received advertisement}
468             entry->\hyperlink{structIpv6AddrEntry_a4d368a125e163baf554e7622edff555f}{preferredLifetime} = \hyperlink{dhcpv6__common_8h_a40bac1e80f1005d8d5045ec837d1429b}{preferredLifetime};
469 
470             \textcolor{comment}{//Compute the remaining time to the valid lifetime expiration}
471             \textcolor{comment}{//of the previously autoconfigured address}
472             \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, entry->\hyperlink{structIpv6AddrEntry_a9080e69e7dc724704176843cdadfb29b}{timestamp} + entry->
      \hyperlink{structIpv6AddrEntry_ab56a11d9de06327ab5af04e8ae18164d}{validLifetime}) < 0)
473                remainingLifetime = entry->\hyperlink{structIpv6AddrEntry_a9080e69e7dc724704176843cdadfb29b}{timestamp} + entry->
      \hyperlink{structIpv6AddrEntry_ab56a11d9de06327ab5af04e8ae18164d}{validLifetime} - \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
474             \textcolor{keywordflow}{else}
475                remainingLifetime = 0;
476 
477             \textcolor{comment}{//The specific action to perform for the valid lifetime of the}
478             \textcolor{comment}{//address depends on the Valid Lifetime in the received Router}
479             \textcolor{comment}{//Advertisement and the remaining time}
480             \textcolor{keywordflow}{if}(validLifetime > \hyperlink{slaac_8h_ae200c3d820e397eab504858af31dd4d3}{SLAAC\_LIFETIME\_2\_HOURS} ||
481                validLifetime > remainingLifetime)
482             \{
483                \textcolor{comment}{//If the received Valid Lifetime is greater than 2 hours or}
484                \textcolor{comment}{//greater than remaining lifetime, set the valid lifetime of}
485                \textcolor{comment}{//the corresponding address to the advertised Valid Lifetime}
486                entry->\hyperlink{structIpv6AddrEntry_ab56a11d9de06327ab5af04e8ae18164d}{validLifetime} = \hyperlink{dhcpv6__common_8h_a6bcd95080db3b3f2265498723b93d7b2}{validLifetime};
487 
488                \textcolor{comment}{//Save current time}
489                entry->\hyperlink{structIpv6AddrEntry_a9080e69e7dc724704176843cdadfb29b}{timestamp} = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
490                \textcolor{comment}{//Update the state of the IPv6 address}
491                entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} = \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED};
492             \}
493             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(remainingLifetime <= \hyperlink{slaac_8h_ae200c3d820e397eab504858af31dd4d3}{SLAAC\_LIFETIME\_2\_HOURS})
494             \{
495                \textcolor{comment}{//If remaining lifetime is less than or equal to 2 hours, ignore}
496                \textcolor{comment}{//the Prefix Information option with regards to the valid lifetime}
497             \}
498             \textcolor{keywordflow}{else}
499             \{
500                \textcolor{comment}{//Otherwise, reset the valid lifetime of the corresponding}
501                \textcolor{comment}{//address to 2 hours}
502                entry->\hyperlink{structIpv6AddrEntry_ab56a11d9de06327ab5af04e8ae18164d}{validLifetime} = \hyperlink{slaac_8h_ae200c3d820e397eab504858af31dd4d3}{SLAAC\_LIFETIME\_2\_HOURS};
503 
504                \textcolor{comment}{//Save current time}
505                entry->\hyperlink{structIpv6AddrEntry_a9080e69e7dc724704176843cdadfb29b}{timestamp} = \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
506                \textcolor{comment}{//Update the state of the IPv6 address}
507                entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} = \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED};
508             \}
509          \}
510          \textcolor{comment}{//Tentative address?}
511          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE})
512          \{
513             \textcolor{comment}{//Do not update the preferred and valid lifetimes of the address}
514             \textcolor{comment}{//when Duplicate Address Detection is being performed}
515             found = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
516          \}
517       \}
518    \}
519 
520    \textcolor{comment}{//The IPv6 address is not yet in the list?}
521    \textcolor{keywordflow}{if}(!found)
522    \{
523       \textcolor{comment}{//Loop through the list of IPv6 addresses}
524       \textcolor{keywordflow}{for}(i = 1; i < \hyperlink{ipv6_8h_aa9064306086cc3bba39cf75db3ec2881}{IPV6\_ADDR\_LIST\_SIZE}; i++)
525       \{
526          \textcolor{comment}{//Point to the current entry}
527          entry = &interface->ipv6Context.addrList[i];
528 
529          \textcolor{comment}{//Check the state of the IPv6 address}
530          \textcolor{keywordflow}{if}(entry->\hyperlink{structIpv6AddrEntry_ae4ce939ceef8a1d15ac7d11542215a0f}{state} == \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dabdf9e5bbd4cc04a803d6e63cc9992ebb}{IPV6\_ADDR\_STATE\_INVALID})
531          \{
532             \textcolor{comment}{//If an address is formed successfully and the address is not yet}
533             \textcolor{comment}{//in the list, the host adds it to the list of addresses assigned}
534             \textcolor{comment}{//to the interface, initializing its preferred and valid lifetime}
535             \textcolor{comment}{//values from the Prefix Information option}
536             \textcolor{keywordflow}{if}(interface->ndpContext.dupAddrDetectTransmits > 0)
537             \{
538                \textcolor{comment}{//Use the IPv6 address as a tentative address}
539                \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, i, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518dacb3152ea8c90d13a425042070b987fe6}{IPV6\_ADDR\_STATE\_TENTATIVE},
540                   validLifetime, preferredLifetime, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
541             \}
542             \textcolor{keywordflow}{else}
543             \{
544                \textcolor{comment}{//The use of the IPv6 address is now unrestricted}
545                \hyperlink{ipv6__misc_8c_a260c329b0f6deb7be88e6ee7a1003063}{ipv6SetAddr}(interface, i, &addr, 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED},
546                   validLifetime, preferredLifetime, \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
547             \}
548 
549             \textcolor{comment}{//A new IPv6 address has just been assigned to the interface}
550             context->configUpdated = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
551             \textcolor{comment}{//We are done}
552             \textcolor{keywordflow}{break};
553          \}
554       \}
555    \}
556 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a0ffa11d5c7d2e2a92c2e99336c1863c3}\label{slaac_8c_a0ffa11d5c7d2e2a92c2e99336c1863c3}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Parse\+Router\+Adv@{slaac\+Parse\+Router\+Adv}}
\index{slaac\+Parse\+Router\+Adv@{slaac\+Parse\+Router\+Adv}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Parse\+Router\+Adv()}{slaacParseRouterAdv()}}
{\footnotesize\ttfamily void slaac\+Parse\+Router\+Adv (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context,  }\item[{\hyperlink{ndp_8h_ad4e8bce6eb079bfe6e7681a6f6488c1e}{Ndp\+Router\+Adv\+Message} $\ast$}]{message,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Parse Router Advertisement message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\mbox{\tt in}  & {\em message} & Pointer to the Router Advertisement message \\
\hline
\mbox{\tt in}  & {\em length} & Length of the message, in bytes \\
\hline
\end{DoxyParams}


Definition at line 252 of file slaac.\+c.


\begin{DoxyCode}
254 \{
255    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
256    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
257    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
258    \hyperlink{ndp_8h_a7da4a31f2fe9a81aabb5dfd8979ec3a6}{NdpPrefixInfoOption} *prefixInfoOption;
259    \hyperlink{ndp_8h_a6f7dd422af0b10fbb5ae11450156dacb}{NdpRdnssOption} *rdnssOption;
260 
261    \textcolor{comment}{//Point to the underlying network interface}
262    \textcolor{keyword}{interface }= context->settings.interface;
263 
264    \textcolor{comment}{//Check whether SLAAC is enabled}
265    \textcolor{keywordflow}{if}(!context->running)
266       \textcolor{keywordflow}{return};
267 
268    \textcolor{comment}{//Make sure that a valid link-local address has been assigned to the interface}
269    \textcolor{keywordflow}{if}(\hyperlink{ipv6_8h_a0650f6186ad38b49662420902ae208ea}{ipv6GetLinkLocalAddrState}(interface) != 
      \hyperlink{ipv6_8h_acb54c5e2b7ee1652f5bf055e14cc518daaa3a0ce422a678d8eb14a36f4c642d16}{IPV6\_ADDR\_STATE\_PREFERRED})
270       \textcolor{keywordflow}{return};
271 
272    \textcolor{comment}{//Calculate the length of the Options field}
273    \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} -= \textcolor{keyword}{sizeof}(\hyperlink{ndp_8h_ad4e8bce6eb079bfe6e7681a6f6488c1e}{NdpRouterAdvMessage});
274 
275    \textcolor{comment}{//This flag tracks changes in IPv6 configuration}
276    context->configUpdated = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
277 
278    \textcolor{comment}{//Point to the beginning of the Options field}
279    n = 0;
280 
281    \textcolor{comment}{//Parse Options field}
282    \textcolor{keywordflow}{while}(1)
283    \{
284       \textcolor{comment}{//Search the Options field for any Prefix Information options}
285       prefixInfoOption = \hyperlink{ndp__misc_8c_a6d3addbaab223cf3eab295c590e42f35}{ndpGetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options + n,
286          \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length} - n, \hyperlink{ndp_8h_af1e00e3e4e4a40cf7cc766002871bf30a6a0ecdab157e41227db339c02d093cb2}{NDP\_OPT\_PREFIX\_INFORMATION});
287 
288       \textcolor{comment}{//No more option of the specified type?}
289       \textcolor{keywordflow}{if}(prefixInfoOption == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
290          \textcolor{keywordflow}{break};
291 
292       \textcolor{comment}{//Parse the Prefix Information Option}
293       \hyperlink{slaac_8c_ae32b109335af168f014070a0d139203b}{slaacParsePrefixInfoOption}(context, prefixInfoOption);
294 
295       \textcolor{comment}{//Retrieve the offset to the current position}
296       n = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) prefixInfoOption - \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options;
297       \textcolor{comment}{//Jump to the next option}
298       n += prefixInfoOption->length * 8;
299    \}
300 
301    \textcolor{comment}{//Automatic DNS server configuration?}
302    \textcolor{keywordflow}{if}(!context->settings.manualDnsConfig)
303    \{
304       \textcolor{comment}{//Search for the Recursive DNS Server (RDNSS) option}
305       rdnssOption = \hyperlink{ndp__misc_8c_a6d3addbaab223cf3eab295c590e42f35}{ndpGetOption}(\hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}->options, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length},
306          \hyperlink{ndp_8h_af1e00e3e4e4a40cf7cc766002871bf30a6523a909913ab31f2ca8e6374edd2243}{NDP\_OPT\_RECURSIVE\_DNS\_SERVER});
307 
308       \textcolor{comment}{//RDNSS option found?}
309       \textcolor{keywordflow}{if}(rdnssOption != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && rdnssOption->length >= 1)
310       \{
311          \textcolor{comment}{//Retrieve the number of addresses}
312          n = (rdnssOption->length - 1) / 2;
313 
314          \textcolor{comment}{//Loop through the list of DNS servers}
315          \textcolor{keywordflow}{for}(i = 0; i < n && i < \hyperlink{ipv6_8h_a7ef30c7f719916efa14b509b7ef707a1}{IPV6\_DNS\_SERVER\_LIST\_SIZE}; i++)
316          \{
317             \textcolor{comment}{//Record DNS server address}
318             interface->ipv6Context.dnsServerList[i] = rdnssOption->address[i];
319          \}
320       \}
321    \}
322 
323    \textcolor{comment}{//Any registered callback?}
324    \textcolor{keywordflow}{if}(context->settings.parseRouterAdvCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
325    \{
326       \textcolor{comment}{//Invoke user callback function}
327       context->settings.parseRouterAdvCallback(context, \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message}, \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length});
328    \}
329 
330    \textcolor{comment}{//Check whether a new IPv6 address has been assigned to the interface}
331    \textcolor{keywordflow}{if}(context->configUpdated)
332    \{
333       \textcolor{comment}{//Dump current IPv6 configuration for debugging purpose}
334       \hyperlink{slaac_8c_a60554ee8fa715f5eff42dad6332224fa}{slaacDumpConfig}(context);
335    \}
336 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_a16bfb2d1d2413ec6a9d41829874fb69f}\label{slaac_8c_a16bfb2d1d2413ec6a9d41829874fb69f}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Start@{slaac\+Start}}
\index{slaac\+Start@{slaac\+Start}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Start()}{slaacStart()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} slaac\+Start (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Start S\+L\+A\+AC process. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 122 of file slaac.\+c.


\begin{DoxyCode}
123 \{
124    \hyperlink{net_8h_a2234db8911a1148c9159979d8f5e0d6b}{NetInterface} *interface;
125 
126    \textcolor{comment}{//Check parameter}
127    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
128       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
129 
130    \textcolor{comment}{//Debug message}
131    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Starting SLAAC...\(\backslash\)r\(\backslash\)n"});
132 
133    \textcolor{comment}{//Get exclusive access}
134    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
135 
136    \textcolor{comment}{//Point to the underlying network interface}
137    \textcolor{keyword}{interface }= context->settings.interface;
138 
139    \textcolor{comment}{//Clear the list of IPv6 addresses}
140    \hyperlink{ipv6__misc_8c_afb37c6c9de9b5604c5da82ed368456a8}{ipv6FlushAddrList}(interface);
141 
142    \textcolor{comment}{//Automatic DNS server configuration?}
143    \textcolor{keywordflow}{if}(!context->settings.manualDnsConfig)
144    \{
145       \textcolor{comment}{//Clear the list of DNS servers}
146       \hyperlink{ipv6__misc_8c_a4b3ce94edd9cad3fb3269e805a104b97}{ipv6FlushDnsServerList}(interface);
147    \}
148 
149    \textcolor{comment}{//Check if the link is up?}
150    \textcolor{keywordflow}{if}(interface->linkState)
151    \{
152       \textcolor{comment}{//A link-local address is formed by combining the well-known}
153       \textcolor{comment}{//link-local prefix fe80::/10 with the interface identifier}
154       \hyperlink{slaac_8c_a29114ac0ba9fd8aad8e622083c031234}{slaacGenerateLinkLocalAddr}(context);
155    \}
156 
157    \textcolor{comment}{//Start SLAAC operation}
158    context->running = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
159 
160    \textcolor{comment}{//Release exclusive access}
161    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
162 
163    \textcolor{comment}{//Successful processing}
164    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
165 \}
\end{DoxyCode}
\mbox{\Hypertarget{slaac_8c_ad805b651713d1070adf0f4c17346dcdd}\label{slaac_8c_ad805b651713d1070adf0f4c17346dcdd}} 
\index{slaac.\+c@{slaac.\+c}!slaac\+Stop@{slaac\+Stop}}
\index{slaac\+Stop@{slaac\+Stop}!slaac.\+c@{slaac.\+c}}
\subsubsection{\texorpdfstring{slaac\+Stop()}{slaacStop()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} slaac\+Stop (\begin{DoxyParamCaption}\item[{\hyperlink{slaac_8h_a732edbc322eadbd3b8a4eb9574898d31}{Slaac\+Context} $\ast$}]{context }\end{DoxyParamCaption})}



Stop S\+L\+A\+AC process. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the S\+L\+A\+AC context \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 174 of file slaac.\+c.


\begin{DoxyCode}
175 \{
176    \textcolor{comment}{//Check parameter}
177    \textcolor{keywordflow}{if}(context == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
178       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
179 
180    \textcolor{comment}{//Debug message}
181    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Stopping SLAAC...\(\backslash\)r\(\backslash\)n"});
182 
183    \textcolor{comment}{//Get exclusive access}
184    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
185 
186    \textcolor{comment}{//Suspend SLAAC operation}
187    context->running = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
188 
189    \textcolor{comment}{//Release exclusive access}
190    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{net_8c_afe31551ad26115fae8e575654346d441}{netMutex});
191 
192    \textcolor{comment}{//Successful processing}
193    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
194 \}
\end{DoxyCode}
