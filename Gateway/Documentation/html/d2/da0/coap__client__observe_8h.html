<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Senior Design Gateway: cyclone_tcp/coap/coap_client_observe.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Senior Design Gateway
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A HTTP To MQTT Converted for AWS IoT Core.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/da0/coap__client__observe_8h.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">coap_client_observe.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>CoAP observe.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../d7/d97/net_8h_source.html">core/net.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/dca/coap__client_8h_source.html">coap/coap_client.h</a>&quot;</code><br />
</div>
<p><a href="../../d2/da0/coap__client__observe_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adc6fc309da18ce4890fadf2f7acb9dff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/da0/coap__client__observe_8h.html#adc6fc309da18ce4890fadf2f7acb9dff">coapClientProcessNotification</a> (<a class="el" href="../../da/dca/coap__client_8h.html#a3dac6728ded461f458ffd870eca7afe7">CoapClientRequest</a> *request, const <a class="el" href="../../d4/d21/structCoapMessage.html">CoapMessage</a> *response)</td></tr>
<tr class="memdesc:adc6fc309da18ce4890fadf2f7acb9dff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process notification response.  <a href="#adc6fc309da18ce4890fadf2f7acb9dff">More...</a><br /></td></tr>
<tr class="separator:adc6fc309da18ce4890fadf2f7acb9dff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aab261e07010f49e6b1e5015f491e68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/dfa/compiler__port_8h.html#a812d16e5494522586b3784e55d479912">bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/da0/coap__client__observe_8h.html#a1aab261e07010f49e6b1e5015f491e68">coapClientCheckSequenceNumber</a> (<a class="el" href="../../da/dca/coap__client_8h.html#a3dac6728ded461f458ffd870eca7afe7">CoapClientRequest</a> *request, <a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> v2, <a class="el" href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a> <a class="el" href="../../d9/ddb/pic32mz_2isr__support_8h.html#a2d14ee35cd552c730fe5c5864082226e">t2</a>)</td></tr>
<tr class="memdesc:a1aab261e07010f49e6b1e5015f491e68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the order of arrival for incoming notification.  <a href="#a1aab261e07010f49e6b1e5015f491e68">More...</a><br /></td></tr>
<tr class="separator:a1aab261e07010f49e6b1e5015f491e68"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>CoAP observe. </p>
<h1><a class="anchor" id="License"></a>
License</h1>
<p>SPDX-License-Identifier: GPL-2.0-or-later</p>
<p>Copyright (C) 2010-2019 Oryx Embedded SARL. All rights reserved.</p>
<p>This file is part of CycloneTCP Open.</p>
<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>
<dl class="section author"><dt>Author</dt><dd>Oryx Embedded SARL (www.oryx-embedded.com) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.9.6 </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d2/da0/coap__client__observe_8h_source.html">coap_client_observe.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a1aab261e07010f49e6b1e5015f491e68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1aab261e07010f49e6b1e5015f491e68">&#9670;&nbsp;</a></span>coapClientCheckSequenceNumber()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/dfa/compiler__port_8h.html#a812d16e5494522586b3784e55d479912">bool_t</a> coapClientCheckSequenceNumber </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dca/coap__client_8h.html#a3dac6728ded461f458ffd870eca7afe7">CoapClientRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>v2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a>&#160;</td>
          <td class="paramname"><em>t2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check the order of arrival for incoming notification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>CoAP request handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Value of the Observe option in the incoming notification </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t2</td><td>Client-local timestamp for the incoming notification </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if the incoming notification was sent more recently than the freshest notification so far. Otherwise FALSE is returned </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d5/dcb/coap__client__observe_8c_source.html#l00133">133</a> of file <a class="el" href="../../d5/dcb/coap__client__observe_8c_source.html">coap_client_observe.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;{</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="../../d7/da5/pic32mx_2isr__support_8h.html#aafd40fe8ac88a1eabd8379d8bda0ecb2">v1</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <a class="code" href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a> <a class="code" href="../../d4/d3f/tiger_8c.html#a5017152cac85e29a2dc5d8d74de9e07c">t1</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <a class="code" href="../../d1/dfa/compiler__port_8h.html#a812d16e5494522586b3784e55d479912">bool_t</a> valid;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <span class="comment">//Check current state</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   <span class="keywordflow">if</span>(request-&gt;state != <a class="code" href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d">COAP_REQ_STATE_OBSERVE</a>)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">//The first notification has been received</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      valid = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">//Value of the Observe option in the freshest notification so far</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      v1 = request-&gt;observeSeqNum;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="comment">//Client-local timestamp for the freshest notification so far</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      t1 = request-&gt;retransmitStartTime;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="comment">//An incoming notification was sent more recently than the freshest</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">//notification so far when one of the following conditions is met</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">if</span>(v1 &lt; v2 &amp;&amp; (v2 - v1) &lt; 0x00800000)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;         <span class="comment">//V1 is less than V2 in 24-bit serial number arithmetic</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         valid = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(v1 &gt; v2 &amp;&amp; (v1 - v2) &gt; 0x00800000)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         <span class="comment">//V1 is less than V2 in 24-bit serial number arithmetic</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;         valid = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../da/d42/os__port_8h.html#a25c13833ef003da02045a91b1080263a">timeCompare</a>(<a class="code" href="../../d4/d3f/tiger_8c.html#a42a80c4c472115c0fcb04a076526ecf5">t2</a>, t1 + 128000) &gt; 0)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         <span class="comment">//After 128 seconds have elapsed without any notification, a client</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;         <span class="comment">//does not need to check the sequence numbers to assume that an</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;         <span class="comment">//incoming notification was sent more recently than the freshest</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;         <span class="comment">//notification it has received so far</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;         valid = <a class="code" href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;         <span class="comment">//An out-of-order sequence number has been detected</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;         valid = <a class="code" href="../../da/d42/os__port_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="comment">//Return TRUE if the incoming notification was sent more recently than the</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <span class="comment">//freshest notification so far</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keywordflow">return</span> valid;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="ttc" id="compiler__port_8h_html_ae3e32a98d431a02106616da3071832dd"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a></div><div class="ttdeci">uint32_t systime_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00046">compiler_port.h:46</a></div></div>
<div class="ttc" id="os__port_8h_html_a25c13833ef003da02045a91b1080263a"><div class="ttname"><a href="../../da/d42/os__port_8h.html#a25c13833ef003da02045a91b1080263a">timeCompare</a></div><div class="ttdeci">#define timeCompare(t1, t2)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00042">os_port.h:42</a></div></div>
<div class="ttc" id="pic32mx_2isr__support_8h_html_aafd40fe8ac88a1eabd8379d8bda0ecb2"><div class="ttname"><a href="../../d7/da5/pic32mx_2isr__support_8h.html#aafd40fe8ac88a1eabd8379d8bda0ecb2">v1</a></div><div class="ttdeci">macro portSAVE_CONTEXT mfc0 _CP0_CAUSE addiu portCONTEXT_SIZE mfc0 _CP0_STATUS sw sp sw sp sw ins ins add sp la uxInterruptNesting lw k0 bne nop la xISRStackTop lw sw k0 mfc0 _CP0_EPC mtc0 _CP0_STATUS sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw s5 sw v1</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/da5/pic32mx_2isr__support_8h_source.html#l00051">isr_support.h:51</a></div></div>
<div class="ttc" id="os__port_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../da/d42/os__port_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00050">os_port.h:50</a></div></div>
<div class="ttc" id="stdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00080">stdint.h:80</a></div></div>
<div class="ttc" id="tiger_8c_html_a42a80c4c472115c0fcb04a076526ecf5"><div class="ttname"><a href="../../d4/d3f/tiger_8c.html#a42a80c4c472115c0fcb04a076526ecf5">t2</a></div><div class="ttdeci">static const uint64_t t2[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3f/tiger_8c_source.html#l00150">tiger.c:150</a></div></div>
<div class="ttc" id="coap__client__request_8h_html_ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d"><div class="ttname"><a href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d">COAP_REQ_STATE_OBSERVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d40/coap__client__request_8h_source.html#l00056">coap_client_request.h:56</a></div></div>
<div class="ttc" id="tiger_8c_html_a5017152cac85e29a2dc5d8d74de9e07c"><div class="ttname"><a href="../../d4/d3f/tiger_8c.html#a5017152cac85e29a2dc5d8d74de9e07c">t1</a></div><div class="ttdeci">static const uint64_t t1[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3f/tiger_8c_source.html#l00081">tiger.c:81</a></div></div>
<div class="ttc" id="os__port_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="../../da/d42/os__port_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d42/os__port_8h_source.html#l00046">os_port.h:46</a></div></div>
<div class="ttc" id="compiler__port_8h_html_a812d16e5494522586b3784e55d479912"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#a812d16e5494522586b3784e55d479912">bool_t</a></div><div class="ttdeci">int bool_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00049">compiler_port.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc6fc309da18ce4890fadf2f7acb9dff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc6fc309da18ce4890fadf2f7acb9dff">&#9670;&nbsp;</a></span>coapClientProcessNotification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> coapClientProcessNotification </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dca/coap__client_8h.html#a3dac6728ded461f458ffd870eca7afe7">CoapClientRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/d21/structCoapMessage.html">CoapMessage</a> *&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process notification response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>CoAP request handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">response</td><td>Pointer to the response message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d5/dcb/coap__client__observe_8c_source.html#l00054">54</a> of file <a class="el" href="../../d5/dcb/coap__client__observe_8c_source.html">coap_client_observe.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <a class="code" href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a> error;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <a class="code" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="../../d3/d25/dtls__misc_8h.html#a74bce8e92ccabd0c885447114a48b80e">value</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <a class="code" href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a> <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#ae73654f333e4363463ad8c594eca1905">time</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="comment">//The only difference between a notification and a normal response</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   <span class="comment">//is the presence of the Observe option</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   error = <a class="code" href="../../dd/d95/coap__option_8c.html#a4098de0a9fbec04954546ce1978572d9">coapGetUintOption</a>(response, <a class="code" href="../../db/d65/coap__option_8h.html#ab833642841b9ddc4cab90acf5cffb0e7ac327e2341a2ed78310270fa285b0a7d9">COAP_OPT_OBSERVE</a>, 0, &amp;value);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="comment">//Observe option included in the response?</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   <span class="keywordflow">if</span>(!error)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="comment">//Get current time</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      time = <a class="code" href="../../dd/d0d/os__port__chibios_8c.html#ab66a11272d40a916fa69dd8e4dc443d4">osGetSystemTime</a>();</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="comment">//Check the order of arrival for incoming notification</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d5/dcb/coap__client__observe_8c.html#a1aab261e07010f49e6b1e5015f491e68">coapClientCheckSequenceNumber</a>(request, value, time))</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;         <span class="comment">//Save the value of the Observe option</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;         request-&gt;observeSeqNum = <a class="code" href="../../d3/d25/dtls__misc_8h.html#a74bce8e92ccabd0c885447114a48b80e">value</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;         <span class="comment">//Save the time at which the notification was received</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         request-&gt;retransmitStartTime = <a class="code" href="../../d1/ddf/dhcpv6__common_8h.html#ae73654f333e4363463ad8c594eca1905">time</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         <span class="comment">//Search the CoAP response for a Max-Age option</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;         error = <a class="code" href="../../dd/d95/coap__option_8c.html#a4098de0a9fbec04954546ce1978572d9">coapGetUintOption</a>(response, <a class="code" href="../../db/d65/coap__option_8h.html#ab833642841b9ddc4cab90acf5cffb0e7ae1d2594f4e92d466cd196de5656aa449">COAP_OPT_MAX_AGE</a>, 0, &amp;value);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         <span class="comment">//Max-Age option not included in the response?</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;         <span class="keywordflow">if</span>(error)</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;         {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">//A default value of 60 seconds is assumed in the absence of the</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="comment">//option in a response</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            value = <a class="code" href="../../db/d65/coap__option_8h.html#a171a87c853e3bd8ecc0d0bcd84cf3fc7">COAP_DEFAULT_MAX_AGE</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;         }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;         <span class="comment">//A notification is considered fresh while its age is not greater</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;         <span class="comment">//than the value indicated by the Max-Age option</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;         request-&gt;retransmitTimeout = value * 1000;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;         <span class="comment">//Additionally, the client should at least wait for a random amount</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;         <span class="comment">//of time between 5 and 15 seconds after Max-Age expired to reduce</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;         <span class="comment">//collisions with other clients (refer to RFC 7641, section 3.3.1)</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;         request-&gt;retransmitTimeout += <a class="code" href="../../d7/d5f/net_8c.html#af45ea0afc9806749114ec85e507014e1">netGetRandRange</a>(<a class="code" href="../../da/dca/coap__client_8h.html#a1af981fb807fd5ccd6a0f8716ac6488d">COAP_CLIENT_RAND_DELAY_MIN</a>,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <a class="code" href="../../da/dca/coap__client_8h.html#ad06bf355fe7fdeaa05d9a8f58b471242">COAP_CLIENT_RAND_DELAY_MAX</a>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;         <span class="comment">//The user is notified of changes to the resource state</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;         error = <a class="code" href="../../db/d56/coap__client__misc_8c.html#a937370fda4c0d4c5b8c9b559127f8a27">coapClientChangeRequestState</a>(request,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <a class="code" href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d">COAP_REQ_STATE_OBSERVE</a>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;         <span class="comment">//Drop the incoming notification...</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;         <a class="code" href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>(<span class="stringliteral">&quot;Out-of-order notification received!\r\n&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="comment">//The client is notified of changes to the resource state</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <a class="code" href="../../db/d56/coap__client__misc_8c.html#a937370fda4c0d4c5b8c9b559127f8a27">coapClientChangeRequestState</a>(request, <a class="code" href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d">COAP_REQ_STATE_OBSERVE</a>);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="comment">//The observation has been canceled</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      error = <a class="code" href="../../db/d56/coap__client__misc_8c.html#a937370fda4c0d4c5b8c9b559127f8a27">coapClientChangeRequestState</a>(request, <a class="code" href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946">COAP_REQ_STATE_CANCELED</a>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <span class="comment">//Return status code</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div><div class="ttc" id="compiler__port_8h_html_ae3e32a98d431a02106616da3071832dd"><div class="ttname"><a href="../../d1/dfa/compiler__port_8h.html#ae3e32a98d431a02106616da3071832dd">systime_t</a></div><div class="ttdeci">uint32_t systime_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dfa/compiler__port_8h_source.html#l00046">compiler_port.h:46</a></div></div>
<div class="ttc" id="coap__option_8h_html_a171a87c853e3bd8ecc0d0bcd84cf3fc7"><div class="ttname"><a href="../../db/d65/coap__option_8h.html#a171a87c853e3bd8ecc0d0bcd84cf3fc7">COAP_DEFAULT_MAX_AGE</a></div><div class="ttdeci">#define COAP_DEFAULT_MAX_AGE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d65/coap__option_8h_source.html#l00054">coap_option.h:54</a></div></div>
<div class="ttc" id="os__port__chibios_8c_html_ab66a11272d40a916fa69dd8e4dc443d4"><div class="ttname"><a href="../../dd/d0d/os__port__chibios_8c.html#ab66a11272d40a916fa69dd8e4dc443d4">osGetSystemTime</a></div><div class="ttdeci">systime_t osGetSystemTime(void)</div><div class="ttdoc">Retrieve system time. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0d/os__port__chibios_8c_source.html#l00490">os_port_chibios.c:490</a></div></div>
<div class="ttc" id="dhcpv6__common_8h_html_ae73654f333e4363463ad8c594eca1905"><div class="ttname"><a href="../../d1/ddf/dhcpv6__common_8h.html#ae73654f333e4363463ad8c594eca1905">time</a></div><div class="ttdeci">uint32_t time</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddf/dhcpv6__common_8h_source.html#l00169">dhcpv6_common.h:169</a></div></div>
<div class="ttc" id="coap__client__observe_8c_html_a1aab261e07010f49e6b1e5015f491e68"><div class="ttname"><a href="../../d5/dcb/coap__client__observe_8c.html#a1aab261e07010f49e6b1e5015f491e68">coapClientCheckSequenceNumber</a></div><div class="ttdeci">bool_t coapClientCheckSequenceNumber(CoapClientRequest *request, uint32_t v2, systime_t t2)</div><div class="ttdoc">Check the order of arrival for incoming notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dcb/coap__client__observe_8c_source.html#l00133">coap_client_observe.c:133</a></div></div>
<div class="ttc" id="coap__client_8h_html_ad06bf355fe7fdeaa05d9a8f58b471242"><div class="ttname"><a href="../../da/dca/coap__client_8h.html#ad06bf355fe7fdeaa05d9a8f58b471242">COAP_CLIENT_RAND_DELAY_MAX</a></div><div class="ttdeci">#define COAP_CLIENT_RAND_DELAY_MAX</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/coap__client_8h_source.html#l00119">coap_client.h:119</a></div></div>
<div class="ttc" id="coap__client_8h_html_a1af981fb807fd5ccd6a0f8716ac6488d"><div class="ttname"><a href="../../da/dca/coap__client_8h.html#a1af981fb807fd5ccd6a0f8716ac6488d">COAP_CLIENT_RAND_DELAY_MIN</a></div><div class="ttdeci">#define COAP_CLIENT_RAND_DELAY_MIN</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/coap__client_8h_source.html#l00112">coap_client.h:112</a></div></div>
<div class="ttc" id="coap__client__request_8h_html_ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946"><div class="ttname"><a href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946">COAP_REQ_STATE_CANCELED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d40/coap__client__request_8h_source.html#l00060">coap_client_request.h:60</a></div></div>
<div class="ttc" id="coap__client__misc_8c_html_a937370fda4c0d4c5b8c9b559127f8a27"><div class="ttname"><a href="../../db/d56/coap__client__misc_8c.html#a937370fda4c0d4c5b8c9b559127f8a27">coapClientChangeRequestState</a></div><div class="ttdeci">error_t coapClientChangeRequestState(CoapClientRequest *request, CoapRequestState newState)</div><div class="ttdoc">Update CoAP request state. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d56/coap__client__misc_8c_source.html#l00339">coap_client_misc.c:339</a></div></div>
<div class="ttc" id="stdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/stdint_8h_source.html#l00080">stdint.h:80</a></div></div>
<div class="ttc" id="coap__client__request_8h_html_ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d"><div class="ttname"><a href="../../d8/d40/coap__client__request_8h.html#ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d">COAP_REQ_STATE_OBSERVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d40/coap__client__request_8h_source.html#l00056">coap_client_request.h:56</a></div></div>
<div class="ttc" id="debug_8h_html_a7339bfd784193a5c79efcef2eeb2d6df"><div class="ttname"><a href="../../db/d16/debug_8h.html#a7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a></div><div class="ttdeci">#define TRACE_INFO(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00094">debug.h:94</a></div></div>
<div class="ttc" id="net_8c_html_af45ea0afc9806749114ec85e507014e1"><div class="ttname"><a href="../../d7/d5f/net_8c.html#af45ea0afc9806749114ec85e507014e1">netGetRandRange</a></div><div class="ttdeci">int32_t netGetRandRange(int32_t min, int32_t max)</div><div class="ttdoc">Get a random value in the specified range. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5f/net_8c_source.html#l01842">net.c:1842</a></div></div>
<div class="ttc" id="error_8h_html_ac7659d73a8cdedc08e9f566bb406689c"><div class="ttname"><a href="../../da/d41/error_8h.html#ac7659d73a8cdedc08e9f566bb406689c">error_t</a></div><div class="ttdeci">error_t</div><div class="ttdoc">Error codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d41/error_8h_source.html#l00042">error.h:42</a></div></div>
<div class="ttc" id="dtls__misc_8h_html_a74bce8e92ccabd0c885447114a48b80e"><div class="ttname"><a href="../../d3/d25/dtls__misc_8h.html#a74bce8e92ccabd0c885447114a48b80e">value</a></div><div class="ttdeci">uint8_t value[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d25/dtls__misc_8h_source.html#l00150">dtls_misc.h:150</a></div></div>
<div class="ttc" id="coap__option_8c_html_a4098de0a9fbec04954546ce1978572d9"><div class="ttname"><a href="../../dd/d95/coap__option_8c.html#a4098de0a9fbec04954546ce1978572d9">coapGetUintOption</a></div><div class="ttdeci">error_t coapGetUintOption(const CoapMessage *message, uint16_t optionNum, uint_t optionIndex, uint32_t *optionValue)</div><div class="ttdoc">Get the value of the specified uint option. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d95/coap__option_8c_source.html#l00651">coap_option.c:651</a></div></div>
<div class="ttc" id="coap__option_8h_html_ab833642841b9ddc4cab90acf5cffb0e7ac327e2341a2ed78310270fa285b0a7d9"><div class="ttname"><a href="../../db/d65/coap__option_8h.html#ab833642841b9ddc4cab90acf5cffb0e7ac327e2341a2ed78310270fa285b0a7d9">COAP_OPT_OBSERVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d65/coap__option_8h_source.html#l00096">coap_option.h:96</a></div></div>
<div class="ttc" id="coap__option_8h_html_ab833642841b9ddc4cab90acf5cffb0e7ae1d2594f4e92d466cd196de5656aa449"><div class="ttname"><a href="../../db/d65/coap__option_8h.html#ab833642841b9ddc4cab90acf5cffb0e7ae1d2594f4e92d466cd196de5656aa449">COAP_OPT_MAX_AGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d65/coap__option_8h_source.html#l00101">coap_option.h:101</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_7e9256e5f59bdf4e670955c020ed8bf3.html">cyclone_tcp</a></li><li class="navelem"><a class="el" href="../../dir_33225cc519f5bbea9b788a474db69144.html">coap</a></li><li class="navelem"><a class="el" href="../../d2/da0/coap__client__observe_8h.html">coap_client_observe.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
