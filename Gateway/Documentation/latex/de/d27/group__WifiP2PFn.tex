\hypertarget{group__WifiP2PFn}{}\section{m2m\+\_\+wifi\+\_\+p2p}
\label{group__WifiP2PFn}\index{m2m\+\_\+wifi\+\_\+p2p@{m2m\+\_\+wifi\+\_\+p2p}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} \hyperlink{group__WifiP2PFn_ga9d2daba93e1e2e33bde42edd359eb2f2}{m2m\+\_\+wifi\+\_\+p2p} (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8\+Channel, \hyperlink{group__WlanEnums_ga0b97cca65d26d6163cabcb708e5759df}{tenu\+P2\+P\+Trigger} enu\+Trigger, \hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16} u16\+W\+P\+S\+\_\+\+Cfg\+Mehods)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Asynchronous Wi-\/\+Fi direct (P2P) enabling mode function. The W\+I\+LC supports P2P in device listening mode O\+N\+LY (intent is Z\+E\+RO). The W\+I\+LC P2P implementation does not support P2P GO (Group Owner) mode. Active P2P devices (e.\+g. phones) could find the W\+I\+LC in the search list. When the P2P GO Peer device place provisional discovery request, a Wi-\/\+Fi notification event \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57dea4e202c60cd4154e5c0c247e0fa8c990f}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+Q\+\_\+\+P2\+P\+\_\+\+A\+U\+TH} is triggered with config methods opted by peer device. In response to callback event M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+Q\+\_\+\+P2\+P\+\_\+\+A\+U\+TH, the Application should send response back to W\+I\+LC with either \hyperlink{m2m__wifi_8h_a25d63ac165f19310f6ed73d115ad9155}{m2m\+\_\+wifi\+\_\+allow\+\_\+p2p\+\_\+connection()} A\+PI in case of C\+O\+N\+F\+\_\+\+M\+E\+T\+H\+O\+D\+\_\+\+P\+BC, or \hyperlink{group__WlanEnums_gac93d56dc53ba0a5a02b669c800b7ae62}{m2m\+\_\+wifi\+\_\+set\+\_\+p2p\+\_\+pin()} for C\+O\+N\+F\+\_\+\+M\+E\+T\+H\+O\+D\+\_\+\+D\+I\+S\+P\+L\+AY \& C\+O\+N\+F\+\_\+\+M\+E\+T\+H\+O\+D\+\_\+\+K\+E\+Y\+P\+AD (pin request) to allow P2P connection. However, the application can ignore the event to reject the p2p connection request. When a device is connected to W\+I\+LC, a Wi-\/\+Fi notification event \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57deabb42b3025c56c51d915a1fa4abd2dbd0}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+S\+P\+\_\+\+C\+O\+N\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+H\+A\+N\+G\+ED} is triggered. Refer to the code examples for a more illustrative example. 

\subsection{Function Documentation}
\mbox{\Hypertarget{group__WifiP2PFn_ga9d2daba93e1e2e33bde42edd359eb2f2}\label{group__WifiP2PFn_ga9d2daba93e1e2e33bde42edd359eb2f2}} 
\index{m2m\+\_\+wifi\+\_\+p2p@{m2m\+\_\+wifi\+\_\+p2p}!m2m\+\_\+wifi\+\_\+p2p@{m2m\+\_\+wifi\+\_\+p2p}}
\index{m2m\+\_\+wifi\+\_\+p2p@{m2m\+\_\+wifi\+\_\+p2p}!m2m\+\_\+wifi\+\_\+p2p@{m2m\+\_\+wifi\+\_\+p2p}}
\subsubsection{\texorpdfstring{m2m\+\_\+wifi\+\_\+p2p()}{m2m\_wifi\_p2p()}}
{\footnotesize\ttfamily \hyperlink{group__BSPDefine_gaecc0323d771e41ef81a76b5f12783e22}{N\+M\+I\+\_\+\+A\+PI} \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} m2m\+\_\+wifi\+\_\+p2p (\begin{DoxyParamCaption}\item[{\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}}]{u8\+Channel,  }\item[{\hyperlink{group__WlanEnums_ga0b97cca65d26d6163cabcb708e5759df}{tenu\+P2\+P\+Trigger}}]{enu\+Trigger,  }\item[{\hyperlink{group__DataT_ga1daa745171fc6e31d942c161422a76f9}{uint16}}]{u16\+W\+P\+S\+\_\+\+Cfg\+Mehods }\end{DoxyParamCaption})}



{\ttfamily \#include $<$\hyperlink{m2m__wifi_8h}{third\+\_\+party/atmel/devices/wilc1000/driver/include/m2m\+\_\+wifi.\+h}$>$}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em u8\+Channel} & P2P Listen RF channel. According to the P2P standard It must hold only one of the following values 1, 6 or 11.\\
\hline
\mbox{\tt in}  & {\em enu\+Trigger} & P2P Trigger method. Could be\+:
\begin{DoxyItemize}
\item \mbox{[}P2\+P\+\_\+\+P\+IN\mbox{]} Push button method
\item \mbox{[}P2\+P\+\_\+\+P\+BC\mbox{]} Pin method
\end{DoxyItemize}\\
\hline
\mbox{\tt in}  & {\em u16\+W\+P\+S\+\_\+\+Cfg\+Mehods} & W\+SC Config methods \mbox{[}\char`\"{}\+Device configuration methods\char`\"{} in m2m\+\_\+types.\+h\mbox{]}\\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}

\begin{DoxyItemize}
\item A Wi-\/\+Fi notification callback of type \hyperlink{group__WlanEnums_gac5302f32839285fe8375c159087aa8a1}{tpf\+App\+Wifi\+Cb} M\+U\+ST be implemented and registered at initialization. Registering the callback is done through passing it to the \hyperlink{group__WifiInitFn_ga73c734812e844d96d860c4e93e9daf35}{m2m\+\_\+wifi\+\_\+init}.
\item The events \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57deabb42b3025c56c51d915a1fa4abd2dbd0}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+S\+P\+\_\+\+C\+O\+N\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+H\+A\+N\+G\+ED} must be handled in the callback.
\item The events \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57dea4e202c60cd4154e5c0c247e0fa8c990f}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+Q\+\_\+\+P2\+P\+\_\+\+A\+U\+TH} must be handled in the callback.
\item The \hyperlink{group__WifiHandleEventsFn_ga461a4edc057cec8c00cf124a07aa3b02}{m2m\+\_\+wifi\+\_\+handle\+\_\+events} M\+U\+ST be called to receive the responses in the callback.
\end{DoxyItemize}
\end{DoxyPrecond}
\begin{DoxyWarning}{Warning}
This function is not allowed in AP or S\+TA modes.
\end{DoxyWarning}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__WlanEnums_gac5302f32839285fe8375c159087aa8a1}{tpf\+App\+Wifi\+Cb} \hyperlink{group__WifiInitFn_ga73c734812e844d96d860c4e93e9daf35}{m2m\+\_\+wifi\+\_\+init} \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57deabb42b3025c56c51d915a1fa4abd2dbd0}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+S\+P\+\_\+\+C\+O\+N\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+H\+A\+N\+G\+ED} \hyperlink{structtstrM2mWifiStateChanged}{tstr\+M2m\+Wifi\+State\+Changed} \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57dea4e202c60cd4154e5c0c247e0fa8c990f}{M2\+M\+\_\+\+W\+I\+F\+I\+\_\+\+R\+E\+Q\+\_\+\+P2\+P\+\_\+\+A\+U\+TH} \hyperlink{structtstrM2MP2pDevInfo}{tstr\+M2\+M\+P2p\+Dev\+Info} \hyperlink{group__WlanEnums_ga0b97cca65d26d6163cabcb708e5759df}{tenu\+P2\+P\+Trigger} \hyperlink{group__WlanEnums_gac93d56dc53ba0a5a02b669c800b7ae62}{m2m\+\_\+wifi\+\_\+set\+\_\+p2p\+\_\+pin} \hyperlink{m2m__wifi_8h_a25d63ac165f19310f6ed73d115ad9155}{m2m\+\_\+wifi\+\_\+allow\+\_\+p2p\+\_\+connection}
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
The function returns \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2\+M\+\_\+\+S\+U\+C\+C\+E\+SS} for successful operations and a negative value otherwise. 
\end{DoxyReturn}
\hypertarget{group__WifiEnableMonitorModeFn_Example}{}\subsection{Example}\label{group__WifiEnableMonitorModeFn_Example}
The code snippet shown an example of how the p2p mode operates. 
\begin{DoxyCode}
\textcolor{preprocessor}{#include "\hyperlink{m2m__wifi_8h}{m2m\_wifi.h}"}
\textcolor{preprocessor}{#include "\hyperlink{m2m__types_8h}{m2m\_types.h}"}

\textcolor{keywordtype}{void} wifi\_event\_cb(\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8} u8WiFiEvent, \textcolor{keywordtype}{void} * pvMsg)
\{
    \textcolor{keywordflow}{switch}(u8WiFiEvent)
    \{
    \textcolor{keywordflow}{case} \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57deabb42b3025c56c51d915a1fa4abd2dbd0}{M2M\_WIFI\_RESP\_CON\_STATE\_CHANGED}:
        \{
            \hyperlink{structtstrM2mWifiStateChanged}{tstrM2mWifiStateChanged} *pstrWifiState = (
      \hyperlink{structtstrM2mWifiStateChanged}{tstrM2mWifiStateChanged}*)pvMsg;
            \hyperlink{nm__common_8h_a84108eca2655e811179386a39c62acf2}{M2M\_INFO}(\textcolor{stringliteral}{"Wifi State :: %s :: ErrCode %d\(\backslash\)r\(\backslash\)n"}, pstrWifiState->
      \hyperlink{structtstrM2mWifiStateChanged_a8cf6acc2d9640b20629c6b8383534dfa}{u8CurrState}? \textcolor{stringliteral}{"CONNECTED"}:\textcolor{stringliteral}{"DISCONNECTED"},pstrWifiState->\hyperlink{structtstrM2mWifiStateChanged_a6eec99c8a4c5c0c0db084dfe571507eb}{u8ErrCode});
            
            \textcolor{comment}{// Do something}
        \}
        \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{group__WlanEnums_gga064de09dec1d5e88ed8d075fa40f57dea4e202c60cd4154e5c0c247e0fa8c990f}{M2M\_WIFI\_REQ\_P2P\_AUTH}:
    \{
        \hyperlink{structtstrM2MP2pDevInfo}{tstrM2MP2pDevInfo} *pstrP2PDevInfo = (\hyperlink{structtstrM2MP2pDevInfo}{tstrM2MP2pDevInfo} *)pvMsg;
        \textcolor{keywordflow}{if} (pstrP2PDevInfo->\hyperlink{structtstrM2MP2pDevInfo_a3b622ee5784fce40ab909b791d648535}{u16CfgMethods} & \hyperlink{group__WlanDefines_gad704d19b15d73ed94b3fd1d6680d64fd}{CONF\_METHOD\_KEYPAD}) \{
            osprintf(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPlease enter P2P pin\(\backslash\)r\(\backslash\)n(Usage: P2P\_PIN <pin-number displayed on phone>\(\backslash\)r\(\backslash\)n"});
        \}
        \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pstrP2PDevInfo->\hyperlink{structtstrM2MP2pDevInfo_a3b622ee5784fce40ab909b791d648535}{u16CfgMethods} & CONF\_MEHTOD\_DISPLAY)\{
            osprintf(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)nPlease enter P2P pin on phone <12345678>\(\backslash\)r\(\backslash\)n"});
                \hyperlink{m2m__wifi__ex_8h_a1c41efeb5037d1e0cc6b72dfe45a914c}{os\_m2m\_wifi\_set\_p2p\_pin}((\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *)\textcolor{stringliteral}{"12345678"}, 8);
        \}
        \textcolor{keywordflow}{else} \{
            \hyperlink{m2m__wifi_8h_a25d63ac165f19310f6ed73d115ad9155}{m2m\_wifi\_allow\_p2p\_connection}();
        \}
        \textcolor{keywordflow}{break};
    \}
    \textcolor{keywordflow}{default}:
        \textcolor{keywordflow}{break};
    \}
\}

\textcolor{keywordtype}{int} \hyperlink{demo_2microchip_2pic32mz__ef__curiosity_2wifi__http__server__demo_2src_2main_8c_ac5a1eca594b063e0d2dbccf86f96f221}{main}()
\{
    \hyperlink{structtstrWifiInitParam}{tstrWifiInitParam}   param;
    
    param.\hyperlink{group__WifiSetCustInfoElementFn_ga13d5fa7a0c71fd59bbf36a61923835cc}{pfAppWifiCb}   = wifi\_event\_cb;
    \textcolor{keywordflow}{if}(!\hyperlink{group__WifiInitFn_ga73c734812e844d96d860c4e93e9daf35}{m2m\_wifi\_init}(&param))
    \{
        \textcolor{comment}{// Trigger P2P}
        \hyperlink{group__WifiP2PFn_ga9d2daba93e1e2e33bde42edd359eb2f2}{m2m\_wifi\_p2p}(1, \hyperlink{group__WlanEnums_gga0b97cca65d26d6163cabcb708e5759dfacf766568f64b21ce7adc08da42cf6ffd}{P2P\_PBC}, \hyperlink{group__WlanDefines_ga4273f9b891dd72f73aeb09332355c451}{CONF\_METHOD\_PHYSICAL\_PBC}|
      \hyperlink{group__WlanDefines_ga43a9727ecabb94295de8032b3cafb43e}{CONF\_METHOD\_LABEL});
        
        \textcolor{keywordflow}{while}(1)
        \{
            \hyperlink{group__WifiHandleEventsFn_ga461a4edc057cec8c00cf124a07aa3b02}{m2m\_wifi\_handle\_events}(\hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
        \}
    \}
\}
\end{DoxyCode}
 

Definition at line 522 of file m2m\+\_\+wifi.\+c.


\begin{DoxyCode}
523 \{
524     \hyperlink{group__DataT_gae35f10ffd0ac8dd2bc3e794da9bdfbc7}{sint8} ret = \hyperlink{nm__common_8h_a9ef27ba27aafdd1aa3a79d3ba2c36b8f}{M2M\_SUCCESS};
525     \textcolor{keywordflow}{if}((u8Channel == \hyperlink{group__WlanEnums_gga2a91dd671e2672dba1a7ed45230f3a99a1af3aecfb8fb74254076d723c1e1dd58}{M2M\_WIFI\_CH\_1}) || (u8Channel == \hyperlink{group__WlanEnums_gga2a91dd671e2672dba1a7ed45230f3a99a8517af2d89289a385bb223c31bc40aef}{M2M\_WIFI\_CH\_6}) || (u8Channel
       == \hyperlink{group__WlanEnums_gga2a91dd671e2672dba1a7ed45230f3a99aa3fc08014dba7e86b5affaea68eddbff}{M2M\_WIFI\_CH\_11}))
526     \{
527         \hyperlink{structtstrM2MP2PConnect}{tstrM2MP2PConnect}* pstrtmp = &guCtrlStruct.strM2MP2PConnect;
528         pstrtmp->\hyperlink{structtstrM2MP2PConnect_a6c92e28e2b614f6f024cc69d2da27c51}{u8ListenChannel} = u8Channel;
529         pstrtmp->\hyperlink{structtstrM2MP2PConnect_a760354e813b16c4b71f716a365f1347e}{enuTrigger} = enuTrigger;
530         pstrtmp->\hyperlink{structtstrM2MP2PConnect_aa4e2e9393359cd24e0c75136a0515f75}{u16WPS\_CfgMethods} = u16WPS\_CfgMehods;
531 
532         ret = \hyperlink{m2m__hif_8c_a13ba8ad11b2ac39516ca787386d16ce0}{hif\_send}(\hyperlink{nm__common_8h_a9ab02eb1aea02a75c3f5aade4eef1276aeb9a7d57324ba4b8a6c2a5f46dd499c2}{M2M\_REQ\_GRP\_WIFI}, 
      \hyperlink{group__WlanEnums_ggac07a15ce7dd9a5508a5cff22ce91f65ca90a1df2d26da91a705178e5a650292c2}{M2M\_WIFI\_REQ\_ENABLE\_P2P}, (\hyperlink{group__DataT_ga4df709a77647e870bbf1d955b8edc9a6}{uint8}*)pstrtmp, \textcolor{keyword}{sizeof}(
      \hyperlink{structtstrM2MP2PConnect}{tstrM2MP2PConnect}), \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0,0);
533     \}
534     \textcolor{keywordflow}{else}
535     \{
536         \hyperlink{nm__common_8h_a34d005df494e50b05cd38b80f318d7ac}{M2M\_ERR}(\textcolor{stringliteral}{"Listen channel should only be 1, 6 or 11\(\backslash\)r\(\backslash\)n"});
537         ret = \hyperlink{nm__common_8h_a39ed05df730834f2255971ca9879996e}{M2M\_ERR\_FAIL};
538     \}
539 
540     \textcolor{keywordflow}{return} ret;
541 \}
\end{DoxyCode}
