\hypertarget{coap__client__misc_8c}{}\section{cyclone\+\_\+tcp/coap/coap\+\_\+client\+\_\+misc.c File Reference}
\label{coap__client__misc_8c}\index{cyclone\+\_\+tcp/coap/coap\+\_\+client\+\_\+misc.\+c@{cyclone\+\_\+tcp/coap/coap\+\_\+client\+\_\+misc.\+c}}


Helper functions for Co\+AP client.  


{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}core/net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+client.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+client\+\_\+observe.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+client\+\_\+transport.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+client\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coap/coap\+\_\+debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}error.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{coap__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{net__config_8h_a7725033334034dcb4eb808f148f791fb}{C\+O\+A\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_aeb4d9d3f14c4fe35cf886dd06fd737ee}{coap\+Client\+Process\+Events} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t} timeout)
\begin{DoxyCompactList}\small\item\em Process Co\+AP client events. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a4296042d22777e8a867e5f0cc0e0d1c5}{coap\+Client\+Process\+Request\+Events} (\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$request)
\begin{DoxyCompactList}\small\item\em Process request-\/specific events. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coap\+Client\+Change\+Request\+State} (\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$request, \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04}{Coap\+Request\+State} new\+State)
\begin{DoxyCompactList}\small\item\em Update Co\+AP request state. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_ae42f0294612b0be2de9063b092ec4370}{coap\+Client\+Match\+Response} (const \hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$request, const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Check whether a response matches the specified request. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a65c8ad0dd27961d2916649dcf61ad8fd}{coap\+Client\+Process\+Response} (\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$request, const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Process Co\+AP response. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a368ed24d35935d0a5c5c07fb926d1355}{coap\+Client\+Reject\+Response} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$response)
\begin{DoxyCompactList}\small\item\em Reject a Co\+AP response. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a012b0df3cfb833d9b3bd0f2adda2dd5d}{coap\+Client\+Send\+Ack} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid})
\begin{DoxyCompactList}\small\item\em Send Acknowledgment message. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{coap__client__misc_8c_a6553f9a2a188a645e7a68b766197d3b5}{coap\+Client\+Send\+Reset} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid})
\begin{DoxyCompactList}\small\item\em Send Reset message. \end{DoxyCompactList}\item 
void \hyperlink{coap__client__misc_8c_a1fc420ff503f63a5358c0a7fcbd92440}{coap\+Client\+Generate\+Message\+Id} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$header)
\begin{DoxyCompactList}\small\item\em Generate a new message identifier. \end{DoxyCompactList}\item 
void \hyperlink{coap__client__misc_8c_a01d65fc39c4d6b8d1c3bb0e77e7d9c19}{coap\+Client\+Generate\+Token} (\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$context, \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$header)
\begin{DoxyCompactList}\small\item\em Generate a new token. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Helper functions for Co\+AP client. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+T\+CP Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{coap__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{coap__client__misc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{net__config_8h_a7725033334034dcb4eb808f148f791fb}{C\+O\+A\+P\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file coap\+\_\+client\+\_\+misc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}\label{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Change\+Request\+State@{coap\+Client\+Change\+Request\+State}}
\index{coap\+Client\+Change\+Request\+State@{coap\+Client\+Change\+Request\+State}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Change\+Request\+State()}{coapClientChangeRequestState()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Change\+Request\+State (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$}]{request,  }\item[{\hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04}{Coap\+Request\+State}}]{new\+State }\end{DoxyParamCaption})}



Update Co\+AP request state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em request} & Co\+AP request handle \\
\hline
\mbox{\tt in}  & {\em new\+State} & New state to switch to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 339 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
341 \{
342    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
343    \hyperlink{coap__client__request_8h_aebefd74fc8bc46499af62dc3bbd49eef}{CoapRequestStatus} status;
344    \hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{CoapClientContext} *context;
345 
346    \textcolor{comment}{//Initialize status code}
347    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
348 
349    \textcolor{comment}{//Point to the CoAP client context}
350    context = request->context;
351 
352    \textcolor{comment}{//Switch to the new state}
353    request->state = newState;
354 
355    \textcolor{comment}{//Check whether a request is ready to be transmitted}
356    \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04aa070e9fb3f832e7a98835c487f22d90c}{COAP\_REQ\_STATE\_TRANSMIT})
357    \{
358       \textcolor{comment}{//Notify the CoAP client}
359       \hyperlink{os__port__chibios_8c_afc1d64fc90afbf03baecfa636bb99ff7}{osSetEvent}(&context->event);
360    \}
361 
362    \textcolor{comment}{//The CoAP client operates in asynchronous mode when a callback function}
363    \textcolor{comment}{//has been defined}
364    \textcolor{keywordflow}{if}(request->callback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
365    \{
366       \textcolor{comment}{//Check whether the request has terminated}
367       \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d}{COAP\_REQ\_STATE\_OBSERVE} ||
368          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a09b36647354387ef7abf74d6da75aaee}{COAP\_REQ\_STATE\_DONE} ||
369          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a2eaac1822fea07b6a1d6a47aa2f1a695}{COAP\_REQ\_STATE\_RESET} ||
370          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT} ||
371          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946}{COAP\_REQ\_STATE\_CANCELED})
372       \{
373          \textcolor{comment}{//Get the status of the request}
374          \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a2eaac1822fea07b6a1d6a47aa2f1a695}{COAP\_REQ\_STATE\_RESET})
375          \{
376             \textcolor{comment}{//A Reset message has been received}
377             status = \hyperlink{coap__client__request_8h_aebefd74fc8bc46499af62dc3bbd49eefa9584c66d61bb2ee0765c40a5cab0267f}{COAP\_REQUEST\_STATUS\_RESET};
378          \}
379          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT})
380          \{
381             \textcolor{comment}{//A timeout error has occurred}
382             status = \hyperlink{coap__client__request_8h_aebefd74fc8bc46499af62dc3bbd49eefabd59b73dded39daa57a5d366428f2d18}{COAP\_REQUEST\_STATUS\_TIMEOUT};
383          \}
384          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946}{COAP\_REQ\_STATE\_CANCELED})
385          \{
386             \textcolor{comment}{//The request has been canceled}
387             status = \hyperlink{coap__client__request_8h_aebefd74fc8bc46499af62dc3bbd49eefa7b6fddca1e3756aab2ebee7f52f4512b}{COAP\_REQUEST\_STATUS\_CANCELED};
388          \}
389          \textcolor{keywordflow}{else}
390          \{
391             \textcolor{comment}{//The request has successfully completed}
392             status = \hyperlink{coap__client__request_8h_aebefd74fc8bc46499af62dc3bbd49eefa2efcea5a532a9cec24323de53a316b70}{COAP\_REQUEST\_STATUS\_SUCCESS};
393          \}
394 
395          \textcolor{comment}{//Release exclusive access to the CoAP client context}
396          \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&context->mutex);
397          \textcolor{comment}{//Invoke callback function}
398          error = request->callback(context, request, status, request->param);
399          \textcolor{comment}{//Acquire exclusive access to the CoAP client context}
400          \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&context->mutex);
401       \}
402 
403       \textcolor{comment}{//Asynchronous requests are automatically released}
404       \textcolor{keywordflow}{if}(newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a09b36647354387ef7abf74d6da75aaee}{COAP\_REQ\_STATE\_DONE} ||
405          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a2eaac1822fea07b6a1d6a47aa2f1a695}{COAP\_REQ\_STATE\_RESET} ||
406          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT} ||
407          newState == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946}{COAP\_REQ\_STATE\_CANCELED})
408       \{
409          \textcolor{keywordflow}{if}(request->state != \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04aa070e9fb3f832e7a98835c487f22d90c}{COAP\_REQ\_STATE\_TRANSMIT})
410          \{
411             \textcolor{comment}{//Release the resources associated with a CoAP request}
412             request->state = \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a9d2460e153b0879afc9c53f3255884d1}{COAP\_REQ\_STATE\_UNUSED};
413          \}
414       \}
415    \}
416 
417    \textcolor{comment}{//Return status code}
418    \textcolor{keywordflow}{return} error;
419 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a1fc420ff503f63a5358c0a7fcbd92440}\label{coap__client__misc_8c_a1fc420ff503f63a5358c0a7fcbd92440}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Generate\+Message\+Id@{coap\+Client\+Generate\+Message\+Id}}
\index{coap\+Client\+Generate\+Message\+Id@{coap\+Client\+Generate\+Message\+Id}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Generate\+Message\+Id()}{coapClientGenerateMessageId()}}
{\footnotesize\ttfamily void coap\+Client\+Generate\+Message\+Id (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$}]{header }\end{DoxyParamCaption})}



Generate a new message identifier. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em header} & Pointer to the Co\+AP message header \\
\hline
\end{DoxyParams}


Definition at line 765 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
767 \{
768    \textcolor{comment}{//The message ID is a 16-bit unsigned integer that is generated by}
769    \textcolor{comment}{//the sender of a Confirmable or Non-confirmable message}
770    header->mid = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(context->mid);
771 
772    \textcolor{comment}{//Increment message identifier}
773    context->mid++;
774 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a01d65fc39c4d6b8d1c3bb0e77e7d9c19}\label{coap__client__misc_8c_a01d65fc39c4d6b8d1c3bb0e77e7d9c19}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Generate\+Token@{coap\+Client\+Generate\+Token}}
\index{coap\+Client\+Generate\+Token@{coap\+Client\+Generate\+Token}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Generate\+Token()}{coapClientGenerateToken()}}
{\footnotesize\ttfamily void coap\+Client\+Generate\+Token (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{Coap\+Message\+Header} $\ast$}]{header }\end{DoxyParamCaption})}



Generate a new token. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em header} & Pointer to the Co\+AP message header \\
\hline
\end{DoxyParams}


Definition at line 783 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
785 \{
786    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} i;
787 
788    \textcolor{comment}{//Generate a random token}
789    \textcolor{keywordflow}{for}(i = 0; i < header->tokenLen; i++)
790    \{
791       header->token[i] = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) \hyperlink{net_8c_a7bb00b31d641749ac8ce742261eb1f6d}{netGetRand}();
792    \}
793 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_ae42f0294612b0be2de9063b092ec4370}\label{coap__client__misc_8c_ae42f0294612b0be2de9063b092ec4370}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Match\+Response@{coap\+Client\+Match\+Response}}
\index{coap\+Client\+Match\+Response@{coap\+Client\+Match\+Response}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Match\+Response()}{coapClientMatchResponse()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Match\+Response (\begin{DoxyParamCaption}\item[{const \hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$}]{request,  }\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Check whether a response matches the specified request. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em request} & Co\+AP request handle \\
\hline
\mbox{\tt in}  & {\em response} & Pointer to the response message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 429 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
431 \{
432    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
433    \textcolor{keyword}{const} \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *reqHeader;
434    \textcolor{keyword}{const} \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *respHeader;
435 
436    \textcolor{comment}{//Get CoAP request and response headers}
437    reqHeader = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) request->message.buffer;
438    respHeader = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) response->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
439 
440    \textcolor{comment}{//Initialize status code}
441    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE};
442 
443    \textcolor{comment}{//Check request state}
444    \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ad691f5c05424d540865f493d82866284}{COAP\_REQ\_STATE\_RECEIVE})
445    \{
446       \textcolor{comment}{//Confirmable request?}
447       \textcolor{keywordflow}{if}(reqHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON})
448       \{
449          \textcolor{comment}{//Check the type of the response}
450          \textcolor{keywordflow}{if}(respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON} ||
451             respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a26b4b8fe681ea0720d68e1711741e073}{COAP\_TYPE\_NON})
452          \{
453             \textcolor{comment}{//Tokens are used to match a response with a request}
454             \textcolor{keywordflow}{if}(\hyperlink{coap__message_8c_a15da8ea4ced6ce70e3f398a640cc34b5}{coapCompareToken}(respHeader, reqHeader))
455             \{
456                \textcolor{comment}{//A matching response has been received}
457                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
458             \}
459          \}
460          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a7b2fe2187018bce9132af2763b57307d}{COAP\_TYPE\_ACK})
461          \{
462             \textcolor{comment}{//The message ID of the Acknowledgment must match the message ID}
463             \textcolor{comment}{//of the Confirmable message}
464             \textcolor{keywordflow}{if}(respHeader->mid == reqHeader->mid)
465             \{
466                \textcolor{comment}{//Empty ACK received?}
467                \textcolor{keywordflow}{if}(respHeader->code == \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680ead23d0c658ea18ce7e1dd8f1f4be0e7ec}{COAP\_CODE\_EMPTY})
468                \{
469                   \textcolor{comment}{//When a Confirmable message carrying a request is acknowledged}
470                   \textcolor{comment}{//with an Empty message, a separate response is sent in a}
471                   \textcolor{comment}{//separate message exchange}
472                   error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
473                \}
474                \textcolor{keywordflow}{else}
475                \{
476                   \textcolor{comment}{//In a piggybacked response, the message ID of the Confirmable}
477                   \textcolor{comment}{//request and the Acknowledgment must match, and the tokens of}
478                   \textcolor{comment}{//the response and original request must match}
479                   \textcolor{keywordflow}{if}(\hyperlink{coap__message_8c_a15da8ea4ced6ce70e3f398a640cc34b5}{coapCompareToken}(respHeader, reqHeader))
480                   \{
481                      \textcolor{comment}{//A matching response has been received}
482                      error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
483                   \}
484                \}
485             \}
486          \}
487          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(respHeader->code == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a01c6fd4e52755bc70525ece8e7b44558}{COAP\_TYPE\_RST})
488          \{
489             \textcolor{comment}{//The message ID of the Reset must match the message ID of}
490             \textcolor{comment}{//the Confirmable message}
491             \textcolor{keywordflow}{if}(respHeader->mid == reqHeader->mid)
492             \{
493                \textcolor{comment}{//A Reset message indicates that the request was received by the}
494                \textcolor{comment}{//server, but some context is missing to properly process it}
495                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
496             \}
497          \}
498          \textcolor{keywordflow}{else}
499          \{
500             \textcolor{comment}{//Just for sanity}
501          \}
502       \}
503       \textcolor{comment}{//Non-Confirmable request?}
504       \textcolor{keywordflow}{else}
505       \{
506          \textcolor{comment}{//If a request is sent in a Non-confirmable message, then the response}
507          \textcolor{comment}{//is sent using a new Non-confirmable message, although the server may}
508          \textcolor{comment}{//instead send a Confirmable message (refer to RFC 7252, section 2.2)}
509          \textcolor{keywordflow}{if}(respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON} ||
510             respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a26b4b8fe681ea0720d68e1711741e073}{COAP\_TYPE\_NON})
511          \{
512             \textcolor{comment}{//Tokens are used to match a response with a request}
513             \textcolor{keywordflow}{if}(\hyperlink{coap__message_8c_a15da8ea4ced6ce70e3f398a640cc34b5}{coapCompareToken}(respHeader, reqHeader))
514             \{
515                \textcolor{comment}{//A matching response has been received}
516                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
517             \}
518          \}
519          \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a01c6fd4e52755bc70525ece8e7b44558}{COAP\_TYPE\_RST})
520          \{
521             \textcolor{comment}{//The message ID of the Reset must match the message ID of}
522             \textcolor{comment}{//the Non-confirmable message}
523             \textcolor{keywordflow}{if}(respHeader->mid == reqHeader->mid)
524             \{
525                \textcolor{comment}{//A matching response has been received}
526                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
527             \}
528          \}
529          \textcolor{keywordflow}{else}
530          \{
531             \textcolor{comment}{//Just for sanity}
532          \}
533       \}
534    \}
535    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a5252386ab7240bf3e0615b1b9c168d3e}{COAP\_REQ\_STATE\_SEPARATE} ||
536       request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d}{COAP\_REQ\_STATE\_OBSERVE})
537    \{
538       \textcolor{comment}{//Check the type of the response}
539       \textcolor{keywordflow}{if}(respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON} ||
540          respHeader->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a26b4b8fe681ea0720d68e1711741e073}{COAP\_TYPE\_NON})
541       \{
542          \textcolor{comment}{//Tokens are used to match a response with a request}
543          \textcolor{keywordflow}{if}(\hyperlink{coap__message_8c_a15da8ea4ced6ce70e3f398a640cc34b5}{coapCompareToken}(respHeader, reqHeader))
544          \{
545             \textcolor{comment}{//A matching response has been received}
546             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
547          \}
548       \}
549    \}
550    \textcolor{keywordflow}{else}
551    \{
552       \textcolor{comment}{//Just for sanity}
553    \}
554 
555    \textcolor{comment}{//Return status code}
556    \textcolor{keywordflow}{return} error;
557 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_aeb4d9d3f14c4fe35cf886dd06fd737ee}\label{coap__client__misc_8c_aeb4d9d3f14c4fe35cf886dd06fd737ee}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Process\+Events@{coap\+Client\+Process\+Events}}
\index{coap\+Client\+Process\+Events@{coap\+Client\+Process\+Events}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Process\+Events()}{coapClientProcessEvents()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Process\+Events (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\+\_\+t}}]{timeout }\end{DoxyParamCaption})}



Process Co\+AP client events. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em timeout} & Maximum time to wait before returning \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 57 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
58 \{
59    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
60    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
61    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} d;
62    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} startTime;
63    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} currentTime;
64 
65    \textcolor{comment}{//Flush receive buffer}
66    context->response.length = 0;
67 
68    \textcolor{comment}{//Save current time}
69    currentTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
70    startTime = currentTime;
71 
72 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
73    \textcolor{comment}{//Process events}
74    \textcolor{keywordflow}{do}
75    \{
76 \textcolor{preprocessor}{#endif}
77       \textcolor{comment}{//Maximum time to wait for an incoming datagram}
78       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(startTime + timeout, currentTime) > 0)
79          d = startTime + timeout - currentTime;
80       \textcolor{keywordflow}{else}
81          d = 0;
82 
83       \textcolor{comment}{//Limit the delay}
84       d = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(d, \hyperlink{coap__client_8h_ab1261a7201fa9fadec7e0e2f3ce1e903}{COAP\_CLIENT\_TICK\_INTERVAL});
85 
86       \textcolor{comment}{//Wait for incoming traffic}
87       \hyperlink{coap__client__transport_8c_a7bb185cfc769269b364e1ff097dd3304}{coapClientWaitForDatagram}(context, d);
88 
89       \textcolor{comment}{//Get current time}
90       currentTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
91 
92       \textcolor{comment}{//Receive datagram, if any}
93       error = \hyperlink{coap__client__transport_8c_a87a1327f7f8695dd5be7028ef52a0dd7}{coapClientReceiveDatagram}(context, context->response.buffer,
94          \hyperlink{coap__common_8h_a335f86dbb26e7c7c80679116ec6bb120}{COAP\_MAX\_MSG\_SIZE}, &context->response.length);
95 
96       \textcolor{comment}{//Any datagram received?}
97       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
98       \{
99          \textcolor{comment}{//Parse the received datagram}
100          error = \hyperlink{coap__message_8c_af457aa2f3d1dc448a5a1718798ad9c23}{coapParseMessage}(&context->response);
101 
102          \textcolor{comment}{//Check status code}
103          \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
104          \{
105             \textcolor{comment}{//Rewind to the beginning of the buffer}
106             context->response.pos = 0;
107             \textcolor{comment}{//Terminate the payload with a NULL character}
108             context->response.buffer[context->response.length] = \textcolor{charliteral}{'\(\backslash\)0'};
109 
110             \textcolor{comment}{//Debug message}
111             \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"CoAP message received (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
112                context->response.length);
113 
114             \textcolor{comment}{//Dump the contents of the message for debugging purpose}
115             \hyperlink{coap__debug_8c_a5b454558790bd604892778901261dffe}{coapDumpMessage}(context->response.buffer,
116                context->response.length);
117 
118             \textcolor{comment}{//Try to match the response with an outstanding request}
119             \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{coap__client_8h_a1d9b5c1d8e03256e7164e0e26995654d}{COAP\_CLIENT\_NSTART}; i++)
120             \{
121                \textcolor{comment}{//Apply request/response matching rules}
122                error = \hyperlink{coap__client__misc_8c_ae42f0294612b0be2de9063b092ec4370}{coapClientMatchResponse}(&context->request[i],
123                   &context->response);
124 
125                \textcolor{comment}{//Test if the response matches the current request}
126                \textcolor{keywordflow}{if}(error != \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE})
127                   \textcolor{keywordflow}{break};
128             \}
129 
130             \textcolor{comment}{//Check status code}
131             \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
132             \{
133                \textcolor{comment}{//Process the received CoAP message}
134                error = \hyperlink{coap__client__misc_8c_a65c8ad0dd27961d2916649dcf61ad8fd}{coapClientProcessResponse}(&context->request[i],
135                   &context->response);
136             \}
137             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cafb4f7e4640c9d495bf35ee668d620b17}{ERROR\_UNEXPECTED\_MESSAGE})
138             \{
139                \textcolor{comment}{//Reject the received CoAP message}
140                error = \hyperlink{coap__client__misc_8c_a368ed24d35935d0a5c5c07fb926d1355}{coapClientRejectResponse}(context, &context->response);
141             \}
142             \textcolor{keywordflow}{else}
143             \{
144                \textcolor{comment}{//Just for sanity}
145             \}
146          \}
147          \textcolor{keywordflow}{else}
148          \{
149             \textcolor{comment}{//Debug message}
150             \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"Invalid CoAP message received!\(\backslash\)r\(\backslash\)n"});
151             \textcolor{comment}{//Silently discard the received datagram}
152             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
153          \}
154       \}
155       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca16f356a669fbb42deb27f59e9054f6d6}{ERROR\_WOULD\_BLOCK} || error == 
      \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca4d0f7be53b837f004379ac6bbd56f1e2}{ERROR\_TIMEOUT})
156       \{
157          \textcolor{comment}{//No datagram has been received}
158          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
159       \}
160       \textcolor{keywordflow}{else}
161       \{
162          \textcolor{comment}{//Just for sanity}
163       \}
164 
165       \textcolor{comment}{//Check status code}
166       \textcolor{keywordflow}{if}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
167       \{
168          \textcolor{comment}{//Process request-specific events}
169          \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{coap__client_8h_a1d9b5c1d8e03256e7164e0e26995654d}{COAP\_CLIENT\_NSTART}; i++)
170          \{
171             \textcolor{comment}{//Manage retransmission for the current request}
172             error = \hyperlink{coap__client__misc_8c_a4296042d22777e8a867e5f0cc0e0d1c5}{coapClientProcessRequestEvents}(&context->request[i]);
173             \textcolor{comment}{//Any error to report?}
174             \textcolor{keywordflow}{if}(error)
175                \textcolor{keywordflow}{break};
176          \}
177       \}
178 
179 \textcolor{preprocessor}{#if (NET\_RTOS\_SUPPORT == ENABLED)}
180       \textcolor{comment}{//Check whether the timeout has elapsed}
181    \} \textcolor{keywordflow}{while}(error == \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR} && context->response.length == 0 && d > 0);
182 \textcolor{preprocessor}{#endif}
183 
184    \textcolor{comment}{//Return status code}
185    \textcolor{keywordflow}{return} error;
186 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a4296042d22777e8a867e5f0cc0e0d1c5}\label{coap__client__misc_8c_a4296042d22777e8a867e5f0cc0e0d1c5}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Process\+Request\+Events@{coap\+Client\+Process\+Request\+Events}}
\index{coap\+Client\+Process\+Request\+Events@{coap\+Client\+Process\+Request\+Events}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Process\+Request\+Events()}{coapClientProcessRequestEvents()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Process\+Request\+Events (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$}]{request }\end{DoxyParamCaption})}



Process request-\/specific events. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em request} & Co\+AP request handle \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 195 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
196 \{
197    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
198    \hyperlink{compiler__port_8h_ae3e32a98d431a02106616da3071832dd}{systime\_t} \hyperlink{dhcpv6__common_8h_ae73654f333e4363463ad8c594eca1905}{time};
199    \hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{CoapClientContext} *context;
200    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
201 
202    \textcolor{comment}{//Initialize status code}
203    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
204 
205    \textcolor{comment}{//Get current time}
206    time = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
207 
208    \textcolor{comment}{//Point to the CoAP client context}
209    context = request->context;
210    \textcolor{comment}{//Point to the CoAP message header}
211    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) request->message.buffer;
212 
213    \textcolor{comment}{//Check current state}
214    \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04aa070e9fb3f832e7a98835c487f22d90c}{COAP\_REQ\_STATE\_TRANSMIT})
215    \{
216       \textcolor{comment}{//Debug message}
217       \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending CoAP message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
218          request->message.length);
219 
220       \textcolor{comment}{//Dump the contents of the message for debugging purpose}
221       \hyperlink{coap__debug_8c_a5b454558790bd604892778901261dffe}{coapDumpMessage}(request->message.buffer, request->message.length);
222 
223       \textcolor{comment}{//Send CoAP request}
224       error = \hyperlink{coap__client__transport_8c_a8acf27da82f93e852fe9152c089b08b9}{coapClientSendDatagram}(context, request->message.buffer,
225          request->message.length);
226 
227       \textcolor{comment}{//Save the time at which the message was sent}
228       request->retransmitStartTime = \hyperlink{os__port__chibios_8c_ab66a11272d40a916fa69dd8e4dc443d4}{osGetSystemTime}();
229 
230       \textcolor{comment}{//Check retransmission counter}
231       \textcolor{keywordflow}{if}(request->retransmitCount == 0)
232       \{
233          \textcolor{comment}{//Save request start time}
234          request->startTime = request->retransmitStartTime;
235 
236          \textcolor{comment}{//The initial timeout is set to a random duration}
237          request->retransmitTimeout = \hyperlink{net_8c_af45ea0afc9806749114ec85e507014e1}{netGetRandRange}(
      \hyperlink{coap__client_8h_afbc1c306934d2e0377ed0ee41c43ea9d}{COAP\_CLIENT\_ACK\_TIMEOUT\_MIN},
238             \hyperlink{coap__client_8h_a54b756821aaa49ae9a39e7cc51803bcf}{COAP\_CLIENT\_ACK\_TIMEOUT\_MAX});
239       \}
240       \textcolor{keywordflow}{else}
241       \{
242          \textcolor{comment}{//The timeout is doubled}
243          request->retransmitTimeout *= 2;
244       \}
245 
246       \textcolor{comment}{//Increment retransmission counter}
247       request->retransmitCount++;
248 
249       \textcolor{comment}{//Wait for a response to be received}
250       \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ad691f5c05424d540865f493d82866284}{COAP\_REQ\_STATE\_RECEIVE});
251    \}
252    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ad691f5c05424d540865f493d82866284}{COAP\_REQ\_STATE\_RECEIVE})
253    \{
254       \textcolor{comment}{//Check whether the timeout has elapsed}
255       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, request->startTime + request->timeout) >= 0)
256       \{
257          \textcolor{comment}{//Report a timeout error}
258          error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT});
259       \}
260       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, request->retransmitStartTime +
261          request->retransmitTimeout) >= 0)
262       \{
263          \textcolor{comment}{//The reliable transmission of a message is initiated by marking the}
264          \textcolor{comment}{//message as Confirmable in the CoAP header}
265          \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON})
266          \{
267             \textcolor{comment}{//The sender retransmits the Confirmable message at exponentially}
268             \textcolor{comment}{//increasing intervals, until it receives an acknowledgment or}
269             \textcolor{comment}{//runs out of attempts (refer to RFC 7252, section 4.2)}
270             \textcolor{keywordflow}{if}(request->retransmitCount < \hyperlink{coap__client_8h_a6f8661e91fab5f86593cd4df6bc44d19}{COAP\_CLIENT\_MAX\_RETRANSMIT})
271             \{
272                \textcolor{comment}{//When the timeout is triggered and the retransmission counter is}
273                \textcolor{comment}{//less than MAX\_RETRANSMIT, the message is retransmitted}
274                error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request,
275                   \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04aa070e9fb3f832e7a98835c487f22d90c}{COAP\_REQ\_STATE\_TRANSMIT});
276             \}
277             \textcolor{keywordflow}{else}
278             \{
279                \textcolor{comment}{//If the retransmission counter reaches MAX\_RETRANSMIT on a}
280                \textcolor{comment}{//timeout, then the attempt to transmit the message is canceled}
281                \textcolor{comment}{//and the application process informed of failure}
282                error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request,
283                   \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT});
284             \}
285          \}
286       \}
287       \textcolor{keywordflow}{else}
288       \{
289          \textcolor{comment}{//Just for sanity}
290       \}
291    \}
292    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a5252386ab7240bf3e0615b1b9c168d3e}{COAP\_REQ\_STATE\_SEPARATE})
293    \{
294       \textcolor{comment}{//Check whether the timeout has elapsed}
295       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, request->startTime + request->timeout) >= 0)
296       \{
297          \textcolor{comment}{//Report a timeout error}
298          error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac2ef6b69a14701d15e31c33d3324ba4b}{COAP\_REQ\_STATE\_TIMEOUT});
299       \}
300    \}
301    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(request->state == \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a08c3e3ce4b37f7db53eeea653fa15e1d}{COAP\_REQ\_STATE\_OBSERVE})
302    \{
303       \textcolor{comment}{//Check whether the timeout has elapsed}
304       \textcolor{keywordflow}{if}(\hyperlink{os__port_8h_a25c13833ef003da02045a91b1080263a}{timeCompare}(time, request->retransmitStartTime +
305          request->retransmitTimeout) >= 0)
306       \{
307          \textcolor{comment}{//Point to the CoAP message header}
308          header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) request->message.buffer;
309 
310          \textcolor{comment}{//The message ID is a 16-bit unsigned integer that is generated by}
311          \textcolor{comment}{//the sender of a Confirmable or Non-confirmable message}
312          \hyperlink{coap__client__misc_8c_a1fc420ff503f63a5358c0a7fcbd92440}{coapClientGenerateMessageId}(context, header);
313 
314          \textcolor{comment}{//Reset retransmission counter}
315          request->retransmitCount = 0;
316 
317          \textcolor{comment}{//To re-register its interest in a resource, a client may issue a}
318          \textcolor{comment}{//new GET request with the same token as the original}
319          error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04aa070e9fb3f832e7a98835c487f22d90c}{COAP\_REQ\_STATE\_TRANSMIT});
320       \}
321    \}
322    \textcolor{keywordflow}{else}
323    \{
324       \textcolor{comment}{//Just for sanity}
325    \}
326 
327    \textcolor{comment}{//Return status code}
328    \textcolor{keywordflow}{return} error;
329 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a65c8ad0dd27961d2916649dcf61ad8fd}\label{coap__client__misc_8c_a65c8ad0dd27961d2916649dcf61ad8fd}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Process\+Response@{coap\+Client\+Process\+Response}}
\index{coap\+Client\+Process\+Response@{coap\+Client\+Process\+Response}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Process\+Response()}{coapClientProcessResponse()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Process\+Response (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3dac6728ded461f458ffd870eca7afe7}{Coap\+Client\+Request} $\ast$}]{request,  }\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Process Co\+AP response. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em request} & Co\+AP request handle \\
\hline
\mbox{\tt in}  & {\em response} & Pointer to the response message \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 567 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
569 \{
570    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
571    \hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{CoapClientContext} *context;
572    \textcolor{keyword}{const} \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
573 
574    \textcolor{comment}{//Point to the CoAP client context}
575    context = request->context;
576    \textcolor{comment}{//Point to CoAP response header}
577    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) response->\hyperlink{structCoapMessage_ab8ec8f8181bf0b24d5d63f6701df0ecf}{buffer};
578 
579    \textcolor{comment}{//Confirmable response received?}
580    \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON})
581    \{
582       \textcolor{comment}{//The Acknowledgment message must echo the message ID of the}
583       \textcolor{comment}{//Confirmable message}
584       \hyperlink{coap__client__misc_8c_a012b0df3cfb833d9b3bd0f2adda2dd5d}{coapClientSendAck}(context, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(header->mid));
585    \}
586 
587    \textcolor{comment}{//Check the type of the response}
588    \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a7b2fe2187018bce9132af2763b57307d}{COAP\_TYPE\_ACK} &&
589       header->code == \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680ead23d0c658ea18ce7e1dd8f1f4be0e7ec}{COAP\_CODE\_EMPTY})
590    \{
591       \textcolor{comment}{//When a Confirmable message carrying a request is acknowledged with}
592       \textcolor{comment}{//an Empty message, a separate response is sent in a separate message}
593       \textcolor{comment}{//exchange}
594       error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a5252386ab7240bf3e0615b1b9c168d3e}{COAP\_REQ\_STATE\_SEPARATE});
595    \}
596    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON} ||
597       header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a26b4b8fe681ea0720d68e1711741e073}{COAP\_TYPE\_NON} ||
598       header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a7b2fe2187018bce9132af2763b57307d}{COAP\_TYPE\_ACK})
599    \{
600 \textcolor{preprocessor}{#if (COAP\_CLIENT\_OBSERVE\_SUPPORT == ENABLED)}
601       \hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{dtls__misc_8h_a74bce8e92ccabd0c885447114a48b80e}{value};
602 
603       \textcolor{comment}{//Search the CoAP request for an Observe option}
604       error = \hyperlink{coap__option_8c_a4098de0a9fbec04954546ce1978572d9}{coapGetUintOption}(&request->message, 
      \hyperlink{coap__option_8h_ab833642841b9ddc4cab90acf5cffb0e7ac327e2341a2ed78310270fa285b0a7d9}{COAP\_OPT\_OBSERVE}, 0, &value);
605 
606       \textcolor{comment}{//Observe option included in the request?}
607       \textcolor{keywordflow}{if}(!error)
608       \{
609          \textcolor{comment}{//The client requests the server to add or remove an entry in the}
610          \textcolor{comment}{//list of observers of the resource depending on the option value}
611          \textcolor{keywordflow}{if}(value == \hyperlink{coap__option_8h_a6506ef0c57ab07e508c2187380b2f206a62075f619226df1cdc03900c07617044}{COAP\_OBSERVE\_REGISTER})
612          \{
613             \textcolor{comment}{//Process notification response}
614             error = \hyperlink{coap__client__observe_8c_adc6fc309da18ce4890fadf2f7acb9dff}{coapClientProcessNotification}(request, response);
615          \}
616          \textcolor{keywordflow}{else}
617          \{
618             \textcolor{comment}{//When the client deregisters, it is considered no longer}
619             \textcolor{comment}{//interested in the resource}
620             error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request,
621                \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04ac66544d370695c9859f214b4d1fa7946}{COAP\_REQ\_STATE\_CANCELED});
622          \}
623       \}
624       \textcolor{keywordflow}{else}
625 \textcolor{preprocessor}{#endif}
626       \{
627          \textcolor{comment}{//The request has successfully completed}
628          error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a09b36647354387ef7abf74d6da75aaee}{COAP\_REQ\_STATE\_DONE});
629       \}
630    \}
631    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a01c6fd4e52755bc70525ece8e7b44558}{COAP\_TYPE\_RST})
632    \{
633       \textcolor{comment}{//A Reset message indicates that the request was received by the server,}
634       \textcolor{comment}{//but some context is missing to properly process it}
635       error = \hyperlink{coap__client__misc_8c_a937370fda4c0d4c5b8c9b559127f8a27}{coapClientChangeRequestState}(request, 
      \hyperlink{coap__client__request_8h_ae23250f18b3b2a3d2dc7dc98cc664d04a2eaac1822fea07b6a1d6a47aa2f1a695}{COAP\_REQ\_STATE\_RESET});
636    \}
637    \textcolor{keywordflow}{else}
638    \{
639       \textcolor{comment}{//Report an error}
640       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca2daa3c161edaa4477d1ae954c2136008}{ERROR\_INVALID\_TYPE};
641    \}
642 
643    \textcolor{comment}{//Return status code}
644    \textcolor{keywordflow}{return} error;
645 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a368ed24d35935d0a5c5c07fb926d1355}\label{coap__client__misc_8c_a368ed24d35935d0a5c5c07fb926d1355}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Reject\+Response@{coap\+Client\+Reject\+Response}}
\index{coap\+Client\+Reject\+Response@{coap\+Client\+Reject\+Response}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Reject\+Response()}{coapClientRejectResponse()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Reject\+Response (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{const \hyperlink{structCoapMessage}{Coap\+Message} $\ast$}]{response }\end{DoxyParamCaption})}



Reject a Co\+AP response. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em response} & Pointer to the response message to be rejected \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 655 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
657 \{
658    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
659    \textcolor{keyword}{const} \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *header;
660 
661    \textcolor{comment}{//Debug message}
662    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Rejecting CoAP message...\(\backslash\)r\(\backslash\)n"});
663 
664    \textcolor{comment}{//Point to the CoAP message header}
665    header = (\hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} *) response;
666 
667    \textcolor{comment}{//Check the type of the response}
668    \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a65c04ee4847d0c595238079ac9564e8d}{COAP\_TYPE\_CON})
669    \{
670       \textcolor{comment}{//Rejecting a Confirmable message is effected by sending a matching}
671       \textcolor{comment}{//Reset message}
672       error = \hyperlink{coap__client__misc_8c_a6553f9a2a188a645e7a68b766197d3b5}{coapClientSendReset}(context, \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(header->mid));
673    \}
674    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(header->type == \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a26b4b8fe681ea0720d68e1711741e073}{COAP\_TYPE\_NON})
675    \{
676       \textcolor{comment}{//Rejecting a Non-confirmable message may involve sending a matching}
677       \textcolor{comment}{//Reset message, and apart from the Reset message the rejected message}
678       \textcolor{comment}{//must be silently ignored (refer to RFC 7252, section 4.3)}
679       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
680    \}
681    \textcolor{keywordflow}{else}
682    \{
683       \textcolor{comment}{//Rejecting an Acknowledgment or Reset message is effected by}
684       \textcolor{comment}{//silently ignoring it (refer to RFC 7252, section 4.2)}
685       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
686    \}
687 
688    \textcolor{comment}{//Return status code}
689    \textcolor{keywordflow}{return} error;
690 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a012b0df3cfb833d9b3bd0f2adda2dd5d}\label{coap__client__misc_8c_a012b0df3cfb833d9b3bd0f2adda2dd5d}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Send\+Ack@{coap\+Client\+Send\+Ack}}
\index{coap\+Client\+Send\+Ack@{coap\+Client\+Send\+Ack}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Send\+Ack()}{coapClientSendAck()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Send\+Ack (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{mid }\end{DoxyParamCaption})}



Send Acknowledgment message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em mid} & Message ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 700 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
701 \{
702    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
703 
704    \textcolor{comment}{//Format Acknowledgment message}
705    message.version = \hyperlink{coap__common_8h_a233dfcd021c7432eb74ee4c4245b2a1ba1b13f265da5288b4b1e92cb8d196562f}{COAP\_VERSION\_1};
706    message.type = \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a7b2fe2187018bce9132af2763b57307d}{COAP\_TYPE\_ACK};
707    message.tokenLen = 0;
708    message.code = \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680ead23d0c658ea18ce7e1dd8f1f4be0e7ec}{COAP\_CODE\_EMPTY};
709 
710    \textcolor{comment}{//The Acknowledgment message message must echo the message ID of the}
711    \textcolor{comment}{//confirmable message and must be empty}
712    message.mid = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(\hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid});
713 
714    \textcolor{comment}{//Debug message}
715    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Acknowledgment message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
716       \textcolor{keyword}{sizeof}(message));
717 
718    \textcolor{comment}{//Dump the contents of the message for debugging purpose}
719    \hyperlink{coap__debug_8c_a5b454558790bd604892778901261dffe}{coapDumpMessage}(&message, \textcolor{keyword}{sizeof}(message));
720 
721    \textcolor{comment}{//Send CoAP message}
722    \textcolor{keywordflow}{return} \hyperlink{coap__client__transport_8c_a8acf27da82f93e852fe9152c089b08b9}{coapClientSendDatagram}(context, &message, \textcolor{keyword}{sizeof}(message));
723 \}
\end{DoxyCode}
\mbox{\Hypertarget{coap__client__misc_8c_a6553f9a2a188a645e7a68b766197d3b5}\label{coap__client__misc_8c_a6553f9a2a188a645e7a68b766197d3b5}} 
\index{coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}!coap\+Client\+Send\+Reset@{coap\+Client\+Send\+Reset}}
\index{coap\+Client\+Send\+Reset@{coap\+Client\+Send\+Reset}!coap\+\_\+client\+\_\+misc.\+c@{coap\+\_\+client\+\_\+misc.\+c}}
\subsubsection{\texorpdfstring{coap\+Client\+Send\+Reset()}{coapClientSendReset()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} coap\+Client\+Send\+Reset (\begin{DoxyParamCaption}\item[{\hyperlink{coap__client_8h_a3b7ac08b734045846f1dba69cd6b8700}{Coap\+Client\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}]{mid }\end{DoxyParamCaption})}



Send Reset message. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the Co\+AP client context \\
\hline
\mbox{\tt in}  & {\em mid} & Message ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 733 of file coap\+\_\+client\+\_\+misc.\+c.


\begin{DoxyCode}
734 \{
735    \hyperlink{coap__common_8h_a70d12c6909cdb5a7059218005a7233d8}{CoapMessageHeader} \hyperlink{chap_8h_a52f19d36a71e9b8ddea38fe00c291181}{message};
736 
737    \textcolor{comment}{//Format Reset message}
738    message.version = \hyperlink{coap__common_8h_a233dfcd021c7432eb74ee4c4245b2a1ba1b13f265da5288b4b1e92cb8d196562f}{COAP\_VERSION\_1};
739    message.type = \hyperlink{coap__common_8h_ac5fd9cfb88eeb3a27e2ee83275d0f669a01c6fd4e52755bc70525ece8e7b44558}{COAP\_TYPE\_RST};
740    message.tokenLen = 0;
741    message.code = \hyperlink{coap__common_8h_af91e1fbf0a9ca1f9175e6049c9f2680ead23d0c658ea18ce7e1dd8f1f4be0e7ec}{COAP\_CODE\_EMPTY};
742 
743    \textcolor{comment}{//The Reset message message must echo the message ID of the confirmable}
744    \textcolor{comment}{//message and must be empty}
745    message.mid = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(\hyperlink{coap__common_8h_aa217e155b3f8d951b61a7396ecd20239}{mid});
746 
747    \textcolor{comment}{//Debug message}
748    \hyperlink{debug_8h_a7339bfd784193a5c79efcef2eeb2d6df}{TRACE\_INFO}(\textcolor{stringliteral}{"Sending Reset message (%"} \hyperlink{compiler__port_8h_a2b7b0557dc6cd786df02dafbb51f5292}{PRIuSIZE} \textcolor{stringliteral}{" bytes)...\(\backslash\)r\(\backslash\)n"},
749       \textcolor{keyword}{sizeof}(message));
750 
751    \textcolor{comment}{//Dump the contents of the message for debugging purpose}
752    \hyperlink{coap__debug_8c_a5b454558790bd604892778901261dffe}{coapDumpMessage}(&message, \textcolor{keyword}{sizeof}(message));
753 
754    \textcolor{comment}{//Send CoAP message}
755    \textcolor{keywordflow}{return} \hyperlink{coap__client__transport_8c_a8acf27da82f93e852fe9152c089b08b9}{coapClientSendDatagram}(context, &message, \textcolor{keyword}{sizeof}(message));
756 \}
\end{DoxyCode}
