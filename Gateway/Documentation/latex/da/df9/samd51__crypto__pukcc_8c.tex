\hypertarget{samd51__crypto__pukcc_8c}{}\section{cyclone\+\_\+crypto/hardware/samd51\+\_\+crypto\+\_\+pukcc.c File Reference}
\label{samd51__crypto__pukcc_8c}\index{cyclone\+\_\+crypto/hardware/samd51\+\_\+crypto\+\_\+pukcc.\+c@{cyclone\+\_\+crypto/hardware/samd51\+\_\+crypto\+\_\+pukcc.\+c}}


S\+A\+M\+D51 P\+U\+K\+CC public key accelerator.  


{\ttfamily \#include \char`\"{}samd51.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pukcc/\+Crypto\+Lib\+\_\+typedef\+\_\+pb.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pukcc/\+Crypto\+Lib\+\_\+\+Headers\+\_\+pb.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}core/crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}hardware/samd51\+\_\+crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}hardware/samd51\+\_\+crypto\+\_\+pukcc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}pkc/rsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ec.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ecc/ecdsa.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mpi/mpi.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{samd51__crypto__pukcc_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_ac2204ce75455e8e0be1d075463d6dd4e}{pukcc\+Init} (void)
\begin{DoxyCompactList}\small\item\em Initialize P\+U\+K\+CC public key accelerator. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$ \hyperlink{samd51__crypto__pukcc_8c_a9abe11c6e1becd198d65bf4f35d80636}{pukcc\+Import\+Array} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$dest, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$array, size\+\_\+t array\+Len, size\+\_\+t total\+Len)
\begin{DoxyCompactList}\small\item\em Import byte array. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$ \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukcc\+Import\+Mpi} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$dest, const \hyperlink{structMpi}{Mpi} $\ast$src, size\+\_\+t total\+Len)
\begin{DoxyCompactList}\small\item\em Import multiple-\/precision integer. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$ \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukcc\+Workspace} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$dest, size\+\_\+t total\+Len)
\begin{DoxyCompactList}\small\item\em Initialize workspace area. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a5ce82adaded4af385feef6b79aaad6d2}{mpi\+Mul} (\hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{nbns__common_8h_a4313c9563516f94387762ab05763456b}{b})
\begin{DoxyCompactList}\small\item\em Multiple precision multiplication. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_ae7f045ab3eb22a74a2846f49d95f272e}{mpi\+Mod2} (\hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p})
\begin{DoxyCompactList}\small\item\em Modulo operation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a2195ea62b59019943aa5bfa4d309028f}{mpi\+Inv\+Mod} (\hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p})
\begin{DoxyCompactList}\small\item\em Modular inverse. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_ae18482447f7293c8bb44899ce236b72e}{mpi\+Exp\+Mod} (\hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a}, const \hyperlink{structMpi}{Mpi} $\ast$e, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p})
\begin{DoxyCompactList}\small\item\em Modular exponentiation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_afc585fe41f6754070e5d99e61cc9a2b1}{mpi\+Check\+Probable\+Prime} (const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_af4007aacd75b22aee32dba9ea96082c0}{a})
\begin{DoxyCompactList}\small\item\em Test whether a number is probable prime. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a74534ca56f21b582dd584da58982aa27}{rsadp} (const \hyperlink{structRsaPrivateKey}{Rsa\+Private\+Key} $\ast$key, const \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{llmnr__common_8h_a2e5a04327b5658199f0f7bda2acceee1}{c}, \hyperlink{structMpi}{Mpi} $\ast$\hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m})
\begin{DoxyCompactList}\small\item\em R\+SA decryption primitive. \end{DoxyCompactList}\item 
\hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a655440093a9706c87bc50871c3d57030}{ec\+Is\+Point\+Affine} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$ec\+Params, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_a2dee666f0c1fe072c549ff86b1d0a8ab}{s})
\begin{DoxyCompactList}\small\item\em Check whether the affine point S is on the curve. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a2104f83760276f5c2e8fb2692d1c62b8}{ec\+Affinify} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$ec\+Params, \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_a2dee666f0c1fe072c549ff86b1d0a8ab}{s})
\begin{DoxyCompactList}\small\item\em Recover affine representation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a144a1f7a6c5fb844e05bc6e9cc7473c5}{ec\+Mult} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$ec\+Params, \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_a4c5c6ceb8ed33456261fa907136e0c3a}{r}, const \hyperlink{structMpi}{Mpi} $\ast$d, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$\hyperlink{ndp_8h_a2dee666f0c1fe072c549ff86b1d0a8ab}{s})
\begin{DoxyCompactList}\small\item\em Scalar multiplication. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_a0cac60026aac77c3a8ed2538ff6e2b57}{ecdsa\+Generate\+Signature} (const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$prng\+Algo, void $\ast$prng\+Context, const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$ec\+Params, const \hyperlink{structMpi}{Mpi} $\ast$private\+Key, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$digest, size\+\_\+t digest\+Len, \hyperlink{structEcdsaSignature}{Ecdsa\+Signature} $\ast$\hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature})
\begin{DoxyCompactList}\small\item\em E\+C\+D\+SA signature generation. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{samd51__crypto__pukcc_8c_aa4b2c48eaeeda048fb556499a9267387}{ecdsa\+Verify\+Signature} (const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$ec\+Params, const \hyperlink{structEcPoint}{Ec\+Point} $\ast$public\+Key, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$digest, size\+\_\+t digest\+Len, const \hyperlink{structEcdsaSignature}{Ecdsa\+Signature} $\ast$\hyperlink{tls_8h_af27e6d4ea3add14cd8cc9aa275d716ad}{signature})
\begin{DoxyCompactList}\small\item\em E\+C\+D\+SA signature verification. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
P\+P\+U\+K\+C\+L\+\_\+\+P\+A\+R\+AM \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pv\+P\+U\+K\+C\+L\+Param}
\item 
P\+U\+K\+C\+L\+\_\+\+P\+A\+R\+AM \hyperlink{samd51__crypto__pukcc_8c_adc1948c03b6b4b2c8c88e286ace6efe4}{P\+U\+K\+C\+L\+Param}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+A\+M\+D51 P\+U\+K\+CC public key accelerator. 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+Crypto Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{samd51__crypto__pukcc_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{crypto__config_8h_a6afae3a9b63f9b55d979e667ee0e881d}{C\+R\+Y\+P\+T\+O\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a2104f83760276f5c2e8fb2692d1c62b8}\label{samd51__crypto__pukcc_8c_a2104f83760276f5c2e8fb2692d1c62b8}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!ec\+Affinify@{ec\+Affinify}}
\index{ec\+Affinify@{ec\+Affinify}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{ec\+Affinify()}{ecAffinify()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ec\+Affinify (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{ec\+Params,  }\item[{\hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{r,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{s }\end{DoxyParamCaption})}



Recover affine representation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ec\+Params} & EC domain parameters \\
\hline
\mbox{\tt out}  & {\em r} & Affine representation of the point \\
\hline
\mbox{\tt in}  & {\em s} & Projective representation of the point \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 907 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
909 \{
910    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
911    \textcolor{keywordtype}{size\_t} modLen;
912    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
913    \hyperlink{structPukccZpEcConvProjToAffineParams}{PukccZpEcConvProjToAffineParams} params;
914 
915    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
916    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p});
917    modLen = (modLen + 3U) & ~3U;
918 
919    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
920    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
921 
922    \textcolor{comment}{//Point to the crypto memory}
923    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
924 
925    \textcolor{comment}{//Copy modulus}
926    params.\hyperlink{structPukccZpEcConvProjToAffineParams_ae88d80c3f737369d97fef8eee0ccd259}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p}, modLen + 4);
927    \textcolor{comment}{//Initialize reduction constant}
928    params.\hyperlink{structPukccZpEcConvProjToAffineParams_ab59ca2d053334a58d48b0b5fbdff80ca}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 12);
929    \textcolor{comment}{//Initialize workspace R}
930    params.\hyperlink{structPukccZpEcConvProjToAffineParams_a30174fc63e44174069573380c4120629}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
931    \textcolor{comment}{//Initialize workspace X}
932    params.\hyperlink{structPukccZpEcConvProjToAffineParams_ab12cdac26be3a52042a7fb51d299a6b6}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
933 
934    \textcolor{comment}{//Set RedMod service parameters}
935    PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
936    PUKCL(Specific).CarryIn = 0;
937    PUKCL(Specific).Gf2n = 0;
938    PUKCL\_RedMod(u2ModLength) = modLen;
939    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcConvProjToAffineParams_ae88d80c3f737369d97fef8eee0ccd259}{mod});
940    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcConvProjToAffineParams_ab59ca2d053334a58d48b0b5fbdff80ca}{cns});
941    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcConvProjToAffineParams_a30174fc63e44174069573380c4120629}{r});
942    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcConvProjToAffineParams_ab12cdac26be3a52042a7fb51d299a6b6}{x});
943 
944    \textcolor{comment}{//Perform modular reduction setup}
945    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
946 
947    \textcolor{comment}{//Check status code}
948    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
949    \{
950       \textcolor{comment}{//Point to the crypto memory}
951       pos = params.\hyperlink{structPukccZpEcConvProjToAffineParams_a30174fc63e44174069573380c4120629}{r};
952 
953       \textcolor{comment}{//Copy point coordinates}
954       params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
955       params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
956       params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_ac53a6ff4888f818509027e37004635f5}{z}, modLen + 4);
957       \textcolor{comment}{//Initialize workspace}
958       params.\hyperlink{structPukccZpEcConvProjToAffineParams_ac83a15ac7474fcbc20cc1b441a857910}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4 * modLen + 48);
959 
960       \textcolor{comment}{//Set ZpEccConvAffineToProjective service parameters}
961       PUKCL\_ZpEcConvProjToAffine(u2ModLength) = modLen;
962       PUKCL\_ZpEcConvProjToAffine(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcConvProjToAffineParams_ae88d80c3f737369d97fef8eee0ccd259}{mod});
963       PUKCL\_ZpEcConvProjToAffine(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcConvProjToAffineParams_ab59ca2d053334a58d48b0b5fbdff80ca}{cns});
964       PUKCL\_ZpEcConvProjToAffine(nu1PointABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
965       PUKCL\_ZpEcConvProjToAffine(nu1Workspace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcConvProjToAffineParams_ac83a15ac7474fcbc20cc1b441a857910}{w});
966 
967       \textcolor{comment}{//Convert point coordinates from projective to affine representation}
968       vPUKCL\_Process(ZpEcConvProjToAffine, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
969    \}
970 
971    \textcolor{comment}{//Check status code}
972    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
973    \{
974       \textcolor{comment}{//Copy the x-coordinate of the result}
975       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x}, modLen,
976          \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
977 
978       \textcolor{comment}{//Check error code}
979       \textcolor{keywordflow}{if}(!error)
980       \{
981          \textcolor{comment}{//Copy the y-coordinate of the result}
982          error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y}, modLen,
983             \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
984       \}
985 
986       \textcolor{comment}{//Check error code}
987       \textcolor{keywordflow}{if}(!error)
988       \{
989          \textcolor{comment}{//Copy the z-coordinate of the result}
990          error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_ac53a6ff4888f818509027e37004635f5}{z}, params.\hyperlink{structPukccZpEcConvProjToAffineParams_a7b28148b8e16f21b12a8746b6c98e2c8}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z}, modLen,
991             \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
992       \}
993    \}
994    \textcolor{keywordflow}{else}
995    \{
996       \textcolor{comment}{//Report an error}
997       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
998    \}
999 
1000    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
1001    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1002 
1003    \textcolor{comment}{//Return error code}
1004    \textcolor{keywordflow}{return} error;
1005 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a0cac60026aac77c3a8ed2538ff6e2b57}\label{samd51__crypto__pukcc_8c_a0cac60026aac77c3a8ed2538ff6e2b57}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!ecdsa\+Generate\+Signature@{ecdsa\+Generate\+Signature}}
\index{ecdsa\+Generate\+Signature@{ecdsa\+Generate\+Signature}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{ecdsa\+Generate\+Signature()}{ecdsaGenerateSignature()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ecdsa\+Generate\+Signature (\begin{DoxyParamCaption}\item[{const \hyperlink{structPrngAlgo}{Prng\+Algo} $\ast$}]{prng\+Algo,  }\item[{void $\ast$}]{prng\+Context,  }\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{ec\+Params,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{private\+Key,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{digest,  }\item[{size\+\_\+t}]{digest\+Len,  }\item[{\hyperlink{structEcdsaSignature}{Ecdsa\+Signature} $\ast$}]{signature }\end{DoxyParamCaption})}



E\+C\+D\+SA signature generation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prng\+Algo} & P\+R\+NG algorithm \\
\hline
\mbox{\tt in}  & {\em prng\+Context} & Pointer to the P\+R\+NG context \\
\hline
\mbox{\tt in}  & {\em ec\+Params} & EC domain parameters \\
\hline
\mbox{\tt in}  & {\em private\+Key} & Signer\textquotesingle{}s E\+C\+D\+SA private key \\
\hline
\mbox{\tt in}  & {\em digest} & Digest of the message to be signed \\
\hline
\mbox{\tt in}  & {\em digest\+Len} & Length in octets of the digest \\
\hline
\mbox{\tt out}  & {\em signature} & (R, S) integer pair \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1145 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
1148 \{
1149    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1150    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
1151    \textcolor{keywordtype}{size\_t} modLen;
1152    \textcolor{keywordtype}{size\_t} orderLen;
1153    \textcolor{keywordtype}{size\_t} scalarLen;
1154    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
1155    \hyperlink{structPukccZpEcDsaGenerateParams}{PukccZpEcDsaGenerateParams} params;
1156    \hyperlink{structMpi}{Mpi} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
1157 
1158    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
1159    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p});
1160    modLen = (modLen + 3U) & ~3U;
1161 
1162    \textcolor{comment}{//Retrieve the length of the base point order, in bytes}
1163    orderLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q});
1164    orderLen = (orderLen + 3U) & ~3U;
1165 
1166    \textcolor{comment}{//Compute the length of the scalar}
1167    scalarLen = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(orderLen, digestLen);
1168    scalarLen = (scalarLen + 3U) & ~3U;
1169 
1170    \textcolor{comment}{//Initialize multiple precision integer}
1171    \hyperlink{mpi_8c_a6f30959dcaabfb16e96cc47ef90515a6}{mpiInit}(&k);
1172 
1173    \textcolor{comment}{//Let N be the bit length of q}
1174    n = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(&ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q});
1175 
1176    \textcolor{comment}{//Generated a pseudorandom number}
1177    error = \hyperlink{mpi_8c_a9753c7bf919b7c41e48512ba572c3bbb}{mpiRand}(&k, n, prngAlgo, prngContext);
1178 
1179    \textcolor{comment}{//Check error code}
1180    \textcolor{keywordflow}{if}(!error)
1181    \{
1182       \textcolor{comment}{//Make sure that 0 < k < q}
1183       \textcolor{keywordflow}{if}(\hyperlink{mpi_8c_a54cf7aedd99e130971849eb21eb578c9}{mpiComp}(&k, &ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q}) >= 0)
1184          \hyperlink{mpi_8c_a550a7330971d895957015b810b25c805}{mpiShiftRight}(&k, 1);
1185 
1186       \textcolor{comment}{//Debug message}
1187       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  k:\(\backslash\)r\(\backslash\)n"});
1188       \hyperlink{debug_8h_a9c9f3b28f2daf14d77b401512c189d93}{TRACE\_DEBUG\_MPI}(\textcolor{stringliteral}{"    "}, &k);
1189    \}
1190 
1191    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
1192    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1193 
1194    \textcolor{comment}{//Check error code}
1195    \textcolor{keywordflow}{if}(!error)
1196    \{
1197       \textcolor{comment}{//Point to the crypto memory}
1198       pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
1199 
1200       \textcolor{comment}{//Copy modulus}
1201       params.\hyperlink{structPukccZpEcDsaGenerateParams_a67476127ccca460cef6df3b10e6d4167}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p}, modLen + 4);
1202       \textcolor{comment}{//Initialize reduction constant}
1203       params.\hyperlink{structPukccZpEcDsaGenerateParams_aac6e39bd18aff7adcb9343b6ce2f87d9}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, scalarLen + 12);
1204       \textcolor{comment}{//Initialize workspace R}
1205       params.\hyperlink{structPukccZpEcDsaGenerateParams_af252ee26c88488da32c60609a1d2c53d}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
1206       \textcolor{comment}{//Initialize workspace X}
1207       params.\hyperlink{structPukccZpEcDsaGenerateParams_ad1e4d535ebd29d5d2282116af706e268}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
1208 
1209       \textcolor{comment}{//Set RedMod service parameters}
1210       PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
1211       PUKCL(Specific).CarryIn = 0;
1212       PUKCL(Specific).Gf2n = 0;
1213       PUKCL\_RedMod(u2ModLength) = modLen;
1214       PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaGenerateParams_a67476127ccca460cef6df3b10e6d4167}{mod});
1215       PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaGenerateParams_aac6e39bd18aff7adcb9343b6ce2f87d9}{cns});
1216       PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaGenerateParams_af252ee26c88488da32c60609a1d2c53d}{r});
1217       PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaGenerateParams_ad1e4d535ebd29d5d2282116af706e268}{x});
1218 
1219       \textcolor{comment}{//Perform modular reduction setup}
1220       vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1221 
1222       \textcolor{comment}{//Check status code}
1223       \textcolor{keywordflow}{if}(PUKCL(u2Status) != PUKCL\_OK)
1224          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1225    \}
1226 
1227    \textcolor{comment}{//Check error code}
1228    \textcolor{keywordflow}{if}(!error)
1229    \{
1230       \textcolor{comment}{//Point to the crypto memory}
1231       pos = params.\hyperlink{structPukccZpEcDsaGenerateParams_af252ee26c88488da32c60609a1d2c53d}{r};
1232 
1233       \textcolor{comment}{//Copy base point coordinates}
1234       params.\hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
1235       params.\hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
1236       params.\hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_ac53a6ff4888f818509027e37004635f5}{z}, modLen + 4);
1237 
1238       \textcolor{comment}{//Copy base point order}
1239       params.\hyperlink{structPukccZpEcDsaGenerateParams_ae5ba8660f3741c1e44f38b98460a6301}{order} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q}, scalarLen + 4);
1240       \textcolor{comment}{//Copy curve parameter a}
1241       params.\hyperlink{structPukccZpEcDsaGenerateParams_a2d987f1e1f0648a1736c0370812cc2a2}{a} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a108755e9eeb457a4df867816ee795589}{a}, modLen + 4);
1242       \textcolor{comment}{//Copy private key}
1243       params.\hyperlink{structPukccZpEcDsaGenerateParams_af6ee0e9db6824974381a78831ac553bb}{privateKey} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, privateKey, scalarLen + 4);
1244       \textcolor{comment}{//Copy random scalar}
1245       params.\hyperlink{structPukccZpEcDsaGenerateParams_a3de85b4e843735409b66a9f93fb9cdbb}{k} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &k, scalarLen + 4);
1246       \textcolor{comment}{//Copy digest}
1247       params.\hyperlink{structPukccZpEcDsaGenerateParams_a09558e9d9154f9d7a18f5d28230da925}{h} = \hyperlink{samd51__crypto__pukcc_8c_a9abe11c6e1becd198d65bf4f35d80636}{pukccImportArray}(&pos, digest, digestLen, scalarLen + 4);
1248       \textcolor{comment}{//Initialize workspace}
1249       params.\hyperlink{structPukccZpEcDsaGenerateParams_a2f5e57865fea17a2400913715241e356}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 8 * modLen + 44);
1250 
1251       \textcolor{comment}{//Set ZpEcDsaGenerateFast service parameters}
1252       PUKCL\_ZpEcDsaGenerate(u2ModLength) = modLen;
1253       PUKCL\_ZpEcDsaGenerate(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a67476127ccca460cef6df3b10e6d4167}{mod});
1254       PUKCL\_ZpEcDsaGenerate(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_aac6e39bd18aff7adcb9343b6ce2f87d9}{cns});
1255       PUKCL\_ZpEcDsaGenerate(nu1PointABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
1256       PUKCL\_ZpEcDsaGenerate(nu1OrderPointBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_ae5ba8660f3741c1e44f38b98460a6301}{order});
1257       PUKCL\_ZpEcDsaGenerate(nu1ABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a2d987f1e1f0648a1736c0370812cc2a2}{a});
1258       PUKCL\_ZpEcDsaGenerate(nu1PrivateKey) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_af6ee0e9db6824974381a78831ac553bb}{privateKey});
1259       PUKCL\_ZpEcDsaGenerate(u2ScalarLength) = scalarLen;
1260       PUKCL\_ZpEcDsaGenerate(nu1ScalarNumber) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a3de85b4e843735409b66a9f93fb9cdbb}{k});
1261       PUKCL\_ZpEcDsaGenerate(nu1HashBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a09558e9d9154f9d7a18f5d28230da925}{h});
1262       PUKCL\_ZpEcDsaGenerate(nu1Workspace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaGenerateParams_a2f5e57865fea17a2400913715241e356}{w});
1263 
1264       \textcolor{comment}{//Perform ECDSA signature generation}
1265       vPUKCL\_Process(ZpEcDsaGenerateFast, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1266 
1267       \textcolor{comment}{//Check status code}
1268       \textcolor{keywordflow}{if}(PUKCL(u2Status) != PUKCL\_OK)
1269          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1270    \}
1271 
1272    \textcolor{comment}{//Check error code}
1273    \textcolor{keywordflow}{if}(!error)
1274    \{
1275       \textcolor{comment}{//Copy the first part of the ECDSA signature}
1276       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&signature->\hyperlink{structEcdsaSignature_a4e23fcd13582b13713fd2b79355ec586}{r}, params.\hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x}, scalarLen,
1277          \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
1278    \}
1279 
1280    \textcolor{comment}{//Check error code}
1281    \textcolor{keywordflow}{if}(!error)
1282    \{
1283       \textcolor{comment}{//Copy the second part of the ECDSA signature}
1284       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&signature->\hyperlink{structEcdsaSignature_a5ad53c056e439704d86c50e4b8a328b6}{s}, params.\hyperlink{structPukccZpEcDsaGenerateParams_a7553b99e55e4d0f9a8187f4694e1dd21}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} + scalarLen + 4,
1285          scalarLen, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
1286    \}
1287 
1288    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
1289    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1290 
1291    \textcolor{comment}{//Check error code}
1292    \textcolor{keywordflow}{if}(!error)
1293    \{
1294       \textcolor{comment}{//Dump ECDSA signature}
1295       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  r:\(\backslash\)r\(\backslash\)n"});
1296       \hyperlink{debug_8h_a9c9f3b28f2daf14d77b401512c189d93}{TRACE\_DEBUG\_MPI}(\textcolor{stringliteral}{"    "}, &signature->\hyperlink{structEcdsaSignature_a4e23fcd13582b13713fd2b79355ec586}{r});
1297       \hyperlink{debug_8h_a67a8f9bc74358aa21745a76e23768dae}{TRACE\_DEBUG}(\textcolor{stringliteral}{"  s:\(\backslash\)r\(\backslash\)n"});
1298       \hyperlink{debug_8h_a9c9f3b28f2daf14d77b401512c189d93}{TRACE\_DEBUG\_MPI}(\textcolor{stringliteral}{"    "}, &signature->\hyperlink{structEcdsaSignature_a5ad53c056e439704d86c50e4b8a328b6}{s});
1299    \}
1300 
1301    \textcolor{comment}{//Release multiple precision integer}
1302    \hyperlink{mpi_8c_a9dc5be2f62d37d3854fa61beab3a61ad}{mpiFree}(&k);
1303 
1304    \textcolor{comment}{//Return error code}
1305    \textcolor{keywordflow}{return} error;
1306 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_aa4b2c48eaeeda048fb556499a9267387}\label{samd51__crypto__pukcc_8c_aa4b2c48eaeeda048fb556499a9267387}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!ecdsa\+Verify\+Signature@{ecdsa\+Verify\+Signature}}
\index{ecdsa\+Verify\+Signature@{ecdsa\+Verify\+Signature}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{ecdsa\+Verify\+Signature()}{ecdsaVerifySignature()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ecdsa\+Verify\+Signature (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{ec\+Params,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{public\+Key,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{digest,  }\item[{size\+\_\+t}]{digest\+Len,  }\item[{const \hyperlink{structEcdsaSignature}{Ecdsa\+Signature} $\ast$}]{signature }\end{DoxyParamCaption})}



E\+C\+D\+SA signature verification. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ec\+Params} & EC domain parameters \\
\hline
\mbox{\tt in}  & {\em public\+Key} & Signer\textquotesingle{}s E\+C\+D\+SA public key \\
\hline
\mbox{\tt in}  & {\em digest} & Digest of the message whose signature is to be verified \\
\hline
\mbox{\tt in}  & {\em digest\+Len} & Length in octets of the digest \\
\hline
\mbox{\tt in}  & {\em signature} & (R, S) integer pair \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1319 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
1322 \{
1323    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1324    \textcolor{keywordtype}{size\_t} modLen;
1325    \textcolor{keywordtype}{size\_t} orderLen;
1326    \textcolor{keywordtype}{size\_t} scalarLen;
1327    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
1328    \hyperlink{structPukccZpEcDsaVerifyParams}{PukccZpEcDsaVerifyParams} params;
1329 
1330    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
1331    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p});
1332    modLen = (modLen + 3U) & ~3U;
1333 
1334    \textcolor{comment}{//Retrieve the length of the base point order, in bytes}
1335    orderLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q});
1336    orderLen = (orderLen + 3U) & ~3U;
1337 
1338    \textcolor{comment}{//Compute the length of the scalar}
1339    scalarLen = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(orderLen, digestLen);
1340    scalarLen = (scalarLen + 3U) & ~3U;
1341 
1342    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
1343    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1344 
1345    \textcolor{comment}{//Point to the crypto memory}
1346    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
1347 
1348    \textcolor{comment}{//Copy modulus}
1349    params.\hyperlink{structPukccZpEcDsaVerifyParams_ab5497524c8736848d2ad4684f30383d8}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p}, modLen + 4);
1350    \textcolor{comment}{//Initialize reduction constant}
1351    params.\hyperlink{structPukccZpEcDsaVerifyParams_aadd1ae7fc5a7896987eabf923ae03cbe}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, scalarLen + 12);
1352    \textcolor{comment}{//Initialize workspace R}
1353    params.\hyperlink{structPukccZpEcDsaVerifyParams_a8023f1b83123f175eba92c43df1b84d5}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
1354    \textcolor{comment}{//Initialize workspace X}
1355    params.\hyperlink{structPukccZpEcDsaVerifyParams_a7ade27e4f2d94397ec5b80f91eaa7854}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
1356 
1357    \textcolor{comment}{//Set RedMod service parameters}
1358    PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
1359    PUKCL(Specific).CarryIn = 0;
1360    PUKCL(Specific).Gf2n = 0;
1361    PUKCL\_RedMod(u2ModLength) = modLen;
1362    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaVerifyParams_ab5497524c8736848d2ad4684f30383d8}{mod});
1363    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaVerifyParams_aadd1ae7fc5a7896987eabf923ae03cbe}{cns});
1364    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaVerifyParams_a8023f1b83123f175eba92c43df1b84d5}{r});
1365    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcDsaVerifyParams_a7ade27e4f2d94397ec5b80f91eaa7854}{x});
1366 
1367    \textcolor{comment}{//Perform modular reduction setup}
1368    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1369 
1370    \textcolor{comment}{//Check status code}
1371    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
1372    \{
1373       \textcolor{comment}{//Point to the crypto memory}
1374       pos = params.\hyperlink{structPukccZpEcDsaVerifyParams_a8023f1b83123f175eba92c43df1b84d5}{r};
1375 
1376       \textcolor{comment}{//Copy base point coordinates}
1377       params.\hyperlink{structPukccZpEcDsaVerifyParams_a2ac5ccd3dff517eada95c413132f45a4}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
1378       params.\hyperlink{structPukccZpEcDsaVerifyParams_a2ac5ccd3dff517eada95c413132f45a4}{basePoint}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
1379       params.\hyperlink{structPukccZpEcDsaVerifyParams_a2ac5ccd3dff517eada95c413132f45a4}{basePoint}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->
      \hyperlink{structEcDomainParameters_a48b4ef67c6d94e7be182ae6b73708511}{g}.\hyperlink{structEcPoint_ac53a6ff4888f818509027e37004635f5}{z}, modLen + 4);
1380 
1381       \textcolor{comment}{//Copy base point order}
1382       params.\hyperlink{structPukccZpEcDsaVerifyParams_acb7fa19dc53f55a40127565dab56851d}{order} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_afcdd8e7ec1aa29476df4e2ae13882a12}{q}, scalarLen + 4);
1383       \textcolor{comment}{//Copy curve parameter a}
1384       params.\hyperlink{structPukccZpEcDsaVerifyParams_afd880dd25731dede8f814a0b23ca7c76}{a} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a108755e9eeb457a4df867816ee795589}{a}, modLen + 4);
1385 
1386       \textcolor{comment}{//Copy public key}
1387       params.\hyperlink{structPukccZpEcDsaVerifyParams_a00dc7a9a7dd8a3ff055a2b6cd79d5907}{publicKey}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &publicKey->
      \hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
1388       params.\hyperlink{structPukccZpEcDsaVerifyParams_a00dc7a9a7dd8a3ff055a2b6cd79d5907}{publicKey}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &publicKey->
      \hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
1389       params.\hyperlink{structPukccZpEcDsaVerifyParams_a00dc7a9a7dd8a3ff055a2b6cd79d5907}{publicKey}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 4);
1390       params.\hyperlink{structPukccZpEcDsaVerifyParams_a00dc7a9a7dd8a3ff055a2b6cd79d5907}{publicKey}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z}[0] = 1;
1391 
1392       \textcolor{comment}{//Copy digest}
1393       params.\hyperlink{structPukccZpEcDsaVerifyParams_a9681bbb92e694fedbf43187ecf9901a4}{h} = \hyperlink{samd51__crypto__pukcc_8c_a9abe11c6e1becd198d65bf4f35d80636}{pukccImportArray}(&pos, digest, digestLen, scalarLen + 4);
1394 
1395       \textcolor{comment}{//Copy signature}
1396       params.\hyperlink{structPukccZpEcDsaVerifyParams_a8023f1b83123f175eba92c43df1b84d5}{r} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &signature->\hyperlink{structEcdsaSignature_a4e23fcd13582b13713fd2b79355ec586}{r}, scalarLen + 4);
1397       params.\hyperlink{structPukccZpEcDsaVerifyParams_a573aa7ef095778e92f93c07b79a77c55}{s} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &signature->\hyperlink{structEcdsaSignature_a5ad53c056e439704d86c50e4b8a328b6}{s}, scalarLen + 4);
1398 
1399       \textcolor{comment}{//Initialize workspace}
1400       params.\hyperlink{structPukccZpEcDsaVerifyParams_a31f84c1a1e5b1918691c76eeda448dda}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 8 * modLen + 44);
1401 
1402       \textcolor{comment}{//Set ZpEcDsaVerifyFast service parameters}
1403       PUKCL(u2Option) = 0;
1404       PUKCL\_ZpEcDsaVerify(u2ModLength) = modLen;
1405       PUKCL\_ZpEcDsaVerify(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_ab5497524c8736848d2ad4684f30383d8}{mod});
1406       PUKCL\_ZpEcDsaVerify(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_aadd1ae7fc5a7896987eabf923ae03cbe}{cns});
1407       PUKCL\_ZpEcDsaVerify(nu1PointABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_a2ac5ccd3dff517eada95c413132f45a4}{basePoint}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
1408       PUKCL\_ZpEcDsaVerify(nu1OrderPointBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_acb7fa19dc53f55a40127565dab56851d}{order});
1409       PUKCL\_ZpEcDsaVerify(nu1ABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_afd880dd25731dede8f814a0b23ca7c76}{a});
1410       PUKCL\_ZpEcDsaVerify(nu1PointPublicKeyGen) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_a00dc7a9a7dd8a3ff055a2b6cd79d5907}{publicKey}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
1411       PUKCL\_ZpEcDsaVerify(u2ScalarLength) = scalarLen;
1412       PUKCL\_ZpEcDsaVerify(nu1HashBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_a9681bbb92e694fedbf43187ecf9901a4}{h});
1413       PUKCL\_ZpEcDsaVerify(nu1PointSignature) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_a8023f1b83123f175eba92c43df1b84d5}{r});
1414       PUKCL\_ZpEcDsaVerify(nu1Workspace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcDsaVerifyParams_a31f84c1a1e5b1918691c76eeda448dda}{w});
1415 
1416       \textcolor{comment}{//Perform ECDSA signature verification}
1417       vPUKCL\_Process(ZpEcDsaVerifyFast, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1418    \}
1419 
1420    \textcolor{comment}{//Check status code}
1421    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
1422    \{
1423       \textcolor{comment}{//The ECDSA signature is valid}
1424       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1425    \}
1426    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_WRONG\_SIGNATURE)
1427    \{
1428       \textcolor{comment}{//The ECDSA signature is not valid}
1429       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca6e8db1d17e3aad53ecc5a4ff62df6f48}{ERROR\_INVALID\_SIGNATURE};
1430    \}
1431    \textcolor{keywordflow}{else}
1432    \{
1433       \textcolor{comment}{//Report an error}
1434       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1435    \}
1436 
1437    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
1438    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1439 
1440    \textcolor{comment}{//Return status code}
1441    \textcolor{keywordflow}{return} error;
1442 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a655440093a9706c87bc50871c3d57030}\label{samd51__crypto__pukcc_8c_a655440093a9706c87bc50871c3d57030}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!ec\+Is\+Point\+Affine@{ec\+Is\+Point\+Affine}}
\index{ec\+Is\+Point\+Affine@{ec\+Is\+Point\+Affine}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{ec\+Is\+Point\+Affine()}{ecIsPointAffine()}}
{\footnotesize\ttfamily \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\+\_\+t} ec\+Is\+Point\+Affine (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{ec\+Params,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{s }\end{DoxyParamCaption})}



Check whether the affine point S is on the curve. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ec\+Params} & EC domain parameters \\
\hline
\mbox{\tt in}  & {\em s} & Affine representation of the point \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+R\+UE if the affine point S is on the curve, else F\+A\+L\+SE 
\end{DoxyReturn}


Definition at line 808 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
809 \{
810    \hyperlink{compiler__port_8h_a812d16e5494522586b3784e55d479912}{bool\_t} valid;
811    \textcolor{keywordtype}{size\_t} modLen;
812    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
813    \hyperlink{structPukccZpEcPointIsOnCurveParams}{PukccZpEcPointIsOnCurveParams} params;
814 
815    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
816    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p});
817    modLen = (modLen + 3U) & ~3U;
818 
819    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
820    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
821 
822    \textcolor{comment}{//Point to the crypto memory}
823    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
824 
825    \textcolor{comment}{//Copy modulus}
826    params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a43126c13a8c8ca9de12cbaa9fd9021ff}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p}, modLen + 4);
827    \textcolor{comment}{//Initialize reduction constant}
828    params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a232e6929e51d0752219b1bae67828483}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 12);
829    \textcolor{comment}{//Initialize workspace R}
830    params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a91dff80f05aff699428a6e803cda0e81}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
831    \textcolor{comment}{//Initialize workspace X}
832    params.\hyperlink{structPukccZpEcPointIsOnCurveParams_aef767e9a73923ea5d20df44cf89d7228}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
833 
834    \textcolor{comment}{//Set RedMod service parameters}
835    PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
836    PUKCL(Specific).CarryIn = 0;
837    PUKCL(Specific).Gf2n = 0;
838    PUKCL\_RedMod(u2ModLength) = modLen;
839    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a43126c13a8c8ca9de12cbaa9fd9021ff}{mod});
840    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a232e6929e51d0752219b1bae67828483}{cns});
841    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a91dff80f05aff699428a6e803cda0e81}{r});
842    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEcPointIsOnCurveParams_aef767e9a73923ea5d20df44cf89d7228}{x});
843 
844    \textcolor{comment}{//Perform modular reduction setup}
845    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
846 
847    \textcolor{comment}{//Check status code}
848    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
849    \{
850       \textcolor{comment}{//Point to the crypto memory}
851       pos = params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a91dff80f05aff699428a6e803cda0e81}{r};
852 
853       \textcolor{comment}{//Copy point coordinates}
854       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a5ccfdf230b4aea9c8f5e5e185499c4de}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
855       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a5ccfdf230b4aea9c8f5e5e185499c4de}{point}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
856       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a5ccfdf230b4aea9c8f5e5e185499c4de}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 4);
857       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a5ccfdf230b4aea9c8f5e5e185499c4de}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z}[0] = 1;
858 
859       \textcolor{comment}{//Copy curve parameter a}
860       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a84c61e658ba58db00bd8a60aaeedfa1a}{a} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a108755e9eeb457a4df867816ee795589}{a}, modLen + 4);
861       \textcolor{comment}{//Copy curve parameter b}
862       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a6d13e2ae39ad5cd57daff1f1be7963e8}{b} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a13b11f7ebb928f2407abb4ce5b40fffd}{b}, modLen + 4);
863       \textcolor{comment}{//Initialize workspace}
864       params.\hyperlink{structPukccZpEcPointIsOnCurveParams_a61dd44da18307b2728ad775385e3714b}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4 * modLen + 28);
865 
866       \textcolor{comment}{//Set ZpEcPointIsOnCurve service parameters}
867       PUKCL\_ZpEcPointIsOnCurve(u2ModLength) = modLen;
868       PUKCL\_ZpEcPointIsOnCurve(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a43126c13a8c8ca9de12cbaa9fd9021ff}{mod});
869       PUKCL\_ZpEcPointIsOnCurve(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a232e6929e51d0752219b1bae67828483}{cns});
870       PUKCL\_ZpEcPointIsOnCurve(nu1PointBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a5ccfdf230b4aea9c8f5e5e185499c4de}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
871       PUKCL\_ZpEcPointIsOnCurve(nu1AParam) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a84c61e658ba58db00bd8a60aaeedfa1a}{a});
872       PUKCL\_ZpEcPointIsOnCurve(nu1BParam) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a6d13e2ae39ad5cd57daff1f1be7963e8}{b});
873       PUKCL\_ZpEcPointIsOnCurve(nu1Workspace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEcPointIsOnCurveParams_a61dd44da18307b2728ad775385e3714b}{w});
874 
875       \textcolor{comment}{//Test whether the point is on the curve}
876       vPUKCL\_Process(ZpEcPointIsOnCurve, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
877    \}
878 
879    \textcolor{comment}{//Check status code}
880    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
881    \{
882       \textcolor{comment}{//The point S is on the elliptic curve}
883       valid = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
884    \}
885    \textcolor{keywordflow}{else}
886    \{
887       \textcolor{comment}{//The point S is not on the elliptic curve}
888       valid = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
889    \}
890 
891    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
892    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
893 
894    \textcolor{comment}{//Return TRUE if the affine point S is on the curve, else FALSE}
895    \textcolor{keywordflow}{return} valid;
896 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a144a1f7a6c5fb844e05bc6e9cc7473c5}\label{samd51__crypto__pukcc_8c_a144a1f7a6c5fb844e05bc6e9cc7473c5}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!ec\+Mult@{ec\+Mult}}
\index{ec\+Mult@{ec\+Mult}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{ec\+Mult()}{ecMult()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} ec\+Mult (\begin{DoxyParamCaption}\item[{const \hyperlink{structEcDomainParameters}{Ec\+Domain\+Parameters} $\ast$}]{ec\+Params,  }\item[{\hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{r,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{d,  }\item[{const \hyperlink{structEcPoint}{Ec\+Point} $\ast$}]{s }\end{DoxyParamCaption})}



Scalar multiplication. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ec\+Params} & EC domain parameters \\
\hline
\mbox{\tt out}  & {\em r} & Resulting point R = d.\+S \\
\hline
\mbox{\tt in}  & {\em d} & An integer d such as 0 $<$= d $<$ p \\
\hline
\mbox{\tt in}  & {\em s} & EC point \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1017 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
1019 \{
1020    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1021    \textcolor{keywordtype}{size\_t} kLen;
1022    \textcolor{keywordtype}{size\_t} modLen;
1023    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
1024    \hyperlink{structPukccZpEccMulParams}{PukccZpEccMulParams} params;
1025 
1026    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
1027    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p});
1028    modLen = (modLen + 3U) & ~3U;
1029 
1030    \textcolor{comment}{//Retrieve the length of the scalar number}
1031    kLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(d);
1032    kLen = (kLen + 3U) & ~3U;
1033 
1034    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
1035    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1036 
1037    \textcolor{comment}{//Point to the crypto memory}
1038    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
1039 
1040    \textcolor{comment}{//Copy modulus}
1041    params.\hyperlink{structPukccZpEccMulParams_aa5827ad1fea4f3005beffe8b2edeca6e}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a497e7494540878b966444dc4ad973cdc}{p}, modLen + 4);
1042    \textcolor{comment}{//Initialize reduction constant}
1043    params.\hyperlink{structPukccZpEccMulParams_a4db4d800164548e8860757561f4b8e4c}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 12);
1044    \textcolor{comment}{//Initialize workspace R}
1045    params.\hyperlink{structPukccZpEccMulParams_a44842039661952ef4db6a9b295583422}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
1046    \textcolor{comment}{//Initialize workspace X}
1047    params.\hyperlink{structPukccZpEccMulParams_ae3b79d9b1db130b111a66cf70c44025d}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
1048 
1049    \textcolor{comment}{//Set RedMod service parameters}
1050    PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
1051    PUKCL(Specific).CarryIn = 0;
1052    PUKCL(Specific).Gf2n = 0;
1053    PUKCL\_RedMod(u2ModLength) = modLen;
1054    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_aa5827ad1fea4f3005beffe8b2edeca6e}{mod});
1055    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_a4db4d800164548e8860757561f4b8e4c}{cns});
1056    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_a44842039661952ef4db6a9b295583422}{r});
1057    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_ae3b79d9b1db130b111a66cf70c44025d}{x});
1058 
1059    \textcolor{comment}{//Perform modular reduction setup}
1060    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1061 
1062    \textcolor{comment}{//Check status code}
1063    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
1064    \{
1065       \textcolor{comment}{//Point to the crypto memory}
1066       pos = params.\hyperlink{structPukccZpEccMulParams_a44842039661952ef4db6a9b295583422}{r};
1067 
1068       \textcolor{comment}{//Copy scalar number}
1069       params.\hyperlink{structPukccZpEccMulParams_a9ac059035c463cbe4f2f94521e1c4e30}{k} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, d, kLen + 4);
1070 
1071       \textcolor{comment}{//Copy point coordinates}
1072       params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, modLen + 4);
1073       params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &s->\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, modLen + 4);
1074       params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 4);
1075       params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z}[0] = 1;
1076 
1077       \textcolor{comment}{//Copy curve parameter a}
1078       params.\hyperlink{structPukccZpEccMulParams_aa0a8b0bc9f5ecd329f7abbb4727d2bf8}{a} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &ecParams->\hyperlink{structEcDomainParameters_a108755e9eeb457a4df867816ee795589}{a}, modLen + 4);
1079       \textcolor{comment}{//Initialize workspace}
1080       params.\hyperlink{structPukccZpEccMulParams_a8ce33078130810d053a89097a40fb16e}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 8 * modLen + 44);
1081 
1082       \textcolor{comment}{//Set ZpEccMulFast service parameters}
1083       PUKCL\_ZpEccMul(u2ModLength) = modLen;
1084       PUKCL\_ZpEccMul(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_aa5827ad1fea4f3005beffe8b2edeca6e}{mod});
1085       PUKCL\_ZpEccMul(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_a4db4d800164548e8860757561f4b8e4c}{cns});
1086       PUKCL\_ZpEccMul(u2KLength) = kLen;
1087       PUKCL\_ZpEccMul(nu1KBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_a9ac059035c463cbe4f2f94521e1c4e30}{k});
1088       PUKCL\_ZpEccMul(nu1PointBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.
      \hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x});
1089       PUKCL\_ZpEccMul(nu1ABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_aa0a8b0bc9f5ecd329f7abbb4727d2bf8}{a});
1090       PUKCL\_ZpEccMul(nu1Workspace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccZpEccMulParams_a8ce33078130810d053a89097a40fb16e}{w});
1091 
1092       \textcolor{comment}{//Perform scalar multiplication over GF(p)}
1093       vPUKCL\_Process(ZpEccMulFast, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
1094    \}
1095 
1096    \textcolor{comment}{//Check status code}
1097    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
1098    \{
1099       \textcolor{comment}{//Copy the x-coordinate of the result}
1100       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_a08f3fbb7a7d07607306bd8d6200629af}{x}, params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_ae3c213e2c33cf57679f00aa6d49765bf}{x}, modLen,
1101          \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
1102 
1103       \textcolor{comment}{//Check error code}
1104       \textcolor{keywordflow}{if}(!error)
1105       \{
1106          \textcolor{comment}{//Copy the y-coordinate of the result}
1107          error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_a2102dff813849bd0eaed8a1a5e64ec1f}{y}, params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_aa4efb7c13982bb8c7dbb8805a7798d9b}{y}, modLen,
1108             \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
1109       \}
1110 
1111       \textcolor{comment}{//Check error code}
1112       \textcolor{keywordflow}{if}(!error)
1113       \{
1114          \textcolor{comment}{//Copy the z-coordinate of the result}
1115          error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(&r->\hyperlink{structEcPoint_ac53a6ff4888f818509027e37004635f5}{z}, params.\hyperlink{structPukccZpEccMulParams_ac18676b15ed41f4d801b8d419478a9e3}{point}.\hyperlink{structPukccEcPoint_a4c9d0fd92c00c7bf6bd0d8c9584c1f62}{z}, modLen,
1116             \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
1117       \}
1118    \}
1119    \textcolor{keywordflow}{else}
1120    \{
1121       \textcolor{comment}{//Report an error}
1122       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
1123    \}
1124 
1125    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
1126    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
1127 
1128    \textcolor{comment}{//Return error code}
1129    \textcolor{keywordflow}{return} error;
1130 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_afc585fe41f6754070e5d99e61cc9a2b1}\label{samd51__crypto__pukcc_8c_afc585fe41f6754070e5d99e61cc9a2b1}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!mpi\+Check\+Probable\+Prime@{mpi\+Check\+Probable\+Prime}}
\index{mpi\+Check\+Probable\+Prime@{mpi\+Check\+Probable\+Prime}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{mpi\+Check\+Probable\+Prime()}{mpiCheckProbablePrime()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mpi\+Check\+Probable\+Prime (\begin{DoxyParamCaption}\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a }\end{DoxyParamCaption})}



Test whether a number is probable prime. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & Pointer to a multiple precision integer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 571 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
572 \{
573    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
574    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
575    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
576    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
577    \hyperlink{structPukccPrimeGenParams}{PukccPrimeGenParams} params;
578 
579    \textcolor{comment}{//Retrieve the length of the input integer, in bits}
580    n = \hyperlink{mpi_8c_a2e540eb4b5d15ea9755fb3e138990c1c}{mpiGetBitLength}(a);
581 
582    \textcolor{comment}{//Prime numbers of a size lower than 96 bits cannot be tested by this}
583    \textcolor{comment}{//service}
584    \textcolor{keywordflow}{if}(n < 96)
585       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
586 
587    \textcolor{comment}{//The number of repetitions controls the error probability}
588    \textcolor{keywordflow}{if}(n >= 1300)
589       k = 2;
590    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 850)
591       k = 3;
592    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 650)
593       k = 4;
594    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 550)
595       k = 5;
596    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 450)
597       k = 6;
598    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 400)
599       k = 7;
600    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 350)
601       k = 8;
602    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 300)
603       k = 9;
604    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 250)
605       k = 12;
606    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 200)
607       k = 15;
608    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(n >= 150)
609       k = 18;
610    \textcolor{keywordflow}{else}
611       k = 27;
612 
613    \textcolor{comment}{//Retrieve the length of the input integer, in bytes}
614    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
615    n = (n + 3U) & ~3U;
616 
617    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
618    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
619 
620    \textcolor{comment}{//Point to the crypto memory}
621    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
622 
623    \textcolor{comment}{//One additional word is used on the LSB side of the NBase parameter. As}
624    \textcolor{comment}{//a consequence, the parameter nu1NBase must never be at the beginning of}
625    \textcolor{comment}{//the crypto RAM, but at least at one word from the beginning}
626    \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4);
627 
628    \textcolor{comment}{//Copy the number to test}
629    params.\hyperlink{structPukccPrimeGenParams_ac685ee671de74cb9c6cd1275060ab60d}{n} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, a, n + 4);
630    \textcolor{comment}{//Cns is used as a workspace}
631    params.\hyperlink{structPukccPrimeGenParams_ae8068e2fe9ab90e9d1088bc3eb6ffdfb}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, n + 12);
632    \textcolor{comment}{//Rnd is used as a workspace}
633    params.\hyperlink{structPukccPrimeGenParams_a6fae7226854fe95cfb51611b60d55b60}{rnd} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(n + 16, 64));
634    \textcolor{comment}{//Precomp is used as a precomputation workspace}
635    params.\hyperlink{structPukccPrimeGenParams_adb6b7cd3d710131ee8ad2d5aada6be09}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(3 * (n + 4), n + 72) + 8);
636    \textcolor{comment}{//Exp is used as a workspace}
637    params.\hyperlink{structPukccPrimeGenParams_a6bf437cdac813745c5fd5414238bd761}{exp} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, n + 4);
638 
639    \textcolor{comment}{//Unused parameter}
640    params.\hyperlink{structPukccPrimeGenParams_a48bb9e985196000ee5acb3dcaf7ab010}{r} = 0;
641 
642    \textcolor{comment}{//Set PrimeGen service parameters}
643    PUKCL(u2Option) = PUKCL\_PRIMEGEN\_TEST | PUKCL\_EXPMOD\_FASTRSA |
644       PUKCL\_EXPMOD\_WINDOWSIZE\_1;
645    PUKCL\_PrimeGen(u2NLength) = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
646    PUKCL\_PrimeGen(nu1NBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_ac685ee671de74cb9c6cd1275060ab60d}{n});
647    PUKCL\_PrimeGen(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_ae8068e2fe9ab90e9d1088bc3eb6ffdfb}{cns});
648    PUKCL\_PrimeGen(nu1RndBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_a6fae7226854fe95cfb51611b60d55b60}{rnd});
649    PUKCL\_PrimeGen(nu1PrecompBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_adb6b7cd3d710131ee8ad2d5aada6be09}{w});
650    PUKCL\_PrimeGen(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_a48bb9e985196000ee5acb3dcaf7ab010}{r});
651    PUKCL\_PrimeGen(nu1ExpBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccPrimeGenParams_a6bf437cdac813745c5fd5414238bd761}{exp});
652    PUKCL\_PrimeGen(u1MillerRabinIterations) = \hyperlink{md5_8c_af11ea3cdbca7345eb6a4a8ac5ce0434d}{k};
653    PUKCL\_PrimeGen(u2MaxIncrement) = 1;
654 
655    \textcolor{comment}{//Perform probable prime testing}
656    vPUKCL\_Process(PrimeGen, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
657 
658    \textcolor{comment}{//Check status code}
659    \textcolor{keywordflow}{switch}(PUKCL(u2Status))
660    \{
661    \textcolor{keywordflow}{case} PUKCL\_NUMBER\_IS\_PRIME:
662       \textcolor{comment}{//The number is probably prime}
663       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
664       \textcolor{keywordflow}{break};
665    \textcolor{keywordflow}{case} PUKCL\_NUMBER\_IS\_NOT\_PRIME:
666       \textcolor{comment}{//The number is not prime}
667       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca979424b1dc1779fe6193ab5161329513}{ERROR\_INVALID\_VALUE};
668       \textcolor{keywordflow}{break};
669    \textcolor{keywordflow}{default}:
670       \textcolor{comment}{//Report an error}
671       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
672       \textcolor{keywordflow}{break};
673    \}
674 
675    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
676    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
677 
678    \textcolor{comment}{//Return error code}
679    \textcolor{keywordflow}{return} error;
680 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_ae18482447f7293c8bb44899ce236b72e}\label{samd51__crypto__pukcc_8c_ae18482447f7293c8bb44899ce236b72e}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!mpi\+Exp\+Mod@{mpi\+Exp\+Mod}}
\index{mpi\+Exp\+Mod@{mpi\+Exp\+Mod}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{mpi\+Exp\+Mod()}{mpiExpMod()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mpi\+Exp\+Mod (\begin{DoxyParamCaption}\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{r,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{e,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{p }\end{DoxyParamCaption})}



Modular exponentiation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em r} & Resulting integer R = A $^\wedge$ E mod P \\
\hline
\mbox{\tt in}  & {\em a} & Pointer to a multiple precision integer \\
\hline
\mbox{\tt in}  & {\em e} & Exponent \\
\hline
\mbox{\tt in}  & {\em p} & Modulus \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 421 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
422 \{
423    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
424    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
425    \textcolor{keywordtype}{size\_t} modLen;
426    \textcolor{keywordtype}{size\_t} expLen;
427    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
428    \hyperlink{structPukccExpModParams}{PukccExpModParams} params;
429 
430    \textcolor{comment}{//Retrieve the length of the input integer, in bytes}
431    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
432 
433    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
434    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(p);
435    modLen = (modLen + 3U) & ~3U;
436 
437    \textcolor{comment}{//Retrieve the length of the exponent, in bytes}
438    expLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(e);
439    expLen = (expLen + 3U) & ~3U;
440 
441    \textcolor{comment}{//Check the length of the input integer}
442    \textcolor{keywordflow}{if}(n > (2 * modLen + 4))
443       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
444 
445    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
446    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
447 
448    \textcolor{comment}{//Point to the crypto memory}
449    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
450 
451    \textcolor{comment}{//Copy modulus}
452    params.\hyperlink{structPukccExpModParams_af176be1f82564603bba8637782bbffe2}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, p, modLen + 4);
453    \textcolor{comment}{//Initialize reduction constant}
454    params.\hyperlink{structPukccExpModParams_a288aba4aaee5cc6bc89bcab0f7faa28b}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 12);
455    \textcolor{comment}{//Initialize workspace R}
456    params.\hyperlink{structPukccExpModParams_aa5d6ccb73961725de58d96d15047392c}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 64);
457    \textcolor{comment}{//Initialize workspace X}
458    params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 2 * modLen + 8);
459 
460    \textcolor{comment}{//Set RedMod service parameters}
461    PUKCL(u2Option) = PUKCL\_REDMOD\_SETUP;
462    PUKCL(Specific).CarryIn = 0;
463    PUKCL(Specific).Gf2n = 0;
464    PUKCL\_RedMod(u2ModLength) = modLen;
465    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_af176be1f82564603bba8637782bbffe2}{mod});
466    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a288aba4aaee5cc6bc89bcab0f7faa28b}{cns});
467    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_aa5d6ccb73961725de58d96d15047392c}{r});
468    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
469 
470    \textcolor{comment}{//Perform modular reduction setup}
471    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
472 
473    \textcolor{comment}{//Check status code}
474    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
475    \{
476       \textcolor{comment}{//Point to the crypto memory}
477       pos = params.\hyperlink{structPukccExpModParams_aa5d6ccb73961725de58d96d15047392c}{r};
478 
479       \textcolor{comment}{//Copy input number}
480       params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, a, 2 * modLen + 8);
481 
482       \textcolor{comment}{//Set RedMod service parameters}
483       PUKCL(u2Option) = PUKCL\_REDMOD\_REDUCTION | PUKCL\_REDMOD\_USING\_FASTRED;
484       PUKCL(Specific).CarryIn = 0;
485       PUKCL(Specific).Gf2n = 0;
486       PUKCL\_RedMod(u2ModLength) = modLen;
487       PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_af176be1f82564603bba8637782bbffe2}{mod});
488       PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a288aba4aaee5cc6bc89bcab0f7faa28b}{cns});
489       PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
490       PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
491 
492       \textcolor{comment}{//Perform fast modular reduction}
493       vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
494    \}
495 
496    \textcolor{comment}{//Check status code}
497    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
498    \{
499       \textcolor{comment}{//Set RedMod service parameters}
500       PUKCL(u2Option) = PUKCL\_REDMOD\_NORMALIZE;
501       PUKCL(Specific).CarryIn = 0;
502       PUKCL(Specific).Gf2n = 0;
503       PUKCL\_RedMod(u2ModLength) = modLen;
504       PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_af176be1f82564603bba8637782bbffe2}{mod});
505       PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a288aba4aaee5cc6bc89bcab0f7faa28b}{cns});
506       PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
507       PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
508 
509       \textcolor{comment}{//Normalize the result}
510       vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
511    \}
512 
513    \textcolor{comment}{//Check status code}
514    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
515    \{
516       \textcolor{comment}{//The number to be exponentiated is followed by four 32-bit words}
517       \textcolor{comment}{//that are used during the computations as a workspace}
518       pos = params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x} + modLen;
519       \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 16);
520 
521       \textcolor{comment}{//The exponent must be given with a supplemental word on the LSB}
522       \textcolor{comment}{//side (low addresses). This word shall be set to zero}
523       params.\hyperlink{structPukccExpModParams_afcf095e646200687b7771a108d001249}{exp} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4);
524       \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, e, expLen);
525 
526       \textcolor{comment}{//Initialize workspace}
527       params.\hyperlink{structPukccExpModParams_a7f91b881310c040369e0c7a063160d30}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 3 * (modLen + 4) + 8);
528 
529       \textcolor{comment}{//Set ExpMod service parameters}
530       PUKCL(u2Option) = PUKCL\_EXPMOD\_REGULARRSA | PUKCL\_EXPMOD\_WINDOWSIZE\_1 |
531          PUKCL\_EXPMOD\_EXPINPUKCCRAM;
532       PUKCL\_ExpMod(u2ModLength) = modLen;
533       PUKCL\_ExpMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_af176be1f82564603bba8637782bbffe2}{mod});
534       PUKCL\_ExpMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a288aba4aaee5cc6bc89bcab0f7faa28b}{cns});
535       PUKCL\_ExpMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x});
536       PUKCL\_ExpMod(nu1PrecompBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccExpModParams_a7f91b881310c040369e0c7a063160d30}{w});
537       PUKCL\_ExpMod(u2ExpLength) = expLen;
538       PUKCL\_ExpMod(pfu1ExpBase) = params.\hyperlink{structPukccExpModParams_afcf095e646200687b7771a108d001249}{exp};
539       PUKCL\_ExpMod(u1Blinding) = 0;
540 
541       \textcolor{comment}{//Perform modular exponentiation}
542       vPUKCL\_Process(ExpMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
543    \}
544 
545    \textcolor{comment}{//Check status code}
546    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
547    \{
548       \textcolor{comment}{//Copy resulting integer}
549       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(r, params.\hyperlink{structPukccExpModParams_a50fa133f87c6d181134a98337b13202b}{x}, modLen, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
550    \}
551    \textcolor{keywordflow}{else}
552    \{
553       \textcolor{comment}{//Report an error}
554       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
555    \}
556 
557    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
558    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
559 
560    \textcolor{comment}{//Return error code}
561    \textcolor{keywordflow}{return} error;
562 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a2195ea62b59019943aa5bfa4d309028f}\label{samd51__crypto__pukcc_8c_a2195ea62b59019943aa5bfa4d309028f}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!mpi\+Inv\+Mod@{mpi\+Inv\+Mod}}
\index{mpi\+Inv\+Mod@{mpi\+Inv\+Mod}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{mpi\+Inv\+Mod()}{mpiInvMod()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mpi\+Inv\+Mod (\begin{DoxyParamCaption}\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{r,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{p }\end{DoxyParamCaption})}



Modular inverse. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em r} & Resulting integer R = A$^\wedge$-\/1 mod P \\
\hline
\mbox{\tt in}  & {\em a} & The multiple precision integer A \\
\hline
\mbox{\tt in}  & {\em p} & The modulus P \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 346 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
347 \{
348    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
349    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
350    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
351    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
352    \hyperlink{structPukccGcdParams}{PukccGcdParams} params;
353 
354    \textcolor{comment}{//Retrieve the length of the input integer, in bytes}
355    m = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
356    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
357    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(p);
358 
359    \textcolor{comment}{//Compute the length of the the areas X, Y, A and Z}
360    n = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(n, m);
361    n = (n + 7U) & ~3U;
362 
363    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
364    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
365 
366    \textcolor{comment}{//Point to the crypto memory}
367    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
368 
369    \textcolor{comment}{//Copy input integer}
370    params.\hyperlink{structPukccGcdParams_aaad588d0eb1db0d69f0fa1b93d2e4e67}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, a, n);
371    \textcolor{comment}{//Copy modulus}
372    params.\hyperlink{structPukccGcdParams_a57fe6aea2a7ac5b68f180bf6db554a18}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, p, n);
373    \textcolor{comment}{//Initialize output integer A}
374    params.\hyperlink{structPukccGcdParams_aa2ac5a55daafacaa034f186ce047c5a4}{a} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, n);
375    \textcolor{comment}{//Initialize output integer Z}
376    params.\hyperlink{structPukccGcdParams_aaf07c87d429ef806d1b8441850ccbdf7}{z} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, n + 4);
377    \textcolor{comment}{//Initialize workspace >}
378    params.\hyperlink{structPukccGcdParams_a7a0a058cf90e42593eb5ace26a93ea44}{w} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 32);
379 
380    \textcolor{comment}{//Set GCD service parameters}
381    PUKCL(Specific).Gf2n = 0;
382    PUKCL\_GCD(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccGcdParams_aaad588d0eb1db0d69f0fa1b93d2e4e67}{x});
383    PUKCL\_GCD(nu1YBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccGcdParams_a57fe6aea2a7ac5b68f180bf6db554a18}{y});
384    PUKCL\_GCD(nu1ABase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccGcdParams_aa2ac5a55daafacaa034f186ce047c5a4}{a});
385    PUKCL\_GCD(nu1ZBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccGcdParams_aaf07c87d429ef806d1b8441850ccbdf7}{z});
386    PUKCL\_GCD(nu1WorkSpace) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccGcdParams_a7a0a058cf90e42593eb5ace26a93ea44}{w});
387    PUKCL\_GCD(u2Length) = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
388 
389    \textcolor{comment}{//Calculate the modular inverse}
390    vPUKCL\_Process(GCD, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
391 
392    \textcolor{comment}{//Check status code}
393    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
394    \{
395       \textcolor{comment}{//Copy output integer Z}
396       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(r, params.\hyperlink{structPukccGcdParams_aa2ac5a55daafacaa034f186ce047c5a4}{a}, n, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
397    \}
398    \textcolor{keywordflow}{else}
399    \{
400       \textcolor{comment}{//Report an error}
401       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
402    \}
403 
404    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
405    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
406 
407    \textcolor{comment}{//Return error code}
408    \textcolor{keywordflow}{return} error;
409 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_ae7f045ab3eb22a74a2846f49d95f272e}\label{samd51__crypto__pukcc_8c_ae7f045ab3eb22a74a2846f49d95f272e}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!mpi\+Mod2@{mpi\+Mod2}}
\index{mpi\+Mod2@{mpi\+Mod2}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{mpi\+Mod2()}{mpiMod2()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mpi\+Mod2 (\begin{DoxyParamCaption}\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{r,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{p }\end{DoxyParamCaption})}



Modulo operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em r} & Resulting integer R = A mod P \\
\hline
\mbox{\tt in}  & {\em a} & The multiple precision integer to be reduced \\
\hline
\mbox{\tt in}  & {\em p} & The modulus P \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 271 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
272 \{
273    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
274    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
275    \textcolor{keywordtype}{size\_t} modLen;
276    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
277    \hyperlink{structPukccRedModParams}{PukccRedModParams} params;
278 
279    \textcolor{comment}{//Retrieve the length of the input integer, in bytes}
280    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
281 
282    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
283    modLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(p);
284    modLen = (modLen + 3U) & ~3U;
285 
286    \textcolor{comment}{//Check the length of the input integer}
287    \textcolor{keywordflow}{if}(n > (2 * modLen + 4))
288       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
289 
290    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
291    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
292 
293    \textcolor{comment}{//Point to the crypto memory}
294    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
295 
296    \textcolor{comment}{//Copy modulus}
297    params.\hyperlink{structPukccRedModParams_af09d279077a4542a83ea1a1712c83cc1}{mod} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, p, modLen + 4);
298    \textcolor{comment}{//Initialize workspace CNS}
299    params.\hyperlink{structPukccRedModParams_af77a83935bf3590641efc9bea0e92c3c}{cns} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 68);
300    \textcolor{comment}{//Initialize output integer R}
301    params.\hyperlink{structPukccRedModParams_ad190b2cdf469a2c0effcbab941c4f844}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, modLen + 4);
302    \textcolor{comment}{//Copy input integer X}
303    params.\hyperlink{structPukccRedModParams_af12974e9d34a4ccc9b3e2e71d87a9db0}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, a, 2 * modLen + 8);
304 
305    \textcolor{comment}{//Set RedMod service parameters}
306    PUKCL(u2Option) = PUKCL\_REDMOD\_REDUCTION | PUKCL\_REDMOD\_USING\_DIVISION;
307    PUKCL(Specific).CarryIn = 0;
308    PUKCL(Specific).Gf2n = 0;
309    PUKCL\_RedMod(u2ModLength) = modLen;
310    PUKCL\_RedMod(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccRedModParams_af09d279077a4542a83ea1a1712c83cc1}{mod});
311    PUKCL\_RedMod(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccRedModParams_af77a83935bf3590641efc9bea0e92c3c}{cns});
312    PUKCL\_RedMod(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccRedModParams_ad190b2cdf469a2c0effcbab941c4f844}{r});
313    PUKCL\_RedMod(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccRedModParams_af12974e9d34a4ccc9b3e2e71d87a9db0}{x});
314 
315    \textcolor{comment}{//Perform modular reduction setup}
316    vPUKCL\_Process(RedMod, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
317 
318    \textcolor{comment}{//Check status code}
319    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
320    \{
321       \textcolor{comment}{//If FMult is without reduction, R is filled with the final result}
322       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(r, params.\hyperlink{structPukccRedModParams_ad190b2cdf469a2c0effcbab941c4f844}{r}, modLen, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
323    \}
324    \textcolor{keywordflow}{else}
325    \{
326       \textcolor{comment}{//Report an error}
327       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
328    \}
329 
330    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
331    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
332 
333    \textcolor{comment}{//Return error code}
334    \textcolor{keywordflow}{return} error;
335 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a5ce82adaded4af385feef6b79aaad6d2}\label{samd51__crypto__pukcc_8c_a5ce82adaded4af385feef6b79aaad6d2}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!mpi\+Mul@{mpi\+Mul}}
\index{mpi\+Mul@{mpi\+Mul}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{mpi\+Mul()}{mpiMul()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} mpi\+Mul (\begin{DoxyParamCaption}\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{r,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{a,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{b }\end{DoxyParamCaption})}



Multiple precision multiplication. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em r} & Resulting integer R = A $\ast$ B \\
\hline
\mbox{\tt in}  & {\em a} & First operand A \\
\hline
\mbox{\tt in}  & {\em b} & Second operand B \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 190 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
191 \{
192    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
193    \textcolor{keywordtype}{size\_t} \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
194    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
195    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
196    \hyperlink{structPukccFmultParams}{PukccFmultParams} params;
197 
198    \textcolor{comment}{//Retrieve the length of the input integer, in bytes}
199    m = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(a);
200    m = (m + 3U) & ~3U;
201 
202    \textcolor{comment}{//Retrieve the length of the modulus, in bytes}
203    n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(b);
204    n = (n + 3U) & ~3U;
205 
206    \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
207    \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
208 
209    \textcolor{comment}{//Point to the crypto memory}
210    pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
211 
212    \textcolor{comment}{//Copy input integer X}
213    params.\hyperlink{structPukccFmultParams_ab8665adddab7eccfed10073e0e523a2a}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, a, m);
214    \textcolor{comment}{//Copy input integer Y}
215    params.\hyperlink{structPukccFmultParams_ac5deea5a9a5fe96802a833f340417bf7}{y} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, b, n);
216 
217    \textcolor{comment}{//Unused parameters}
218    params.\hyperlink{structPukccFmultParams_a9bbf57b29b0c6f8ee0d24b6e1d4cd150}{z} = 0;
219    params.\hyperlink{structPukccFmultParams_a380f88e7540dcedab27ac1802ef06985}{mod} = 0;
220    params.\hyperlink{structPukccFmultParams_ab1e0f083a649168a0836bf7c366d80c8}{cns} = 0;
221 
222    \textcolor{comment}{//Initialize output integer R}
223    params.\hyperlink{structPukccFmultParams_a67b56fdd3a13e561b523af275d00e050}{r} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, m + n);
224 
225    \textcolor{comment}{//Set Fmult service parameters}
226    PUKCL(u2Option) = SET\_MULTIPLIEROPTION(PUKCL\_FMULT\_ONLY) |
227       SET\_CARRYOPTION(CARRY\_NONE);
228    PUKCL(Specific).CarryIn = 0;
229    PUKCL(Specific).Gf2n = 0;
230    PUKCL\_Fmult(u2ModLength) = 0;
231    PUKCL\_Fmult(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_a380f88e7540dcedab27ac1802ef06985}{mod});
232    PUKCL\_Fmult(nu1CnsBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_ab1e0f083a649168a0836bf7c366d80c8}{cns});
233    PUKCL\_Fmult(u2XLength) = \hyperlink{ndp_8h_a6b3284d8492267a77ca46948daf5545e}{m};
234    PUKCL\_Fmult(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_ab8665adddab7eccfed10073e0e523a2a}{x});
235    PUKCL\_Fmult(u2YLength) = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
236    PUKCL\_Fmult(nu1YBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_ac5deea5a9a5fe96802a833f340417bf7}{y});
237    PUKCL\_Fmult(nu1ZBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_a9bbf57b29b0c6f8ee0d24b6e1d4cd150}{z});
238    PUKCL\_Fmult(nu1RBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccFmultParams_a67b56fdd3a13e561b523af275d00e050}{r});
239 
240    \textcolor{comment}{//Perform multiplication}
241    vPUKCL\_Process(Fmult, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
242 
243    \textcolor{comment}{//Check status code}
244    \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
245    \{
246       \textcolor{comment}{//If FMult is without reduction, R is filled with the final result}
247       error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(r, params.\hyperlink{structPukccFmultParams_a67b56fdd3a13e561b523af275d00e050}{r}, m + n, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
248    \}
249    \textcolor{keywordflow}{else}
250    \{
251       \textcolor{comment}{//Report an error}
252       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
253    \}
254 
255    \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
256    \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
257 
258    \textcolor{comment}{//Return error code}
259    \textcolor{keywordflow}{return} error;
260 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a9abe11c6e1becd198d65bf4f35d80636}\label{samd51__crypto__pukcc_8c_a9abe11c6e1becd198d65bf4f35d80636}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!pukcc\+Import\+Array@{pukcc\+Import\+Array}}
\index{pukcc\+Import\+Array@{pukcc\+Import\+Array}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{pukcc\+Import\+Array()}{pukccImportArray()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}$\ast$ pukcc\+Import\+Array (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$}]{dest,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{array,  }\item[{size\+\_\+t}]{array\+Len,  }\item[{size\+\_\+t}]{total\+Len }\end{DoxyParamCaption})}



Import byte array. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em dest} & Pointer to the crypto memory \\
\hline
\mbox{\tt in}  & {\em array} & Pointer to the byte array \\
\hline
\mbox{\tt in}  & {\em array\+Len} & Length of the array to be copied \\
\hline
\mbox{\tt in}  & {\em total\+Len} & Desired length of the area, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the initialized area 
\end{DoxyReturn}


Definition at line 98 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
100 \{
101    \textcolor{keywordtype}{size\_t} i;
102    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
103 
104    \textcolor{comment}{//Point to the crypto memory}
105    p = *dest;
106 
107    \textcolor{comment}{//Copy the byte array to the crypto memory}
108    \textcolor{keywordflow}{for}(i = 0; i < arrayLen; i++)
109    \{
110       p[i] = array[arrayLen - 1 - i];
111    \}
112 
113    \textcolor{comment}{//Pad the data with zeroes}
114    \textcolor{keywordflow}{while}(i < totalLen)
115    \{
116       p[i++] = 0;
117    \}
118 
119    \textcolor{comment}{//Advance data pointer}
120    *dest = p + i;
121 
122    \textcolor{comment}{//Return a pointer to the initialized area}
123    \textcolor{keywordflow}{return} \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
124 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}\label{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!pukcc\+Import\+Mpi@{pukcc\+Import\+Mpi}}
\index{pukcc\+Import\+Mpi@{pukcc\+Import\+Mpi}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{pukcc\+Import\+Mpi()}{pukccImportMpi()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}$\ast$ pukcc\+Import\+Mpi (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$}]{dest,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{src,  }\item[{size\+\_\+t}]{total\+Len }\end{DoxyParamCaption})}



Import multiple-\/precision integer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em dest} & Pointer to the crypto memory \\
\hline
\mbox{\tt in}  & {\em src} & Pointer to the multiple-\/precision integer \\
\hline
\mbox{\tt in}  & {\em total\+Len} & Desired length of the area, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the initialized area 
\end{DoxyReturn}


Definition at line 135 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
136 \{
137    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
138 
139    \textcolor{comment}{//Point to the crypto memory}
140    p = *dest;
141 
142    \textcolor{comment}{//Copy the multiple-precision integer to the crypto memory}
143    \hyperlink{mpi_8c_aad846b0b5a3560243e1bf8601ad1b6a5}{mpiExport}(src, p, totalLen, \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
144 
145    \textcolor{comment}{//Advance data pointer}
146    *dest = p + totalLen;
147 
148    \textcolor{comment}{//Return a pointer to the initialized area}
149    \textcolor{keywordflow}{return} \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
150 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_ac2204ce75455e8e0be1d075463d6dd4e}\label{samd51__crypto__pukcc_8c_ac2204ce75455e8e0be1d075463d6dd4e}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!pukcc\+Init@{pukcc\+Init}}
\index{pukcc\+Init@{pukcc\+Init}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{pukcc\+Init()}{pukccInit()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} pukcc\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize P\+U\+K\+CC public key accelerator. 



Definition at line 56 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
57 \{
58    \textcolor{comment}{//Enable PUKCC clock}
59    MCLK->AHBMASK.reg |= MCLK\_AHBMASK\_PUKCC;
60 
61    \textcolor{comment}{//Clear PUKCLParam structure}
62    memset(&\hyperlink{samd51__crypto__pukcc_8c_adc1948c03b6b4b2c8c88e286ace6efe4}{PUKCLParam}, 0, \textcolor{keyword}{sizeof}(PUKCL\_PARAM));
63    \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam} = &\hyperlink{samd51__crypto__pukcc_8c_adc1948c03b6b4b2c8c88e286ace6efe4}{PUKCLParam};
64 
65    \textcolor{comment}{//Initialize PUKCC}
66    vPUKCL\_Process(SelfTest, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
67 
68    \textcolor{comment}{//Check status code}
69    \textcolor{keywordflow}{if}(PUKCL(u2Status) != PUKCL\_OK)
70       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
71 
72    \textcolor{comment}{//Check version number}
73    \textcolor{keywordflow}{if}(\hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam}->P.PUKCL\_SelfTest.u4Version != PUKCL\_VERSION)
74       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
75 
76    \textcolor{comment}{//The return values from the SelfTest service must be compared against}
77    \textcolor{comment}{//known values mentioned in the service description}
78    \textcolor{keywordflow}{if}(\hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam}->P.PUKCL\_SelfTest.u4CheckNum1 != 0x6E70DDD2)
79       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
80 
81    \textcolor{keywordflow}{if}(\hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam}->P.PUKCL\_SelfTest.u4CheckNum2 != 0x25C8D64F)
82       \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
83 
84    \textcolor{comment}{//Successful initialization}
85    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
86 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}\label{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!pukcc\+Workspace@{pukcc\+Workspace}}
\index{pukcc\+Workspace@{pukcc\+Workspace}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{pukcc\+Workspace()}{pukccWorkspace()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}$\ast$ pukcc\+Workspace (\begin{DoxyParamCaption}\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$$\ast$}]{dest,  }\item[{size\+\_\+t}]{total\+Len }\end{DoxyParamCaption})}



Initialize workspace area. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em dest} & Pointer to the crypto memory \\
\hline
\mbox{\tt in}  & {\em total\+Len} & Desired length of the area, in bytes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the initialized area 
\end{DoxyReturn}


Definition at line 160 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
161 \{
162    \textcolor{keywordtype}{size\_t} i;
163    \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
164 
165    \textcolor{comment}{//Point to the crypto memory}
166    p = *dest;
167 
168    \textcolor{comment}{//Initialize workspace area}
169    \textcolor{keywordflow}{for}(i = 0; i < totalLen; i++)
170    \{
171       p[i] = 0;
172    \}
173 
174    \textcolor{comment}{//Advance data pointer}
175    *dest = p + i;
176 
177    \textcolor{comment}{//Return a pointer to the initialized area}
178    \textcolor{keywordflow}{return} \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
179 \}
\end{DoxyCode}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_a74534ca56f21b582dd584da58982aa27}\label{samd51__crypto__pukcc_8c_a74534ca56f21b582dd584da58982aa27}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!rsadp@{rsadp}}
\index{rsadp@{rsadp}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{rsadp()}{rsadp()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} rsadp (\begin{DoxyParamCaption}\item[{const \hyperlink{structRsaPrivateKey}{Rsa\+Private\+Key} $\ast$}]{key,  }\item[{const \hyperlink{structMpi}{Mpi} $\ast$}]{c,  }\item[{\hyperlink{structMpi}{Mpi} $\ast$}]{m }\end{DoxyParamCaption})}



R\+SA decryption primitive. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em key} & R\+SA private key \\
\hline
\mbox{\tt in}  & {\em c} & Ciphertext representative \\
\hline
\mbox{\tt out}  & {\em m} & Message representative \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 691 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.


\begin{DoxyCode}
692 \{
693    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
694 
695    \textcolor{comment}{//Use the Chinese remainder algorithm?}
696    \textcolor{keywordflow}{if}(key->\hyperlink{structRsaPrivateKey_aaccaccd76db1a21201bf06eb6ecdd8ac}{n}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} && key->\hyperlink{structRsaPrivateKey_a1fc8b1ca097c70244db691916f33f891}{p}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} && key->\hyperlink{structRsaPrivateKey_aefd3ef59482ac00637165b624625fef5}{q}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} &&
697       key->\hyperlink{structRsaPrivateKey_ab101b4e579a4799f12d3acd237e72b34}{dp}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} && key->\hyperlink{structRsaPrivateKey_a9e72909ef8af48ce9a813ba32ba0287d}{dq}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} && key->\hyperlink{structRsaPrivateKey_a3dac28e0d48293032c18c968faadf57c}{qinv}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size})
698    \{
699       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
700       \textcolor{keywordtype}{size\_t} pLen;
701       \textcolor{keywordtype}{size\_t} qLen;
702       \textcolor{keywordtype}{size\_t} dpLen;
703       \textcolor{keywordtype}{size\_t} dqLen;
704       \textcolor{keywordtype}{size\_t} modLen;
705       \textcolor{keywordtype}{size\_t} expLen;
706       \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *pos;
707       \hyperlink{structPukccCrtParams}{PukccCrtParams} params;
708 
709       \textcolor{comment}{//Retrieve the length of the ciphertext, in bytes}
710       n = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(c);
711 
712       \textcolor{comment}{//Retrieve the length of the primes, in bytes}
713       pLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&key->\hyperlink{structRsaPrivateKey_a1fc8b1ca097c70244db691916f33f891}{p});
714       qLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&key->\hyperlink{structRsaPrivateKey_aefd3ef59482ac00637165b624625fef5}{q});
715       modLen = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(pLen, qLen);
716       modLen = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(modLen, 12);
717       modLen = (modLen + 3U) & ~3U;
718 
719       \textcolor{comment}{//Retrieve the length of the reduced exponents, in bytes}
720       dpLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&key->\hyperlink{structRsaPrivateKey_ab101b4e579a4799f12d3acd237e72b34}{dp});
721       dqLen = \hyperlink{mpi_8c_a8599cb7537c854ae3b2442144c7f853b}{mpiGetByteLength}(&key->\hyperlink{structRsaPrivateKey_a9e72909ef8af48ce9a813ba32ba0287d}{dq});
722       expLen = \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(dpLen, dqLen);
723       expLen = (expLen + 3U) & ~3U;
724 
725       \textcolor{comment}{//Check the length of the ciphertext}
726       \textcolor{keywordflow}{if}(n > (2 * modLen))
727          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae5c014519c3ac2540447887ddca1bd28}{ERROR\_INVALID\_LENGTH};
728 
729       \textcolor{comment}{//Acquire exclusive access to the PUKCC accelerator}
730       \hyperlink{os__port__chibios_8c_a58485224df4bfa522246d55b35bbd83a}{osAcquireMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
731 
732       \textcolor{comment}{//Point to the crypto memory}
733       pos = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t} *) \hyperlink{samd51__crypto__pukcc_8h_ad1d30e29d8d30aee1719f2cd4ae239fa}{PUKCC\_CRYPTO\_RAM\_BASE};
734 
735       \textcolor{comment}{//Copy primes}
736       params.\hyperlink{structPukccCrtParams_a6924a47a120a1720f717ef39f7160989}{q} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &key->\hyperlink{structRsaPrivateKey_aefd3ef59482ac00637165b624625fef5}{q}, modLen + 4);
737       params.\hyperlink{structPukccCrtParams_ae5cd519c92bdbf2fb9b7e5e21a45b3f6}{p} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &key->\hyperlink{structRsaPrivateKey_a1fc8b1ca097c70244db691916f33f891}{p}, modLen + 4);
738 
739       \textcolor{comment}{//Copy input number}
740       params.\hyperlink{structPukccCrtParams_a6c5224e7eeb561b0341976d0390ec44d}{x} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, c, 2 * modLen + 16);
741 
742       \textcolor{comment}{//The reduced exponents must be given with a supplemental word on the}
743       \textcolor{comment}{//LSB side (low addresses). This word shall be set to zero}
744       params.\hyperlink{structPukccCrtParams_a13b12b088c048b95c1f5dd13f30e6358}{dq} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4);
745       \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &key->\hyperlink{structRsaPrivateKey_a9e72909ef8af48ce9a813ba32ba0287d}{dq}, expLen);
746       params.\hyperlink{structPukccCrtParams_afe9cb1b2f9c9dc05c783f549775fcb9f}{dp} = \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 4);
747       \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &key->\hyperlink{structRsaPrivateKey_ab101b4e579a4799f12d3acd237e72b34}{dp}, expLen);
748 
749       \textcolor{comment}{//Copy R value}
750       params.\hyperlink{structPukccCrtParams_af36c7ff183f7daaf25eb305381e517f2}{r} = \hyperlink{samd51__crypto__pukcc_8c_a8c27d23fc704a8032fc9e3e71881ec44}{pukccImportMpi}(&pos, &key->\hyperlink{structRsaPrivateKey_a3dac28e0d48293032c18c968faadf57c}{qinv}, modLen + 4);
751       \textcolor{comment}{//Initialize workspace}
752       \hyperlink{samd51__crypto__pukcc_8c_a0824abd34198de6174f4dbabd8cd46c4}{pukccWorkspace}(&pos, 3 * (modLen + 4) + \hyperlink{os__port_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX}(64, 1 * (modLen + 4)) + 8);
753 
754       \textcolor{comment}{//Set CRT service parameters}
755       PUKCL(u2Option) = PUKCL\_EXPMOD\_REGULARRSA | PUKCL\_EXPMOD\_WINDOWSIZE\_1 |
756          PUKCL\_EXPMOD\_EXPINPUKCCRAM;
757       PUKCL\_CRT(u2ModLength) = modLen;
758       PUKCL\_CRT(nu1ModBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccCrtParams_a6924a47a120a1720f717ef39f7160989}{q});
759       PUKCL\_CRT(nu1XBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccCrtParams_a6c5224e7eeb561b0341976d0390ec44d}{x});
760       PUKCL\_CRT(nu1PrecompBase) = \hyperlink{samd51__crypto__pukcc_8h_ae45c245e708d6186181093061d8a25ab}{PUKCC\_FAR\_TO\_NEAR}(params.\hyperlink{structPukccCrtParams_af36c7ff183f7daaf25eb305381e517f2}{r});
761       PUKCL\_CRT(u2ExpLength) = expLen;
762       PUKCL\_CRT(pfu1ExpBase) = params.\hyperlink{structPukccCrtParams_a13b12b088c048b95c1f5dd13f30e6358}{dq};
763       PUKCL\_CRT(u1Blinding) = 0;
764 
765       \textcolor{comment}{//Perform modular exponentiation (with CRT)}
766       vPUKCL\_Process(CRT, \hyperlink{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}{pvPUKCLParam});
767 
768       \textcolor{comment}{//Check status code}
769       \textcolor{keywordflow}{if}(PUKCL(u2Status) == PUKCL\_OK)
770       \{
771          \textcolor{comment}{//Copy resulting integer}
772          error = \hyperlink{mpi_8c_a844d59498f4acce9d69ae55570b521f3}{mpiImport}(m, params.\hyperlink{structPukccCrtParams_a6c5224e7eeb561b0341976d0390ec44d}{x}, 2 * modLen, 
      \hyperlink{mpi_8h_a5fe4159c7c390c604067e854b41d337fa637c0a6e803a47db52875c6818674c60}{MPI\_FORMAT\_LITTLE\_ENDIAN});
773       \}
774       \textcolor{keywordflow}{else}
775       \{
776          \textcolor{comment}{//Report an error}
777          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cae9be6449970fca5714ab9957b16562a5}{ERROR\_FAILURE};
778       \}
779 
780       \textcolor{comment}{//Release exclusive access to the PUKCC accelerator}
781       \hyperlink{os__port__chibios_8c_a8e10e5b2c6d3877b5ba60e375ac45d79}{osReleaseMutex}(&\hyperlink{samd51__crypto_8c_a497456a4c4a5377233f8a405471f0930}{samd51CryptoMutex});
782    \}
783    \textcolor{comment}{//Use modular exponentiation?}
784    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(key->\hyperlink{structRsaPrivateKey_aaccaccd76db1a21201bf06eb6ecdd8ac}{n}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size} && key->\hyperlink{structRsaPrivateKey_aea064a2875da9d2a44c7e7c02e157728}{d}.\hyperlink{structMpi_ab7c94872ccb0b7a223c26fd3c43b0c4d}{size})
785    \{
786       \textcolor{comment}{//Perform modular exponentiation (without CRT)}
787       error = \hyperlink{samd51__crypto__pukcc_8c_ae18482447f7293c8bb44899ce236b72e}{mpiExpMod}(m, c, &key->\hyperlink{structRsaPrivateKey_aea064a2875da9d2a44c7e7c02e157728}{d}, &key->\hyperlink{structRsaPrivateKey_aaccaccd76db1a21201bf06eb6ecdd8ac}{n});
788    \}
789    \textcolor{comment}{//Invalid parameters?}
790    \textcolor{keywordflow}{else}
791    \{
792       \textcolor{comment}{//Report an error}
793       error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689caeae4b12e06d727d085f75f79a820f2e8}{ERROR\_INVALID\_PARAMETER};
794    \}
795 
796    \textcolor{comment}{//Return status code}
797    \textcolor{keywordflow}{return} error;
798 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{samd51__crypto__pukcc_8c_adc1948c03b6b4b2c8c88e286ace6efe4}\label{samd51__crypto__pukcc_8c_adc1948c03b6b4b2c8c88e286ace6efe4}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!P\+U\+K\+C\+L\+Param@{P\+U\+K\+C\+L\+Param}}
\index{P\+U\+K\+C\+L\+Param@{P\+U\+K\+C\+L\+Param}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{P\+U\+K\+C\+L\+Param}{PUKCLParam}}
{\footnotesize\ttfamily P\+U\+K\+C\+L\+\_\+\+P\+A\+R\+AM P\+U\+K\+C\+L\+Param}



Definition at line 49 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.

\mbox{\Hypertarget{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}\label{samd51__crypto__pukcc_8c_ab31506a251b636e98d84c30012b7d4fe}} 
\index{samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}!pv\+P\+U\+K\+C\+L\+Param@{pv\+P\+U\+K\+C\+L\+Param}}
\index{pv\+P\+U\+K\+C\+L\+Param@{pv\+P\+U\+K\+C\+L\+Param}!samd51\+\_\+crypto\+\_\+pukcc.\+c@{samd51\+\_\+crypto\+\_\+pukcc.\+c}}
\subsubsection{\texorpdfstring{pv\+P\+U\+K\+C\+L\+Param}{pvPUKCLParam}}
{\footnotesize\ttfamily P\+P\+U\+K\+C\+L\+\_\+\+P\+A\+R\+AM pv\+P\+U\+K\+C\+L\+Param}



Definition at line 48 of file samd51\+\_\+crypto\+\_\+pukcc.\+c.

