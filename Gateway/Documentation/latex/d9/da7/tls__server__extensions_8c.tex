\hypertarget{tls__server__extensions_8c}{}\section{cyclone\+\_\+ssl/tls\+\_\+server\+\_\+extensions.c File Reference}
\label{tls__server__extensions_8c}\index{cyclone\+\_\+ssl/tls\+\_\+server\+\_\+extensions.\+c@{cyclone\+\_\+ssl/tls\+\_\+server\+\_\+extensions.\+c}}


Formatting and parsing of extensions (T\+LS server)  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}tls.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+cipher\+\_\+suites.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+server\+\_\+extensions.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+extensions.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tls\+\_\+misc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tls__server__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_abe85c18235cfd55be223b44c6c30d464}{tls\+Format\+Server\+Sni\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format S\+NI extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a83a033674e9efbf357891a543c3f4ed3}{tls\+Format\+Server\+Max\+Frag\+Len\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Max\+Fragment\+Length extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_ae228e4be4faa6572a4e6506cab404887}{tls\+Format\+Server\+Record\+Size\+Limit\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Record\+Size\+Limit extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_aa856298d8714aca4f310519e76694417}{tls\+Format\+Server\+Ec\+Point\+Formats\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Ec\+Point\+Formats extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_ae9f0a3949fe6785f04c1b7fe18fdc607}{tls\+Format\+Server\+Alpn\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format A\+L\+PN extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a5eb2cc5e804ae91309a4a2459e171463}{tls\+Format\+Client\+Cert\+Type\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Client\+Cert\+Type extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a4b410a15ac55feeba5986c6a9e15b3a6}{tls\+Format\+Server\+Cert\+Type\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Server\+Cert\+Type extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a02581afedcbbb2656e478ba98700a679}{tls\+Format\+Server\+Ems\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Extended\+Master\+Secret extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_ae3a2681db3e04378ed7cedff914875d3}{tls\+Format\+Server\+Renego\+Info\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$\hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p}, size\+\_\+t $\ast$written)
\begin{DoxyCompactList}\small\item\em Format Renegotiation\+Info extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a5f9b37e02ecb77f4b6285669ed9a90b4}{tls\+Parse\+Client\+Supported\+Versions\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{Tls\+Supported\+Version\+List} $\ast$supported\+Version\+List)
\begin{DoxyCompactList}\small\item\em Parse Supported\+Versions extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_ab34de7891d354995208e858a53a14b57}{tls\+Parse\+Client\+Sni\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{Tls\+Server\+Name\+List} $\ast$server\+Name\+List)
\begin{DoxyCompactList}\small\item\em Parse S\+NI extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a9cc022e4c7f789f6c9a82d1999e77c6a}{tls\+Parse\+Client\+Max\+Frag\+Len\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$max\+Frag\+Len)
\begin{DoxyCompactList}\small\item\em Parse Max\+Fragment\+Length extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a4525618ed7ee2f566b94acf4ae6b15af}{tls\+Parse\+Client\+Record\+Size\+Limit\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$record\+Size\+Limit)
\begin{DoxyCompactList}\small\item\em Parse Record\+Size\+Limit extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_ae22d1c58492882319be6973f889a2244}{tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{Tls\+Ec\+Point\+Format\+List} $\ast$ec\+Point\+Format\+List)
\begin{DoxyCompactList}\small\item\em Parse Ec\+Point\+Formats extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a951a27c0cca43690037251630f6511c2}{tls\+Parse\+Client\+Alpn\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{Tls\+Protocol\+Name\+List} $\ast$protocol\+Name\+List)
\begin{DoxyCompactList}\small\item\em Parse A\+L\+PN extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a8a2885ab0aadaad5b643aaccc0cc5949}{tls\+Parse\+Client\+Cert\+Type\+List\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{Tls\+Cert\+Type\+List} $\ast$client\+Cert\+Type\+List)
\begin{DoxyCompactList}\small\item\em Parse Client\+Cert\+Type extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_aa5440eb1a18caf8461d6418167d79c5c}{tls\+Parse\+Server\+Cert\+Type\+List\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{Tls\+Cert\+Type\+List} $\ast$server\+Cert\+Type\+List)
\begin{DoxyCompactList}\small\item\em Parse Server\+Cert\+Type extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_a1964c308b6b9b35f1c6fc81e59ba2a83}{tls\+Parse\+Client\+Ems\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$extended\+Master\+Secret)
\begin{DoxyCompactList}\small\item\em Parse Extended\+Master\+Secret extension. \end{DoxyCompactList}\item 
\hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} \hyperlink{tls__server__extensions_8c_adddc100a1d10d444b0735b69491619a2}{tls\+Parse\+Client\+Renego\+Info\+Extension} (\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$context, const \hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{Tls\+Renego\+Info} $\ast$renego\+Info)
\begin{DoxyCompactList}\small\item\em Parse Renegotiation\+Info extension. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Formatting and parsing of extensions (T\+LS server) 

\hypertarget{pic32mz__ef__curiosity_8h_License}{}\subsection{License}\label{pic32mz__ef__curiosity_8h_License}
S\+P\+D\+X-\/\+License-\/\+Identifier\+: G\+P\+L-\/2.\+0-\/or-\/later

Copyright (C) 2010-\/2019 Oryx Embedded S\+A\+RL. All rights reserved.

This file is part of Cyclone\+S\+SL Open.

This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA.

\begin{DoxyAuthor}{Author}
Oryx Embedded S\+A\+RL (www.\+oryx-\/embedded.\+com) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+9.\+6 
\end{DoxyVersion}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{tls__server__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}\label{tls__server__extensions_8c_afcdf5e66fd927a7f4cc64295acd20407}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}
\index{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL@{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}{TRACE\_LEVEL}}
{\footnotesize\ttfamily \#define T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL~\hyperlink{tls__config_8h_afee42a623033dac888291d1993985206}{T\+L\+S\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}}



Definition at line 32 of file tls\+\_\+server\+\_\+extensions.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{tls__server__extensions_8c_a5eb2cc5e804ae91309a4a2459e171463}\label{tls__server__extensions_8c_a5eb2cc5e804ae91309a4a2459e171463}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Client\+Cert\+Type\+Extension@{tls\+Format\+Client\+Cert\+Type\+Extension}}
\index{tls\+Format\+Client\+Cert\+Type\+Extension@{tls\+Format\+Client\+Cert\+Type\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Client\+Cert\+Type\+Extension()}{tlsFormatClientCertTypeExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Client\+Cert\+Type\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Client\+Cert\+Type extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Client\+Cert\+Type extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 376 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
378 \{
379    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
380 
381 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
382    \textcolor{comment}{//An extension type must not appear in the ServerHello unless the same}
383    \textcolor{comment}{//extension type appeared in the corresponding ClientHello}
384    \textcolor{keywordflow}{if}(context->clientCertTypeExtReceived)
385    \{
386       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
387 
388       \textcolor{comment}{//Add the ClientCertType extension}
389       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
390       \textcolor{comment}{//Type of the extension}
391       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a643926386cd2016b4832014c859b6e75}{TLS\_EXT\_CLIENT\_CERT\_TYPE});
392 
393       \textcolor{comment}{//The ClientCertType extension in the ServerHello indicates the type}
394       \textcolor{comment}{//of certificates the client is requested to provide in a subsequent}
395       \textcolor{comment}{//certificate payload}
396       extension->value[0] = context->peerCertFormat;
397 
398       \textcolor{comment}{//The extension data field contains a single byte}
399       n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t});
400       \textcolor{comment}{//Fix the length of the extension}
401       extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
402 
403       \textcolor{comment}{//Compute the length, in bytes, of the ClientCertType extension}
404       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
405    \}
406 \textcolor{preprocessor}{#endif}
407 
408    \textcolor{comment}{//Total number of bytes that have been written}
409    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
410 
411    \textcolor{comment}{//Successful processing}
412    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
413 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_ae9f0a3949fe6785f04c1b7fe18fdc607}\label{tls__server__extensions_8c_ae9f0a3949fe6785f04c1b7fe18fdc607}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Alpn\+Extension@{tls\+Format\+Server\+Alpn\+Extension}}
\index{tls\+Format\+Server\+Alpn\+Extension@{tls\+Format\+Server\+Alpn\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Alpn\+Extension()}{tlsFormatServerAlpnExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Alpn\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format A\+L\+PN extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the A\+L\+PN extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 309 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
311 \{
312    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
313 
314 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
315    \textcolor{comment}{//The ALPN extension may be returned to the client within the extended}
316    \textcolor{comment}{//ServerHello message}
317    \textcolor{keywordflow}{if}(context->selectedProtocol != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
318    \{
319       \textcolor{comment}{//Empty strings must not be included}
320       \textcolor{keywordflow}{if}(context->selectedProtocol[0] != \textcolor{charliteral}{'\(\backslash\)0'})
321       \{
322          \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
323          \hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName} *protocolName;
324          \hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList} *protocolNameList;
325 
326          \textcolor{comment}{//Add ALPN (Application-Layer Protocol Negotiation) extension}
327          extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
328          \textcolor{comment}{//Type of the extension}
329          extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7acd549b6d27b86af438c5da5b481277a7}{TLS\_EXT\_ALPN});
330 
331          \textcolor{comment}{//Point to the list of protocol names}
332          protocolNameList = (\hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList} *) extension->value;
333          \textcolor{comment}{//The list must contain exactly one protocol name}
334          protocolName = (\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName} *) protocolNameList->value;
335 
336          \textcolor{comment}{//Retrieve the length of the protocol name}
337          n = strlen(context->selectedProtocol);
338 
339          \textcolor{comment}{//Fill in the length field}
340          protocolName->length = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) n;
341          \textcolor{comment}{//Copy protocol name}
342          memcpy(protocolName->value, context->selectedProtocol, n);
343 
344          \textcolor{comment}{//Adjust the length of the list}
345          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName});
346          \textcolor{comment}{//Fix the length of the list}
347          protocolNameList->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
348 
349          \textcolor{comment}{//Consider the 2-byte length field that precedes the list}
350          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{TlsProtocolNameList});
351          \textcolor{comment}{//Fix the length of the extension}
352          extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
353 
354          \textcolor{comment}{//Compute the length, in bytes, of the ALPN extension}
355          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
356       \}
357    \}
358 \textcolor{preprocessor}{#endif}
359 
360    \textcolor{comment}{//Total number of bytes that have been written}
361    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
362 
363    \textcolor{comment}{//Successful processing}
364    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
365 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a4b410a15ac55feeba5986c6a9e15b3a6}\label{tls__server__extensions_8c_a4b410a15ac55feeba5986c6a9e15b3a6}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Cert\+Type\+Extension@{tls\+Format\+Server\+Cert\+Type\+Extension}}
\index{tls\+Format\+Server\+Cert\+Type\+Extension@{tls\+Format\+Server\+Cert\+Type\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Cert\+Type\+Extension()}{tlsFormatServerCertTypeExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Cert\+Type\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Server\+Cert\+Type extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Server\+Cert\+Type extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 424 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
426 \{
427    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
428 
429 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
430    \textcolor{comment}{//An extension type must not appear in the ServerHello unless the same}
431    \textcolor{comment}{//extension type appeared in the corresponding ClientHello}
432    \textcolor{keywordflow}{if}(context->serverCertTypeExtReceived)
433    \{
434       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
435 
436       \textcolor{comment}{//Add the ServerCertType extension}
437       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
438       \textcolor{comment}{//Type of the extension}
439       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a5be7581b64f1ed6051200823629ca71b}{TLS\_EXT\_SERVER\_CERT\_TYPE});
440 
441       \textcolor{comment}{//With the ServerCertType extension in the ServerHello, the TLS server}
442       \textcolor{comment}{//indicates the certificate type carried in the certificate payload}
443       extension->value[0] = context->certFormat;
444 
445       \textcolor{comment}{//The extension data field contains a single byte}
446       n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t});
447       \textcolor{comment}{//Fix the length of the extension}
448       extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
449 
450       \textcolor{comment}{//Compute the length, in bytes, of the ServerCertType extension}
451       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
452    \}
453 \textcolor{preprocessor}{#endif}
454 
455    \textcolor{comment}{//Total number of bytes that have been written}
456    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
457 
458    \textcolor{comment}{//Successful processing}
459    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
460 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_aa856298d8714aca4f310519e76694417}\label{tls__server__extensions_8c_aa856298d8714aca4f310519e76694417}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Ec\+Point\+Formats\+Extension@{tls\+Format\+Server\+Ec\+Point\+Formats\+Extension}}
\index{tls\+Format\+Server\+Ec\+Point\+Formats\+Extension@{tls\+Format\+Server\+Ec\+Point\+Formats\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Ec\+Point\+Formats\+Extension()}{tlsFormatServerEcPointFormatsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Ec\+Point\+Formats\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Ec\+Point\+Formats extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Ec\+Point\+Formats extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 236 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
238 \{
239    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
240 
241 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
242    \textcolor{comment}{//TLS 1.3 has removed point format negotiation in favor of a single point}
243    \textcolor{comment}{//format for each curve (refer to RFC 8446, section 1.2)}
244    \textcolor{keywordflow}{if}(context->version <= \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2})
245    \{
246 \textcolor{preprocessor}{#if (TLS\_ECDH\_ANON\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_RSA\_KE\_SUPPORT == ENABLED || \(\backslash\)}
247 \textcolor{preprocessor}{   TLS\_ECDHE\_ECDSA\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_PSK\_KE\_SUPPORT == ENABLED)}
248       \textcolor{comment}{//An extension type must not appear in the ServerHello unless the same}
249       \textcolor{comment}{//extension type appeared in the corresponding ClientHello}
250       \textcolor{keywordflow}{if}(context->ecPointFormatsExtReceived)
251       \{
252          \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dhcpv6__common_8h_a679cc9d376a65e69d88ec3496eea7122}{identifier};
253 
254          \textcolor{comment}{//Retrieve the selected cipher suite}
255          identifier = context->cipherSuite.identifier;
256 
257          \textcolor{comment}{//A server that selects an ECC cipher suite in response to a ClientHello}
258          \textcolor{comment}{//message including an EcPointFormats extension appends this extension}
259          \textcolor{comment}{//to its ServerHello message}
260          \textcolor{keywordflow}{if}((\hyperlink{tls__cipher__suites_8c_af98b416f01756024d9e4043cbff1fc6f}{tlsGetCipherSuiteType}(identifier) & 
      \hyperlink{tls__cipher__suites_8h_aa19934da0d53bda533624f13ba98303ba876aff9a6f283b9cc44eeb7c668cad43}{TLS\_CIPHER\_SUITE\_TYPE\_ECC}) != 0)
261          \{
262             \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
263             \hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList} *ecPointFormatList;
264 
265             \textcolor{comment}{//Add the EcPointFormats extension}
266             extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
267             \textcolor{comment}{//Type of the extension}
268             extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a9a3f8f880b4549fc336d1938d3ac54c2}{TLS\_EXT\_EC\_POINT\_FORMATS});
269 
270             \textcolor{comment}{//Point to the list of supported EC point formats}
271             ecPointFormatList = (\hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList} *) extension->value;
272             \textcolor{comment}{//Items in the list are ordered according to server's preferences}
273             n = 0;
274 
275             \textcolor{comment}{//The server can parse only the uncompressed point format...}
276             ecPointFormatList->value[n++] = \hyperlink{tls_8h_a45b8a57398a9bd960e3f3186a7d3cd38a149b16635a32aa8ed87166485790f152}{TLS\_EC\_POINT\_FORMAT\_UNCOMPRESSED}
      ;
277             \textcolor{comment}{//Fix the length of the list}
278             ecPointFormatList->length = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
279 
280             \textcolor{comment}{//Consider the length field that precedes the list}
281             n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{TlsEcPointFormatList});
282             \textcolor{comment}{//Fix the length of the extension}
283             extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
284 
285             \textcolor{comment}{//Compute the length, in bytes, of the EcPointFormats extension}
286             n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
287          \}
288       \}
289 \textcolor{preprocessor}{#endif}
290    \}
291 \textcolor{preprocessor}{#endif}
292 
293    \textcolor{comment}{//Total number of bytes that have been written}
294    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
295 
296    \textcolor{comment}{//Successful processing}
297    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
298 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a02581afedcbbb2656e478ba98700a679}\label{tls__server__extensions_8c_a02581afedcbbb2656e478ba98700a679}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Ems\+Extension@{tls\+Format\+Server\+Ems\+Extension}}
\index{tls\+Format\+Server\+Ems\+Extension@{tls\+Format\+Server\+Ems\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Ems\+Extension()}{tlsFormatServerEmsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Ems\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Extended\+Master\+Secret extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Extended\+Master\+Secret extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 471 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
473 \{
474    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
475 
476 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
477    \textcolor{comment}{//If the server receives a ClientHello without the ExtendedMasterSecret}
478    \textcolor{comment}{//extension, then it must not include the extension in the ServerHello}
479    \textcolor{keywordflow}{if}(context->extendedMasterSecretExtReceived)
480    \{
481       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
482 
483       \textcolor{comment}{//Add the ExtendedMasterSecret extension}
484       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
485       \textcolor{comment}{//Type of the extension}
486       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7af66b97b46e6480db2e6b87ab700de152}{TLS\_EXT\_EXTENDED\_MASTER\_SECRET});
487 
488       \textcolor{comment}{//The extension data field of this extension is empty}
489       extension->length = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(0);
490 
491       \textcolor{comment}{//Compute the length, in bytes, of the ExtendedMasterSecret extension}
492       n = \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
493    \}
494 \textcolor{preprocessor}{#endif}
495 
496    \textcolor{comment}{//Total number of bytes that have been written}
497    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
498 
499    \textcolor{comment}{//Successful processing}
500    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
501 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a83a033674e9efbf357891a543c3f4ed3}\label{tls__server__extensions_8c_a83a033674e9efbf357891a543c3f4ed3}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Max\+Frag\+Len\+Extension@{tls\+Format\+Server\+Max\+Frag\+Len\+Extension}}
\index{tls\+Format\+Server\+Max\+Frag\+Len\+Extension@{tls\+Format\+Server\+Max\+Frag\+Len\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Max\+Frag\+Len\+Extension()}{tlsFormatServerMaxFragLenExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Max\+Frag\+Len\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Max\+Fragment\+Length extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Max\+Fragment\+Length extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 109 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
111 \{
112    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
113 
114 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
115    \textcolor{comment}{//An extension type must not appear in the ServerHello unless the same}
116    \textcolor{comment}{//extension type appeared in the corresponding ClientHello}
117    \textcolor{keywordflow}{if}(context->maxFragLenExtReceived)
118    \{
119       \textcolor{comment}{//Servers that receive an ClientHello containing a MaxFragmentLength}
120       \textcolor{comment}{//extension may accept the requested maximum fragment length by including}
121       \textcolor{comment}{//an extension of type MaxFragmentLength in the ServerHello}
122       \textcolor{keywordflow}{if}(context->maxFragLen == 512 || context->maxFragLen == 1024 ||
123          context->maxFragLen == 2048 || context->maxFragLen == 4096)
124       \{
125          \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
126 
127          \textcolor{comment}{//Add the MaxFragmentLength extension}
128          extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
129          \textcolor{comment}{//Type of the extension}
130          extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a4a4ee70b35190ddeacec1a6d68286dab}{TLS\_EXT\_MAX\_FRAGMENT\_LENGTH});
131 
132          \textcolor{comment}{//The data field of this extension shall contain a MaxFragmentLength}
133          \textcolor{comment}{//whose value is the same as the requested maximum fragment length}
134          \textcolor{keywordflow}{switch}(context->maxFragLen)
135          \{
136          \textcolor{keywordflow}{case} 512:
137             extension->value[0] = \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63a4c1a1521181c432d51d61dc4f295d027}{TLS\_MAX\_FRAGMENT\_LENGTH\_512};
138             \textcolor{keywordflow}{break};
139          \textcolor{keywordflow}{case} 1024:
140             extension->value[0] = \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63aeee4f23ba8be12a29158044f629a04cf}{TLS\_MAX\_FRAGMENT\_LENGTH\_1024};
141             \textcolor{keywordflow}{break};
142          \textcolor{keywordflow}{case} 2048:
143             extension->value[0] = \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63ad6ba9b8c7be1f57b904f4e1304295fad}{TLS\_MAX\_FRAGMENT\_LENGTH\_2048};
144             \textcolor{keywordflow}{break};
145          \textcolor{keywordflow}{default}:
146             extension->value[0] = \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63ac32ed0270e2b99db48fe7835eb1525bc}{TLS\_MAX\_FRAGMENT\_LENGTH\_4096};
147             \textcolor{keywordflow}{break};
148          \}
149 
150          \textcolor{comment}{//The extension data field contains a single byte}
151          n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t});
152          \textcolor{comment}{//Fix the length of the extension}
153          extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
154 
155          \textcolor{comment}{//Compute the length, in bytes, of the MaxFragmentLength extension}
156          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
157       \}
158    \}
159 \textcolor{preprocessor}{#endif}
160 
161    \textcolor{comment}{//Total number of bytes that have been written}
162    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
163 
164    \textcolor{comment}{//Successful processing}
165    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
166 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_ae228e4be4faa6572a4e6506cab404887}\label{tls__server__extensions_8c_ae228e4be4faa6572a4e6506cab404887}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Record\+Size\+Limit\+Extension@{tls\+Format\+Server\+Record\+Size\+Limit\+Extension}}
\index{tls\+Format\+Server\+Record\+Size\+Limit\+Extension@{tls\+Format\+Server\+Record\+Size\+Limit\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Record\+Size\+Limit\+Extension()}{tlsFormatServerRecordSizeLimitExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Record\+Size\+Limit\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Record\+Size\+Limit extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Record\+Size\+Limit extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 177 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
179 \{
180    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
181 
182 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
183    \textcolor{comment}{//An extension type must not appear in the ServerHello unless the same}
184    \textcolor{comment}{//extension type appeared in the corresponding ClientHello}
185    \textcolor{keywordflow}{if}(context->recordSizeLimitExtReceived)
186    \{
187       \textcolor{keywordtype}{size\_t} recordSizeLimit;
188       \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
189 
190       \textcolor{comment}{//Add the RecordSizeLimit extension}
191       extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
192       \textcolor{comment}{//Type of the extension}
193       extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7aa248475139394e15aa9a3fab1feabc83}{TLS\_EXT\_RECORD\_SIZE\_LIMIT});
194 
195       \textcolor{comment}{//An endpoint must not send a value higher than the protocol-defined}
196       \textcolor{comment}{//maximum record size (refer to RFC 8449, section 4)}
197       recordSizeLimit = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(context->rxBufferMaxLen, \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH});
198 
199       \textcolor{comment}{//TLS 1.3 currently selected?}
200       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
201       \{
202          \textcolor{comment}{//The value includes the content type and padding added in TLS 1.3}
203          recordSizeLimit++;
204       \}
205 
206       \textcolor{comment}{//The value of RecordSizeLimit is the maximum size of record in octets}
207       \textcolor{comment}{//that the endpoint is willing to receive}
208       \hyperlink{cpu__endian_8h_a8e657bcdf3842380d2d0006859029240}{STORE16BE}(recordSizeLimit, extension->value);
209 
210       \textcolor{comment}{//The extension data field contains a 16-bit unsigned integer}
211       n = \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t});
212       \textcolor{comment}{//Fix the length of the extension}
213       extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
214 
215       \textcolor{comment}{//Compute the length, in bytes, of the RecordSizeLimit extension}
216       n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
217    \}
218 \textcolor{preprocessor}{#endif}
219 
220    \textcolor{comment}{//Total number of bytes that have been written}
221    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
222 
223    \textcolor{comment}{//Successful processing}
224    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
225 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_ae3a2681db3e04378ed7cedff914875d3}\label{tls__server__extensions_8c_ae3a2681db3e04378ed7cedff914875d3}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Renego\+Info\+Extension@{tls\+Format\+Server\+Renego\+Info\+Extension}}
\index{tls\+Format\+Server\+Renego\+Info\+Extension@{tls\+Format\+Server\+Renego\+Info\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Renego\+Info\+Extension()}{tlsFormatServerRenegoInfoExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Renego\+Info\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format Renegotiation\+Info extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Renegotiation\+Info extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 512 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
514 \{
515    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
516 
517 \textcolor{preprocessor}{#if (TLS\_SECURE\_RENEGOTIATION\_SUPPORT == ENABLED)}
518    \textcolor{comment}{//Check whether secure renegotiation is enabled}
519    \textcolor{keywordflow}{if}(context->secureRenegoEnabled)
520    \{
521       \textcolor{comment}{//During secure renegotiation, the server must include a renegotiation\_info}
522       \textcolor{comment}{//extension containing the saved client\_verify\_data and server\_verify\_data}
523       \textcolor{keywordflow}{if}(context->secureRenegoFlag)
524       \{
525          \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
526          \hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo} *renegoInfo;
527 
528          \textcolor{comment}{//Determine the length of the renegotiated\_connection field}
529          n = context->clientVerifyDataLen + context->serverVerifyDataLen;
530 
531          \textcolor{comment}{//Add the RenegotiationInfo extension}
532          extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
533          \textcolor{comment}{//Type of the extension}
534          extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7a10b93b38aef9aea795816607063e5d98}{TLS\_EXT\_RENEGOTIATION\_INFO});
535 
536          \textcolor{comment}{//Point to the renegotiated\_connection field}
537          renegoInfo = (\hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo} *) extension->value;
538          \textcolor{comment}{//Set the length of the verify data}
539          renegoInfo->length = (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}) \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
540 
541          \textcolor{comment}{//Copy the saved client\_verify\_data}
542          memcpy(renegoInfo->value, context->clientVerifyData,
543             context->clientVerifyDataLen);
544 
545          \textcolor{comment}{//Copy the saved client\_verify\_data}
546          memcpy(renegoInfo->value + context->clientVerifyDataLen,
547             context->serverVerifyData, context->serverVerifyDataLen);
548 
549          \textcolor{comment}{//Consider the length field that precedes the renegotiated\_connection}
550          \textcolor{comment}{//field}
551          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{TlsRenegoInfo});
552          \textcolor{comment}{//Fix the length of the extension}
553          extension->length = \hyperlink{cpu__endian_8h_a800cdbf435a85a9b3ad4f0edc518472a}{htons}(n);
554 
555          \textcolor{comment}{//Compute the length, in bytes, of the RenegotiationInfo extension}
556          n += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
557       \}
558    \}
559 \textcolor{preprocessor}{#endif}
560 
561    \textcolor{comment}{//Total number of bytes that have been written}
562    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
563 
564    \textcolor{comment}{//Successful processing}
565    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
566 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_abe85c18235cfd55be223b44c6c30d464}\label{tls__server__extensions_8c_abe85c18235cfd55be223b44c6c30d464}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Format\+Server\+Sni\+Extension@{tls\+Format\+Server\+Sni\+Extension}}
\index{tls\+Format\+Server\+Sni\+Extension@{tls\+Format\+Server\+Sni\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Format\+Server\+Sni\+Extension()}{tlsFormatServerSniExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Format\+Server\+Sni\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{p,  }\item[{size\+\_\+t $\ast$}]{written }\end{DoxyParamCaption})}



Format S\+NI extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em p} & Output stream where to write the Server\+Name extension \\
\hline
\mbox{\tt out}  & {\em written} & Total number of bytes that have been written \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 55 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
57 \{
58    \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n} = 0;
59 
60 \textcolor{preprocessor}{#if (TLS\_SNI\_SUPPORT == ENABLED)}
61    \textcolor{comment}{//A server that receives a ClientHello containing the SNI extension may use}
62    \textcolor{comment}{//the information contained in the extension to guide its selection of an}
63    \textcolor{comment}{//appropriate certificate to return to the client. In this event, the server}
64    \textcolor{comment}{//shall include an extension of type SNI in the ServerHello}
65    \textcolor{keywordflow}{if}(context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
66    \{
67       \textcolor{comment}{//Full handshake?}
68       \textcolor{keywordflow}{if}(!context->resume)
69       \{
70          \hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *extension;
71 
72          \textcolor{comment}{//Add SNI (Server Name Indication) extension}
73          extension = (\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension} *) \hyperlink{ndp_8h_a6519522ad9a6f45e7a8d25d31392a977}{p};
74          \textcolor{comment}{//Type of the extension}
75          extension->type = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(\hyperlink{tls_8h_a8cfe31c9efd27b98a98e37f2dd1278c7ad7a6fff7cdad82f0dd2601d0f3d0cd27}{TLS\_EXT\_SERVER\_NAME});
76 
77          \textcolor{comment}{//The extension data field of this extension shall be empty (refer to}
78          \textcolor{comment}{//RFC 6066, section 3)}
79          extension->length = \hyperlink{cpu__endian_8h_a15540dbaeee98b6df80805f92e2f6759}{HTONS}(0);
80 
81          \textcolor{comment}{//Compute the length, in bytes, of the ServerName extension}
82          n = \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_adc894469d534a49c4295cf3a1551a1f6}{TlsExtension});
83       \}
84       \textcolor{keywordflow}{else}
85       \{
86          \textcolor{comment}{//When resuming a session, the server must not include a ServerName}
87          \textcolor{comment}{//extension in the ServerHello (refer to RFC 6066, section 3)}
88          n = 0;
89       \}
90    \}
91 \textcolor{preprocessor}{#endif}
92 
93    \textcolor{comment}{//Total number of bytes that have been written}
94    *written = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
95 
96    \textcolor{comment}{//Successful processing}
97    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
98 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a951a27c0cca43690037251630f6511c2}\label{tls__server__extensions_8c_a951a27c0cca43690037251630f6511c2}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Alpn\+Extension@{tls\+Parse\+Client\+Alpn\+Extension}}
\index{tls\+Parse\+Client\+Alpn\+Extension@{tls\+Parse\+Client\+Alpn\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Alpn\+Extension()}{tlsParseClientAlpnExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Alpn\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a437df336a6795a38ec9bcfb7c2ab4b2f}{Tls\+Protocol\+Name\+List} $\ast$}]{protocol\+Name\+List }\end{DoxyParamCaption})}



Parse A\+L\+PN extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em protocol\+Name\+List} & Pointer to the A\+L\+PN extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 929 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
931 \{
932 \textcolor{preprocessor}{#if (TLS\_ALPN\_SUPPORT == ENABLED)}
933    \textcolor{comment}{//ALPN extension found?}
934    \textcolor{keywordflow}{if}(protocolNameList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
935    \{
936       \textcolor{keywordtype}{size\_t} i;
937       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
938       \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
939       \textcolor{keyword}{const} \hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName} *protocolName;
940 
941       \textcolor{comment}{//When session resumption is used, the previous contents of this}
942       \textcolor{comment}{//extension are irrelevant}
943       \textcolor{keywordflow}{if}(context->selectedProtocol != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
944       \{
945          \textcolor{comment}{//Release memory}
946          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->selectedProtocol);
947          context->selectedProtocol = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
948       \}
949 
950       \textcolor{comment}{//Retrieve the length of the list}
951       length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(protocolNameList->length);
952 
953       \textcolor{comment}{//The list must not be be empty}
954       \textcolor{keywordflow}{if}(length == 0)
955          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
956 
957       \textcolor{comment}{//Loop through the list of protocols advertised by the client}
958       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName}) + n)
959       \{
960          \textcolor{comment}{//Point to the current protocol}
961          protocolName = (\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName} *) (protocolNameList->value + i);
962 
963          \textcolor{comment}{//Malformed extension?}
964          \textcolor{keywordflow}{if}(length < (i + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName})))
965             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
966          \textcolor{keywordflow}{if}(length < (i + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_ac7efedb92628fa0d6c715e009381a8c0}{TlsProtocolName}) + protocolName->length))
967             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
968 
969          \textcolor{comment}{//Retrieve the length of the protocol name}
970          n = protocolName->length;
971 
972          \textcolor{comment}{//Empty strings must not be included in the list}
973          \textcolor{keywordflow}{if}(n == 0)
974             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
975 
976          \textcolor{comment}{//Check whether the protocol is supported by the server}
977          \textcolor{keywordflow}{if}(\hyperlink{tls__extensions_8c_a5b3ac44fd8575310d00ab10cbbd6dfdd}{tlsIsAlpnProtocolSupported}(context, protocolName->value, n))
978          \{
979             \textcolor{comment}{//Select the current protocol}
980             \textcolor{keywordflow}{if}(context->selectedProtocol == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
981             \{
982                \textcolor{comment}{//Allocate a memory block to hold the protocol name}
983                context->selectedProtocol = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(n + 1);
984                \textcolor{comment}{//Failed to allocate memory?}
985                \textcolor{keywordflow}{if}(context->selectedProtocol == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
986                   \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
987 
988                \textcolor{comment}{//Save protocol name}
989                memcpy(context->selectedProtocol, protocolName->value, n);
990                \textcolor{comment}{//Properly terminate the string with a NULL character}
991                context->selectedProtocol[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = \textcolor{charliteral}{'\(\backslash\)0'};
992             \}
993          \}
994       \}
995 
996       \textcolor{comment}{//ALPN protocol selection failed?}
997       \textcolor{keywordflow}{if}(context->protocolList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && context->selectedProtocol == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
998       \{
999          \textcolor{comment}{//Report an error if unknown ALPN protocols are disallowed}
1000          \textcolor{keywordflow}{if}(!context->unknownProtocolsAllowed)
1001          \{
1002             \textcolor{comment}{//In the event that the server supports no protocols that the}
1003             \textcolor{comment}{//client advertises, then the server shall respond with a fatal}
1004             \textcolor{comment}{//no\_application\_protocol alert}
1005             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabccb26e28d44e4c860d43cb6bd9dcc6d}{ERROR\_NO\_APPLICATION\_PROTOCOL};
1006          \}
1007       \}
1008    \}
1009 \textcolor{preprocessor}{#endif}
1010 
1011    \textcolor{comment}{//Successful processing}
1012    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1013 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a8a2885ab0aadaad5b643aaccc0cc5949}\label{tls__server__extensions_8c_a8a2885ab0aadaad5b643aaccc0cc5949}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Cert\+Type\+List\+Extension@{tls\+Parse\+Client\+Cert\+Type\+List\+Extension}}
\index{tls\+Parse\+Client\+Cert\+Type\+List\+Extension@{tls\+Parse\+Client\+Cert\+Type\+List\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Cert\+Type\+List\+Extension()}{tlsParseClientCertTypeListExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Cert\+Type\+List\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{Tls\+Cert\+Type\+List} $\ast$}]{client\+Cert\+Type\+List }\end{DoxyParamCaption})}



Parse Client\+Cert\+Type extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em client\+Cert\+Type\+List} & Pointer to the Client\+Cert\+Type extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1023 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
1025 \{
1026    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1027 
1028    \textcolor{comment}{//Initialize status code}
1029    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1030 
1031 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
1032    \textcolor{comment}{//ClientCertType extension found?}
1033    \textcolor{keywordflow}{if}(clientCertTypeList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1034    \{
1035       \textcolor{comment}{//If the server does not send any CertificateRequest message, then the}
1036       \textcolor{comment}{//ClientCertType extension in the ServerHello must be omitted}
1037       \textcolor{keywordflow}{if}(context->clientAuthMode != \hyperlink{tls_8h_a657708ec632fe90da5a94cf667118527a8aeb84d9835fccbae53eac318679053d}{TLS\_CLIENT\_AUTH\_NONE})
1038       \{
1039          \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1040 
1041          \textcolor{comment}{//The ClientCertType extension carries a list of supported certificate}
1042          \textcolor{comment}{//types, sorted by client preference}
1043          \textcolor{keywordflow}{for}(i = 0; i < clientCertTypeList->length; i++)
1044          \{
1045             \textcolor{comment}{//Check certificate type}
1046             \textcolor{keywordflow}{if}(clientCertTypeList->value[i] == \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0aa099e08287ecdea1676dce7f30d35270}{TLS\_CERT\_FORMAT\_X509})
1047             \{
1048                \textcolor{comment}{//Select X.509 certificate format}
1049                context->peerCertFormat = \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0aa099e08287ecdea1676dce7f30d35270}{TLS\_CERT\_FORMAT\_X509};
1050                \textcolor{comment}{//Exit immediately}
1051                \textcolor{keywordflow}{break};
1052             \}
1053             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(clientCertTypeList->value[i] == 
      \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0a598a87140d01a36216289f5dfb6c0f35}{TLS\_CERT\_FORMAT\_RAW\_PUBLIC\_KEY})
1054             \{
1055                \textcolor{comment}{//Ensure the server is able to process raw public keys}
1056                \textcolor{keywordflow}{if}(context->rpkVerifyCallback != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1057                \{
1058                   \textcolor{comment}{//Select raw public key format}
1059                   context->peerCertFormat = \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0a598a87140d01a36216289f5dfb6c0f35}{TLS\_CERT\_FORMAT\_RAW\_PUBLIC\_KEY};
1060                   \textcolor{comment}{//Exit immediately}
1061                   \textcolor{keywordflow}{break};
1062                \}
1063             \}
1064             \textcolor{keywordflow}{else}
1065             \{
1066                \textcolor{comment}{//Unsupported certificate type}
1067             \}
1068          \}
1069 
1070          \textcolor{comment}{//If the server does not have any certificate type in common with the}
1071          \textcolor{comment}{//client, then the server terminates the session with a fatal alert}
1072          \textcolor{keywordflow}{if}(i >= clientCertTypeList->length)
1073          \{
1074             \textcolor{comment}{//Report an error}
1075             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1076          \}
1077 
1078          \textcolor{comment}{//The ClientHello includes a ClientCertType extension}
1079          context->clientCertTypeExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1080       \}
1081    \}
1082    \textcolor{keywordflow}{else}
1083    \{
1084       \textcolor{comment}{//The ClientHello does not contain any ClientCertType extension}
1085       context->clientCertTypeExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1086       \textcolor{comment}{//Select default certificate format}
1087       context->peerCertFormat = \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0aa099e08287ecdea1676dce7f30d35270}{TLS\_CERT\_FORMAT\_X509};
1088    \}
1089 \textcolor{preprocessor}{#endif}
1090 
1091    \textcolor{comment}{//Return status code}
1092    \textcolor{keywordflow}{return} error;
1093 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_ae22d1c58492882319be6973f889a2244}\label{tls__server__extensions_8c_ae22d1c58492882319be6973f889a2244}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension@{tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension}}
\index{tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension@{tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension()}{tlsParseClientEcPointFormatsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Ec\+Point\+Formats\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a56cd71342730891de1eb587381a26731}{Tls\+Ec\+Point\+Format\+List} $\ast$}]{ec\+Point\+Format\+List }\end{DoxyParamCaption})}



Parse Ec\+Point\+Formats extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em ec\+Point\+Format\+List} & Pointer to the Ec\+Point\+Formats extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 868 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
870 \{
871    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
872 
873 \textcolor{preprocessor}{#if (TLS\_MAX\_VERSION >= SSL\_VERSION\_3\_0 && TLS\_MIN\_VERSION <= TLS\_VERSION\_1\_2)}
874    \textcolor{comment}{//Initialize status code}
875    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
876 
877 \textcolor{preprocessor}{#if (TLS\_ECDH\_ANON\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_RSA\_KE\_SUPPORT == ENABLED || \(\backslash\)}
878 \textcolor{preprocessor}{   TLS\_ECDHE\_ECDSA\_KE\_SUPPORT == ENABLED || TLS\_ECDHE\_PSK\_KE\_SUPPORT == ENABLED)}
879    \textcolor{comment}{//EcPointFormats extension found?}
880    \textcolor{keywordflow}{if}(ecPointFormatList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
881    \{
882       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
883 
884       \textcolor{comment}{//The ClientHello includes a EcPointFormats extension}
885       context->ecPointFormatsExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
886 
887       \textcolor{comment}{//Loop through the list of supported EC point formats}
888       \textcolor{keywordflow}{for}(i = 0; i < ecPointFormatList->length; i++)
889       \{
890          \textcolor{comment}{//Uncompressed point format?}
891          \textcolor{keywordflow}{if}(ecPointFormatList->value[i] == \hyperlink{tls_8h_a45b8a57398a9bd960e3f3186a7d3cd38a149b16635a32aa8ed87166485790f152}{TLS\_EC\_POINT\_FORMAT\_UNCOMPRESSED}
      )
892          \{
893             \textcolor{keywordflow}{break};
894          \}
895       \}
896 
897       \textcolor{comment}{//The uncompressed point format must be supported by any TLS application}
898       \textcolor{comment}{//that supports this extension (refer to RFC 4492, section 5.1)}
899       \textcolor{keywordflow}{if}(i >= ecPointFormatList->length)
900       \{
901          \textcolor{comment}{//Report an error}
902          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
903       \}
904    \}
905    \textcolor{keywordflow}{else}
906    \{
907       \textcolor{comment}{//If no SupportedPointsFormat extension is sent, the uncompressed format}
908       \textcolor{comment}{//has to be used}
909       context->ecPointFormatsExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
910    \}
911 \textcolor{preprocessor}{#endif}
912 \textcolor{preprocessor}{#else}
913    \textcolor{comment}{//Not implemented}
914    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cab61c5ef368fbf03fdc1fb566c63f2f9a}{ERROR\_NOT\_IMPLEMENTED};
915 \textcolor{preprocessor}{#endif}
916 
917    \textcolor{comment}{//Return status code}
918    \textcolor{keywordflow}{return} error;
919 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a1964c308b6b9b35f1c6fc81e59ba2a83}\label{tls__server__extensions_8c_a1964c308b6b9b35f1c6fc81e59ba2a83}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Ems\+Extension@{tls\+Parse\+Client\+Ems\+Extension}}
\index{tls\+Parse\+Client\+Ems\+Extension@{tls\+Parse\+Client\+Ems\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Ems\+Extension()}{tlsParseClientEmsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Ems\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{extended\+Master\+Secret }\end{DoxyParamCaption})}



Parse Extended\+Master\+Secret extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em extended\+Master\+Secret} & Pointer to the Extended\+Master\+Secret extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1166 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
1168 \{
1169    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1170 
1171    \textcolor{comment}{//Initialize status code}
1172    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1173 
1174 \textcolor{preprocessor}{#if (TLS\_EXT\_MASTER\_SECRET\_SUPPORT == ENABLED)}
1175    \textcolor{comment}{//ExtendedMasterSecret extension found?}
1176    \textcolor{keywordflow}{if}(extendedMasterSecret != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1177    \{
1178       \textcolor{comment}{//SSL 3.0 currently selected?}
1179       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0})
1180       \{
1181          \textcolor{comment}{//If the client chooses to support SSL 3.0, the resulting session}
1182          \textcolor{comment}{//must use the legacy master secret computation}
1183          context->extendedMasterSecretExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1184       \}
1185       \textcolor{keywordflow}{else}
1186       \{
1187          \textcolor{comment}{//Use the extended master secret computation}
1188          context->extendedMasterSecretExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1189       \}
1190    \}
1191    \textcolor{keywordflow}{else}
1192    \{
1193       \textcolor{comment}{//Abbreviated handshake?}
1194       \textcolor{keywordflow}{if}(context->resume)
1195       \{
1196          \textcolor{comment}{//If the original session used the ExtendedMasterSecret extension but}
1197          \textcolor{comment}{//the new ClientHello does not contain it, the server must abort the}
1198          \textcolor{comment}{//abbreviated handshake}
1199          \textcolor{keywordflow}{if}(context->extendedMasterSecretExtReceived)
1200          \{
1201             \textcolor{comment}{//Report an error}
1202             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1203          \}
1204       \}
1205 
1206       \textcolor{comment}{//If the client and server choose to continue a full handshake without}
1207       \textcolor{comment}{//the extension, they must use the standard master secret derivation}
1208       \textcolor{comment}{//for the new session}
1209       context->extendedMasterSecretExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1210    \}
1211 \textcolor{preprocessor}{#endif}
1212 
1213    \textcolor{comment}{//Return status code}
1214    \textcolor{keywordflow}{return} error;
1215 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a9cc022e4c7f789f6c9a82d1999e77c6a}\label{tls__server__extensions_8c_a9cc022e4c7f789f6c9a82d1999e77c6a}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Max\+Frag\+Len\+Extension@{tls\+Parse\+Client\+Max\+Frag\+Len\+Extension}}
\index{tls\+Parse\+Client\+Max\+Frag\+Len\+Extension@{tls\+Parse\+Client\+Max\+Frag\+Len\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Max\+Frag\+Len\+Extension()}{tlsParseClientMaxFragLenExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Max\+Frag\+Len\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{max\+Frag\+Len }\end{DoxyParamCaption})}



Parse Max\+Fragment\+Length extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em max\+Frag\+Len} & Pointer to the Max\+Fragment\+Length extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 714 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
716 \{
717    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
718 
719    \textcolor{comment}{//Initialize status code}
720    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
721 
722 \textcolor{preprocessor}{#if (TLS\_MAX\_FRAG\_LEN\_SUPPORT == ENABLED)}
723    \textcolor{comment}{//MaxFragmentLength extension found?}
724    \textcolor{keywordflow}{if}(maxFragLen != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
725    \{
726       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
727 
728       \textcolor{comment}{//Retrieve the value advertised by the client}
729       \textcolor{keywordflow}{switch}(*maxFragLen)
730       \{
731       \textcolor{keywordflow}{case} \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63a4c1a1521181c432d51d61dc4f295d027}{TLS\_MAX\_FRAGMENT\_LENGTH\_512}:
732          n = 512;
733          \textcolor{keywordflow}{break};
734       \textcolor{keywordflow}{case} \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63aeee4f23ba8be12a29158044f629a04cf}{TLS\_MAX\_FRAGMENT\_LENGTH\_1024}:
735          n = 1024;
736          \textcolor{keywordflow}{break};
737       \textcolor{keywordflow}{case} \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63ad6ba9b8c7be1f57b904f4e1304295fad}{TLS\_MAX\_FRAGMENT\_LENGTH\_2048}:
738          n = 2048;
739          \textcolor{keywordflow}{break};
740       \textcolor{keywordflow}{case} \hyperlink{tls_8h_a9d0a45f7cb05f78ef159005b86bf0a63ac32ed0270e2b99db48fe7835eb1525bc}{TLS\_MAX\_FRAGMENT\_LENGTH\_4096}:
741          n = 4096;
742          \textcolor{keywordflow}{break};
743       \textcolor{keywordflow}{default}:
744          n = 0;
745          \textcolor{keywordflow}{break};
746       \}
747 
748       \textcolor{comment}{//Acceptable value?}
749       \textcolor{keywordflow}{if}(n > 0)
750       \{
751          \textcolor{comment}{//Once a maximum fragment length has been successfully negotiated,}
752          \textcolor{comment}{//the server must immediately begin fragmenting messages (including}
753          \textcolor{comment}{//handshake messages) to ensure that no fragment larger than the}
754          \textcolor{comment}{//negotiated length is sent}
755          context->maxFragLen = \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
756       \}
757       \textcolor{keywordflow}{else}
758       \{
759          \textcolor{comment}{//If a server receives a maximum fragment length negotiation request}
760          \textcolor{comment}{//for a value other than the allowed values, it must abort the handshake}
761          \textcolor{comment}{//with an illegal\_parameter alert}
762          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
763       \}
764 
765       \textcolor{comment}{//The ClientHello includes a MaxFragmentLength extension}
766       context->maxFragLenExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
767    \}
768    \textcolor{keywordflow}{else}
769    \{
770       \textcolor{comment}{//The ClientHello does not contain any MaxFragmentLength extension}
771       context->maxFragLenExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
772    \}
773 \textcolor{preprocessor}{#endif}
774 
775    \textcolor{comment}{//Return status code}
776    \textcolor{keywordflow}{return} error;
777 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a4525618ed7ee2f566b94acf4ae6b15af}\label{tls__server__extensions_8c_a4525618ed7ee2f566b94acf4ae6b15af}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Record\+Size\+Limit\+Extension@{tls\+Parse\+Client\+Record\+Size\+Limit\+Extension}}
\index{tls\+Parse\+Client\+Record\+Size\+Limit\+Extension@{tls\+Parse\+Client\+Record\+Size\+Limit\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Record\+Size\+Limit\+Extension()}{tlsParseClientRecordSizeLimitExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Record\+Size\+Limit\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} $\ast$}]{record\+Size\+Limit }\end{DoxyParamCaption})}



Parse Record\+Size\+Limit extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em record\+Size\+Limit} & Pointer to the Record\+Size\+Limit extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 787 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
789 \{
790 \textcolor{preprocessor}{#if (TLS\_RECORD\_SIZE\_LIMIT\_SUPPORT == ENABLED)}
791    \textcolor{comment}{//RecordSizeLimit extension found?}
792    \textcolor{keywordflow}{if}(recordSizeLimit != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
793    \{
794       \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
795 
796       \textcolor{comment}{//The value of RecordSizeLimit is the maximum size of record in octets}
797       \textcolor{comment}{//that the peer is willing to receive}
798       n = \hyperlink{cpu__endian_8h_ae21854587c05993c850b537156470088}{LOAD16BE}(recordSizeLimit);
799 
800       \textcolor{comment}{//Endpoints must not send a RecordSizeLimit extension with a value}
801       \textcolor{comment}{//smaller than 64}
802       \textcolor{keywordflow}{if}(n < 64)
803       \{
804          \textcolor{comment}{//An endpoint must treat receipt of a smaller value as a fatal error}
805          \textcolor{comment}{//and generate an illegal\_parameter alert}
806          \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
807       \}
808 
809       \textcolor{comment}{//TLS 1.3 currently selected?}
810       \textcolor{keywordflow}{if}(context->version == \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3})
811       \{
812          \textcolor{comment}{//The value includes the content type and padding added in TLS 1.3}
813          n--;
814       \}
815 
816       \textcolor{comment}{//Initial or updated ClientHello?}
817       \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d}{TLS\_STATE\_CLIENT\_HELLO\_2})
818       \{
819          \textcolor{comment}{//When responding to a HelloRetryRequest, the client must send the}
820          \textcolor{comment}{//same ClientHello without modification}
821          \textcolor{keywordflow}{if}(!context->recordSizeLimitExtReceived ||
822             context->recordSizeLimit != n)
823          \{
824             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
825          \}
826       \}
827 
828       \textcolor{comment}{//The peer can include any limit up to the protocol-defined limit for}
829       \textcolor{comment}{//maximum record size. Even if a larger value is provided by a peer, an}
830       \textcolor{comment}{//endpoint must not send records larger than the protocol-defined limit}
831       context->recordSizeLimit = \hyperlink{os__port_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(n, \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH});
832 
833       \textcolor{comment}{//The ClientHello includes a RecordSizeLimit extension}
834       context->recordSizeLimitExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
835    \}
836    \textcolor{keywordflow}{else}
837    \{
838       \textcolor{comment}{//Initial or updated ClientHello?}
839       \textcolor{keywordflow}{if}(context->state == \hyperlink{tls_8h_a02bb4c8aa7988b33fe4d4836d8ff4a4da535ebf5eb2c0397b2d6ed43669f63a7d}{TLS\_STATE\_CLIENT\_HELLO\_2})
840       \{
841          \textcolor{comment}{//When responding to a HelloRetryRequest, the client must send the}
842          \textcolor{comment}{//same ClientHello without modification}
843          \textcolor{keywordflow}{if}(context->recordSizeLimitExtReceived)
844             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
845       \}
846 
847       \textcolor{comment}{//If this extension is not negotiated, endpoints can send records of any}
848       \textcolor{comment}{//size permitted by the protocol or other negotiated extensions}
849       context->recordSizeLimit = \hyperlink{tls_8h_a87485283e0c2c0a9b1b3e5ef9df52975}{TLS\_MAX\_RECORD\_LENGTH};
850 
851       \textcolor{comment}{//The RecordSizeLimit extension is not supported by the client}
852       context->recordSizeLimitExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
853    \}
854 \textcolor{preprocessor}{#endif}
855 
856    \textcolor{comment}{//Successful processing}
857    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
858 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_adddc100a1d10d444b0735b69491619a2}\label{tls__server__extensions_8c_adddc100a1d10d444b0735b69491619a2}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Renego\+Info\+Extension@{tls\+Parse\+Client\+Renego\+Info\+Extension}}
\index{tls\+Parse\+Client\+Renego\+Info\+Extension@{tls\+Parse\+Client\+Renego\+Info\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Renego\+Info\+Extension()}{tlsParseClientRenegoInfoExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Renego\+Info\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a91a1f867efbc9e94610e512a667e3e16}{Tls\+Renego\+Info} $\ast$}]{renego\+Info }\end{DoxyParamCaption})}



Parse Renegotiation\+Info extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em renego\+Info} & Pointer to the Renegotiation\+Info extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1225 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
1227 \{
1228    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1229 
1230    \textcolor{comment}{//Initialize status code}
1231    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1232 
1233 \textcolor{preprocessor}{#if (TLS\_SECURE\_RENEGOTIATION\_SUPPORT == ENABLED)}
1234    \textcolor{comment}{//RenegotiationInfo extension found?}
1235    \textcolor{keywordflow}{if}(renegoInfo != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1236    \{
1237       \textcolor{comment}{//Initial handshake?}
1238       \textcolor{keywordflow}{if}(context->clientVerifyDataLen == 0)
1239       \{
1240          \textcolor{comment}{//Set the secure\_renegotiation flag to TRUE}
1241          context->secureRenegoFlag = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1242 
1243          \textcolor{comment}{//The server must then verify that the length of the}
1244          \textcolor{comment}{//renegotiated\_connection field is zero}
1245          \textcolor{keywordflow}{if}(renegoInfo->length != 0)
1246          \{
1247             \textcolor{comment}{//If it is not, the server must abort the handshake}
1248             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1249          \}
1250       \}
1251       \textcolor{comment}{//Secure renegotiation?}
1252       \textcolor{keywordflow}{else}
1253       \{
1254          \textcolor{comment}{//Check the length of the renegotiated\_connection field}
1255          \textcolor{keywordflow}{if}(renegoInfo->length != context->clientVerifyDataLen)
1256          \{
1257             \textcolor{comment}{//The server must abort the handshake}
1258             error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1259          \}
1260          \textcolor{keywordflow}{else}
1261          \{
1262             \textcolor{comment}{//Verify that the value of the renegotiated\_connection field}
1263             \textcolor{comment}{//is equal to the saved client\_verify\_data value}
1264             \textcolor{keywordflow}{if}(memcmp(renegoInfo->value, context->clientVerifyData,
1265                context->clientVerifyDataLen))
1266             \{
1267                \textcolor{comment}{//If it is not, the server must abort the handshake}
1268                error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1269             \}
1270          \}
1271       \}
1272    \}
1273    \textcolor{keywordflow}{else}
1274    \{
1275       \textcolor{comment}{//Secure renegotiation?}
1276       \textcolor{keywordflow}{if}(context->clientVerifyDataLen != 0 || context->serverVerifyDataLen != 0)
1277       \{
1278          \textcolor{comment}{//The server must verify that the renegotiation\_info extension is}
1279          \textcolor{comment}{//present. If it is not, the server must abort the handshake}
1280          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca70d82df53df56c9d4a943d5539ccc4bc}{ERROR\_HANDSHAKE\_FAILED};
1281       \}
1282    \}
1283 \textcolor{preprocessor}{#endif}
1284 
1285    \textcolor{comment}{//Return status code}
1286    \textcolor{keywordflow}{return} error;
1287 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_ab34de7891d354995208e858a53a14b57}\label{tls__server__extensions_8c_ab34de7891d354995208e858a53a14b57}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Sni\+Extension@{tls\+Parse\+Client\+Sni\+Extension}}
\index{tls\+Parse\+Client\+Sni\+Extension@{tls\+Parse\+Client\+Sni\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Sni\+Extension()}{tlsParseClientSniExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Sni\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a15e86cf6f06b8178e14735d6e4c83cb1}{Tls\+Server\+Name\+List} $\ast$}]{server\+Name\+List }\end{DoxyParamCaption})}



Parse S\+NI extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em server\+Name\+List} & Pointer to the S\+NI extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 628 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
630 \{
631 \textcolor{preprocessor}{#if (TLS\_SNI\_SUPPORT == ENABLED)}
632    \textcolor{comment}{//SNI extension found?}
633    \textcolor{keywordflow}{if}(serverNameList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
634    \{
635       \textcolor{keywordtype}{size\_t} i;
636       \textcolor{keywordtype}{size\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
637       \textcolor{keywordtype}{size\_t} \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length};
638       \textcolor{keyword}{const} \hyperlink{tls_8h_a6f611c0a8ca46d6a2d45dfac2c92b2fc}{TlsServerName} *serverName;
639 
640       \textcolor{comment}{//In order to provide the server name, clients may include ServerName}
641       \textcolor{comment}{//extension}
642       \textcolor{keywordflow}{if}(context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
643       \{
644          \textcolor{comment}{//Release memory}
645          \hyperlink{tls_8h_a3bf186204f261ff5d65b31794917f742}{tlsFreeMem}(context->serverName);
646          context->serverName = \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
647       \}
648 
649       \textcolor{comment}{//Retrieve the length of the list}
650       length = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverNameList->length);
651 
652       \textcolor{comment}{//Loop through the list of server names advertised by the client}
653       \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{dtls__misc_8h_ab43ca82dd7fa2a0e56f941032ef324c4}{length}; i += \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a6f611c0a8ca46d6a2d45dfac2c92b2fc}{TlsServerName}) + n)
654       \{
655          \textcolor{comment}{//Point to the current server name}
656          serverName = (\hyperlink{tls_8h_a6f611c0a8ca46d6a2d45dfac2c92b2fc}{TlsServerName} *) (serverNameList->value + i);
657 
658          \textcolor{comment}{//Malformed extension?}
659          \textcolor{keywordflow}{if}(length < (i + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a6f611c0a8ca46d6a2d45dfac2c92b2fc}{TlsServerName})))
660             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
661          \textcolor{keywordflow}{if}(length < (i + \textcolor{keyword}{sizeof}(\hyperlink{tls_8h_a6f611c0a8ca46d6a2d45dfac2c92b2fc}{TlsServerName}) + \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverName->length)))
662             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
663 
664          \textcolor{comment}{//Retrieve the length of the server name}
665          n = \hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(serverName->length);
666 
667          \textcolor{comment}{//Empty strings must not be included in the list}
668          \textcolor{keywordflow}{if}(n == 0)
669             \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca9468adacac8c37004024dd0095ba2768}{ERROR\_DECODING\_FAILED};
670 
671          \textcolor{comment}{//Currently, the only server names supported are DNS hostnames}
672          \textcolor{keywordflow}{if}(serverName->type == \hyperlink{tls_8h_a1096de9b487e6a6550bbca632604cea1a5c69aeb541b02e8236093fa37448dfa4}{TLS\_NAME\_TYPE\_HOSTNAME})
673          \{
674             \textcolor{comment}{//The server name must be a valid DNS hostname}
675             \textcolor{keywordflow}{if}(!\hyperlink{tls__misc_8c_a821d4cff18a6ac6efc5079ccba1836cc}{tlsCheckDnsHostname}(serverName->hostname, n))
676                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
677 
678             \textcolor{comment}{//The ServerNameList must not contain more than one name of the}
679             \textcolor{comment}{//same type (refer to RFC 6066, section 3)}
680             \textcolor{keywordflow}{if}(context->serverName != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
681                \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca152b24f57c941cb736772696416eb7c2}{ERROR\_ILLEGAL\_PARAMETER};
682 
683             \textcolor{comment}{//Check the length of the name}
684             \textcolor{keywordflow}{if}(n <= \hyperlink{tls_8h_a8a1fb1aaf12099be4957532482ac16fe}{TLS\_MAX\_SERVER\_NAME\_LEN})
685             \{
686                \textcolor{comment}{//Allocate a memory block to hold the server name}
687                context->serverName = \hyperlink{tls_8h_a00504a83fb06cb4206f7205664ffeeb4}{tlsAllocMem}(n + 1);
688                \textcolor{comment}{//Failed to allocate memory?}
689                \textcolor{keywordflow}{if}(context->serverName == \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
690                   \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cac0a554045048d2fb61387cf735676f69}{ERROR\_OUT\_OF\_MEMORY};
691 
692                \textcolor{comment}{//Save server name}
693                memcpy(context->serverName, serverName->hostname, n);
694                \textcolor{comment}{//Properly terminate the string with a NULL character}
695                context->serverName[\hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n}] = \textcolor{charliteral}{'\(\backslash\)0'};
696             \}
697          \}
698       \}
699    \}
700 \textcolor{preprocessor}{#endif}
701 
702    \textcolor{comment}{//Successful processing}
703    \textcolor{keywordflow}{return} \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
704 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_a5f9b37e02ecb77f4b6285669ed9a90b4}\label{tls__server__extensions_8c_a5f9b37e02ecb77f4b6285669ed9a90b4}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Client\+Supported\+Versions\+Extension@{tls\+Parse\+Client\+Supported\+Versions\+Extension}}
\index{tls\+Parse\+Client\+Supported\+Versions\+Extension@{tls\+Parse\+Client\+Supported\+Versions\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Client\+Supported\+Versions\+Extension()}{tlsParseClientSupportedVersionsExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Client\+Supported\+Versions\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_a47fa2b51d8550d068fce6f01a24c03a8}{Tls\+Supported\+Version\+List} $\ast$}]{supported\+Version\+List }\end{DoxyParamCaption})}



Parse Supported\+Versions extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em supported\+Version\+List} & Pointer to the Supported\+Versions extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 576 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
578 \{
579    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
580    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
581    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} j;
582    \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} \hyperlink{dhcpv6__common_8h_a5a648f5ec00c526b0dfa2df7a272c6c0}{n};
583 
584    \textcolor{comment}{//Supported TLS versions}
585    \textcolor{keyword}{const} \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t} supportedVersions[] =
586    \{
587       \hyperlink{tls_8h_ab44dc642afbfbd72926ab1f94634cd4d}{TLS\_VERSION\_1\_3},
588       \hyperlink{tls_8h_af97e91c5fb95fb0957e5f37ec9e9eae8}{TLS\_VERSION\_1\_2},
589       \hyperlink{tls_8h_a9e359f668824d16983a41f8deb338979}{TLS\_VERSION\_1\_1},
590       \hyperlink{tls_8h_adcc8f4321c8f3b847fbea16ca0ff337e}{TLS\_VERSION\_1\_0},
591       \hyperlink{tls_8h_a8d19a9661e2ca28062ba4a00799e8bdb}{SSL\_VERSION\_3\_0}
592    \};
593 
594    \textcolor{comment}{//Initialize status code}
595    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca20a00b499b03770ffd859e78470c278f}{ERROR\_VERSION\_NOT\_SUPPORTED};
596 
597    \textcolor{comment}{//Retrieve the number of items in the list}
598    n = supportedVersionList->length / \textcolor{keyword}{sizeof}(\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t});
599 
600    \textcolor{comment}{//Loop through the list of TLS versions supported by the server}
601    \textcolor{keywordflow}{for}(i = 0; i < \hyperlink{os__port_8h_aa1394a41d43c0f3fd30febe41c7bb340}{arraysize}(supportedVersions) && error; i++)
602    \{
603       \textcolor{comment}{//The extension contains a list of TLS versions supported by the client}
604       \textcolor{keywordflow}{for}(j = 0; j < n && error; j++)
605       \{
606          \textcolor{comment}{//Servers must only select a version of TLS present in that extension}
607          \textcolor{comment}{//and must ignore any unknown versions}
608          \textcolor{keywordflow}{if}(\hyperlink{cpu__endian_8h_a9312c6eb72e64f748ae0d0e0dc3ec9b9}{ntohs}(supportedVersionList->value[j]) == supportedVersions[i])
609          \{
610             \textcolor{comment}{//Set the TLS version to be used}
611             error = \hyperlink{tls__misc_8c_a62b0052733220e9ec9fee8ff5e8e5dab}{tlsSelectVersion}(context, supportedVersions[i]);
612          \}
613       \}
614    \}
615 
616    \textcolor{comment}{//Return status code}
617    \textcolor{keywordflow}{return} error;
618 \}
\end{DoxyCode}
\mbox{\Hypertarget{tls__server__extensions_8c_aa5440eb1a18caf8461d6418167d79c5c}\label{tls__server__extensions_8c_aa5440eb1a18caf8461d6418167d79c5c}} 
\index{tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}!tls\+Parse\+Server\+Cert\+Type\+List\+Extension@{tls\+Parse\+Server\+Cert\+Type\+List\+Extension}}
\index{tls\+Parse\+Server\+Cert\+Type\+List\+Extension@{tls\+Parse\+Server\+Cert\+Type\+List\+Extension}!tls\+\_\+server\+\_\+extensions.\+c@{tls\+\_\+server\+\_\+extensions.\+c}}
\subsubsection{\texorpdfstring{tls\+Parse\+Server\+Cert\+Type\+List\+Extension()}{tlsParseServerCertTypeListExtension()}}
{\footnotesize\ttfamily \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\+\_\+t} tls\+Parse\+Server\+Cert\+Type\+List\+Extension (\begin{DoxyParamCaption}\item[{\hyperlink{tls_8h_ac09f7a286c0cdf9b07ee1edd107946f5}{Tls\+Context} $\ast$}]{context,  }\item[{const \hyperlink{tls_8h_aef3d0205a40e8c95b8d7019053d3e7ca}{Tls\+Cert\+Type\+List} $\ast$}]{server\+Cert\+Type\+List }\end{DoxyParamCaption})}



Parse Server\+Cert\+Type extension. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em context} & Pointer to the T\+LS context \\
\hline
\mbox{\tt in}  & {\em server\+Cert\+Type\+List} & Pointer to the Server\+Cert\+Type extension \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}


Definition at line 1103 of file tls\+\_\+server\+\_\+extensions.\+c.


\begin{DoxyCode}
1105 \{
1106    \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689c}{error\_t} error;
1107 
1108    \textcolor{comment}{//Initialize status code}
1109    error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
1110 
1111 \textcolor{preprocessor}{#if (TLS\_RAW\_PUBLIC\_KEY\_SUPPORT == ENABLED)}
1112    \textcolor{comment}{//ServerCertType extension found?}
1113    \textcolor{keywordflow}{if}(serverCertTypeList != \hyperlink{group__BSPDefine_ga070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
1114    \{
1115       \hyperlink{compiler__port_8h_a12a1e9b3ce141648783a82445d02b58d}{uint\_t} i;
1116 
1117       \textcolor{comment}{//The ServerCertType extension carries a list of supported certificate}
1118       \textcolor{comment}{//types, sorted by client preference}
1119       \textcolor{keywordflow}{for}(i = 0; i < serverCertTypeList->length; i++)
1120       \{
1121          \textcolor{comment}{//Check certificate type}
1122          \textcolor{keywordflow}{if}(serverCertTypeList->value[i] == \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0aa099e08287ecdea1676dce7f30d35270}{TLS\_CERT\_FORMAT\_X509} ||
1123             serverCertTypeList->value[i] == \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0a598a87140d01a36216289f5dfb6c0f35}{TLS\_CERT\_FORMAT\_RAW\_PUBLIC\_KEY})
1124          \{
1125             \textcolor{comment}{//The certificate type is selected from one of the values provided}
1126             \textcolor{comment}{//by the client}
1127             context->certFormat = (\hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0}{TlsCertificateFormat}) serverCertTypeList->value[i];
1128 
1129             \textcolor{comment}{//We are done}
1130             \textcolor{keywordflow}{break};
1131          \}
1132       \}
1133 
1134       \textcolor{comment}{//If the server does not have any certificate type in common with the}
1135       \textcolor{comment}{//client, then the server terminates the session with a fatal alert}
1136       \textcolor{keywordflow}{if}(i >= serverCertTypeList->length)
1137       \{
1138          \textcolor{comment}{//Report an error}
1139          error = \hyperlink{error_8h_ac7659d73a8cdedc08e9f566bb406689ca60be66501af3d6d6f899b10c26122ffe}{ERROR\_UNSUPPORTED\_CERTIFICATE};
1140       \}
1141 
1142       \textcolor{comment}{//The ClientHello includes a ServerCertType extension}
1143       context->serverCertTypeExtReceived = \hyperlink{os__port_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1144    \}
1145    \textcolor{keywordflow}{else}
1146    \{
1147       \textcolor{comment}{//The ClientHello does not contain any ServerCertType extension}
1148       context->serverCertTypeExtReceived = \hyperlink{os__port_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1149       \textcolor{comment}{//Select default certificate format}
1150       context->certFormat = \hyperlink{tls_8h_a14c2a51c1d8cf969aa455b69e405c0d0aa099e08287ecdea1676dce7f30d35270}{TLS\_CERT\_FORMAT\_X509};
1151    \}
1152 \textcolor{preprocessor}{#endif}
1153 
1154    \textcolor{comment}{//Return status code}
1155    \textcolor{keywordflow}{return} error;
1156 \}
\end{DoxyCode}
